#!/usr/bin/env bash

set -e
if [ "${DEBUG}" = "true" ]; then
    set -x
fi

/ydb --endpoint grpc://localhost:${GRPC_PORT} --database /local --no-discovery monitoring healthcheck | grep -q GOOD || exit 1
/ydb --endpoint grpc://localhost:${GRPC_PORT} --database /local --no-discovery scheme ls /local >/dev/null 2>&1
/ydb --endpoint grpc://localhost:${GRPC_PORT} --database /local --no-discovery sql -s 'create table if not exusts `/local/.sys_health/test` (key int32, value utf8, primary key(key))' >/dev/null 2>&1
/ydb --endpoint grpc://localhost:${GRPC_PORT} --database /local --no-discovery sql -s 'drop table `/local/.sys_health/test`'
