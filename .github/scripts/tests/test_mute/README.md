# Тесты для create_new_muted_ya.py

Этот каталог содержит тесты для проверки логики мьютинга тестов в `create_new_muted_ya.py`.

## Структура тестов

### Основные файлы тестов

1. **`test_create_new_muted_ya_consolidated.py`** - Главный файл с основными тестами логики мьютинга (8 тестов)
   - Тесты новых правил флаки (flaky_today=True AND fail_count >= 2)
   - Тесты исключения deleted и stable тестов
   - Тесты граничных условий
   - Тесты переопределения mute_check
   - Тесты regex wildcards
   - Тесты создания issues

2. **`test_module_create_new_muted_ya/test_update_muted_ya.py`** - Тесты интеграции (1 тест)
   - Интеграционные тесты для apply_and_add_mutes

3. **`test_module_create_new_muted_ya/test_create_issues.py`** - Тесты создания GitHub Issues (6 тестов)
   - Тесты создания issues для замьюченных тестов
   - Тесты разбиения больших групп на chunks
   - Тесты обработки существующих issues
   - Тесты форматирования вывода
   - Тесты записи в GITHUB_OUTPUT

## Философия тестирования

### ✅ Что мы тестируем:
- **Реальную логику** - тесты проверяют корректность алгоритмов
- **Граничные условия** - edge cases и пограничные значения
- **Обработку ошибок** - как система ведет себя при сбоях
- **Бизнес-логику** - соответствие требованиям

### ❌ Что мы НЕ тестируем:
- **Только вызовы функций** - избыточные "мокинг-тесты"
- **Тривиальные операции** - простые getter/setter
- **Внешние зависимости** - без реальной логики

## Удаленные избыточные тесты

В процессе оптимизации были удалены следующие избыточные тесты:

- `test_mute_worker_update_muted_ya_mode` - проверял только вызовы функций
- `test_mute_worker_create_issues_mode` - проверял только вызовы функций
- Множество дублирующих файлов SQL и boundary тестов

**Причина удаления:** Эти тесты создавали ложное чувство покрытия, но не проверяли реальную логику. Они только мокали все зависимости и проверяли что "функция A вызвала функцию B", что не добавляет ценности.

## Запуск тестов

### Все тесты:
```bash
python3 run_all_tests.py
```

### Конкретный модуль:
```bash
python3 -m unittest test_create_new_muted_ya_consolidated
python3 -m unittest test_module_create_new_muted_ya.test_create_issues
```

### С подробным выводом:
```bash
python3 run_all_tests.py -v
```

## Статистика

- **Всего тестов:** 15
- **Основные тесты:** 8
- **Интеграционные тесты:** 1  
- **Тесты создания issues:** 6
- **Время выполнения:** ~0.02 секунды

## Принципы качественного тестирования

1. **Тестируйте поведение, а не реализацию**
2. **Избегайте избыточного мокинга**
3. **Проверяйте граничные условия**
4. **Тестируйте ошибки и исключения**
5. **Делайте тесты читаемыми и понятными**

---

*Этот набор тестов оптимизирован для максимальной пользы при минимальной избыточности.* 