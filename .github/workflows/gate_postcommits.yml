name: Postcommits gate
on:
  #schedule:
  #  - cron: "*/5 * * * *"  # Every 5 minutes
  workflow_dispatch:

jobs:
  switch_gate:
    runs-on: ubuntu-latest
    name: SwitchGate
    steps:
    - name: main
      shell: bash
      run: |
        curl -L -H "Accept: application/vnd.github+json" -H "Authorization: Bearer ${{github.token}}" -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/${{github.repository}}/actions/runs?per_page=1000\&page=1\&status=queued\&event=pull_request_target | \
          jq '[.workflow_runs[] | {name,status,id,updated_at,"waiting_seconds":(now - (.updated_at | fromdate)), html_url}]' | \
          jq '[.[] | select(.waiting_seconds > 600)]'
