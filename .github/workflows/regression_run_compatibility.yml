name: Regression-run_compatibility

on:
  schedule:
    - cron: "0 23 * * *"  # At 23:00 every day
  workflow_dispatch:
    inputs:
      initial_version_ref:
        description: Initial(oldest) version (ex. stable-24-4/25.1.1.18, should exist on S3)
        type: string
        required: false
        default: stable-24-4
      inter_version_ref:
        description: Intermediate version
        type: string
        required: false
        default: stable-25-1-2
      target_version_ref:
        description: Target(newest) version ("current" - compiles binary from the chosen branch)
        type: string
        required: false
        default: current
jobs:
  main:
    name: Regression-run_compatibility
    uses: ./.github/workflows/run_tests.yml
    secrets: inherit
    strategy:
      fail-fast: false
      matrix: 
        build_preset: ["relwithdebinfo", "release-asan", "release-tsan", "release-msan"]
    with:
      test_targets: ydb/tests/compatibility/
      branches: ${{ github.ref_name }}
      build_preset: ${{ matrix.build_preset }}
      additional_ya_make_args: "-DCOMPAT_INIT_REF=\"${{inputs.initial_version_ref}}\" -DCOMPAT_INTER_REF=\"${{inputs.inter_version_ref}}\" -DCOMPAT_TARGET_REF=\"${{inputs.target_version_ref}}\""
