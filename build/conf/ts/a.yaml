service: frontend_build_platform
title: Frontend build platform build/conf/ts

arcanum:
  review:
    auto_assign: true
    groups:
      - name: fbp_team
        roles: frontend_build_platform:developer
      - name: ya_make_team
        roles: ya_make:developer
    rules:
      # Если изменения от команды ya_make, то ревью на них
      # FBP добавляется, чтобы они были в курсе, как владельцы кода
      - authors: ya_make:developer
        reviewers:
          - name: ya_make_team
            assign: 1
            ship: 1
            ignore_self_ship: false
          - name: fbp_team
            assign: 999
            ship: 0
      # Если изменения от кого-то стороннего, то ревью на FBP
      - authors: "!ya_make:developer"
        reviewers:
          name: fbp_team
          assign: 999
          ship: 1


ci:
  # @robot-nots https://yav.yandex-team.ru/secret/sec-01gfaajz2g21eq18zbdzcgye52
  secret: sec-01gfaajz2g21eq18zbdzcgye52
  runtime:
    sandbox-owner: FRONTEND_BUILD_PLATFORM

  actions:
    check-use-prebuilt-nots-tool:
      title: Check TS_USE_PREBUILT_NOTS_TOOL=yes
      flow: check-use-prebuilt-nots-tool
      triggers:
        - on: pr
          required: always
          filters:
            - sub-paths: [ ts.conf ]

  flows:
    check-use-prebuilt-nots-tool:
      title: Check TS_USE_PREBUILT_NOTS_TOOL=yes
      jobs:
        check:
          title: Check TS_USE_PREBUILT_NOTS_TOOL=yes
          task: common/misc/run_command
          input:
            config:
              arc_mount_config:
                enabled: true
              logs_config:
                redirect_stderr_to_stdout: true
                stdout_ci_badge: true
              cmd_line: |
                set -x
                if grep -r 'TS_USE_PREBUILT_NOTS_TOOL=no' $ARCADIA_PATH/build/conf/ts/ts.conf; then
                  echo "TS_USE_PREBUILT_NOTS_TOOL=no found in ts.conf"
                  exit 1
                fi
