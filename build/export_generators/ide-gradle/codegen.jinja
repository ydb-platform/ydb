{%- macro TopDepends(taskvar) -%}
{%-     if proto_template %}

tasks.named("prepareMainProtos").configure {
    dependsOn({{ taskvar }})
}
{%-     endif -%}

{#-     Check main target codegen -#}
{%-     if varprefix == MAIN_VARPREFIX %}
tasks.compileJava.configure {
    dependsOn({{ taskvar }})
}
{%-     endif %}
tasks.compileTestJava.configure {
    dependsOn({{ taskvar }})
}
{%-     if hasResources -%}
{#-         Check main target codegen -#}
{%-         if varprefix == MAIN_VARPREFIX %}
tasks.processResources.configure {
    dependsOn({{ taskvar }})
}
{%-         endif %}
tasks.processTestResources.configure {
    dependsOn({{ taskvar }})
}
{%-     endif -%}
{%-     if with_lombok_plugin %}
tasks.named("delombok").configure {
    mustRunAfter({{ taskvar }})
}
{%-     endif -%}

{%-     if with_kotlin -%}
{#-         Check main target codegen -#}
{%-         if varprefix == MAIN_VARPREFIX %}
tasks.compileKotlin.configure {
    dependsOn({{ taskvar }})
}
{%-         endif %}
tasks.compileTestKotlin.configure {
    dependsOn({{ taskvar }})
}
{%-         if with_kapt or with_test_kapt %}
tasks.withType<KaptGenerateStubsTask>().configureEach {
    mustRunAfter({{ taskvar }})
}
{%-         endif -%}
{%      endif -%}
{%- endmacro -%}

{%- macro ObjDepends(obj) -%}
{%-     set taskvar = varprefix + obj['_object_index'] -%}
{%-     if obj['_parent_object_index'] and obj['_parent_object_index'] in current_target_object_indexes -%}
{%-         set parent_taskvar = varprefix + obj['_parent_object_index'] %}

tasks.named("{{ parent_taskvar }}").configure {
    dependsOn({{ taskvar }})
}
{%-     elif not obj['_object_index'] in current_target_object_indexes_with_codegen_dirs -%}
{{ TopDepends(taskvar) }}
{%-     endif  -%}
{%- endmacro -%}

{%- set codegenBindir = export_root + "/" + curdir -%}

{%- if target is defined -%}
{%-     set current_target = target -%}
{#-     Main target codegen -#}
{%-     set varprefix = MAIN_VARPREFIX -%}
{%-     include "[generator]/codegen_current_target.jinja" -%}
{%- endif -%}
{%- if extra_targets|length -%}
{%-     for current_target in extra_targets -%}
{#-         TestN target codegen -#}
{%-         set varprefix = "test" + loop.index0|tojson + "Codegen" -%}
{%-         include "[generator]/codegen_current_target.jinja" -%}
{%-     endfor -%}
{%- endif -%}
