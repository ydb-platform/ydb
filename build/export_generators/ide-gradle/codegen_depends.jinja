{%- if current_target.custom_runs|length -%}
{%-     for custom_run in current_target.custom_runs -%}
{{ ObjDepends(custom_run) }}
{%-     endfor -%}
{%- endif -%}

{%- if current_target.runs|length -%}
{%-     for run in current_target.runs -%}
{{ ObjDepends(run) }}
{%-     endfor -%}
{%- endif -%}

{%- if copy_files|length -%}
{%-     for copy in copy_files -%}
{{ ObjDepends(copy) }}
{%-     endfor -%}
{%- endif -%}

{%- if move_files|length -%}
{%-     for move in move_files -%}
{{ ObjDepends(move) }}
{%-     endfor -%}
{%- endif -%}

{%- if current_target.from_sandboxes|length -%}
{%-     for from_sandbox in current_target.from_sandboxes -%}
{{ ObjDepends(from_sandbox) }}
{%-     endfor -%}
{%- endif -%}

{%- if current_target.custom_runs|length or current_target.runs|length -%}
{%-     set collectTask = varprefix + "Collect" %}

val {{ collectTask }} = tasks.register<Sync>("{{ collectTask }}") {
{%-     if current_target.custom_runs|length -%}
{%-         for custom_run in current_target.custom_runs -%}
{%-             if not (custom_run['_parent_object_index'] is defined) or not (custom_run['_parent_object_index'] in current_target_object_indexes) %}
    from({{ varprefix }}{{ custom_run['_object_index'] }})
{%-             endif -%}
{%-         endfor -%}
{%-     endif -%}
{%-     if current_target.runs|length -%}
{%-         for run in current_target.runs -%}
{%-             if not(run['_parent_object_index'] is defined) or not(run['_parent_object_index'] in current_target_object_indexes) %}
    from({{ varprefix }}{{ run['_object_index'] }})
{%-             endif -%}
{%-         endfor -%}
{%-     endif %}
    into("$projectCodegenDir/{{ varprefix }}.collect")
}

{%-     if varprefix == MAIN_VARPREFIX %}

sourceSets {
    main {
        java.srcDir({{ collectTask }}).include("**/*")
    }
}
{%-     else %}

sourceSets {
    test {
        java.srcDir({{ collectTask }}).include("**/*")
    }
}
{%-     endif %}

{%- endif -%}
