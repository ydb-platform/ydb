{%- set mainClass = target.app_main_class -%}
{%- set publish = target.publish -%}
{%- set with_kotlin = target.with_kotlin -%}
{%- set kotlin_version = target.kotlin_version -%}
{%- set has_junit5_test = extra_targets|selectattr('junit5_test') -%}
{%- set has_errorprone = target.consumer|selectattr('jar', 'startsWith', 'contrib/java/com/google/errorprone/error_prone_annotations')|length -%}

{%- if not target.required_jdk -%}
{%-     set has_required_jdk = false -%}
{#-     If no required JDK, set default JDK for Kotlin parts -#}
{%-     set required_jdk = '17' -%}
{%- else -%}
{%-     set has_required_jdk = true -%}
{%-     set required_jdk = target.required_jdk -%}
{%- endif -%}

{%- macro OutDirs(runs, prefix, suffix) -%}
{%-    if run.args|length and run.out_dir|length -%}
{%-        for out_dir in run.out_dir -%}
{#-            search all run arguments ended by /<out_dir> -#}
{%-            set out_dirs = select_by_ends(run.args, "/" + out_dir) -%}
{%-            if out_dirs|length %}
{{ prefix }}{{ out_dirs|first }}{{ suffix }}
{%-            endif -%}
{%-        endfor -%}
{%-    endif -%}
{%- endmacro -%}
