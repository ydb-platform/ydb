# Generated by devtools/yamaker from nixpkgs 22.11.

LIBRARY()

LICENSE(
    Apache-2.0 AND
    Apache-2.0 WITH LLVM-exception AND
    MIT AND
    NCSA
)

LICENSE_TEXTS(.yandex_meta/licenses.list.txt)

VERSION(18.1.0-rc1)

ORIGINAL_SOURCE(https://github.com/llvm/llvm-project/archive/llvmorg-18.1.0-rc1.tar.gz)

PEERDIR(
    library/cpp/sanitizer/include
)

ADDINCL(
    contrib/libs/libunwind/include
)

NO_RUNTIME()

NO_UTIL()

NO_LTO()

NO_SANITIZE()

NO_SANITIZE_COVERAGE()

CFLAGS(
    -D_LIBCPP_HAS_NO_PRAGMA_SYSTEM_HEADER
    -D_LIBUNWIND_IS_NATIVE_ONLY
    -D_LIBUNWIND_LINK_DL_LIB
    -D_LIBUNWIND_LINK_PTHREAD_LIB
    -fno-exceptions
    -fno-rtti
    -funwind-tables
)

IF (SANITIZER_TYPE == memory)
    CFLAGS(
        -fPIC
    )
ENDIF()

IF (NOT OS_EMSCRIPTEN)
    CFLAGS(
        -D_LIBUNWIND_IS_NATIVE_ONLY
    )
    SRCS(
        src/Unwind-EHABI.cpp
        src/Unwind-seh.cpp
        src/Unwind-sjlj.c
        src/Unwind-wasm.c
        src/UnwindLevel1-gcc-ext.c
        src/UnwindLevel1.c
        src/UnwindRegistersRestore.S
        src/UnwindRegistersSave.S
        src/libunwind.cpp
    )
ELSEIF (OS_EMSCRIPTEN AND ARCH_WASM32)
    PEERDIR(
        contrib/restricted/emscripten/include
    )
    CFLAGS(
        -D_LIBUNWIND_HIDE_SYMBOLS
    )
    SRCS(
        src/Unwind-wasm.c
    )
ELSEIF (OS_EMSCRIPTEN AND NOT ARCH_WASM32)
    PEERDIR(
        contrib/restricted/emscripten/include
    )
    CFLAGS(
        -D_LIBUNWIND_HIDE_SYMBOLS
        -D__USING_WASM_EXCEPTIONS__
    )
    SRCS(
        src/Unwind-wasm.c
    )
ENDIF()

END()
