--- contrib/python/psutil/py2/ya.make	(index)
+++ contrib/python/psutil/py2/ya.make	(working tree)
@@ -1,2 +0,0 @@
-# Generated by devtools/yamaker (pypi).
-
@@ -32,6 +29,0 @@ CFLAGS(
-    -DPSUTIL_POSIX=1
-    -DPSUTIL_LINUX=1
-    -DPSUTIL_POSIX=1
-    -DPSUTIL_OSX=1
-    -DPSUTIL_WINDOWS=1
-    -DPSUTIL_SIZEOF_PID_T=4
@@ -42,15 +33,0 @@ SRCS(
-    psutil/_psutil_linux.c
-    psutil/_psutil_osx.c
-    psutil/_psutil_posix.c
-    psutil/_psutil_windows.c
-    psutil/arch/osx/process_info.c
-    psutil/arch/windows/cpu.c
-    psutil/arch/windows/disk.c
-    psutil/arch/windows/net.c
-    psutil/arch/windows/process_handles.c
-    psutil/arch/windows/process_info.c
-    psutil/arch/windows/process_utils.c
-    psutil/arch/windows/security.c
-    psutil/arch/windows/services.c
-    psutil/arch/windows/socks.c
-    psutil/arch/windows/wmi.c
@@ -59,6 +36,71 @@ SRCS(
-PY_REGISTER(
-    psutil._psutil_linux
-    psutil._psutil_osx
-    psutil._psutil_posix
-    psutil._psutil_windows
-)
+IF (OS_LINUX)
+    CFLAGS(
+        -DPSUTIL_POSIX=1
+        -DPSUTIL_LINUX=1
+    )
+
+    SRCS(
+        psutil/_psutil_linux.c
+        psutil/_psutil_posix.c
+    )
+
+    PY_REGISTER(
+        psutil._psutil_linux
+        psutil._psutil_posix
+    )
+ENDIF()
+
+IF (OS_DARWIN)
+    CFLAGS(
+        -DPSUTIL_POSIX=1
+        -DPSUTIL_OSX=1
+    )
+
+    LDFLAGS(
+        -framework CoreFoundation
+        -framework IOKit
+    )
+
+    SRCS(
+        psutil/_psutil_osx.c
+        psutil/_psutil_posix.c
+        psutil/arch/osx/process_info.c
+    )
+
+    PY_REGISTER(
+        psutil._psutil_osx
+        psutil._psutil_posix
+    )
+ENDIF()
+
+IF (OS_WINDOWS)
+    CFLAGS(
+        -DPSUTIL_WINDOWS=1
+        -DPSUTIL_SIZEOF_PID_T=4
+    )
+
+    LDFLAGS(
+        Shell32.lib
+        PowrProf.lib
+        Wtsapi32.lib
+        Pdh.lib
+    )
+
+    SRCS(
+        psutil/_psutil_windows.c
+        psutil/arch/windows/cpu.c
+        psutil/arch/windows/disk.c
+        psutil/arch/windows/net.c
+        psutil/arch/windows/process_handles.c
+        psutil/arch/windows/process_info.c
+        psutil/arch/windows/process_utils.c
+        psutil/arch/windows/security.c
+        psutil/arch/windows/services.c
+        psutil/arch/windows/socks.c
+        psutil/arch/windows/wmi.c
+    )
+
+    PY_REGISTER(
+        psutil._psutil_windows
+    )
+ENDIF()
