--- contrib/python/psutil/py3/ya.make    (index)
+++ contrib/python/psutil/py3/ya.make    (working tree)
@@ -32,7 +29,0 @@ CFLAGS(
-    -DPSUTIL_POSIX=1
-    -DPSUTIL_LINUX=1
-    -DPSUTIL_POSIX=1
-    -DPSUTIL_OSX=1
-    -DPSUTIL_WINDOWS=1
-    -DPSUTIL_SIZEOF_PID_T=4
-    -DPSUTIL_MAYBE_EXTERN=extern
@@ -42,46 +33,2 @@ SRCS(
-    psutil/_psutil_linux.c
-    psutil/_psutil_osx.c
-    psutil/_psutil_windows.c
     psutil/arch/all/init.c
     psutil/arch/all/pids.c
-    psutil/arch/linux/disk.c
-    psutil/arch/linux/mem.c
-    psutil/arch/linux/net.c
-    psutil/arch/linux/proc.c
-    psutil/arch/osx/cpu.c
-    psutil/arch/osx/disk.c
-    psutil/arch/osx/init.c
-    psutil/arch/osx/mem.c
-    psutil/arch/osx/net.c
-    psutil/arch/osx/pids.c
-    psutil/arch/osx/proc.c
-    psutil/arch/osx/sensors.c
-    psutil/arch/osx/sys.c
-    psutil/arch/posix/init.c
-    psutil/arch/posix/net.c
-    psutil/arch/posix/proc.c
-    psutil/arch/posix/sysctl.c
-    psutil/arch/posix/users.c
-    psutil/arch/sunos/cpu.c
-    psutil/arch/sunos/disk.c
-    psutil/arch/sunos/environ.c
-    psutil/arch/sunos/mem.c
-    psutil/arch/sunos/net.c
-    psutil/arch/sunos/proc.c
-    psutil/arch/sunos/sys.c
-    psutil/arch/windows/cpu.c
-    psutil/arch/windows/disk.c
-    psutil/arch/windows/init.c
-    psutil/arch/windows/mem.c
-    psutil/arch/windows/net.c
-    psutil/arch/windows/pids.c
-    psutil/arch/windows/proc.c
-    psutil/arch/windows/proc_handles.c
-    psutil/arch/windows/proc_info.c
-    psutil/arch/windows/proc_utils.c
-    psutil/arch/windows/security.c
-    psutil/arch/windows/sensors.c
-    psutil/arch/windows/services.c
-    psutil/arch/windows/socks.c
-    psutil/arch/windows/sys.c
-    psutil/arch/windows/wmi.c
@@ -74,5 +36,96 @@ SRCS(
-PY_REGISTER(
-    psutil._psutil_linux
-    psutil._psutil_osx
-    psutil._psutil_windows
-)
+IF (OS_LINUX)
+    CFLAGS(
+        -DPSUTIL_POSIX=1
+        -DPSUTIL_LINUX=1
+    )
+
+    SRCS(
+        psutil/_psutil_linux.c
+        psutil/arch/linux/disk.c
+        psutil/arch/linux/mem.c
+        psutil/arch/linux/net.c
+        psutil/arch/linux/proc.c
+        psutil/arch/posix/init.c
+        psutil/arch/posix/net.c
+        psutil/arch/posix/proc.c
+        psutil/arch/posix/sysctl.c
+        psutil/arch/posix/users.c
+    )
+
+    PY_REGISTER(
+        psutil._psutil_linux
+    )
+ENDIF()
+
+IF (OS_DARWIN)
+    CFLAGS(
+        -DPSUTIL_POSIX=1
+        -DPSUTIL_OSX=1
+    )
+
+    LDFLAGS(
+        -framework CoreFoundation
+        -framework IOKit
+    )
+
+    SRCS(
+        psutil/_psutil_osx.c
+        psutil/arch/osx/cpu.c
+        psutil/arch/osx/disk.c
+        psutil/arch/osx/init.c
+        psutil/arch/osx/mem.c
+        psutil/arch/osx/net.c
+        psutil/arch/osx/pids.c
+        psutil/arch/osx/proc.c
+        psutil/arch/osx/sensors.c
+        psutil/arch/osx/sys.c
+        psutil/arch/posix/init.c
+        psutil/arch/posix/net.c
+        psutil/arch/posix/proc.c
+        psutil/arch/posix/sysctl.c
+        psutil/arch/posix/users.c
+    )
+
+    PY_REGISTER(
+        psutil._psutil_osx
+    )
+ENDIF()
+
+IF (OS_WINDOWS)
+    CFLAGS(
+        -DPSUTIL_WINDOWS=1
+        -DPSUTIL_SIZEOF_PID_T=4
+        -DPSUTIL_MAYBE_EXTERN=extern
+    )
+
+    LDFLAGS(
+        Shell32.lib
+        PowrProf.lib
+        Wtsapi32.lib
+        Pdh.lib
+    )
+
+    SRCS(
+        psutil/_psutil_windows.c
+        psutil/arch/windows/cpu.c
+        psutil/arch/windows/disk.c
+        psutil/arch/windows/init.c
+        psutil/arch/windows/mem.c
+        psutil/arch/windows/net.c
+        psutil/arch/windows/pids.c
+        psutil/arch/windows/proc.c
+        psutil/arch/windows/proc_handles.c
+        psutil/arch/windows/proc_info.c
+        psutil/arch/windows/proc_utils.c
+        psutil/arch/windows/security.c
+        psutil/arch/windows/sensors.c
+        psutil/arch/windows/services.c
+        psutil/arch/windows/socks.c
+        psutil/arch/windows/sys.c
+        psutil/arch/windows/wmi.c
+    )
+
+    PY_REGISTER(
+        psutil._psutil_windows
+    )
+ENDIF()
