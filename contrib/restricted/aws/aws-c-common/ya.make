# Generated by devtools/yamaker from nixpkgs 24.05.

LIBRARY()

LICENSE(
    "(GPL-2.0-only OR BSD-3-Clause)" AND
    Apache-2.0 AND
    BSD-3-Clause AND
    MIT AND
    Public-Domain
)

LICENSE_TEXTS(.yandex_meta/licenses.list.txt)

VERSION(0.12.4)

ORIGINAL_SOURCE(https://github.com/awslabs/aws-c-common/archive/v0.12.4.tar.gz)

ADDINCL(
    GLOBAL contrib/restricted/aws/aws-c-common/generated/include
    GLOBAL contrib/restricted/aws/aws-c-common/include
    contrib/restricted/aws/aws-c-common/source/external/libcbor
)

NO_COMPILER_WARNINGS()

NO_RUNTIME()

CFLAGS(
    -DAWS_COMMON_USE_IMPORT_EXPORT
    -DAWS_PTHREAD_GETNAME_TAKES_3ARGS
    -DAWS_PTHREAD_SETNAME_TAKES_2ARGS
    -DCJSON_HIDE_SYMBOLS
    -DHAVE_SYSCONF
    -DINTEL_NO_ITTNOTIFY_API
)

IF (MUSL)
    CFLAGS(
        -DAWS_AFFINITY_METHOD=AWS_AFFINITY_METHOD_PTHREAD
    )
ELSEIF (OS_DARWIN)
    CFLAGS(
        -DAWS_AFFINITY_METHOD=AWS_AFFINITY_METHOD_NONE
    )
    LDFLAGS(
        -framework
        CoreFoundation
    )
ELSEIF (OS_WINDOWS)
    CFLAGS(
        -DAWS_COMMON_EXPORTS
    )
ELSE()
    CFLAGS(
        -DAWS_AFFINITY_METHOD=AWS_AFFINITY_METHOD_PTHREAD_ATTR
    )
ENDIF()

IF (ARCH_X86_64)
    CFLAGS(
        -DUSE_SIMD_ENCODING
    )
ENDIF()

SRCS(
    source/allocator.c
    source/allocator_sba.c
    source/array_list.c
    source/assert.c
    source/byte_buf.c
    source/cache.c
    source/cbor.c
    source/codegen.c
    source/command_line_parser.c
    source/common.c
    source/condition_variable.c
    source/date_time.c
    source/device_random.c
    source/encoding.c
    source/error.c
    source/external/cJSON.c
    source/external/libcbor/allocators.c
    source/external/libcbor/cbor.c
    source/external/libcbor/cbor/arrays.c
    source/external/libcbor/cbor/bytestrings.c
    source/external/libcbor/cbor/callbacks.c
    source/external/libcbor/cbor/common.c
    source/external/libcbor/cbor/encoding.c
    source/external/libcbor/cbor/floats_ctrls.c
    source/external/libcbor/cbor/internal/builder_callbacks.c
    source/external/libcbor/cbor/internal/encoders.c
    source/external/libcbor/cbor/internal/loaders.c
    source/external/libcbor/cbor/internal/memory_utils.c
    source/external/libcbor/cbor/internal/stack.c
    source/external/libcbor/cbor/internal/unicode.c
    source/external/libcbor/cbor/ints.c
    source/external/libcbor/cbor/maps.c
    source/external/libcbor/cbor/serialization.c
    source/external/libcbor/cbor/streaming.c
    source/external/libcbor/cbor/strings.c
    source/external/libcbor/cbor/tags.c
    source/fifo_cache.c
    source/file.c
    source/hash_table.c
    source/host_utils.c
    source/json.c
    source/lifo_cache.c
    source/linked_hash_table.c
    source/linux/system_info.c
    source/log_channel.c
    source/log_formatter.c
    source/log_writer.c
    source/logging.c
    source/lru_cache.c
    source/math.c
    source/memtrace.c
    source/priority_queue.c
    source/process_common.c
    source/ref_count.c
    source/ring_buffer.c
    source/statistics.c
    source/string.c
    source/system_info.c
    source/task_scheduler.c
    source/thread_scheduler.c
    source/thread_shared.c
    source/uri.c
    source/uuid.c
    source/xml_parser.c
)

IF (ARCH_ARM)
    SRCS(
        source/arch/arm/auxv/cpuid.c
    )
ELSEIF (ARCH_X86_64)
    SRCS(
        source/arch/intel/asm/cpuid.c
        source/arch/intel/cpuid.c
    )
    SRC_C_AVX2(source/arch/intel/encoding_avx2.c)
ENDIF()

IF (NOT OS_WINDOWS)
    SRCS(
        source/posix/clock.c
        source/posix/condition_variable.c
        source/posix/cross_process_lock.c
        source/posix/device_random.c
        source/posix/environment.c
        source/posix/file.c
        source/posix/mutex.c
        source/posix/process.c
        source/posix/rw_lock.c
        source/posix/system_info.c
        source/posix/system_resource_utils.c
        source/posix/thread.c
        source/posix/time.c
    )
ENDIF()

END()
