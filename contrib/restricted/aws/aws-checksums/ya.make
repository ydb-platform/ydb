# Generated by devtools/yamaker from nixpkgs 24.05.

LIBRARY()

LICENSE(Apache-2.0)

LICENSE_TEXTS(.yandex_meta/licenses.list.txt)

VERSION(0.2.7)

ORIGINAL_SOURCE(https://github.com/awslabs/aws-checksums/archive/v0.2.7.tar.gz)

PEERDIR(
    contrib/restricted/aws/aws-c-common
)

ADDINCL(
    GLOBAL contrib/restricted/aws/aws-checksums/include
)

NO_COMPILER_WARNINGS()

NO_RUNTIME()

CFLAGS(
    -DAWS_CHECKSUMS_USE_IMPORT_EXPORT
    -DAWS_COMMON_USE_IMPORT_EXPORT
    -DHAVE_SYSCONF
    -DINTEL_NO_ITTNOTIFY_API
)

SRCS(
    source/checksums.c
    source/crc32.c
    source/crc64.c
    source/crc64_sw.c
    source/crc_sw.c
    source/intel/asm/crc32c_sse42_asm.c
)

IF (ARCH_X86_64)
    SRC_C_AVX(source/intel/intrin/crc64nvme_clmul.c)
    SRC_C_AVX512(source/intel/intrin/crc32c_sse42_avx512.c -mvpclmulqdq)
    SRC_C_AVX512(source/intel/intrin/crc64nvme_avx512.c -mvpclmulqdq)
ELSEIF (ARCH_ARM64)
    SRC(source/arm/crc32c_arm.c -mcrc)
ENDIF()

END()
