#pragma once

#include <cstddef>

#include <util/generic/hash.h>
#include <util/generic/hash_set.h>
#include <util/generic/maybe.h>
#include <util/generic/strbuf.h>
#include <util/generic/string.h>

namespace NKikimr::NJaegerTracing {

enum class ERequestType: size_t {
    UNSPECIFIED,

    KEYVALUE_CREATEVOLUME,
    KEYVALUE_DROPVOLUME,
    KEYVALUE_ALTERVOLUME,
    KEYVALUE_DESCRIBEVOLUME,
    KEYVALUE_LISTLOCALPARTITIONS,
    KEYVALUE_ACQUIRELOCK,
    KEYVALUE_EXECUTETRANSACTION,
    KEYVALUE_READ,
    KEYVALUE_READRANGE,
    KEYVALUE_LISTRANGE,
    KEYVALUE_GETSTORAGECHANNELSTATUS,

    TABLE_CREATESESSION,
    TABLE_KEEPALIVE,
    TABLE_ALTERTABLE,
    TABLE_CREATETABLE,
    TABLE_DROPTABLE,
    TABLE_DESCRIBETABLE,
    TABLE_COPYTABLE,
    TABLE_COPYTABLES,
    TABLE_RENAMETABLES,
    TABLE_EXPLAINDATAQUERY,
    TABLE_EXECUTESCHEMEQUERY,
    TABLE_BEGINTRANSACTION,
    TABLE_DESCRIBETABLEOPTIONS,
    TABLE_DELETESESSION,
    TABLE_COMMITTRANSACTION,
    TABLE_ROLLBACKTRANSACTION,
    TABLE_PREPAREDATAQUERY,
    TABLE_EXECUTEDATAQUERY,
    TABLE_BULKUPSERT,
    TABLE_STREAMEXECUTESCANQUERY,
    TABLE_STREAMREADTABLE,
    TABLE_READROWS,
    TABLE_DESCRIBEEXTERNALDATASOURCE,
    TABLE_DESCRIBEEXTERNALTABLE,

    QUERY_EXECUTEQUERY,
    QUERY_EXECUTESCRIPT,
    QUERY_FETCHSCRIPTRESULTS,
    QUERY_CREATESESSION,
    QUERY_DELETESESSION,
    QUERY_ATTACHSESSION,
    QUERY_BEGINTRANSACTION,
    QUERY_COMMITTRANSACTION,
    QUERY_ROLLBACKTRANSACTION,

    DISCOVERY_WHOAMI,
    DISCOVERY_NODEREGISTRATION,
    DISCOVERY_LISTENDPOINTS,

    RATELIMITER_CREATE_RESOURCE,
    RATELIMITER_ALTER_RESOURCE,
    RATELIMITER_DROP_RESOURCE,
    RATELIMITER_LIST_RESOURCES,
    RATELIMITER_DESCRIBE_RESOURCE,
    RATELIMITER_ACQUIRE_RESOURCE,

    BSCONFIG_REPLACESTORAGECONFIG,
    BSCONFIG_FETCHSTORAGECONFIG,
    BSCONFIG_BOOTSTRAP,

    PING_GRPC,
    PING_PROXY,
    PING_KQP,
    PING_SCHEME_CACHE,
    PING_TX_PROXY,
    PING_ACTOR_CHAIN,

    // Requests inside write session
    TOPIC_STREAMWRITE,
    TOPIC_STREAMWRITE_INIT,
    TOPIC_STREAMWRITE_WRITE,
    TOPIC_STREAMWRITE_UPDATE_TOKEN,
    // Requests inside read session
    TOPIC_STREAMREAD,
    TOPIC_STREAMREAD_INIT,
    TOPIC_STREAMREAD_READ,
    TOPIC_STREAMREAD_COMMIT_OFFSET,
    TOPIC_STREAMREAD_PARTITION_SESSION_STATUS,
    TOPIC_STREAMREAD_UPDATE_TOKEN,
    TOPIC_STREAMREAD_DIRECT_READ_ACK,
    TOPIC_STREAMREAD_START_PARTITION_SESSION,
    TOPIC_STREAMREAD_STOP_PARTITION_SESSION,
    // Requests inside direct read session
    TOPIC_STREAMDIRECTREAD,
    TOPIC_STREAMDIRECTREAD_INIT,
    TOPIC_STREAMDIRECTREAD_START_DIRECT_READ_PARTITION_SESSION,
    TOPIC_STREAMDIRECTREAD_UPDATE_TOKEN,
    // Single requests
    TOPIC_COMMITOFFSET,
    TOPIC_UPDATEOFFSETSINTRANSACTION,
    TOPIC_CREATETOPIC,
    TOPIC_DESCRIBETOPIC,
    TOPIC_DESCRIBEPARTITION,
    TOPIC_DESCRIBECONSUMER,
    TOPIC_ALTERTOPIC,
    TOPIC_DROPTOPIC,

    REQUEST_TYPES_CNT, // Add new types above this line
};

static constexpr size_t kRequestTypesCnt = static_cast<size_t>(ERequestType::REQUEST_TYPES_CNT);

// Name to request map
extern const THashMap<TStringBuf, ERequestType> NameToRequestType;

// Request types that don't inherit default sampling rules for UNSPECIFIED request type.
// Actually it is the set of long session requests that generate their own sampled requests.
extern const THashSet<ERequestType> NoDefaultSamplingRequestTypes;

struct TRequestDiscriminator {
    ERequestType RequestType = ERequestType::UNSPECIFIED;
    TMaybe<TString> Database = NothingObject;

    static const TRequestDiscriminator EMPTY;
};

} // namespace NKikimr::NJaegerTracing
