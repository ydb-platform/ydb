syntax = "proto3";

package NKikimrBridge;

message TClusterState {
    // each realm state in relation to primary one
    enum EPileState {
        DISCONNECTED = 0; // disconnected from the cluster (no other node connects to this realm)
        NOT_SYNCHRONIZED = 1; // not synchronized with primary, may not be promoted -- synchronization needs to complete first
        SYNCHRONIZED = 2; // fully synchronized with primary, may be promoted
    }
    repeated EPileState PerPileState = 1; // a state for every realm, including primary
    uint32 PrimaryPile = 2; // the current primary (must be SYNCHRONIZED)
    uint32 PromotedPile = 3; // realm we are going to promote (must also be SYNCHRONIZED), or primary one
    uint64 Generation = 4; // cluster state generation (which must be increasing strictly by one)
}

message TClusterStateHistory {
    message TUnsyncedEntry {
        TClusterState ClusterState = 1;
        fixed64 OperationGuid = 2;
        repeated uint32 UnsyncedPiles = 3; // a list of pile ids that did not refer to this entry; trimmed when empty
    }
    repeated TUnsyncedEntry UnsyncedEntries = 1; // entries stored in order of ascending Generation
}
