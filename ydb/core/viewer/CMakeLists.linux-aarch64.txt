# This file was generated by the YaTool build system (https://github.com/yandex/yatool),
# from a source YaTool build configuration provided in ya.make files.
#
# If the repository supports both CMake and ya build configurations, please modify both of them.
#
# If only CMake build configuration is supported then modify only CMake files and note that only
# simple modifications are allowed like adding source-files to targets or adding simple properties
# like target_include_directories. These modifications will be ported to original ya.make files
# by maintainers. Any complex modifications which can't be easily ported back to the ya build
# system may be rejected.
#
# Please refer to the build instructions in the repository for more information about manual
# changes in this file.

get_built_tool_path(
  TOOL_rescompiler_bin
  TOOL_rescompiler_dependency
  tools/rescompiler/bin
  rescompiler
)

add_subdirectory(json)
add_subdirectory(protos)
add_subdirectory(yaml)
add_subdirectory(ut)

add_library(ydb-core-viewer)


target_compile_options(ydb-core-viewer PRIVATE
  -Oz
  -DUSE_CURRENT_UDF_ABI_VERSION
)

target_link_libraries(ydb-core-viewer PUBLIC
  contrib-libs-linux-headers
  contrib-libs-cxxsupp
  yutil
  library-cpp-resource
  library-actors-core
  library-actors-helpers
  library-cpp-archive
  cpp-mime-types
  cpp-protobuf-json
  ydb-core-base
  core-blobstorage-base
  blobstorage-vdisk-common
  core-client-server
  ydb-core-external_sources
  core-graph-api
  ydb-core-grpc_services
  core-grpc_services-local_rpc
  ydb-core-health_check
  ydb-core-mon
  ydb-core-node_whiteboard
  ydb-core-protos
  ydb-core-scheme
  core-sys_view-common
  core-tx-schemeshard
  core-tx-tx_proxy
  ydb-core-util
  core-viewer-json
  core-viewer-yaml
  core-viewer-protos
  library-persqueue-topic_parser
  ydb-library-yaml_config
  api-protos
  lib-deprecated-kicli
  public-lib-json_value
  common
  api-grpc
  cpp-adapters-issue
  src-client-types
  services-lib-auth
  contrib-libs-yaml-cpp
)

target_sources(ydb-core-viewer PRIVATE
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers_browse.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers_operation.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers_query.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers_pdisk.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers_scheme.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers_storage.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers_vdisk.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers_viewer.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers_pq.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_pipe_req.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_wb_req.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_topic_data.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_request.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/wb_aggregate.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/wb_filter.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/wb_merge.cpp
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/browse_db.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/browse_events.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/browse.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/browse_pq.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/counters_hosts.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/healthcheck_record.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_handlers.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_local_rpc.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_pipe_req.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_storage_base.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_vdisk_req.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/json_wb_req.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/log.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/operation_cancel.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/operation_forget.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/operation_get.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/operation_list.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/pdisk_info.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/pdisk_restart.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/pdisk_status.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/query_autocomplete_helper.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/scheme_directory.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/storage_groups.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/vdisk_blobindexstat.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/vdisk_evict.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/vdisk_getblob.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/vdisk_vdiskstat.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_acl.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_autocomplete.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_browse.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_bscontrollerinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_bsgroupinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_capabilities.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_check_access.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_cluster.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_compute.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_config.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_content.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_counters.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_describe_consumer.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_describe.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_describe_topic.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_feature_flags.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_graph.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_healthcheck.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_helper.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_hiveinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_hivestats.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_hotkeys.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_labeled_counters.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_metainfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_netinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_nodeinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_nodelist.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_nodes.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_pdiskinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_pqconsumerinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_query.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_query_old.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_render.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_request.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_storage.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_storage_usage.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_sysinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_tabletcounters.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_tabletinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_tenantinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_tenants.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_topicinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_vdiskinfo.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer_whoami.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/viewer.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/wb_aggregate.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/wb_filter.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/wb_group.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/wb_merge.h
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/wb_req.h
)


add_global_library_for(ydb-core-viewer.global
  ydb-core-viewer)


target_compile_options(ydb-core-viewer.global PRIVATE
  -Oz
  -DUSE_CURRENT_UDF_ABI_VERSION
)

target_link_libraries(ydb-core-viewer.global PUBLIC
  contrib-libs-linux-headers
  contrib-libs-cxxsupp
  yutil
  library-cpp-resource
  library-actors-core
  library-actors-helpers
  library-cpp-archive
  cpp-mime-types
  cpp-protobuf-json
  ydb-core-base
  core-blobstorage-base
  blobstorage-vdisk-common
  core-client-server
  ydb-core-external_sources
  core-graph-api
  ydb-core-grpc_services
  core-grpc_services-local_rpc
  ydb-core-health_check
  ydb-core-mon
  ydb-core-node_whiteboard
  ydb-core-protos
  ydb-core-scheme
  core-sys_view-common
  core-tx-schemeshard
  core-tx-tx_proxy
  ydb-core-util
  core-viewer-json
  core-viewer-yaml
  core-viewer-protos
  library-persqueue-topic_parser
  ydb-library-yaml_config
  api-protos
  lib-deprecated-kicli
  public-lib-json_value
  common
  api-grpc
  cpp-adapters-issue
  src-client-types
  services-lib-auth
  contrib-libs-yaml-cpp
)

target_sources(ydb-core-viewer.global PRIVATE
  ${PROJECT_BINARY_DIR}/ydb/core/viewer/f7451ff56ee7901156fb681fa86158d6.cpp
)


resources(ydb-core-viewer.global
  ${PROJECT_BINARY_DIR}/ydb/core/viewer/f7451ff56ee7901156fb681fa86158d6.cpp
  INPUTS
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/index.html
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/viewer.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/jstree.min.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/style.min.css
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/throbber.gif
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/32px.png
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/40px.png
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/cpu
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/cpu_view.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/disk_cell.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/disk_map.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/index.html
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/man-green.png
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/man-orange.png
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/man-red.png
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/man-yellow.png
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/net_view.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/network
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/node_group.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/node.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/node_map.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/nodes
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/node_view.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/overview
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/overview.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/pdisk.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/pool_block.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/pool_map.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/runner.html
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/stats.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/storage
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/storage_group.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/storage.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/storage_view.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/tablet_cell.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/tablet_map.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/tenant.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/tenants
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/tenant_view.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/throbber.gif
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/util.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/vdisk.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/viewer.css
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/v2/viewer.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/api/favicon-16x16.png
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/api/favicon-32x32.png
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/api/index.css
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/api/index.html
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/api/swagger-initializer.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/api/swagger-ui-bundle.js
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/api/swagger-ui.css
  ${PROJECT_SOURCE_DIR}/ydb/core/viewer/content/api/swagger-ui-standalone-preset.js
  KEYS
  viewer/index.html
  viewer/viewer.js
  viewer/jstree.min.js
  viewer/style.min.css
  viewer/throbber.gif
  viewer/32px.png
  viewer/40px.png
  viewer/v2/cpu
  viewer/v2/cpu_view.js
  viewer/v2/disk_cell.js
  viewer/v2/disk_map.js
  viewer/v2/index.html
  viewer/v2/man-green.png
  viewer/v2/man-orange.png
  viewer/v2/man-red.png
  viewer/v2/man-yellow.png
  viewer/v2/net_view.js
  viewer/v2/network
  viewer/v2/node_group.js
  viewer/v2/node.js
  viewer/v2/node_map.js
  viewer/v2/nodes
  viewer/v2/node_view.js
  viewer/v2/overview
  viewer/v2/overview.js
  viewer/v2/pdisk.js
  viewer/v2/pool_block.js
  viewer/v2/pool_map.js
  viewer/v2/runner.html
  viewer/v2/stats.js
  viewer/v2/storage
  viewer/v2/storage_group.js
  viewer/v2/storage.js
  viewer/v2/storage_view.js
  viewer/v2/tablet_cell.js
  viewer/v2/tablet_map.js
  viewer/v2/tenant.js
  viewer/v2/tenants
  viewer/v2/tenant_view.js
  viewer/v2/throbber.gif
  viewer/v2/util.js
  viewer/v2/vdisk.js
  viewer/v2/viewer.css
  viewer/v2/viewer.js
  viewer/api/favicon-16x16.png
  viewer/api/favicon-32x32.png
  viewer/api/index.css
  viewer/api/index.html
  viewer/api/swagger-initializer.js
  viewer/api/swagger-ui-bundle.js
  viewer/api/swagger-ui.css
  viewer/api/swagger-ui-standalone-preset.js
  OPTS
)
option(YDB_EMBEDDED_UI_DEV_SNAPSHOT "Use latest dev version of embedded UI git repo" Off)
include(${CMAKE_CURRENT_SOURCE_DIR}/recursive_resources.cmake)

if (YDB_EMBEDDED_UI_DEV_SNAPSHOT)
  find_program(NPM_PATH NAMES npm REQUIRED)

  include(ExternalProject)
  ExternalProject_Add(ydb-embedded-ui-git
    GIT_REPOSITORY https://github.com/ydb-platform/ydb-embedded-ui.git
    GIT_TAG main
    USES_TERMINAL_DOWNLOAD On
    USES_TERMINAL_UPDATE On
    USES_TERMINAL_BUILD On
    CONFIGURE_COMMAND ""
    TEST_COMMAND ""
    INSTALL_COMMAND ""
    BUILD_IN_SOURCE On
    BUILD_COMMAND ${NPM_PATH} ci
    COMMAND       ${NPM_PATH} run build:embedded
  )
  ExternalProject_Get_property(ydb-embedded-ui-git SOURCE_DIR)
  add_gen_resources(ydb-embedded-ui-git ${CMAKE_BINARY_DIR}/ydb/core/viewer/ydb_embedded_ui_monitoring.cpp
    IN_DIR  ${SOURCE_DIR}/build
    PREFIX monitoring
  )

else()
  add_dir_resources(${CMAKE_BINARY_DIR}/ydb/core/viewer/ydb_embedded_ui_monitoring.cpp
    IN_DIR  ${CMAKE_CURRENT_SOURCE_DIR}/monitoring
    PREFIX monitoring
  )
endif()
target_sources(ydb-core-viewer.global PRIVATE
  ${CMAKE_BINARY_DIR}/ydb/core/viewer/ydb_embedded_ui_monitoring.cpp
)
