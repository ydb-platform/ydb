"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[1329],{17594:(e,t,a)=>{a.d(t,{l:()=>d});var n=a(69024),s=a(4557),r=a(77506),i=a(16819),o=a(60712);const l=(0,r.cn)("ydb-resizeable-data-table");function d({columnsWidthLSKey:e,columns:t,settings:a,wrapperClassName:r,...d}){const[c,u]=(0,i.a)(e),h=(0,n.j)(t,c),b={...a,defaultResizeable:!0};return(0,o.jsx)("div",{className:l(null,r),children:(0,o.jsx)(s.Ay,{theme:"yandex-cloud",columns:h,onResize:u,settings:b,...d})})}},21545:(e,t,a)=>{a.d(t,{X:()=>s});var n=a(78034);const s=a(21334).F.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async({id:e,database:t},{signal:a})=>{try{const[s,r,i]=await Promise.all([window.api.viewer.getTablet({id:e,database:t},{signal:a}),window.api.viewer.getTabletHistory({id:e,database:t},{signal:a}),window.api.viewer.getNodesList({signal:a})]),o=(0,n.nN)(i),l=Object.keys(r).reduce(((e,t)=>{var a;const n=null===(a=r[t])||void 0===a?void 0:a.TabletStateInfo;if(n&&n.length){var s;const a=n.find((e=>e.Leader))||n[0],{ChangeTime:r,Generation:i,State:l,Leader:d,FollowerId:c}=a,u=o&&t?null===(s=o.get(Number(t)))||void 0===s?void 0:s.Host:void 0;"Dead"!==l&&e.push({nodeId:t,generation:i,changeTime:r,state:l,leader:d,followerId:c,fqdn:u})}return e}),[]),{TabletStateInfo:d=[]}=s,[c={}]=d,{TabletId:u}=c;return{data:{id:u,data:c,history:l}}}catch(s){return{error:s}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async({tenantId:e},{signal:t})=>{try{const a=await window.api.viewer.getTabletDescribe(e,{signal:t}),{SchemeShard:n,PathId:s}=e;return{data:(null===a||void 0===a?void 0:a.Path)||`${n}:${s}`}}catch(a){return{error:a}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async({id:e,hiveId:t},{signal:a})=>{try{return{data:await window.api.tablets.getTabletFromHive({id:e,hiveId:t},{signal:a})}}catch(n){return{error:n}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async({id:e})=>{try{return{data:await window.api.tablets.killTablet(e)}}catch(t){return{error:t}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.stopTablet(e,t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.resumeTablet(e,t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})},22983:(e,t,a)=>{a.d(t,{B:()=>d});var n=a(59284),s=a(84476),r=a(84375),i=a(55974),o=a(42829),l=a(60712);function d({children:e,onConfirmAction:t,onConfirmActionSuccess:a,dialogHeader:d,dialogText:c,retryButtonText:u,buttonDisabled:h=!1,buttonView:b="action",buttonTitle:p,buttonClassName:v,withPopover:g=!1,popoverContent:m,popoverPlacement:x="right",popoverDisabled:y=!0}){const[j,w]=n.useState(!1),[T,f]=n.useState(!1),[N,S]=n.useState(!1),I=()=>(0,l.jsx)(s.$,{onClick:()=>w(!0),view:b,disabled:h,loading:!h&&T,className:v,title:p,children:e});return(0,l.jsxs)(n.Fragment,{children:[(0,l.jsx)(i.g,{visible:j,header:d,text:c,withRetry:N,retryButtonText:u,onConfirm:async e=>{f(!0),await t(e)},onConfirmActionSuccess:async()=>{S(!1);try{await(null===a||void 0===a?void 0:a())}finally{f(!1)}},onConfirmActionError:e=>{S((0,o.D)(e)),f(!1)},onClose:()=>{w(!1)}}),g?(0,l.jsx)(r.A,{content:m,placement:x,disabled:y,children:I()}):I()]})}},27775:(e,t,a)=>{a.d(t,{i:()=>i});var n=a(47665),s=a(58267),r=a(60712);function i({state:e}){return(0,r.jsx)(n.J,{theme:(0,s._)(e),children:e})}},28539:(e,t,a)=>{a.d(t,{T:()=>n.T});var n=a(53755)},42829:(e,t,a)=>{a.d(t,{D:()=>n});const n=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},52248:(e,t,a)=>{a.d(t,{a:()=>n.a});var n=a(47334)},55974:(e,t,a)=>{a.d(t,{g:()=>m});var n=a(59284),s=a(18677),r=a(71153),i=a(74321),o=a(2198),l=a(99991),d=a(89954),c=a(77506),u=a(48372);const h=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),b=(0,u.g4)("ydb-critical-action-dialog",{en:h});var p=a(60712);const v=(0,c.cn)("ydb-critical-dialog"),g=e=>e.data&&"issues"in e.data&&e.data.issues?(0,p.jsx)(d.O,{hideSeverity:!0,data:e.data}):403===e.status?b("no-rights-error"):e.statusText?e.statusText:b("default-error");function m({visible:e,header:t,text:a,withRetry:d,retryButtonText:c,withCheckBox:u,onClose:h,onConfirm:m,onConfirmActionSuccess:x,onConfirmActionError:y}){const[j,w]=n.useState(!1),[T,f]=n.useState(),[N,S]=n.useState(!1),I=async e=>(w(!0),m(e).then((()=>{x(),h()})).catch((e=>{y(e),f(e)})).finally((()=>{w(!1)})));return(0,p.jsx)(o.l,{open:e,hasCloseButton:!1,className:v(),size:"s",onClose:h,onTransitionExited:()=>{f(void 0),S(!1)},children:T?(0,p.jsxs)(n.Fragment,{children:[(0,p.jsx)(o.l.Header,{caption:t}),(0,p.jsx)(o.l.Body,{className:v("body"),children:(0,p.jsxs)("div",{className:v("body-message",{error:!0}),children:[(0,p.jsx)("span",{className:v("error-icon"),children:(0,p.jsx)(s.A,{width:"24",height:"22"})}),g(T)]})}),(0,p.jsx)(o.l.Footer,{loading:!1,preset:"default",textButtonApply:d?c||b("button-retry"):void 0,textButtonCancel:b("button-close"),onClickButtonApply:()=>I(!0),onClickButtonCancel:h})]}):(0,p.jsxs)(n.Fragment,{children:[(0,p.jsx)(o.l.Header,{caption:t}),(0,p.jsxs)(o.l.Body,{className:v("body"),children:[(0,p.jsxs)("div",{className:v("body-message",{warning:!0}),children:[(0,p.jsx)("span",{className:v("warning-icon"),children:(0,p.jsx)(l.I,{data:r.A,size:24})}),a]}),u?(0,p.jsx)(i.S,{checked:N,onUpdate:S,children:b("checkbox-text")}):null]}),(0,p.jsx)(o.l.Footer,{loading:j,preset:"default",textButtonApply:b("button-confirm"),textButtonCancel:b("button-cancel"),propsButtonApply:{type:"submit",disabled:u&&!N},onClickButtonCancel:h,onClickButtonApply:()=>I()})]})})}},80420:(e,t,a)=>{a.d(t,{$:()=>v});var n=a(40336),s=a(63291),r=a(92459),i=a(31684),o=a(12888),l=a(71661),d=a(10508),c=a(25196),u=a(48372);const h=JSON.parse('{"field_links":"Links","context_developer-ui":"Developer UI"}'),b=(0,u.g4)("ydb-tablet-name-wrapper",{en:h});var p=a(60712);function v({tabletId:e,database:t}){const a=(0,o.X)(),u=(0,r.DM)(e,{database:t});return(0,p.jsx)(l.s,{disabled:!a,delayClosing:200,content:(0,p.jsx)(n.u,{responsive:!0,children:(0,p.jsx)(n.u.Item,{name:b("field_links"),children:(0,p.jsx)(c.K,{title:b("context_developer-ui"),url:(0,i._t)(e)})})}),placement:["top","bottom"],behavior:s.m.Immediate,children:(0,p.jsx)(d.c,{name:e.toString(),path:u,hasClipboardButton:!0,showStatus:!1})})}},88616:(e,t,a)=>{a.d(t,{Q:()=>A});var n=a(59284),s=a(76938),r=a(98089),i=a(99991),o=a(67087),l=a(22983),d=a(28539),c=a(10508),u=a(44508),h=a(44294),b=a(17594),p=a(41775),v=a(89073),g=a(80420),m=a(27775),x=a(41826),y=a(21545),j=a(6354),w=a(76086),T=a(12888),f=a(29819),N=a(48372);const S=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill-header":"Restart tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet","controls.search-placeholder":"Tablet ID","controls.entities-count-label":"Tablets"}'),I=(0,N.g4)("ydb-tablets",{en:S});var C=a(60712);function k(e){const t=e.State===j.r.Stopped,a=(0,T.X)(),[n]=y.X.useKillTabletMutation(),r=e.TabletId;return r?(0,C.jsx)(l.B,{buttonView:"outlined",buttonTitle:I("dialog.kill-header"),dialogHeader:I("dialog.kill-header"),dialogText:I("dialog.kill-text"),onConfirmAction:()=>n({id:r}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:I(a?"dialog.kill-header":"controls.kill-not-allowed"),popoverPlacement:["right","auto"],popoverDisabled:!1,children:(0,C.jsx)(i.I,{data:s.A})}):null}function A({database:e,tablets:t,loading:a,error:s}){const[{tabletsSearch:i},l]=(0,o.useQueryParams)({tabletsSearch:o.StringParam}),y=n.useMemo((()=>function({database:e}){return[{name:"Type",width:150,get header(){return I("Type")},render:({row:e})=>{const t=!1===e.Leader;return(0,C.jsxs)("span",{children:[e.Type," ",t?(0,C.jsx)(r.E,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return I("Tablet")},render:({row:t})=>t.TabletId?(0,C.jsx)(g.$,{tabletId:t.TabletId,database:e}):w.Pd},{name:"State",get header(){return I("State")},render:({row:e})=>(0,C.jsx)(m.i,{state:e.State})},{name:"NodeId",get header(){return I("Node ID")},render:({row:e})=>{const t=void 0===e.NodeId?void 0:(0,f.vI)(e.NodeId);return(0,C.jsx)(h.E,{to:t,children:e.NodeId})},align:"right"},{name:"fqdn",get header(){return I("Node FQDN")},render:({row:e})=>e.fqdn?(0,C.jsx)(c.c,{name:e.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,C.jsx)("span",{children:"\u2014"})},{name:"Generation",get header(){return I("Generation")},align:"right"},{name:"Uptime",get header(){return I("Uptime")},render:({row:e})=>(0,C.jsx)(x.H,{ChangeTime:e.ChangeTime}),sortAccessor:e=>-Number(e.ChangeTime),align:"right",width:120},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:({row:e})=>(0,C.jsx)(k,{...e})}]}({database:e})),[e]),j=n.useMemo((()=>t.filter((e=>String(e.TabletId).includes(null!==i&&void 0!==i?i:"")))),[t,i]);return(0,C.jsxs)(v.L,{children:[(0,C.jsxs)(v.L.Controls,{children:[(0,C.jsx)(p.v,{placeholder:I("controls.search-placeholder"),onChange:e=>{l({tabletsSearch:e||void 0},"replaceIn")},value:null!==i&&void 0!==i?i:"",width:238}),(0,C.jsx)(d.T,{label:I("controls.entities-count-label"),loading:a,total:t.length,current:j.length})]}),s?(0,C.jsx)(u.o,{error:s}):null,(0,C.jsx)(v.L.Table,{loading:a,children:(0,C.jsx)(b.l,{columns:y,data:j,settings:w.N3,emptyDataMessage:I("noTabletsData")})})]})}},89954:(e,t,a)=>{a.d(t,{O:()=>I});var n=a(59284),s=a(45720),r=a(16929),i=a(71153),o=a(18677),l=a(84476),d=a(33705),c=a(67884),u=a(99991),h=a(77506),b=a(48372);const p=JSON.parse('{"default_collapse_label":"Show less","default_expand_label":"Show more","chars_count":[" ({{count}} symbol)"," ({{count}} symbols)"," ({{count}} symbols)"," ({{count}} symbols)"]}'),v=JSON.parse('{"default_collapse_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435","default_expand_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0435\u0449\u0451","chars_count":[" ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u0430)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"]}'),g=(0,b.g4)("ydb-shorty-string",{ru:v,en:p});var m=a(60712);const x=(0,h.cn)("kv-shorty-string");function y({value:e="",limit:t=200,strict:a=!1,displayLength:s=!0,render:r=e=>e,onToggle:i,expandLabel:o=g("default_expand_label"),collapseLabel:l=g("default_collapse_label")}){const[d,u]=n.useState(!1),h=(d?l:o)+(s&&!d?g("chars_count",{count:e.length}):""),b=e.length>t+(a?0:h.length),p=d||!b?e:e.slice(0,t-4)+"\xa0...";return(0,m.jsxs)("div",{className:x(),children:[r(p),b?(0,m.jsx)(c.N,{className:x("toggle"),href:"#",onClick:e=>{e.stopPropagation(),e.preventDefault(),u((e=>!e)),null===i||void 0===i||i()},children:h}):null]})}var j=a(41650);const w=["S_FATAL","S_ERROR","S_WARNING","S_INFO"];function T(e){return function(e){return!!e&&void 0!==w[e]}(e)?w[e]:"S_INFO"}const f=(0,h.cn)("kv-result-issues"),N=(0,h.cn)("kv-issues"),S=(0,h.cn)("kv-issue");function I({data:e,hideSeverity:t}){const[a,s]=n.useState(!1),r="string"===typeof e||null===e||void 0===e?void 0:e.issues,i=Array.isArray(r)&&r.length>0;return(0,m.jsxs)("div",{className:f(),children:[(0,m.jsxs)("div",{className:f("error-message"),children:[(()=>{let a;if("string"===typeof e)a=e;else{var s,r;const i=T(null===e||void 0===e||null===(s=e.error)||void 0===s?void 0:s.severity);a=(0,m.jsxs)(n.Fragment,{children:[t?null:(0,m.jsxs)(n.Fragment,{children:[(0,m.jsx)(B,{severity:i})," "]}),(0,m.jsx)("span",{className:f("error-message-text"),children:null===e||void 0===e||null===(r=e.error)||void 0===r?void 0:r.message})]})}return a})(),i&&(0,m.jsx)(l.$,{view:"normal",onClick:()=>s(!a),children:a?"Hide details":"Show details"})]}),i&&a&&(0,m.jsx)(C,{hideSeverity:t,issues:r})]})}function C({issues:e,hideSeverity:t}){const a=null===e||void 0===e?void 0:e.reduce(((e,t)=>{var a;const n=null!==(a=t.severity)&&void 0!==a?a:10;return Math.min(e,n)}),10);return(0,m.jsx)("div",{className:N(null),children:null===e||void 0===e?void 0:e.map(((e,n)=>(0,m.jsx)(k,{hideSeverity:t,issue:e,expanded:e===a},n)))})}function k({issue:e,hideSeverity:t,level:a=0}){const[s,r]=n.useState(!0),i=T(e.severity),o=e.issues,c=Array.isArray(o)&&o.length>0,u=s?"bottom":"right";return(0,m.jsxs)("div",{className:S({leaf:!c,"has-issues":c}),children:[(0,m.jsxs)("div",{className:S("line"),children:[c&&(0,m.jsx)(l.$,{view:"flat-secondary",onClick:()=>r(!s),className:S("arrow-toggle"),children:(0,m.jsx)(d.I,{direction:u,size:16})}),t?null:(0,m.jsx)(B,{severity:i}),(0,m.jsx)(A,{issue:e}),e.issue_code?(0,m.jsxs)("span",{className:S("code"),children:["Code: ",e.issue_code]}):null]}),c&&s&&(0,m.jsx)("div",{className:S("issues"),children:(0,m.jsx)(_,{issues:o,level:a+1,expanded:s})})]})}function A({issue:e}){var t;const a=function(e){const{position:t}=e;if("object"!==typeof t||null===t||!(0,j.kf)(t.row))return"";const{row:a,column:n}=t;return(0,j.kf)(n)?`${a}:${n}`:`line ${a}`}(e),n=window.ydbEditor,s=()=>(0,m.jsxs)("span",{className:S("message"),children:[a&&(0,m.jsx)("span",{className:S("place-text"),title:"Position",children:a}),(0,m.jsx)("div",{className:S("message-text"),children:(0,m.jsx)(y,{value:e.message,expandLabel:"Show full message"})})]}),{row:r,column:i}=null!==(t=e.position)&&void 0!==t?t:{};if(!((0,j.kf)(r)&&n))return s();return(0,m.jsx)(c.N,{href:"#",extraProps:{draggable:!1},onClick:()=>{const e={lineNumber:r,column:null!==i&&void 0!==i?i:0};n.setPosition(e),n.revealPositionInCenterIfOutsideViewport(e),n.focus()},view:"primary",children:s()})}function _(e){const{issues:t,level:a,expanded:n}=e;return(0,m.jsx)("div",{className:S("list"),children:t.map(((e,t)=>(0,m.jsx)(k,{issue:e,level:a,expanded:n},t)))})}const F={S_INFO:s.A,S_WARNING:r.A,S_ERROR:i.A,S_FATAL:o.A},D=(0,h.cn)("yql-issue-severity");function B({severity:e}){const t=e.slice(2).toLowerCase();return(0,m.jsxs)("span",{className:D({severity:t}),children:[(0,m.jsx)(u.I,{className:D("icon"),data:F[e]}),(0,m.jsx)("span",{className:D("title"),children:t})]})}}}]);