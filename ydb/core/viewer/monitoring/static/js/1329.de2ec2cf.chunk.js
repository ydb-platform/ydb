"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[1329],{22983:(e,t,a)=>{a.d(t,{B:()=>d});var n=a(59284),s=a(84476),r=a(84375),i=a(55974),o=a(42829),l=a(60712);function d({children:e,onConfirmAction:t,onConfirmActionSuccess:a,dialogHeader:d,dialogText:c,retryButtonText:u,buttonDisabled:h=!1,buttonView:b="action",buttonTitle:p,buttonClassName:m,withPopover:v=!1,popoverContent:g,popoverPlacement:y="right",popoverDisabled:x=!0}){const[w,j]=n.useState(!1),[f,T]=n.useState(!1),[N,S]=n.useState(!1),C=()=>(0,l.jsx)(s.$,{onClick:()=>j(!0),view:b,disabled:h,loading:!h&&f,className:m,title:p,children:e});return(0,l.jsxs)(n.Fragment,{children:[(0,l.jsx)(i.g,{visible:w,header:d,text:c,withRetry:N,retryButtonText:u,onConfirm:async e=>{T(!0),await t(e)},onConfirmActionSuccess:async()=>{S(!1);try{await(null===a||void 0===a?void 0:a())}finally{T(!1)}},onConfirmActionError:e=>{S((0,o.D)(e)),T(!1)},onClose:()=>{j(!1)}}),v?(0,l.jsx)(r.A,{content:g,placement:y,disabled:x,children:C()}):C()]})}},55974:(e,t,a)=>{a.d(t,{g:()=>g});var n=a(59284),s=a(18677),r=a(71153),i=a(74321),o=a(2198),l=a(99991),d=a(89954),c=a(77506),u=a(48372);const h=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),b=(0,u.g4)("ydb-critical-action-dialog",{en:h});var p=a(60712);const m=(0,c.cn)("ydb-critical-dialog"),v=e=>e.data&&"issues"in e.data&&e.data.issues?(0,p.jsx)(d.O,{hideSeverity:!0,data:e.data}):403===e.status?b("no-rights-error"):e.statusText?e.statusText:b("default-error");function g({visible:e,header:t,text:a,withRetry:d,retryButtonText:c,withCheckBox:u,onClose:h,onConfirm:g,onConfirmActionSuccess:y,onConfirmActionError:x}){const[w,j]=n.useState(!1),[f,T]=n.useState(),[N,S]=n.useState(!1),C=async e=>(j(!0),g(e).then((()=>{y(),h()})).catch((e=>{x(e),T(e)})).finally((()=>{j(!1)})));return(0,p.jsx)(o.l,{open:e,hasCloseButton:!1,className:m(),size:"s",onClose:h,onTransitionExited:()=>{T(void 0),S(!1)},children:f?(0,p.jsxs)(n.Fragment,{children:[(0,p.jsx)(o.l.Header,{caption:t}),(0,p.jsx)(o.l.Body,{className:m("body"),children:(0,p.jsxs)("div",{className:m("body-message",{error:!0}),children:[(0,p.jsx)("span",{className:m("error-icon"),children:(0,p.jsx)(s.A,{width:"24",height:"22"})}),v(f)]})}),(0,p.jsx)(o.l.Footer,{loading:!1,preset:"default",textButtonApply:d?c||b("button-retry"):void 0,textButtonCancel:b("button-close"),onClickButtonApply:()=>C(!0),onClickButtonCancel:h})]}):(0,p.jsxs)(n.Fragment,{children:[(0,p.jsx)(o.l.Header,{caption:t}),(0,p.jsxs)(o.l.Body,{className:m("body"),children:[(0,p.jsxs)("div",{className:m("body-message",{warning:!0}),children:[(0,p.jsx)("span",{className:m("warning-icon"),children:(0,p.jsx)(l.I,{data:r.A,size:24})}),a]}),u?(0,p.jsx)(i.S,{checked:N,onUpdate:S,children:b("checkbox-text")}):null]}),(0,p.jsx)(o.l.Footer,{loading:w,preset:"default",textButtonApply:b("button-confirm"),textButtonCancel:b("button-cancel"),propsButtonApply:{type:"submit",disabled:u&&!N},onClickButtonCancel:h,onClickButtonApply:()=>C()})]})})}},42829:(e,t,a)=>{a.d(t,{D:()=>n});const n=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},52248:(e,t,a)=>{a.d(t,{a:()=>n.a});var n=a(47334)},17594:(e,t,a)=>{a.d(t,{l:()=>d});var n=a(69024),s=a(4557),r=a(77506),i=a(16819),o=a(60712);const l=(0,r.cn)("ydb-resizeable-data-table");function d({columnsWidthLSKey:e,columns:t,settings:a,wrapperClassName:r,...d}){const[c,u]=(0,i.a)(e),h=(0,n.j)(t,c),b={...a,defaultResizeable:!0};return(0,o.jsx)("div",{className:l(null,r),children:(0,o.jsx)(s.Ay,{theme:"yandex-cloud",columns:h,onResize:u,settings:b,...d})})}},80420:(e,t,a)=>{a.d(t,{$:()=>v});var n=a(40336),s=a(63291),r=a(92459),i=a(78668),o=a(31684),l=a(90182),d=a(71661),c=a(10508),u=a(25196),h=a(48372);const b=JSON.parse('{"field_links":"Links","context_developer-ui":"Developer UI"}'),p=(0,h.g4)("ydb-tablet-name-wrapper",{en:b});var m=a(60712);function v({tabletId:e,database:t}){const a=(0,l.N4)(i._5),h=(0,r.DM)(e,{database:t});return(0,m.jsx)(d.s,{disabled:!a,delayClosing:200,content:(0,m.jsx)(n.u,{responsive:!0,children:(0,m.jsx)(n.u.Item,{name:p("field_links"),children:(0,m.jsx)(u.K,{title:p("context_developer-ui"),url:(0,o._t)(e)})})}),placement:["top","bottom"],behavior:s.m.Immediate,children:(0,m.jsx)(c.c,{name:e.toString(),path:h,hasClipboardButton:!0,showStatus:!1})})}},27775:(e,t,a)=>{a.d(t,{i:()=>i});var n=a(47665),s=a(58267),r=a(60712);function i({state:e}){return(0,r.jsx)(n.J,{theme:(0,s._)(e),children:e})}},88616:(e,t,a)=>{a.d(t,{Q:()=>C});var n=a(76938),s=a(98089),r=a(99991),i=a(22983),o=a(10508),l=a(44294),d=a(17594),c=a(19228),u=a(80420),h=a(27775),b=a(41826),p=a(78668),m=a(21545),v=a(6354),g=a(76086),y=a(90182),x=a(29819),w=a(48372);const j=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill-header":"Restart tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet"}'),f=(0,w.g4)("ydb-tablets",{en:j});var T=a(60712);function N({database:e}){return[{name:"Type",width:150,get header(){return f("Type")},render:({row:e})=>{const t=!1===e.Leader;return(0,T.jsxs)("span",{children:[e.Type," ",t?(0,T.jsx)(s.E,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return f("Tablet")},render:({row:t})=>t.TabletId?(0,T.jsx)(u.$,{tabletId:t.TabletId,database:e}):g.Pd},{name:"State",get header(){return f("State")},render:({row:e})=>(0,T.jsx)(h.i,{state:e.State})},{name:"NodeId",get header(){return f("Node ID")},render:({row:e})=>{const t=void 0===e.NodeId?void 0:(0,x.vI)(e.NodeId);return(0,T.jsx)(l.E,{to:t,children:e.NodeId})},align:"right"},{name:"fqdn",get header(){return f("Node FQDN")},render:({row:e})=>e.fqdn?(0,T.jsx)(o.c,{name:e.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,T.jsx)("span",{children:"\u2014"})},{name:"Generation",get header(){return f("Generation")},align:"right"},{name:"Uptime",get header(){return f("Uptime")},render:({row:e})=>(0,T.jsx)(b.H,{ChangeTime:e.ChangeTime}),sortAccessor:e=>-Number(e.ChangeTime),align:"right",width:120},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:({row:e})=>(0,T.jsx)(S,{...e})}]}function S(e){const t=e.State===v.r.Stopped,a=(0,y.N4)(p._5),[s]=m.X.useKillTabletMutation(),o=e.TabletId;return o?(0,T.jsx)(i.B,{buttonView:"outlined",buttonTitle:f("dialog.kill-header"),dialogHeader:f("dialog.kill-header"),dialogText:f("dialog.kill-text"),onConfirmAction:()=>s({id:o}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:f(a?"dialog.kill-header":"controls.kill-not-allowed"),popoverPlacement:["right","auto"],popoverDisabled:!1,children:(0,T.jsx)(r.I,{data:n.A})}):null}function C({database:e,tablets:t,className:a,loading:n}){return n?(0,T.jsx)(c.Q,{}):(0,T.jsx)(d.l,{wrapperClassName:a,columns:N({database:e}),data:t,settings:g.N3,emptyDataMessage:f("noTabletsData")})}},89954:(e,t,a)=>{a.d(t,{O:()=>C});var n=a(59284),s=a(45720),r=a(16929),i=a(71153),o=a(18677),l=a(84476),d=a(33705),c=a(67884),u=a(99991),h=a(77506),b=a(48372);const p=JSON.parse('{"default_collapse_label":"Show less","default_expand_label":"Show more","chars_count":[" ({{count}} symbol)"," ({{count}} symbols)"," ({{count}} symbols)"," ({{count}} symbols)"]}'),m=JSON.parse('{"default_collapse_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435","default_expand_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0435\u0449\u0451","chars_count":[" ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u0430)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"]}'),v=(0,b.g4)("ydb-shorty-string",{ru:m,en:p});var g=a(60712);const y=(0,h.cn)("kv-shorty-string");function x({value:e="",limit:t=200,strict:a=!1,displayLength:s=!0,render:r=e=>e,onToggle:i,expandLabel:o=v("default_expand_label"),collapseLabel:l=v("default_collapse_label")}){const[d,u]=n.useState(!1),h=(d?l:o)+(s&&!d?v("chars_count",{count:e.length}):""),b=e.length>t+(a?0:h.length),p=d||!b?e:e.slice(0,t-4)+"\xa0...";return(0,g.jsxs)("div",{className:y(),children:[r(p),b?(0,g.jsx)(c.N,{className:y("toggle"),href:"#",onClick:e=>{e.stopPropagation(),e.preventDefault(),u((e=>!e)),null===i||void 0===i||i()},children:h}):null]})}var w=a(41650);const j=["S_FATAL","S_ERROR","S_WARNING","S_INFO"];function f(e){return function(e){return!!e&&void 0!==j[e]}(e)?j[e]:"S_INFO"}const T=(0,h.cn)("kv-result-issues"),N=(0,h.cn)("kv-issues"),S=(0,h.cn)("kv-issue");function C({data:e,hideSeverity:t}){const[a,s]=n.useState(!1),r="string"===typeof e||null===e||void 0===e?void 0:e.issues,i=Array.isArray(r)&&r.length>0;return(0,g.jsxs)("div",{className:T(),children:[(0,g.jsxs)("div",{className:T("error-message"),children:[(()=>{let a;if("string"===typeof e)a=e;else{var s,r;const i=f(null===e||void 0===e||null===(s=e.error)||void 0===s?void 0:s.severity);a=(0,g.jsxs)(n.Fragment,{children:[t?null:(0,g.jsxs)(n.Fragment,{children:[(0,g.jsx)(B,{severity:i})," "]}),(0,g.jsx)("span",{className:T("error-message-text"),children:null===e||void 0===e||null===(r=e.error)||void 0===r?void 0:r.message})]})}return a})(),i&&(0,g.jsx)(l.$,{view:"normal",onClick:()=>s(!a),children:a?"Hide details":"Show details"})]}),i&&a&&(0,g.jsx)(I,{hideSeverity:t,issues:r})]})}function I({issues:e,hideSeverity:t}){const a=null===e||void 0===e?void 0:e.reduce(((e,t)=>{var a;const n=null!==(a=t.severity)&&void 0!==a?a:10;return Math.min(e,n)}),10);return(0,g.jsx)("div",{className:N(null),children:null===e||void 0===e?void 0:e.map(((e,n)=>(0,g.jsx)(k,{hideSeverity:t,issue:e,expanded:e===a},n)))})}function k({issue:e,hideSeverity:t,level:a=0}){const[s,r]=n.useState(!0),i=f(e.severity),o=e.issues,c=Array.isArray(o)&&o.length>0,u=s?"bottom":"right";return(0,g.jsxs)("div",{className:S({leaf:!c,"has-issues":c}),children:[(0,g.jsxs)("div",{className:S("line"),children:[c&&(0,g.jsx)(l.$,{view:"flat-secondary",onClick:()=>r(!s),className:S("arrow-toggle"),children:(0,g.jsx)(d.I,{direction:u,size:16})}),t?null:(0,g.jsx)(B,{severity:i}),(0,g.jsx)(_,{issue:e}),e.issue_code?(0,g.jsxs)("span",{className:S("code"),children:["Code: ",e.issue_code]}):null]}),c&&s&&(0,g.jsx)("div",{className:S("issues"),children:(0,g.jsx)(A,{issues:o,level:a+1,expanded:s})})]})}function _({issue:e}){var t;const a=function(e){const{position:t}=e;if("object"!==typeof t||null===t||!(0,w.kf)(t.row))return"";const{row:a,column:n}=t;return(0,w.kf)(n)?`${a}:${n}`:`line ${a}`}(e),n=window.ydbEditor,s=()=>(0,g.jsxs)("span",{className:S("message"),children:[a&&(0,g.jsx)("span",{className:S("place-text"),title:"Position",children:a}),(0,g.jsx)("div",{className:S("message-text"),children:(0,g.jsx)(x,{value:e.message,expandLabel:"Show full message"})})]}),{row:r,column:i}=null!==(t=e.position)&&void 0!==t?t:{};if(!((0,w.kf)(r)&&n))return s();return(0,g.jsx)(c.N,{href:"#",extraProps:{draggable:!1},onClick:()=>{const e={lineNumber:r,column:null!==i&&void 0!==i?i:0};n.setPosition(e),n.revealPositionInCenterIfOutsideViewport(e),n.focus()},view:"primary",children:s()})}function A(e){const{issues:t,level:a,expanded:n}=e;return(0,g.jsx)("div",{className:S("list"),children:t.map(((e,t)=>(0,g.jsx)(k,{issue:e,level:a,expanded:n},t)))})}const F={S_INFO:s.A,S_WARNING:r.A,S_ERROR:i.A,S_FATAL:o.A},D=(0,h.cn)("yql-issue-severity");function B({severity:e}){const t=e.slice(2).toLowerCase();return(0,g.jsxs)("span",{className:D({severity:t}),children:[(0,g.jsx)(u.I,{className:D("icon"),data:F[e]}),(0,g.jsx)("span",{className:D("title"),children:t})]})}},21545:(e,t,a)=>{a.d(t,{X:()=>s});var n=a(78034);const s=a(21334).F.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async({id:e,database:t},{signal:a})=>{try{const[s,r,i]=await Promise.all([window.api.viewer.getTablet({id:e,database:t},{signal:a}),window.api.viewer.getTabletHistory({id:e,database:t},{signal:a}),window.api.viewer.getNodesList({signal:a})]),o=(0,n.nN)(i),l=Object.keys(r).reduce(((e,t)=>{var a;const n=null===(a=r[t])||void 0===a?void 0:a.TabletStateInfo;if(n&&n.length){var s;const a=n.find((e=>e.Leader))||n[0],{ChangeTime:r,Generation:i,State:l,Leader:d,FollowerId:c}=a,u=o&&t?null===(s=o.get(Number(t)))||void 0===s?void 0:s.Host:void 0;"Dead"!==l&&e.push({nodeId:t,generation:i,changeTime:r,state:l,leader:d,followerId:c,fqdn:u})}return e}),[]),{TabletStateInfo:d=[]}=s,[c={}]=d,{TabletId:u}=c;return{data:{id:u,data:c,history:l}}}catch(s){return{error:s}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async({tenantId:e},{signal:t})=>{try{const a=await window.api.viewer.getTabletDescribe(e,{signal:t}),{SchemeShard:n,PathId:s}=e;return{data:(null===a||void 0===a?void 0:a.Path)||`${n}:${s}`}}catch(a){return{error:a}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async({id:e,hiveId:t},{signal:a})=>{try{return{data:await window.api.tablets.getTabletFromHive({id:e,hiveId:t},{signal:a})}}catch(n){return{error:n}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async({id:e})=>{try{return{data:await window.api.tablets.killTablet(e)}}catch(t){return{error:t}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.stopTablet(e,t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.resumeTablet(e,t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})}}]);