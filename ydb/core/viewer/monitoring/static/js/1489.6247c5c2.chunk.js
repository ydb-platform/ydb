"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[1489],{3685:(e,i,s)=>{s.d(i,{$:()=>a});var t=s(77506),d=s(33775),o=s(60712);const n=(0,t.cn)("ydb-entity-page-title");function a({entityName:e,status:i,id:s,className:t}){return(0,o.jsxs)("div",{className:n(null,t),children:[(0,o.jsx)("span",{className:n("prefix"),children:e}),(0,o.jsx)(d.k,{className:n("icon"),status:i,size:"s"}),s]})}},42655:(e,i,s)=>{s.d(i,{y:()=>c});var t=s(59284),d=s(89169),o=s(77506),n=s(66781),a=s(60712);const l=(0,o.cn)("ydb-info-viewer-skeleton"),r=()=>(0,a.jsxs)("div",{className:l("label"),children:[(0,a.jsx)(d.E,{className:l("label__text")}),(0,a.jsx)("div",{className:l("label__dots")})]}),c=({rows:e=8,className:i,delay:s=600})=>{const[o]=(0,n.y)(s);let c=(0,a.jsxs)(t.Fragment,{children:[(0,a.jsx)(r,{}),(0,a.jsx)(d.E,{className:l("value")})]});return o||(c=null),(0,a.jsx)("div",{className:l(null,i),children:[...new Array(e)].map(((e,i)=>(0,a.jsx)("div",{className:l("row"),children:c},`skeleton-row-${i}`)))})}},58389:(e,i,s)=>{s.d(i,{B:()=>c});var t=s(87184),d=s(77506),o=s(90053),n=s(70043),a=s(60712);const l=(0,d.cn)("ydb-page-meta");function r({items:e,loading:i}){return(0,a.jsx)("div",{className:l("info"),children:i?(0,a.jsx)(n.E,{className:l("skeleton")}):e.filter((e=>Boolean(e))).join("\xa0\xa0\xb7\xa0\xa0")})}function c({className:e,...i}){return(0,a.jsxs)(t.s,{gap:1,alignItems:"center",justifyContent:"space-between",className:l(null,e),children:[(0,a.jsx)(r,{...i}),(0,a.jsx)(o.E,{})]})}},70043:(e,i,s)=>{s.d(i,{E:()=>n});var t=s(89169),d=s(66781),o=s(60712);const n=({delay:e=600,className:i})=>{const[s]=(0,d.y)(e);return s?(0,o.jsx)(t.E,{className:i}):null}},80208:(e,i,s)=>{s.r(i),s.d(i,{VDiskPage:()=>E});var t=s(59284);const d=e=>t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),t.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.28 4.78a.75.75 0 0 0 0-1.06l-2.5-2.5a.75.75 0 1 0-1.06 1.06L6.94 3.5H1.75a.75.75 0 1 0 0 1.5h5.19L5.72 6.22a.75.75 0 1 0 1.06 1.06l2.5-2.5Zm-.06 3.94-2.5 2.5a.75.75 0 0 0 0 1.06l2.5 2.5a.75.75 0 1 0 1.06-1.06L9.06 12.5h5.19a.75.75 0 0 0 0-1.5H9.06l1.22-1.22a.75.75 0 1 0-1.06-1.06ZM14 4.25a1.75 1.75 0 1 1-3.5 0 1.75 1.75 0 0 1 3.5 0ZM3.75 13.5a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5Z",clipRule:"evenodd"}));var o=s(99991),n=s(44992),a=s(61750),l=s(67087),r=s(22983),c=s(3685),v=s(44508),u=s(42655),k=s(58389),D=s(67440),g=s(21334),p=s(78668),m=s(67028),I=s(40174),f=s(7187),x=s(27295),N=s(78034);const h=g.F.injectEndpoints({endpoints:e=>({getVDiskData:e.query({queryFn:async({nodeId:e,pDiskId:i,vDiskSlotId:s},{signal:t})=>{try{const d=await Promise.all([window.api.viewer.getVDiskInfo({nodeId:e,pDiskId:i,vDiskSlotId:s},{signal:t}),window.api.viewer.getNodeWhiteboardPDiskInfo({nodeId:e,pDiskId:i},{signal:t}),window.api.viewer.getNodeInfo(e,{signal:t})]);return{data:function([e,i,s]){var t,d,o,n,a,l,r;const c=null===(t=e.VDiskStateInfo)||void 0===t?void 0:t[0],v=(0,x.WT)(c),u=null===(d=i.PDiskStateInfo)||void 0===d?void 0:d[0],k=(0,x.or)(u),D=null===(o=s.SystemStateInfo)||void 0===o?void 0:o[0],g=(0,N.q1)(D),p=null!==(n=null!==(a=v.NodeId)&&void 0!==a?a:k.NodeId)&&void 0!==n?n:g.NodeId,m=g.Host,I=null===(l=g.Roles)||void 0===l?void 0:l[0],f=g.DC,h=null!==(r=v.PDiskId)&&void 0!==r?r:k.PDiskId,y=k.Type;return{...v,NodeId:p,NodeHost:m,NodeType:I,NodeDC:f,PDiskId:h,PDiskType:y}}(d)}}catch(d){return{error:d}}},providesTags:(e,i,s)=>["All",{type:"VDiskData",id:(0,f.gh)(s.nodeId,s.pDiskId,s.vDiskSlotId)}]})}),overrideExisting:"throw"});var y=s(7435),w=s(77506),j=s(90182),b=s(41122),S=s(48372);const $=JSON.parse('{"fqdn":"FQDN","node":"Node","pdisk":"PDisk","vdisk":"VDisk","storage":"Storage","evict-vdisk-button":"Evict VDisk","force-evict-vdisk-button":"Evict anyway","evict-vdisk-dialog-header":"Evict VDisk","evict-vdisk-dialog-text":"VDisk will be evicted. Do you want to proceed?","evict-vdisk-not-allowed":"You don\'t have enough rights to evict VDisk"}'),P=(0,S.g4)("ydb-vDisk-page",{en:$});var V=s(60712);const T=(0,w.cn)("ydb-vdisk-page");function E(){const e=(0,j.YQ)(),i=t.useRef(null),s=(0,j.N4)(p._5),x=(0,m.c2)(),[{nodeId:N,pDiskId:w,vDiskSlotId:S}]=(0,l.useQueryParams)({nodeId:l.StringParam,pDiskId:l.StringParam,vDiskSlotId:l.StringParam});t.useEffect((()=>{e((0,I.g)("vDisk",{nodeId:N,pDiskId:w,vDiskSlotId:S}))}),[e,N,w,S]);const[$]=(0,j.Nt)(),E=(0,y.f8)(N)&&(0,y.f8)(w)&&(0,y.f8)(S)?{nodeId:N,pDiskId:w,vDiskSlotId:S}:n.hT,{currentData:C={},isFetching:_,error:B}=h.useGetVDiskDataQuery(E,{pollingInterval:$}),F=_&&void 0===C,{NodeHost:R,NodeId:H,NodeType:q,NodeDC:G,PDiskId:M,PDiskType:Y,Severity:A,VDiskId:Q}=C,{GroupID:Z,GroupGeneration:L,Ring:O,Domain:W,VDisk:z}=Q||{},J=(0,y.f8)(Z)&&(0,y.f8)(L)&&(0,y.f8)(O)&&(0,y.f8)(W)&&(0,y.f8)(z),X=async e=>{if(J)return(x?window.api.vdisk.evictVDisk:window.api.tablets.evictVDiskOld)({groupId:Z,groupGeneration:L,failRealmIdx:O,failDomainIdx:W,vDiskIdx:z,force:e}).then((e=>{if(!1===(null===e||void 0===e?void 0:e.result)){throw{statusText:e.error,retryPossible:e.forceRetryPossible}}}))},K=()=>{e(g.F.util.invalidateTags([{type:"VDiskData",id:(0,f.gh)(N||0,w||0,S||0)},"StorageData"]))};return(0,V.jsxs)("div",{className:T(null),ref:i,children:[(()=>{const e=S?`${P("vdisk")} ${S}`:P("vdisk"),i=w?`${P("pdisk")} ${w}`:P("pdisk"),s=R||P("node");return(0,V.jsx)(a.mg,{titleTemplate:`%s - ${e} - ${i} \u2014 ${s} \u2014 YDB Monitoring`,defaultTitle:`${e} - ${i} \u2014 ${s} \u2014 YDB Monitoring`})})(),(()=>{const e=R?`${P("fqdn")}: ${R}`:void 0,i=H?`${P("node")}: ${H}`:void 0,s=H?`${P("pdisk")}: ${M}`:void 0;return(0,V.jsx)(k.B,{className:T("meta"),loading:F,items:[e,i,q,G,s,Y]})})(),(0,V.jsx)(c.$,{className:T("title"),entityName:P("vdisk"),status:(0,f.XY)(A),id:null===C||void 0===C?void 0:C.StringifiedId}),(0,V.jsx)("div",{className:T("controls"),children:(0,V.jsxs)(r.B,{onConfirmAction:X,onConfirmActionSuccess:K,buttonDisabled:!J||!s,buttonView:"normal",dialogHeader:P("evict-vdisk-dialog-header"),dialogText:P("evict-vdisk-dialog-text"),retryButtonText:P("force-evict-vdisk-button"),withPopover:!0,popoverContent:P("evict-vdisk-not-allowed"),popoverDisabled:s,children:[(0,V.jsx)(o.I,{data:d}),P("evict-vdisk-button")]})}),F?(0,V.jsx)(u.y,{rows:20}):(0,V.jsxs)(t.Fragment,{children:[B?(0,V.jsx)(v.o,{error:B}):null,(0,V.jsx)(D.E,{data:C,className:T("info")}),(0,y.f8)(Z)&&(0,y.f8)(N)?(0,V.jsxs)(t.Fragment,{children:[(0,V.jsx)("div",{className:T("storage-title"),children:P("storage")}),(0,V.jsx)(b.p,{groupId:Z,nodeId:N,pDiskId:null!==w&&void 0!==w?w:void 0,vDiskSlotId:null!==S&&void 0!==S?S:void 0,parentRef:i})]}):null]})]})}}}]);