(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[163],{14659:(e,t,a)=>{"use strict";a.d(t,{U:()=>y});var n=a(68963),r=a(17176),s=a(68330),o=a(76506),i=a(71586),l=a(25822),c=a(88776),d=a(24362),u=a(30817);const m=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-cancel":"Cancel","button-close":"Close"}'),p=(0,u.wZ)("ydb-critical-action-dialog",{en:m});var h=a(75859);const v=(0,d.cn)("ydb-critical-dialog"),g=e=>403===e.status?p("no-rights-error"):e.statusText?e.statusText:p("default-error");function x(e){let{visible:t,text:a,onClose:r,onConfirm:s,onConfirmActionSuccess:d,onConfirmActionError:u}=e;const[m,x]=n.useState(!1),[y,b]=n.useState(),S=async e=>(e.preventDefault(),x(!0),s().then((()=>{d(),r()})).catch((e=>{u(),b(e)})).finally((()=>{x(!1)})));return(0,h.jsx)(l.V,{open:t,hasCloseButton:!1,className:v(),size:"s",onClose:r,onTransitionExited:()=>b(void 0),children:y?(0,h.jsxs)(n.Fragment,{children:[(0,h.jsxs)(l.V.Body,{className:v("body"),children:[(0,h.jsx)("span",{className:v("error-icon"),children:(0,h.jsx)(o.Z,{width:"24",height:"22"})}),g(y)]}),(0,h.jsx)(l.V.Footer,{loading:!1,preset:"default",textButtonCancel:p("button-close"),onClickButtonCancel:r})]}):(0,h.jsxs)("form",{onSubmit:S,children:[(0,h.jsxs)(l.V.Body,{className:v("body"),children:[(0,h.jsx)("span",{className:v("warning-icon"),children:(0,h.jsx)(c.J,{data:i.Z,size:24})}),a]}),(0,h.jsx)(l.V.Footer,{loading:m,preset:"default",textButtonApply:p("button-confirm"),textButtonCancel:p("button-cancel"),propsButtonApply:{type:"submit"},onClickButtonCancel:r,onClickButtonApply:()=>{}})]})})}function y(e){let{children:t,onConfirmAction:a,onConfirmActionSuccess:o,dialogContent:i,buttonDisabled:l=!1,buttonView:c="action",buttonClassName:d,withPopover:u=!1,popoverContent:m,popoverPlacement:p="right",popoverDisabled:v=!0}=e;const[g,y]=n.useState(!1),[b,S]=n.useState(!1),j=()=>(0,h.jsx)(r.z,{onClick:()=>y(!0),view:c,disabled:l,loading:!l&&b,className:d,children:t});return(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)(x,{visible:g,text:i,onConfirm:async()=>{S(!0),await a(),S(!1)},onConfirmActionSuccess:async()=>{if(o){S(!0);try{await o()}catch{}finally{S(!1)}}},onConfirmActionError:()=>{S(!1)},onClose:()=>{y(!1)}}),u?(0,h.jsx)(s.J,{content:m,placement:p,disabled:v,children:j()}):j()]})}},58682:(e,t,a)=>{"use strict";a.d(t,{T:()=>c});var n=a(39683),r=a(17176),s=a(88776),o=a(24362),i=a(75859);const l=(0,o.cn)("developer-ui-link");function c(e){let{href:t,visible:a=!1,className:o}=e;return(0,i.jsx)(r.z,{size:"s",href:t,className:l({visible:a},o),target:"_blank",children:(0,i.jsx)(s.J,{data:n.Z})})}},66809:(e,t,a)=>{"use strict";a.d(t,{J:()=>A});var n=a(66950),r=a(10288),s=a(14979),o=a(88776),i=a(17095),l=a(14659),c=a(58682),d=a(69214),u=a(26688),m=a(74170),p=a(2098),h=a(22692),v=a(54665),g=a(27102),x=a(99399),y=a(28164),b=a(24362),S=a(52317),j=a(4119),f=a(34051),T=a(83496),N=a(92398),w=a(30817);const E=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet"}'),C=(0,w.wZ)("ydb-tablets",{en:E});var I=a(75859);const P=(0,b.cn)("tablets"),D=[{name:"Type",get header(){return C("Type")},render:e=>{let{row:t}=e;return(0,I.jsxs)("span",{children:[t.Type," ",t.Leader?"":(0,I.jsx)(r.x,{color:"secondary",children:"follower"})]})}},{name:"TabletId",width:230,get header(){return C("Tablet")},render:e=>{var t;let{row:a}=e;const n=a.TabletId&&(0,v.ax)(v.ZP.tablet,{id:a.TabletId},{nodeId:a.NodeId,type:a.Type});return(0,I.jsx)(d.A,{name:null===(t=a.TabletId)||void 0===t?void 0:t.toString(),path:n,hasClipboardButton:!0,showStatus:!1,additionalControls:(0,I.jsx)(c.T,{href:"".concat(g.y3,"/tablets?TabletID=").concat(a.TabletId)})})}},{name:"State",get header(){return C("State")},render:e=>{let{row:t}=e;return(0,I.jsx)(s._,{theme:(0,T.KR)(t.State),children:t.State})}},{name:"NodeId",get header(){return C("Node ID")},render:e=>{let{row:t}=e;const a=void 0===t.NodeId?void 0:(0,N.a3)(t.NodeId);return(0,I.jsx)(m.h,{to:a,children:t.NodeId})},align:"right"},{name:"fqdn",get header(){return C("Node FQDN")},render:e=>{let{row:t}=e;return t.fqdn?(0,I.jsx)(d.A,{name:t.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,I.jsx)("span",{children:"\u2014"})}},{name:"Generation",get header(){return C("Generation")},align:"right"},{name:"Uptime",get header(){return C("Uptime")},render:e=>{let{row:t}=e;return(0,j.fG)(t.ChangeTime)},sortAccessor:e=>-Number(e.ChangeTime),align:"right"},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:e=>{let{row:t}=e;return(0,I.jsx)(R,{...t})}}];function R(e){const t=e.State===y.g.Stopped,a=(0,f.zL)(),{isUserAllowedToMakeChanges:r}=(0,f.ix)((e=>e.authentication));return(0,I.jsx)(l.U,{buttonView:"outlined",dialogContent:C("dialog.kill"),onConfirmAction:()=>window.api.killTablet(e.TabletId),onConfirmActionSuccess:()=>{a(x.zg.util.invalidateTags(["All"]))},buttonDisabled:t||!r,withPopover:!0,popoverContent:C("controls.kill-not-allowed"),popoverDisabled:r,children:(0,I.jsx)(o.J,{data:n.Z})})}function A(e){let{nodeId:t,path:a,className:n}=e;const[r]=(0,f.Rj)();let s={};const o=void 0===t?void 0:String(t);void 0!==o?s={nodes:[String(o)]}:a&&(s={path:a});const{currentData:l,isFetching:c,error:d}=x.zg.useGetTabletsInfoQuery(0===Object.keys(s).length?i.CN:s,{pollingInterval:r}),m=c&&void 0===l,v=(0,f.ix)((e=>(0,x.Sq)(e,s)));return m?(0,I.jsx)(h.h,{}):d?(0,I.jsx)(u.V,{error:d}):(0,I.jsx)("div",{className:P(null,n),children:(0,I.jsx)(p.G,{columns:D,data:v,settings:S.LE,emptyDataMessage:C("noTabletsData")})})}},23985:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Tenant:()=>em});var n=a(68963),r=a(49352),s=a(52846),o=a(86969),i=a(16670),l=a(93838),c=a(24362),d=a(75859);const u=(0,c.cn)("kv-split"),m=[0,100],p=[50,50];const h=function(e){const[t,a]=n.useState(),r=t=>{const{defaultSizePaneKey:a}=e;localStorage.setItem(a,t.join(","))};return n.useEffect((()=>{const{collapsedSizes:t,triggerCollapse:n}=e;if(n){const e=t||m;r(e),a(e)}}),[e.triggerCollapse]),n.useEffect((()=>{const{triggerExpand:t,defaultSizes:n}=e,s=n||p;t&&(r(s),a(s))}),[e.triggerExpand]),(0,d.jsx)(n.Fragment,{children:(0,d.jsx)(l.Z,{direction:e.direction||"horizontal",sizes:t||(()=>{var t;const{defaultSizePaneKey:a,defaultSizes:n=p,initialSizes:r}=e;if(r)return r;return(null===(t=localStorage.getItem(a))||void 0===t?void 0:t.split(",").map(Number))||n})(),minSize:e.minSize||[0,0],onDrag:t=>{const{onSplitDragAdditional:a}=e;a&&a(),r(t)},className:u(null,e.direction||"horizontal"),gutterSize:8,onDragStart:()=>{const{onSplitStartDragAdditional:t}=e;t&&t(),a(void 0)},expandToMin:!0,children:e.children})})};var v=a(79061),g=a(6748),x=a(52317),y=a(34051),b=a(64270),S=a(24015),j=a(8179),f=a(83203),T=a(50422),N=a(54665),w=a(8511),E=a(2418),C=a(48897),I=a(26688),P=a(93717),D=a(3027),R=a(4119),A=a(43832),L=a.n(A),_=a(27102);const O=(0,c.cn)("heatmap"),M={width:0,height:0},k=10,F=2,z=e=>{const[t,a]=n.useState(M),{tablets:r}=e,s=n.useRef(null),o=n.useRef(null);n.useEffect((()=>{const e=s.current,a=e.getContext("2d");a.clearRect(0,0,e.offsetWidth,e.offsetHeight),r.map(function(e){return(a,n)=>{const{columnsCount:r}=t,s=n%r*(k+F),o=Math.floor(n/r)*(k+F);e.fillStyle=a.color||"grey",e.fillRect(s,o,k,k)}}(a))})),n.useLayoutEffect((()=>{const e=o.current;if(e){const t=e.offsetWidth-15,n=Math.floor(t/(k+F)),s=Math.ceil(r.length/n);a({width:t,height:s*(k+F),columnsCount:n,rowsCount:s})}}),[]);const i=()=>{let e=s.current,t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t},l=()=>{let e=s.current,t=0;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t},c=(e,a)=>{const{columnsCount:n}=t,r=k+F,s=k+F,o=Math.floor(e/r);return n*Math.floor(a/s)+o},u=L()(((t,a)=>{const n=new CustomEvent("scroll");window.dispatchEvent(n);const s=e.parentRef.current,o=t-l()+s.scrollLeft,d=a-i()+s.scrollTop,u=c(o,d),m=r[u];if(m){const n={name:m.currentMetric,value:m.formattedValue};e.showTooltip(void 0,m,"tablet",n,{left:t-20,top:a-20})}else e.hideTooltip()}),20);return(0,d.jsx)("div",{ref:o,className:O("canvas-container"),onMouseLeave:()=>{setTimeout((()=>{e.hideTooltip()}),40)},children:(0,d.jsx)("canvas",{ref:s,width:t.width,height:t.height,onClick:t=>{const a=e.parentRef.current,n=t.clientX-l()+a.scrollLeft,s=t.clientY-i()+a.scrollTop,o=c(n,s),d=r[o];d&&window.open((e=>{const{TabletId:t}=e,a=window.location.hostname,n=(0,N.ax)(N.ZP.tablet,{id:t}),r=[a,_.EZ,n].map((e=>e.startsWith("/")?e.slice(1):e)).filter(Boolean).join("/");return"".concat("https://").concat(r)})(d),"_blank")},onMouseMove:e=>u(e.clientX,e.clientY)})})},q={r:255,g:4,b:0},U={r:255,g:219,b:77},G={r:59,g:201,b:53},B={CPU:{min:0,max:1e6},Network:{min:0,max:1e9},Storage:{min:0,max:2e9},DataSize:{min:0,max:2e9},RowCount:{min:0},IndexSize:{min:0}},Q=e=>{const t=e.toString(16);return 1===t.length?"0".concat(t):t},H=(e,t,a)=>{if(1===e)return[t];if(2===e)return[t,a];const n=(t.r-a.r)/(e-1),r=(t.g-a.g)/(e-1),s=(t.b-a.b)/(e-1),o=[];for(let i=0;i<e;i++)o.push({r:Math.round(t.r-n*i),g:Math.round(t.g-r*i),b:Math.round(t.b-s*i)});return o.map((e=>(e=>{let{r:t,g:a,b:n}=e;return"#".concat(Q(t)).concat(Q(a)).concat(Q(n))})(e)))},Z=e=>{const t=Math.floor(e/2),a=t+1;return[...H(e%2===0?t:t+1,G,U),...H(a,U,q).slice(1)]},V=(e,t)=>{const a=new Set,n=B[e]||{};t.forEach((t=>{var n;a.add(Number(null===(n=t.metrics)||void 0===n?void 0:n[e]))})),Number.isInteger(n.min)&&a.add(n.min),Number.isInteger(n.max)&&a.add(n.max);const r=Array.from(a.values()).sort(((e,t)=>e-t));return{min:r[0],max:r[r.length-1]}},W=(0,c.cn)("histogram"),J=e=>{const t=n.useRef(),{data:a={},maxCount:r}=e,{count:s,leftBound:o,rightBound:i,color:l}=a,c=s/r*100;return(0,d.jsx)("div",{ref:t,className:W("item"),style:{backgroundColor:l,height:"".concat(c,"%")},onMouseEnter:()=>{const a=t.current;e.showTooltip(a,{count:s,leftBound:o,rightBound:i},"histogram")},onMouseLeave:e.hideTooltip})},K=e=>{const{tablets:t,currentMetric:a}=e,{min:n,max:r}=V(a,t),s=Z(50),o=(r-n)/50,i=s.map(((e,t)=>({color:e,count:0,leftBound:(0,R.uf)(n+t*o),rightBound:(0,R.uf)(n+(t+1)*o)})));let l=0;t.forEach((e=>{var t,n;const r=a&&Number(null===(t=e.metrics)||void 0===t?void 0:t[a]),s=Math.floor(r/o),c=(null===(n=i[s])||void 0===n?void 0:n.count)+1;c>l&&(l=c),i[s]={...i[s],count:c}}));return(0,d.jsx)("div",{className:W(),children:(0,d.jsxs)("div",{className:W("chart"),children:[Boolean(r)&&i.map(((t,a)=>(0,d.jsx)(J,{data:t,maxCount:l,showTooltip:e.showTooltip,hideTooltip:e.hideTooltip},a))),(0,d.jsx)("div",{className:W("x-min"),children:(0,R.uf)(n)}),(0,d.jsx)("div",{className:W("x-max"),children:(0,R.uf)(r)}),(0,d.jsx)("div",{className:W("y-min"),children:"0"}),(0,d.jsx)("div",{className:W("y-max"),children:(0,R.uf)(l)})]})})},Y=(0,c.cn)("heatmap"),X=Z(500),$=e=>{let{path:t}=e;const a=(0,y.zL)(),r=n.createRef(),[s]=(0,y.Rj)(),{currentData:o,isFetching:l,error:c}=P.Vc.useGetHeatmapTabletsInfoQuery({path:t},{pollingInterval:s}),u=l&&void 0===o,{tablets:m=[],metrics:p}=o||{},{sort:h,heatmap:v,currentMetric:g}=(0,y.ix)((e=>e.heatmap)),x=function(){a((0,D.hJ)(...arguments))},b=()=>{a((0,D.i8)())},S=e=>{a((0,P.U_)({currentMetric:e[0]}))},j=()=>{a((0,P.U_)({sort:!h}))},f=()=>{a((0,P.U_)({heatmap:!v}))},T=()=>{const{min:e,max:t}=V(g,m),a=m.map((a=>{var n;const r=g&&Number(null===(n=a.metrics)||void 0===n?void 0:n[g]),s=((e,t,a)=>0===a?0:Math.round((e-t)/(a-t)*499))(r,e,t),o=X[s];return{...a,color:o,value:r,formattedValue:(0,R.uf)(r),currentMetric:g}})),n=h?a.sort(((e,t)=>Number(t.value)-Number(e.value))):a;return(0,d.jsx)("div",{ref:r,className:Y("items"),children:(0,d.jsx)(z,{tablets:n,parentRef:r,showTooltip:x,hideTooltip:b})})};return u?(0,d.jsx)(i.a,{}):c?(0,d.jsx)(I.V,{error:c}):(()=>{const{min:e,max:t}=V(g,m);return(0,d.jsxs)("div",{className:Y(),children:[(0,d.jsxs)("div",{className:Y("filters"),children:[(0,d.jsx)(E.P,{className:Y("heatmap-select"),value:g?[g]:[],options:p,onUpdate:S,width:200}),(0,d.jsx)("div",{className:Y("sort-checkbox"),children:(0,d.jsx)(C.X,{onUpdate:j,checked:h,children:"Sort"})}),(0,d.jsx)("div",{className:Y("histogram-checkbox"),children:(0,d.jsx)(C.X,{onUpdate:f,checked:v,children:"Heatmap"})}),(0,d.jsxs)("div",{className:Y("limits"),children:[(0,d.jsxs)("div",{className:Y("limits-block"),children:[(0,d.jsx)("div",{className:Y("limits-title"),children:"min:"}),(0,d.jsx)("div",{className:Y("limits-value"),children:Number.isInteger(e)?(0,R.uf)(e):"\u2014"})]}),(0,d.jsxs)("div",{className:Y("limits-block"),children:[(0,d.jsx)("div",{className:Y("limits-title"),children:"max:"}),(0,d.jsx)("div",{className:Y("limits-value"),children:Number.isInteger(t)?(0,R.uf)(t):"\u2014"})]}),(0,d.jsxs)("div",{className:Y("limits-block"),children:[(0,d.jsx)("div",{className:Y("limits-title"),children:"count:"}),(0,d.jsx)("div",{className:Y("limits-value"),children:(0,R.uf)(m.length)})]})]})]}),v?T():(0,d.jsx)(K,{tablets:m,currentMetric:g,showTooltip:x,hideTooltip:b})]})})()};var ee=a(2335),te=a(70885),ae=a(66809),ne=a(19812),re=a(17095),se=a(2098),oe=a(22692),ie=a(39623),le=a(905);function ce(e){return"SELECT * FROM `".concat(e,"` LIMIT 0")}const de=le.h.injectEndpoints({endpoints:e=>({getViewSchema:e.query({queryFn:async e=>{let{database:t,path:a}=e;try{const e=await window.api.sendQuery({schema:"modern",query:ce(a),database:t,action:"execute-scan"});return(0,ie.gW)(e)?{error:e}:{data:e.columns||[]}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var ue=a(6523),me=a(88776),pe=a(30817);const he=JSON.parse('{"column-title.id":"Id","column-title.name":"Name","column-title.key":"Key","column-title.type":"Type","column-title.notNull":"NotNull","column-title.autoIncrement":"AutoIncrement","column-title.family":"Family","column-title.media":"Media","column-title.compression":"Compression"}'),ve=(0,pe.wZ)("ydb-schema-viewer",{en:he}),ge=(0,c.cn)("schema-viewer");var xe;function ye(){return ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ye.apply(this,arguments)}const be=function(e){return n.createElement("svg",ye({viewBox:"0 0 12 7",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),xe||(xe=n.createElement("path",{d:"M8 7h3V5h1V2H6.66C6.085.79 4.86 0 3.5 0 1.57 0 0 1.57 0 3.5S1.57 7 3.5 7c1.36 0 2.59-.79 3.16-2H8v2zm2-1H9V4H5.97l-.115.335a2.5 2.5 0 110-1.67L5.97 3H11v1h-1v2zM3.5 5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zM3 3.5a.5.5 0 111 0 .5.5 0 01-1 0z"})))},Se="isKeyColumn",je="type",fe="notNull",Te="autoIncrement",Ne="familyName",we="prefferedPoolKind",Ee="columnCodec",Ce={name:"id",get header(){return ve("column-title.id")},width:60,render:e=>{let{row:t}=e;return t.id}},Ie={name:"name",get header(){return ve("column-title.name")},width:100,render:e=>{let{row:t}=e;return t.name}},Pe={name:Se,get header(){return ve("column-title.key")},width:70,resizeMinWidth:70,defaultOrder:ne.ZP.ASCENDING,sortAccessor:e=>e.keyAccessor,render:e=>{let{row:t}=e;return t.isKeyColumn?(0,d.jsx)("div",{className:ge("key-icon"),children:(0,d.jsx)(me.J,{data:be,width:12,height:7})}):null}},De={name:je,get header(){return ve("column-title.type")},width:100,render:e=>{let{row:t}=e;return t.type}},Re={name:fe,get header(){return ve("column-title.notNull")},width:100,defaultOrder:ne.ZP.DESCENDING,render:e=>{let{row:t}=e;if(t.notNull)return"\u2713"}},Ae={name:Te,get header(){return ve("column-title.autoIncrement")},width:100,defaultOrder:ne.ZP.DESCENDING,render:e=>{let{row:t}=e;if(t.autoIncrement)return"\u2713"}},Le={name:Ne,get header(){return ve("column-title.family")},width:100,render:e=>{let{row:t}=e;return t.familyName}},_e={name:we,get header(){return ve("column-title.media")},width:100,render:e=>{let{row:t}=e;return t.prefferedPoolKind}},Oe={name:Ee,get header(){return ve("column-title.compression")},width:100,render:e=>{let{row:t}=e;return t.columnCodec}};var Me=a(35638);function ke(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce(((t,a,n)=>({...t,[a]:n-e.length})),{})}function Fe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=function(e){var t,a,n;return null!==(t=null===e||void 0===e||null===(a=e.PartitionConfig)||void 0===a||null===(n=a.ColumnFamilies)||void 0===n?void 0:n.reduce(((e,t)=>t.Id?{...e,[t.Id]:t}:e),{}))&&void 0!==t?t:{}}(e),{Columns:a,KeyColumnIds:n}=e,r=ke(n);return(null===a||void 0===a?void 0:a.map((e=>{var a,s;const{Id:o,Name:i,NotNull:l,Type:c,Family:d,DefaultFromSequence:u}=e,m=Boolean(null===n||void 0===n?void 0:n.find((e=>e===o))),p=o&&r[o]?r[o]:1,h=d?t[d].Name:void 0,v=d?null===(a=t[d].StorageConfig)||void 0===a||null===(s=a.Data)||void 0===s?void 0:s.PreferredPoolKind:void 0,g=d?function(e){if(e)return e===Me.C6.ColumnCodecPlain?"None":e.replace("ColumnCodec","").toLocaleLowerCase()}(t[d].ColumnCodec):void 0;return{id:o,name:i,isKeyColumn:m,keyAccessor:p,type:c,notNull:l,autoIncrement:Boolean(u),familyName:h,prefferedPoolKind:v,columnCodec:g}})))||[]}function ze(e,t){const{Table:a,ColumnTableDescription:n,ExternalTableDescription:r}=(null===t||void 0===t?void 0:t.PathDescription)||{};return(0,ue.fd)(e)?Fe(a):(0,ue.Jp)(e)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{Schema:t={}}=e,{Columns:a,KeyColumnNames:n}=t,r=ke(n);return(null===a||void 0===a?void 0:a.map((e=>{const{Id:t,Name:a,Type:s,NotNull:o}=e,i=Boolean(null===n||void 0===n?void 0:n.find((e=>e===a))),l=a&&r[a]?r[a]:1;return{id:t,name:a,isKeyColumn:i,keyAccessor:l,type:s,notNull:o}})))||[]}(n):(0,ue.uL)(e)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{Columns:t}=e;return(null===t||void 0===t?void 0:t.map((e=>{const{Id:t,Name:a,Type:n,NotNull:r}=e;return{id:t,name:a,type:n,notNull:r}})))||[]}(r):[]}const qe=e=>{let{type:t,path:a,tenantName:r,extended:s=!1}=e;const{data:o,isLoading:i}=(0,g.hz)({path:a}),l=(0,ue.$J)(t)?{path:a,database:r}:re.CN,{data:c,isLoading:u}=de.useGetViewSchemaQuery(l),m=n.useMemo((()=>(0,ue.$J)(t)?function(e){return(null===e||void 0===e?void 0:e.map((e=>{var t;return{type:null!==(t=e.type)&&void 0!==t&&t.endsWith("?")?e.type.slice(0,-1):e.type,name:e.name}})))||[]}(c):ze(t,o)),[o,t,c]),p=n.useMemo((()=>m.some((e=>e.autoIncrement))),[m]),h=n.useMemo((()=>(0,ue.$J)(t)?[Ie,De]:(0,ue.uL)(t)?[Ce,Ie,De,Re]:(0,ue.Jp)(t)?[Ce,Pe,Ie,De,Re]:(0,ue.fd)(t)?function(e,t){const a=[Ce,Pe,Ie,De,Re];return e&&a.push(Le,_e,Oe),t&&a.push(Ae),a}(s,p):[]),[t,s,p]);return(0,d.jsx)("div",{className:ge(null),children:i||u?(0,d.jsx)(oe.h,{}):(0,d.jsx)(se.G,{columnsWidthLSKey:"schemaTableColumnsWidth",data:m,columns:h,settings:x.LE,initialSortOrder:{columnId:Se,order:ne.ZP.ASCENDING}})})};var Ue=a(95478),Ge=a(43680),Be=a.n(Ge),Qe=a(11551),He=a(36313),Ze=a(81854),Ve=a(1504);const We=le.h.injectEndpoints({endpoints:e=>({getTopic:e.query({queryFn:async e=>{try{const t=await window.api.getTopic(e);return"object"!==typeof t?{error:{}}:{data:t}}catch(t){return{error:t}}},providesTags:["All"]})}),overrideExisting:"throw"}),Je=(0,He.P1)((e=>e),(e=>We.endpoints.getTopic.select({path:e}))),Ke=(0,He.P1)((e=>e),((e,t)=>Je(t)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.topic_stats})),Ye=(0,He.P1)((e=>e),((e,t)=>Je(t)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.consumers})),Xe=(0,He.P1)(Ye,(e=>null===e||void 0===e?void 0:e.map((e=>null===e||void 0===e?void 0:e.name)).filter((e=>void 0!==e)))),$e=(0,He.P1)(Ke,(e=>{if(!e)return;const{store_size_bytes:t="0",min_last_write_time:a,max_write_time_lag:n,bytes_written:r}=e||{};return{storeSize:t,partitionsIdleTime:(0,Ve.lE)(a),partitionsWriteLag:(0,Ve.DA)(n),writeSpeed:(0,Ze.c4)(r)}})),et=(0,He.P1)(Ye,(e=>null===e||void 0===e?void 0:e.map((e=>{const{name:t,consumer_stats:a}=e||{},{min_partitions_last_read_time:n,max_read_time_lag:r,max_write_time_lag:s,bytes_read:o}=a||{};return{name:t,readSpeed:(0,Ze.c4)(o),writeLag:(0,Ve.DA)(s),readLag:(0,Ve.DA)(r),readIdleTime:(0,Ve.lE)(n)}}))));var tt=a(68330);const at=JSON.parse('{"averageSpeed":"Average speed","perMinute":"per minute","perHour":"per hour","perDay":"per day"}'),nt=JSON.parse('{"averageSpeed":"\u0421\u0440\u0435\u0434\u043d\u044f\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c","perMinute":"\u0437\u0430 \u043c\u0438\u043d\u0443\u0442\u0443","perHour":"\u0437\u0430 \u0447\u0430\u0441","perDay":"\u0437\u0430 \u0434\u0435\u043d\u044c"}'),rt=(0,pe.wZ)("ydb-components-speed-multimeter",{ru:nt,en:at}),st=(0,c.cn)("speed-multimeter"),ot=e=>{let{data:t,speedSize:a="kb",withValue:r=!0,withPopover:s=!0}=e;const{perMinute:o=0,perHour:i=0,perDay:l=0}=t||{},c=[o,i,l],u=e=>(0,Ze.td)({value:e,size:a,withSpeedLabel:!0}),m=[{value:u(o),label:rt("perMinute")},{value:u(i),label:rt("perHour")},{value:u(l),label:rt("perDay")}],[p,h]=n.useState(o),[v,g]=n.useState(r?0:void 0),[x,y]=n.useState(),b=(e,t)=>{h(e[t]),g(t),y(t)},S=e=>v===e,j=e=>x===e;return(0,d.jsx)("div",{className:st(),children:(0,d.jsxs)("div",{className:st("content"),children:[r&&(0,d.jsx)("div",{className:st("displayed-value"),children:u(p)}),(0,d.jsx)(tt.J,{content:(0,d.jsxs)("div",{className:st("popover-content"),children:[(0,d.jsx)("span",{className:st("popover-header"),children:rt("averageSpeed")}),m.map(((e,t)=>{return(0,d.jsx)("span",{className:st("popover-row",(a=S(t),a?{color:"primary"}:{color:"secondary"})),children:"".concat(e.label,": ").concat(e.value)},t);var a}))]}),className:st("popover-container"),placement:"bottom",disabled:!s,hasArrow:!0,size:"s",children:(0,d.jsx)("div",{className:st("bars"),onMouseLeave:()=>{h(o),g(r?0:void 0),y(void 0)},children:(()=>{const e=Math.max(...c,0)||1;return c.map(((t,a)=>(0,d.jsx)("div",{className:st("bar-container",{highlighted:j(a)}),onMouseEnter:b.bind(null,c,a),children:(0,d.jsx)("div",{className:st("bar",{color:S(a)?"dark":"light"}),style:{width:"".concat(100*t/e,"%")}})},a)))})()})})]})})},it=(0,c.cn)("ydb-diagnostics-consumers-topic-stats"),lt=e=>{let{data:t}=e;const{writeSpeed:a,partitionsWriteLag:n,partitionsIdleTime:r}=t||{},s=[{label:"Write speed",value:(0,d.jsx)(ot,{data:a})},{label:"Write lag",value:(0,R.gC)(n||0)},{label:"Write idle time",value:(0,R.gC)(r||0)}];return(0,d.jsx)("div",{className:it("wrapper"),children:s.map(((e,t)=>(0,d.jsxs)("div",{className:it("item"),children:[(0,d.jsx)("div",{className:it("label"),children:e.label}),(0,d.jsx)("div",{className:it("value"),children:e.value})]},t)))})};var ct=a(63041),dt=a.n(ct),ut=a(74170),mt=a(21986);const pt=e=>{let{text:t,popoverContent:a,className:n,contentClassName:r}=e;return(0,d.jsxs)("div",{className:n,children:[t,"\xa0",(0,d.jsx)(mt.J,{content:a,contentClassName:r})]})},ht=70,vt=54,gt=268,xt="#ADE8F5",yt="#f5be9d",bt=e=>{let{width:t,height:a,transform:n}=e;return(0,d.jsx)("path",{d:"M-".concat(t/2," 0 c0 -").concat(a,", ").concat(t," -").concat(a,", ").concat(t," 0"),fill:"none",strokeDasharray:"4,6",stroke:"#28f",strokeWidth:"1.6",transform:n})},St=e=>{let{width:t}=e;return(0,d.jsx)("path",{fill:"none",strokeWidth:"2",d:"M0 0 h".concat(t," l-10 -5 m0 10 l10 -5")})},jt=()=>(0,d.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,d.jsx)("g",{transform:"translate(0, ".concat(27,")"),stroke:yt,children:(0,d.jsx)(St,{width:203})}),(0,d.jsxs)("g",{transform:"translate(".concat(30,", 0)"),children:[(0,d.jsxs)("g",{transform:"translate(".concat(35,", ").concat(27,")"),children:[(0,d.jsx)(bt,{width:ht,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(119,", ").concat(27,")"),children:[(0,d.jsx)(bt,{width:98,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write idle time"})})]})]}),(0,d.jsxs)("g",{transform:"translate(".concat(30,", 0)"),children:[(0,d.jsxs)("g",{transform:"translate(".concat(0,", ",27,")"),children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:yt}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(ht,", ").concat(27,")"),children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:yt}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,d.jsx)("g",{transform:"translate(".concat(168,", ").concat(27,")"),children:(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),ft=()=>(0,d.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,d.jsx)("g",{transform:"translate(0, ".concat(27,")"),stroke:xt,children:(0,d.jsx)(St,{width:gt})}),(0,d.jsxs)("g",{transform:"translate(".concat(30,", 0)"),children:[(0,d.jsxs)("g",{transform:"translate(".concat(105,", ").concat(27,")"),children:[(0,d.jsx)(bt,{width:ht,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read lag"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(35,", ").concat(27,")"),children:[(0,d.jsx)(bt,{width:ht,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(182,", ").concat(27,")"),children:[(0,d.jsx)(bt,{width:91,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read idle time"})})]})]}),(0,d.jsxs)("g",{transform:"translate(".concat(30,", ").concat(27,")"),children:[(0,d.jsxs)("g",{transform:"translate(".concat(0,", 0)"),children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:xt}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(ht,", 0)"),children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:xt}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(140,", 0)"),children:[(0,d.jsx)("use",{x:"-2",y:"-10",xlinkHref:"#check",stroke:xt}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read time"})})]}),(0,d.jsx)("g",{transform:"translate(".concat(224,", 0)"),children:(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),Tt=e=>{let{id:t,fill:a}=e;return(0,d.jsx)("pattern",{id:t,x:"0",y:"0",width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,d.jsx)("path",{d:"M0 5L5 0H8L0 8V5M5 8L8 5V8Z",fill:a})})},Nt=()=>(0,d.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 ".concat(gt," ").concat(vt),width:gt,height:vt,children:[(0,d.jsxs)("defs",{children:[(0,d.jsx)("g",{id:"check",children:(0,d.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,d.jsx)(Tt,{id:"latest-read",fill:xt}),(0,d.jsx)(Tt,{id:"latest-write",fill:yt})]}),(0,d.jsx)(jt,{})]}),wt=()=>(0,d.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 ".concat(gt," ").concat(vt),width:gt,height:vt,children:[(0,d.jsxs)("defs",{children:[(0,d.jsx)("g",{id:"check",children:(0,d.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,d.jsx)(Tt,{id:"latest-read",fill:xt}),(0,d.jsx)(Tt,{id:"latest-write",fill:yt})]}),(0,d.jsx)(ft,{})]}),Et=(0,c.cn)("ydb-lag-popover-content"),Ct=e=>{let{text:t,type:a}=e;return(0,d.jsxs)("div",{className:Et({type:a}),children:[(0,d.jsx)("div",{className:Et("text"),children:t}),(0,d.jsx)("div",{children:"read"===a?(0,d.jsx)(wt,{}):(0,d.jsx)(Nt,{})})]})},It=JSON.parse('{"noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers","lagsPopover.readLags":"Read lags statistics, maximum among all consumer partitions (time format dd hh:mm:ss)","table.emptyDataMessage":"No consumers match the current search","controls.search":"Consumer"}'),Pt=JSON.parse('{"noConsumersMessage.topic":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0442\u043e\u043f\u0438\u043a\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","noConsumersMessage.stream":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0440\u0438\u043c\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","lagsPopover.readLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0447\u0442\u0435\u043d\u0438\u044f, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","table.emptyDataMessage":"\u041f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0438\u0441\u043a\u0443 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","controls.search":"Consumer"}'),Dt=(0,pe.wZ)("ydb-diagnostics-consumers",{ru:Pt,en:It}),Rt="consumer",At="readSpeed",Lt="readLags",_t={[Rt]:"Consumer",[At]:"Read speed",[Lt]:"Read lags, duration"},Ot="writeLag",Mt="readLag",kt="readIdleTime",Ft={[Ot]:"write lag",[Mt]:"read lag",[kt]:"read idle time"},zt=(0,c.cn)("ydb-diagnostics-consumers-columns-header"),qt=()=>(0,d.jsx)(pt,{className:zt("lags"),text:_t[Lt],popoverContent:(0,d.jsx)(Ct,{text:Dt("lagsPopover.readLags"),type:"read"})}),Ut=(0,c.cn)("ydb-diagnostics-consumers-columns"),Gt=[{name:Rt,header:_t[Rt],align:ne.ZP.LEFT,render:e=>{let{row:t}=e;if(!t.name)return"\u2013";const a=dt().parse(location.search,{ignoreQueryPrefix:!0});return(0,d.jsx)(ut.h,{to:(0,N.ax)(N.ZP.tenant,void 0,{...a,[Ue.XV.diagnosticsTab]:S.qQ.partitions,selectedConsumer:t.name}),children:t.name})}},{name:At,header:_t[At],align:ne.ZP.RIGHT,resizeMinWidth:140,sortAccessor:e=>e.readSpeed.perMinute,render:e=>{let{row:t}=e;return(0,d.jsx)(ot,{data:t.readSpeed})}},{name:Lt,header:(0,d.jsx)(qt,{}),className:Ut("lags-header"),sub:[{name:Ot,header:Ft[Ot],align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,R.gC)(t.writeLag)}},{name:Mt,header:Ft[Mt],align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,R.gC)(t.readLag)}},{name:kt,header:Ft[kt],align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,R.gC)(t.readIdleTime)}}]}],Bt=(0,c.cn)("ydb-diagnostics-consumers"),Qt=e=>{let{path:t,type:a}=e;const r=(0,ue.zf)(a),[s,o]=n.useState(""),[l]=(0,y.Rj)(),{currentData:c,isFetching:u,error:m}=We.useGetTopicQuery({path:t},{pollingInterval:l}),p=u&&void 0===c,h=(0,y.ix)((e=>et(e,t))),v=(0,y.ix)((e=>$e(e,t))),g=n.useMemo((()=>{if(!h)return[];const e=new RegExp(Be()(s),"i");return h.filter((t=>e.test(String(t.name))))}),[h,s]);return p?(0,d.jsx)(i.a,{size:"m"}):m?(0,d.jsx)(I.V,{error:m}):h&&h.length?(0,d.jsxs)("div",{className:Bt(),children:[(0,d.jsxs)("div",{className:Bt("controls"),children:[(0,d.jsx)(Qe.o,{onChange:e=>{o(e)},placeholder:Dt("controls.search"),className:Bt("search"),value:s}),v&&(0,d.jsx)(lt,{data:v})]}),(0,d.jsx)("div",{className:Bt("table-wrapper"),children:(0,d.jsx)("div",{className:Bt("table-content"),children:(0,d.jsx)(se.G,{columnsWidthLSKey:"consumersColumnsWidth",wrapperClassName:Bt("table"),data:g,columns:Gt,settings:x.LE,emptyDataMessage:Dt("table.emptyDataMessage")})})})]}):(0,d.jsx)("div",{children:Dt("noConsumersMessage.".concat(r?"stream":"topic"))})};var Ht=a(83326),Zt=a.n(Ht),Vt=a(87555);const Wt=le.h.injectEndpoints({endpoints:e=>({getDescribe:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await Promise.all(e.map((e=>window.api.getDescribe({path:e},{signal:a}))));return{data:t.reduce(((e,t)=>(null!==t&&void 0!==t&&t.Path&&(e[t.Path]=t),e)),{})}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});a(55895);const Jt=(0,c.cn)("kv-describe"),Kt=new Map,Yt=e=>{let{path:t,type:a}=e;const[n]=(0,y.Rj)(),r=(0,ue.St)(a),s=(0,y.ix)((e=>(0,g.eU)(e,t,a)),Vt.wU);let o=re.CN;r?s&&(o=[t,...s]):o=[t];const{currentData:l,isFetching:c,error:u}=Wt.useGetDescribeQuery(o,{pollingInterval:n}),m=c&&void 0===l,p=l;let h;if(p){const e=Object.keys(p);h=1===e.length?p[e[0]]:p}return m||r&&!s?(0,d.jsx)(i.a,{size:"m"}):u?(0,d.jsx)(I.V,{error:u,className:Jt("message-container")}):m||h?(0,d.jsx)("div",{className:Jt(),children:(0,d.jsx)("div",{className:Jt("result"),children:(0,d.jsx)(Zt(),{data:h,className:Jt("tree"),onClick:e=>{let{path:t}=e;const a=!Kt.get(t);Kt.set(t,a)},searchOptions:{debounceTime:300},isExpanded:e=>Kt.get(e)||!1})})}):(0,d.jsx)("div",{className:Jt("message-container"),children:"Empty"})};var Xt=a(62206);const $t=e=>{const{PathType:t,PathSubType:a}=(null===e||void 0===e?void 0:e.Self)||{};return(0,ue.d)(t,a)},ea=e=>{var t;return null===e||void 0===e||null===(t=e.UserAttributes)||void 0===t?void 0:t.some((e=>{let{Key:t,Value:a}=e;return"__async_replica"===t&&"true"===a}))};var ta=a(31954),aa=a(93849);const na=(0,aa.a)({values:{PathType:e=>null===e||void 0===e?void 0:e.substring("EPathType".length),CreateStep:R.o0},labels:{PathType:(0,ta.Z)("common.type"),CreateStep:(0,ta.Z)("common.created")}}),ra=e=>{let{value:t,withSpeedLabel:a,...n}=e;const r=(0,Ze.td)({value:t,withSpeedLabel:a,...n}),s=(0,Ze.td)({value:t,withSpeedLabel:a,size:"b"});return(0,d.jsx)("span",{title:s,children:r})},sa=(e,t)=>e?(0,d.jsx)(ra,{value:e,significantDigits:2,...t}):null,oa=(0,aa.a)({values:{Type:e=>null===e||void 0===e?void 0:e.substring(10),State:e=>null===e||void 0===e?void 0:e.substring(11),KeyColumnNames:e=>null===e||void 0===e?void 0:e.join(", "),DataColumnNames:e=>null===e||void 0===e?void 0:e.join(", "),DataSize:sa},labels:{KeyColumnNames:"Columns",DataColumnNames:"Includes"}}),ia={[Me.tB.METERING_MODE_REQUEST_UNITS]:"request-units",[Me.tB.METERING_MODE_RESERVED_CAPACITY]:"reserved-capacity"},la=(0,aa.a)({values:{Partitions:e=>(0,R.uf)((null===e||void 0===e?void 0:e.length)||0),PQTabletConfig:e=>{const t=Math.round(e.PartitionConfig.LifetimeSeconds/x.RQ*100)/100;return"".concat((0,R.uf)(t)," hours")}},labels:{Partitions:"Partitions count",PQTabletConfig:"Retention"}}),ca=(0,aa.a)({values:{Codecs:e=>e&&Object.values(e.Codecs||{}).join(", "),MeteringMode:e=>e&&ia[e]},labels:{MeteringMode:"Metering mode"}}),da=(0,aa.a)({values:{StorageLimitBytes:R.td,WriteSpeedInBytesPerSecond:R.t$},labels:{StorageLimitBytes:"Retention storage",WriteSpeedInBytesPerSecond:"Partitions write speed"}}),ua=(0,aa.a)({values:{Mode:e=>null===e||void 0===e?void 0:e.substring("ECdcStreamMode".length),Format:e=>null===e||void 0===e?void 0:e.substring("ECdcStreamFormat".length)}}),ma=(0,aa.a)({values:{CPU:R.LO,Memory:sa,Storage:sa,Network:R.t$,ReadThroughput:R.t$,WriteThroughput:R.t$},defaultValueFormatter:R.uf}),pa=(0,aa.a)({values:{FollowerCount:R.uf},labels:{FollowerCountPerDataCenter:"FollowerCountPerDC"},defaultValueFormatter:e=>e&&String(e)}),ha=(0,aa.a)({values:{FollowerCount:R.uf,CrossDataCenterFollowerCount:R.uf}}),va=(0,aa.a)({values:{DataSize:sa,IndexSize:sa,LastAccessTime:R.o0,LastUpdateTime:R.o0},defaultValueFormatter:R.uf}),ga=new Set(["Type","State","DataSize","KeyColumnNames","DataColumnNames"]),xa=e=>{var t;let{data:a}=e;const n=$t(null===a||void 0===a?void 0:a.PathDescription);if(!a)return(0,d.jsxs)("div",{className:"error",children:["No ",n," data"]});const r=null===(t=a.PathDescription)||void 0===t?void 0:t.TableIndex,s=[];let o;for(o in r)ga.has(o)&&s.push(oa(o,null===r||void 0===r?void 0:r[o]));return(0,d.jsx)(Xt._P,{title:n,info:s})},ya=le.h.injectEndpoints({endpoints:e=>({getOverview:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const[t,...n]=await Promise.all(e.map((e=>window.api.getDescribe({path:e},{signal:a}))));return{data:{data:t,additionalData:n}}}catch(n){return{error:n}}}})})});var ba=a(69214);const Sa=JSON.parse('{"external-objects.source-type":"Source Type","external-objects.data-source":"Data Source","external-objects.location":"Location","external-objects.auth-method":"Auth Method","external-objects.auth-method.none":"None","external-objects.auth-method.service-account":"Service Account","view.query-text":"Query Text"}'),ja=(0,pe.wZ)("ydb-tenant-objects-info",{en:Sa}),fa=(0,c.cn)("ydb-external-data-source-info"),Ta=e=>{var t,a,n,r;return[{label:ja("external-objects.source-type"),value:null===(t=e.PathDescription)||void 0===t||null===(a=t.ExternalDataSourceDescription)||void 0===a?void 0:a.SourceType},na("CreateStep",null===(n=e.PathDescription)||void 0===n||null===(r=n.Self)||void 0===r?void 0:r.CreateStep)]},Na=e=>{var t;const{Location:a,Auth:n}=(null===(t=e.PathDescription)||void 0===t?void 0:t.ExternalDataSourceDescription)||{};return[...Ta(e),{label:ja("external-objects.location"),value:(0,d.jsx)(ba.A,{name:a,showStatus:!1,hasClipboardButton:!0,clipboardButtonAlwaysVisible:!0,className:fa("location")})},{label:ja("external-objects.auth-method"),value:null!==n&&void 0!==n&&n.ServiceAccount?ja("external-objects.auth-method.service-account"):ja("external-objects.auth-method.none")}]},wa=e=>{let{data:t,prepareData:a}=e;const n=$t(null===t||void 0===t?void 0:t.PathDescription);return t?(0,d.jsx)(Xt._P,{title:n,info:a(t)}):(0,d.jsxs)("div",{className:"error",children:["No ",n," data"]})},Ea=e=>{let{data:t}=e;return(0,d.jsx)(wa,{data:t,prepareData:Na})};var Ca=a(86974),Ia=a(32270);const Pa=(0,c.cn)("ydb-external-table-info"),Da=(e,t)=>{var a,n;const{CreateStep:r}=(null===(a=e.PathDescription)||void 0===a?void 0:a.Self)||{},{SourceType:s,DataSourcePath:o}=(null===(n=e.PathDescription)||void 0===n?void 0:n.ExternalTableDescription)||{},i=null===o||void 0===o?void 0:o.split("/").pop();return[{label:ja("external-objects.source-type"),value:s},na("CreateStep",r),{label:ja("external-objects.data-source"),value:o&&(0,d.jsx)("span",{title:o,children:(0,d.jsx)(Ia.j,{title:i||"",url:t})})}]},Ra=(e,t)=>{var a,n;const r=null===(a=e.PathDescription)||void 0===a||null===(n=a.ExternalTableDescription)||void 0===n?void 0:n.Location;return[...Da(e,t),{label:ja("external-objects.location"),value:(0,d.jsx)(ba.A,{name:r,showStatus:!1,hasClipboardButton:!0,clipboardButtonAlwaysVisible:!0,className:Pa("location")})}]},Aa=e=>{var t,a;let{data:n,prepareData:r}=e;const s=(0,Ca.TH)(),o=(0,N.mB)(s),i=(0,N.vF)({...o,schema:null===n||void 0===n||null===(t=n.PathDescription)||void 0===t||null===(a=t.ExternalTableDescription)||void 0===a?void 0:a.DataSourcePath}),l=$t(null===n||void 0===n?void 0:n.PathDescription);return n?(0,d.jsx)(Xt._P,{title:l,info:r(n,i)}):(0,d.jsxs)("div",{className:"error",children:["No ",l," data"]})},La=e=>{let{data:t}=e;return(0,d.jsx)(Aa,{data:t,prepareData:Ra})};var _a=a(55334),Oa=a(10288);const Ma=(0,c.cn)("ydb-view-info"),ka=e=>{var t,a;const n=null===(t=e.PathDescription)||void 0===t||null===(a=t.ViewDescription)||void 0===a?void 0:a.QueryText;return[{name:ja("view.query-text"),copyText:n,content:(0,d.jsx)(Oa.x,{variant:"code-2",wordBreak:"break-word",children:n})}]};function Fa(e){let{data:t}=e;const a=$t(null===t||void 0===t?void 0:t.PathDescription);return t?(0,d.jsxs)("div",{className:Ma(null),children:[(0,d.jsx)("div",{className:Ma("title"),children:a}),(0,d.jsx)(_a.w,{nameMaxWidth:200,copyPosition:"outside",className:Ma("properties-list"),items:ka(t)})]}):(0,d.jsxs)("div",{className:"error",children:["No ",a," data"]})}var za=a(77796),qa=a(14979);function Ua(e){let{state:t}=e;return t?"StandBy"in t?(0,d.jsx)(qa._,{theme:"info",children:"Standby"}):"Paused"in t?(0,d.jsx)(qa._,{theme:"info",children:"Paused"}):"Done"in t?(0,d.jsx)(qa._,{theme:"success",children:"Done"}):"Error"in t?(0,d.jsx)(qa._,{theme:"danger",children:"Error"}):(0,d.jsx)(qa._,{size:"s",children:"Unknown"}):null}const Ga=JSON.parse('{"column.dstPath.name":"Dist","column.srcPath.name":"Source","everythingWithPrefix":"Everything with prefix:","noData":"No data.","title":"Replicated Paths"}'),Ba=(0,pe.wZ)("ydb-diagnostics-async-replication-paths",{en:Ga}),Qa=(0,c.cn)("ydb-async-replication-paths"),Ha=[{name:Ba("column.srcPath.name"),render:e=>{let{row:t}=e;return t.SrcPath},sortAccessor:e=>e.SrcPath},{name:Ba("column.dstPath.name"),render:e=>{let{row:t}=e;return t.DstPath},sortAccessor:e=>e.DstPath}];function Za(e){let{config:t}=e;if(!t)return null;let a=Ba("noData");var n,r;t.Everything&&(a=(0,d.jsxs)("span",{children:[Ba("everythingWithPrefix")," ",(0,d.jsx)(Oa.x,{variant:"code-inline-2",children:null!==(n=null===(r=t.Everything)||void 0===r?void 0:r.DstPrefix)&&void 0!==n?n:"undefined"}),"."]}));return t.Specific&&(a=(0,d.jsx)(se.G,{data:t.Specific.Targets,settings:x.E6,columns:Ha})),(0,d.jsxs)("div",{className:Qa(),children:[(0,d.jsx)("div",{className:Qa("title"),children:Ba("title")}),a]})}function Va(e){let{connection:t}=e;return t?t.StaticCredentials?(0,d.jsx)(qa._,{value:t.StaticCredentials.User,theme:"normal",children:"user"}):"OAuthToken"in t?"OAuth":"unknown":null}const Wa=JSON.parse('{"credentials.label":"Credentials","noData":"No data for entity:","srcConnection.database.label":"Source Database Path","srcConnection.endpoint.label":"Source Cluster Endpoint","state.label":"State"}'),Ja=(0,pe.wZ)("ydb-diagnostics-async-replication-info",{en:Wa});function Ka(e){var t,a,n,r,s,o,i,l,c,u,m,p,h,v,g;let{data:x}=e;const y=$t(null===x||void 0===x?void 0:x.PathDescription);return x?(0,d.jsxs)(za.k,{direction:"column",gap:"4",children:[(0,d.jsx)(Xt._P,{title:y,info:[{label:Ja("state.label"),value:(0,d.jsx)(Ua,{state:null===(t=x.PathDescription)||void 0===t||null===(a=t.ReplicationDescription)||void 0===a?void 0:a.State})},{label:Ja("srcConnection.endpoint.label"),value:(0,d.jsx)(Oa.x,{variant:"code-inline-2",children:null===(n=x.PathDescription)||void 0===n||null===(r=n.ReplicationDescription)||void 0===r||null===(s=r.Config)||void 0===s||null===(o=s.SrcConnectionParams)||void 0===o?void 0:o.Endpoint})},{label:Ja("srcConnection.database.label"),value:(0,d.jsx)(Oa.x,{variant:"code-inline-2",children:null===(i=x.PathDescription)||void 0===i||null===(l=i.ReplicationDescription)||void 0===l||null===(c=l.Config)||void 0===c||null===(u=c.SrcConnectionParams)||void 0===u?void 0:u.Database})},{label:Ja("credentials.label"),value:(0,d.jsx)(Va,{connection:null===(m=x.PathDescription)||void 0===m||null===(p=m.ReplicationDescription)||void 0===p||null===(h=p.Config)||void 0===h?void 0:h.SrcConnectionParams})}]}),(0,d.jsx)(Za,{config:null===(v=x.PathDescription)||void 0===v||null===(g=v.ReplicationDescription)||void 0===g?void 0:g.Config})]}):(0,d.jsxs)("div",{className:"error",children:[Ja("noData")," ",y]})}const Ya=JSON.parse('{"writeLagPopover":"Write lag, maximum among all topic partitions","writeIdleTimePopover":"Write idle time, maximum among all topic partitions"}'),Xa=JSON.parse('{"writeLagPopover":"\u041b\u0430\u0433 \u0437\u0430\u043f\u0438\u0441\u0438, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0442\u043e\u043f\u0438\u043a\u0430","writeIdleTimePopover":"\u0412\u0440\u0435\u043c\u044f \u0431\u0435\u0437 \u0437\u0430\u043f\u0438\u0441\u0438, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0442\u043e\u043f\u0438\u043a\u0430"}'),$a=(0,pe.wZ)("ydb-diagnostics-overview-topic-stats",{ru:Xa,en:Ya}),en=(0,c.cn)("ydb-overview-topic-stats"),tn=e=>[{label:"Store size",value:(0,R.td)(e.storeSize)},{label:(0,d.jsx)(pt,{text:"Write idle time",popoverContent:(0,d.jsx)(Ct,{text:$a("writeIdleTimePopover"),type:"write"})}),value:(0,Ve.tt)(e.partitionsIdleTime)},{label:(0,d.jsx)(pt,{text:"Write lag",popoverContent:(0,d.jsx)(Ct,{text:$a("writeLagPopover"),type:"write"})}),value:(0,Ve.tt)(e.partitionsWriteLag)},{label:"Average write speed",value:(0,d.jsx)(ot,{data:e.writeSpeed,withValue:!1})}],an=e=>{const t=e.writeSpeed;return[{label:"per minute",value:(0,R.t$)(t.perMinute)},{label:"per hour",value:(0,R.t$)(t.perHour)},{label:"per day",value:(0,R.t$)(t.perDay)}]},nn=e=>{let{path:t}=e;const[a]=(0,y.Rj)(),{currentData:n,isFetching:r,error:s}=We.useGetTopicQuery({path:t},{pollingInterval:a}),o=r&&void 0===n,l=(0,y.ix)((e=>$e(e,t)));return o?(0,d.jsx)("div",{className:en(),children:(0,d.jsx)(i.a,{size:"s"})}):s||!l?(0,d.jsxs)("div",{className:en(),children:[(0,d.jsx)("div",{className:en("title"),children:"Stats"}),(0,d.jsx)(I.V,{error:s})]}):(0,d.jsxs)("div",{className:en(),children:[(0,d.jsx)("div",{className:en("title"),children:"Stats"}),(0,d.jsx)("div",{className:en("info"),children:(0,d.jsx)(Xt._P,{info:tn(l),multilineLabels:!0})}),(0,d.jsx)("div",{className:en("bytes-written"),children:(0,d.jsx)(Xt._P,{info:an(l)})})]})},rn=e=>{var t;const a=null===e||void 0===e||null===(t=e.PathDescription)||void 0===t?void 0:t.PersQueueGroup;if(!a)return[];const{Partitions:n=[],PQTabletConfig:r={PartitionConfig:{LifetimeSeconds:0}}}=a,{Codecs:s,MeteringMode:o}=r,{WriteSpeedInBytesPerSecond:i,StorageLimitBytes:l}=r.PartitionConfig;return[...(0,Xt.Z6)(la,{Partitions:n,PQTabletConfig:r}),...(0,Xt.Z6)(da,{StorageLimitBytes:l,WriteSpeedInBytesPerSecond:i}),...(0,Xt.Z6)(ca,{Codecs:s,MeteringMode:o})]},sn=(e,t)=>{var a,n,r;if(!e&&!t)return[];const s=null===e||void 0===e||null===(a=e.PathDescription)||void 0===a?void 0:a.CdcStreamDescription,{Mode:o,Format:i}=s||{};return[na("CreateStep",null===e||void 0===e||null===(n=e.PathDescription)||void 0===n||null===(r=n.Self)||void 0===r?void 0:r.CreateStep),...(0,Xt.Z6)(ua,{Mode:o,Format:i}),...rn(t)]},on=e=>{let{path:t,data:a,topic:n}=e;const r=$t(null===a||void 0===a?void 0:a.PathDescription);return a&&n?(0,d.jsxs)("div",{children:[(0,d.jsx)(Xt._P,{title:r,info:sn(a,n)}),(0,d.jsx)(nn,{path:t})]}):(0,d.jsxs)("div",{className:"error",children:["No ",r," data"]})},ln=JSON.parse('{"page.title":"Database","pages.query":"Query","pages.diagnostics":"Diagnostics","acl.owner":"Owner","acl.empty":"No Acl data","summary.navigation":"Navigation","summary.showPreview":"Show preview","summary.source-type":"Source Type","summary.data-source":"Data Source","summary.copySchemaPath":"Copy schema path","summary.type":"Type","summary.subtype":"SubType","summary.id":"Id","summary.version":"Version","summary.created":"Created","summary.partitions":"Partitions count","summary.paths":"Paths","summary.shards":"Shards","summary.state":"State","summary.mode":"Mode","summary.format":"Format","summary.retention":"Retention","label.read-only":"ReadOnly","actions.copied":"The path is copied to the clipboard","actions.notCopied":"Couldn\u2019t copy the path","actions.copyPath":"Copy path","actions.openPreview":"Open preview","actions.createTable":"Create table...","actions.createExternalTable":"Create external table...","actions.createTopic":"Create topic...","actions.createColumnTable":"Create column table...","actions.createAsyncReplication":"Create async replication...","actions.createView":"Create view...","actions.dropTable":"Drop table...","actions.dropTopic":"Drop topic...","actions.dropView":"Drop view...","actions.alterTable":"Alter table...","actions.alterTopic":"Alter topic...","actions.selectQuery":"Select query...","actions.upsertQuery":"Upsert query...","actions.alterReplication":"Alter async replicaton...","actions.dropReplication":"Drop async replicaton...","actions.createDirectory":"Create directory","schema.tree.dialog.placeholder":"Relative path","schema.tree.dialog.invalid":"Invalid path","schema.tree.dialog.whitespace":"Whitespace is not allowed","schema.tree.dialog.empty":"Path is empty","schema.tree.dialog.header":"Create directory","schema.tree.dialog.description":"Inside","schema.tree.dialog.buttonCancel":"Cancel","schema.tree.dialog.buttonApply":"Create"}'),cn=(0,pe.wZ)("ydb-tenant",{en:ln});function dn(e){let{data:t}=e;const a=$t(t);return ea(t)?(0,d.jsxs)(za.k,{gap:1,wrap:"nowrap",children:[a," ",(0,d.jsx)(qa._,{children:cn("label.read-only")})]}):a}const un=JSON.parse('{"tableStats":"Table Stats","tabletMetrics":"Tablet Metrics","partitionConfig":"Partition Config"}'),mn=JSON.parse('{"tableStats":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0442\u0430\u0431\u043b\u0438\u0446\u044b","tabletMetrics":"\u041c\u0435\u0442\u0440\u0438\u043a\u0438 \u0442\u0430\u0431\u043b\u0435\u0442\u043a\u0438","partitionConfig":"\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0438"}'),pn=(0,pe.wZ)("ydb-diagnostics-overview-table-info",{ru:mn,en:un}),hn=e=>e.SchemaPresetName&&void 0!==e.SchemaPresetId,vn=e=>{if(e.Enabled&&e.Enabled.ColumnName&&void 0!==e.Enabled.ExpireAfterSeconds){return{label:"TTL for rows",value:"column: '".concat(e.Enabled.ColumnName,"', expire after: ").concat((0,Ve.tt)(1e3*e.Enabled.ExpireAfterSeconds,1))}}};const gn=(e,t)=>{if(!e)return{};const{PathDescription:a={}}=e,{TableStats:n={},TabletMetrics:r={},Table:{PartitionConfig:s={},TTLSettings:o}={},ColumnTableDescription:i={}}=a,{PartCount:l,RowCount:c,DataSize:d,IndexSize:u,LastAccessTime:m,LastUpdateTime:p,ImmediateTxCompleted:h,PlannedTxCompleted:v,TxRejectedByOverload:g,TxRejectedBySpace:x,TxCompleteLagMsec:y,InFlightTxCount:b,RowUpdates:S,RowDeletes:j,RowReads:f,RangeReads:T,RangeReadRows:N}=n,{FollowerGroups:w,FollowerCount:E,CrossDataCenterFollowerCount:C}=s;let I=[];switch(t){case Me.gb.EPathTypeTable:I=((e,t)=>{var a;const{PartitioningPolicy:n={},FollowerGroups:r,EnableFilterByKey:s}=e,o=[],i=n.SizeToSplit&&Number(n.SizeToSplit)>0?"Enabled, split size: ".concat((0,R.td)(n.SizeToSplit)):"Disabled",l=null!==(a=n.SplitByLoadSettings)&&void 0!==a&&a.Enabled?"Enabled":"Disabled";if(o.push({label:"Partitioning by size",value:i},{label:"Partitioning by load",value:l},{label:"Min number of partitions",value:(0,R.uf)(n.MinPartitionsCount||0)}),n.MaxPartitionsCount&&o.push({label:"Max number of partitions",value:(0,R.uf)(n.MaxPartitionsCount)}),r&&r.length){const{RequireAllDataCenters:e,FollowerCountPerDataCenter:t,FollowerCount:a}=r[0];let n;n=e&&t?"PER_AZ: ".concat(a):"ANY_AZ: ".concat(a),o.push({label:"Read replicas (followers)",value:n})}if(t){const e=vn(t);e&&o.push(e)}return o.push({label:"Bloom filter",value:s?"Enabled":"Disabled"}),o})(s,o);break;case Me.gb.EPathTypeColumnTable:I=function(e){const t=[];if(t.push({label:"Standalone",value:String(!hn(e))}),e.Sharding&&e.Sharding.HashSharding&&t.push({label:"Sharding",value:"hash"}),e.TtlSettings){const a=vn(null===e||void 0===e?void 0:e.TtlSettings);a&&t.push(a)}return t}(i)}const P=[(0,Xt.Z6)(va,{PartCount:l,RowCount:c,DataSize:d,IndexSize:u}),(0,Xt.Z6)(va,{LastAccessTime:m,LastUpdateTime:p}),(0,Xt.Z6)(va,{ImmediateTxCompleted:h,PlannedTxCompleted:v,TxRejectedByOverload:g,TxRejectedBySpace:x,TxCompleteLagMsec:y,InFlightTxCount:b}),(0,Xt.Z6)(va,{RowUpdates:S,RowDeletes:j,RowReads:f,RangeReads:T,RangeReadRows:N})],D=(0,Xt.Z6)(ma,r);let A=[];return Array.isArray(w)&&w.length>0?A=(0,Xt.Z6)(pa,w[0]):void 0!==E?A.push(ha("FollowerCount",E)):void 0!==C&&A.push(ha("CrossDataCenterFollowerCount",C)),{generalInfo:I,tableStatsInfo:P,tabletMetricsInfo:D,partitionConfigInfo:A}},xn=(0,c.cn)("ydb-diagnostics-table-info"),yn=e=>{let{data:t,type:a}=e;const r=(0,d.jsx)(dn,{data:null===t||void 0===t?void 0:t.PathDescription}),{generalInfo:s,tableStatsInfo:o,tabletMetricsInfo:i=[],partitionConfigInfo:l=[]}=n.useMemo((()=>gn(t,a)),[t,a]);return(0,d.jsxs)("div",{className:xn(),children:[(0,d.jsx)(Xt._P,{info:s,title:r,className:xn("info-block"),renderEmptyState:()=>(0,d.jsx)("div",{className:xn("title"),children:r})}),(0,d.jsxs)("div",{className:xn("row"),children:[o?(0,d.jsx)("div",{className:xn("col"),children:o.map(((e,t)=>(0,d.jsx)(Xt._P,{info:e,title:0===t?pn("tableStats"):void 0,className:xn("info-block"),renderEmptyState:()=>null},t)))}):null,i.length>0||l.length>0?(0,d.jsxs)("div",{className:xn("col"),children:[(0,d.jsx)(Xt._P,{info:i,title:pn("tabletMetrics"),className:xn("info-block"),renderEmptyState:()=>null}),(0,d.jsx)(Xt._P,{info:l,title:pn("partitionConfig"),className:xn("info-block"),renderEmptyState:()=>null})]}):null]})]})},bn=e=>{let{data:t,path:a}=e;const n=$t(null===t||void 0===t?void 0:t.PathDescription);return t?(0,d.jsxs)("div",{children:[(0,d.jsx)(Xt._P,{title:n,info:rn(t)}),(0,d.jsx)(nn,{path:a})]}):(0,d.jsxs)("div",{className:"error",children:["No ",n," data"]})};const Sn=function(e){let{type:t,path:a}=e;const[n]=(0,y.Rj)(),r=(0,ue.St)(t),s=(0,y.ix)((e=>(0,g.eU)(e,a,t)),Vt.wU);let o=re.CN;r?s&&(o=[a,...s]):o=[a];const{currentData:l,isFetching:c,error:u}=ya.useGetOverviewQuery(o,{pollingInterval:n}),m=c&&void 0===l,{data:p,additionalData:h}=l||{},{error:v}=(0,g.hz)({path:a});return m||r&&!s?(0,d.jsx)(i.a,{size:"m"}):v||u?(0,d.jsx)(I.V,{error:v||u}):(()=>{var e;const n=null!==p&&void 0!==p?p:void 0,r={[Me.gb.EPathTypeInvalid]:void 0,[Me.gb.EPathTypeDir]:void 0,[Me.gb.EPathTypeTable]:void 0,[Me.gb.EPathTypeSubDomain]:void 0,[Me.gb.EPathTypeTableIndex]:()=>(0,d.jsx)(xa,{data:n}),[Me.gb.EPathTypeExtSubDomain]:void 0,[Me.gb.EPathTypeColumnStore]:void 0,[Me.gb.EPathTypeColumnTable]:void 0,[Me.gb.EPathTypeCdcStream]:()=>{var e;return(0,d.jsx)(on,{path:a,data:n,topic:null!==(e=null===h||void 0===h?void 0:h[0])&&void 0!==e?e:void 0})},[Me.gb.EPathTypePersQueueGroup]:()=>(0,d.jsx)(bn,{data:n,path:a}),[Me.gb.EPathTypeExternalTable]:()=>(0,d.jsx)(La,{data:n}),[Me.gb.EPathTypeExternalDataSource]:()=>(0,d.jsx)(Ea,{data:n}),[Me.gb.EPathTypeView]:()=>(0,d.jsx)(Fa,{data:n}),[Me.gb.EPathTypeReplication]:()=>(0,d.jsx)(Ka,{data:n})};return t&&(null===(e=r[t])||void 0===e?void 0:e.call(r))||(0,d.jsx)(yn,{data:n,type:t})})()};var jn=a(2982),fn=a(49687),Tn=a(8978),Nn=a(95280),wn=a(67141),En=a(39633);const Cn=["#7EB26D","#EAB839","#6ED0E0","#EF843C","#E24D42","#1F78C1","#BA43A9","#705DA0","#508642","#CCA300"];var In=a(47651);const Pn=e=>{switch(e){case"ms":return Dn;case"size":return Rn;case"percent":return An;default:return}};function Dn(e){return null===e?x.jX:(0,Ve.zm)((0,R.W0)(Ln(e),2))}function Rn(e){return null===e?x.jX:(0,Ze.td)({value:Ln(e),precision:3})}function An(e){return null===e?x.jX:Math.round(100*Ln(e))+"%"}function Ln(e){return(0,In.kE)(e)?Number(e):0}const _n={"30m":30*x.sU,"1h":x.RQ,"1d":x.ii,"1w":7*x.ii},On=JSON.parse('{"not-supported":"Charts are not supported on current ydb version"}'),Mn=(0,pe.wZ)("ydb-metric-chart",{en:On}),kn=le.h.injectEndpoints({endpoints:e=>({getChartData:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await async function(e){let{database:t,metrics:a,timeFrame:n,maxDataPoints:r}=e,{signal:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=a.map((e=>"target=".concat(e.target))).join("&"),i=Math.round(Date.now()/1e3),l=i-_n[n];return window.api.getChartData({target:o,from:l,until:i,maxDataPoints:r,database:t},{signal:s})}(e,{signal:a});if(Array.isArray(t)){const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const a=e.map((e=>{let{datapoints:a,target:n}=e;const r=t.find((e=>e.target===n));if(!r)return;const s=a.map((e=>e[0]));return{...r,data:s}})).filter((e=>void 0!==e));return{timeline:e[0].datapoints.map((e=>1e3*e[1])),metrics:a}}(t,e.metrics);return{data:a}}return{error:new Error("string"===typeof t?Mn("not-supported"):t.error)}}catch(n){return{error:n}}},providesTags:["All"],keepUnusedDataFor:0})}),overrideExisting:"throw"}),Fn=(0,c.cn)("ydb-metric-chart");Tn.X.set({plugins:[wn.YagrPlugin]});const zn=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{dataType:a,scaleRange:n}=t,r=Pn(a),s=!e.metrics.length,o=e.metrics.map(((e,t)=>{const a=e.color||Cn[t],n=function(e,t){const a=(0,En.Vi)(e);if(!a.isValid())throw new Error("Invalid color is passed");return a.alpha(t).toRgbString()}(a,.1);return{id:e.target,name:e.title||e.target,data:e.data,formatter:r,lineColor:a,color:n,legendColorKey:"lineColor"}}));return{data:{timeline:e.timeline,graphs:o},libraryConfig:{chart:{size:{padding:s?[10,0,10,0]:void 0},series:{type:"area",spanGaps:!0,lineWidth:1.5},select:{zoom:!1}},scales:{y:{type:"linear",range:"nice",min:(null===n||void 0===n?void 0:n.min)||0,max:null===n||void 0===n?void 0:n.max}},axes:{y:{values:r?(e,t)=>t.map(r):void 0}},tooltip:{show:!0,tracking:"sticky"}}}},qn={timeline:[],metrics:[]},Un=e=>{let{database:t,title:a,metrics:r,timeFrame:s="1h",autorefresh:o,width:l=400,height:c=l/1.5,chartOptions:u,onChartDataStatusChange:m,isChartVisible:p}=e;const{currentData:h,error:v,isFetching:g,status:x}=kn.useGetChartDataQuery({database:t,metrics:r,timeFrame:s,maxDataPoints:l/2},{pollingInterval:o}),y=g&&!h;n.useEffect((()=>null===m||void 0===m?void 0:m("fulfilled"===x?"success":"loading")),[x,m]);const b=zn(h||qn,u);return(0,d.jsxs)("div",{className:Fn(null),style:{height:c,width:l},children:[(0,d.jsx)("div",{className:Fn("title"),children:a}),y?(0,d.jsx)(i.a,{}):p?(0,d.jsxs)("div",{className:Fn("chart"),children:[(0,d.jsx)(Nn.ZP,{type:"yagr",data:b}),v?(0,d.jsx)(I.V,{className:Fn("error"),error:v}):null]}):null]})};var Gn=a(17176);const Bn=(0,c.cn)("ydb-timeframe-selector"),Qn=e=>{let{value:t,onChange:a,className:n}=e;return(0,d.jsx)("div",{className:Bn(null,n),children:Object.keys(_n).map((e=>(0,d.jsx)(Gn.z,{view:"flat",selected:t===e,onClick:()=>a(e),children:e},e)))})},Hn=(0,c.cn)("ydb-tenant-dashboard"),Zn=e=>{let{database:t,charts:a}=e;const[r,o]=n.useState(!0),[i="1h",l]=(0,s.useQueryParam)("timeframe",s.StringParam),[c]=(0,y.Rj)(),u=r?0:c,m=e=>{"success"===e&&o(!1)},p=1===a.length?872:428;return(0,d.jsxs)("div",{className:Hn(null),style:{display:r?"none":void 0},children:[(0,d.jsx)("div",{className:Hn("controls"),children:(0,d.jsx)(Qn,{value:i,onChange:l})}),(0,d.jsx)("div",{className:Hn("charts"),children:a.map((e=>{const a=e.metrics.map((e=>{let{target:t}=e;return t})).join("&");return(0,d.jsx)(Un,{database:t,title:e.title,metrics:e.metrics,timeFrame:i,chartOptions:e.options,autorefresh:u,width:p,height:285.3333333333333,onChartDataStatusChange:m,isChartVisible:!r},a)}))})]})},Vn=JSON.parse('{"no-data":"No data","no-pools-data":"No pools data","top-nodes.empty-data":"No such nodes","top-groups.empty-data":"No such groups","top":"Top","nodes":"nodes","shards":"shards","groups":"groups","queries":"queries","tables":"tables","by-pools-usage":"by pools usage","by-cpu-time":"by cpu time","by-cpu-usage":"by cpu usage","by-load":"by load","by-memory":"by memory","by-usage":"by usage","by-size":"by size","cards.cpu-label":"CPU","cards.storage-label":"Storage","cards.memory-label":"Memory","charts.queries-per-second":"Queries per second","charts.transaction-latency":"Transactions latencies {{percentile}}","charts.cpu-usage":"CPU usage by pool","charts.storage-usage":"Tablet storage usage","charts.memory-usage":"Memory usage","storage.tablet-storage-title":"Tablet storage","storage.tablet-storage-description":"Size of user data and indexes stored in schema objects (tables, topics, etc.)","storage.db-storage-title":"Database storage","storage.db-storage-description":"Size of data stored in distributed storage with all overheads for redundancy"}'),Wn=(0,pe.wZ)("ydb-diagnostics-tenant-overview",{en:Vn}),Jn=[{title:Wn("charts.queries-per-second"),metrics:[{target:"queries.requests",title:Wn("charts.queries-per-second")}]},{title:Wn("charts.transaction-latency",{percentile:""}),metrics:[{target:"queries.latencies.p50",title:Wn("charts.transaction-latency",{percentile:"p50"})},{target:"queries.latencies.p75",title:Wn("charts.transaction-latency",{percentile:"p75"})},{target:"queries.latencies.p90",title:Wn("charts.transaction-latency",{percentile:"p90"})},{target:"queries.latencies.p99",title:Wn("charts.transaction-latency",{percentile:"p99"})}],options:{dataType:"ms"}}],Kn=e=>{let{database:t}=e;return(0,d.jsx)(Zn,{database:t,charts:Jn})},Yn=le.h.injectEndpoints({endpoints:e=>({getHealthcheckInfo:e.query({queryFn:async(e,t)=>{let{database:a,maxLevel:n}=e,{signal:r}=t;try{return{data:await window.api.getHealthcheckInfo({database:a,maxLevel:n},{signal:r})}}catch(s){return{error:s}}},providesTags:["All"]})}),overrideExisting:"throw"}),Xn={RED:0,ORANGE:1,YELLOW:2,BLUE:3,GREEN:4},$n=e=>e.sort(((e,t)=>(Xn[e.status]||0)-(Xn[t.status]||0))),er=e=>{let{issue:t,data:a}=e;return $n(a.filter((e=>t.reason&&-1!==t.reason.indexOf(e.id))))},tr=e=>$n(e.filter((t=>!e.find((e=>e.reason&&-1!==e.reason.indexOf(t.id)))))),ar=e=>{let{data:t,roots:a}=e;return a?a.map((e=>{const a=ar({roots:er({issue:e,data:t}),data:t});return{...e,reasonsItems:a}})):[]},nr=e=>{const t={};for(const a of e)t[a.status]||(t[a.status]=0),t[a.status]++;return Object.entries(t).sort(((e,t)=>{let[a]=e,[n]=t;return(Xn[a]||0)-(Xn[n]||0)}))},rr=(0,He.P1)((e=>e),(e=>Yn.endpoints.getHealthcheckInfo.select({database:e}))),sr=(0,He.P1)((e=>e),((e,t)=>rr(t)),((e,t)=>{var a;return(null===(a=t(e).data)||void 0===a?void 0:a.issue_log)||[]})),or=(0,He.P1)(sr,(function(){return tr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])})),ir=(0,He.P1)([sr,or],(function(){return ar({data:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],roots:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]})})),lr=(0,He.P1)(sr,(function(){return nr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])}));let cr,dr;!function(e){e.UNSPECIFIED="UNSPECIFIED",e.GOOD="GOOD",e.DEGRADED="DEGRADED",e.MAINTENANCE_REQUIRED="MAINTENANCE_REQUIRED",e.EMERGENCY="EMERGENCY"}(cr||(cr={})),function(e){e.UNSPECIFIED="UNSPECIFIED",e.GREY="GREY",e.GREEN="GREEN",e.BLUE="BLUE",e.YELLOW="YELLOW",e.ORANGE="ORANGE",e.RED="RED"}(dr||(dr={}));const ur=function(e){let{autorefresh:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{currentData:a,isFetching:n,error:r,refetch:s}=Yn.useGetHealthcheckInfoQuery({database:e},{pollingInterval:t}),o=(null===a||void 0===a?void 0:a.self_check_result)||cr.UNSPECIFIED,i=(0,y.ix)((t=>lr(t,e)));return{issueTrees:(0,y.ix)((t=>ir(t,e))),issuesStatistics:i,loading:void 0===a&&n,error:r,refetch:s,selfCheckResult:o}};var mr=a(87863),pr=a.n(mr),hr=a(40067),vr=a(75850);const gr={[dr.UNSPECIFIED]:vr.K.Grey,[dr.GREY]:vr.K.Grey,[dr.GREEN]:vr.K.Green,[dr.BLUE]:vr.K.Blue,[dr.YELLOW]:vr.K.Yellow,[dr.ORANGE]:vr.K.Orange,[dr.RED]:vr.K.Red},xr=(0,c.cn)("issue-tree-item"),yr=e=>{let{status:t,message:a,type:n,onClick:r}=e;return(0,d.jsxs)("div",{className:xr(),onClick:r,children:[(0,d.jsx)("div",{className:xr("field",{status:!0}),children:(0,d.jsx)(ba.A,{mode:"icons",status:t,name:n})}),(0,d.jsx)("div",{className:xr("field",{message:!0}),children:a})]})},br=(0,c.cn)("issue-tree"),Sr=e=>{let{issueTree:t}=e;const[a,r]=n.useState({}),s=n.useCallback((e=>e?(0,d.jsx)("div",{className:br("info-panel"),children:(0,d.jsx)(Zt(),{data:e,search:!1,isExpanded:()=>!0,className:br("inspector")})}):null),[]),o=n.useCallback((e=>e.map((e=>{const{id:t}=e,{status:n,message:i,type:l,reasonsItems:c,level:u,...m}=e,p="undefined"===typeof a[t]||a[t],h=()=>{r((e=>({...e,[t]:!p})))};return(0,d.jsxs)(hr.L,{name:(0,d.jsx)(yr,{status:gr[n],message:i,type:l}),collapsed:p,hasArrow:!0,onClick:h,onArrowClick:h,level:u-1,children:[s(pr()(m,["reason"])),o(c||[])]},t)}))),[a,s]);return(0,d.jsx)("div",{className:br(),children:(0,d.jsx)("div",{className:br("block"),children:o([t])})})},jr=JSON.parse('{"title.healthcheck":"Healthcheck","label.update":"Update","label.show-details":"Show details","label.issues":"Issues:","status_message.ok":"No issues","no-data":"no healthcheck data"}'),fr=JSON.parse('{"title.healthcheck":"Healthcheck","label.update":"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c","label.show-details":"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0441\u0442\u0438","label.issues":"\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u044b:","status_message.ok":"\u041d\u0435\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c","no-data":"\u043d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 healthcheck"}'),Tr=(0,pe.wZ)("ydb-diagnostics-healthcheck",{ru:fr,en:jr}),Nr=(0,c.cn)("healthcheck");function wr(e){let{tenantName:t}=e;const[a]=(0,y.Rj)(),{issueTrees:r,loading:s,error:o}=ur(t,{autorefresh:a});return(0,d.jsx)("div",{className:Nr("details"),children:(0,d.jsx)("div",{className:Nr("details-content-wrapper"),children:o?(0,d.jsx)(I.V,{error:o,defaultMessage:Tr("no-data")}):s?(0,d.jsx)(i.a,{size:"m"}):r&&r.length?(0,d.jsx)(n.Fragment,{children:r.map((e=>(0,d.jsx)(Sr,{issueTree:e},e.id)))}):Tr("status_message.ok")})})}var Er=a(35240),Cr=a(32257),Ir=a(96261),Pr=a(68010),Dr=a(80518),Rr=a(71586);const Ar=(0,c.cn)("ydb-diagnostic-card");function Lr(e){let{children:t,className:a,active:n}=e;return(0,d.jsx)("div",{className:Ar({active:n},a),children:t})}const _r=(0,c.cn)("healthcheck"),Or={[cr.UNSPECIFIED]:Cr.Z,[cr.GOOD]:Ir.Z,[cr.DEGRADED]:Pr.Z,[cr.MAINTENANCE_REQUIRED]:Dr.Z,[cr.EMERGENCY]:Rr.Z};function Mr(e){const{tenantName:t,active:a}=e,[n]=(0,y.Rj)(),{currentData:r,isFetching:s,error:o}=Yn.useGetHealthcheckInfoQuery({database:t},{pollingInterval:n}),l=s&&void 0===r;return(0,d.jsxs)(Lr,{className:_r("preview"),active:a,children:[(0,d.jsx)("div",{className:_r("preview-header"),children:(0,d.jsx)("div",{className:_r("preview-title-wrapper"),children:(0,d.jsx)("div",{className:_r("preview-title"),children:Tr("title.healthcheck")})})}),(()=>{if(o)return(0,d.jsx)(I.V,{error:o,defaultMessage:Tr("no-data")});if(l)return(0,d.jsx)(i.a,{size:"m"});const e=(null===r||void 0===r?void 0:r.self_check_result)||cr.UNSPECIFIED,t=e.toLowerCase();return(0,d.jsx)("div",{className:_r("preview-content"),children:(0,d.jsxs)("div",{className:_r("preview-issue",{[t]:!0}),children:[(0,d.jsx)(me.J,{className:_r("preview-status-icon"),data:Or[e]}),(0,d.jsx)("div",{className:_r("self-check-status-indicator"),children:e.replace(/_/g," ")})]})})})()]})}var kr=a(67359),Fr=a(98366);const zr=(0,c.cn)("ydb-metrics-card"),qr=e=>{let t;return"Warning"===e&&(t=vr.K.Yellow),"Danger"===e&&(t=vr.K.Red),t?(0,d.jsx)(Fr.J,{status:t,mode:"icons",size:"l"}):null};function Ur(e){let{active:t,label:a,status:n,metrics:r}=e;return(0,d.jsxs)(Lr,{className:zr({active:t}),active:t,children:[(0,d.jsxs)("div",{className:zr("header"),children:[a&&(0,d.jsx)("div",{className:zr("label"),children:a}),qr(n)]}),(0,d.jsx)("div",{className:zr("content"),children:r.map(((e,t)=>{let{title:a,...n}=e;return(0,d.jsxs)("div",{className:zr("metric"),children:[(0,d.jsx)("div",{className:zr("metric-title"),children:a}),(0,d.jsx)(kr.y,{size:"xs",colorizeProgress:!0,...n})]},t)}))})]})}const Gr=(0,c.cn)("metrics-cards");function Br(e){let{poolsCpuStats:t,memoryStats:a,blobStorageStats:n,tabletStorageStats:r,tenantName:s}=e;const o=(0,Ca.TH)(),{metricsTab:i}=(0,y.ix)((e=>e.tenant)),l=(0,N.mB)(o),c=e=>e===i?"":e,u={[S.Xk.cpu]:(0,Ue.Sj)({...l,[Ue.XV.metricsTab]:c(S.Xk.cpu)}),[S.Xk.storage]:(0,Ue.Sj)({...l,[Ue.XV.metricsTab]:c(S.Xk.storage)}),[S.Xk.memory]:(0,Ue.Sj)({...l,[Ue.XV.metricsTab]:c(S.Xk.memory)}),[S.Xk.healthcheck]:(0,Ue.Sj)({...l,[Ue.XV.metricsTab]:c(S.Xk.healthcheck)})};return(0,d.jsxs)("div",{className:Gr(),children:[(0,d.jsx)(f.rU,{to:u.cpu,className:Gr("tab"),children:(0,d.jsx)(Qr,{poolsCpuStats:t,active:i===S.Xk.cpu})}),(0,d.jsx)(f.rU,{to:u.storage,className:Gr("tab"),children:(0,d.jsx)(Hr,{blobStorageStats:n,tabletStorageStats:r,active:i===S.Xk.storage})}),(0,d.jsx)(f.rU,{to:u.memory,className:Gr("tab"),children:(0,d.jsx)(Zr,{memoryStats:a,active:i===S.Xk.memory})}),(0,d.jsx)(f.rU,{to:u.healthcheck,className:Gr("tab"),children:(0,d.jsx)(Mr,{tenantName:s,active:i===S.Xk.healthcheck})})]})}function Qr(e){let{poolsCpuStats:t=[],active:a}=e,n=Er.L.Unspecified;const r=t.filter((e=>!("Batch"===e.name||"IO"===e.name))).map((e=>{const{name:t,usage:a,limit:r,used:s}=e,o=(0,fn.Vn)(a);return Er.l[o]>Er.l[n]&&(n=o),{title:t,value:s,capacity:r,warningThreshold:fn.hJ,dangerThreshold:fn.Gz}}));return(0,d.jsx)(Ur,{label:Wn("cards.cpu-label"),active:a,metrics:r,status:n})}function Hr(e){let{blobStorageStats:t=[],tabletStorageStats:a,active:n}=e,r=Er.L.Unspecified;const s=(a||t).map((e=>{const{name:t,used:a,limit:n,usage:s}=e,o=(0,fn._W)(s);return Er.l[o]>Er.l[r]&&(r=o),{title:t,value:a,capacity:n,warningThreshold:fn._g,dangerThreshold:fn.nD,formatValues:R.QO}}));return(0,d.jsx)(Ur,{label:Wn("cards.storage-label"),active:n,metrics:s,status:r})}function Zr(e){let{active:t,memoryStats:a=[]}=e,n=Er.L.Unspecified;const r=a.map((e=>{const{name:t,used:a,limit:r,usage:s}=e,o=(0,fn.Lv)(s);return Er.l[o]>Er.l[n]&&(n=o),{title:t,value:a,capacity:r,warningThreshold:fn.B8,dangerThreshold:fn.nr,formatValues:R.QO}}));return(0,d.jsx)(Ur,{label:Wn("cards.memory-label"),active:t,metrics:r,status:n})}var Vr=a(46925);const Wr=le.h.injectEndpoints({endpoints:e=>({getTopNodes:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getNodes({type:"any",sortOrder:-1,limit:x.fl,...e},{signal:a});return{data:(0,Vr.nH)(t).Nodes}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var Jr=a(682);const Kr=(0,c.cn)("tenant-overview");function Yr(e){let{title:t,error:a,loading:r,tableClassNameModifiers:s={},...o}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:Kr("title"),children:t}),(0,d.jsx)("div",{className:Kr("table",s),children:a?(0,d.jsx)(I.V,{error:a}):r?(0,d.jsx)(oe.h,{rows:x.fl}):(0,d.jsx)(se.G,{settings:x.E6,...o})})]})}var Xr=a(68036);const $r=e=>{let{prefix:t=Wn("top"),entity:a,postfix:r,link:s}=e;return s?(0,d.jsxs)(n.Fragment,{children:[t," ",(0,d.jsx)(Xr.h,{to:s,children:a})," ",r]}):"".concat(t," ").concat(a," ").concat(r)};function es(e){let{tenantName:t,additionalNodesProps:a}=e;const n=(0,y.A3)(),[r]=(0,y.Rj)(),s=(0,Jr.LF)(null===a||void 0===a?void 0:a.getNodeRef),{currentData:o,isFetching:i,error:l}=Wr.useGetTopNodesQuery({tenant:t,sortValue:"CPU"},{pollingInterval:r}),c=i&&void 0===o,u=o,m=$r({entity:Wn("nodes"),postfix:Wn("by-pools-usage"),link:(0,Ue.Sj)({...n,[Ue.XV.diagnosticsTab]:S.qQ.nodes})});return(0,d.jsx)(Yr,{columnsWidthLSKey:Jr.t5,data:u||[],columns:s,title:m,loading:c,error:l,emptyDataMessage:Wn("top-nodes.empty-data")})}function ts(e){let{tenantName:t,additionalNodesProps:a}=e;const n=(0,y.A3)(),[r]=(0,y.Rj)(),s=(0,Jr.sQ)(null===a||void 0===a?void 0:a.getNodeRef),{currentData:o,isFetching:i,error:l}=Wr.useGetTopNodesQuery({tenant:t,sortValue:"LoadAverage"},{pollingInterval:r}),c=i&&void 0===o,u=o,m=$r({entity:Wn("nodes"),postfix:Wn("by-load"),link:(0,Ue.Sj)({...n,[Ue.XV.diagnosticsTab]:S.qQ.nodes})});return(0,d.jsx)(Yr,{columnsWidthLSKey:Jr.t5,data:u||[],columns:s,title:m,loading:c,error:l,emptyDataMessage:Wn("top-nodes.empty-data")})}var as=a(83786);const ns=le.h.injectEndpoints({endpoints:e=>({getOverviewTopQueries:e.query({queryFn:async(e,t)=>{let{database:a}=e,{signal:n}=t;try{const e=await window.api.sendQuery({schema:"modern",query:(r=a,"\nSELECT\n    CPUTime as CPUTimeUs,\n    QueryText,\nFROM `".concat(r,"/.sys/top_queries_by_cpu_time_one_hour`\nORDER BY CPUTimeUs DESC\nLIMIT ").concat(x.fl,"\n")),database:a,action:"execute-scan"},{signal:n});return(0,ie.gW)(e)?{error:e}:{data:(0,ie.gY)(e)}}catch(s){return{error:s||new Error("Unauthorized")}}var r},providesTags:["All"]})}),overrideExisting:"throw"});var rs=a(99683);const ss=(0,c.cn)("kv-truncated-query"),os=e=>{let{value:t="",maxQueryHeight:a=6}=e;const r=t.split("\n");if(r.length>a){const e=r.slice(0,a).join("\n"),t="\n...\nThe request was truncated. Click on the line to show the full query on the query tab";return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("span",{className:ss(),children:e}),(0,d.jsx)("span",{className:ss("message",{color:"secondary"}),children:t})]})}return(0,d.jsx)(n.Fragment,{children:t})},is=e=>{let{value:t=""}=e;return(0,d.jsx)(rs.l,{contentClassName:ss("popover-content"),content:t,children:t})},ls="CPUTime",cs="QueryText",ds="EndTime",us="ReadRows",ms="ReadBytes",ps="UserSID",hs="OneLineQueryText",vs="QueryHash",gs="Duration",xs="CPUCores",ys="PeakTime",bs="IntervalEnd",Ss=[xs,"DataSize","InFlightTxCount"],js=[ls,ds,us,ms,ps,gs],fs=e=>Object.values(Ss).includes(e);var Ts=a(47694),Ns=a.n(Ts);const ws=6,Es={...x.LE,dynamicRenderType:"variable"},Cs=(0,c.cn)("kv-top-queries"),Is="topQueriesColumnsWidth",Ps={name:ls,sortAccessor:e=>Number(e.CPUTimeUs),render:e=>{var t;let{row:a}=e;return(0,Ve.zm)((0,Ve.BO)(null!==(t=a.CPUTimeUs)&&void 0!==t?t:void 0))},width:120,align:ne.ZP.RIGHT,sortable:!1},Ds={name:cs,sortAccessor:e=>Number(e.CPUTimeUs),render:e=>{var t;let{row:a}=e;return(0,d.jsx)("div",{className:Cs("query"),children:(0,d.jsx)(os,{value:null===(t=a.QueryText)||void 0===t?void 0:t.toString(),maxQueryHeight:ws})})},sortable:!1,width:500},Rs={name:ds,render:e=>{let{row:t}=e;return(0,R.o0)(new Date(t.EndTime).getTime())},align:ne.ZP.RIGHT,width:200},As={name:us,render:e=>{let{row:t}=e;return(0,R.uf)(t.ReadRows)},sortAccessor:e=>Number(e.ReadRows),align:ne.ZP.RIGHT,width:150},Ls={name:ms,render:e=>{let{row:t}=e;return(0,R.uf)(t.ReadBytes)},sortAccessor:e=>Number(e.ReadBytes),align:ne.ZP.RIGHT,width:150},_s={name:ps,render:e=>{let{row:t}=e;return(0,d.jsx)("div",{className:Cs("user-sid"),children:t.UserSID||"\u2013"})},sortAccessor:e=>String(e.UserSID),align:ne.ZP.LEFT},Os={name:hs,header:"QueryText",render:e=>{var t;let{row:a}=e;return(0,d.jsx)(is,{value:null===(t=a.QueryText)||void 0===t?void 0:t.toString()})},sortable:!1,width:500},Ms={name:vs,render:e=>{let{row:t}=e;return a=String(t.QueryText),(Ns().str(a)>>>0).toString(16).toUpperCase().padStart(8,"0");var a},width:130,sortable:!1},ks={name:gs,header:"Duration",render:e=>{var t;let{row:a}=e;return(0,Ve.zm)((0,Ve.BO)(null!==(t=a.Duration)&&void 0!==t?t:void 0))},sortAccessor:e=>Number(e.Duration),align:ne.ZP.RIGHT,width:150},Fs=()=>[Ms,Os,Ps];function zs(e){let{tenantName:t}=e;const a=(0,y.zL)(),r=(0,Ca.TH)(),s=(0,Ca.k6)(),o=(0,N.mB)(r),[i]=(0,y.Rj)(),l=Fs(),{currentData:c,isFetching:u,error:m}=ns.useGetOverviewTopQueriesQuery({database:t},{pollingInterval:i}),p=u&&void 0===c,{result:h}=c||{},v=n.useCallback((e=>{const{QueryText:t}=e;a((0,as.B8)({input:t}));const n=(0,N.mB)(r),o=(0,Ue.Sj)({...n,[S.bS]:S.m2.query,[Ue.XV.queryTab]:S._0.newQuery});s.push(o)}),[a,s,r]),g=$r({entity:Wn("queries"),postfix:Wn("by-cpu-time"),link:(0,Ue.Sj)({...o,[Ue.XV.diagnosticsTab]:S.qQ.topQueries})});return(0,d.jsx)(Yr,{columnsWidthLSKey:Is,data:h||[],columns:l,onRowClick:v,title:g,loading:p,error:(0,ie.fV)(m),rowClassName:()=>Kr("top-queries-row")})}function qs(e,t){const a=t?"CAST(SUBSTRING(CAST(Path AS String), ".concat(t.length,") AS Utf8) AS Path"):"Path";return"SELECT\n    ".concat(a,",\n    TabletId,\n    CPUCores,\nFROM `.sys/partition_stats`\nWHERE\n    Path='").concat(e,"'\n    OR Path LIKE '").concat(e,"/%'\nORDER BY CPUCores DESC\nLIMIT ").concat(x.fl)}const Us=le.h.injectEndpoints({endpoints:e=>({getTopShards:e.query({queryFn:async(e,t)=>{let{database:a,path:n=""}=e,{signal:r}=t;try{const e=await window.api.sendQuery({schema:"modern",query:qs(n,a),database:a,action:"execute-scan"},{signal:r});return(0,ie.gW)(e)?{error:e}:{data:(0,ie.gY)(e)}}catch(s){return{error:s||new Error("Unauthorized")}}},providesTags:["All"]})}),overrideExisting:"throw"});var Gs=a(58682),Bs=a(86017);function Qs(e){let{path:t,location:a,...n}=e;const r=(0,N.mB)(a),s=(0,N.vF)({...r,schema:t});return(0,d.jsx)(Bs.r,{view:"normal",...n,href:s})}var Hs=a(80816);const Zs=(0,a(99106).p)(60,80,["success","warning","danger"]);var Vs=a(92398);const Ws="topShardsColumnsWidth",Js="TabletId",Ks="CPUCores",Ys="DataSize",Xs="Path",$s="NodeId",eo="InFlightTxCount",to={TabletId:"TabletId",CPUCores:"CPUCores",DataSize:"DataSize (B)",Path:"Path",NodeId:"NodeId",PeakTime:"PeakTime",InFlightTxCount:"InFlightTxCount",IntervalEnd:"IntervalEnd"};const ao=(e,t)=>({name:Xs,header:to[Xs],render:a=>{let{row:n}=a;return(0,d.jsx)(Qs,{path:e+n.Path,location:t,children:n.Path})},sortable:!1,width:300}),no={name:Ks,header:to[Ks],render:e=>{let{row:t}=e;return a=t.CPUCores||0,"".concat((0,R.W0)(100*Number(a),2),"%");var a},align:ne.ZP.RIGHT},ro={name:Ys,header:to[Ys],render:e=>{let{row:t}=e;return(0,R.uf)(t.DataSize)},align:ne.ZP.RIGHT},so={name:Js,header:to[Js],render:e=>{var t;let{row:a}=e;return a.TabletId?(0,d.jsx)(ba.A,{name:null===(t=a.TabletId)||void 0===t?void 0:t.toString(),path:(0,N.ax)(N.ZP.tablet,{id:a.TabletId}),hasClipboardButton:!0,showStatus:!1,additionalControls:(0,d.jsx)(Gs.T,{href:"".concat(_.y3,"/tablets?TabletID=").concat(a.TabletId)})}):"\u2013"},sortable:!1,width:190},oo={name:$s,header:to[$s],render:e=>{let{row:t}=e;return t.NodeId?(0,d.jsx)(ut.h,{to:(0,Vs.a3)(t.NodeId),children:t.NodeId}):"\u2013"},align:ne.ZP.RIGHT},io={name:Ks,header:to[Ks],render:e=>{let{row:t}=e;return(0,d.jsx)(Hs.a,{value:(0,R.W0)(100*Number(t.CPUCores),2),theme:Zs(100*Number(t.CPUCores))})},align:ne.ZP.RIGHT,sortable:!1,width:140,resizeMinWidth:140},lo={name:eo,header:to[eo],render:e=>{let{row:t}=e;return(0,R.uf)(t.InFlightTxCount)},align:ne.ZP.RIGHT},co=e=>{let{tenantName:t,path:a}=e;const n=(0,Ca.TH)(),r=(0,N.mB)(n),[s]=(0,y.Rj)(),{currentData:o,isFetching:i,error:l}=Us.useGetTopShardsQuery({database:t,path:a},{pollingInterval:s}),c=i&&void 0===o,{result:u}=o||{},m=((e,t)=>[so,ao(e,t),io])(t,n),p=$r({entity:Wn("shards"),postfix:Wn("by-cpu-usage"),link:(0,Ue.Sj)({...r,[Ue.XV.diagnosticsTab]:S.qQ.topShards})});return(0,d.jsx)(Yr,{columnsWidthLSKey:Ws,data:u||[],columns:m,title:p,loading:c,error:(0,ie.fV)(l)})},uo=[{title:Wn("charts.cpu-usage"),metrics:["IC","IO","Batch","User","System"].map((e=>({target:"resources.cpu.".concat(e,".usage"),title:e}))),options:{dataType:"percent",scaleRange:{min:0,max:1}}}];function mo(e){let{tenantName:t,additionalNodesProps:a}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Zn,{database:t,charts:uo}),(0,d.jsx)(ts,{tenantName:t,additionalNodesProps:a}),(0,d.jsx)(es,{tenantName:t,additionalNodesProps:a}),(0,d.jsx)(co,{tenantName:t,path:t}),(0,d.jsx)(zs,{tenantName:t})]})}function po(e){let{tenantName:t,additionalNodesProps:a}=e;const n=(0,y.A3)(),[r]=(0,y.Rj)(),s=(0,Jr.Cj)({getNodeRef:null===a||void 0===a?void 0:a.getNodeRef}),{currentData:o,isFetching:i,error:l}=Wr.useGetTopNodesQuery({tenant:t,sortValue:"Memory"},{pollingInterval:r}),c=i&&void 0===o,u=o,m=$r({entity:Wn("nodes"),postfix:Wn("by-memory"),link:(0,Ue.Sj)({...n,[Ue.XV.diagnosticsTab]:S.qQ.nodes})});return(0,d.jsx)(Yr,{columnsWidthLSKey:Jr.t5,data:u||[],columns:s,title:m,loading:c,error:l,emptyDataMessage:Wn("top-nodes.empty-data")})}const ho=[{title:Wn("charts.memory-usage"),metrics:[{target:"resources.memory.used_bytes",title:Wn("charts.memory-usage")}],options:{dataType:"size"}}];function vo(e){let{tenantName:t}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Zn,{database:t,charts:ho}),(0,d.jsx)(po,{tenantName:t})]})}var go=a(23373),xo=a(11431),yo=a(92092);const bo=e=>{const{StoragePools:t,StorageGroups:a}=e,n=(0,yo.sl)(a,t);return t&&n.sort(((e,t)=>t.Usage-e.Usage)),{groups:n.slice(0,x.fl)}},So=le.h.injectEndpoints({endpoints:e=>({getTopStorageGroups:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getStorageInfo({visibleEntities:"all",sortOrder:-1,sortValue:"Usage",limit:x.fl,version:xo.w.v2,...e},{signal:a});return{data:bo(t).groups||[]}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var jo=a(92076);function fo(e){let{tenant:t}=e;const a=(0,y.A3)(),[n]=(0,y.Rj)(),r=(0,jo.mk)(),{currentData:s,isFetching:o,error:i}=So.useGetTopStorageGroupsQuery({tenant:t},{pollingInterval:n}),l=o&&void 0===s,c=s,u=$r({entity:Wn("groups"),postfix:Wn("by-usage"),link:(0,Ue.Sj)({...a,[Ue.XV.diagnosticsTab]:S.qQ.storage})});return(0,d.jsx)(Yr,{columnsWidthLSKey:jo.Ty,data:c||[],columns:r,title:u,loading:l,error:i})}const To=e=>"\nSELECT\n    Path, SUM(DataSize) as Size\nFROM `".concat(e,"/.sys/partition_stats`\nGROUP BY Path\n    ORDER BY Size DESC\n    LIMIT ").concat(x.fl,"\n"),No=le.h.injectEndpoints({endpoints:e=>({getTopTables:e.query({queryFn:async(e,t)=>{let{path:a}=e,{signal:n}=t;try{const e=await window.api.sendQuery({schema:"modern",query:To(a),database:a,action:"execute-scan"},{signal:n});return(0,ie.gW)(e)?{error:e}:{data:(0,ie.gY)(e)}}catch(r){return{error:r||"Unauthorized"}}},providesTags:["All"]})}),overrideExisting:"throw"}),wo="topTablesTableColumnsWidth";function Eo(e){let{path:t}=e;const a=(0,Ca.TH)(),[n]=(0,y.Rj)(),{currentData:r,error:s,isFetching:o}=No.useGetTopTablesQuery({path:t},{pollingInterval:n}),i=o&&void 0===r,{result:l}=r||{},c=[{name:"Size",width:100,sortable:!1,render:e=>{let{row:t}=e;return(e=>{const t=(0,Ze.dT)(null!==l&&void 0!==l&&l.length?Number(l[0].Size):0,0);return(0,Ze.td)({value:e,size:t,precision:1})})(Number(t.Size))},align:ne.ZP.RIGHT},{name:"Path",width:700,sortable:!1,render:e=>{let{row:t}=e;return t.Path?(0,d.jsx)(rs.l,{content:t.Path,children:(0,d.jsx)(Qs,{path:String(t.Path),location:a,children:t.Path})}):null}}],u=$r({entity:Wn("tables"),postfix:Wn("by-size")});return(0,d.jsx)(Yr,{columnsWidthLSKey:wo,data:l||[],columns:c,title:u,loading:i,error:(0,ie.fV)(s)})}const Co=[{title:Wn("charts.storage-usage"),metrics:[{target:"resources.storage.used_bytes",title:Wn("charts.storage-usage")}],options:{dataType:"size"}}];function Io(e){let{tenantName:t,metrics:a}=e;const{blobStorageUsed:r,tabletStorageUsed:s,blobStorageLimit:o,tabletStorageLimit:i}=a,l=[{label:(0,d.jsx)(pt,{text:Wn("storage.tablet-storage-title"),popoverContent:Wn("storage.tablet-storage-description")}),value:(0,d.jsx)(kr.y,{value:s,capacity:i,formatValues:R.QO,colorizeProgress:!0,warningThreshold:75,dangerThreshold:85})},{label:(0,d.jsx)(pt,{text:Wn("storage.db-storage-title"),popoverContent:Wn("storage.db-storage-description")}),value:(0,d.jsx)(kr.y,{value:r,capacity:o,formatValues:R.QO,colorizeProgress:!0,warningThreshold:75,dangerThreshold:85})}];return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Zn,{database:t,charts:Co}),(0,d.jsx)(go.Z,{className:Kr("storage-info"),title:"Storage details",info:l}),(0,d.jsx)(Eo,{path:t}),(0,d.jsx)(fo,{tenant:t})]})}function Po(e){var t,a,n;let{tenantName:r,additionalTenantProps:s,additionalNodesProps:o}=e;const{metricsTab:i}=(0,y.ix)((e=>e.tenant)),[l]=(0,y.Rj)(),{currentData:c,isFetching:u}=w.$1.useGetTenantInfoQuery({path:r},{pollingInterval:l}),m=u&&void 0===c,{Name:p,Type:h,Overall:v}=c||{},b=(0,ue.TV)(h),{data:j}=(0,g.hz)({path:r}),{Tables:f,Topics:T}=(null===j||void 0===j||null===(t=j.PathDescription)||void 0===t||null===(a=t.DomainDescription)||void 0===a?void 0:a.DiskSpaceUsage)||{},N=[null===f||void 0===f?void 0:f.TotalSize,null===T||void 0===T?void 0:T.AccountSize,null===T||void 0===T?void 0:T.DataSize,null===T||void 0===T?void 0:T.ReserveSize,null===T||void 0===T?void 0:T.UsedReserveSize].reduce(((e,t)=>t?e+Number(t):e),0),E={...c,Metrics:{...null===c||void 0===c?void 0:c.Metrics,Storage:String(N)}},{blobStorage:C,tabletStorage:I,blobStorageLimit:P,tabletStorageLimit:D,poolsStats:R,memoryStats:A,blobStorageStats:L,tabletStorageStats:_}=(0,fn.HH)(E),O={blobStorageUsed:C,blobStorageLimit:P,tabletStorageUsed:I,tabletStorageLimit:D};return m?(0,d.jsx)("div",{className:Kr("loader"),children:(0,d.jsx)(jn.a,{size:"m"})}):(0,d.jsxs)("div",{className:Kr(),children:[(0,d.jsxs)("div",{className:Kr("info"),children:[(0,d.jsx)("div",{className:Kr("top-label"),children:b}),(0,d.jsxs)("div",{className:Kr("top"),children:[(0,d.jsx)("div",{className:Kr("tenant-name-wrapper"),children:(0,d.jsx)(ba.A,{status:v,name:p||x.FU,withLeftTrim:!0,hasClipboardButton:Boolean(c),clipboardButtonAlwaysVisible:!0})}),null===s||void 0===s||null===(n=s.getMonitoringLink)||void 0===n?void 0:n.call(s,p,h)]}),(0,d.jsx)(Br,{poolsCpuStats:R,memoryStats:A,blobStorageStats:L,tabletStorageStats:_,tenantName:r})]}),(()=>{switch(i){case S.Xk.cpu:return(0,d.jsx)(mo,{tenantName:r,additionalNodesProps:o});case S.Xk.storage:return(0,d.jsx)(Io,{tenantName:r,metrics:O});case S.Xk.memory:return(0,d.jsx)(vo,{tenantName:r});case S.Xk.healthcheck:return(0,d.jsx)(wr,{tenantName:r});default:return(0,d.jsx)(Kn,{database:r})}})()]})}const Do=(0,c.cn)("kv-detailed-overview");const Ro=function(e){const{type:t,tenantName:a,path:n,additionalTenantProps:r,additionalNodesProps:s}=e,o=a===n;return(0,d.jsx)("div",{className:Do(),children:o?(0,d.jsx)("div",{className:Do("section"),children:(0,d.jsx)(Po,{tenantName:a,additionalTenantProps:r,additionalNodesProps:s})}):(0,d.jsx)(Sn,{type:t,path:n})})},Ao={id:S.qQ.overview,title:"Info"},Lo={id:S.qQ.schema,title:"Schema"},_o={id:S.qQ.topQueries,title:"Top queries"},Oo={id:S.qQ.topShards,title:"Top shards"},Mo={id:S.qQ.nodes,title:"Nodes"},ko={id:S.qQ.tablets,title:"Tablets"},Fo={id:S.qQ.storage,title:"Storage"},zo={id:S.qQ.network,title:"Network"},qo={id:S.qQ.describe,title:"Describe"},Uo={id:S.qQ.hotKeys,title:"Hot keys"},Go={id:S.qQ.graph,title:"Graph"},Bo={id:S.qQ.consumers,title:"Consumers"},Qo={id:S.qQ.partitions,title:"Partitions"},Ho=[Ao,ko,qo],Zo=[Ao,_o,Oo,Mo,ko,Fo,zo,qo],Vo=[Ao,Lo,Oo,Mo,Go,ko,Uo,qo],Wo=[Ao,Lo,Oo,Mo,Go,ko,qo],Jo=[Ao,Oo,Mo,qo],Ko=[Ao,Bo,Qo,Mo,ko,qo],Yo=[Ao,Bo,Qo,Mo,ko,qo],Xo=[Ao,qo],$o=[Ao,qo],ei=[Ao,qo],ti={[Me.gb.EPathTypeInvalid]:void 0,[Me.gb.EPathTypeSubDomain]:Zo,[Me.gb.EPathTypeExtSubDomain]:Zo,[Me.gb.EPathTypeColumnStore]:Zo,[Me.gb.EPathTypeTable]:Vo,[Me.gb.EPathTypeColumnTable]:Wo,[Me.gb.EPathTypeDir]:Jo,[Me.gb.EPathTypeTableIndex]:Jo,[Me.gb.EPathTypeCdcStream]:Ko,[Me.gb.EPathTypePersQueueGroup]:Yo,[Me.gb.EPathTypeExternalDataSource]:Xo,[Me.gb.EPathTypeExternalTable]:$o,[Me.gb.EPathTypeView]:ei,[Me.gb.EPathTypeReplication]:Ho},ai=e=>e&&ti[e]||Jo;var ni=a(77280),ri=a(91387);const si=le.h.injectEndpoints({endpoints:e=>({getHotKeys:e.query({queryFn:async(e,t)=>{let{path:a}=e,{signal:n}=t;try{var r;const e=await window.api.getHotKeys(a,!0,{signal:n});if(Array.isArray(e.hotkeys))return{data:e.hotkeys};await Promise.race([new Promise((e=>{setTimeout(e,5e3)})),new Promise(((e,t)=>{n.addEventListener("abort",t)}))]);return{data:null!==(r=(await window.api.getHotKeys(a,!1,{signal:n})).hotkeys)&&void 0!==r?r:null}}catch(s){return{error:s}}},providesTags:["All"]})}),overrideExisting:"throw"}),oi=JSON.parse('{"hot-keys-collecting":"Please wait a little while we are collecting hot keys samples...","no-data":"No information about hot keys","help":"Hot keys contains a list of table primary key values that are accessed most often. Sample is collected upon request to the tab during 5s time interval. Samples column indicates how many requests to the particular key value were registered during collection phase."}'),ii=(0,pe.wZ)("ydb-hot-keys",{en:oi}),li=(0,c.cn)("ydb-hot-keys"),ci={accessSample:"accessSample",keyValues:"keyValues"},di=function(){return[...(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(((e,t)=>({name:e,header:(0,d.jsxs)("div",{className:li("primary-key-column"),children:[(0,d.jsx)(me.J,{data:be,width:12,height:7}),e]}),render:e=>{let{row:a}=e;return a.keyValues[t]},align:ne.ZP.RIGHT,sortable:!1}))),{name:ci.accessSample,header:"Samples",render:e=>{let{row:t}=e;return t.accessSample},align:ne.ZP.RIGHT,sortable:!1}]};function ui(e){var t,a;let{path:r}=e;const{currentData:s,isFetching:o,error:i}=si.useGetHotKeysQuery({path:r}),l=o&&void 0===s,{data:c,isLoading:u}=(0,g.hz)({path:r}),m=null===c||void 0===c||null===(t=c.PathDescription)||void 0===t||null===(a=t.Table)||void 0===a?void 0:a.KeyColumnNames,p=n.useMemo((()=>di(m)),[m]);return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(mi,{}),l||u?(0,d.jsx)("div",{children:ii("hot-keys-collecting")}):i?(0,d.jsx)(I.V,{error:i}):s?(0,d.jsx)(se.G,{wrapperClassName:li("table"),columns:p,data:s,settings:x.LE,initialSortOrder:{columnId:ci.accessSample,order:ne.ZP.DESCENDING}}):(0,d.jsx)("div",{children:ii("no-data")})]})}function mi(){const[e,t]=(0,y.yu)(x.RI);return e?null:(0,d.jsxs)(ri.Z,{theme:"info",view:"filled",type:"container",className:li("help-card"),children:[ii("help"),(0,d.jsx)(Gn.z,{className:li("help-card__close-button"),view:"flat",onClick:()=>t(!0),children:(0,d.jsx)(me.J,{data:ni.Z,size:18})})]})}var pi=a(56350),hi=a(74221);const vi=le.h.injectEndpoints({endpoints:e=>({getNetworkInfo:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.getNetwork(e,{signal:a})}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var gi=a(80839);const xi=(0,c.cn)("node-network");function yi(){}function bi(e){let{nodeId:t,connected:a,capacity:r,rack:s,status:o,onClick:i=yi,onMouseEnter:l=yi,onMouseLeave:c=yi,showID:u,isBlurred:m}=e;const p=n.useRef(null),h=o||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=Math.floor(e/t*100);return 100===a?vr.K.Green:a>=70?vr.K.Yellow:a>=1?vr.K.Red:vr.K.Grey}(a,r);return(0,d.jsx)("div",{ref:p,className:xi({[h.toLowerCase()]:!0,id:u,blur:m}),onMouseEnter:()=>{l(p.current,{nodeId:t,connected:a,capacity:r,rack:s},"node")},onMouseLeave:()=>{c()},onClick:()=>i(t),children:u?t:null})}const Si=e=>null===e||void 0===e?void 0:e.reduce(((e,t)=>t.Connected?e+1:e),0);var ji,fi,Ti,Ni,wi,Ei,Ci,Ii,Pi,Di,Ri,Ai,Li,_i,Oi;function Mi(){return Mi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Mi.apply(this,arguments)}const ki=function(e){return n.createElement("svg",Mi({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 221 204"},e),ji||(ji=n.createElement("path",{d:"M68.46 2.529v25.227c0 1.227.876 2.278 2.102 2.511 16.643 2.979 29.14 17.812 28.498 35.448-.642 18.045-15.359 32.703-33.345 33.403-17.636.643-32.41-11.854-35.448-28.44a2.562 2.562 0 00-2.51-2.102H2.528c-1.519 0-2.687 1.285-2.512 2.745 3.446 32.703 31.243 58.106 64.939 57.814 35.155-.292 63.829-29.024 64.121-64.18.292-33.695-25.17-61.492-57.873-64.938-1.46-.175-2.744.993-2.744 2.512z",fill:"#EBF2FA"})),fi||(fi=n.createElement("path",{d:"M22.736 18.354l17.811 17.812c.876.876 2.278.992 3.329.233 4.146-3.095 9.052-5.197 14.366-6.19 1.226-.233 2.102-1.226 2.102-2.511V2.528a2.502 2.502 0 00-2.803-2.51C44.46 1.418 32.488 6.674 22.91 14.674c-1.168.935-1.226 2.628-.175 3.68zm-9.403 6.133C6.093 33.83 1.303 45.16.02 57.54c-.176 1.46 1.05 2.745 2.51 2.745H27.7a2.562 2.562 0 002.511-2.103c.818-4.672 2.628-9.051 5.14-12.847a2.642 2.642 0 00-.293-3.212L17.13 24.312c-1.05-1.11-2.861-.993-3.796.175zm67.275 107.392h32.995c1.868 0 3.387 1.518 3.445 3.445v65.231a3.451 3.451 0 01-3.445 3.445H80.608a3.452 3.452 0 01-3.446-3.445v-65.231a3.451 3.451 0 013.446-3.445zm77.844 27.097h-32.878a3.514 3.514 0 00-3.503 3.504v37.959a3.514 3.514 0 003.503 3.504h32.878a3.515 3.515 0 003.504-3.504V162.48a3.515 3.515 0 00-3.504-3.504zm12.205 18.28h32.586a3.639 3.639 0 013.621 3.62v19.388a3.639 3.639 0 01-3.621 3.621h-32.586a3.639 3.639 0 01-3.62-3.621v-19.388a3.638 3.638 0 013.62-3.62z",fill:"#EBF2FA"})),Ti||(Ti=n.createElement("path",{d:"M134.275 171.532h-113c-5.84 0-10.628-4.789-10.628-10.629v-73.23c0-5.84 4.788-10.629 10.628-10.629h112.941c5.84 0 10.629 4.789 10.629 10.629v73.23c.058 5.899-4.731 10.629-10.57 10.629v0z",stroke:"#2EE5C0",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})),Ni||(Ni=n.createElement("path",{d:"M21.625 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074zM31.494 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074zM41.363 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074z",fill:"#2EE5C0"})),wi||(wi=n.createElement("path",{d:"M10.822 98.592h133.673",stroke:"#2EE5C0",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})),Ei||(Ei=n.createElement("path",{d:"M184.555 149.164L57.89 156.172c-4.263.234-7.767-3.037-7.767-7.3V51.114c0-4.263 3.504-7.533 7.767-7.3l126.665 7.008c3.27.176 5.898 3.33 5.898 7.008v84.327c0 3.679-2.628 6.832-5.898 7.007z",fill:"#027BF3"})),Ci||(Ci=n.createElement("path",{d:"M65.13 54.151c0 1.986-1.576 3.504-3.562 3.387-1.985-.058-3.562-1.752-3.562-3.737 0-1.986 1.635-3.504 3.562-3.387 1.927.058 3.562 1.752 3.562 3.737zm11.506.466a3.38 3.38 0 01-3.504 3.388c-1.927-.059-3.504-1.753-3.504-3.68a3.38 3.38 0 013.504-3.387c1.927.117 3.504 1.752 3.504 3.68zm7.825 3.855c1.869.117 3.387-1.402 3.387-3.329 0-1.927-1.518-3.562-3.387-3.62-1.927-.117-3.445 1.401-3.445 3.328 0 1.927 1.576 3.562 3.445 3.62z",fill:"#fff"})),Ii||(Ii=n.createElement("path",{d:"M75.467 142.974V85.277c-3.971-.525-8.584-.409-13.899.7v57.64l13.899-.643zM88.84 90.651v51.799l-11.096.467v-57.23c4.322.934 7.942 2.745 11.096 4.964zm13.431 13.899a1.618 1.618 0 01-.146-.176 1.487 1.487 0 00-.146-.175c-.42-.51-.841-1.026-1.265-1.546-2.875-3.522-5.874-7.197-9.538-10.25v49.93l11.095-.467V104.55zm13.432 5.722c-3.913-.058-7.709-.701-11.096-3.445v34.922l11.096-.468v-31.009zm13.431-.409c-2.764-.173-5.529.006-8.246.181-.957.062-1.907.123-2.849.169v30.951l11.095-.467v-30.834zm24.002 29.841l-8.234.35v-22.191c8.176 9.285 8.234 21.841 8.234 21.841zM140.113 113.6a19.774 19.774 0 012.453 1.927v24.644l-11.096.467v-30.483c2.92.467 5.782 1.46 8.643 3.445z",fill:"#00236B"})),Pi||(Pi=n.createElement("path",{d:"M55.745 76.436a2 2 0 103.123 2.499l-3.123-2.499zm5.766-4.006l1.575-1.233a2 2 0 00-3.136-.017l1.561 1.25zm2.63 6.605a2 2 0 103.15-2.465l-3.15 2.465zm107.94 53.502a2 2 0 00-2.499 3.123l2.499-3.123zm4.006 5.766l1.214 1.59a1.999 1.999 0 00.036-3.151l-1.25 1.561zm-6.644 2.557a1.999 1.999 0 102.427 3.179l-2.427-3.179zM58.868 78.935l4.205-5.256-3.123-2.499-4.205 5.256 3.123 2.499zm1.068-5.273l4.205 5.373 3.15-2.465-4.205-5.373-3.15 2.465zm109.646 61.998l5.256 4.205 2.499-3.123-5.256-4.205-2.499 3.123zm5.292 1.054l-5.431 4.146 2.427 3.179 5.431-4.146-2.427-3.179zM147.137 69.146a2 2 0 10-.149 3.998l.149-3.998zm29.634 5.107a2 2 0 10.149-3.997l-.149 3.997zm-29.657 5.404a2 2 0 00-.102 3.999l.102-3.999zm29.681 4.758a2 2 0 00.102-3.999l-.102 4zm-29.72 5.928a2 2 0 10-.023 4l.023-4zm29.759 4.176a2 2 0 10.024-4l-.024 4zm-29.846-21.375l29.783 1.11.149-3.998-29.783-1.11-.149 3.998zm.024 10.512l29.783.76.102-4-29.783-.759-.102 3.999zm.04 10.687l29.782.176.024-4-29.783-.175-.023 4zM143.442 71.202a2.458 2.458 0 01-2.57 2.453c-1.401-.058-2.569-1.285-2.569-2.686 0-1.402 1.168-2.57 2.569-2.453 1.46.058 2.57 1.285 2.57 2.686zm.001 10.396a2.458 2.458 0 01-2.57 2.453c-1.401-.059-2.569-1.285-2.569-2.686 0-1.46 1.168-2.57 2.569-2.453 1.46.058 2.57 1.284 2.57 2.686zm-2.57 12.848a2.458 2.458 0 002.57-2.453c0-1.402-1.11-2.628-2.57-2.686-1.401-.117-2.569 1.05-2.569 2.452s1.168 2.628 2.569 2.687z",fill:"#fff"})),Di||(Di=n.createElement("path",{opacity:.2,d:"M190.452 91.875V57.771c0-3.68-2.628-6.833-5.899-7.008l-23.651-1.285a35.18 35.18 0 00-1.752 10.98c0 17.635 12.79 31.826 28.09 31.65 1.051.06 2.16-.058 3.212-.233z",fill:"#00236B"})),Ri||(Ri=n.createElement("path",{d:"M220.645 58.883c0-16.585-11.621-30.775-26.454-31.651-15.3-.876-28.089 12.672-28.089 30.308s12.789 31.827 28.089 31.652c14.833-.117 26.454-13.724 26.454-30.309z",fill:"#FF4645"})),Ai||(Ai=n.createElement("path",{d:"M215.329 40.372c-4.788-7.475-12.38-12.614-21.14-13.14v31.01l21.14-17.87z",fill:"#FC0"})),Li||(Li=n.createElement("path",{d:"M215.329 40.372l-21.14 17.87 26.455.642c0-6.89-1.986-13.315-5.315-18.512z",fill:"#00236B"})),_i||(_i=n.createElement("path",{d:"M194.248 58.24V27.233c-15.301-.876-28.09 12.672-28.09 30.308l28.09.7z",fill:"#FF4645"})),Oi||(Oi=n.createElement("path",{d:"M161.151 14.734a2 2 0 10-4 0h4zm-4 4.204a2 2 0 004 0h-4zm4 8.876a2 2 0 10-4 0h4zm-4 4.555a2 2 0 004 0h-4zm10.819-6.816a2 2 0 000-4v4zm-4.263-4a2 2 0 100 4v-4zm-9.169 4a2 2 0 100-4v4zm-4.263-4a2 2 0 000 4v-4zm6.876-6.82v4.205h4v-4.204h-4zm0 13.08v4.556h4v-4.555h-4zm10.819-6.26h-4.263v4h4.263v-4zm-13.432 0h-4.263v4h4.263v-4z",fill:"#2EE5C0"})))},Fi=(0,c.cn)("network");function zi(e){var t,a;let{tenantName:r}=e;const[s]=(0,y.Rj)(),o=(0,y.ix)(gi.qz),i=(0,y.zL)(),[l,c]=n.useState(),[u,m]=n.useState(!1),[p,h]=n.useState(!1),{currentData:v,isFetching:g,error:x}=vi.useGetNetworkInfoQuery(r,{pollingInterval:s});if(g&&void 0===v)return(0,d.jsx)("div",{className:"loader",children:(0,d.jsx)(jn.a,{size:"l"})});if(x)return(0,d.jsx)(I.V,{error:x});const b=v,S=null!==(t=(null===b||void 0===b?void 0:b.Tenants)&&b.Tenants[0].Nodes)&&void 0!==t?t:[];if(0===S.length)return(0,d.jsx)("div",{className:"error",children:"no nodes data"});const j=Ui(S,"NodeType"),T=l?Ui(null!==(a=l.Peers)&&void 0!==a?a:[],"NodeType"):{};return(0,d.jsx)("div",{className:Fi(),children:(0,d.jsx)("div",{className:Fi("inner"),children:(0,d.jsxs)("div",{className:Fi("nodes-row"),children:[(0,d.jsxs)("div",{className:Fi("left"),children:[(0,d.jsx)("div",{className:Fi("controls-wrapper"),children:(0,d.jsxs)("div",{className:Fi("controls"),children:[(0,d.jsx)(hi.T,{value:o,onChange:e=>{i((0,gi.M6)(e))},className:Fi("problem-filter")}),(0,d.jsx)("div",{className:Fi("checkbox-wrapper"),children:(0,d.jsx)(C.X,{onUpdate:()=>{m(!u)},checked:u,children:"ID"})}),(0,d.jsx)("div",{className:Fi("checkbox-wrapper"),children:(0,d.jsx)(C.X,{onUpdate:()=>{h(!p)},checked:p,children:"Racks"})})]})}),(0,d.jsx)(qi,{nodes:j,showId:u,showRacks:p,clickedNode:l,onClickNode:c})]}),(0,d.jsx)("div",{className:Fi("right"),children:l?(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:Fi("label"),children:["Connectivity of node"," ",(0,d.jsx)(f.rU,{className:Fi("link"),to:(0,Vs.a3)(l.NodeId),children:l.NodeId})," ","to other nodes"]}),(0,d.jsx)("div",{className:Fi("nodes-row"),children:(0,d.jsx)(qi,{nodes:T,isRight:!0,showId:u,showRacks:p,clickedNode:l,onClickNode:c})})]}):(0,d.jsxs)("div",{className:Fi("placeholder"),children:[(0,d.jsx)("div",{className:Fi("placeholder-img"),children:(0,d.jsx)(me.J,{data:ki,width:221,height:204})}),(0,d.jsx)("div",{className:Fi("placeholder-text"),children:"Select node to see its connectivity to other nodes"})]})})]})})})}function qi(e){let{nodes:t,isRight:a,showId:n,showRacks:r,clickedNode:s,onClickNode:o}=e;const i=(0,y.ix)(gi.qz),l=(0,y.zL)();let c=0;const u=Object.keys(t).map(((e,u)=>{const m=Ui(t[e],"Rack");return(0,d.jsxs)("div",{className:Fi("nodes-container",{right:a}),children:[(0,d.jsxs)("div",{className:Fi("nodes-title"),children:[e," nodes"]}),(0,d.jsx)("div",{className:Fi("nodes"),children:r?Object.keys(m).map(((e,t)=>(0,d.jsxs)("div",{className:Fi("rack-column"),children:[(0,d.jsx)("div",{className:Fi("rack-index"),children:"undefined"===e?"?":e}),m[e].map(((e,t)=>{let r,u;return!a&&"Peers"in e&&e.Peers&&(r=Object.keys(e.Peers).length,u=Si(e.Peers)),i===gi.pu.PROBLEMS&&r!==u||i===gi.pu.ALL||a?(c++,(0,d.jsx)(bi,{nodeId:e.NodeId,showID:n,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:r,connected:u,onMouseEnter:function(){l((0,D.hJ)(...arguments))},onMouseLeave:()=>{l((0,D.i8)())},onClick:a?void 0:()=>{o(s&&e.NodeId===s.NodeId?void 0:e)},isBlurred:!a&&s&&s.NodeId!==e.NodeId},t)):null}))]},t))):t[e].map(((e,t)=>{let r,u;const m=e&&"Peers"in e?e.Peers:void 0;return!a&&"Peers"in e&&e.Peers&&(r=e.Peers.length,u=Si(m)),i===gi.pu.PROBLEMS&&r!==u||i===gi.pu.ALL||a?(c++,(0,d.jsx)(bi,{nodeId:e.NodeId,showID:n,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:null===m||void 0===m?void 0:m.length,connected:u,onMouseEnter:function(){l((0,D.hJ)(...arguments))},onMouseLeave:()=>{l((0,D.i8)())},onClick:a?void 0:()=>{o(s&&e.NodeId===s.NodeId?void 0:e)},isBlurred:!a&&s&&s.NodeId!==e.NodeId},t)):null}))})]},u)}));return i===gi.pu.PROBLEMS&&0===c?(0,d.jsx)(pi.Q,{name:"thumbsUp",width:"200"}):u}function Ui(e,t){return e.reduce(((e,a)=>(e[a[t]]?e[a[t]].push(a):e[a[t]]=[a],e)),{})}var Gi=a(99337),Bi=a(42703),Qi=a(48857),Hi=a(30629);const Zi=JSON.parse('{"lagsPopover.writeLags":"Write lags statistics (time format dd hh:mm:ss)","lagsPopover.readLags":"Read lags statistics (time format dd hh:mm:ss)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"Consumer:","controls.consumerSelector.emptyOption":"No consumer","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"No partitions match the current search","noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers"}'),Vi=JSON.parse('{"lagsPopover.writeLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0437\u0430\u043f\u0438\u0441\u0438 (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","lagsPopover.readLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0447\u0442\u0435\u043d\u0438\u044f (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"\u0427\u0438\u0442\u0430\u0442\u0435\u043b\u044c:","controls.consumerSelector.emptyOption":"\u041d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"\u041f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0438\u0441\u043a\u0443 \u043d\u0435\u0442 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439","noConsumersMessage.topic":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0442\u043e\u043f\u0438\u043a\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","noConsumersMessage.stream":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0440\u0438\u043c\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439"}'),Wi=(0,pe.wZ)("ydb-diagnostics-partitions",{ru:Vi,en:Zi}),Ji={PARTITION_ID:"partitionId",STORE_SIZE:"storeSize",WRITE_SPEED:"writeSpeed",READ_SPEED:"readSpeed",WRITE_LAGS:"writeLags",READ_LAGS:"readLags",UNCOMMITED_MESSAGES:"uncommitedMessages",UNREAD_MESSAGES:"unreadMessages",START_OFFSET:"startOffset",END_OFFSET:"endOffset",COMMITED_OFFSET:"commitedOffset",READ_SESSION_ID:"readSessionId",READER_NAME:"readerName",PARTITION_HOST:"partitionHost",CONNECTION_HOST:"connectionHost"},Ki={[Ji.PARTITION_ID]:"Partition ID",[Ji.STORE_SIZE]:"Store size",[Ji.WRITE_SPEED]:"Write speed",[Ji.READ_SPEED]:"Read speed",[Ji.WRITE_LAGS]:"Write lags, duration",[Ji.READ_LAGS]:"Read lags, duration",[Ji.UNCOMMITED_MESSAGES]:"Uncommited messages",[Ji.UNREAD_MESSAGES]:"Unread messages",[Ji.START_OFFSET]:"Start offset",[Ji.END_OFFSET]:"End offset",[Ji.COMMITED_OFFSET]:"Commited offset",[Ji.READ_SESSION_ID]:"Read session ID",[Ji.READER_NAME]:"Reader name",[Ji.PARTITION_HOST]:"Partition host",[Ji.CONNECTION_HOST]:"Connection host"},Yi="partitionWriteLag",Xi="partitionWriteIdleTime",$i={[Yi]:"write lag",[Xi]:"write idle time"},el="consumerWriteLag",tl="consumerReadLag",al="consumerReadIdleTime",nl={[el]:"write lag",[tl]:"read lag",[al]:"read idle time"},rl=[Ji.PARTITION_ID,Ji.STORE_SIZE,Ji.WRITE_SPEED,Ji.WRITE_LAGS,Ji.START_OFFSET,Ji.END_OFFSET,Ji.PARTITION_HOST],sl=Object.values(Ji),ol=e=>{let{consumers:t,selectedConsumer:a,onSelectedConsumerChange:r,selectDisabled:s,partitions:o,onSearchChange:i,hiddenColumns:l,onHiddenColumnsChange:c,initialColumnsIds:u}=e;const[m,p]=n.useState(""),[h,v]=n.useState("");n.useEffect((()=>{if(!o)return;const e=new RegExp(Be()(h),"i"),t=new RegExp(Be()(m),"i"),a=o.filter((a=>{const{partitionId:n,readerName:r,readSessionId:s,partitionNodeId:o,connectionNodeId:i,partitionHost:l,connectionHost:c}=a,d=e.test(n),u=[r,s,o,i,l,c].filter(Boolean).map(String),m=0===u.length||u.some((e=>t.test(e)));return d&&m}));i(a)}),[h,m,o,i]);const g=n.useMemo((()=>{const e=t&&t.length?t.map((e=>({value:e,content:e}))):[];return[{value:"",content:Wi("controls.consumerSelector.emptyOption")},...e]}),[t]),x=n.useMemo((()=>{const e=[];for(const t of u){const a=t===Ji.PARTITION_ID,n={title:Ki[t],selected:Boolean(!l.includes(t)),id:t,required:a,sticky:a?"start":void 0};a?e.unshift(n):e.push(n)}return e}),[u,l]),y=e=>(0,d.jsx)("div",{className:xl("select-option",{empty:""===e.value}),children:e.content});return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(E.P,{className:xl("consumer-select"),label:Wi("controls.consumerSelector"),options:g,value:[a],onUpdate:e=>{r(e[0])},filterable:t&&t.length>5,disabled:s||!t||!t.length,renderOption:y,renderSelectedOption:y}),(0,d.jsx)(Hi.o,{onChange:e=>{v(e)},placeholder:Wi("controls.partitionSearch"),className:xl("search",{partition:!0}),value:h}),(0,d.jsx)(Hi.o,{onChange:e=>{p(e)},placeholder:Wi("controls.generalSearch"),className:xl("search",{general:!0}),value:m}),(0,d.jsx)(Qi.N,{popupWidth:242,items:x,showStatus:!0,onUpdate:e=>{const t=[...l];e.forEach((e=>{e.selected||l.includes(e.id)?e.selected&&l.includes(e.id)&&t.splice(l.indexOf(e.id)):t.push(e.id)})),c(t)},sortable:!1},"TableColumnSetup")]})},il=(0,c.cn)("ydb-diagnostics-partitions-columns-header"),ll=e=>{let{title:t}=e;return(0,d.jsx)("div",{className:il("multiline"),children:t})},cl=()=>(0,d.jsx)("div",{className:il("read-session"),children:Ki[Ji.READ_SESSION_ID]}),dl=()=>(0,d.jsx)(pt,{className:il("lags"),text:Ki[Ji.WRITE_LAGS],popoverContent:(0,d.jsx)(Ct,{text:Wi("lagsPopover.writeLags"),type:"write"})}),ul=()=>(0,d.jsx)(pt,{className:il("lags"),text:Ki[Ji.READ_LAGS],popoverContent:(0,d.jsx)(Ct,{text:Wi("lagsPopover.readLags"),type:"read"})}),ml=()=>(0,d.jsx)(pt,{className:il("messages"),text:Ki[Ji.UNREAD_MESSAGES],popoverContent:(0,d.jsx)("div",{className:il("messages-popover-content"),children:Wi("headers.unread")})}),pl=()=>(0,d.jsx)(pt,{className:il("messages"),text:Ki[Ji.UNCOMMITED_MESSAGES],popoverContent:(0,d.jsx)("div",{className:il("messages-popover-content"),children:Wi("headers.uncommited")})}),hl=(0,c.cn)("ydb-diagnostics-partitions-columns"),vl=[{name:Ji.PARTITION_ID,header:(0,d.jsx)(ll,{title:Ki[Ji.PARTITION_ID]}),sortAccessor:e=>(0,In.kE)(e.partitionId)&&Number(e.partitionId),align:ne.ZP.LEFT,render:e=>{let{row:t}=e;return t.partitionId}},{name:Ji.STORE_SIZE,header:(0,d.jsx)(ll,{title:Ki[Ji.STORE_SIZE]}),align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,R.td)(t.storeSize)}},{name:Ji.WRITE_SPEED,header:Ki[Ji.WRITE_SPEED],align:ne.ZP.LEFT,resizeMinWidth:140,sortAccessor:e=>e.writeSpeed.perMinute,render:e=>{let{row:t}=e;return(0,d.jsx)(ot,{data:t.writeSpeed})}},{name:Ji.READ_SPEED,header:Ki[Ji.READ_SPEED],align:ne.ZP.LEFT,resizeMinWidth:140,sortAccessor:e=>{var t;return null===(t=e.readSpeed)||void 0===t?void 0:t.perMinute},render:e=>{let{row:t}=e;return(0,d.jsx)(ot,{data:t.readSpeed})}},{name:Ji.WRITE_LAGS,header:(0,d.jsx)(dl,{}),className:hl("lags-header"),sub:[{name:Yi,header:$i[Yi],align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,R.gC)(t.partitionWriteLag)}},{name:Xi,header:$i[Xi],align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,R.gC)(t.partitionWriteIdleTime)}}]},{name:Ji.READ_LAGS,header:(0,d.jsx)(ul,{}),className:hl("lags-header"),sub:[{name:el,header:nl[el],align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,R.gC)(t.consumerWriteLag)}},{name:tl,header:nl[tl],align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,R.gC)(t.consumerReadLag)}},{name:al,header:nl[al],align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,R.gC)(t.consumerReadIdleTime)}}]},{name:Ji.UNCOMMITED_MESSAGES,header:(0,d.jsx)(pl,{}),align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return t.uncommitedMessages}},{name:Ji.UNREAD_MESSAGES,header:(0,d.jsx)(ml,{}),align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return t.unreadMessages}},{name:Ji.START_OFFSET,header:(0,d.jsx)(ll,{title:Ki[Ji.START_OFFSET]}),sortAccessor:e=>(0,In.kE)(e.startOffset)&&Number(e.startOffset),align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return t.startOffset}},{name:Ji.END_OFFSET,header:(0,d.jsx)(ll,{title:Ki[Ji.END_OFFSET]}),sortAccessor:e=>(0,In.kE)(e.endOffset)&&Number(e.endOffset),align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return t.endOffset}},{name:Ji.COMMITED_OFFSET,header:(0,d.jsx)(ll,{title:Ki[Ji.COMMITED_OFFSET]}),sortAccessor:e=>(0,In.kE)(e.commitedOffset)&&Number(e.commitedOffset),align:ne.ZP.RIGHT,render:e=>{let{row:t}=e;return t.commitedOffset}},{name:Ji.READ_SESSION_ID,header:(0,d.jsx)(cl,{}),align:ne.ZP.LEFT,width:150,render:e=>{let{row:t}=e;return t.readSessionId?(0,d.jsx)(ba.A,{name:t.readSessionId,showStatus:!1,hasClipboardButton:!0}):"\u2013"}},{name:Ji.READER_NAME,header:(0,d.jsx)(ll,{title:Ki[Ji.READER_NAME]}),align:ne.ZP.LEFT,width:150,render:e=>{let{row:t}=e;return t.readerName?(0,d.jsx)(ba.A,{name:t.readerName,showStatus:!1,hasClipboardButton:!0}):"\u2013"}},{name:Ji.PARTITION_HOST,header:(0,d.jsx)(ll,{title:Ki[Ji.PARTITION_HOST]}),align:ne.ZP.LEFT,width:200,render:e=>{let{row:t}=e;return t.partitionNodeId&&t.partitionHost?(0,d.jsx)(ba.A,{name:t.partitionHost,path:(0,Vs.a3)(t.partitionNodeId),showStatus:!1,hasClipboardButton:!0}):"\u2013"}},{name:Ji.CONNECTION_HOST,header:(0,d.jsx)(ll,{title:Ki[Ji.CONNECTION_HOST]}),align:ne.ZP.LEFT,width:200,render:e=>{let{row:t}=e;return t.connectionNodeId&&t.connectionHost?(0,d.jsx)(ba.A,{name:t.connectionHost,path:(0,Vs.a3)(t.connectionNodeId),showStatus:!1,hasClipboardButton:!0}):"\u2013"}}],gl=vl.filter((e=>rl.includes(e.name))),xl=(0,c.cn)("ydb-diagnostics-partitions"),yl=e=>{let{path:t}=e;const a=(0,y.zL)(),[r,s]=n.useState([]),o=(0,y.ix)((e=>Xe(e,t))),[i]=(0,y.Rj)(),{selectedConsumer:l}=(0,y.ix)((e=>e.partitions)),{currentData:c,isFetching:u,error:m}=We.useGetTopicQuery({path:t}),p=u&&void 0===c,{currentData:h,isFetching:v,error:g}=Gi.W.useGetNodesListQuery(void 0),b=v&&void 0===h,S=(0,y.ix)(Gi.d),[j,f]=(0,y.yu)(x.ZY),[T,N]=(e=>{const[t,a]=n.useState([]),[r,s]=n.useState([]);return n.useEffect((()=>{e?(a(vl),s(sl)):(a(gl),s(rl))}),[e]),[t,r]})(l),w=!p&&t?{path:t,consumerName:l}:re.CN,{currentData:E,isFetching:C,error:P}=Bi.TB.useGetPartitionsQuery(w,{pollingInterval:i}),D=C&&void 0===E,R=E,A=n.useMemo((()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return null===e||void 0===e?void 0:e.map((e=>{const a=e.partitionNodeId&&t?t.get(e.partitionNodeId):void 0,n=e.connectionNodeId&&t?t.get(e.connectionNodeId):void 0;return{...e,partitionHost:a,connectionHost:n}}))}(R,S)),[R,S]);n.useEffect((()=>{const e=!p&&!o,t=l&&o&&!o.includes(l);(e||t)&&a((0,Bi.M$)(""))}),[a,p,l,o]);const L=n.useMemo((()=>T.filter((e=>!j.includes(e.name)))),[T,j]),_=e=>{f(e)},O=e=>{a((0,Bi.M$)(e))},M=p||b||D,k=g||m||P;return(0,d.jsxs)("div",{className:xl(),children:[(0,d.jsx)("div",{className:xl("controls"),children:(0,d.jsx)(ol,{consumers:o,selectedConsumer:l,onSelectedConsumerChange:O,selectDisabled:Boolean(k)||M,partitions:A,onSearchChange:s,hiddenColumns:j,onHiddenColumnsChange:_,initialColumnsIds:N})}),(0,d.jsx)("div",{className:xl("table-wrapper"),children:(0,d.jsx)("div",{className:xl("table-content"),children:M?(0,d.jsx)(oe.h,{className:xl("loader")}):k?(0,d.jsx)(I.V,{error:k}):(0,d.jsx)(se.G,{columnsWidthLSKey:"partitionsColumnsWidth",wrapperClassName:xl("table"),data:r,columns:L,settings:x.LE,emptyDataMessage:Wi("table.emptyDataMessage")})})})]})},bl=(0,c.cn)("date-range"),Sl=e=>{if(!e||isNaN(e))return;const t=e-60*(new Date).getTimezoneOffset()*1e3;return new Date(t).toISOString().substring(0,"yyyy-MM-DDThh:mm".length)},jl=e=>{let{from:t,to:a,className:n,onChange:r}=e;const s=Sl(t),o=Sl(a);return(0,d.jsxs)("div",{className:bl(null,n),children:[(0,d.jsx)("input",{type:"datetime-local",value:s||"",max:o,onChange:e=>{let{target:{value:t}}=e,n=t?new Date(t).getTime():void 0;n&&a&&n>a&&(n=a),null===r||void 0===r||r({from:n,to:a})},className:bl("input")}),"\u2014",(0,d.jsx)("input",{type:"datetime-local",min:s,value:o||"",onChange:e=>{let{target:{value:a}}=e,n=a?new Date(a).getTime():void 0;t&&n&&t>n&&(n=t),null===r||void 0===r||r({from:t,to:n})},className:bl("input")})]})};var fl=a(47101),Tl=a(30667);const Nl=JSON.parse('{"no-data":"No data","filter.text.placeholder":"Search by query text..."}'),wl=JSON.parse('{"no-data":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445","filter.text.placeholder":"\u0418\u0441\u043a\u0430\u0442\u044c \u043f\u043e \u0442\u0435\u043a\u0441\u0442\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0430..."}'),El=(0,pe.wZ)("ydb-diagnostics-top-queries",{ru:wl,en:Nl}),Cl=(0,c.cn)("kv-top-queries"),Il=e=>{let{tenantName:t,type:a}=e;const r=(0,y.zL)(),s=(0,Ca.TH)(),o=(0,Ca.k6)(),[i]=(0,y.Rj)(),l=(0,y.ix)((e=>e.executeTopQueries)),{currentData:c,isFetching:u,error:m}=Tl.MU.useGetTopQueriesQuery({database:t,filters:l},{pollingInterval:i}),p=u&&void 0===c,{result:h}=c||{},v=[Ps,Ds,Rs,ks,As,Ls,_s].map((e=>{return{...e,sortable:(t=e.name,Object.values(js).includes(t))};var t})),g=n.useCallback((e=>{const{QueryText:t}=e;r((0,as.B8)({input:t}));const a=(0,N.mB)(s),n=(0,Ue.Sj)({...a,[S.bS]:S.m2.query,[Ue.XV.queryTab]:S._0.newQuery});o.push(n)}),[r,o,s]),x=e=>{r((0,Tl.Im)({text:e}))},b=e=>{r((0,Tl.Im)(e))};return(0,d.jsxs)(fl.l,{children:[(0,d.jsx)(fl.l.Controls,{children:(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Qe.o,{value:l.text,onChange:x,placeholder:El("filter.text.placeholder"),className:Cl("search")}),(0,d.jsx)(jl,{from:l.from,to:l.to,onChange:b})]})}),(0,d.jsx)(fl.l.Table,{loading:p,children:m?(0,d.jsx)("div",{className:"error",children:(0,ie.fV)(m)}):!h||(0,ue.Jp)(a)?El("no-data"):(0,d.jsx)(se.G,{columnsWidthLSKey:Is,columns:v,data:h,settings:Es,onRowClick:g,rowClassName:()=>Cl("row")})})]})};var Pl=a(9345),Dl=a(58660),Rl=a(79734);const Al=JSON.parse('{"no-data":"No data","filters.mode.immediate":"Immediate","filters.mode.history":"Historical","description":"Historical data only tracks shards with CPU load over 70%"}'),Ll=JSON.parse('{"no-data":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445","filters.mode.immediate":"\u041c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u044b\u0435","filters.mode.history":"\u0418\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0435","description":"\u0418\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043e \u0448\u0430\u0440\u0434\u0430\u0445 \u0441 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u043e\u0439 CPU \u0432\u044b\u0448\u0435 70%"}'),_l=(0,pe.wZ)("ydb-diagnostics-top-shards",{ru:Ll,en:Al}),Ol=e=>{let{value:t,onChange:a}=e;const r=t.mode===Dl.F.Immediate?void 0:t.from,s=t.mode===Dl.F.Immediate?void 0:t.to;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)(Rl.E,{value:t.mode,onUpdate:e=>{if(!((e,t)=>Object.values(e).includes(t))(Dl.F,e)){const t=Object.values(Dl.F).join(", ");throw new Error('Unexpected TopShards mode "'.concat(e,'". Should be one of: ').concat(t))}a({mode:e})},children:[(0,d.jsx)(Rl.E.Option,{value:Dl.F.Immediate,children:_l("filters.mode.immediate")}),(0,d.jsx)(Rl.E.Option,{value:Dl.F.History,children:_l("filters.mode.history")})]}),(0,d.jsx)(jl,{from:r,to:s,onChange:e=>{a({mode:Dl.F.History,...e})}})]})},Ml=(0,c.cn)("top-shards"),kl={...x.LE,dynamicRender:!1,externalSort:!0,disableSortReset:!0,defaultOrder:ne.ZP.DESCENDING};function Fl(e){return e?(0,R.o0)(new Date(e).getTime()):"\u2013"}function zl(e){return e?e.split(",").map((e=>({columnId:e,order:ne.ZP.DESCENDING}))):void 0}function ql(e){return e.to=Date.now(),e.from=e.to-1e3*x.RQ,e}const Ul=e=>{let{tenantName:t,path:a,type:r}=e;const s=(0,y.zL)(),o=(0,Ca.TH)(),[i]=(0,y.Rj)(),l=(0,y.ix)((e=>e.shardsWorkload)),[c,u]=n.useState((()=>{const e={...l};return e.mode||(e.mode=Dl.F.Immediate),e.from||e.to||ql(e),e})),[m,p]=n.useState(xs),{data:h,isFetching:v,error:g}=Pl.Ag.useSendShardQueryQuery({database:t,path:a,sortOrder:(x=m,x?x.split(",").map((e=>({columnId:e,order:"DESC"}))):void 0),filters:c},{pollingInterval:i});var x;const b=v&&void 0===h,{result:S}=null!==h&&void 0!==h?h:{},j=e=>{p(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(Array.isArray(e)?e:[e]).map((e=>{let{columnId:t}=e;return t})).join(",")}(e))},f=e=>{const t={...e};if(!l.from&&!l.to&&!e.from&&!e.to)switch(e.mode){case Dl.F.Immediate:t.from=t.to=void 0;break;case Dl.F.History:ql(t)}s((0,Pl.K2)(e)),u((e=>({...e,...t})))},T=n.useMemo((()=>{const e=((e,t)=>[ao(e,t),no,ro,so,oo,lo])(t,o),a=e.map((e=>({...e,sortable:fs(e.name)})));return c.mode===Dl.F.History&&(a.splice(5,0,{name:ys,render:e=>{let{row:t}=e;return Fl(t.PeakTime)},sortable:!1}),a.push({name:bs,render:e=>{let{row:t}=e;return Fl(t.IntervalEnd)}})),a}),[c.mode,o,t]);return(0,d.jsxs)(fl.l,{children:[(0,d.jsx)(fl.l.Controls,{children:(0,d.jsx)(Ol,{value:c,onChange:f})}),c.mode===Dl.F.History&&(0,d.jsx)("div",{className:Ml("hint"),children:_l("description")}),(0,d.jsx)(fl.l.Table,{loading:b,children:g?(0,d.jsx)("div",{className:"error",children:(0,ie.fV)(g)}):!S||(0,ue.Jp)(r)?_l("no-data"):(0,d.jsx)(se.G,{columnsWidthLSKey:Ws,columns:T,data:S,settings:kl,onSort:j,sortOrder:zl(m)})})]})},Gl=(0,c.cn)("kv-tenant-diagnostics");const Bl=function(e){const t=n.useRef(null),a=(0,y.zL)(),{diagnosticsTab:o=S.qQ.overview}=(0,y.ix)((e=>e.tenant)),[i]=(0,s.useQueryParams)({name:s.StringParam,schema:s.StringParam,backend:s.StringParam,clusterName:s.StringParam}),l=(0,ue.dw)(e.type)?e.path:e.tenantName,c=(0,ue.dw)(e.type)||e.path===e.tenantName?Zo:ai(e.type);let u=c.find((e=>e.id===o));return u||(u=c[0]),n.useEffect((()=>{u&&u.id!==o&&a((0,w.$v)(u.id))}),[u,o,a]),(0,d.jsxs)("div",{className:Gl(),ref:t,children:[u?(0,d.jsx)(r.ql,{children:(0,d.jsx)("title",{children:u.title})}):null,(()=>{var e;return(0,d.jsx)("div",{className:Gl("header-wrapper"),children:(0,d.jsxs)("div",{className:Gl("tabs"),children:[(0,d.jsx)(j.m,{size:"l",items:c,activeTab:null===(e=u)||void 0===e?void 0:e.id,wrapTo:(e,t)=>{let{id:a}=e;const n=(0,N.ax)(N.ZP.tenant,void 0,{...i,[Ue.XV.diagnosticsTab]:a});return(0,d.jsx)(f.rU,{to:n,className:Gl("tab"),children:t},a)},allowNotSelected:!0}),(0,d.jsx)(T.q,{})]})})})(),(0,d.jsx)("div",{className:Gl("page-wrapper"),children:(()=>{var a;const{type:n,path:r}=e;switch(null===(a=u)||void 0===a?void 0:a.id){case S.qQ.overview:return(0,d.jsx)(Ro,{type:n,tenantName:l,path:r,additionalTenantProps:e.additionalTenantProps,additionalNodesProps:e.additionalNodesProps});case S.qQ.schema:return(0,d.jsx)(qe,{path:r,tenantName:l,type:n,extended:!0});case S.qQ.topQueries:return(0,d.jsx)(Il,{tenantName:l,type:n});case S.qQ.topShards:return(0,d.jsx)(Ul,{tenantName:l,path:r,type:n});case S.qQ.nodes:return(0,d.jsx)(ee.G,{path:r,additionalNodesProps:e.additionalNodesProps,parentContainer:t.current});case S.qQ.tablets:return(0,d.jsx)(ae.J,{path:r});case S.qQ.storage:return(0,d.jsx)(te.V,{tenant:l,parentContainer:t.current});case S.qQ.network:return(0,d.jsx)(zi,{tenantName:l});case S.qQ.describe:return(0,d.jsx)(Yt,{path:r,type:n});case S.qQ.hotKeys:return(0,d.jsx)(ui,{path:r});case S.qQ.graph:return(0,d.jsx)($,{path:r});case S.qQ.consumers:return(0,d.jsx)(Qt,{path:r,type:n});case S.qQ.partitions:return(0,d.jsx)(yl,{path:r});default:return(0,d.jsx)("div",{children:"No data..."})}})()})]})},Ql=JSON.parse('{"controls.query-mode-selector_type":"Query type:","tabs.newQuery":"Editor","tabs.history":"History","tabs.saved":"Saved","history.empty":"History is empty","saved.empty":"There are no saved queries","delete-dialog.header":"Delete query","delete-dialog.question":"Are you sure you want to delete query","delete-dialog.delete":"Delete","delete-dialog.cancel":"Cancel","preview.title":"Preview","preview.not-available":"Preview is not available","preview.close":"Close preview","method-description.script":"For YQL-scripts combining DDL and DML.\\nAPI call: schema.scripting","method-description.scan":"Read-only queries, potentially reading a lot of data.\\nAPI call: table.ExecuteScan","method-description.data":"DML queries for changing and fetching data in serialization mode.\\nAPI call: table.executeDataQuery","method-description.query":"Any query. An experimental API call supposed to replace all existing methods.\\nAPI Call: query.ExecuteScript","method-description.pg":"Queries in postgresql syntax.\\nAPI call: query.ExecuteScript","query-duration.description":"Duration of server-side query execution","action.send-query":"Send query","action.send-selected-query":"Send selected query","action.previous-query":"Previous query in history","action.next-query":"Next query in history","action.save-query":"Save query"}'),Hl=(0,pe.wZ)("ydb-query-editor",{en:Ql}),Zl=(0,c.cn)("ydb-queries-history"),Vl="queriesHistoryTableColumnsWidth";const Wl=function(e){let{changeUserInput:t}=e;const a=(0,y.zL)(),[n,r]=(0,y.$6)(),s=[...(0,y.ix)(as.qV)].reverse(),o=[{name:"queryText",header:"Query Text",render:e=>{let{row:t}=e;return(0,d.jsx)("div",{className:Zl("query"),children:(0,d.jsx)(os,{value:t.queryText,maxQueryHeight:ws})})},sortable:!1,width:600},{name:"syntax",header:"Syntax",render:e=>{let{row:t}=e;return t.syntax===ie.jM.pg?"PostgreSQL":"YQL"},sortable:!1,width:200}];return(0,d.jsx)("div",{className:Zl(),children:(0,d.jsx)(se.G,{columnsWidthLSKey:Vl,columns:o,data:s,settings:Es,emptyDataMessage:Hl("history.empty"),onRowClick:e=>{return(s=e).syntax===ie.jM.pg&&n!==ie.wZ.pg?r(ie.wZ.pg):s.syntax!==ie.jM.pg&&n===ie.wZ.pg&&r(ie.wZ.script),t({input:s.queryText}),void a((0,w.jk)(S._0.newQuery));var s},rowClassName:()=>Zl("table-row")})})};const Jl=(0,a(30410).k)((async()=>{const e=(await Promise.all([a.e(1551),a.e(3757)]).then(a.bind(a,93757))).default,{registerLanguages:t}=await Promise.all([a.e(1551),a.e(8424),a.e(4842)]).then(a.bind(a,14842));return t(),{Editor:e}}),"Editor"),Kl=new Set(["PlanNodeId","PlanNodeType","Node Type","Plans"]);function Yl(e){const t=[];if(e.Operators){const a=[];for(const t of e.Operators){const e={name:t.Name,items:[]};for(const[a,n]of Object.entries(t)){if("Name"===a)continue;const t=Array.isArray(n)?n.join(", "):n;e.items.push({name:a,value:t})}a.push(e)}t.push({group:"Operators",stats:a})}if("Connection"===e.PlanNodeType){const a=[];for(const[t,n]of Object.entries(e))Kl.has(t)||a.push({name:t,value:String(n)});a.length>0&&t.push({group:"Attributes",stats:a})}return t}function Xl(e){switch(e.PlanNodeType){case"Connection":return"connection";case"ResultSet":return"result";case"Query":return"query";default:return"stage"}}const $l={v2:"0.2"},ec=Object.values($l),tc=e=>{const{plan:t,ast:a}=(0,ie.CC)(e);if(!t)return{ast:a};const{tables:n,meta:r,Plan:s}=(0,ie.y5)(t);if(-1===ec.indexOf(r.version))return{plan:{pristine:t,version:r.version},ast:a};let o=[],i=[];if(s){const e=function(e){const t=[],a=[],n=e,r={name:String(n.PlanNodeId),data:{id:n.PlanNodeId,type:Xl(n),name:n["Node Type"]}};return t.push(r),function e(){let n=arguments.length>1?arguments[1]:void 0;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((r=>{var s;const o={name:String(r.PlanNodeId),data:{id:r.PlanNodeId,type:Xl(r),name:r["Node Type"],operators:null===(s=r.Operators)||void 0===s?void 0:s.map((e=>e.Name)),stats:Yl(r),tables:r.Tables}};t.push(o),a.push({from:n,to:o.name}),e(r.Plans,o.name)}))}(n.Plans,r.name),{nodes:t,links:a}}(s);o=e.links,i=e.nodes}return{plan:{links:o,nodes:i,tables:n,version:r.version,pristine:t},ast:a}},ac=le.h.injectEndpoints({endpoints:e=>({explainQuery:e.mutation({queryFn:async e=>{let{query:t,database:a,mode:n}=e,r="explain",s=ie.jM.yql;"pg"===n?(r="explain-query",s=ie.jM.pg):n&&(r="explain-".concat(n));try{const e=await window.api.getExplainQuery(t,a,r,s);if((0,ie.gW)(e))return{error:e};return{data:tc(e)}}catch(o){return{error:o}}}})}),overrideExisting:"throw"});var nc=a(89003),rc=a(62729),sc=a(44822);let oc;!function(e){e.triggerCollapse="triggerCollapse",e.triggerExpand="triggerExpand",e.clear="clear"}(oc||(oc={}));const ic=e=>{localStorage.setItem(e,"true")},lc=e=>{localStorage.removeItem(e)};function cc(e){return function(t,a){switch(a){case oc.triggerCollapse:return ic(e),{...t,triggerCollapse:!0,triggerExpand:!1,collapsed:!0};case oc.triggerExpand:return lc(e),{...t,triggerCollapse:!1,triggerExpand:!0,collapsed:!1};case oc.clear:return lc(e),{triggerCollapse:!1,triggerExpand:!1,collapsed:!1};default:return t}}}const dc=(0,c.cn)("kv-pane-visibility-button");function uc(e){let{onCollapse:t,onExpand:a,isCollapsed:r,initialDirection:s="top",className:o}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Gn.z,{view:"flat-secondary",onClick:t,className:dc({hidden:r},o),title:"Collapse",children:(0,d.jsx)(me.J,{data:sc.Z,className:dc({[s]:!0})})}),(0,d.jsx)(Gn.z,{view:"flat-secondary",onClick:a,className:dc({hidden:!r},o),title:"Expand",children:(0,d.jsx)(me.J,{data:sc.Z,className:dc({[s]:!0},"rotate")})})]})}var mc=a(90861);const pc=(0,c.cn)("kv-divider");const hc=function(){return(0,d.jsx)("div",{className:pc()})};var vc=a(4140),gc=a(56963);const xc=function(e){let{disabled:t}=e;const a=(0,y.zL)();return(0,d.jsx)(Gn.z,{onClick:()=>{a((0,gc.Xl)())},view:"flat-secondary",disabled:t,title:"Fullscreen",children:(0,d.jsx)(me.J,{data:vc.Z})})};var yc,bc=a(38886);function Sc(){return Sc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Sc.apply(this,arguments)}const jc=function(e){return n.createElement("svg",Sc({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},e),yc||(yc=n.createElement("path",{fill:"currentColor",d:"M13.383 6.5a.309.309 0 00.305-.305V5.18a.328.328 0 00-.305-.305H11.25V2.742a.328.328 0 00-.305-.304H9.93a.309.309 0 00-.305.304v3.149c0 .355.254.609.61.609h3.148zm-7.008-.61V2.743a.328.328 0 00-.305-.304H5.055a.309.309 0 00-.305.304v2.133H2.617a.309.309 0 00-.304.305v1.015c0 .178.126.305.304.305h3.149c.33 0 .609-.254.609-.61zm0 7.618v-3.149c0-.33-.28-.609-.61-.609H2.618a.309.309 0 00-.304.305v1.015c0 .178.126.305.304.305H4.75v2.133c0 .178.127.305.305.305H6.07a.309.309 0 00.305-.305zm4.875 0v-2.133h2.133a.309.309 0 00.305-.305v-1.015a.328.328 0 00-.305-.305h-3.149c-.355 0-.609.28-.609.61v3.148c0 .178.127.305.305.305h1.015a.309.309 0 00.305-.305z"})))},fc=(0,c.cn)("kv-fullscreen");class Tc extends n.Component{constructor(e){super(e),this.modalRoot=null,this.el=void 0,this.el=document.createElement("div")}componentDidMount(){this.modalRoot=document.getElementById("fullscreen-root"),this.modalRoot&&this.modalRoot.appendChild(this.el)}componentWillUnmount(){this.modalRoot&&this.modalRoot.removeChild(this.el)}render(){return bc.createPortal(this.props.children,this.el)}}const Nc=function(e){const t=(0,y.zL)(),a=n.useCallback((()=>{t((0,gc.vj)())}),[t]);return n.useEffect((()=>{const e=e=>{"Escape"===e.key&&a()};return document.addEventListener("keydown",e,!1),()=>{document.removeEventListener("keydown",e,!1)}}),[a]),(0,d.jsx)(Tc,{children:(0,d.jsxs)("div",{className:fc(null,e.className),children:[(0,d.jsx)(Gn.z,{onClick:a,view:"raised",className:fc("close-button"),children:(0,d.jsx)(me.J,{data:jc})}),e.children]})})};var wc=a(65375),Ec=a(52369);const Cc=(0,c.cn)("kv-query-execution-status"),Ic=e=>{let t,a,{className:n,error:r}=e;if((0,Ec.IZ)(r)&&"ECONNABORTED"===r.code)t=(0,d.jsx)(me.J,{data:wc.Z}),a="Connection aborted";else{const e=Boolean(r);t=(0,d.jsx)(me.J,{data:e?Dr.Z:Ir.Z,className:Cc("result-status-icon",{error:e})}),a=e?"Failed":"Completed"}return(0,d.jsxs)("div",{className:Cc(null,n),children:[t,a]})},Pc=n.memo((function(e){const{className:t,value:a}=e,r=(0,y.zL)();return n.useEffect((()=>()=>{r((0,D.i8)())}),[r]),(0,d.jsx)("span",{className:_c("cell",t),onClick:e=>r((0,D.hJ)(e.target,a,"cell")),children:a})})),Dc=JSON.parse('{"empty":"Table is empty"}'),Rc=JSON.parse('{"empty":"\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u043f\u0443\u0441\u0442\u0430\u044f"}'),Ac=(0,pe.wZ)("ydb-query-result-table",{ru:Rc,en:Dc}),Lc={...x.LE,stripedRows:!0,dynamicRenderType:"variable",dynamicItemSizeGetter:()=>40},_c=(0,c.cn)("ydb-query-result-table"),Oc=(e,t)=>t,Mc=e=>{const{columns:t,data:a,settings:r,...s}=e,o=n.useMemo((()=>(0,ie.Xh)(a)),[a]),i=n.useMemo((()=>t?(e=>e.length?e.map((e=>{let{name:t,type:a}=e;const n=(0,ie.T$)(a);return{name:t,align:"number"===n?ne.ZP.RIGHT:ne.ZP.LEFT,sortAccessor:e=>{const a=e[t];return void 0===a||null===a?null:"number"===n?BigInt(a):a},render:e=>{let{row:a}=e;return(0,d.jsx)(Pc,{value:String(a[t])})}}})):[])(t):(e=>e.length?Object.keys(e[0]).map((t=>({name:t,align:(0,In.kE)(e[0][t])?ne.ZP.RIGHT:ne.ZP.LEFT,sortAccessor:e=>(0,In.kE)(e[t])?Number(e[t]):e[t],render:e=>{let{row:a}=e;return(0,d.jsx)(Pc,{value:String(a[t])})}}))):[])(o)),[o,t]),l=n.useMemo((()=>({...Lc,...r})),[r]);return Array.isArray(a)?i.length?(0,d.jsx)(se.G,{data:o,columns:i,settings:l,rowKey:Oc,...s}):(0,d.jsx)("div",{className:_c("message"),children:Ac("empty")}):null};var kc=a(5922),Fc=a(67585),zc=a(57225),qc=a(76506),Uc=a(33569);const Gc=JSON.parse('{"default_collapse_label":"Show less","default_expand_label":"Show more","chars_count":[" ({{count}} symbol)"," ({{count}} symbols)"," ({{count}} symbols)"," ({{count}} symbols)"]}'),Bc=JSON.parse('{"default_collapse_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435","default_expand_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0435\u0449\u0451","chars_count":[" ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u0430)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"]}'),Qc=(0,pe.wZ)("ydb-shorty-string",{ru:Bc,en:Gc}),Hc=(0,c.cn)("kv-shorty-string");function Zc(e){let{value:t="",limit:a=200,strict:r=!1,displayLength:s=!0,render:o=(e=>e),onToggle:i,expandLabel:l=Qc("default_expand_label"),collapseLabel:c=Qc("default_collapse_label")}=e;const[u,m]=n.useState(!1),p=(u?c:l)+(s&&!u?Qc("chars_count",{count:t.length}):""),h=t.length>a+(r?0:p.length),v=u||!h?t:t.slice(0,a-4)+"\xa0...";return(0,d.jsxs)("div",{className:Hc(),children:[o(v),h?(0,d.jsx)(Bs.r,{className:Hc("toggle"),href:"#",onClick:e=>{e.stopPropagation(),e.preventDefault(),m((e=>!e)),null===i||void 0===i||i()},children:p}):null]})}const Vc=["S_FATAL","S_ERROR","S_WARNING","S_INFO"];function Wc(e){return function(e){return!!e&&void 0!==Vc[e]}(e)?Vc[e]:"S_INFO"}const Jc=(0,c.cn)("kv-result-issues"),Kc=(0,c.cn)("kv-issues"),Yc=(0,c.cn)("kv-issue");function Xc(e){let{data:t}=e;const[a,r]=n.useState(!1),s="string"===typeof t||null===t||void 0===t?void 0:t.issues,o=Array.isArray(s)&&s.length>0;return(0,d.jsxs)("div",{className:Jc(),children:[(0,d.jsxs)("div",{className:Jc("error-message"),children:[(()=>{let e;if("string"===typeof t)e=t;else{var a,r;const s=Wc(null===t||void 0===t||null===(a=t.error)||void 0===a?void 0:a.severity);e=(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(rd,{severity:s})," ",(0,d.jsx)("span",{className:Jc("error-message-text"),children:null===t||void 0===t||null===(r=t.error)||void 0===r?void 0:r.message})]})}return e})(),o&&(0,d.jsx)(Gn.z,{view:"normal",onClick:()=>r(!a),children:a?"Hide details":"Show details"})]}),o&&a&&(0,d.jsx)($c,{issues:s})]})}function $c(e){let{issues:t}=e;const a=null===t||void 0===t?void 0:t.reduce(((e,t)=>{var a;const n=null!==(a=t.severity)&&void 0!==a?a:10;return Math.min(e,n)}),10);return(0,d.jsx)("div",{className:Kc(null),children:null===t||void 0===t?void 0:t.map(((e,t)=>(0,d.jsx)(ed,{issue:e,expanded:e===a},t)))})}function ed(e){let{issue:t,level:a=0}=e;const[r,s]=n.useState(!0),o=Wc(t.severity),i=function(e){const{position:t}=e;if("object"!==typeof t||null===t||!(0,In.kE)(t.row))return"";const{row:a,column:n}=t;return(0,In.kE)(n)?"".concat(a,":").concat(n):"line ".concat(a)}(t),l=t.issues,c=Array.isArray(l)&&l.length>0,u=r?"bottom":"right";return(0,d.jsxs)("div",{className:Yc({leaf:!c,"has-issues":c}),children:[(0,d.jsxs)("div",{className:Yc("line"),children:[c&&(0,d.jsx)(Gn.z,{view:"flat-secondary",onClick:()=>s(!r),className:Yc("arrow-toggle"),children:(0,d.jsx)(Uc.F,{direction:u,size:16})}),(0,d.jsx)(rd,{severity:o}),(0,d.jsxs)("span",{className:Yc("message"),children:[i&&(0,d.jsx)("span",{className:Yc("place-text"),title:"Position",children:i}),(0,d.jsx)("div",{className:Yc("message-text"),children:(0,d.jsx)(Zc,{value:t.message,expandLabel:"Show full message"})})]}),t.issue_code?(0,d.jsxs)("span",{className:Yc("code"),children:["Code: ",t.issue_code]}):null]}),c&&r&&(0,d.jsx)("div",{className:Yc("issues"),children:(0,d.jsx)(td,{issues:l,level:a+1,expanded:r})})]})}function td(e){const{issues:t,level:a,expanded:n}=e;return(0,d.jsx)("div",{className:Yc("list"),children:t.map(((e,t)=>(0,d.jsx)(ed,{issue:e,level:a,expanded:n},t)))})}const ad={S_INFO:Fc.Z,S_WARNING:zc.Z,S_ERROR:Rr.Z,S_FATAL:qc.Z},nd=(0,c.cn)("yql-issue-severity");function rd(e){let{severity:t}=e;const a=t.slice(2).toLowerCase();return(0,d.jsxs)("span",{className:nd({severity:a}),children:[(0,d.jsx)(me.J,{className:nd("icon"),data:ad[t]}),(0,d.jsx)("span",{className:nd("title"),children:a})]})}const sd=(0,c.cn)("ydb-query-duration"),od=e=>{let{duration:t}=e;if(!t)return null;const a=(0,Ve.tt)((0,Ve.BO)(t),1);return(0,d.jsx)("span",{className:sd(),children:(0,d.jsx)(pt,{className:sd("item-with-popover"),contentClassName:sd("popover"),text:a,popoverContent:Hl("query-duration.description")})})};function id(e){return e.replaceAll("\\","\\\\").replaceAll("\n","\\n").replaceAll("\r","\\r").replaceAll("\t","\\t")}const ld=(0,c.cn)("ydb-query-execute-result"),cd={result:"result",stats:"stats"},dd=[{value:cd.result,content:"Result"},{value:cd.stats,content:"Stats"}];function ud(e){var t,a,r;let{data:s,stats:o,error:i,isResultsCollapsed:l,onCollapseResults:c,onExpandResults:u}=e;const[m,p]=n.useState(0),[h,v]=n.useState(cd.result),g=(0,y.ix)((e=>e.fullscreen)),x=(0,y.zL)(),b=null===s||void 0===s||null===(t=s.resultSets)||void 0===t?void 0:t.length,S=b&&b>0,f=S?null===s||void 0===s||null===(a=s.resultSets)||void 0===a?void 0:a[m].result:null===s||void 0===s?void 0:s.result,T=S?null===s||void 0===s||null===(r=s.resultSets)||void 0===r?void 0:r[m].columns:null===s||void 0===s?void 0:s.columns,N=function(e){if(null===e||void 0===e||!e.length)return"";const t=Object.keys(e[0]),a=[t.map(id).join("\t")];for(const n of e){const e=[];for(const a of t){const t=n[a];e.push(id("object"===typeof t?JSON.stringify(t):"".concat(t)))}a.push(e.join("\t"))}return a.join("\n")}(f),w=!N.length,E=(0,ie.dt)(i);n.useEffect((()=>()=>{x((0,gc.vj)())}),[x]);const C=(e,t)=>(0,d.jsx)(Mc,{data:e,columns:t,settings:{sortable:!1}}),I=()=>{const e=(0,d.jsx)(Zt(),{data:o,isExpanded:()=>!0,className:ld("inspector"),searchOptions:{debounceTime:300}});return(0,d.jsxs)(n.Fragment,{children:[e,g&&(0,d.jsx)(Nc,{children:(0,d.jsx)("div",{className:ld("inspector",{fullscreen:!0}),children:e})})]})},P=()=>{const e=(0,d.jsxs)(n.Fragment,{children:[S&&b>1&&(0,d.jsx)("div",{children:(0,d.jsx)(j.m,{className:ld("result-tabs"),size:"l",items:(0,kc.c)(b).map((e=>({id:String(e),title:"Result #".concat(e+1)}))),activeTab:String(m),onSelectTab:e=>p(Number(e))})}),(0,d.jsx)("div",{className:ld("result"),children:C(f,T)})]});return(0,d.jsxs)(n.Fragment,{children:[e,g&&(0,d.jsx)(Nc,{children:(0,d.jsx)("div",{className:ld("result-fullscreen-wrapper"),children:e})})]})},D=()=>{if(!E)return null;if("object"===typeof E){const e=(0,d.jsx)(Xc,{data:E});return(0,d.jsxs)(n.Fragment,{children:[e,g&&(0,d.jsx)(Nc,{children:(0,d.jsx)("div",{className:ld("result-fullscreen-wrapper",ld("result")),children:e})})]})}return(0,d.jsx)("div",{className:ld("error"),children:E})};return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)("div",{className:ld("controls"),children:[(0,d.jsxs)("div",{className:ld("controls-right"),children:[(0,d.jsx)(Ic,{error:i}),o&&!i&&(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(od,{duration:null===o||void 0===o?void 0:o.DurationUs}),(0,d.jsx)(hc,{}),(0,d.jsx)(Rl.E,{options:dd,value:h,onUpdate:e=>{v(e)}})]})]}),(0,d.jsxs)("div",{className:ld("controls-left"),children:[(0,d.jsx)(mc.m,{text:N,view:"flat-secondary",title:"Copy results",disabled:w}),(0,d.jsx)(xc,{}),(0,d.jsx)(uc,{onCollapse:c,onExpand:u,isCollapsed:l,initialDirection:"bottom"})]})]}),h!==cd.result||i?(0,d.jsxs)("div",{className:ld("result"),children:[h===cd.stats&&!i&&I(),D()]}):P()]})}var md=a(2128),pd=a(60749);const hd=e=>{const t=e.name.split("|");return t.length>1?t[1]:e.name},vd=(0,c.cn)("ydb-query-explain-result"),gd={automaticLayout:!0,selectOnLineNumbers:!0,readOnly:!0,minimap:{enabled:!1},wrappingIndent:"indent"},xd={schema:"schema",json:"json",ast:"ast"},yd=[{value:xd.schema,content:"Schema"},{value:xd.json,content:"JSON"},{value:xd.ast,content:"AST"}];function bd(e){const t=n.useRef(),{data:a,opts:r,shapes:s,theme:o}=e;return n.useEffect((()=>{const e=document.getElementById("graphRoot");if(!e)throw new Error("Can't find element with id #graphRoot");return e.innerHTML="",t.current=(0,md.hP)("graphRoot",a,r,s),t.current.render(),()=>{t.current=void 0}}),[o]),n.useEffect((()=>{var a,n;null===(a=t.current)||void 0===a||null===(n=a.updateData)||void 0===n||n.call(a,e.data)}),[e.data]),(0,d.jsx)("div",{id:"graphRoot",style:{height:"100vh"}})}function Sd(e){const t=(0,y.zL)(),[a,r]=n.useState(xd.schema),s=(0,y.ix)((e=>e.fullscreen));n.useEffect((()=>()=>{t((0,gc.vj)())}),[t]);const o=()=>{var t,n;switch(a){case xd.schema:return Boolean(null===(t=e.explain)||void 0===t||null===(n=t.nodes)||void 0===n?void 0:n.length);case xd.json:return Boolean(e.explain);case xd.ast:return Boolean(e.ast);default:return!1}};return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:vd("controls"),children:!e.loading&&(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)("div",{className:vd("controls-right"),children:[(0,d.jsx)(Ic,{error:e.error}),!e.error&&(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(hc,{}),(0,d.jsx)(Rl.E,{options:yd,value:a,onUpdate:e=>{r(e)}})]})]}),(0,d.jsxs)("div",{className:vd("controls-left"),children:[(0,d.jsx)(xc,{disabled:Boolean(e.error)||!o()}),(0,d.jsx)(uc,{onCollapse:e.onCollapseResults,onExpand:e.onExpandResults,isCollapsed:e.isResultsCollapsed,initialDirection:"bottom"})]})]})}),(0,d.jsx)("div",{className:vd("result"),children:(()=>{const{error:t,loading:r}=e;if(r)return(0,d.jsx)("div",{className:vd("loader"),children:(0,d.jsx)(jn.a,{size:"m"})});if(t)return(0,d.jsx)("div",{className:vd("text-message"),children:(0,ie.fV)(e.error)});if(!o())return(0,d.jsx)("div",{className:vd("text-message"),children:"There is no ".concat(a," for the request")});switch(a){case xd.json:return(()=>{var t;const a=(0,d.jsx)(Zt(),{data:null===(t=e.explain)||void 0===t?void 0:t.pristine,isExpanded:()=>!0,className:vd("inspector"),searchOptions:{debounceTime:300}});return(0,d.jsxs)(n.Fragment,{children:[a,s&&(0,d.jsx)(Nc,{children:a})]})})();case xd.ast:return(()=>{const t=(0,d.jsx)("div",{className:vd("ast"),children:(0,d.jsx)(Jl,{language:pd.K,value:e.ast,options:gd,wrappingIndent:"indent",theme:"vs-".concat(e.theme)})});return(0,d.jsxs)(n.Fragment,{children:[t,s&&(0,d.jsx)(Nc,{children:t})]})})();case xd.schema:return(()=>{const{explain:t={},theme:r}=e,{links:o,nodes:i,version:l}=t,c=l===$l.v2,u=o&&i&&i.length,m=c&&u?(0,d.jsx)("div",{className:vd("explain-canvas-container",{hidden:a!==xd.schema}),children:(0,d.jsx)(bd,{theme:r,data:{links:o,nodes:i},opts:{renderNodeTitle:hd,textOverflow:"normal",initialZoomFitsCanvas:!0},shapes:{node:md.od}})}):null;return(0,d.jsxs)(n.Fragment,{children:[!s&&m,s&&(0,d.jsx)(Nc,{children:m})]})})();default:return null}})()})]})}const jd=le.h.injectEndpoints({endpoints:e=>({sendQuery:e.query({queryFn:async(e,t)=>{let{query:a,database:n,action:r}=e,{signal:s}=t;try{const e=await window.api.sendQuery({schema:"modern",query:a,database:n,action:r},{signal:s});return(0,ie.gW)(e)?{error:e}:{data:(0,ie.gY)(e)}}catch(o){return{error:o||new Error("Unauthorized")}}},providesTags:["All"]})}),overrideExisting:"throw"}),fd=(0,c.cn)("kv-preview"),Td=e=>{var t;let{database:a,path:n,type:r}=e;const s=(0,y.zL)(),o=(0,ue.vp)(r),[i]=(0,y.Rj)(),l=(0,y.ix)((e=>e.fullscreen)),c="--!syntax_v1\nselect * from `".concat(n,"` limit 32"),{currentData:u,isFetching:m,error:p}=jd.useSendQueryQuery({database:a,query:c,action:(0,ue.uL)(r)?"execute-query":"execute-scan"},{pollingInterval:i,skip:!o}),h=null!==u&&void 0!==u?u:{},v=()=>{s((0,g.m7)(!1))};if(m&&void 0===u)return(0,d.jsx)("div",{className:fd("loader-container"),children:(0,d.jsx)(jn.a,{size:"m"})});let x;o?p&&(x=(0,d.jsx)("div",{className:fd("message-container","error"),children:(0,ie.fV)(p)})):x=(0,d.jsx)("div",{className:fd("message-container"),children:Hl("preview.not-available")});const b=null!==(t=x)&&void 0!==t?t:(0,d.jsx)("div",{className:fd("result"),children:(0,d.jsx)(Mc,{data:h.result,columns:h.columns})});return(0,d.jsxs)("div",{className:fd(),children:[(0,d.jsxs)("div",{className:fd("header"),children:[(0,d.jsxs)("div",{className:fd("title"),children:[Hl("preview.title")," ",(0,d.jsx)("div",{className:fd("table-name"),children:n})]}),(0,d.jsxs)("div",{className:fd("controls-left"),children:[(0,d.jsx)(xc,{disabled:Boolean(p)}),(0,d.jsx)(Gn.z,{view:"flat-secondary",onClick:v,title:Hl("preview.close"),children:(0,d.jsx)(me.J,{data:ni.Z,size:18})})]})]}),l?(0,d.jsx)(Nc,{children:b}):b]})};var Nd=a(46089),wd=a(57542),Ed=a(30044),Cd=a(25822),Id=a(77264),Pd=a(20566);function Dd(){const[e]=(0,Pd.useSetting)(Pd.SAVED_QUERIES_KEY,[]);return e}const Rd=JSON.parse('{"action.save":"Save query","action.edit":"Edit query","action.save-as-new":"Save as new","action.edit-existing":"Edit existing","description":"The query will be saved in your browser","input-label":"Query name","input-placeholder":"Enter query name","button-apply":"Save","button-cancel":"Cancel","error.name-exists":"This name already exists","error.name-not-empty":"Name should not be empty"}'),Ad=(0,pe.wZ)("ydb-save-query-dialog",{en:Rd}),Ld=(0,c.cn)("ydb-save-query");function _d(e){let{isSaveButtonDisabled:t}=e;const a=(0,y.zL)(),n=(0,y.ix)(nc.g0),r=()=>{a((0,nc.lm)("save")),a((0,nc.y3)())},s=()=>{a((0,nc.PM)(n)),a((0,nc.y3)())};return n?(()=>{const e=[{action:s,text:Ad("action.edit-existing")},{action:r,text:Ad("action.save-as-new")}];return(0,d.jsx)(Ed.h,{items:e,renderSwitcher:e=>(0,d.jsx)(Gn.z,{...e,disabled:t,children:Ad("action.edit")}),popupProps:{placement:"top"}})})():(0,d.jsx)(Gn.z,{onClick:r,disabled:t,children:Ad("action.save")})}function Od(){const e=Dd(),t=(0,y.zL)(),a=(0,y.ix)(nc.oK),[r,s]=n.useState(""),[o,i]=n.useState(),l=()=>{t((0,nc.lm)("idle")),s(""),i(void 0)};return(0,d.jsxs)(Cd.V,{open:"save"===a,hasCloseButton:!1,size:"s",onClose:l,children:[(0,d.jsx)(Cd.V.Header,{caption:Ad("action.save")}),(0,d.jsxs)("form",{onSubmit:a=>{a.preventDefault();const n=(s=r)?e.some((e=>e.name.toLowerCase()===s.trim().toLowerCase()))?Ad("error.name-exists"):void 0:Ad("error.name-not-empty");var s;i(n),n||(t((0,nc.PM)(r)),l())},children:[(0,d.jsxs)(Cd.V.Body,{className:Ld("dialog-body"),children:[(0,d.jsx)("div",{className:Ld("dialog-row"),children:Ad("description")}),(0,d.jsxs)("div",{className:Ld("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"queryName",className:Ld("field-title","required"),children:Ad("input-label")}),(0,d.jsx)("div",{className:Ld("control-wrapper"),children:(0,d.jsx)(Id.o,{id:"queryName",placeholder:Ad("input-placeholder"),value:r,onUpdate:e=>{s(e),i(void 0)},hasClear:!0,autoFocus:!0,autoComplete:!1,validationState:o?"invalid":void 0,errorMessage:o})})]})]}),(0,d.jsx)(Cd.V.Footer,{textButtonApply:Ad("button-apply"),textButtonCancel:Ad("button-cancel"),onClickButtonCancel:l,propsButtonApply:{type:"submit"}})]})]})}const Md=(0,c.cn)("ydb-query-editor-controls"),kd={[ie.wZ.script]:{title:ie.U4[ie.wZ.script],description:Hl("method-description.script")},[ie.wZ.scan]:{title:ie.U4[ie.wZ.scan],description:Hl("method-description.scan")},[ie.wZ.data]:{title:ie.U4[ie.wZ.data],description:Hl("method-description.data")},[ie.wZ.query]:{title:ie.U4[ie.wZ.query],description:Hl("method-description.query")},[ie.wZ.pg]:{title:ie.U4[ie.wZ.pg],description:Hl("method-description.pg")}},Fd=e=>{let{onRunButtonClick:t,runIsLoading:a,onExplainButtonClick:r,explainIsLoading:s,disabled:o,onUpdateQueryMode:i,queryMode:l,highlightedAction:c}=e;const u=n.useMemo((()=>Object.entries(kd).map((e=>{let[t,{title:a,description:n}]=e;return{text:(0,d.jsx)(pt,{className:Md("item-with-popover"),contentClassName:Md("popover"),text:a,popoverContent:n}),action:()=>{i(t)}}}))),[i]),m="execute"===c?"action":void 0,p="explain"===c?"action":void 0;return(0,d.jsxs)("div",{className:Md(),children:[(0,d.jsxs)("div",{className:Md("left"),children:[(0,d.jsxs)(Gn.z,{onClick:()=>{t(l)},disabled:o,loading:a,view:m,children:[(0,d.jsx)(me.J,{data:Nd.Z,size:14}),"Run"]}),(0,d.jsx)(Gn.z,{onClick:()=>{r(l)},disabled:o,loading:s,view:p,children:"Explain"}),(0,d.jsx)("div",{className:Md("mode-selector"),children:(0,d.jsx)(Ed.h,{items:u,popupProps:{className:Md("mode-selector__popup"),qa:"query-mode-selector-popup"},switcher:(0,d.jsx)(Gn.z,{className:Md("mode-selector__button"),qa:"query-mode-selector",children:(0,d.jsxs)("span",{className:Md("mode-selector__button-content"),children:["".concat(Hl("controls.query-mode-selector_type")," ").concat(kd[l].title),(0,d.jsx)(me.J,{data:wd.Z})]})})})})]}),(0,d.jsx)(_d,{isSaveButtonDisabled:o})]})},zd={automaticLayout:!0,selectOnLineNumbers:!0,minimap:{enabled:!1}};const qd="navigation",Ud={EXECUTE:"execute",EXPLAIN:"explain"},Gd={sendQuery:"sendQuery",sendSelectedQuery:"sendSelectedQuery"},Bd=(0,c.cn)("query-editor"),Qd={triggerExpand:!1,triggerCollapse:!1,collapsed:!0};const Hd={saveQueryToHistory:as.hO,goToPreviousQuery:as.NU,goToNextQuery:as.AJ,setShowPreview:g.m7,setTenantPath:as.K0,setQueryAction:nc.lm},Zd=(0,Vt.$j)((e=>({executeQuery:e.executeQuery,showPreview:e.schema.showPreview})),Hd)((function(e){const t=function(){const[e]=(0,y.yu)(x.y6),[t]=(0,y.yu)(x.XX);return n.useMemo((()=>{const a=Boolean(e);return{quickSuggestions:a,suggestOnTriggerCharacters:a,acceptSuggestionOnEnter:t?"on":"off",...zd}}),[e,t])}(),{tenantName:a,path:r,setTenantPath:s,setQueryAction:o,executeQuery:i,type:l,theme:c,changeUserInput:u,showPreview:m}=e,{tenantPath:p}=i,[v,g]=n.useState(Ud.EXECUTE),[b,S]=n.useState(!1),[j,f]=(0,y.$6)(),[T]=(0,y.yu)(x.Rq),[N,w]=(0,y.yu)(x.w7),[E,C]=n.useState(null),[I,P]=as.mg.useExecuteQueryMutation(),[D,R]=ac.useExplainQueryMutation();n.useEffect((()=>{p!==a&&(p&&u({input:""}),s(a))}),[u,s,a,p]);const[A,_]=n.useReducer(cc(x.eG),Qd),O=n.useRef();n.useEffect((()=>{const e=()=>{O.current&&O.current.layout()},t=L()((()=>{e()}),100);return e(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[]),n.useEffect((()=>{_(oc.triggerCollapse)}),[]),n.useEffect((()=>{e.showPreview||b?_(oc.triggerExpand):_(oc.triggerCollapse)}),[e.showPreview,b]),n.useEffect((()=>{var e;const{input:t,history:a}=i,n=!!t&&t!==(null===(e=a.queries[a.queries.length-1])||void 0===e?void 0:e.queryText);return window.onbeforeunload=n?e=>{e.preventDefault(),e.returnValue=""}:null,()=>{window.onbeforeunload=null}}),[i]);const M=(t,n)=>{if(!t)return;const{input:r,history:s}=i,o=T?"multi":"modern",l=null!==n&&void 0!==n?n:r;if(w(ie.Jf.execute),g(Ud.EXECUTE),I({query:l,database:a,mode:t,schema:o}),S(!0),e.setShowPreview(!1),!n){var c;const{queries:a,currentIndex:n}=s;l!==(null===(c=a[n])||void 0===c?void 0:c.queryText)&&e.saveQueryToHistory(r,t)}_(oc.triggerExpand)},k=t=>{const{input:n}=i;w(ie.Jf.explain),g(Ud.EXPLAIN),D({query:n,database:a,mode:t}),S(!0),e.setShowPreview(!1),_(oc.triggerExpand)};return n.useEffect((()=>{if(null!==E)switch(C(null),E){case Gd.sendQuery:N===ie.Jf.explain?k(j):M(j);break;case Gd.sendSelectedQuery:{var e,t;const a=null===(e=O.current)||void 0===e?void 0:e.getSelection(),n=null===(t=O.current)||void 0===t?void 0:t.getModel();if(a&&n){const e=n.getValueInRange({startLineNumber:a.getSelectionStart().lineNumber,startColumn:a.getSelectionStart().column,endLineNumber:a.getPosition().lineNumber,endColumn:a.getPosition().column});M(j,e)}break}}}),[E]),(0,d.jsxs)("div",{className:Bd(),children:[(0,d.jsxs)(h,{direction:"vertical",defaultSizePaneKey:x.XN,triggerCollapse:A.triggerCollapse,triggerExpand:A.triggerExpand,minSize:[0,52],collapsedSizes:[100,0],onSplitStartDragAdditional:()=>{_(oc.clear)},children:[(0,d.jsxs)("div",{className:Bd("pane-wrapper",{top:!0}),children:[(0,d.jsx)("div",{className:Bd("monaco-wrapper"),children:(0,d.jsx)("div",{className:Bd("monaco"),children:(0,d.jsx)(Jl,{language:rc.Oo,value:i.input,options:t,onChange:t=>{e.changeUserInput({input:t})},editorDidMount:(t,a)=>{const n=function(e){const{KeyMod:t,KeyCode:a}=e,n=t.CtrlCmd;return{sendQuery:n|a.Enter,sendSelectedQuery:n|t.Shift|e.KeyCode.Enter,selectPreviousQuery:n|a.UpArrow,selectNextQuery:n|a.DownArrow,saveQuery:n|a.KeyS,saveSelectedQuery:n|t.Shift|a.KeyS}}(a);O.current=t,t.focus(),t.addAction({id:"sendQuery",label:Hl("action.send-query"),keybindings:[n.sendQuery],precondition:void 0,keybindingContext:void 0,contextMenuGroupId:qd,contextMenuOrder:1,run:()=>C(Gd.sendQuery)});const r=t.createContextKey("canSendSelectedText",!1);t.onDidChangeCursorSelection((e=>{let{selection:t,secondarySelections:a}=e;const n=t.selectionStartLineNumber!==t.positionLineNumber||t.selectionStartColumn!==t.positionColumn,s=a.length>0;r.set(n&&!s)})),t.addAction({id:"sendSelectedQuery",label:Hl("action.send-selected-query"),keybindings:[n.sendSelectedQuery],precondition:"canSendSelectedText",contextMenuGroupId:qd,contextMenuOrder:1,run:()=>C(Gd.sendSelectedQuery)}),t.addAction({id:"previous-query",label:Hl("action.previous-query"),keybindings:[n.selectPreviousQuery],contextMenuGroupId:qd,contextMenuOrder:2,run:()=>{e.goToPreviousQuery()}}),t.addAction({id:"next-query",label:Hl("action.next-query"),keybindings:[n.selectNextQuery],contextMenuGroupId:qd,contextMenuOrder:3,run:()=>{e.goToNextQuery()}}),t.addAction({id:"save-query",label:Hl("action.save-query"),keybindings:[n.saveQuery],run:()=>{o("save")}})},theme:"vs-".concat(c)})})}),(0,d.jsx)(Fd,{onRunButtonClick:M,runIsLoading:P.isLoading,onExplainButtonClick:k,explainIsLoading:R.isLoading,disabled:!i.input,onUpdateQueryMode:f,queryMode:j,highlightedAction:N})]}),(0,d.jsx)("div",{className:Bd("pane-wrapper"),children:(0,d.jsx)(Vd,{executeQueryData:P.data,executeQueryError:P.error,explainQueryData:R.data,explainQueryError:R.error,explainQueryLoading:R.isLoading,resultVisibilityState:A,onExpandResultHandler:()=>{_(oc.triggerExpand)},onCollapseResultHandler:()=>{_(oc.triggerCollapse)},type:l,theme:c,resultType:v,tenantName:a,path:r,showPreview:m})})]}),(0,d.jsx)(Od,{})]})}));function Vd(e){let{executeQueryData:t,executeQueryError:a,explainQueryData:n,explainQueryError:r,explainQueryLoading:s,resultVisibilityState:o,onExpandResultHandler:i,onCollapseResultHandler:l,type:c,theme:u,resultType:m,tenantName:p,path:h,showPreview:v}=e;if(v)return(0,d.jsx)(Td,{database:p,path:h,type:c});if(m===Ud.EXECUTE){if(t||a){const{stats:e,...n}=t||{};return(0,d.jsx)(ud,{data:n,stats:e,error:a,isResultsCollapsed:o.collapsed,onExpandResults:i,onCollapseResults:l})}return null}if(m===Ud.EXPLAIN){const{plan:e,ast:t}=n||{};return(0,d.jsx)(Sd,{error:r,explain:e,ast:t,loading:s,theme:u,isResultsCollapsed:o.collapsed,onExpandResults:i,onCollapseResults:l})}return null}const Wd=[{id:S._0.newQuery,title:Hl("tabs.newQuery")},{id:S._0.history,title:Hl("tabs.history")},{id:S._0.saved,title:Hl("tabs.saved")}],Jd=e=>{let{className:t,activeTab:a}=e;const n=(0,Ca.TH)(),r=(0,N.mB)(n);return(0,d.jsx)("div",{className:t,children:(0,d.jsx)(j.m,{size:"l",allowNotSelected:!0,activeTab:a,items:Wd,wrapTo:(e,t)=>{let{id:a}=e;const n=(0,Ue.Sj)({...r,[Ue.XV.queryTab]:a});return(0,d.jsx)(Xr.h,{to:n,children:t},a)}})})};var Kd=a(20847),Yd=a(16459);const Xd=(0,c.cn)("ydb-saved-queries"),$d=e=>{let{visible:t,queryName:a,onCancelClick:n,onConfirmClick:r}=e;return(0,d.jsxs)(Cd.V,{open:t,hasCloseButton:!1,size:"s",onClose:n,onEnterKeyDown:r,children:[(0,d.jsx)(Cd.V.Header,{caption:Hl("delete-dialog.header")}),(0,d.jsxs)(Cd.V.Body,{className:Xd("dialog-body"),children:[Hl("delete-dialog.question"),(0,d.jsx)("span",{className:Xd("dialog-query-name"),children:" ".concat(a,"?")})]}),(0,d.jsx)(Cd.V.Footer,{textButtonApply:Hl("delete-dialog.delete"),textButtonCancel:Hl("delete-dialog.cancel"),onClickButtonCancel:n,onClickButtonApply:r})]})},eu=e=>{let{changeUserInput:t}=e;const a=Dd(),r=(0,y.zL)(),[s,o]=n.useState(!1),[i,l]=n.useState(""),c=()=>{o(!1),l("")},u=[{name:"name",header:"Name",render:e=>{let{row:t}=e;return(0,d.jsx)("div",{className:Xd("query-name"),children:t.name})},width:200},{name:"body",header:"Query Text",render:e=>{let{row:t}=e;return(0,d.jsxs)("div",{className:Xd("query"),children:[(0,d.jsx)("div",{className:Xd("query-body"),children:(0,d.jsx)(os,{value:t.body,maxQueryHeight:ws})}),(0,d.jsxs)("span",{className:Xd("controls"),children:[(0,d.jsx)(Gn.z,{view:"flat-secondary",children:(0,d.jsx)(me.J,{data:Kd.Z})}),(0,d.jsx)(Gn.z,{view:"flat-secondary",onClick:(a=t.name,e=>{e.stopPropagation(),o(!0),l(a)}),children:(0,d.jsx)(me.J,{data:Yd.Z})})]})]});var a},sortable:!1,resizeMinWidth:650}];return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:Xd(),children:(0,d.jsx)(se.G,{columnsWidthLSKey:"savedQueriesTableColumnsWidth",columns:u,data:a,settings:Es,emptyDataMessage:Hl("saved.empty"),rowClassName:()=>Xd("row"),onRowClick:e=>{return a=e.body,n=e.name,t({input:a}),r((0,nc.GC)(n)),void r((0,w.jk)(S._0.newQuery));var a,n},initialSortOrder:{columnId:"name",order:ne.ZP.ASCENDING}})}),(0,d.jsx)($d,{visible:s,queryName:i,onCancelClick:()=>{c()},onConfirmClick:()=>{c(),r((0,nc.qF)(i)),l("")}})]})},tu=(0,c.cn)("ydb-query"),au=e=>{const t=(0,y.zL)(),{queryTab:a=S._0.newQuery}=(0,y.ix)((e=>e.tenant)),s=e=>{t((0,as.B8)(e))},o=n.useMemo((()=>Wd.find((e=>{let{id:t}=e;return t===a}))),[a]);return(0,d.jsxs)("div",{className:tu(),children:[o?(0,d.jsx)(r.ql,{children:(0,d.jsx)("title",{children:o.title})}):null,(0,d.jsx)(Jd,{className:tu("tabs"),activeTab:a}),(0,d.jsx)("div",{className:tu("content"),children:(()=>{switch(a){case S._0.newQuery:return(0,d.jsx)(Zd,{changeUserInput:s,...e});case S._0.history:return(0,d.jsx)(Wl,{changeUserInput:s});case S._0.saved:return(0,d.jsx)(eu,{changeUserInput:s});default:return null}})()})]})};var nu=a(68309),ru=a(85807);const su=["query","diagnostics"],ou={query:nu.Z,diagnostics:ru.Z};const iu=(0,c.cn)("ydb-tenant-navigation"),lu=e=>{let{id:t,title:a,icon:n}=e;return{value:t,content:(0,d.jsxs)("span",{className:iu("item"),children:[(0,d.jsx)(me.J,{data:n,size:16,className:iu("icon")}),(0,d.jsx)("span",{className:iu("text"),children:a})]})}},cu=()=>{const e=function(){const e=(0,Ca.k6)(),t=(0,Ca.TH)(),a=(0,N.mB)(t),[,r]=(0,y.yu)(x.pf),{tenantPage:s}=(0,y.ix)((e=>e.tenant)),o=n.useMemo((()=>{if(t.pathname!==N.ZP.tenant)return[];const n=su.map((t=>{const n=S.m2[t],o=(0,Ue.Sj)({...a,[S.bS]:n});return{id:n,title:cn("pages.".concat(t)),icon:ou[t],path:o,current:s===n,onForward:()=>{r(n),e.push(o)}}}));return n}),[s,r,t.pathname,e,a]);return o}();return(0,d.jsx)("div",{className:iu(),children:(0,d.jsx)(Rl.E,{width:"auto",onUpdate:t=>{const a=e.find((e=>e.id===t));null===a||void 0===a||a.onForward()},size:"l",className:iu("body"),value:(e.find((e=>e.current))||e[0]).id,options:e.map(lu)})})},du=(0,c.cn)("object-general");const uu=function(e){const t=(0,b.C)(),{tenantPage:a}=(0,y.ix)((e=>e.tenant));return(0,d.jsxs)("div",{className:du(),children:[(0,d.jsx)(cu,{}),(()=>{const{type:n,additionalTenantProps:r,additionalNodesProps:s,tenantName:o,path:i}=e;return a===S.m2.query?(0,d.jsx)(au,{tenantName:o,path:i,theme:t,type:n}):(0,d.jsx)(Bl,{type:n,tenantName:o,path:i,additionalTenantProps:r,additionalNodesProps:s})})()]})};var mu=a(9593);const pu=le.h.injectEndpoints({endpoints:e=>({getSchemaAcl:e.query({queryFn:async(e,t)=>{let{path:a}=e,{signal:n}=t;try{const e=await window.api.getSchemaAcl({path:a},{signal:n});return{data:{acl:e.Common.ACL,owner:e.Common.Owner}}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"}),hu=(0,c.cn)("ydb-acl"),vu=e=>{if(e&&e.endsWith("@staff")&&!e.startsWith("svc_")){return e.split("@")[0]}return e},gu=["access","type","inheritance"],xu={access:"Access",type:"Access type",inheritance:"Inheritance type"},yu="Allow",bu=new Set(["Object","Container"]);function Su(e){let{value:t}=e;const a="string"===typeof t?[t]:t;return(0,d.jsx)("div",{className:hu("definition-content"),children:a.map((e=>(0,d.jsx)("span",{children:e},e)))})}function ju(e){if(!e||!e.length)return[];const t=function(e){return e.map((e=>{const{AccessRules:t=[],AccessRights:a=[],AccessType:n,InheritanceType:r,Subject:s}=e,o=t.concat(a),i=n===yu?void 0:n;let l;return((null===r||void 0===r?void 0:r.length)!==bu.size||r.some((e=>!bu.has(e))))&&(l=r),{access:o.length?o:void 0,type:i,inheritance:l,Subject:s}}))}(e);return t.map((e=>{let{Subject:t,...a}=e;const n=Object.entries(a).filter((e=>{let[t,a]=e;return Boolean(a)}));return 1===n.length&&"access"===n[0][0]?{name:t,content:(0,d.jsx)(Su,{value:n[0][1]})}:{label:(0,d.jsx)("span",{className:hu("group-label"),children:t}),items:gu.map((e=>{const t=a[e];if(t)return{name:xu[e],content:(0,d.jsx)(Su,{value:t})}})).filter(kc.D)}}))}const fu=e=>{let{path:t}=e;const{currentData:a,isFetching:r,error:s}=pu.useGetSchemaAclQuery({path:t}),o=r&&!a,{acl:l,owner:c}=a||{},u=ju(l),m=function(e){const t=vu(e);return t?[{name:(0,d.jsx)("span",{className:hu("owner"),children:t}),content:(0,d.jsx)("span",{className:hu("owner"),children:cn("acl.owner")})}]:[]}(c);return o?(0,d.jsx)(i.a,{}):s?(0,d.jsx)(I.V,{error:s}):l||c?(0,d.jsxs)("div",{className:hu(),children:[m.length?(0,d.jsx)(_a.w,{items:m,nameMaxWidth:200,className:hu("owner-container")}):null,u.length?(0,d.jsx)(_a.w,{items:u,nameMaxWidth:200,className:hu("result")}):null]}):(0,d.jsx)(n.Fragment,{children:cn("acl.empty")})};var Tu=a(7504),Nu=a(69886),wu=a.n(Nu),Eu=a(80977);const Cu=e=>"-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table\nCREATE TABLE `".concat(e,"/ydb_row_table` (\n    category_id Uint64 NOT NULL,\n    id Uint64,\n    expire_at Datetime,\n    updated_on Datetime,\n    name Text,\n    `binary-payload` Bytes,\n    attributes JsonDocument,\n    -- uncomment to add a secondary index\n    -- INDEX idx_row_table_id GLOBAL SYNC ON ( id ) COVER ( name, attributes ), -- Secondary indexes docs https://ydb.tech/en/docs/yql/reference/syntax/create_table#secondary_index\n    PRIMARY KEY (category_id, id)\n) \nWITH (\n    AUTO_PARTITIONING_BY_SIZE = ENABLED,\n    AUTO_PARTITIONING_PARTITION_SIZE_MB = 2048,\n    AUTO_PARTITIONING_BY_LOAD = ENABLED,\n    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = 4,\n    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = 1024,\n    -- uncomment to create a table with predefined partitions\n    -- UNIFORM_PARTITIONS = 4, -- The number of partitions for uniform initial table partitioning.\n                            -- The primary key's first column must have type Uint64 or Uint32.\n                            -- A created table is immediately divided into the specified number of partitions\n    -- uncomment to launch read only replicas in every AZ\n    -- READ_REPLICAS_SETTINGS = 'PER_AZ:1', -- Enable read replicas for stale read, launch one replica in every availability zone\n    -- uncomment to enable ttl\n    -- TTL = Interval(\"PT1H\") ON expire_at, -- Enable background deletion of expired rows https://ydb.tech/en/docs/concepts/ttl\n    KEY_BLOOM_FILTER = ENABLED -- With a Bloom filter, you can more efficiently determine\n                               -- if some keys are missing in a table when making multiple single queries by the primary key.\n)"),Iu=e=>"-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table#olap-tables\nCREATE TABLE `".concat(e,"/ydb_column_table` (\n    id Int64 NOT NULL,\n    author Text,\n    title Text,\n    body Text,\n    PRIMARY KEY (id)\n)\nPARTITION BY HASH(id)\nWITH (STORE = COLUMN)"),Pu=()=>'CREATE OBJECT secret_name (TYPE SECRET) WITH value="secret_value";\n\nCREATE ASYNC REPLICATION my_replication\nFOR `/remote_database/table_name` AS `local_table_name` --[, `/remote_database/another_table_name` AS `another_local_table_name` ...]\nWITH (\n    CONNECTION_STRING="grpcs://mydb.ydb.tech:2135/?database=/remote_database",\n    TOKEN_SECRET_NAME = "secret_name"\n    -- ENDPOINT="mydb.ydb.tech:2135",\n    -- DATABASE=`/remote_database`,\n    -- USER="user",\n    -- PASSWORD_SECRET_NAME="your_password"\n);',Du=e=>"ALTER TABLE `".concat(e,"`\n    ADD COLUMN is_deleted Bool;"),Ru=e=>"SELECT *\n    FROM `".concat(e,"`\n    LIMIT 10;"),Au=e=>"UPSERT INTO `".concat(e,"`\n    ( `id`, `name` )\nVALUES ( );"),Lu=e=>"DROP EXTERNAL TABLE `".concat(e,"`;"),_u=e=>{const t=e.split("/").slice(0,-1).join("/");return"CREATE EXTERNAL TABLE `".concat(t,'/my_external_table` (\n    column1 Int,\n    column2 Int\n) WITH (\n    DATA_SOURCE="').concat(e,'",\n    LOCATION="",\n    FORMAT="json_as_string",\n    `file_pattern`=""\n);')},Ou=e=>"-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_topic\nCREATE TOPIC `".concat(e,"/my_topic` (\n    CONSUMER consumer1,\n    CONSUMER consumer2 WITH (read_from = Datetime('1970-01-01T00:00:00Z')) -- Sets up the message write time starting from which the consumer will receive data.\n                                                                           -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format). \n                                                                           -- Default value: now\n) WITH (\n    min_active_partitions = 1, -- Minimum number of topic partitions.\n    partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.\n    retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.\n    retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. \n                              -- When this value is exceeded, the older data is cleared, like under a retention policy. \n                              -- 0 is interpreted as unlimited.\n    partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.\n    partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. \n                                    -- When set to zero, the actual write_burst value is equalled to \n                                    -- the quota value (this allows write bursts of up to one second).\n);"),Mu=e=>"-- docs: https://ydb.tech/en/docs/yql/reference/syntax/alter_topic\nALTER TOPIC `".concat(e,"`\n    ADD CONSUMER new_consumer WITH (read_from = Datetime('1970-01-01T00:00:00Z')), -- Sets up the message write time starting from which the consumer will receive data.\n                                                                                   -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format).\n                                                                                   -- Default value: now\n    ALTER CONSUMER consumer1 SET (read_from = Datetime('1970-01-01T00:00:00Z')),\n    DROP CONSUMER consumer2,\n    SET (\n        min_active_partitions = 1, -- Minimum number of topic partitions.\n        partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.\n        retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.\n        retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. \n                                  -- When this value is exceeded, the older data is cleared, like under a retention policy. \n                                  -- 0 is interpreted as unlimited.\n        partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.\n        partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. \n                                        -- When set to zero, the actual write_burst value is equalled to\n                                        -- the quota value (this allows write bursts of up to one second).\n    );"),ku=e=>"DROP TOPIC `".concat(e,"`;"),Fu=e=>"CREATE VIEW `".concat(e,"/my_view` WITH (security_invoker = TRUE) AS SELECT 1;"),zu=e=>"DROP VIEW `".concat(e,"`;"),qu=e=>"DROP ASYNC REPLICATION `".concat(e,"`;"),Uu=e=>"ALTER ASYNC REPLICATION `".concat(e,'` SET (STATE = "DONE", FAILOVER_MODE = "FORCE");'),Gu=(e,t)=>(a,n)=>{const r=((e,t,a)=>{const{setActivePath:n,setQueryMode:r,showCreateDirectoryDialog:s}=a,o=(a,s)=>()=>{s&&r(s),t((0,as.B8)({input:a(e)})),t((0,w.Cs)(S.m2.query)),t((0,w.jk)(S._0.newQuery)),n(e)};return{createDirectory:s?()=>{s(e)}:void 0,createTable:o(Cu,"script"),createColumnTable:o(Iu,"script"),createAsyncReplication:o(Pu,"script"),alterAsyncReplication:o(Uu,"script"),dropAsyncReplication:o(qu,"script"),alterTable:o(Du,"script"),selectQuery:o(Ru),upsertQuery:o(Au),createExternalTable:o(_u,"script"),dropExternalTable:o(Lu,"script"),selectQueryFromExternalTable:o(Ru,"query"),createTopic:o(Ou,"script"),alterTopic:o(Mu,"script"),dropTopic:o(ku,"script"),createView:o(Fu,"script"),dropView:o(zu,"script"),copyPath:()=>{try{wu()(e),(0,Eu.Z)({name:"Copied",title:cn("actions.copied"),type:"success"})}catch{(0,Eu.Z)({name:"Not copied",title:cn("actions.notCopied"),type:"error"})}}}})(a,e,t),s={text:cn("actions.copyPath"),action:r.copyPath},o=[[s],[{text:cn("actions.createTable"),action:r.createTable},{text:cn("actions.createColumnTable"),action:r.createColumnTable},{text:cn("actions.createAsyncReplication"),action:r.createAsyncReplication},{text:cn("actions.createTopic"),action:r.createTopic},{text:cn("actions.createView"),action:r.createView}]];r.createDirectory&&o.splice(1,0,[{text:cn("actions.createDirectory"),action:r.createDirectory}]);const i=[[s],[{text:cn("actions.alterTable"),action:r.alterTable},{text:cn("actions.selectQuery"),action:r.selectQuery},{text:cn("actions.upsertQuery"),action:r.upsertQuery}]],l=[[s],[{text:cn("actions.alterTopic"),action:r.alterTopic},{text:cn("actions.dropTopic"),action:r.dropTopic}]],c=[[s],[{text:cn("actions.selectQuery"),action:r.selectQueryFromExternalTable}],[{text:cn("actions.dropTable"),action:r.dropExternalTable}]],d=[[s],[{text:cn("actions.createExternalTable"),action:r.createExternalTable}]],u=[[s],[{text:cn("actions.selectQuery"),action:r.selectQuery}],[{text:cn("actions.dropView"),action:r.dropView}]],m=[s];return{async_replication:[[s],[{text:cn("actions.alterReplication"),action:r.alterAsyncReplication},{text:cn("actions.dropReplication"),action:r.dropAsyncReplication}]],database:o,directory:o,table:i,column_table:i,index_table:m,topic:l,stream:m,index:m,external_table:c,external_data_source:d,view:u}[n]},Bu=(e,t)=>(a,n)=>{const r=((e,t,a)=>{const{setActivePath:n}=a;return{openPreview:()=>{t((0,g.m7)(!0)),t((0,w.Cs)(S.m2.query)),t((0,w.jk)(S._0.newQuery)),n(e)}}})(a,e,t),s=(0,d.jsx)(Gn.z,{view:"flat-secondary",onClick:r.openPreview,title:cn("actions.openPreview"),size:"s",children:(0,d.jsx)(me.J,{data:mu.Z})});return{async_replication:void 0,database:void 0,directory:void 0,table:s,column_table:s,index_table:void 0,topic:void 0,stream:void 0,index:void 0,external_table:s,external_data_source:void 0,view:s}[n]},Qu=(0,c.cn)("ydb-schema-create-directory-dialog"),Hu="relativePath";function Zu(e){let{open:t,onClose:a,parentPath:r,onSuccess:s}=e;const[o,i]=n.useState(""),[l,c]=n.useState(""),[u,m]=g.m3.useCreateDirectoryMutation(),p=()=>{i(""),m.reset()},h=()=>{a(),c(""),p()};return(0,d.jsxs)(Cd.V,{open:t,onClose:h,size:"s",children:[(0,d.jsx)(Cd.V.Header,{caption:cn("schema.tree.dialog.header")}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=(a=l)?/\s/.test(a)?cn("schema.tree.dialog.whitespace"):"":cn("schema.tree.dialog.empty");var a;i(t),t||(()=>{const e="".concat(r,"/").concat(l);u({database:r,path:e}).unwrap().then((()=>{h(),s(l)}))})()},children:[(0,d.jsxs)(Cd.V.Body,{children:[(0,d.jsxs)("label",{htmlFor:Hu,className:Qu("label"),children:[(0,d.jsx)("span",{className:Qu("description"),children:cn("schema.tree.dialog.description")}),"".concat(r,"/")]}),(0,d.jsx)("div",{className:Qu("input-wrapper"),children:(0,d.jsx)(Id.o,{placeholder:cn("schema.tree.dialog.placeholder"),value:l,onUpdate:e=>{c(e),p()},autoFocus:!0,hasClear:!0,autoComplete:!1,disabled:m.isLoading,validationState:o?"invalid":void 0,id:Hu,errorMessage:o})}),m.isError&&(0,d.jsx)(I.V,{error:m.error,defaultMessage:cn("schema.tree.dialog.invalid")})]}),(0,d.jsx)(Cd.V.Footer,{loading:m.isLoading,textButtonApply:cn("schema.tree.dialog.buttonApply"),textButtonCancel:cn("schema.tree.dialog.buttonCancel"),onClickButtonCancel:h,propsButtonApply:{type:"submit"}})]})]})}function Vu(e){const[t]=(0,y.yu)(Pd.USE_DIRECTORY_OPERATIONS),{rootPath:a,rootName:r,rootType:s,currentPath:o,onActivePathUpdate:i}=e,l=(0,y.zL)(),[c,u]=(0,y.$6)(),[m,p]=n.useState(!1),[h,v]=n.useState(""),[x,b]=n.useState("");n.useEffect((()=>{null!==o&&void 0!==o&&o.startsWith(a)||i(a)}),[o,i,a]);return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Zu,{onClose:()=>{p(!1)},open:m,parentPath:h,onSuccess:e=>{const t="".concat(h,"/").concat(e);i(t),b(t)}}),(0,d.jsx)(Tu.f,{rootState:{path:a,name:r,type:(0,ue.lZ)(s),collapsed:!1},fetchPath:async e=>{let t;for(;;){const a=l(g.m3.endpoints.getSchema.initiate({path:e},{forceRefetch:!0})),{data:n,originalArgs:r}=await a;if(a.unsubscribe(),(null===r||void 0===r?void 0:r.path)===e){t=null===n||void 0===n?void 0:n[e];break}}if(!t)throw new Error("no describe data about path ".concat(e));const{PathDescription:{Children:a=[]}={}}=t;return a.map((e=>{const{Name:t="",PathType:a,PathSubType:n}=e;return{name:t,type:(0,ue.lZ)(a,n),expandable:!(0,ue.Sb)(a,n)}}))},getActions:Gu(l,{setActivePath:i,setQueryMode:u,showCreateDirectoryDialog:t?e=>{v(e),p(!0)}:void 0}),renderAdditionalNodeElements:Bu(l,{setActivePath:i}),activePath:o,onActivePathUpdate:i,cache:!1,virtualize:!0},x)]})}const Wu=(0,c.cn)("object-summary"),Ju=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:Boolean(localStorage.getItem(x.Mn))});function Ku(e){var t;let{type:a,subType:r,tenantName:s,path:o,onCollapseSummary:i,onExpandSummary:l,isCollapsed:c}=e;const u=(0,y.zL)(),[m,p]=n.useReducer(cc(x.Mn),void 0,Ju),{summaryTab:v=S.uw.overview}=(0,y.ix)((e=>e.tenant)),b=(0,Ca.TH)(),T=dt().parse(b.search,{ignoreQueryPrefix:!0}),{data:E}=(0,g.hz)({path:o}),C=null===E||void 0===E||null===(t=E.PathDescription)||void 0===t?void 0:t.Self;n.useEffect((()=>{const e=(0,ue.vp)(a);!a||e||Ue.Cc.find((e=>e.id===v))||u((0,w.Tu)(S.uw.overview))}),[u,a,v]);const I=()=>{const e=(0,ue.vp)(a)?[...Ue.Cc,...Ue.c7]:Ue.Cc;return(0,d.jsx)("div",{className:Wu("tabs"),children:(0,d.jsx)(j.m,{size:"l",items:e,activeTab:v,wrapTo:(e,t)=>{let{id:a}=e;const n=(0,N.ax)(N.ZP.tenant,void 0,{...T,name:s,[Ue.XV.summaryTab]:a});return(0,d.jsx)(f.rU,{to:n,className:Wu("tab"),children:t},a)},allowNotSelected:!0})})},P=()=>{switch(v){case S.uw.acl:return(0,d.jsx)(fu,{path:o});case S.uw.schema:return(0,d.jsx)(qe,{type:a,path:o,tenantName:s});default:return(()=>{var e;if(!C)return;const{CreateStep:t,PathType:a,PathSubType:n,PathId:r,PathVersion:s}=C,o=[];o.push({label:cn("summary.type"),value:null===a||void 0===a?void 0:a.replace(/^EPathType/,"")}),n!==Me.mR.EPathSubTypeEmpty&&o.push({label:cn("summary.subtype"),value:null===n||void 0===n?void 0:n.replace(/^EPathSubType/,"")}),o.push({label:cn("summary.id"),value:r}),o.push({label:cn("summary.version"),value:s}),o.push({label:cn("summary.created"),value:(0,R.o0)(t,"")});const{PathDescription:i}=E,l=(0,d.jsx)(dn,{data:i}),c={[Me.gb.EPathTypeInvalid]:void 0,[Me.gb.EPathTypeDir]:void 0,[Me.gb.EPathTypeTable]:()=>{var e;return[{label:cn("summary.partitions"),value:null===i||void 0===i||null===(e=i.TablePartitions)||void 0===e?void 0:e.length}]},[Me.gb.EPathTypeSubDomain]:void 0,[Me.gb.EPathTypeTableIndex]:void 0,[Me.gb.EPathTypeExtSubDomain]:()=>{var e,t;return[{label:cn("summary.paths"),value:null===i||void 0===i||null===(e=i.DomainDescription)||void 0===e?void 0:e.PathsInside},{label:cn("summary.shards"),value:null===i||void 0===i||null===(t=i.DomainDescription)||void 0===t?void 0:t.ShardsInside}]},[Me.gb.EPathTypeColumnStore]:()=>{var e,t;return[{label:cn("summary.partitions"),value:null===i||void 0===i||null===(e=i.ColumnStoreDescription)||void 0===e||null===(t=e.ColumnShards)||void 0===t?void 0:t.length}]},[Me.gb.EPathTypeColumnTable]:()=>{var e,t,a;return[{label:cn("summary.partitions"),value:null===i||void 0===i||null===(e=i.ColumnTableDescription)||void 0===e||null===(t=e.Sharding)||void 0===t||null===(a=t.ColumnShards)||void 0===a?void 0:a.length}]},[Me.gb.EPathTypeCdcStream]:()=>{const{Mode:e,Format:t}=(null===i||void 0===i?void 0:i.CdcStreamDescription)||{};return[{label:cn("summary.mode"),value:null===e||void 0===e?void 0:e.replace(/^ECdcStreamMode/,"")},{label:cn("summary.format"),value:null===t||void 0===t?void 0:t.replace(/^ECdcStreamFormat/,"")}]},[Me.gb.EPathTypePersQueueGroup]:()=>{var e,t,a;const n=null===i||void 0===i?void 0:i.PersQueueGroup,r=null===n||void 0===n||null===(e=n.PQTabletConfig)||void 0===e||null===(t=e.PartitionConfig)||void 0===t?void 0:t.LifetimeSeconds;return[{label:cn("summary.partitions"),value:null===n||void 0===n||null===(a=n.Partitions)||void 0===a?void 0:a.length},{label:cn("summary.retention"),value:r&&(0,R.xh)(r)}]},[Me.gb.EPathTypeExternalTable]:()=>{var e,t;const a=(0,N.vF)({...T,schema:null===i||void 0===i||null===(e=i.ExternalTableDescription)||void 0===e?void 0:e.DataSourcePath}),{SourceType:n,DataSourcePath:r}=(null===i||void 0===i?void 0:i.ExternalTableDescription)||{},s=(null===r||void 0===r||null===(t=r.match(/([^/]*)\/*$/))||void 0===t?void 0:t[1])||"";return[{label:cn("summary.source-type"),value:n},{label:cn("summary.data-source"),value:r&&(0,d.jsx)("span",{title:r,children:(0,d.jsx)(Ia.j,{title:s||"",url:a})})}]},[Me.gb.EPathTypeExternalDataSource]:()=>{var e;return[{label:cn("summary.source-type"),value:null===i||void 0===i||null===(e=i.ExternalDataSourceDescription)||void 0===e?void 0:e.SourceType}]},[Me.gb.EPathTypeView]:void 0,[Me.gb.EPathTypeReplication]:()=>{var e;const t=null===i||void 0===i||null===(e=i.ReplicationDescription)||void 0===e?void 0:e.State;return t?[{label:cn("summary.state"),value:(0,d.jsx)(Ua,{state:t})}]:[]}},u=a&&(null===(e=c[a])||void 0===e?void 0:e.call(c))||[];return o.push(...u),(0,d.jsx)(go.Z,{title:l,info:o.filter((e=>e.value))})})()}},D=()=>{p(oc.triggerCollapse)},A=()=>{p(oc.triggerExpand)},L=()=>{p(oc.clear)},_=()=>{u((0,g.m7)(!0)),u((0,w.Cs)(S.m2.query)),u((0,w.jk)(S._0.newQuery))},O=()=>{const e=(0,ue.vp)(a)&&!(0,ue.dC)(r);return(0,d.jsxs)(n.Fragment,{children:[e&&(0,d.jsx)(Gn.z,{view:"flat-secondary",onClick:_,title:cn("summary.showPreview"),children:(0,d.jsx)(me.J,{data:mu.Z})}),(0,d.jsx)(mc.m,{text:o,view:"flat-secondary",title:cn("summary.copySchemaPath")}),(0,d.jsx)(uc,{onCollapse:D,onExpand:A,isCollapsed:m.collapsed,initialDirection:"bottom"})]})},M=()=>{const{Status:e,Reason:t}=null!==E&&void 0!==E?E:{};let n;return!a&&e&&t&&(n="".concat(e,": ").concat(t)),a?(0,d.jsx)("div",{className:Wu("entity-type"),children:a.replace("EPathType","")}):(0,d.jsx)("div",{className:Wu("entity-type",{error:!0}),children:(0,d.jsx)(mt.J,{content:n,offset:{left:0}})})};return(0,d.jsxs)("div",{className:Wu(),children:[(0,d.jsx)("div",{className:Wu({hidden:c}),children:(0,d.jsxs)(h,{direction:"vertical",defaultSizePaneKey:x.wr,onSplitStartDragAdditional:L,triggerCollapse:m.triggerCollapse,triggerExpand:m.triggerExpand,minSize:[200,52],collapsedSizes:[100,0],children:[(0,d.jsx)(Yu,{tenantName:s,path:o}),(0,d.jsxs)("div",{className:Wu("info"),children:[(0,d.jsxs)("div",{className:Wu("sticky-top"),children:[(0,d.jsxs)("div",{className:Wu("info-header"),children:[(0,d.jsxs)("div",{className:Wu("info-title"),children:[M(),(0,d.jsx)("div",{className:Wu("path-name"),children:o})]}),(0,d.jsx)("div",{className:Wu("info-controls"),children:O()})]}),I()]}),(0,d.jsx)("div",{className:Wu("overview-wrapper"),children:P()})]})]})}),(0,d.jsx)(uc,{onCollapse:i,onExpand:l,isCollapsed:c,initialDirection:"left",className:Wu("action-button")})]})}function Yu(e){var t;let{tenantName:a,path:n}=e;const{data:r={},isLoading:o}=(0,g.hz)({path:a}),l=null===r||void 0===r||null===(t=r.PathDescription)||void 0===t?void 0:t.Self,[,c]=(0,s.useQueryParam)("schema",s.StringParam);return!l&&o?(0,d.jsx)("div",{children:(0,d.jsx)(i.a,{})}):(0,d.jsxs)("div",{className:Wu("tree-wrapper"),children:[(0,d.jsx)("div",{className:Wu("tree-header"),children:cn("summary.navigation")}),(0,d.jsx)("div",{className:Wu("tree"),children:l?(0,d.jsx)(Vu,{rootPath:a,rootName:l.Name||a,rootType:l.PathType,currentPath:n,onActivePathUpdate:c}):null})]})}const Xu=(0,c.cn)("tenant-page"),$u=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:Boolean(localStorage.getItem(x.sO))});function em(e){var t;const[l,c]=n.useReducer(cc(x.sO),void 0,$u),[{name:u,schema:m}]=(0,s.useQueryParams)({name:s.StringParam,schema:s.StringParam});if(!u)throw new Error("Tenant name is not defined");const p=n.useRef();n.useEffect((()=>{if(p.current!==u){(async()=>{const{registerYQLCompletionItemProvider:e}=await Promise.all([a.e(1551),a.e(8424),a.e(6531)]).then(a.bind(a,16531));e(u)})().catch(console.error),p.current=u}}),[u]);const b=(0,y.zL)();n.useEffect((()=>{b((0,v.J)("tenant",{tenantName:u}))}),[u,b]);const S=null!==m&&void 0!==m?m:u,{data:j,error:f,isLoading:T}=(0,g.hz)({path:S}),{PathType:N,PathSubType:w}=(null===j||void 0===j||null===(t=j.PathDescription)||void 0===t?void 0:t.Self)||{};let E=!1;f&&"object"===typeof f&&"status"in f&&(E=403===f.status);const C=S||cn("page.title");return(0,d.jsxs)("div",{className:Xu(),children:[(0,d.jsx)(r.ql,{defaultTitle:"".concat(C," \u2014 YDB Monitoring"),titleTemplate:"%s \u2014 ".concat(C," \u2014 YDB Monitoring")}),E?(0,d.jsx)(o.J,{}):(0,d.jsxs)(h,{defaultSizePaneKey:x.z4,defaultSizes:[25,75],triggerCollapse:l.triggerCollapse,triggerExpand:l.triggerExpand,minSize:[36,200],onSplitStartDragAdditional:()=>{c(oc.clear)},children:[(0,d.jsx)(Ku,{type:N,subType:w,tenantName:u,path:S,onCollapseSummary:()=>{c(oc.triggerCollapse)},onExpandSummary:()=>{c(oc.triggerExpand)},isCollapsed:l.collapsed}),(0,d.jsx)("div",{className:Xu("main"),children:T?(0,d.jsx)(i.a,{size:"l"}):(0,d.jsx)(uu,{type:N,additionalTenantProps:e.additionalTenantProps,additionalNodesProps:e.additionalNodesProps,tenantName:u,path:S})})]})]})}},60749:(e,t,a)=>{"use strict";a.d(t,{K:()=>n});const n="s-expression"},62729:(e,t,a)=>{"use strict";a.d(t,{EQ:()=>d,JX:()=>l,Oo:()=>n,Ot:()=>o,S8:()=>u,j:()=>s,t6:()=>i,vy:()=>r,yJ:()=>c});const n="yql",r=["String","Bool","Int32","Uint32","Int64","Uint64","Float","Double","Void","Yson","Utf8","Unit","Json","Date","Datetime","Timestamp","Interval","Null","Int8","Uint8","Int16","Uint16","TzDate","TzDatetime","TzTimestamp","Uuid","EmptyList","EmptyDict","JsonDocument","DyNumber"],s=["CAST","COALESCE","LENGTH","LEN","SUBSTRING","FIND","RFIND","StartsWith","EndsWith","IF","NANVL","Random","RandomNumber","RandomUuid","CurrentUtcDate","CurrentUtcDatetime","CurrentUtcTimestamp","CurrentTzDate","CurrentTzDatetime","CurrentTzTimestamp","AddTimezone","RemoveTimezone","MAX_OF","MIN_OF","GREATEST","LEAST","AsTuple","AsStruct","AsList","AsDict","AsSet","AsListStrict","AsDictStrict","AsSetStrict","Variant","AsVariant","Enum","AsEnum","AsTagged","Untag","TableRow","JoinTableRow","Ensure","EnsureType","EnsureConvertibleTo","ToBytes","FromBytes","ByteAt","TestBit","ClearBit","SetBit","FlipBit","Abs","Just","Unwrap","Nothing","Callable","StaticMap","StaticZip","ListCreate","AsListStrict","ListLength","ListHasItems","ListCollect","ListSort","ListSortAsc","ListSortDesc","ListExtend","ListExtendStrict","ListUnionAll","ListZip","ListZipAll","ListEnumerate","ListReverse","ListSkip","ListTake","ListIndexOf","ListMap","ListFilter","ListFlatMap","ListNotNull","ListFlatten","ListUniq","ListAny","ListAll","ListHas","ListHead","ListLast","ListMin","ListMax","ListSum","ListAvg","ListFold","ListFold1","ListFoldMap","ListFold1Map","ListFromRange","ListReplicate","ListConcat","ListExtract","ListTakeWhile","ListSkipWhile","ListAggregate","ToDict","ToMultiDict","ToSet","DictCreate","SetCreate","DictLength","DictHasItems","DictItems","DictKeys","DictPayloads","DictLookup","DictContains","DictAggregate","SetIsDisjoint","SetIntersection","SetIncludes","SetUnion","SetDifference","SetSymmetricDifference","TryMember","ExpandStruct","AddMember","RemoveMember","ForceRemoveMember","ChooseMembers","RemoveMembers","ForceRemoveMembers","CombineMembers","FlattenMembers","StructMembers","RenameMembers","ForceRenameMembers","GatherMembers","SpreadMembers","ForceSpreadMembers","FormatType","ParseType","TypeOf","InstanceOf","DataType","OptionalType","ListType","StreamType","DictType","TupleType","StructType","VariantType","ResourceType","CallableType","GenericType","UnitType","VoidType","OptionalItemType","ListItemType","StreamItemType","DictKeyType","DictPayloadType","TupleElementType","StructMemberType","CallableResultType","CallableArgumentType","VariantUnderlyingType","JSON_EXISTS","JSON_VALUE","JSON_QUERY"],o=["COUNT","MIN","MAX","SUM","AVG","COUNT_IF","SUM_IF","AVG_IF","SOME","CountDistinctEstimate","HyperLogLog","AGGREGATE_LIST","AGGREGATE_LIST_DISTINCT","AGG_LIST","AGG_LIST_DISTINCT","MAX_BY","MIN_BY","AGGREGATE_BY","MULTI_AGGREGATE_BY","TOP","BOTTOM","TOP_BY","BOTTOM_BY","TOPFREQ","MODE","STDDEV","VARIANCE","CORRELATION","COVARIANCE","PERCENTILE","MEDIAN","HISTOGRAM","LogarithmicHistogram","LogHistogram","LinearHistogram","BOOL_AND","BOOL_OR","BOOL_XOR","BIT_AND","BIT_OR","BIT_XOR","SessionStart"],i=Object.entries({DateTime:["EndOfMonth","Format","FromMicroseconds","FromMilliseconds","FromSeconds","GetDayOfMonth","GetDayOfWeek","GetDayOfWeekName","GetDayOfYear","GetHour","GetMicrosecondOfSecond","GetMillisecondOfSecond","GetMinute","GetMonth","GetMonthName","GetSecond","GetTimezoneId","GetTimezoneName","GetWeekOfYear","GetWeekOfYearIso8601","GetYear","IntervalFromDays","IntervalFromHours","IntervalFromMicroseconds","IntervalFromMilliseconds","IntervalFromMinutes","IntervalFromSeconds","MakeDate","MakeDatetime","MakeTimestamp","MakeTzDate","MakeTzDatetime","MakeTzTimestamp","Parse","ParseHttp","ParseIso8601","ParseRfc822","ParseX509","ShiftMonths","ShiftQuarters","ShiftYears","Split","StartOf","StartOfDay","StartOfMonth","StartOfQuarter","StartOfWeek","StartOfYear","TimeOfDay","ToDays","ToHours","ToMicroseconds","ToMilliseconds","ToMinutes","ToSeconds","Update"],Dsv:["Parse","ReadRecord","Serialize"],String:["AsciiToLower","AsciiToTitle","AsciiToUpper","Base32Decode","Base32Encode","Base32StrictDecode","Base64Decode","Base64Encode","Base64EncodeUrl","Base64StrictDecode","Bin","BinText","CgiEscape","CgiUnescape","Collapse","CollapseText","Contains","DecodeHtml","EncodeHtml","EndsWith","EndsWithIgnoreCase","EscapeC","FromByteList","HasPrefix","HasPrefixIgnoreCase","HasSuffix","HasSuffixIgnoreCase","Hex","HexDecode","HexEncode","HexText","HumanReadableBytes","HumanReadableDuration","HumanReadableQuantity","IsAscii","IsAsciiAlnum","IsAsciiAlpha","IsAsciiDigit","IsAsciiHex","IsAsciiLower","IsAsciiSpace","IsAsciiUpper","JoinFromList","LeftPad","LevensteinDistance","Prec","RemoveAll","RemoveFirst","RemoveLast","ReplaceAll","ReplaceFirst","ReplaceLast","RightPad","SBin","SHex","SplitToList","StartsWith","StartsWithIgnoreCase","Strip","ToByteList","UnescapeC"],Unicode:["Find","Fold","FromCodePointList","GetLength","IsAlnum","IsAlpha","IsAscii","IsDigit","IsHex","IsLower","IsSpace","IsUnicodeSet","IsUpper","IsUtf","JoinFromList","LevensteinDistance","Normalize","NormalizeNFC","NormalizeNFD","NormalizeNFKC","NormalizeNFKD","RFind","RemoveAll","RemoveFirst","RemoveLast","ReplaceAll","ReplaceFirst","ReplaceLast","Reverse","SplitToList","Strip","Substring","ToCodePointList","ToLower","ToTitle","ToUint64","ToUpper","Translit","TryToUint64"],Url:["BuildQueryString","CanBePunycodeHostName","CutQueryStringAndFragment","CutScheme","CutWWW","CutWWW2","Decode","Encode","ForceHostNameToPunycode","ForcePunycodeToHostName","GetCGIParam","GetDomain","GetDomainLevel","GetFragment","GetHost","GetHostPort","GetOwner","GetPath","GetPort","GetScheme","GetSchemeHost","GetSchemeHostPort","GetSignificantDomain","GetTLD","GetTail","HostNameToPunycode","IsAllowedByRobotsTxt","IsKnownTLD","IsWellKnownTLD","Normalize","NormalizeWithDefaultHttpScheme","Parse","PunycodeToHostName","QueryStringToDict","QueryStringToList"],Yson:["Attributes","Contains","ConvertTo","ConvertToBool","ConvertToBoolDict","ConvertToBoolList","ConvertToDict","ConvertToDouble","ConvertToDoubleDict","ConvertToDoubleList","ConvertToInt64","ConvertToInt64Dict","ConvertToInt64List","ConvertToList","ConvertToString","ConvertToStringDict","ConvertToStringList","ConvertToUint64","ConvertToUint64Dict","ConvertToUint64List","Equals","From","GetHash","GetLength","IsBool","IsDict","IsDouble","IsEntity","IsInt64","IsList","IsString","IsUint64","Lookup","LookupBool","LookupDict","LookupDouble","LookupInt64","LookupList","LookupString","LookupUint64","Options","Parse","ParseJson","ParseJsonDecodeUtf8","Serialize","SerializeJson","SerializePretty","SerializeText","WithAttributes","YPath","YPathBool","YPathDict","YPathDouble","YPathInt64","YPathList","YPathString","YPathUint64"],HyperLogLog:["AddValue","Create","Deserialize","GetResult","Merge","Serialize"],Hyperscan:["BacktrackingGrep","BacktrackingMatch","Capture","Grep","Match","MultiGrep","MultiMatch","Replace"],Ip:["ConvertToIPv6","FromString","GetSubnet","GetSubnetByMask","IsEmbeddedIPv4","IsIPv4","IsIPv6","SubnetFromString","SubnetMatch","SubnetToString","ToFixedIPv6String","ToString"],Json:["BoolAsJsonNode","CompilePath","DoubleAsJsonNode","JsonAsJsonNode","JsonDocumentSqlExists","JsonDocumentSqlQuery","JsonDocumentSqlQueryConditionalWrap","JsonDocumentSqlQueryWrap","JsonDocumentSqlTryExists","JsonDocumentSqlValueBool","JsonDocumentSqlValueConvertToUtf8","JsonDocumentSqlValueInt64","JsonDocumentSqlValueNumber","JsonDocumentSqlValueUtf8","Parse","Serialize","SerializeToJsonDocument","SqlExists","SqlQuery","SqlQueryConditionalWrap","SqlQueryWrap","SqlTryExists","SqlValueBool","SqlValueConvertToUtf8","SqlValueInt64","SqlValueNumber","SqlValueUtf8","Utf8AsJsonNode"],Math:["Abs","Acos","Asin","Asinh","Atan","Atan2","Cbrt","Ceil","Cos","Cosh","E","Eps","Erf","ErfInv","ErfcInv","Exp","Exp2","Fabs","Floor","Fmod","FuzzyEquals","Hypot","IsFinite","IsInf","IsNaN","Ldexp","Lgamma","Log","Log10","Log2","Mod","NearbyInt","Pi","Pow","Rem","Remainder","Rint","Round","RoundDownward","RoundToNearest","RoundTowardZero","RoundUpward","Sigmoid","Sin","Sinh","Sqrt","Tan","Tanh","Tgamma","Trunc"],Pire:["Capture","Grep","Match","MultiGrep","MultiMatch","Replace"],Re2:["Capture","Count","Escape","FindAndConsume","Grep","Match","Options","PatternFromLike","Replace"],Re2posix:["Capture","Count","Escape","FindAndConsume","Grep","Match","Options","PatternFromLike","Replace"],Digest:["Argon2","Blake2B","CityHash","CityHash128","Crc32c","Crc64","FarmHashFingerprint","FarmHashFingerprint128","FarmHashFingerprint2","FarmHashFingerprint32","FarmHashFingerprint64","Fnv32","Fnv64","HighwayHash","IntHash64","Md5HalfMix","Md5Hex","Md5Raw","MurMurHash","MurMurHash2A","MurMurHash2A32","MurMurHash32","NumericHash","Sha1","Sha256","SipHash","SuperFastHash","XXH3","XXH3_128"],Histogram:["CalcLowerBound","CalcLowerBoundSafe","CalcUpperBound","CalcUpperBoundSafe","GetSumAboveBound","GetSumBelowBound","GetSumInRange","Normalize","Print","ToCumulativeDistributionFunction"]}).reduce(((e,t)=>{let[a,n]=t;const r=n.map((e=>"".concat(a,"::").concat(e)));return e.concat(r)}),[]),l=["ROW_NUMBER","LAG","LEAD","FIRST_VALUE","LAST_VALUE","RANK","DENSE_RANK","SessionState"],c=[],d=["TablePathPrefix","Warning"],u={table:["AUTO_PARTITIONING_BY_SIZE","AUTO_PARTITIONING_PARTITION_SIZE_MB","AUTO_PARTITIONING_BY_LOAD","AUTO_PARTITIONING_MIN_PARTITIONS_COUNT","AUTO_PARTITIONING_MAX_PARTITIONS_COUNT","UNIFORM_PARTITIONS","READ_REPLICAS_SETTINGS","TTL","KEY_BLOOM_FILTER","STORE"],view:["security_invoker"],topic:["min_active_partitions","partition_count_limit","retention_period","retention_storage_mb","partition_write_speed_bytes_per_second","partition_write_burst_bytes","metering_mode"],object:[],user:[],group:[],externalDataSource:[],externalTable:[],tableStore:[],replication:["ENDPOINT","DATABASE","USER","PASSWORD"],tableIndex:[],topicConsumer:["important","read_from"]}},24960:()=>{},26759:()=>{},56272:()=>{}}]);