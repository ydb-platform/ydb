"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[1745],{41919:(e,t,s)=>{s.d(t,{Q:()=>d});var r=s(39683),n=s(17176),a=s(88776),l=s(24362),o=s(75859);const i=(0,l.cn)("developer-ui-link-button");function d(e){let{href:t,visible:s=!1,className:l}=e;return(0,o.jsx)(n.z,{size:"s",href:t,className:i({visible:s},l),target:"_blank",children:(0,o.jsx)(a.J,{data:r.Z})})}},49201:(e,t,s)=>{s.d(t,{C:()=>i});var r=s(14979),n=s(24362);const a=(0,s(30817).wZ)("ydb-entities-count",{ru:{of:"\u0438\u0437"},en:{of:"of"}});var l=s(75859);const o=(0,n.cn)("ydb-entities-count"),i=e=>{let{total:t,current:s,label:n,loading:i,className:d}=e,u="";return n&&(u+="".concat(n,": ")),i?u+="...":(u+="".concat(s),t&&Number(t)!==Number(s)&&(u+=" ".concat(a("of")," ").concat(t))),(0,l.jsx)(r._,{theme:"info",size:"m",className:o(null,d),children:u})}},62776:(e,t,s)=>{s.d(t,{a:()=>r.a});var r=s(91173)},89778:(e,t,s)=>{s.d(t,{k:()=>m});var r=s(10502),n=s(92398),a=s(48169),l=s(51688),o=s(99683),i=s(41919),d=s(69214),u=s(27506),c=s(75859);const m=e=>{let{node:t,getNodeRef:s,database:m}=e;if(!t.Host)return(0,c.jsx)("span",{children:"\u2014"});const h=!(0,l.TA)(t);let p;s?p=s(t)+"internal":t.NodeId&&(p=(0,a.wq)(t.NodeId)+"internal");const g=h?(0,n.a3)(t.NodeId,{tenantName:null!==m&&void 0!==m?m:t.TenantName}):void 0,v=p?(0,c.jsx)(i.Q,{href:p}):null;return(0,c.jsx)(o.l,{disabled:!h,content:(0,c.jsx)(u.bP,{data:t}),placement:["top","bottom"],behavior:r.x.Immediate,children:(0,c.jsx)(d.A,{name:t.Host,status:t.SystemState,path:g,hasClipboardButton:!0,additionalControls:v})})}},11635:(e,t,s)=>{s.d(t,{WQ:()=>F});var r=s(68963),n=s(5922),a=s(47101);const l=s(905).h.injectEndpoints({endpoints:function(e){return{fetchTableChunk:e.query({queryFn:async(e,t)=>{let{offset:s,limit:r,sortParams:n,filters:a,fetchData:l}=e,{signal:o}=t;try{return{data:await l({limit:r,offset:s,filters:a,sortParams:n,signal:o})}}catch(i){return{error:i}}},providesTags:["All"]})}}});var o=s(17096),i=s(26688),d=s(56711);const u="left",c=-1,m=40;const h=(0,s(24362).cn)("ydb-paginated-table");var p=s(75859);const g=e=>{let{children:t,className:s,height:r,width:n,align:a=u}=e;return(0,p.jsx)("td",{className:h("row-cell",{align:a},s),style:{height:"".concat(r,"px"),width:"".concat(n,"px"),maxWidth:"".concat(n,"px")},children:t})},v=e=>{let{index:t,columns:s,height:r}=e;return(0,p.jsx)("tr",{className:h("row",{loading:!0}),children:s.map((e=>(0,p.jsx)(g,{height:r,width:e.width,align:e.align,className:e.className,children:(0,p.jsx)(d.O,{style:{width:"80%",height:"50%"}})},"".concat(e.name).concat(t))))})},f=e=>{let{row:t,index:s,columns:r,getRowClassName:n,height:a}=e;const l=null===n||void 0===n?void 0:n(t);return(0,p.jsx)("tr",{className:h("row",l),children:r.map((e=>(0,p.jsx)(g,{height:a,width:e.width,align:e.align,className:e.className,children:e.render({row:t,index:s})},"".concat(e.name).concat(s))))})},b=e=>{let{columns:t,children:s}=e;return(0,p.jsx)("tr",{className:h("row",{empty:!0}),children:(0,p.jsx)("td",{colSpan:t.length,className:h("td"),children:s})})},w=e=>{var t;let{id:s,limit:a,rowHeight:d,columns:u,fetchData:c,tableName:m,filters:g,sortParams:w,observer:x,getRowClassName:N,renderErrorMessage:j,onDataFetched:y,isActive:S}=e;const C=r.useRef(null),[E,I]=r.useState(!0),[O]=(0,o.Rj)(),k={offset:s*a,limit:a,fetchData:c,filters:g,sortParams:w,tableName:m};l.useFetchTableChunkQuery(k,{skip:E||!S,pollingInterval:O});const{currentData:A,error:F}=l.endpoints.fetchTableChunk.useQueryState(k);r.useEffect((()=>{let e=0;return S&&E&&(e=window.setTimeout((()=>{I(!1)}),200)),()=>{window.clearTimeout(e)}}),[S,E]),r.useEffect((()=>{const e=C.current;return e&&x.observe(e),()=>{e&&x.unobserve(e)}}),[x]),r.useEffect((()=>{if(A&&S){const{total:e=0,found:t=0}=A;y(e,t)}}),[A,S,y]);const D=(null===A||void 0===A||null===(t=A.data)||void 0===t?void 0:t.length)||a,U=D?D*d:a*d;return(0,p.jsx)("tbody",{className:h("table-chunk"),ref:C,id:s.toString(),style:{height:"".concat(U,"px")},children:(()=>{if(!S)return null;if(!A){if(F){const e=F;return(0,p.jsx)(b,{columns:u,children:j?j(e):(0,p.jsx)(i.V,{error:e})})}return(0,n.c)(D).map((e=>(0,p.jsx)(v,{columns:u,height:d,index:e},e)))}return A.data.map(((e,t)=>(0,p.jsx)(f,{index:t,row:e,columns:u,height:d,getRowClassName:N},t)))})()})};function x(e){let{minWidth:t,maxWidth:s,getCurrentColumnWidth:n,onResize:a}=e;const l=r.useRef(null),[o,i]=r.useState(!1);return r.useEffect((()=>{const e=l.current;if(!e)return;let r,o,d;const u=function(e){let t,s=null;return function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];t=n,"number"!==typeof s&&(s=requestAnimationFrame((()=>{e(...t),s=null})))}}((e=>{if(N(e),"number"!==typeof r||"number"!==typeof o)return;const n=e.clientX-r,l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return Math.max(t,Math.min(e,s))}(o+n,t,s);l!==d&&(d=l,null===a||void 0===a||a(d))})),c=e=>{N(e),void 0!==d&&(null===a||void 0===a||a(d)),i(!1),r=void 0,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)},m=e=>{o=n(),N(e),r=e.clientX,i(!0),document.addEventListener("mousemove",u),document.addEventListener("mouseup",c)};return e.addEventListener("mousedown",m),()=>{e.removeEventListener("mousedown",m),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)}}),[a,t,s,n]),(0,p.jsx)("span",{ref:l,className:h("resize-handler",{resizing:o}),onClick:e=>N(e)})}function N(e){e.preventDefault(),e.stopPropagation()}const j=e=>{let{order:t}=e;return(0,p.jsx)("svg",{className:h("sort-icon",{desc:-1===t}),viewBox:"0 0 10 6",width:"10",height:"6",children:(0,p.jsx)("path",{fill:"currentColor",d:"M0 5h10l-5 -5z"})})},y=e=>{let{sortOrder:t,sortable:s,defaultSortOrder:r}=e;return s?(0,p.jsx)("span",{className:h("sort-icon-container",{shadow:!t}),children:(0,p.jsx)(j,{order:t||r})}):null},S=e=>{var t;let{column:s,resizeable:n,sortOrder:a,defaultSortOrder:l,onSort:o,rowHeight:i,onCellMount:d,onCellUnMount:u,onColumnsResize:c}=e;const m=r.useRef(null);r.useEffect((()=>{const e=m.current;return e&&(null===d||void 0===d||d(e)),()=>{e&&(null===u||void 0===u||u(e))}}),[d,u]);const g=r.useCallback((()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.getBoundingClientRect().width}),[]),v=r.useCallback((e=>{null===c||void 0===c||c(s.name,e)}),[c,s.name]),f=null!==(t=s.header)&&void 0!==t?t:s.name;return(0,p.jsx)("th",{children:(0,p.jsxs)("div",{ref:m,className:h("head-cell-wrapper"),style:{height:"".concat(i,"px"),width:"".concat(s.width,"px")},children:[(0,p.jsxs)("div",{className:h("head-cell",{align:s.align,sortable:s.sortable},s.className),onClick:()=>{s.sortable&&(null===o||void 0===o||o(s.name))},children:[(0,p.jsx)("div",{className:h("head-cell-content"),children:f}),(0,p.jsx)(y,{sortOrder:a,sortable:s.sortable,defaultSortOrder:l})]}),n?(0,p.jsx)(x,{maxWidth:s.resizeMaxWidth,minWidth:s.resizeMinWidth,getCurrentColumnWidth:g,onResize:v}):null]})})},C=e=>{let{columns:t,onSort:s,onColumnsResize:n,defaultSortOrder:a=c,rowHeight:l=m}=e;const[o,i]=r.useState({}),d=e=>{let t={};if(e===o.columnId){if(o.sortOrder&&o.sortOrder!==a)return i(t),void(null===s||void 0===s||s(t));t={sortOrder:1===o.sortOrder?-1:1,columnId:e}}else t={sortOrder:a,columnId:e};null===s||void 0===s||s(t),i(t)};return(0,p.jsxs)(r.Fragment,{children:[(0,p.jsx)("colgroup",{className:h("colgroup"),children:t.map((e=>(0,p.jsx)("col",{style:{width:"".concat(e.width,"px")}},e.name)))}),(0,p.jsx)("thead",{className:h("head"),children:(0,p.jsx)("tr",{className:h("head-row"),children:t.map((e=>{var t;const s=o.columnId===e.name?o.sortOrder:void 0,r=n&&(null===(t=e.resizeable)||void 0===t||t);return(0,p.jsx)(S,{column:e,resizeable:r,sortOrder:s,defaultSortOrder:a,onSort:d,rowHeight:l,onColumnsResize:n},e.name)}))})})]})};var E=s(30817);const I=JSON.parse('{"empty":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"}'),O=(0,E.wZ)("ydb-paginated-table",{ru:I,en:{empty:"No data"}}),k=e=>{let{limit:t,fetchData:s,filters:l,tableName:o,columns:i,getRowClassName:d,rowHeight:u=m,parentContainer:c,initialSortParams:g,onColumnsResize:v,renderControls:f,renderErrorMessage:x,renderEmptyDataMessage:N}=e;const[j,y]=r.useState(g),[S,E]=r.useState(t),[I,k]=r.useState(0),[A,F]=r.useState([]),[D,U]=r.useState(!0),P=r.useRef(null),G=r.useCallback(((e,t)=>{E(e),k(t),U(!1)}),[]),T=(e=>{let{onEntry:t,onLeave:s,parentContainer:n}=e;const a=r.useRef();return r.useEffect((()=>(a.current=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?t(e.target.id):s(e.target.id)}))}),{root:n,rootMargin:"100%"}),()=>{var e;null===(e=a.current)||void 0===e||e.disconnect(),a.current=void 0})),[n,t,s]),a.current})({onEntry:r.useCallback((e=>{F((t=>[...new Set([...t,Number(e)])]))}),[]),onLeave:r.useCallback((e=>{F((t=>t.filter((t=>t!==Number(e)))))}),[]),parentContainer:c});r.useLayoutEffect((()=>{var e;(E(t),k(0),U(!0),c)?c.scrollTo(0,0):null===(e=P.current)||void 0===e||e.scrollTo(0,0);F([0])}),[l,t,c]);const _=()=>{if(!T)return null;if(!D&&0===I)return(0,p.jsx)("tbody",{children:(0,p.jsx)(b,{columns:i,children:N?N():O("empty")})});const e=I||t,r=Math.ceil(e/t);return(0,n.c)(r).map((e=>(0,p.jsx)(w,{id:e,limit:t,rowHeight:u,columns:i,fetchData:s,filters:l,tableName:o,sortParams:j,getRowClassName:d,renderErrorMessage:x,onDataFetched:G,isActive:A.includes(e),observer:T},e)))},R=()=>(0,p.jsxs)("table",{className:h("table"),children:[(0,p.jsx)(C,{columns:i,onSort:y,onColumnsResize:v}),_()]});return(0,p.jsx)("div",{ref:P,className:h(null),children:f?(0,p.jsxs)(a.l,{children:[(0,p.jsx)(a.l.Controls,{children:f({inited:!D,totalEntities:S,foundEntities:I})}),(0,p.jsx)(a.l.Table,{children:R()})]}):R()})};var A=s(89712);function F(e){let{columnsWidthLSKey:t,columns:s,...r}=e;const[n,a]=(0,A.M)(t),l=function(e,t){return e.map((e=>{var s;return{...e,width:null!==(s=t[e.name])&&void 0!==s?s:e.width}}))}(s,n);return(0,p.jsx)(k,{columns:l,onColumnsResize:a,...r})}},30629:(e,t,s)=>{s.d(t,{o:()=>i});var r=s(68963),n=s(77264),a=s(24362),l=s(75859);const o=(0,a.cn)("ydb-search"),i=e=>{let{onChange:t,value:s="",className:a,debounce:i=200,placeholder:d}=e;const[u,c]=r.useState(s),m=r.useRef();r.useEffect((()=>{c((e=>e!==s?s:e))}),[s]);return(0,l.jsx)(n.o,{hasClear:!0,autoFocus:!0,className:o(null,a),placeholder:d,value:u,onUpdate:e=>{c(e),window.clearTimeout(m.current),m.current=window.setTimeout((()=>{null===t||void 0===t||t(e)}),i)}})}},22692:(e,t,s)=>{s.d(t,{h:()=>o});var r=s(56711),n=s(24362),a=s(75859);const l=(0,n.cn)("table-skeleton"),o=e=>{let{rows:t=2,className:s}=e;return(0,a.jsxs)("div",{className:l(null,s),children:[(0,a.jsxs)("div",{className:l("row"),children:[(0,a.jsx)(r.O,{className:l("col-1")}),(0,a.jsx)(r.O,{className:l("col-2")}),(0,a.jsx)(r.O,{className:l("col-3")}),(0,a.jsx)(r.O,{className:l("col-4")}),(0,a.jsx)(r.O,{className:l("col-5")})]}),[...new Array(t)].map(((e,t)=>(0,a.jsx)("div",{className:l("row"),children:(0,a.jsx)(r.O,{className:l("col-full")})},"skeleton-row-".concat(t))))]})}},47101:(e,t,s)=>{s.d(t,{l:()=>o});var r=s(24362),n=s(22692),a=s(75859);const l=(0,r.cn)("ydb-table-with-controls-layout"),o=e=>{let{children:t,className:s}=e;return(0,a.jsx)("div",{className:l(null,s),children:t})};o.Controls=function(e){let{children:t,className:s}=e;return(0,a.jsx)("div",{className:l("controls-wrapper"),children:(0,a.jsx)("div",{className:l("controls",s),children:t})})},o.Table=function(e){let{children:t,loading:s,className:r}=e;return s?(0,a.jsx)(n.h,{className:l("loader")}):(0,a.jsx)("div",{className:l("table",r),children:t})}},43989:(e,t,s)=>{s.d(t,{X:()=>l});var r=s(79734),n=s(51688),a=s(75859);const l=e=>{let{value:t,onChange:s,className:l}=e;return(0,a.jsxs)(r.E,{value:t,onUpdate:s,className:l,children:[(0,a.jsx)(r.E.Option,{value:n.Uu.All,children:n.qU[n.Uu.All]}),(0,a.jsx)(r.E.Option,{value:n.Uu.SmallUptime,children:n.qU[n.Uu.SmallUptime]})]})}},70885:(e,t,s)=>{s.d(t,{V:()=>Ye});var r=s(52317),n=s(17096),a=s(52846),l=s(82073),o=s(8747),i=s(99337),d=s(95829),u=s(95408);const c=u.z.nativeEnum(d.G).catch(d.G.all),m=u.z.nativeEnum(d.d).catch(d.d.groups);var h=s(51688),p=s(68963),g=s(49201),v=s(30629),f=s(43989),b=s(79734),w=s(75859);const x={[d.d.groups]:"Groups",[d.d.nodes]:"Nodes"},N=e=>{let{value:t,onChange:s}=e;return(0,w.jsxs)(b.E,{value:t,onUpdate:s,qa:"storage-type-filter",children:[(0,w.jsx)(b.E.Option,{value:d.d.groups,children:x[d.d.groups]}),(0,w.jsx)(b.E.Option,{value:d.d.nodes,children:x[d.d.nodes]})]})},j={[d.G.all]:"All",[d.G.missing]:"Degraded",[d.G.space]:"Out of Space"},y=e=>{let{value:t,onChange:s}=e;return(0,w.jsxs)(b.E,{value:t,onUpdate:s,qa:"storage-visible-entities-filter",children:[(0,w.jsx)(b.E.Option,{value:d.G.missing,children:j[d.G.missing]}),(0,w.jsx)(b.E.Option,{value:d.G.space,children:j[d.G.space]}),(0,w.jsx)(b.E.Option,{value:d.G.all,children:j[d.G.all]})]})};var S=s(2418),C=s(69214),E=s(24362),I=s(10703),O=s(30817);const k=JSON.parse('{"label":"Usage:","default_value":"Any","groups_count":["{{count}} group","{{count}} groups","{{count}} groups","No groups"]}'),A=JSON.parse('{"label":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435:","default_value":"\u041b\u044e\u0431\u043e\u0435","groups_count":["{{count}} \u0433\u0440\u0443\u043f\u043f\u0430","{{count}} \u0433\u0440\u0443\u043f\u043f\u044b","{{count}} \u0433\u0440\u0443\u043f\u043f","\u041d\u0435\u0442 \u0433\u0440\u0443\u043f\u043f"]}'),F=(0,O.wZ)("ydb-usage-filter",{ru:A,en:k}),D=(0,E.cn)("usage-filter"),U=e=>{const{className:t,value:s=[],groups:r=[],onChange:n,debounce:a=200}=e,[l,o]=p.useState(s),i=p.useRef();p.useEffect((()=>{o((e=>e.join(",")!==s.join(",")?s:e))}),[s]);const d=p.useMemo((()=>r.map((e=>{let{threshold:t,count:s}=e;return{value:String(t),text:"".concat(t,"%"),data:{count:s}}}))),[r]),u=Math.max(...r.map((e=>{let{count:t}=e;return t})));return(0,w.jsx)(S.P,{className:D(null,t),label:F("label"),value:l,placeholder:F("default_value"),options:d,multiple:!0,onUpdate:e=>{o(e),window.clearTimeout(i.current),i.current=window.setTimeout((()=>{null===n||void 0===n||n(e)}),a)},renderOption:e=>{let{value:t,data:s,text:r}=e;return(0,w.jsxs)("div",{className:D("option"),children:[(0,w.jsx)(C.A,{className:D("option-title"),status:(0,I.CZ)(Number(t)),name:r,size:"xs"}),(0,w.jsxs)("div",{className:D("option-meta"),children:[F("groups_count",{count:s.count}),(0,w.jsx)("div",{className:D("option-bar"),style:{width:"".concat(s.count/u*100,"%")}})]})]})},getOptionHeight:()=>50,popupWidth:280,disabled:0===r.length})},P=JSON.parse('{"groups":"Groups","nodes":"Nodes","controls_groups-search-placeholder":"Group ID, Pool name","controls_nodes-search-placeholder":"Node ID, FQDN"}'),G=JSON.parse('{"groups":"\u0413\u0440\u0443\u043f\u043f\u044b","nodes":"\u041d\u043e\u0434\u044b","controls_groups-search-placeholder":"ID \u0433\u0440\u0443\u043f\u043f\u044b, \u0438\u043c\u044f \u043f\u0443\u043b\u0430","controls_nodes-search-placeholder":"ID \u0443\u0437\u043b\u0430, FQDN"}'),T=(0,O.wZ)("ydb-storage",{ru:G,en:P}),_=(0,E.cn)("global-storage"),R=e=>{let{searchValue:t,handleSearchValueChange:s,withTypeSelector:r,storageType:n,handleStorageTypeChange:a,visibleEntities:l,handleVisibleEntitiesChange:o,nodesUptimeFilter:i,handleNodesUptimeFilterChange:u,withGroupsUsageFilter:c,groupsUsageFilter:m,groupsUsageFilterOptions:h,handleGroupsUsageFilterChange:b,entitiesCountCurrent:x,entitiesCountTotal:j,entitiesLoading:S}=e;const C=n===d.d.nodes,E=T(C?"nodes":"groups");return(0,w.jsxs)(p.Fragment,{children:[(0,w.jsx)(v.o,{value:t,onChange:s,placeholder:T(C?"controls_nodes-search-placeholder":"controls_groups-search-placeholder"),className:_("search")}),r&&(0,w.jsx)(N,{value:n,onChange:a}),(0,w.jsx)(y,{value:l,onChange:o}),C&&(0,w.jsx)(f.X,{value:i,onChange:u}),!C&&c&&(0,w.jsx)(U,{value:m,onChange:b,groups:h}),(0,w.jsx)(g.C,{label:E,loading:S,total:j,current:x})]})};var M=s(11635),L=s(17176),V=s(79023),z=s(56350);const K=JSON.parse('{"default_message":"Everything is fine!","default_button_label":"Show All"}'),W=JSON.parse('{"default_message":"\u0412\u0441\u0451 \u0432 \u043f\u043e\u0440\u044f\u0434\u043a\u0435!","default_button_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435"}'),Z=(0,O.wZ)("ydb-storage-empty-filter",{ru:W,en:K}),H=e=>{let{title:t,message:s=Z("default_message"),showAll:r=Z("default_button_label"),onShowAll:n}=e;return(0,w.jsx)(V.u,{image:(0,w.jsx)(z.Q,{name:"thumbsUp"}),position:"left",title:t,description:s,actions:n&&[(0,w.jsx)(L.z,{onClick:n,children:r},"show-all")]})};var Q=s(43817);const J=e=>{let t,{visibleEntities:s,onShowAll:r}=e;return s===d.G.space&&(t=(0,Q.Z)("empty.out_of_space")),s===d.G.missing&&(t=(0,Q.Z)("empty.degraded")),t?(0,w.jsx)(H,{title:t,showAll:(0,Q.Z)("show_all"),onShowAll:r}):null};var Y=s(92092),q=s(11431);const B=(e,t)=>"getStorageGroups|offset".concat(t,"|limit").concat(e),X=async e=>{const{limit:t,offset:s,sortParams:r,filters:n}=e,{sortOrder:a,columnId:l}=null!==r&&void 0!==r?r:{},{searchValue:o,visibleEntities:i,database:d,nodeId:u}=null!==n&&void 0!==n?n:{},c=await window.api.getStorageInfo({version:q.w.v2,limit:t,offset:s,sortOrder:a,sortValue:l,filter:o,visibleEntities:i,database:d,nodeId:u},{concurrentId:B(t,s)}),m=(0,Y.KJ)(c);return{data:m.groups||[],found:m.found||0,total:m.total||0}};var $=s(92076);const ee=e=>{let{searchValue:t,visibleEntities:s,database:r,nodeId:n,nodesMap:a,onShowAll:l,parentContainer:o,renderControls:i,renderErrorMessage:u}=e;const c=p.useMemo((()=>({searchValue:t,visibleEntities:s,database:r,nodeId:n})),[t,s,r,n]),m=p.useMemo((()=>(0,$.k8)(a,s)),[a,s]);return(0,w.jsx)(M.WQ,{columnsWidthLSKey:$.Ty,parentContainer:o,columns:m,fetchData:X,limit:50,renderControls:i,renderErrorMessage:u,renderEmptyDataMessage:()=>s!==d.G.all?(0,w.jsx)(J,{onShowAll:l,visibleEntities:s}):(0,Q.Z)("empty.default"),filters:c,tableName:"storage-groups"})},te=JSON.parse('{"empty.default":"No such nodes","empty.out_of_space":"No nodes with out of space errors","empty.degraded":"No degraded nodes","empty.small_uptime":"No nodes with uptime < 1h","empty.several_filters":"No nodes match current filters combination","show_all":"Show all nodes"}'),se=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432","empty.out_of_space":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043a\u043e\u043d\u0447\u0430\u0435\u0442\u0441\u044f \u043c\u0435\u0441\u0442\u043e","empty.degraded":"\u041d\u0435\u0442 \u0434\u0435\u0433\u0440\u0430\u0434\u0438\u0440\u043e\u0432\u0430\u0432\u0448\u0438\u0445 \u0443\u0437\u043b\u043e\u0432","empty.small_uptime":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432 \u0441 uptime < 1h","empty.several_filters":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432, \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043f\u043e\u0434 \u0442\u0435\u043a\u0443\u0449\u0438\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b","show_all":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435 \u0443\u0437\u043b\u044b"}'),re=(0,O.wZ)("ydb-storage-nodes",{ru:se,en:te}),ne=e=>{let t,{visibleEntities:s,nodesUptimeFilter:r,onShowAll:n}=e;return s===d.G.space&&(t=re("empty.out_of_space")),s===d.G.missing&&(t=re("empty.degraded")),r===h.Uu.SmallUptime&&(t=re("empty.small_uptime")),s!==d.G.all&&r!==h.Uu.All&&(t=re("empty.several_filters")),t?(0,w.jsx)(H,{title:t,showAll:re("show_all"),onShowAll:n}):null},ae=(e,t)=>"getStorageNodes|offset".concat(t,"|limit").concat(e),le=async e=>{const{type:t="static",storage:s=!0,limit:r,offset:n,sortParams:a,filters:l}=e,{searchValue:o,nodesUptimeFilter:i,visibleEntities:d,database:u}=null!==l&&void 0!==l?l:{},{sortOrder:c,columnId:m}=null!==a&&void 0!==a?a:{},p=await window.api.getNodes({type:t,storage:s,limit:r,offset:n,sortOrder:c,sortValue:m,filter:o,uptime:(0,h.RW)(i),visibleEntities:d,database:u},{concurrentId:ae(r,n)}),g=(0,Y.Y2)(p);return{data:g.nodes||[],found:g.found||0,total:g.total||0}};var oe=s(19812),ie=s(89778),de=s(1796),ue=s(74170),ce=s(40073),me=s(79255),he=s(54665),pe=s(17880),ge=s(5922),ve=s(34301),fe=s(92398);const be=(0,E.cn)("pdisk-storage"),we=e=>{let{nodeId:t,data:s={},vDisks:r}=e;const[n,a]=p.useState(!1),l=(0,pe.X_)(),o=p.useRef(null);let i=(0,he.ax)(he.ZP.node,{id:t,activeTab:fe.pV},{pdiskId:s.PDiskId||""});return l&&(0,ge.D)(s.PDiskId)&&(i=(0,he.ds)(s.PDiskId,t)),(0,w.jsxs)(p.Fragment,{children:[(0,w.jsx)(ce.J,{data:s,anchorRef:o,open:n}),(0,w.jsxs)("div",{className:be(),ref:o,children:[null!==r&&void 0!==r&&r.length?(0,w.jsx)("div",{className:be("vdisks"),children:r.map((e=>(0,w.jsx)("div",{className:be("vdisks-item"),style:{flexGrow:Number(e.AllocatedSize)||1},children:(0,w.jsx)(me.c,{data:e,compact:!0,stackClassName:be("donors-stack")})},(0,ve.a2)(e.VDiskId))))}):null,(0,w.jsxs)(ue.h,{to:i,className:be("content"),onMouseEnter:()=>{a(!0)},onMouseLeave:()=>{a(!1)},children:[(0,w.jsx)(de.p,{diskAllocatedPercent:s.AllocatedPercent,severity:s.Severity}),(0,w.jsx)("div",{className:be("media-type"),children:s.Type})]})]})]})},xe=(0,E.cn)("global-storage-nodes"),Ne=e=>xe("node",{unavailable:(0,h.TA)(e)}),je="storageNodesColumnsWidth",ye="NodeId",Se="Host",Ce="DC",Ee="Rack",Ie="Uptime",Oe="PDisks",ke="Missing",Ae=(e,t,s)=>{const n=((e,t)=>{const s=null===e||void 0===e?void 0:e.getNodeRef;return[{name:ye,header:"Node ID",width:100,align:oe.ZP.RIGHT,render:e=>{let{row:t}=e;return t.NodeId}},{name:Se,header:"Host",width:350,render:e=>{let{row:r}=e;return(0,w.jsx)(ie.k,{node:r,getNodeRef:s,database:t})},align:oe.ZP.LEFT},{name:Ce,header:"DC",width:100,render:e=>{let{row:t}=e;return t.DC||r.jX},align:oe.ZP.LEFT},{name:Ee,header:"Rack",width:100,render:e=>{let{row:t}=e;return t.Rack||"\u2014"},align:oe.ZP.LEFT},{name:Ie,header:"Uptime",width:130,sortAccessor:e=>{let{StartTime:t}=e;return t?-t:0},align:oe.ZP.RIGHT,render:e=>{let{row:t}=e;return t.Uptime}},{name:ke,header:"Missing",width:100,align:oe.ZP.CENTER,defaultOrder:oe.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.Missing}},{name:Oe,className:xe("pdisks-column"),header:"PDisks",render:e=>{var t;let{row:s}=e;return(0,w.jsx)("div",{className:xe("pdisks-wrapper"),children:null===(t=s.PDisks)||void 0===t?void 0:t.map((e=>{var t;const r=null===(t=s.VDisks)||void 0===t?void 0:t.filter((t=>t.PDiskId===e.PDiskId));return(0,w.jsx)("div",{className:xe("pdisks-item"),children:(0,w.jsx)(we,{data:e,nodeId:s.NodeId,vDisks:r})},e.PDiskId)}))})},align:oe.ZP.CENTER,sortable:!1,width:900,resizeable:!1}]})(e,s),a=n.map((e=>({...e,sortable:(0,h.oh)(e.name)})));return t!==d.G.missing?a.filter((e=>e.name!==ke)):a},Fe=e=>{let{searchValue:t,visibleEntities:s,nodesUptimeFilter:r,database:n,additionalNodesProps:a,onShowAll:l,parentContainer:o,renderControls:i,renderErrorMessage:u}=e;const c=p.useMemo((()=>({searchValue:t,visibleEntities:s,nodesUptimeFilter:r,database:n})),[t,s,r,n]),m=p.useMemo((()=>Ae(a,s,n)),[a,s,n]);return(0,w.jsx)(M.WQ,{columnsWidthLSKey:je,parentContainer:o,columns:m,fetchData:le,rowHeight:50,limit:50,renderControls:i,renderErrorMessage:u,renderEmptyDataMessage:()=>s!==d.G.all||r!==h.Uu.All?(0,w.jsx)(ne,{onShowAll:l,nodesUptimeFilter:r,visibleEntities:s}):re("empty.default"),getRowClassName:Ne,filters:c,tableName:"storage-nodes"})},De=e=>{var t;let{database:s,nodeId:r,parentContainer:u,additionalNodesProps:p}=e;const[g,v]=(0,a.useQueryParams)({type:a.StringParam,visible:a.StringParam,search:a.StringParam,uptimeFilter:a.StringParam}),f=m.parse(g.type),b=c.parse(g.visible),x=null!==(t=g.search)&&void 0!==t?t:"",N=h.U8.parse(g.uptimeFilter),j=e=>{v({search:e||void 0},"replaceIn")},y=e=>{v({visible:e},"replaceIn")},S=e=>{v({type:e},"replaceIn")},C=e=>{v({uptimeFilter:e},"replaceIn")},E=(0,n.ix)(i.d),I=()=>{v({visible:d.G.all,uptimeFilter:h.Uu.All},"replaceIn")},O=e=>{let{totalEntities:t,foundEntities:s,inited:n}=e;return(0,w.jsx)(R,{searchValue:x,handleSearchValueChange:j,withTypeSelector:!r,storageType:f,handleStorageTypeChange:S,visibleEntities:b,handleVisibleEntitiesChange:y,nodesUptimeFilter:N,handleNodesUptimeFilterChange:C,withGroupsUsageFilter:!1,entitiesCountCurrent:s,entitiesCountTotal:t,entitiesLoading:!n})},k=e=>403===e.status?(0,w.jsx)(l.J,{position:"left"}):(0,w.jsx)(o.V,{error:e});return f===d.d.nodes?(0,w.jsx)(Fe,{searchValue:x,visibleEntities:b,nodesUptimeFilter:N,database:s,additionalNodesProps:p,onShowAll:I,parentContainer:u,renderControls:O,renderErrorMessage:k}):(0,w.jsx)(ee,{searchValue:x,visibleEntities:b,database:s,nodeId:r,nodesMap:E,onShowAll:()=>{y(d.G.all)},parentContainer:u,renderControls:O,renderErrorMessage:k})};var Ue=s(86969),Pe=s(1440),Ge=s(26688),Te=s(47101),_e=s(15106),Re=s(14223);const Me=e=>e.trim().toLowerCase(),Le=(e,t)=>{const s=Me(t);return s?e.filter((e=>{var t,r;return(null===(t=e.NodeId)||void 0===t?void 0:t.toString().includes(s))||(null===(r=e.Host)||void 0===r?void 0:r.toLowerCase().includes(s))})):e},Ve=(e,t)=>{const s=Me(t);return s?e.filter((e=>{var t,r;return(null===(t=e.PoolName)||void 0===t?void 0:t.toLowerCase().includes(s))||(null===(r=e.GroupID)||void 0===r?void 0:r.toString().includes(s))})):e},ze=(e,t)=>Array.isArray(t)&&0!==t.length?e.filter((e=>{const s=e.Usage;return t.some((e=>Number(e)<=s&&s<Number(e)+5))})):e;const Ke=s(905).h.injectEndpoints({endpoints:e=>({getStorageNodesInfo:e.query({queryFn:async(e,t)=>{let{signal:s}=t;try{const t=await window.api.getNodes({storage:!0,type:"static",...e},{signal:s});return{data:(0,Y.Y2)(t)}}catch(r){return{error:r}}},providesTags:["All"]}),getStorageGroupsInfo:e.query({queryFn:async(e,t)=>{let{signal:s}=t;try{const t=await window.api.getStorageInfo({version:q.w.v1,...e},{signal:s});return{data:(0,Y.KJ)(t)}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"});var We=s(2098);s(5384);function Ze(e){let{data:t,tableSettings:s,visibleEntities:r,nodes:n,onShowAll:a,sort:l,handleSort:o}=e;const i=p.useMemo((()=>(0,$.k8)(n,r)),[n,r]);return t.length||r===d.G.all?(0,w.jsx)(We.G,{columnsWidthLSKey:$.Ty,data:t,columns:i,settings:s,emptyDataMessage:(0,Q.Z)("empty.default"),sortOrder:l,onSort:o},r):(0,w.jsx)(J,{onShowAll:a,visibleEntities:r})}function He(e){let{data:t,tableSettings:s,visibleEntities:r,onShowAll:n,nodesUptimeFilter:a,additionalNodesProps:l,sort:o,handleSort:i,database:u}=e;const c=Ae(l,r,u);return t.length||r===d.G.all&&a===h.Uu.All?(0,w.jsx)(We.G,{columnsWidthLSKey:je,data:t,columns:c,settings:{...s,dynamicRenderType:"variable"},emptyDataMessage:re("empty.default"),rowClassName:Ne,sortOrder:o,onSort:i},r):(0,w.jsx)(ne,{visibleEntities:r,nodesUptimeFilter:a,onShowAll:n})}const Qe=(0,a.withDefault)({encode:a.ArrayParam.encode,decode:e=>null===e||void 0===e?e:Array.isArray(e)?e.filter(Boolean):e?[e]:[]},[]),Je=e=>{var t;let{additionalNodesProps:s,database:l,nodeId:o}=e;const[u]=(0,n.Rj)(),[g,v]=(0,a.useQueryParams)({type:a.StringParam,visible:a.StringParam,search:a.StringParam,uptimeFilter:a.StringParam,usageFilter:Qe}),f=m.parse(g.type),b=c.parse(g.visible),x=null!==(t=g.search)&&void 0!==t?t:"",N=h.U8.parse(g.uptimeFilter),j=g.usageFilter,y=(0,n.ix)(i.d),[S,C]=p.useState({sortOrder:void 0,sortValue:void 0}),E=S.sortValue?S:I.TP,[O,k]=p.useState({sortOrder:void 0,sortValue:void 0}),A=O.sortOrder?O:(0,I._r)(b),F=void 0!==o,D=F?d.d.groups:f,U=Ke.useGetStorageNodesInfoQuery({database:l,visibleEntities:b},{skip:D!==d.d.nodes,pollingInterval:u}),P=Ke.useGetStorageGroupsInfoQuery({database:l,visibleEntities:b,nodeId:o},{skip:D!==d.d.groups,pollingInterval:u}),{currentData:G,isFetching:T,error:M}=D===d.d.nodes?U:P,{currentData:{nodes:L=[]}={}}=U,{currentData:{groups:V=[]}={}}=P,{nodes:z,groups:K,...W}=null!==G&&void 0!==G?G:{found:0,total:0},Z=void 0===G&&T,H=p.useMemo((()=>function(e,t,s){let r=e||[];return r=Le(r,t),r=(0,Re.f)(r,s),r}(L,x,N)),[x,L,N]),Q=p.useMemo((()=>function(e,t,s){let r=e||[];return r=Ve(r,t),r=ze(r,s),r}(V,x,j)),[x,V,j]),J=p.useMemo((()=>function(e){const t={};return null===e||void 0===e||e.forEach((e=>{const s=(0,_e.Ic)(e,5);Object.prototype.hasOwnProperty.call(t,s)||(t[s]=0),t[s]+=1})),Object.entries(t).map((e=>{let[t,s]=e;return{threshold:Number(t),count:s}})).sort(((e,t)=>t.threshold-e.threshold))}(V)),[V]),[Y,q]=(0,n.sC)(E,(e=>C(e))),[B,X]=(0,n.sC)(A,(e=>k(e))),$=e=>{v({usageFilter:e.length?e:void 0},"replaceIn")},ee=e=>{v({search:e||void 0},"replaceIn")},te=e=>{v({visible:e},"replaceIn")},se=e=>{v({type:e},"replaceIn")},re=e=>{v({uptimeFilter:e},"replaceIn")},ne=()=>{te(d.G.all),re(h.Uu.All)};return(0,Pe.u)(M)?(0,w.jsx)(Ue.J,{position:"left"}):(0,w.jsxs)(Te.l,{children:[(0,w.jsx)(Te.l.Controls,{children:(0,w.jsx)(R,{searchValue:x,handleSearchValueChange:ee,withTypeSelector:!F,storageType:D,handleStorageTypeChange:se,visibleEntities:b,handleVisibleEntitiesChange:te,nodesUptimeFilter:N,handleNodesUptimeFilterChange:re,groupsUsageFilter:j,groupsUsageFilterOptions:J,handleGroupsUsageFilterChange:$,entitiesCountCurrent:D===d.d.groups?Q.length:H.length,entitiesCountTotal:W.total,entitiesLoading:Z})}),M?(0,w.jsx)(Ge.V,{error:M}):null,(0,w.jsx)(Te.l.Table,{loading:Z,className:_("table"),children:G?(0,w.jsxs)(p.Fragment,{children:[D===d.d.groups&&(0,w.jsx)(Ze,{visibleEntities:b,data:Q,tableSettings:r.LE,nodes:y,onShowAll:()=>te(d.G.all),sort:B,handleSort:X},"groups"),D===d.d.nodes&&(0,w.jsx)(He,{visibleEntities:b,nodesUptimeFilter:N,data:H,tableSettings:r.LE,onShowAll:ne,additionalNodesProps:s,sort:Y,handleSort:q,database:l},"nodes")]}):null})]})},Ye=e=>{let{parentContainer:t,...s}=e;const[a]=(0,n.yu)(r.Qy);return a?(0,w.jsx)(De,{parentContainer:t,...s}):(0,w.jsx)(Je,{...s})}},14223:(e,t,s)=>{s.d(t,{A:()=>m,f:()=>u});var r=s(75850),n=s(52317),a=s(34301),l=s(27070),o=s(51688),i=s(80839);const d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(arguments.length>1?arguments[1]:void 0)===i.pu.ALL?e:e.filter((e=>{let{SystemState:t}=e;return t&&t!==r.K.Green}))},u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(arguments.length>1?arguments[1]:void 0)===o.Uu.All?e:e.filter((e=>{let{StartTime:t}=e;return!t||(0,a.OW)(t)<n.RQ}))},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!t)return e;const s=(0,l.Y)(t);return e.filter((e=>!e.Host||(s.test(e.Host)||s.test(String(e.NodeId)))))};function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{uptimeFilter:t,searchValue:s,problemFilter:r}=arguments.length>1?arguments[1]:void 0,n=u(e,t);return n=d(n,r),n=c(n,s),n}},83496:(e,t,s)=>{s.d(t,{FW:()=>l,KR:()=>o});var r=s(75850),n=s(28164);const a={[n.g.Dead]:r.K.Red,[n.g.Created]:r.K.Yellow,[n.g.ResolveStateStorage]:r.K.Yellow,[n.g.Candidate]:r.K.Yellow,[n.g.BlockBlobStorage]:r.K.Yellow,[n.g.WriteZeroEntry]:r.K.Yellow,[n.g.Restored]:r.K.Yellow,[n.g.Discover]:r.K.Yellow,[n.g.Lock]:r.K.Yellow,[n.g.Stopped]:r.K.Yellow,[n.g.ResolveLeader]:r.K.Yellow,[n.g.RebuildGraph]:r.K.Yellow,[n.g.Deleted]:r.K.Green,[n.g.Active]:r.K.Green},l=(Object.keys(n.g),Object.entries(a).reduce(((e,t)=>{let[s,r]=t;return e[r]?e[r].push(s):e[r]=[s],e}),{}),e=>{if(!e)return r.K.Grey;return t=e,Object.values(r.K).includes(t)?e:a[e];var t});function o(e){if(!e)return"unknown";switch(e){case n.g.Dead:return"danger";case n.g.Active:case n.g.Deleted:return"success";default:return"warning"}}}}]);