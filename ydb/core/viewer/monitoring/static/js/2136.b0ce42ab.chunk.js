"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[2136],{55982:(e,t,a)=>{a.d(t,{U:()=>d});var n=a(34706),r=a(72616),o=a(16318),s=a(47945),i=a(51403),l=a(10161);function d(e){let{children:t,onConfirmAction:a,onConfirmActionSuccess:d,dialogHeader:c,dialogText:u,retryButtonText:p,buttonDisabled:h=!1,buttonView:m="action",buttonClassName:b,withPopover:g=!1,popoverContent:y,popoverPlacement:v="right",popoverDisabled:x=!0}=e;const[w,T]=n.useState(!1),[j,f]=n.useState(!1),[N,C]=n.useState(!1),S=()=>(0,l.jsx)(r.z,{onClick:()=>T(!0),view:m,disabled:h,loading:!h&&j,className:b,children:t});return(0,l.jsxs)(n.Fragment,{children:[(0,l.jsx)(s.g,{visible:w,header:c,text:u,withRetry:N,retryButtonText:p,onConfirm:async e=>{f(!0),await a(e)},onConfirmActionSuccess:async()=>{C(!1);try{await(null===d||void 0===d?void 0:d())}finally{f(!1)}},onConfirmActionError:e=>{C((0,i.q)(e)),f(!1)},onClose:()=>{T(!1)}}),g?(0,l.jsx)(o.J,{content:y,placement:v,disabled:x,children:S()}):S()]})}},47945:(e,t,a)=>{a.d(t,{g:()=>g});var n=a(34706),r=a(3948),o=a(15268),s=a(19912),i=a(68585),l=a(14561),d=a(99294),c=a(37711);const u=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),p=(0,c.wZ)("ydb-critical-action-dialog",{en:u});var h=a(10161);const m=(0,d.cn)("ydb-critical-dialog"),b=e=>403===e.status?p("no-rights-error"):e.statusText?e.statusText:p("default-error");function g(e){let{visible:t,header:a,text:d,withRetry:c,retryButtonText:u,withCheckBox:g,onClose:y,onConfirm:v,onConfirmActionSuccess:x,onConfirmActionError:w}=e;const[T,j]=n.useState(!1),[f,N]=n.useState(),[C,S]=n.useState(!1),I=async e=>(j(!0),v(e).then((()=>{x(),y()})).catch((e=>{w(e),N(e)})).finally((()=>{j(!1)})));return(0,h.jsx)(i.V,{open:t,hasCloseButton:!1,className:m(),size:"s",onClose:y,onTransitionExited:()=>{N(void 0),S(!1)},children:f?(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)(i.V.Header,{caption:a}),(0,h.jsx)(i.V.Body,{className:m("body"),children:(0,h.jsxs)("div",{className:m("body-message",{error:!0}),children:[(0,h.jsx)("span",{className:m("error-icon"),children:(0,h.jsx)(r.Z,{width:"24",height:"22"})}),b(f)]})}),(0,h.jsx)(i.V.Footer,{loading:!1,preset:"default",textButtonApply:c?u||p("button-retry"):void 0,textButtonCancel:p("button-close"),onClickButtonApply:()=>I(!0),onClickButtonCancel:y})]}):(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)(i.V.Header,{caption:a}),(0,h.jsxs)(i.V.Body,{className:m("body"),children:[(0,h.jsxs)("div",{className:m("body-message",{warning:!0}),children:[(0,h.jsx)("span",{className:m("warning-icon"),children:(0,h.jsx)(l.J,{data:o.Z,size:24})}),d]}),g?(0,h.jsx)(s.X,{checked:C,onUpdate:S,children:p("checkbox-text")}):null]}),(0,h.jsx)(i.V.Footer,{loading:T,preset:"default",textButtonApply:p("button-confirm"),textButtonCancel:p("button-cancel"),propsButtonApply:{type:"submit",disabled:g&&!C},onClickButtonCancel:y,onClickButtonApply:()=>I()})]})})}},51403:(e,t,a)=>{a.d(t,{q:()=>n});const n=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},29331:(e,t,a)=>{a.d(t,{Q:()=>s});var n=a(99294),r=a(10161);const o=(0,n.cn)("ydb-diagnostic-card");function s(e){let{children:t,className:a,active:n,size:s="m",interactive:i=!0}=e;return(0,r.jsx)("div",{className:o({active:n,size:s,interactive:i},a),children:t})}},34973:(e,t,a)=>{a.d(t,{C:()=>n.C});var n=a(14325)},66498:(e,t,a)=>{a.d(t,{a:()=>n.a});var n=a(41989)},52154:(e,t,a)=>{a.d(t,{T:()=>s});var n=a(67661),r=a(32341),o=a(10161);const s=e=>{let{value:t,onChange:a,className:s}=e;return(0,o.jsxs)(n.E,{value:t,onUpdate:a,className:s,children:[(0,o.jsx)(n.E.Option,{value:r.pu.ALL,children:r.pu.ALL}),(0,o.jsx)(n.E.Option,{value:r.pu.PROBLEMS,children:r.pu.PROBLEMS})]})}},17784:(e,t,a)=>{a.d(t,{o:()=>n.o});var n=a(76485)},76217:(e,t,a)=>{a.d(t,{P:()=>g});var n=a(83797),r=a(2194),o=a(46878),s=a(65e3),i=a(70340),l=a(55842),d=a(61168),c=a(62508),u=a(90808),p=a(37711);const h=JSON.parse('{"field_links":"Links","context_developer-ui":"Developer UI"}'),m=(0,p.wZ)("ydb-tablet-name-wrapper",{en:h});var b=a(10161);function g(e){let{tabletId:t,database:a}=e;const p=(0,l.ix)(s.VH),h=(0,o.fK)(t,{tenantName:a});return(0,b.jsx)(d.l,{disabled:!p,content:(0,b.jsx)(n.w,{responsive:!0,children:(0,b.jsx)(n.w.Item,{name:m("field_links"),children:(0,b.jsx)(u.j,{title:m("context_developer-ui"),url:(0,i.wz)(t)})})}),placement:["top","bottom"],behavior:r.x.Immediate,children:(0,b.jsx)(c.A,{name:t.toString(),path:h,hasClipboardButton:!0,showStatus:!1})})}},59907:(e,t,a)=>{a.d(t,{f:()=>s});var n=a(2634),r=a(55973),o=a(10161);function s(e){let{state:t}=e;return(0,o.jsx)(n._,{theme:(0,r.KR)(t),children:t})}},26612:(e,t,a)=>{a.d(t,{G:()=>J});var n=a(27810),r=a(55842),o=a(34706),s=a(20560),i=a(53366),l=a(99495),d=a(34973),c=a(71037),u=a(93225),p=a(15327),h=a(91538),m=a(52154),b=a(74116),g=a(17784),y=a(74640),v=a(56065),x=a(27660),w=a(88366),T=a(82114),j=a(32341),f=a(99294),N=a(96183),C=a(97485),S=a(9796);const I="nodesTableSelectedColumns",A=["NodeId","Host","DC","Rack","Version","Uptime","Memory","CPU","LoadAverage","Tablets"],F=["NodeId"];function k(e){const t=o.useMemo((()=>function(e){return[(0,S.A6)(),(0,S.Up)(e),(0,S.iJ)(),(0,S.EF)(),(0,S.KO)(),(0,S.Zi)(),(0,S.VQ)(),(0,S.rh)(),(0,S.eb)(),(0,S.gs)(),(0,S.TX)(e)].map((e=>({...e,sortable:(0,N.oh)(e.name)})))}(e)),[e]);return(0,C.N)(t,I,x.Pr,A,F)}var L=a(37711);const D=JSON.parse('{"empty.default":"No such nodes"}'),P=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432"}'),B=(0,L.wZ)("ydb-nodes",{ru:P,en:D});var q=a(10161);const E=(0,f.cn)("ydb-nodes"),R=e=>{var t;let{path:a,database:f,additionalNodesProps:C={}}=e;const[S,I]=(0,l.useQueryParams)({uptimeFilter:l.StringParam,search:l.StringParam}),A=N.U8.parse(S.uptimeFilter),F=null!==(t=S.search)&&void 0!==t?t:"",L=(0,r.zL)(),D=(0,r.ix)(j.qz),[P]=(0,r.Rj)(),{columnsToShow:R,columnsToSelect:U,setColumns:V}=k({getNodeRef:C.getNodeRef,database:f}),{currentData:O,isLoading:M,error:z}=w.k.useGetNodesQuery({path:a,database:f},{pollingInterval:P}),[Q,_]=o.useState({sortValue:"NodeId",sortOrder:s.zE}),[H,J]=(0,r.sC)(Q,(e=>{_(e)})),G=e=>{I({search:e||void 0},"replaceIn")},Z=e=>{L((0,j.M6)(e))},W=e=>{I({uptimeFilter:e},"replaceIn")},K=o.useMemo((()=>(0,T.A)(null===O||void 0===O?void 0:O.Nodes,{searchValue:F,uptimeFilter:A,problemFilter:D})),[O,F,A,D]),X=(null===O||void 0===O?void 0:O.TotalNodes)||0;return(0,u.u)(z)?(0,q.jsx)(c.J,{}):(0,q.jsxs)(y.l,{children:[(0,q.jsx)(y.l.Controls,{children:(0,q.jsxs)(o.Fragment,{children:[(0,q.jsx)(g.o,{onChange:G,placeholder:"Host name",className:E("search"),value:F}),(0,q.jsx)(m.T,{value:D,onChange:Z}),(0,q.jsx)(v.X,{value:A,onChange:W}),(0,q.jsx)(d.C,{total:X,current:K.length,label:"Nodes",loading:M}),(0,q.jsx)(i.N,{popupWidth:200,items:U,showStatus:!0,onUpdate:V,sortable:!1})]})}),z?(0,q.jsx)(p.V,{error:z}):null,(0,q.jsx)(y.l.Table,{loading:M,children:O?0!==K.length||D===j.pu.ALL&&A===N.Uu.All?(0,q.jsx)(b.G,{columnsWidthLSKey:x.t5,data:K||[],columns:R,settings:n.LE,sortOrder:H,onSort:J,emptyDataMessage:B("empty.default"),rowClassName:e=>E("node",{unavailable:(0,N.TA)(e)})}):(0,q.jsx)(h.Q,{name:"thumbsUp",width:"200"}):null})]})};var U=a(79317),V=a(16124),O=a(89991),M=a(83023);const z=(e,t)=>`getNodes|offset${t}|limit${e}`,Q=async e=>{const{type:t="any",storage:a=!1,tablets:n=!0,limit:r,offset:o,sortParams:s,filters:i,columnsIds:l}=e,{sortOrder:d,columnId:c}=null!==s&&void 0!==s?s:{},{path:u,database:p,searchValue:h,problemFilter:m,uptimeFilter:b}=null!==i&&void 0!==i?i:{},g=(0,N.oh)(c)?(0,O.A)(c,d):void 0,y=(0,M.w)(l,x.WN),v=await window.api.getNodes({type:t,storage:a,tablets:n,limit:r,offset:o,sort:g,path:u,database:p,filter:h,problems_only:(0,N.eV)(m),uptime:(0,N.RW)(b),fieldsRequired:y},{concurrentId:z(r,o),signal:e.signal}),w=(0,V.n)(v);return{data:w.Nodes||[],found:w.FoundNodes||0,total:w.TotalNodes||0}},_=(0,f.cn)("ydb-nodes"),H=e=>{var t;let{path:a,database:n,parentRef:s,additionalNodesProps:u}=e;const[b,y]=(0,l.useQueryParams)({uptimeFilter:l.StringParam,search:l.StringParam}),w=N.U8.parse(b.uptimeFilter),T=null!==(t=b.search)&&void 0!==t?t:"",f=(0,r.zL)(),C=(0,r.ix)(j.qz),S=o.useMemo((()=>({path:a,database:n,searchValue:T,problemFilter:C,uptimeFilter:w})),[a,n,T,C,w]),{columnsToShow:I,columnsToSelect:A,setColumns:F}=k({getNodeRef:null===u||void 0===u?void 0:u.getNodeRef,database:n});return(0,q.jsx)(U.WQ,{columnsWidthLSKey:x.t5,parentRef:s,columns:I,fetchData:Q,limit:50,renderControls:e=>{let{totalEntities:t,foundEntities:a,inited:n}=e;return(0,q.jsxs)(o.Fragment,{children:[(0,q.jsx)(g.o,{onChange:e=>{y({search:e||void 0},"replaceIn")},placeholder:"Host name",className:_("search"),value:T}),(0,q.jsx)(m.T,{value:C,onChange:e=>{f((0,j.M6)(e))}}),(0,q.jsx)(v.X,{value:w,onChange:e=>{y({uptimeFilter:e},"replaceIn")}}),(0,q.jsx)(d.C,{total:t,current:a,label:"Nodes",loading:!n}),(0,q.jsx)(i.N,{popupWidth:200,items:A,showStatus:!0,onUpdate:F,sortable:!1})]})},renderErrorMessage:e=>e&&403===e.status?(0,q.jsx)(c.J,{position:"left"}):(0,q.jsx)(p.V,{error:e}),renderEmptyDataMessage:()=>C!==j.pu.ALL||w!==N.Uu.All?(0,q.jsx)(h.Q,{name:"thumbsUp",width:"200"}):B("empty.default"),getRowClassName:e=>_("node",{unavailable:(0,N.TA)(e)}),filters:S,tableName:"nodes"})},J=e=>{let{parentRef:t,...a}=e;const[o]=(0,r.yu)(n.Qy);return o?(0,q.jsx)(H,{parentRef:t,...a}):(0,q.jsx)(R,{...a})}},72427:(e,t,a)=>{a.d(t,{O:()=>S});var n=a(73878),r=a(23795),o=a(14561),s=a(55982),i=a(62508),l=a(67653),d=a(74116),c=a(22877),u=a(76217),p=a(59907),h=a(65e3),m=a(6215),b=a(9038),g=a(27810),y=a(14075),v=a(55842),x=a(75544),w=a(37711);const T=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill-header":"Restart tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet"}'),j=(0,w.wZ)("ydb-tablets",{en:T});var f=a(10161);function N(e){let{database:t}=e;return[{name:"Type",width:150,get header(){return j("Type")},render:e=>{let{row:t}=e;const a=!1===t.Leader;return(0,f.jsxs)("span",{children:[t.Type," ",a?(0,f.jsx)(r.x,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return j("Tablet")},render:e=>{let{row:a}=e;return a.TabletId?(0,f.jsx)(u.P,{tabletId:a.TabletId,database:t}):g.jX}},{name:"State",get header(){return j("State")},render:e=>{let{row:t}=e;return(0,f.jsx)(p.f,{state:t.State})}},{name:"NodeId",get header(){return j("Node ID")},render:e=>{let{row:t}=e;const a=void 0===t.NodeId?void 0:(0,x.a3)(t.NodeId);return(0,f.jsx)(l.h,{to:a,children:t.NodeId})},align:"right"},{name:"fqdn",get header(){return j("Node FQDN")},render:e=>{let{row:t}=e;return t.fqdn?(0,f.jsx)(i.A,{name:t.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,f.jsx)("span",{children:"\u2014"})}},{name:"Generation",get header(){return j("Generation")},align:"right"},{name:"Uptime",get header(){return j("Uptime")},render:e=>{let{row:t}=e;return(0,y.fG)(t.ChangeTime)},sortAccessor:e=>-Number(e.ChangeTime),align:"right"},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:e=>{let{row:t}=e;return(0,f.jsx)(C,{...t})}}]}function C(e){const t=e.State===b.g.Stopped,a=(0,v.ix)(h.VH),[r]=m._.useKillTabletMutation(),i=e.TabletId;return i?(0,f.jsx)(s.U,{buttonView:"outlined",dialogHeader:j("dialog.kill-header"),dialogText:j("dialog.kill-text"),onConfirmAction:()=>r({id:i}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:j("controls.kill-not-allowed"),popoverDisabled:a,children:(0,f.jsx)(o.J,{data:n.Z})}):null}function S(e){let{database:t,tablets:a,className:n,loading:r}=e;return r?(0,f.jsx)(c.h,{}):(0,f.jsx)(d.G,{wrapperClassName:n,columns:N({database:t}),data:a,settings:g.LE,emptyDataMessage:j("noTabletsData")})}},88366:(e,t,a)=>{a.d(t,{k:()=>o});var n=a(78759),r=a(16124);const o=n.h.injectEndpoints({endpoints:e=>({getNodes:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getNodes({type:"any",storage:!1,tablets:!0,...e},{signal:a});return{data:(0,r.n)(t)}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"})},6215:(e,t,a)=>{a.d(t,{_:()=>r});var n=a(96183);const r=a(78759).h.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async(e,t)=>{let{id:a,database:r}=e,{signal:o}=t;try{const[e,t,s]=await Promise.all([window.api.getTablet({id:a,database:r},{signal:o}),window.api.getTabletHistory({id:a,database:r},{signal:o}),window.api.getNodesList({signal:o})]),i=(0,n.Xs)(s),l=Object.keys(t).reduce(((e,a)=>{var n;const r=null===(n=t[a])||void 0===n?void 0:n.TabletStateInfo;if(r&&r.length){const t=r.find((e=>e.Leader))||r[0],{ChangeTime:n,Generation:o,State:s,Leader:l,FollowerId:d}=t,c=i&&a?i.get(Number(a)):void 0;"Dead"!==s&&e.push({nodeId:a,generation:o,changeTime:n,state:s,leader:l,followerId:d,fqdn:c})}return e}),[]),{TabletStateInfo:d=[]}=e,[c={}]=d,{TabletId:u}=c;return{data:{id:u,data:c,history:l}}}catch(s){return{error:s}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async(e,t)=>{let{tenantId:a}=e,{signal:n}=t;try{const e=await window.api.getTabletDescribe(a,{signal:n}),{SchemeShard:t,PathId:r}=a;return{data:(null===e||void 0===e?void 0:e.Path)||`${t}:${r}`}}catch(r){return{error:r}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async(e,t)=>{let{id:a,hiveId:n}=e,{signal:r}=t;try{return{data:await window.api.getTabletFromHive({id:a,hiveId:n},{signal:r})}}catch(o){return{error:o}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async e=>{let{id:t}=e;try{return{data:await window.api.killTablet(t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.stopTablet(t,a)}}catch(n){return{error:n}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.resumeTablet(t,a)}}catch(n){return{error:n}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})}}]);