"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[22798],{3685:(e,s,i)=>{i.d(s,{$:()=>r});var t=i(54090),n=i(77506),l=i(33775),a=i(60712);const o=(0,n.cn)("ydb-entity-page-title");function r({entityName:e,status:s=t.m.Grey,id:i,className:n}){return(0,a.jsxs)("div",{className:o(null,n),children:[(0,a.jsx)("span",{className:o("prefix"),children:e}),(0,a.jsx)(l.k,{className:o("icon"),status:s,size:"s"}),i]})}},18677:(e,s,i)=>{i.d(s,{A:()=>n});var t=i(59284);const n=e=>t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),t.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14M6.53 5.47a.75.75 0 0 0-1.06 1.06L6.94 8 5.47 9.47a.75.75 0 1 0 1.06 1.06L8 9.06l1.47 1.47a.75.75 0 1 0 1.06-1.06L9.06 8l1.47-1.47a.75.75 0 1 0-1.06-1.06L8 6.94z",clipRule:"evenodd"}))},22983:(e,s,i)=>{i.d(s,{B:()=>d});var t=i(59284),n=i(80136),l=i(58611),a=i(55974),o=i(42829),r=i(60712);function d({children:e,onConfirmAction:s,onConfirmActionSuccess:i,dialogHeader:d,dialogText:c,retryButtonText:u,buttonDisabled:v=!1,buttonView:h="action",buttonClassName:p,withPopover:m=!1,popoverContent:g,popoverPlacement:x="right",popoverDisabled:f=!0}){const[b,y]=t.useState(!1),[N,j]=t.useState(!1),[k,w]=t.useState(!1),I=()=>(0,r.jsx)(n.$,{onClick:()=>y(!0),view:h,disabled:v,loading:!v&&N,className:p,children:e});return(0,r.jsxs)(t.Fragment,{children:[(0,r.jsx)(a.g,{visible:b,header:d,text:c,withRetry:k,retryButtonText:u,onConfirm:async e=>{j(!0),await s(e)},onConfirmActionSuccess:async()=>{w(!1);try{await(null===i||void 0===i?void 0:i())}finally{j(!1)}},onConfirmActionError:e=>{w((0,o.D)(e)),j(!1)},onClose:()=>{y(!1)}}),m?(0,r.jsx)(l.A,{content:g,placement:x,disabled:f,children:(0,r.jsx)("span",{children:I()})}):I()]})}},27160:(e,s,i)=>{i.d(s,{D:()=>n});var t=i(77773);function n(){return(0,t.w)().theme}},42655:(e,s,i)=>{i.d(s,{y:()=>c});var t=i(59284),n=i(1608),l=i(77506),a=i(66781),o=i(60712);const r=(0,l.cn)("ydb-info-viewer-skeleton"),d=()=>(0,o.jsxs)("div",{className:r("label"),children:[(0,o.jsx)(n.E,{className:r("label__text")}),(0,o.jsx)("div",{className:r("label__dots")})]}),c=({rows:e=8,className:s,delay:i=600})=>{const[l]=(0,a.y)(i);let c=(0,o.jsxs)(t.Fragment,{children:[(0,o.jsx)(d,{}),(0,o.jsx)(n.E,{className:r("value")})]});return l||(c=null),(0,o.jsx)("div",{className:r(null,s),children:[...new Array(e)].map(((e,s)=>(0,o.jsx)("div",{className:r("row"),children:c},`skeleton-row-${s}`)))})}},42829:(e,s,i)=>{i.d(s,{D:()=>t});const t=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},48139:(e,s,i)=>{i.d(s,{S:()=>c});var t=i(60712),n=i(59284),l=i(90883),a=i(21246);function o(e){return(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 17 17",width:"16",height:"16",fill:"currentColor",...e,children:(0,t.jsx)("path",{d:"M4 7h9v3H4z"})})}function r(e){return(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 10",width:"16",height:"16",fill:"currentColor",...e,children:(0,t.jsx)("path",{d:"M.49 5.385l1.644-1.644 4.385 4.385L4.874 9.77.49 5.385zm4.384 1.096L10.356 1 12 2.644 6.519 8.126 4.874 6.48v.001z"})})}const d=(0,i(10417).om)("checkbox"),c=n.forwardRef((function(e,s){const{size:i="m",indeterminate:n,disabled:c=!1,content:u,children:v,title:h,style:p,className:m,qa:g}=e,{checked:x,inputProps:f}=(0,l.v)(e),b=u||v,y=(0,t.jsxs)("span",{className:d("indicator"),children:[(0,t.jsx)("span",{className:d("icon"),"aria-hidden":!0,children:n?(0,t.jsx)(o,{className:d("icon-svg",{type:"dash"})}):(0,t.jsx)(r,{className:d("icon-svg",{type:"tick"})})}),(0,t.jsx)("input",{...f,className:d("control")}),(0,t.jsx)("span",{className:d("outline")})]});return(0,t.jsx)(a.m,{ref:s,title:h,style:p,size:i,disabled:c,className:d({size:i,disabled:c,indeterminate:n,checked:x},m),qa:g,control:y,children:b})}))},55974:(e,s,i)=>{i.d(s,{g:()=>f});var t=i(59284),n=i(18677),l=i(71153),a=i(48139),o=i(71989),r=i(47653),d=i(68774),c=i(77506),u=i(81288),v=i(48372);const h=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),p=(0,v.g4)("ydb-critical-action-dialog",{en:h});var m=i(60712);const g=(0,c.cn)("ydb-critical-dialog"),x=e=>{if((0,u.cH)(e)){if(403===e.status)return p("no-rights-error");if("string"===typeof e.data)return e.data;if((0,u._E)(e)&&e.data)return(0,m.jsx)(d.OI,{hideSeverity:!0,data:e.data});if(e.statusText)return e.statusText}return p("default-error")};function f({visible:e,header:s,text:i,withRetry:d,retryButtonText:c,withCheckBox:u,onClose:v,onConfirm:h,onConfirmActionSuccess:f,onConfirmActionError:b}){const[y,N]=t.useState(!1),[j,k]=t.useState(),[w,I]=t.useState(!1),S=async e=>(N(!0),h(e).then((()=>{f(),v()})).catch((e=>{b(e),k(e)})).finally((()=>{N(!1)})));return(0,m.jsx)(o.l,{open:e,hasCloseButton:!1,className:g(),size:"s",onClose:v,onTransitionOutComplete:()=>{k(void 0),I(!1)},children:j?(0,m.jsxs)(t.Fragment,{children:[(0,m.jsx)(o.l.Header,{caption:s}),(0,m.jsx)(o.l.Body,{className:g("body"),children:(0,m.jsxs)("div",{className:g("body-message",{error:!0}),children:[(0,m.jsx)("span",{className:g("error-icon"),children:(0,m.jsx)(n.A,{width:"24",height:"22"})}),x(j)]})}),(0,m.jsx)(o.l.Footer,{loading:!1,preset:"default",textButtonApply:d?c||p("button-retry"):void 0,textButtonCancel:p("button-close"),onClickButtonApply:()=>S(!0),onClickButtonCancel:v})]}):(0,m.jsxs)(t.Fragment,{children:[(0,m.jsx)(o.l.Header,{caption:s}),(0,m.jsxs)(o.l.Body,{className:g("body"),children:[(0,m.jsxs)("div",{className:g("body-message",{warning:!0}),children:[(0,m.jsx)("span",{className:g("warning-icon"),children:(0,m.jsx)(r.I,{data:l.A,size:24})}),i]}),u?(0,m.jsx)(a.S,{checked:w,onUpdate:I,children:p("checkbox-text")}):null]}),(0,m.jsx)(o.l.Footer,{loading:y,preset:"default",textButtonApply:p("button-confirm"),textButtonCancel:p("button-cancel"),propsButtonApply:{type:"submit",disabled:u&&!w},onClickButtonCancel:v,onClickButtonApply:()=>S()})]})})}},58389:(e,s,i)=>{i.d(s,{B:()=>u});var t=i(32752),n=i(77506),l=i(90053),a=i(70043),o=i(60712);const r=(0,n.cn)("ydb-page-meta"),d="\xa0\xa0\xb7\xa0\xa0";function c({items:e,loading:s}){return(0,o.jsx)("div",{className:r("info"),children:s?(0,o.jsx)(a.E,{className:r("skeleton")}):e.filter((e=>Boolean(e))).join(d)})}function u({className:e,...s}){return(0,o.jsxs)(t.s,{gap:1,alignItems:"center",justifyContent:"space-between",className:r(null,e),children:[(0,o.jsx)(c,{...s}),(0,o.jsx)(l.E,{})]})}},67808:(e,s,i)=>{i.d(s,{E:()=>N});i(59284);var t=i(32752),n=i(13847),l=i(92459),a=i(67375),o=i(77506),r=i(56839),d=i(31684),c=i(7187),u=i(12888),v=i(41650),h=i(60073),p=i(44294),m=i(25196),g=i(15132),x=i(33775),f=i(39110),b=i(60712);const y=(0,o.cn)("ydb-vdisk-info");function N({data:e,withVDiskPageLink:s,withTitle:i,className:o,wrap:c}){var N,k;const w=(0,u.X)(),I=(0,l.Z$)(),{AllocatedSize:S,SizeLimit:D,AllocatedPercent:C,DiskSpace:_,FrontQueues:A,Guid:T,Replicated:R,ReplicationProgress:B,ReplicationSecondsRemaining:P,Donors:E,VDiskState:z,VDiskSlotId:V,Kind:$,SatisfactionRank:F,HasUnreadableBlobs:O,IncarnationGuid:G,InstanceGuid:L,StoragePoolName:H,ReadThroughput:M,WriteThroughput:q,PDiskId:W,StringifiedId:J,NodeId:K}=e||{},Q=[];var Y,X;((0,n.isNil)(H)||Q.push({label:(0,f.r)("pool-name"),value:H}),(0,n.isNil)(z)||Q.push({label:(0,f.r)("state-status"),value:z}),Number(S)>=0&&Number(D)>=0&&Q.push({label:(0,f.r)("size"),value:(0,b.jsx)(g.O,{value:S,capacity:D,formatValues:r.vX,colorizeProgress:!0})}),isNaN(Number(C))||Q.push({label:(0,f.r)("usage"),value:`${C}%`}),(0,n.isNil)(_)||Q.push({label:(0,f.r)("space-status"),value:(0,b.jsx)(x.k,{status:_})}),(0,n.isNil)(A)||Q.push({label:(0,f.r)("front-queues"),value:(0,b.jsx)(x.k,{status:A})}),(0,n.isNil)(null===F||void 0===F||null===(N=F.FreshRank)||void 0===N?void 0:N.Flag))||Q.push({label:(0,f.r)("fresh-rank-satisfaction"),value:(0,b.jsx)(x.k,{status:null===F||void 0===F||null===(Y=F.FreshRank)||void 0===Y?void 0:Y.Flag})});(0,n.isNil)(null===F||void 0===F||null===(k=F.LevelRank)||void 0===k?void 0:k.Flag)||Q.push({label:(0,f.r)("level-rank-satisfaction"),value:(0,b.jsx)(x.k,{status:null===F||void 0===F||null===(X=F.LevelRank)||void 0===X?void 0:X.Flag})});(0,n.isNil)(M)||Q.push({label:(0,f.r)("read-throughput"),value:(0,v.O4)(M)}),(0,n.isNil)(q)||Q.push({label:(0,f.r)("write-throughput"),value:(0,v.O4)(q)});const Z=[];if((0,n.isNil)(R)||Z.push({label:(0,f.r)("replication-status"),value:R?(0,f.r)("yes"):(0,f.r)("no")}),!1===R&&z===a.W.OK&&((0,n.isNil)(B)||Z.push({label:(0,f.r)("replication-progress"),value:(0,b.jsx)(g.O,{value:Math.round(100*B),percents:!0,colorizeProgress:!0,capacity:100})}),!(0,n.isNil)(P))){const e=(0,r.YS)(P);e&&Z.push({label:(0,f.r)("replication-time-remaining"),value:e})}if((0,n.isNil)(V)||Z.push({label:(0,f.r)("slot-id"),value:V}),!(0,n.isNil)(W)){const e=(0,n.isNil)(K)?void 0:(0,l.Ck)(W,K),s=e?(0,b.jsx)(p.E,{to:e,children:W}):W;Z.push({label:(0,f.r)("label_pdisk-id"),value:s})}if((0,n.isNil)($)||Z.push({label:(0,f.r)("kind"),value:$}),(0,n.isNil)(T)||Z.push({label:(0,f.r)("guid"),value:T}),(0,n.isNil)(G)||Z.push({label:(0,f.r)("incarnation-guid"),value:G}),(0,n.isNil)(L)||Z.push({label:(0,f.r)("instance-guid"),value:L}),(0,n.isNil)(O)||Z.push({label:(0,f.r)("has-unreadable-blobs"),value:O?(0,f.r)("yes"):(0,f.r)("no")}),!1===R&&z===a.W.OK&&null!==E&&void 0!==E&&E.length){const e=E.map(((e,s)=>{const{StringifiedId:i,NodeId:t}=e;if(!i||!t)return null;const n=I({nodeId:t,vDiskId:i});return(0,b.jsx)(p.E,{to:n,children:i},s)})).filter(Boolean);e.length&&Z.push({label:(0,f.r)("donors"),value:(0,b.jsx)(t.s,{direction:"column",gap:1,children:e})})}const U=[],ee=I({nodeId:K,vDiskId:J});if(s&&ee&&U.push((0,b.jsx)(m.K,{title:(0,f.r)("vdisk-page"),url:ee,external:!1},ee)),w&&!(0,n.isNil)(K)&&!(0,n.isNil)(V)&&!(0,n.isNil)(W)){const e=(0,d.Wg)({nodeId:K,pDiskId:W,vDiskSlotId:V});U.push((0,b.jsx)(m.K,{title:(0,f.r)("developer-ui"),url:e},e))}U.length&&Z.push({label:(0,f.r)("links"),value:(0,b.jsx)(t.s,{wrap:"wrap",gap:2,children:U})});const se=e&&i?(0,b.jsx)(j,{data:e}):null;return(0,b.jsxs)(t.s,{className:o,gap:2,direction:c?"row":"column",wrap:c,children:[(0,b.jsx)(h.z_,{title:se,info:Q,renderEmptyState:()=>null,className:y("info")}),(0,b.jsx)(h.z_,{info:Z,renderEmptyState:()=>null,className:y("info")})]})}function j({data:e}){return(0,b.jsxs)("div",{className:y("title"),children:[(0,f.r)("vdiks-title"),(0,b.jsx)(x.k,{status:(0,c.XY)(e.Severity)}),e.StringifiedId]})}},68774:(e,s,i)=>{i.d(s,{tm:()=>B,OI:()=>A,vt:()=>T});var t=i(59284),n=i(45720),l=i(16929),a=i(71153),o=i(18677),r=i(32752),d=i(80136),c=i(60461),u=i(78540),v=i(47653),h=i(74529),p=i(77506),m=i(41650),g=i(71989),x=i(60712);function f({open:e,issues:s,hideSeverity:i,onClose:t,textButtonCancel:n="Close",size:l="m",caption:a}){return(0,x.jsxs)(g.l,{size:l,onClose:t,disableOutsideClick:!0,open:e,children:[(0,x.jsx)(g.l.Header,{caption:a}),(0,x.jsx)(g.l.Body,{children:(0,x.jsx)(B,{issues:s,hideSeverity:i})}),(0,x.jsx)(g.l.Footer,{textButtonCancel:n,onClickButtonCancel:t})]})}function b(e){return Array.isArray(e)&&e.length>0}function y(e){var s;return"string"===typeof e?[]:null!==e&&void 0!==e&&null!==(s=e.error)&&void 0!==s&&s.message?[{message:e.error.message,severity:e.error.severity,position:e.error.position,end_position:e.error.end_position,issue_code:e.error.issue_code,issues:Array.isArray(e.issues)?e.issues:[]}]:Array.isArray(e.issues)?e.issues:[]}var N=i(48372);const j=JSON.parse('{"action_show-details":"Show details","action_hide-details":"Hide details","action_close":"Close","action_show-full-message":"Show full message","field_code":"Code","field_position":"Position"}'),k=(0,N.g4)("issues",{en:j}),w=["S_FATAL","S_ERROR","S_WARNING","S_INFO"];function I(e){return function(e){return!!e&&void 0!==w[e]}(e)?w[e]:"S_INFO"}const S=(0,p.cn)("kv-result-issues"),D=(0,p.cn)("kv-issues"),C=(0,p.cn)("kv-issue");function _({message:e}){return(0,x.jsx)("div",{className:S("error-message"),children:e})}function A({data:e,hideSeverity:s}){const i=y(e),[n,l]=t.useState({});return"string"===typeof e?(0,x.jsx)(_,{message:e}):(0,x.jsx)("div",{className:S(),children:(0,x.jsx)(r.s,{direction:"column",gap:"2",children:i.map(((e,i)=>{const a=b(e.issues);return(0,x.jsxs)(t.Fragment,{children:[(0,x.jsx)(R,{severity:I(e.severity),message:e.message||"",hideSeverity:s,hasIssues:a,expanded:n[i],onClick:()=>(e=>l((s=>({...s,[e]:!s[e]}))))(i)}),n[i]&&a&&(0,x.jsx)(B,{hideSeverity:s,issues:e.issues})]},i)}))})})}function T({data:e,hideSeverity:s}){const i=y(e),[n,l]=t.useState(!1),[a,o]=t.useState(null);return"string"===typeof e?(0,x.jsx)(_,{message:e}):(0,x.jsxs)(t.Fragment,{children:[(0,x.jsx)("div",{className:S(),children:(0,x.jsx)(r.s,{direction:"column",gap:"2",children:i.map(((e,i)=>{const t=b(e.issues);return(0,x.jsx)(R,{severity:I(e.severity),message:e.message||"",hideSeverity:s,hasIssues:t,onClick:()=>{return s=e.issues,o(null!==s&&void 0!==s?s:[]),void l(!0);var s}},i)}))})}),(0,x.jsx)(f,{open:n,issues:null!==a&&void 0!==a?a:[],hideSeverity:s,onClose:()=>l(!1),textButtonCancel:k("action_close")})]})}function R({severity:e,message:s,hideSeverity:i,hasIssues:t,expanded:n,onClick:l}){const a=k(n?"action_hide-details":"action_show-details");return(0,x.jsxs)("div",{className:S("error-message"),children:[i?null:(0,x.jsx)(F,{severity:e}),(0,x.jsx)("span",{className:S("error-message-text"),children:s}),t&&(0,x.jsx)(d.$,{view:"normal",size:"s",onClick:l,children:a})]})}function B({issues:e,hideSeverity:s}){const i=function(e){return null===e||void 0===e?void 0:e.reduce(((e,s)=>{var i;const t=null!==(i=s.severity)&&void 0!==i?i:10;return Math.min(e,t)}),10)}(e);return(0,x.jsx)("div",{className:D(null),children:null===e||void 0===e?void 0:e.map(((e,t)=>(0,x.jsx)(P,{hideSeverity:s,issue:e,expanded:e.severity===i},t)))})}function P({issue:e,hideSeverity:s,level:i=0}){const[n,l]=t.useState(!0),a=I(e.severity),o=e.issues,r=b(o),u=n?"bottom":"right";return(0,x.jsxs)("div",{className:C({leaf:!r,"has-issues":r}),children:[(0,x.jsxs)("div",{className:C("line"),children:[r&&(0,x.jsx)(d.$,{view:"flat-secondary",onClick:()=>l(!n),className:C("arrow-toggle"),children:(0,x.jsx)(c.I,{direction:u,size:16})}),s?null:(0,x.jsx)(F,{severity:a}),(0,x.jsx)(E,{issue:e}),e.issue_code?(0,x.jsxs)("span",{className:C("code"),children:[k("field_code"),": ",e.issue_code]}):null]}),r&&n&&(0,x.jsx)("div",{className:C("issues"),children:(0,x.jsx)(z,{issues:o,level:i+1,expanded:n})})]})}function E({issue:e}){var s;const i=function(e){const{position:s}=e;if("object"!==typeof s||null===s||!(0,m.kf)(s.row))return"";const{row:i,column:t}=s;return(0,m.kf)(t)?`${i}:${t}`:`line ${i}`}(e),t=window.ydbEditor,n=()=>(0,x.jsxs)("span",{className:C("message"),children:[i&&(0,x.jsx)("span",{className:C("place-text"),title:k("field_position"),children:i}),(0,x.jsx)("div",{className:C("message-text"),children:(0,x.jsx)(h.A,{value:e.message,expandLabel:k("action_show-full-message")})})]}),{row:l,column:a}=null!==(s=e.position)&&void 0!==s?s:{};if(!((0,m.kf)(l)&&t))return n();return(0,x.jsx)(u.N,{href:"#",onClick:()=>{const e={lineNumber:l,column:null!==a&&void 0!==a?a:0};t.setPosition(e),t.revealPositionInCenterIfOutsideViewport(e),t.focus()},view:"primary",draggable:!1,children:n()})}function z(e){const{issues:s,level:i,expanded:t}=e;return(0,x.jsx)("div",{className:C("list"),children:s.map(((e,s)=>(0,x.jsx)(P,{issue:e,level:i,expanded:t},s)))})}const V={S_INFO:n.A,S_WARNING:l.A,S_ERROR:a.A,S_FATAL:o.A},$=(0,p.cn)("yql-issue-severity");function F({severity:e}){const s=e.slice(2).toLowerCase();return(0,x.jsxs)("span",{className:$({severity:s}),children:[(0,x.jsx)(v.I,{className:$("icon"),data:V[e]}),(0,x.jsx)("span",{className:$("title"),children:s})]})}},70043:(e,s,i)=>{i.d(s,{E:()=>a});var t=i(1608),n=i(66781),l=i(60712);const a=({delay:e=600,className:s})=>{const[i]=(0,n.y)(e);return i?(0,l.jsx)(t.E,{className:s}):null}},74529:(e,s,i)=>{i.d(s,{A:()=>v});var t=i(59284),n=i(78540),l=i(77506),a=i(48372);const o=JSON.parse('{"default_collapse_label":"Show less","default_expand_label":"Show more","chars_count":[" ({{count}} symbol)"," ({{count}} symbols)"," ({{count}} symbols)"," ({{count}} symbols)"]}'),r=JSON.parse('{"default_collapse_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435","default_expand_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0435\u0449\u0451","chars_count":[" ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u0430)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"]}'),d=(0,a.g4)("ydb-shorty-string",{ru:r,en:o});var c=i(60712);const u=(0,l.cn)("kv-shorty-string");function v({value:e="",limit:s=200,strict:i=!1,displayLength:l=!0,render:a=e=>e,onToggle:o,expandLabel:r=d("default_expand_label"),collapseLabel:v=d("default_collapse_label")}){const[h,p]=t.useState(!1),m=(h?v:r)+(l&&!h?d("chars_count",{count:e.length}):""),g=e.length>s+(i?0:m.length),x=h||!g?e:e.slice(0,s-4)+"\xa0...";return(0,c.jsxs)("div",{className:u(),children:[a(x),g?(0,c.jsx)(n.N,{className:u("toggle"),href:"#",onClick:e=>{e.stopPropagation(),e.preventDefault(),p((e=>!e)),null===o||void 0===o||o()},children:m}):null]})}},79879:(e,s,i)=>{i.d(s,{A:()=>n});var t=i(59284);const n=e=>t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),t.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"m3.003 4.702 4.22-2.025a1.8 1.8 0 0 1 1.554 0l4.22 2.025a.89.89 0 0 1 .503.8V6a8.55 8.55 0 0 1-3.941 7.201l-.986.631a1.06 1.06 0 0 1-1.146 0l-.986-.63A8.55 8.55 0 0 1 2.5 6v-.498c0-.341.196-.652.503-.8m3.57-3.377L2.354 3.35A2.39 2.39 0 0 0 1 5.502V6a10.05 10.05 0 0 0 4.632 8.465l.986.63a2.56 2.56 0 0 0 2.764 0l.986-.63A10.05 10.05 0 0 0 15 6v-.498c0-.918-.526-1.755-1.354-2.152l-4.22-2.025a3.3 3.3 0 0 0-2.852 0M9.5 7a1.5 1.5 0 0 1-.75 1.3v1.95a.75.75 0 0 1-1.5 0V8.3A1.5 1.5 0 1 1 9.5 7",clipRule:"evenodd"}))},83796:(e,s,i)=>{i.r(s),i.d(s,{VDiskPage:()=>ne});var t=i(59284);const n=e=>t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),t.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.28 4.78a.75.75 0 0 0 0-1.06l-2.5-2.5a.75.75 0 1 0-1.06 1.06L6.94 3.5H1.75a.75.75 0 1 0 0 1.5h5.19L5.72 6.22a.75.75 0 1 0 1.06 1.06zm-.06 3.94-2.5 2.5a.75.75 0 0 0 0 1.06l2.5 2.5a.75.75 0 1 0 1.06-1.06L9.06 12.5h5.19a.75.75 0 0 0 0-1.5H9.06l1.22-1.22a.75.75 0 1 0-1.06-1.06M14 4.25a1.75 1.75 0 1 1-3.5 0 1.75 1.75 0 0 1 3.5 0M3.75 13.5a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5",clipRule:"evenodd"}));var l=i(47653),a=i(96727),o=i(29859),r=i(66212),d=i(4980),c=i(13847),u=i(61750),v=i(80987),h=i(370),p=i(22983),m=i(3685),g=i(44508),x=i(42655),f=i(69832),b=i(58389),y=i(67808),N=i(92459),j=i(21334),k=i(67028),w=i(40174),I=i(7187),S=i(78034),D=i(49696);const C=j.F.injectEndpoints({endpoints:e=>({getVDiskData:e.query({queryFn:async(e,{signal:s})=>{try{const{nodeId:i,database:t,vDiskId:n}=e,l=n.split("-",1)[0],a=[window.api.storage.getStorageGroups({groupId:l,database:t,nodeId:i,fieldsRequired:"all"},{signal:s}),i?window.api.viewer.getNodeInfo({nodeId:i,database:t},{signal:s}):void 0],o=function([e,s],i){var t,n,l,a,o,r,d;const c=null===e||void 0===e||null===(t=e.StorageGroups)||void 0===t||null===(n=t[0].VDisks)||void 0===n?void 0:n.find((({VDiskId:e})=>e===i)),u=(0,D.b)(c),v=u.PDisk,h=null===s||void 0===s||null===(l=s.SystemStateInfo)||void 0===l?void 0:l[0],p=(0,S.q1)(h),m=null!==(a=null!==(o=u.NodeId)&&void 0!==o?o:null===v||void 0===v?void 0:v.NodeId)&&void 0!==a?a:p.NodeId,g=p.Host,x=null===(r=p.Roles)||void 0===r?void 0:r[0],f=p.DC,b=null!==(d=u.PDiskId)&&void 0!==d?d:null===v||void 0===v?void 0:v.PDiskId,y=null===v||void 0===v?void 0:v.Type;return{...u,NodeId:m,NodeHost:g,NodeType:x,NodeDC:f,PDiskId:b,PDiskType:y}}(await Promise.all(a),n);return{data:o}}catch(i){return{error:i}}},providesTags:(e,s,i)=>["All",{type:"VDiskData",id:i.vDiskId}]}),getVDiskBlobIndexStat:e.query({queryFn:async(e,{signal:s})=>{try{return{data:await window.api.viewer.getVDiskBlobIndexStat(e,{signal:s})}}catch(i){return{error:i}}},providesTags:(e,s,i)=>["All",{type:"VDiskBlobIndexStat",id:(0,I.nC)(i)}]})}),overrideExisting:"throw"});var _=i(77506),A=i(47779),T=i(12888),R=i(81188),B=i(1349),P=i(4557),E=i(57166),z=i(35400),V=i(69326),$=i(76086),F=i(41650),O=i(48372);const G=JSON.parse('{"fqdn":"FQDN","node":"Node","pdisk":"PDisk","vdisk":"VDisk","storage":"Storage","tablets":"Tablets","tablet-id":"Tablet ID","channel-id":"Channel ID","count":"Count","size":"Size","evict-vdisk-button":"Evict VDisk","force-evict-vdisk-button":"Evict anyway","evict-vdisk-dialog-header":"Evict VDisk","evict-vdisk-dialog-text":"VDisk will be evicted. Do you want to proceed?","evict-vdisk-not-allowed":"You don\'t have enough rights to evict VDisk"}'),L=(0,O.g4)("ydb-vDisk-page",{en:G});var H=i(56839);const M="TabletId",q="ChannelId",W="Count",J="Size",K={[M]:L("tablet-id"),[q]:L("channel-id"),[W]:L("count"),[J]:L("size")};var Q=i(60712);function Y({id:e}){const s=(0,N.Cs)();return(0,Q.jsx)(f.E,{to:s(e),children:e})}const X="vdiskTabletsColumnsWidth",Z=[{name:M,header:K[M],render:({row:e})=>{const s=e.TabletId;return s?(0,Q.jsx)(Y,{id:s}):$.Pd},width:220},{name:q,header:K[q],align:P.Ay.RIGHT,render:({row:e})=>{var s;return null!==(s=e.ChannelId)&&void 0!==s?s:$.Pd},width:130,sortable:!0},{name:W,header:K[W],align:P.Ay.RIGHT,render:({row:e})=>(0,c.isNil)(e.Count)?$.Pd:(0,H.ZV)(e.Count),width:100},{name:J,header:K[J],align:P.Ay.RIGHT,render:({row:e})=>{const s=e.Size;if((0,c.isNil)(s))return $.Pd;const i=(0,F.y3)(s);return(0,H.z3)(i)},width:120}];function U({nodeId:e,pDiskId:s,vDiskSlotId:i,vDiskId:n,className:l,scrollContainerRef:a}){const[o]=(0,A.Nt)(),r=(0,k.lx)(),u=t.useMemo((()=>r&&!(0,c.isNil)(n)?{vDiskId:n}:(0,c.isNil)(e)||(0,c.isNil)(i)||(0,c.isNil)(s)?d.hT:{nodeId:e,pDiskId:s,vDiskSlotId:i}),[e,s,i,n,r]),{currentData:v,isFetching:h,error:p}=C.useGetVDiskBlobIndexStatQuery(u,{pollingInterval:o}),m=h&&void 0===v,g=t.useMemo((()=>{if(!v)return[];const e=v.stat;if(!e||!Array.isArray(e.tablets))return[];const s=[];return e.tablets.forEach((e=>{const i=e.tablet_id;i&&Array.isArray(e.channels)&&e.channels.forEach(((e,t)=>{e.count&&e.data_size&&s.push({TabletId:i,ChannelId:t,Count:(0,F.y3)(e.count),Size:(0,F.y3)(e.data_size)})}))})),s}),[v]);return p?(0,Q.jsx)(E.A,{error:p,position:"left",size:"s"}):(0,Q.jsx)("div",{className:l,children:(0,Q.jsx)(V.L.Table,{scrollContainerRef:a,loading:m,children:(0,Q.jsx)(z.l,{columnsWidthLSKey:X,data:g,columns:Z,settings:$.N3,initialSortOrder:{columnId:L("size"),order:P.Ay.DESCENDING}})})})}const ee=(0,_.cn)("ydb-vdisk-page"),se={storage:"storage",tablets:"tablets"},ie=[{id:se.storage,get title(){return L("storage")}},{id:se.tablets,get title(){return L("tablets")}}],te=h.z.nativeEnum(se).catch(se.storage);function ne(){var e;const s=(0,A.YQ)(),i=(0,N.Z$)(),h=t.useRef(null),S=(0,T.X)(),D=(0,k.c2)(),[{nodeId:_,vDiskId:P,activeTab:E,database:z}]=(0,v.useQueryParams)({nodeId:v.StringParam,vDiskId:v.StringParam,activeTab:v.StringParam,database:v.StringParam}),V=null!==z&&void 0!==z?z:void 0,$=te.parse(E),[F]=(0,A.Nt)(),O=t.useMemo((()=>(0,c.isNil)(P)?d.hT:{vDiskId:P,nodeId:null===_||void 0===_?void 0:_.toString(),database:V}),[_,P,V]),{currentData:G,isFetching:H,error:M}=C.useGetVDiskDataQuery(O,{pollingInterval:F}),q=null===G||void 0===G?void 0:G.VDiskSlotId;t.useEffect((()=>{var e;s((0,w.g)("vDisk",{groupId:null===G||void 0===G||null===(e=G.VDiskId)||void 0===e?void 0:e.GroupID,database:V,vDiskId:null===G||void 0===G?void 0:G.StringifiedId}))}),[s,V,null===G||void 0===G||null===(e=G.VDiskId)||void 0===e?void 0:e.GroupID,null===G||void 0===G?void 0:G.StringifiedId]);const W=H&&void 0===G,{NodeHost:J,NodeId:K,NodeType:Y,NodeDC:X,PDiskId:Z,PDiskType:se,Severity:ne,VDiskId:le,StringifiedId:ae}=G||{},{GroupID:oe,GroupGeneration:re,Ring:de,Domain:ce,VDisk:ue}=le||!W&&function(e){const s=/^(\d+)-(\d+)-(\d+)-(\d+)-(\d+)$/.exec(null!==e&&void 0!==e?e:"");if(!s)return;const[,i,t,n,l,a]=s;return{GroupID:Number(i),GroupGeneration:Number(t),Ring:Number(n),Domain:Number(l),VDisk:Number(a)}}(P)||{},ve=!(0,c.isNil)(oe)&&!(0,c.isNil)(re)&&!(0,c.isNil)(de)&&!(0,c.isNil)(ce)&&!(0,c.isNil)(ue),he=async e=>{if(ve){var s;const i={groupId:oe,groupGeneration:re,failRealmIdx:de,failDomainIdx:ce,vDiskIdx:ue,force:e};let t;if(t=D?await window.api.vdisk.evictVDisk(i):await window.api.tablets.evictVDiskOld(i),!1===(null===(s=t)||void 0===s?void 0:s.result)){throw{statusText:t.error,retryPossible:t.forceRetryPossible}}}},pe=(null===G||void 0===G?void 0:G.StringifiedId)||(W?void 0:P),me=()=>{s(j.F.util.invalidateTags([{type:"VDiskData",id:null===pe||void 0===pe?void 0:pe.toString()},"StorageData"]))},{appTitle:ge}=(0,R.J)(),xe=()=>{switch($){case"storage":return fe();case"tablets":return(0,Q.jsx)(U,{scrollContainerRef:h,nodeId:null!==_&&void 0!==_?_:void 0,pDiskId:Z,vDiskSlotId:null!==q&&void 0!==q?q:void 0,vDiskId:ae,className:ee("tablets-content")});default:return null}},fe=()=>(0,c.isNil)(oe)?null:(0,Q.jsx)(B.z,{database:V,groupId:oe,nodeId:null!==_&&void 0!==_?_:void 0,pDiskId:Z,scrollContainerRef:h,viewContext:{groupId:null===oe||void 0===oe?void 0:oe.toString(),nodeId:null===_||void 0===_?void 0:_.toString(),pDiskId:null===Z||void 0===Z?void 0:Z.toString(),vDiskSlotId:null===q||void 0===q?void 0:q.toString()}});return(0,Q.jsxs)("div",{className:ee(null),ref:h,children:[(()=>{const e=q?`${L("vdisk")} ${q}`:L("vdisk"),s=Z?`${L("pdisk")} ${Z}`:L("pdisk"),i=J||L("node");return(0,Q.jsx)(u.mg,{titleTemplate:`%s - ${e} - ${s} \u2014 ${i} \u2014 ${ge}`,defaultTitle:`${e} - ${s} \u2014 ${i} \u2014 ${ge}`})})(),(()=>{const e=J?`${L("fqdn")}: ${J}`:void 0,s=K?`${L("node")}: ${K}`:void 0,i=K?`${L("pdisk")}: ${Z}`:void 0;return(0,Q.jsx)(b.B,{className:ee("meta"),loading:W,items:[e,s,Y,X,i,se]})})(),(0,Q.jsx)(m.$,{className:ee("title"),entityName:L("vdisk"),status:(0,I.XY)(ne),id:pe}),(0,Q.jsx)("div",{className:ee("controls"),children:(0,Q.jsxs)(p.B,{onConfirmAction:he,onConfirmActionSuccess:me,buttonDisabled:!ve||!S,buttonView:"normal",dialogHeader:L("evict-vdisk-dialog-header"),dialogText:L("evict-vdisk-dialog-text"),retryButtonText:L("force-evict-vdisk-button"),withPopover:!0,popoverContent:L("evict-vdisk-not-allowed"),popoverDisabled:S,children:[(0,Q.jsx)(l.I,{data:n}),L("evict-vdisk-button")]})}),W?(0,Q.jsx)(x.y,{rows:9}):(0,Q.jsxs)(t.Fragment,{children:[M?(0,Q.jsx)(g.o,{error:M}):null,(0,Q.jsx)(y.E,{data:G,className:ee("info"),wrap:!0}),(0,Q.jsx)("div",{className:ee("tabs"),children:(0,Q.jsx)(a.f,{value:$,children:(0,Q.jsx)(o.w,{size:"l",children:ie.map((({id:e,title:s})=>{const t=i({nodeId:null===_||void 0===_?void 0:_.toString(),vDiskId:null===pe||void 0===pe?void 0:pe.toString()},{activeTab:e});return(0,Q.jsx)(r.o,{value:e,disabled:!t,children:(0,Q.jsx)(f.E,{as:"tab",to:t,children:s})},e)}))})})}),xe()]})]})}}}]);