"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[2335],{94790:(e,t,a)=>{a.d(t,{f:()=>o});var r=a(68963),s=a(44920),n=a(75859);const o=e=>{let{children:t,content:a,className:o,hasArrow:l=!0,placement:d=["top","bottom"],...i}=e;const[u,c]=r.useState(!1),m=r.useRef(null);return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(s.G,{anchorRef:m,open:u,placement:d,hasArrow:l,...i,children:a}),(0,n.jsx)("span",{className:o,ref:m,onMouseEnter:()=>{c(!0)},onMouseLeave:()=>{c(!1)},children:t})]})}},36985:(e,t,a)=>{a.d(t,{C:()=>r.C});var r=a(49201)},68242:(e,t,a)=>{a.d(t,{m:()=>u});var r=a(24362),s=a(94790),n=a(27506),o=a(75859);const l=(0,r.cn)("ydb-pool-bar"),d=e=>{let{data:t={}}=e;const{Usage:a=0}=t,r=Math.min(100*a,100),d=(e=>e>=75?"danger":e>=50&&e<75?"warning":"normal")(r);return(0,o.jsx)(s.f,{className:l({type:d}),content:(0,o.jsx)(n.A8,{data:t,className:l("popup-content")}),children:(0,o.jsx)("div",{style:{height:"".concat(r,"%")},className:l("value",{type:d})})})},i=(0,r.cn)("ydb-pools-graph"),u=e=>{let{pools:t=[]}=e;return(0,o.jsx)("div",{className:i(),children:t.map(((e,t)=>(0,o.jsx)(d,{data:e},t)))})}},74221:(e,t,a)=>{a.d(t,{T:()=>o});var r=a(79734),s=a(80839),n=a(75859);const o=e=>{let{value:t,onChange:a,className:o}=e;return(0,n.jsxs)(r.E,{value:t,onUpdate:a,className:o,children:[(0,n.jsx)(r.E.Option,{value:s.pu.ALL,children:s.pu.ALL}),(0,n.jsx)(r.E.Option,{value:s.pu.PROBLEMS,children:s.pu.PROBLEMS})]})}},11551:(e,t,a)=>{a.d(t,{o:()=>r.o});var r=a(30629)},2335:(e,t,a)=>{a.d(t,{G:()=>O});var r=a(52317),s=a(17096),n=a(68963),o=a(81413),l=a(17095),d=a(52846),i=a(36985),u=a(86969),c=a(1440),m=a(26688),h=a(56350),p=a(74221),g=a(2098),v=a(11551),N=a(47101),b=a(43989);let y;!function(e){e.v1="v1",e.v2="v2"}(y||(y={}));var w=a(905),f=a(46925);const x=w.h.injectEndpoints({endpoints:e=>({getNodes:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getNodes({type:"any",storage:!1,tablets:!0,...e},{signal:a});return{data:(0,f.nH)(t)}}catch(r){return{error:r}}},providesTags:["All"]}),getComputeNodes:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getCompute({version:y.v2,...e},{signal:a});return{data:(0,f.Zf)(t)}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"});var j=a(14223),C=a(80839),P=a(24362),T=a(51688),L=a(96939),S=a(30817);const F=JSON.parse('{"empty.default":"No such nodes"}'),E=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432"}'),M=(0,S.wZ)("ydb-nodes",{ru:E,en:F});var A=a(75859);const I=(0,P.cn)("ydb-nodes"),U=e=>{var t;let{path:a,database:y,additionalNodesProps:w={}}=e;const[f,P]=(0,d.useQueryParams)({uptimeFilter:d.StringParam,search:d.StringParam}),S=T.U8.parse(f.uptimeFilter),F=null!==(t=f.search)&&void 0!==t?t:"",E=(0,s.zL)(),U=(0,s.ix)(C.qz),[R]=(0,s.Rj)(),[Z]=(0,s.yu)(r.UF),z=a&&!Z,D=x.useGetNodesQuery(z?l.CN:{path:a,database:y},{pollingInterval:R}),V=x.useGetComputeNodesQuery(z?{path:a}:l.CN,{pollingInterval:R}),{currentData:O,isLoading:G,error:W}=z?V:D,[k,q]=n.useState({sortValue:"NodeId",sortOrder:o.zE}),[H,Q]=(0,s.sC)(k,(e=>{q(e)})),_=e=>{P({search:e||void 0},"replaceIn")},B=e=>{E((0,C.M6)(e))},J=e=>{P({uptimeFilter:e},"replaceIn")},X=n.useMemo((()=>(0,j.A)(null===O||void 0===O?void 0:O.Nodes,{searchValue:F,uptimeFilter:S,problemFilter:U})),[O,F,S,U]),K=(null===O||void 0===O?void 0:O.TotalNodes)||0;return(0,c.u)(W)?(0,A.jsx)(u.J,{}):(0,A.jsxs)(N.l,{children:[(0,A.jsx)(N.l.Controls,{children:(0,A.jsxs)(n.Fragment,{children:[(0,A.jsx)(v.o,{onChange:_,placeholder:"Host name",className:I("search"),value:F}),(0,A.jsx)(p.T,{value:U,onChange:B}),(0,A.jsx)(b.X,{value:S,onChange:J}),(0,A.jsx)(i.C,{total:K,current:X.length,label:"Nodes",loading:G})]})}),W?(0,A.jsx)(m.V,{error:W}):null,(0,A.jsx)(N.l.Table,{loading:G,children:O?(()=>{const e=(0,L.gM)({getNodeRef:w.getNodeRef}).map((e=>({...e,sortable:(0,T.oh)(e.name)})));return 0!==X.length||U===C.pu.ALL&&S===T.Uu.All?(0,A.jsx)(g.G,{columnsWidthLSKey:L.t5,data:X||[],columns:e,settings:r.LE,sortOrder:H,onSort:Q,emptyDataMessage:M("empty.default"),rowClassName:e=>I("node",{unavailable:(0,T.TA)(e)})}):(0,A.jsx)(h.Q,{name:"thumbsUp",width:"200"})})():null})]})};var R=a(11635);const Z=(e,t)=>"getNodes|offset".concat(t,"|limit").concat(e),z=async e=>{const{type:t="any",storage:a=!1,tablets:r=!0,limit:s,offset:n,sortParams:o,filters:l}=e,{sortOrder:d,columnId:i}=null!==o&&void 0!==o?o:{},{path:u,database:c,searchValue:m,problemFilter:h,uptimeFilter:p}=null!==l&&void 0!==l?l:{},g=await window.api.getNodes({type:t,storage:a,tablets:r,limit:s,offset:n,sortOrder:d,sortValue:i,path:u,database:c,filter:m,problems_only:(0,T.eV)(h),uptime:(0,T.RW)(p)},{concurrentId:Z(s,n),signal:e.signal}),v=(0,f.nH)(g);return{data:v.Nodes||[],found:v.FoundNodes||0,total:v.TotalNodes||0}},D=(0,P.cn)("ydb-nodes"),V=e=>{var t;let{path:a,database:r,parentContainer:o,additionalNodesProps:l}=e;const[c,g]=(0,d.useQueryParams)({uptimeFilter:d.StringParam,search:d.StringParam}),N=T.U8.parse(c.uptimeFilter),y=null!==(t=c.search)&&void 0!==t?t:"",w=(0,s.zL)(),f=(0,s.ix)(C.qz),x=n.useMemo((()=>({path:a,database:r,searchValue:y,problemFilter:f,uptimeFilter:N})),[a,r,y,f,N]),j=(0,L.gM)({getNodeRef:null===l||void 0===l?void 0:l.getNodeRef}).map((e=>({...e,sortable:(0,T.oh)(e.name)})));return(0,A.jsx)(R.WQ,{columnsWidthLSKey:L.t5,parentContainer:o,columns:j,fetchData:z,limit:50,renderControls:e=>{let{totalEntities:t,foundEntities:a,inited:r}=e;return(0,A.jsxs)(n.Fragment,{children:[(0,A.jsx)(v.o,{onChange:e=>{g({search:e||void 0},"replaceIn")},placeholder:"Host name",className:D("search"),value:y}),(0,A.jsx)(p.T,{value:f,onChange:e=>{w((0,C.M6)(e))}}),(0,A.jsx)(b.X,{value:N,onChange:e=>{g({uptimeFilter:e},"replaceIn")}}),(0,A.jsx)(i.C,{total:t,current:a,label:"Nodes",loading:!r})]})},renderErrorMessage:e=>e&&403===e.status?(0,A.jsx)(u.J,{position:"left"}):(0,A.jsx)(m.V,{error:e}),renderEmptyDataMessage:()=>f!==C.pu.ALL||N!==T.Uu.All?(0,A.jsx)(h.Q,{name:"thumbsUp",width:"200"}):M("empty.default"),getRowClassName:e=>D("node",{unavailable:(0,T.TA)(e)}),filters:x,tableName:"nodes"})},O=e=>{let{parentContainer:t,...a}=e;const[n]=(0,s.yu)(r.Qy);return n?(0,A.jsx)(V,{parentContainer:t,...a}):(0,A.jsx)(U,{...a})}},96939:(e,t,a)=>{a.d(t,{t5:()=>y,gM:()=>B,LF:()=>X,sQ:()=>J,Cj:()=>K});var r=a(19812),s=a(99683),n=a(89778),o=a(68242),l=a(67359),d=a(83203),i=a(54665),u=a(24362),c=a(52317),m=a(83496),h=a(75859);const p=(0,u.cn)("tablets-statistic"),g=e=>{let{tablets:t=[],path:a,nodeIds:r,backend:s}=e;const n=(e=>e.map((e=>({label:(0,c.qV)(e.Type),type:e.Type,count:e.Count,state:(0,m.FW)(e.State)}))).sort(((e,t)=>String(e.label).localeCompare(String(t.label)))))(t);return(0,h.jsx)("div",{className:p(),children:n.map(((e,t)=>{var n;const o=(0,i.ax)(i.ZP.tabletsFilters,void 0,{nodeIds:r,state:e.state,type:e.type,path:a,backend:s}),l="".concat(e.label,": ").concat(e.count),u=p("tablet",{state:null===(n=e.state)||void 0===n?void 0:n.toLowerCase()});return s?(0,h.jsx)("a",{href:o,className:u,children:l},t):(0,h.jsx)(d.rU,{to:o,className:u,children:l},t)}))})};var v=a(80816),N=a(46925),b=a(34301);const y="nodesTableColumnsWidth",w="Host",f="DC",x="Rack",j="Version",C="Uptime",P="Memory",T="CPU",L="LoadAverage",S="Tablets",F="TopNodesLoadAverage",E="TopNodesMemory",M="SharedCacheUsage",A="TotalSessions",I={name:"NodeId",header:"#",width:80,render:e=>{let{row:t}=e;return t.NodeId},align:r.ZP.RIGHT,sortable:!1},U=e=>({name:w,render:t=>{let{row:a}=t;return(0,h.jsx)(n.k,{node:a,getNodeRef:e})},width:350,align:r.ZP.LEFT,sortable:!1}),R=e=>({...U(e),width:void 0}),Z={name:f,header:"DC",align:r.ZP.LEFT,render:e=>{let{row:t}=e;return t.DC||c.jX},width:60},z={name:x,header:"Rack",align:r.ZP.LEFT,render:e=>{let{row:t}=e;return t.Rack?t.Rack:"\u2014"},width:80},D={name:j,width:200,align:r.ZP.LEFT,render:e=>{let{row:t}=e;return(0,h.jsx)(s.l,{content:t.Version,children:t.Version})},sortable:!1},V={name:C,header:"Uptime",sortAccessor:e=>{let{StartTime:t}=e;return t&&-t},render:e=>{let{row:t}=e;return t.Uptime},align:r.ZP.RIGHT,width:110,sortable:!1},O={name:P,header:"Memory",sortAccessor:e=>{let{MemoryUsed:t=0}=e;return Number(t)},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return(0,h.jsx)(l.y,{value:t.MemoryUsed,capacity:t.MemoryLimit,formatValues:b.q3,colorizeProgress:!0})},align:r.ZP.RIGHT,width:120},G={name:T,header:"CPU",sortAccessor:e=>{let{PoolStats:t=[]}=e;return Math.max(...t.map((e=>{let{Usage:t}=e;return Number(t)})))},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.PoolStats?(0,h.jsx)(o.m,{pools:t.PoolStats}):"\u2014"},align:r.ZP.LEFT,width:80,resizeMinWidth:60,sortable:!1},W={name:L,header:"Load average",sortAccessor:e=>{let{LoadAveragePercents:t=[]}=e;return t[0]},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return(0,h.jsx)(l.y,{value:t.LoadAveragePercents&&t.LoadAveragePercents.length>0?t.LoadAveragePercents[0]:void 0,percents:!0,colorizeProgress:!0,capacity:100})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},k=e=>({name:S,width:500,resizeMinWidth:500,render:t=>{let{row:a}=t;return a.Tablets?(0,h.jsx)(g,{path:null!==e&&void 0!==e?e:a.TenantName,nodeIds:[a.NodeId],tablets:a.Tablets}):"\u2014"},align:r.ZP.LEFT,sortable:!1}),q={name:F,header:"Load",render:e=>{let{row:t}=e;return t.LoadAveragePercents&&t.LoadAveragePercents.length>0?(0,h.jsx)(v.a,{value:t.LoadAveragePercents[0].toFixed(),theme:(0,N.w6)(t.LoadAveragePercents[0])}):"\u2014"},align:r.ZP.LEFT,width:80,resizeMinWidth:70,sortable:!1},H={name:E,header:"Process",render:e=>{let{row:t}=e;return(0,h.jsx)(l.y,{value:t.MemoryUsed,capacity:t.MemoryLimit,formatValues:b.q3,colorizeProgress:!0})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},Q={name:M,header:"Caches",render:e=>{let{row:t}=e;return(0,h.jsx)(l.y,{value:t.SharedCacheUsed,capacity:t.SharedCacheLimit,formatValues:b.q3,colorizeProgress:!0})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},_={name:A,header:"Sessions",render:e=>{var t;let{row:a}=e;return null!==(t=a.TotalSessions)&&void 0!==t?t:"\u2014"},align:r.ZP.RIGHT,width:100,sortable:!1};function B(e){let{tabletsPath:t,getNodeRef:a}=e;return[I,U(a),Z,z,D,V,O,G,W,k(t)]}function J(e){return[q,I,R(e),D]}function X(e){return[G,I,R(e)]}function K(e){let{tabletsPath:t,getNodeRef:a}=e;return[I,U(a),V,q,H,Q,_,k(t)]}},46925:(e,t,a)=>{a.d(t,{Zf:()=>l,nH:()=>d,w6:()=>i});var r=a(34301),s=a(99106),n=a(51688);const o=(e,t)=>{var a;return{...e,TenantName:null!==(a=e.Tenant)&&void 0!==a?a:t,SystemState:null===e||void 0===e?void 0:e.Overall,Uptime:(0,r.fG)(null===e||void 0===e?void 0:e.StartTime),LoadAveragePercents:(0,n.y$)(e),DC:e.DataCenter}},l=e=>{const t=((e,t)=>{const a=[];if(e)e.forEach((e=>{a.push(o(e))}));else if(t)for(const s of t){var r;null===(r=s.Nodes)||void 0===r||r.forEach((e=>{a.push(o(e,s.Name))}))}return a})(e.Nodes,e.Tenants);return{Nodes:t,TotalNodes:Number(e.TotalNodes)||t.length,FoundNodes:Number(e.FoundNodes)}},d=e=>{const t=(e.Nodes||[]).map((e=>{var t,a,r,s;const o=Number(null===(t=e.SystemState.SharedCacheStats)||void 0===t?void 0:t.LimitBytes)||void 0;return{...(0,n.Ns)(e.SystemState),Tablets:e.Tablets,NodeId:e.NodeId,TenantName:null===(a=e.SystemState)||void 0===a||null===(r=a.Tenants)||void 0===r?void 0:r[0],SharedCacheUsed:null===(s=e.SystemState.SharedCacheStats)||void 0===s?void 0:s.UsedBytes,SharedCacheLimit:o}}));return{Nodes:t,TotalNodes:Number(e.TotalNodes)||t.length,FoundNodes:Number(e.FoundNodes)}},i=(0,s.p)(60,80,["success","warning","danger"])}}]);