(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[2435],{65070:(e,t,a)=>{"use strict";a.d(t,{U:()=>c});var n=a(68963),s=a(17176),r=a(68330),i=a(86793),o=a(45743),l=a(75859);function c(e){let{children:t,onConfirmAction:a,onConfirmActionSuccess:c,dialogHeader:d,dialogText:u,retryButtonText:m,buttonDisabled:p=!1,buttonView:h="action",buttonClassName:v,withPopover:g=!1,popoverContent:x,popoverPlacement:y="right",popoverDisabled:b=!0}=e;const[f,j]=n.useState(!1),[N,S]=n.useState(!1),[w,T]=n.useState(!1),C=()=>(0,l.jsx)(s.z,{onClick:()=>j(!0),view:h,disabled:p,loading:!p&&N,className:v,children:t});return(0,l.jsxs)(n.Fragment,{children:[(0,l.jsx)(i.g,{visible:f,header:d,text:u,withRetry:w,retryButtonText:m,onConfirm:async e=>{S(!0),await a(e)},onConfirmActionSuccess:async()=>{T(!1);try{await(null===c||void 0===c?void 0:c())}finally{S(!1)}},onConfirmActionError:e=>{T((0,o.q)(e)),S(!1)},onClose:()=>{j(!1)}}),g?(0,l.jsx)(r.J,{content:x,placement:y,disabled:b,children:C()}):C()]})}},86793:(e,t,a)=>{"use strict";a.d(t,{g:()=>v});var n=a(68963),s=a(76506),r=a(71586),i=a(25822),o=a(88776),l=a(24362),c=a(30817);const d=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close"}'),u=(0,c.wZ)("ydb-critical-action-dialog",{en:d});var m=a(75859);const p=(0,l.cn)("ydb-critical-dialog"),h=e=>403===e.status?u("no-rights-error"):e.statusText?e.statusText:u("default-error");function v(e){let{visible:t,header:a,text:l,withRetry:c,retryButtonText:d,onClose:v,onConfirm:g,onConfirmActionSuccess:x,onConfirmActionError:y}=e;const[b,f]=n.useState(!1),[j,N]=n.useState(),S=async e=>(f(!0),g(e).then((()=>{x(),v()})).catch((e=>{y(e),N(e)})).finally((()=>{f(!1)})));return(0,m.jsx)(i.V,{open:t,hasCloseButton:!1,className:p(),size:"s",onClose:v,onTransitionExited:()=>{N(void 0)},children:j?(0,m.jsxs)(n.Fragment,{children:[(0,m.jsx)(i.V.Header,{caption:a}),(0,m.jsx)(i.V.Body,{className:p("body"),children:(0,m.jsxs)("div",{className:p("body-message",{error:!0}),children:[(0,m.jsx)("span",{className:p("error-icon"),children:(0,m.jsx)(s.Z,{width:"24",height:"22"})}),h(j)]})}),(0,m.jsx)(i.V.Footer,{loading:!1,preset:"default",textButtonApply:c?d||u("button-retry"):void 0,textButtonCancel:u("button-close"),onClickButtonApply:()=>S(!0),onClickButtonCancel:v})]}):(0,m.jsxs)(n.Fragment,{children:[(0,m.jsx)(i.V.Header,{caption:a}),(0,m.jsx)(i.V.Body,{className:p("body"),children:(0,m.jsxs)("div",{className:p("body-message",{warning:!0}),children:[(0,m.jsx)("span",{className:p("warning-icon"),children:(0,m.jsx)(o.J,{data:r.Z,size:24})}),l]})}),(0,m.jsx)(i.V.Footer,{loading:b,preset:"default",textButtonApply:u("button-confirm"),textButtonCancel:u("button-cancel"),propsButtonApply:{type:"submit"},onClickButtonCancel:v,onClickButtonApply:()=>S()})]})})}},45743:(e,t,a)=>{"use strict";a.d(t,{q:()=>n});const n=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},97482:(e,t,a)=>{"use strict";a.d(t,{f:()=>i});var n=a(14979),s=a(83496),r=a(75859);function i(e){let{state:t}=e;return(0,r.jsx)(n._,{theme:(0,s.KR)(t),children:t})}},42635:(e,t,a)=>{"use strict";a.d(t,{J:()=>Q});var n=a(66950),s=a(10288),r=a(88776),i=a(17095),o=a(65070),l=a(41919),c=a(69214),d=a(26688),u=a(74170),m=a(2098),p=a(22692),h=a(97482),v=a(54665),g=a(14146),x=a(76386),y=a(36313),b=a(85690),f=a.n(b),j=a(905),N=a(99337);const S=j.h.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.getTabletsInfo(e,{signal:a})}}catch(n){return{error:n}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),w=(0,y.P1)((e=>e),(e=>S.endpoints.getTabletsInfo.select(e)),{argsMemoize:y.PP,argsMemoizeOptions:{equalityCheck:f()}}),T=(0,y.P1)((e=>e),((e,t)=>w(t)),((e,t)=>t(e).data)),C=(0,y.P1)(((e,t)=>T(e,t)),(e=>(0,N.d)(e)),((e,t)=>null!==e&&void 0!==e&&e.TabletStateInfo?t?e.TabletStateInfo.map((e=>{const a=void 0===e.NodeId?void 0:t.get(e.NodeId);return{...e,fqdn:a}})):e.TabletStateInfo:[]));var E=a(28164),P=a(24362),I=a(52317),D=a(34301),R=a(48169),A=a(17096),k=a(92398),O=a(30817);const _=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill-header":"Restart tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet"}'),M=(0,O.wZ)("ydb-tablets",{en:_});var L=a(75859);const z=(0,P.cn)("tablets");function q(e){let{database:t}=e;return[{name:"Type",get header(){return M("Type")},render:e=>{let{row:t}=e;const a=!1===t.Leader;return(0,L.jsxs)("span",{children:[t.Type," ",a?(0,L.jsx)(s.x,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return M("Tablet")},render:e=>{var a;let{row:n}=e;if(!n.TabletId)return I.jX;const s=(0,v.fK)(n.TabletId,{nodeId:n.NodeId,type:n.Type,tenantName:t});return(0,L.jsx)(c.A,{name:null===(a=n.TabletId)||void 0===a?void 0:a.toString(),path:s,hasClipboardButton:!0,showStatus:!1,additionalControls:(0,L.jsx)(l.Q,{href:(0,R.wz)(n.TabletId)})})}},{name:"State",get header(){return M("State")},render:e=>{let{row:t}=e;return(0,L.jsx)(h.f,{state:t.State})}},{name:"NodeId",get header(){return M("Node ID")},render:e=>{let{row:t}=e;const a=void 0===t.NodeId?void 0:(0,k.a3)(t.NodeId);return(0,L.jsx)(u.h,{to:a,children:t.NodeId})},align:"right"},{name:"fqdn",get header(){return M("Node FQDN")},render:e=>{let{row:t}=e;return t.fqdn?(0,L.jsx)(c.A,{name:t.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,L.jsx)("span",{children:"\u2014"})}},{name:"Generation",get header(){return M("Generation")},align:"right"},{name:"Uptime",get header(){return M("Uptime")},render:e=>{let{row:t}=e;return(0,D.fG)(t.ChangeTime)},sortAccessor:e=>-Number(e.ChangeTime),align:"right"},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:e=>{let{row:t}=e;return(0,L.jsx)(F,{...t})}}]}function F(e){const t=e.State===E.g.Stopped,a=(0,A.ix)(g.VH),[s]=x._.useKillTabletMutation(),i=e.TabletId;return i?(0,L.jsx)(o.U,{buttonView:"outlined",dialogHeader:M("dialog.kill-header"),dialogText:M("dialog.kill-text"),onConfirmAction:()=>s({id:i}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:M("controls.kill-not-allowed"),popoverDisabled:a,children:(0,L.jsx)(r.J,{data:n.Z})}):null}function Q(e){let{nodeId:t,path:a,database:n,className:s}=e;const[r]=(0,A.Rj)();let o={};const l=void 0===t?void 0:String(t);void 0!==l?o={nodeId:l,database:n}:a&&(o={path:a,database:n});const{currentData:c,isFetching:u,error:h}=S.useGetTabletsInfoQuery(0===Object.keys(o).length?i.CN:o,{pollingInterval:r}),v=u&&void 0===c,g=(0,A.ix)((e=>C(e,o)));return v?(0,L.jsx)(p.h,{}):(0,L.jsxs)("div",{className:z(null,s),children:[h?(0,L.jsx)(d.V,{error:h}):null,c?(0,L.jsx)(m.G,{columns:q({database:n}),data:g,settings:I.LE,emptyDataMessage:M("noTabletsData")}):null]})}},35744:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Tenant:()=>Gp});var n=a(68963),s=a(49352),r=a(52846),i=a(1440),o=a(96409),l=a(93838),c=a(24362),d=a(75859);const u=(0,c.cn)("kv-split"),m=[0,100],p=[50,50];const h=function(e){const[t,a]=n.useState(),s=t=>{const{defaultSizePaneKey:a}=e;localStorage.setItem(a,t.join(","))};return n.useEffect((()=>{const{collapsedSizes:t,triggerCollapse:n}=e;if(n){const e=t||m;s(e),a(e)}}),[e.triggerCollapse]),n.useEffect((()=>{const{triggerExpand:t,defaultSizes:n}=e,r=n||p;t&&(s(r),a(r))}),[e.triggerExpand]),(0,d.jsx)(n.Fragment,{children:(0,d.jsx)(l.Z,{direction:e.direction||"horizontal",sizes:t||(()=>{var t;const{defaultSizePaneKey:a,defaultSizes:n=p,initialSizes:s}=e;if(s)return s;return(null===(t=localStorage.getItem(a))||void 0===t?void 0:t.split(",").map(Number))||n})(),minSize:e.minSize||[0,0],onDrag:t=>{const{onSplitDragAdditional:a}=e;a&&a(),s(t)},className:u(null,e.direction||"horizontal"),gutterSize:8,onDragStart:()=>{const{onSplitStartDragAdditional:t}=e;t&&t(),a(void 0)},expandToMin:!0,children:e.children})})};var v=a(79061),g=a(6748),x=a(52317),y=a(17096),b=a(64270),f=a(67714);const j=(0,c.cn)("ydb-not-render-until-first-visible");function N(e){let{show:t,className:a,children:n}=e;return(0,d.jsx)("div",{style:t?void 0:{display:"none"},className:j(null,a),children:(0,d.jsx)(f.f,{freeze:!t,children:n})})}var S=a(24015),w=a(8179),T=a(83203),C=a(50422),E=a(54665),P=a(8511),I=a(2418),D=a(48897),R=a(26688),A=a(62776),k=a(93717),O=a(3027),_=a(34301),M=a(43832),L=a.n(M),z=a(27102);const q=(0,c.cn)("heatmap"),F={width:0,height:0},Q=10,B=2,U=e=>{const[t,a]=n.useState(F),{tablets:s}=e,r=n.useRef(null),i=n.useRef(null);n.useEffect((()=>{const e=r.current,a=e.getContext("2d");a.clearRect(0,0,e.offsetWidth,e.offsetHeight),s.map(function(e){return(a,n)=>{const{columnsCount:s}=t,r=n%s*(Q+B),i=Math.floor(n/s)*(Q+B);e.fillStyle=a.color||"grey",e.fillRect(r,i,Q,Q)}}(a))})),n.useLayoutEffect((()=>{const e=i.current;if(e){const t=e.offsetWidth-15,n=Math.floor(t/(Q+B)),r=Math.ceil(s.length/n);a({width:t,height:r*(Q+B),columnsCount:n,rowsCount:r})}}),[]);const o=()=>{let e=r.current,t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t},l=()=>{let e=r.current,t=0;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t},c=(e,a)=>{const{columnsCount:n}=t,s=Q+B,r=Q+B,i=Math.floor(e/s);return n*Math.floor(a/r)+i},u=L()(((t,a)=>{const n=new CustomEvent("scroll");window.dispatchEvent(n);const r=e.parentRef.current,i=t-l()+r.scrollLeft,d=a-o()+r.scrollTop,u=c(i,d),m=s[u];if(m){const n={name:m.currentMetric,value:m.formattedValue};e.showTooltip(void 0,m,"tablet",n,{left:t-20,top:a-20})}else e.hideTooltip()}),20);return(0,d.jsx)("div",{ref:i,className:q("canvas-container"),onMouseLeave:()=>{setTimeout((()=>{e.hideTooltip()}),40)},children:(0,d.jsx)("canvas",{ref:r,width:t.width,height:t.height,onClick:t=>{const a=e.parentRef.current,n=t.clientX-l()+a.scrollLeft,r=t.clientY-o()+a.scrollTop,i=c(n,r),d=s[i];d&&window.open((e=>{const{TabletId:t}=e,a=window.location.hostname,n=(0,E.fK)(t),s=[a,z.EZ,n].map((e=>e.startsWith("/")?e.slice(1):e)).filter(Boolean).join("/");return"".concat("https://").concat(s)})(d),"_blank")},onMouseMove:e=>u(e.clientX,e.clientY)})})},H={r:255,g:4,b:0},V={r:255,g:219,b:77},G={r:59,g:201,b:53},Z={CPU:{min:0,max:1e6},Network:{min:0,max:1e9},Storage:{min:0,max:2e9},DataSize:{min:0,max:2e9},RowCount:{min:0},IndexSize:{min:0}},W=e=>{const t=e.toString(16);return 1===t.length?"0".concat(t):t},J=(e,t,a)=>{if(1===e)return[t];if(2===e)return[t,a];const n=(t.r-a.r)/(e-1),s=(t.g-a.g)/(e-1),r=(t.b-a.b)/(e-1),i=[];for(let o=0;o<e;o++)i.push({r:Math.round(t.r-n*o),g:Math.round(t.g-s*o),b:Math.round(t.b-r*o)});return i.map((e=>(e=>{let{r:t,g:a,b:n}=e;return"#".concat(W(t)).concat(W(a)).concat(W(n))})(e)))},K=e=>{const t=Math.floor(e/2),a=t+1;return[...J(e%2===0?t:t+1,G,V),...J(a,V,H).slice(1)]},Y=(e,t)=>{const a=new Set,n=Z[e]||{};t.forEach((t=>{var n;a.add(Number(null===(n=t.metrics)||void 0===n?void 0:n[e]))})),Number.isInteger(n.min)&&a.add(n.min),Number.isInteger(n.max)&&a.add(n.max);const s=Array.from(a.values()).sort(((e,t)=>e-t));return{min:s[0],max:s[s.length-1]}},X=(0,c.cn)("histogram"),$=e=>{const t=n.useRef(),{data:a={},maxCount:s}=e,{count:r,leftBound:i,rightBound:o,color:l}=a,c=r/s*100;return(0,d.jsx)("div",{ref:t,className:X("item"),style:{backgroundColor:l,height:"".concat(c,"%")},onMouseEnter:()=>{const a=t.current;e.showTooltip(a,{count:r,leftBound:i,rightBound:o},"histogram")},onMouseLeave:e.hideTooltip})},ee=e=>{const{tablets:t,currentMetric:a}=e,{min:n,max:s}=Y(a,t),r=K(50),i=(s-n)/50,o=r.map(((e,t)=>({color:e,count:0,leftBound:(0,_.uf)(n+t*i),rightBound:(0,_.uf)(n+(t+1)*i)})));let l=0;t.forEach((e=>{var t,n;const s=a&&Number(null===(t=e.metrics)||void 0===t?void 0:t[a]),r=Math.floor(s/i),c=(null===(n=o[r])||void 0===n?void 0:n.count)+1;c>l&&(l=c),o[r]={...o[r],count:c}}));return(0,d.jsx)("div",{className:X(),children:(0,d.jsxs)("div",{className:X("chart"),children:[Boolean(s)&&o.map(((t,a)=>(0,d.jsx)($,{data:t,maxCount:l,showTooltip:e.showTooltip,hideTooltip:e.hideTooltip},a))),(0,d.jsx)("div",{className:X("x-min"),children:(0,_.uf)(n)}),(0,d.jsx)("div",{className:X("x-max"),children:(0,_.uf)(s)}),(0,d.jsx)("div",{className:X("y-min"),children:"0"}),(0,d.jsx)("div",{className:X("y-max"),children:(0,_.uf)(l)})]})})},te=(0,c.cn)("heatmap"),ae=K(500),ne=e=>{let{path:t,database:a}=e;const s=(0,y.zL)(),r=n.createRef(),[i]=(0,y.Rj)(),{currentData:o,isFetching:l,error:c}=k.Vc.useGetHeatmapTabletsInfoQuery({path:t,database:a},{pollingInterval:i}),u=l&&void 0===o,{tablets:m=[],metrics:p}=o||{},{sort:h,heatmap:v,currentMetric:g}=(0,y.ix)((e=>e.heatmap)),x=function(){s((0,O.hJ)(...arguments))},b=()=>{s((0,O.i8)())},f=e=>{s((0,k.U_)({currentMetric:e[0]}))},j=()=>{s((0,k.U_)({sort:!h}))},N=()=>{s((0,k.U_)({heatmap:!v}))},S=()=>{const{min:e,max:t}=Y(g,m),a=m.map((a=>{var n;const s=g&&Number(null===(n=a.metrics)||void 0===n?void 0:n[g]),r=((e,t,a)=>0===a?0:Math.round((e-t)/(a-t)*499))(s,e,t),i=ae[r];return{...a,color:i,value:s,formattedValue:(0,_.uf)(s),currentMetric:g}})),n=h?a.sort(((e,t)=>Number(t.value)-Number(e.value))):a;return(0,d.jsx)("div",{ref:r,className:te("items"),children:(0,d.jsx)(U,{tablets:n,parentRef:r,showTooltip:x,hideTooltip:b})})};return u?(0,d.jsx)(A.a,{}):(()=>{const{min:e,max:t}=Y(g,m);let a;return c&&!o||(a=v?S():(0,d.jsx)(ee,{tablets:m,currentMetric:g,showTooltip:x,hideTooltip:b})),(0,d.jsxs)("div",{className:te(),children:[(0,d.jsxs)("div",{className:te("filters"),children:[(0,d.jsx)(I.P,{className:te("heatmap-select"),value:g?[g]:[],options:p,onUpdate:f,width:200}),(0,d.jsx)("div",{className:te("sort-checkbox"),children:(0,d.jsx)(D.X,{onUpdate:j,checked:h,children:"Sort"})}),(0,d.jsx)("div",{className:te("histogram-checkbox"),children:(0,d.jsx)(D.X,{onUpdate:N,checked:v,children:"Heatmap"})}),(0,d.jsxs)("div",{className:te("limits"),children:[(0,d.jsxs)("div",{className:te("limits-block"),children:[(0,d.jsx)("div",{className:te("limits-title"),children:"min:"}),(0,d.jsx)("div",{className:te("limits-value"),children:Number.isInteger(e)?(0,_.uf)(e):"\u2014"})]}),(0,d.jsxs)("div",{className:te("limits-block"),children:[(0,d.jsx)("div",{className:te("limits-title"),children:"max:"}),(0,d.jsx)("div",{className:te("limits-value"),children:Number.isInteger(t)?(0,_.uf)(t):"\u2014"})]}),(0,d.jsxs)("div",{className:te("limits-block"),children:[(0,d.jsx)("div",{className:te("limits-title"),children:"count:"}),(0,d.jsx)("div",{className:te("limits-value"),children:(0,_.uf)(m.length)})]})]})]}),c?(0,d.jsx)(R.V,{error:c}):null,a]})})()};var se=a(96027),re=a(82994),ie=a(42635),oe=a(17095),le=a(2098),ce=a(22692),de=a(39623),ue=a(905);function me(e){return"SELECT * FROM `".concat(e,"` LIMIT 0")}const pe=ue.h.injectEndpoints({endpoints:e=>({getViewSchema:e.query({queryFn:async e=>{let{database:t,path:a}=e;try{const e=await window.api.sendQuery({schema:"modern",query:me(a),database:t,action:"execute-scan"},{withRetries:!0});return(0,de.gW)(e)?{error:e}:{data:e.columns||[]}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var he=a(6523),ve=a(14979),ge=a(94790),xe=a(30817);const ye=JSON.parse('{"column-title.id":"Id","column-title.name":"Name","column-title.type":"Type","column-title.notNull":"NotNull","column-title.autoIncrement":"AutoIncrement","column-title.defaultValue":"Default","column-title.family":"Family","column-title.media":"Media","column-title.compression":"Compression","primary-key.title":"Primary key:","partitioning-key.title":"Partitioning key:"}'),be=(0,xe.wZ)("ydb-schema-viewer",{en:ye}),fe=(0,c.cn)("schema-viewer");const je=e=>{let{tableData:t,extended:a,type:n}=e;const s="primary"===n?function(e){return e.filter((e=>e.isKeyColumn&&e.name)).map((e=>e.name))}(t):function(e){return e.filter((e=>e.isPartitioningKeyColumn&&e.name)).map((e=>e.name))}(t),r=a?3:s.length,i=s.slice(0,r),o=s.slice(r);return s.length>0?(0,d.jsxs)("div",{className:fe("keys",{summary:!a,type:n}),children:[(0,d.jsx)("div",{className:fe("keys-header"),children:be("primary"===n?"primary-key.title":"partitioning-key.title")}),(0,d.jsxs)("div",{className:fe("keys-values"),children:[" "+i.join(", "),o.length?(0,d.jsx)(ge.f,{className:fe("more-badge"),placement:["bottom"],hasArrow:!1,pinOnClick:!0,content:(0,d.jsx)("div",{className:fe("popup-content"),children:o.map((e=>(0,d.jsx)("div",{className:fe("popup-item"),children:e},e)))}),children:(0,d.jsx)(ve._,{className:fe("keys-label"),children:"+".concat(o.length)})}):null]})]}):null};var Ne=a(19812);const Se="autoIncrement",we="defaultValue",Te="familyName",Ce="prefferedPoolKind",Ee="columnCodec",Pe={name:"id",get header(){return be("column-title.id")},width:60,render:e=>{let{row:t}=e;return t.id}},Ie={name:"name",get header(){return be("column-title.name")},width:100,render:e=>{let{row:t}=e;return t.name}},De={name:"type",get header(){return be("column-title.type")},width:100,render:e=>{let{row:t}=e;return t.type}},Re={name:"notNull",get header(){return be("column-title.notNull")},width:100,defaultOrder:Ne.ZP.DESCENDING,render:e=>{let{row:t}=e;if(t.notNull)return"\u2713"}},Ae={name:Se,get header(){return be("column-title.autoIncrement")},width:100,defaultOrder:Ne.ZP.DESCENDING,render:e=>{let{row:t}=e;if(t.autoIncrement)return"\u2713"}},ke={name:we,get header(){return be("column-title.defaultValue")},width:100,render:e=>{let{row:t}=e;return String(t.defaultValue)}},Oe={name:Te,get header(){return be("column-title.family")},width:100,render:e=>{let{row:t}=e;return t.familyName}},_e={name:Ce,get header(){return be("column-title.media")},width:100,render:e=>{let{row:t}=e;return t.prefferedPoolKind}},Me={name:Ee,get header(){return be("column-title.compression")},width:100,render:e=>{let{row:t}=e;return t.columnCodec}};var Le=a(35638);function ze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=function(e){var t,a,n;return null!==(t=null===e||void 0===e||null===(a=e.PartitionConfig)||void 0===a||null===(n=a.ColumnFamilies)||void 0===n?void 0:n.reduce(((e,t)=>t.Id?{...e,[t.Id]:t}:e),{}))&&void 0!==t?t:{}}(e),{Columns:a,KeyColumnIds:n}=e,s=null===a||void 0===a?void 0:a.map((e=>{var a,s;const{Id:r,Name:i,NotNull:o,Type:l,Family:c,DefaultFromSequence:d,DefaultFromLiteral:u}=e,m=Boolean(null===n||void 0===n?void 0:n.find((e=>e===r))),p=c?t[c].Name:void 0,h=c?null===(a=t[c].StorageConfig)||void 0===a||null===(s=a.Data)||void 0===s?void 0:s.PreferredPoolKind:void 0,v=c?function(e){if(e)return e===Le.C6.ColumnCodecPlain?"None":e.replace("ColumnCodec","").toLocaleLowerCase()}(t[c].ColumnCodec):void 0;return{id:r,name:i,isKeyColumn:m,type:l,notNull:o,autoIncrement:Boolean(d),defaultValue:Object.values((null===u||void 0===u?void 0:u.value)||{})[0]||"-",familyName:p,prefferedPoolKind:h,columnCodec:v}}));return[...(null===s||void 0===s?void 0:s.filter((e=>e.isKeyColumn)))||[],...(null===s||void 0===s?void 0:s.filter((e=>!e.isKeyColumn)))||[]]}function qe(e,t){const{Table:a,ColumnTableDescription:n,ExternalTableDescription:s}=(null===t||void 0===t?void 0:t.PathDescription)||{};return(0,he.fd)(e)?ze(a):(0,he.Jp)(e)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{Schema:t={},Sharding:a={}}=e,{Columns:n,KeyColumnNames:s}=t,{HashSharding:r={}}=a,{Columns:i=[]}=r,o=null===n||void 0===n?void 0:n.map((e=>{const{Id:t,Name:a,Type:n,NotNull:r}=e,o=Boolean(null===s||void 0===s?void 0:s.find((e=>e===a))),l=Boolean(null===i||void 0===i?void 0:i.find((e=>e===a)));return{id:t,name:a,isKeyColumn:o,isPartitioningKeyColumn:l,type:n,notNull:r}}));return[...(null===o||void 0===o?void 0:o.filter((e=>e.isKeyColumn)))||[],...(null===o||void 0===o?void 0:o.filter((e=>!e.isKeyColumn)))||[]]}(n):(0,he.uL)(e)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{Columns:t}=e;return(null===t||void 0===t?void 0:t.map((e=>{const{Id:t,Name:a,Type:n,NotNull:s}=e;return{id:t,name:a,type:n,notNull:s}})))||[]}(s):[]}const Fe=e=>{let{type:t,path:a,tenantName:s,extended:r=!1}=e;const{data:i,isLoading:o}=(0,g.hz)({path:a,database:s}),l=(0,he.$J)(t)?{path:a,database:s}:oe.CN,{data:c,isLoading:u}=pe.useGetViewSchemaQuery(l),m=n.useMemo((()=>(0,he.$J)(t)?function(e){return(null===e||void 0===e?void 0:e.map((e=>{var t;return{type:null!==(t=e.type)&&void 0!==t&&t.endsWith("?")?e.type.slice(0,-1):e.type,name:e.name}})))||[]}(c):qe(t,i)),[i,t,c]),p=n.useMemo((()=>m.some((e=>e.autoIncrement))),[m]),h=n.useMemo((()=>m.some((e=>e.defaultValue))),[m]),v=n.useMemo((()=>(0,he.$J)(t)?[Ie,De]:(0,he.uL)(t)||(0,he.Jp)(t)?[Pe,Ie,De,Re]:(0,he.fd)(t)?function(e,t,a){const n=[Pe,Ie,De,Re];return a&&n.push(ke),e&&n.push(Oe,_e,Me),t&&n.push(Ae),n}(r,p,h):[]),[t,r,p,h]);return o||u?(0,d.jsx)(ce.h,{}):(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)("div",{className:fe("keys-wrapper"),children:[(0,d.jsx)(je,{tableData:m,extended:r,type:"primary"}),(0,d.jsx)(je,{tableData:m,extended:r,type:"partitioning"})]}),(0,d.jsx)("div",{className:fe(),children:(0,d.jsx)(le.G,{columnsWidthLSKey:"schemaTableColumnsWidth",data:m,columns:v,settings:x.LE})})]})};var Qe=a(95478),Be=a(43680),Ue=a.n(Be),He=a(11551),Ve=a(36313),Ge=a(81854),Ze=a(1504);const We=ue.h.injectEndpoints({endpoints:e=>({getTopic:e.query({queryFn:async e=>{try{const t=await window.api.getTopic(e);return"object"!==typeof t?{error:{}}:{data:t}}catch(t){return{error:t}}},providesTags:["All"]})}),overrideExisting:"throw"}),Je=(0,Ve.P1)(((e,t)=>({path:e,database:t})),(e=>We.endpoints.getTopic.select(e))),Ke=(0,Ve.P1)((e=>e),((e,t,a)=>Je(t,a)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.topic_stats})),Ye=(0,Ve.P1)((e=>e),((e,t,a)=>Je(t,a)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.consumers})),Xe=(0,Ve.P1)(Ye,(e=>null===e||void 0===e?void 0:e.map((e=>null===e||void 0===e?void 0:e.name)).filter((e=>void 0!==e)))),$e=(0,Ve.P1)(Ke,(e=>{if(!e)return;const{store_size_bytes:t="0",min_last_write_time:a,max_write_time_lag:n,bytes_written:s}=e||{};return{storeSize:t,partitionsIdleTime:(0,Ze.lE)(a),partitionsWriteLag:(0,Ze.DA)(n),writeSpeed:(0,Ge.c4)(s)}})),et=(0,Ve.P1)(Ye,(e=>null===e||void 0===e?void 0:e.map((e=>{const{name:t,consumer_stats:a}=e||{},{min_partitions_last_read_time:n,max_read_time_lag:s,max_write_time_lag:r,bytes_read:i}=a||{};return{name:t,readSpeed:(0,Ge.c4)(i),writeLag:(0,Ze.DA)(r),readLag:(0,Ze.DA)(s),readIdleTime:(0,Ze.lE)(n)}}))));var tt=a(68330);const at=JSON.parse('{"averageSpeed":"Average speed","perMinute":"per minute","perHour":"per hour","perDay":"per day"}'),nt=JSON.parse('{"averageSpeed":"\u0421\u0440\u0435\u0434\u043d\u044f\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c","perMinute":"\u0437\u0430 \u043c\u0438\u043d\u0443\u0442\u0443","perHour":"\u0437\u0430 \u0447\u0430\u0441","perDay":"\u0437\u0430 \u0434\u0435\u043d\u044c"}'),st=(0,xe.wZ)("ydb-components-speed-multimeter",{ru:nt,en:at}),rt=(0,c.cn)("speed-multimeter"),it=e=>{let{data:t,speedSize:a="kb",withValue:s=!0,withPopover:r=!0}=e;const{perMinute:i=0,perHour:o=0,perDay:l=0}=t||{},c=[i,o,l],u=e=>(0,Ge.td)({value:e,size:a,withSpeedLabel:!0}),m=[{value:u(i),label:st("perMinute")},{value:u(o),label:st("perHour")},{value:u(l),label:st("perDay")}],[p,h]=n.useState(i),[v,g]=n.useState(s?0:void 0),[x,y]=n.useState(),b=(e,t)=>{h(e[t]),g(t),y(t)},f=e=>v===e,j=e=>x===e;return(0,d.jsx)("div",{className:rt(),children:(0,d.jsxs)("div",{className:rt("content"),children:[s&&(0,d.jsx)("div",{className:rt("displayed-value"),children:u(p)}),(0,d.jsx)(tt.J,{content:(0,d.jsxs)("div",{className:rt("popover-content"),children:[(0,d.jsx)("span",{className:rt("popover-header"),children:st("averageSpeed")}),m.map(((e,t)=>{return(0,d.jsx)("span",{className:rt("popover-row",(a=f(t),a?{color:"primary"}:{color:"secondary"})),children:"".concat(e.label,": ").concat(e.value)},t);var a}))]}),className:rt("popover-container"),placement:"bottom",disabled:!r,hasArrow:!0,size:"s",children:(0,d.jsx)("div",{className:rt("bars"),onMouseLeave:()=>{h(i),g(s?0:void 0),y(void 0)},children:(()=>{const e=Math.max(...c,0)||1;return c.map(((t,a)=>(0,d.jsx)("div",{className:rt("bar-container",{highlighted:j(a)}),onMouseEnter:b.bind(null,c,a),children:(0,d.jsx)("div",{className:rt("bar",{color:f(a)?"dark":"light"}),style:{width:"".concat(100*t/e,"%")}})},a)))})()})})]})})},ot=(0,c.cn)("ydb-diagnostics-consumers-topic-stats"),lt=e=>{let{data:t}=e;const{writeSpeed:a,partitionsWriteLag:n,partitionsIdleTime:s}=t||{},r=[{label:"Write speed",value:(0,d.jsx)(it,{data:a})},{label:"Write lag",value:(0,_.gC)(n||0)},{label:"Write idle time",value:(0,_.gC)(s||0)}];return(0,d.jsx)("div",{className:ot("wrapper"),children:r.map(((e,t)=>(0,d.jsxs)("div",{className:ot("item"),children:[(0,d.jsx)("div",{className:ot("label"),children:e.label}),(0,d.jsx)("div",{className:ot("value"),children:e.value})]},t)))})};var ct=a(63041),dt=a.n(ct),ut=a(74170),mt=a(21986);const pt=e=>{let{text:t,popoverContent:a,popoverClassName:n,className:s,contentClassName:r,buttonProps:i}=e;return(0,d.jsxs)("div",{className:s,children:[t,"\xa0",(0,d.jsx)(mt.J,{className:n,buttonProps:i,content:a,contentClassName:r})]})},ht=70,vt=54,gt=268,xt="#ADE8F5",yt="#f5be9d",bt=e=>{let{width:t,height:a,transform:n}=e;return(0,d.jsx)("path",{d:"M-".concat(t/2," 0 c0 -").concat(a,", ").concat(t," -").concat(a,", ").concat(t," 0"),fill:"none",strokeDasharray:"4,6",stroke:"#28f",strokeWidth:"1.6",transform:n})},ft=e=>{let{width:t}=e;return(0,d.jsx)("path",{fill:"none",strokeWidth:"2",d:"M0 0 h".concat(t," l-10 -5 m0 10 l10 -5")})},jt=()=>(0,d.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,d.jsx)("g",{transform:"translate(0, ".concat(27,")"),stroke:yt,children:(0,d.jsx)(ft,{width:203})}),(0,d.jsxs)("g",{transform:"translate(".concat(30,", 0)"),children:[(0,d.jsxs)("g",{transform:"translate(".concat(35,", ").concat(27,")"),children:[(0,d.jsx)(bt,{width:ht,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(119,", ").concat(27,")"),children:[(0,d.jsx)(bt,{width:98,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write idle time"})})]})]}),(0,d.jsxs)("g",{transform:"translate(".concat(30,", 0)"),children:[(0,d.jsxs)("g",{transform:"translate(".concat(0,", ",27,")"),children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:yt}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(ht,", ").concat(27,")"),children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:yt}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,d.jsx)("g",{transform:"translate(".concat(168,", ").concat(27,")"),children:(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),Nt=()=>(0,d.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,d.jsx)("g",{transform:"translate(0, ".concat(27,")"),stroke:xt,children:(0,d.jsx)(ft,{width:gt})}),(0,d.jsxs)("g",{transform:"translate(".concat(30,", 0)"),children:[(0,d.jsxs)("g",{transform:"translate(".concat(105,", ").concat(27,")"),children:[(0,d.jsx)(bt,{width:ht,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read lag"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(35,", ").concat(27,")"),children:[(0,d.jsx)(bt,{width:ht,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(182,", ").concat(27,")"),children:[(0,d.jsx)(bt,{width:91,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read idle time"})})]})]}),(0,d.jsxs)("g",{transform:"translate(".concat(30,", ").concat(27,")"),children:[(0,d.jsxs)("g",{transform:"translate(".concat(0,", 0)"),children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:xt}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(ht,", 0)"),children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:xt}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,d.jsxs)("g",{transform:"translate(".concat(140,", 0)"),children:[(0,d.jsx)("use",{x:"-2",y:"-10",xlinkHref:"#check",stroke:xt}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read time"})})]}),(0,d.jsx)("g",{transform:"translate(".concat(224,", 0)"),children:(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),St=e=>{let{id:t,fill:a}=e;return(0,d.jsx)("pattern",{id:t,x:"0",y:"0",width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,d.jsx)("path",{d:"M0 5L5 0H8L0 8V5M5 8L8 5V8Z",fill:a})})},wt=()=>(0,d.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 ".concat(gt," ").concat(vt),width:gt,height:vt,children:[(0,d.jsxs)("defs",{children:[(0,d.jsx)("g",{id:"check",children:(0,d.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,d.jsx)(St,{id:"latest-read",fill:xt}),(0,d.jsx)(St,{id:"latest-write",fill:yt})]}),(0,d.jsx)(jt,{})]}),Tt=()=>(0,d.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 ".concat(gt," ").concat(vt),width:gt,height:vt,children:[(0,d.jsxs)("defs",{children:[(0,d.jsx)("g",{id:"check",children:(0,d.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,d.jsx)(St,{id:"latest-read",fill:xt}),(0,d.jsx)(St,{id:"latest-write",fill:yt})]}),(0,d.jsx)(Nt,{})]}),Ct=(0,c.cn)("ydb-lag-popover-content"),Et=e=>{let{text:t,type:a}=e;return(0,d.jsxs)("div",{className:Ct({type:a}),children:[(0,d.jsx)("div",{className:Ct("text"),children:t}),(0,d.jsx)("div",{children:"read"===a?(0,d.jsx)(Tt,{}):(0,d.jsx)(wt,{})})]})},Pt=JSON.parse('{"noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers","lagsPopover.readLags":"Read lags statistics, maximum among all consumer partitions (time format dd hh:mm:ss)","table.emptyDataMessage":"No consumers match the current search","controls.search":"Consumer"}'),It=JSON.parse('{"noConsumersMessage.topic":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0442\u043e\u043f\u0438\u043a\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","noConsumersMessage.stream":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0440\u0438\u043c\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","lagsPopover.readLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0447\u0442\u0435\u043d\u0438\u044f, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","table.emptyDataMessage":"\u041f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0438\u0441\u043a\u0443 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","controls.search":"Consumer"}'),Dt=(0,xe.wZ)("ydb-diagnostics-consumers",{ru:It,en:Pt}),Rt="consumer",At="readSpeed",kt="readLags",Ot={[Rt]:"Consumer",[At]:"Read speed",[kt]:"Read lags, duration"},_t="writeLag",Mt="readLag",Lt="readIdleTime",zt={[_t]:"write lag",[Mt]:"read lag",[Lt]:"read idle time"},qt=(0,c.cn)("ydb-diagnostics-consumers-columns-header"),Ft=()=>(0,d.jsx)(pt,{className:qt("lags"),text:Ot[kt],popoverContent:(0,d.jsx)(Et,{text:Dt("lagsPopover.readLags"),type:"read"})}),Qt=(0,c.cn)("ydb-diagnostics-consumers-columns"),Bt=[{name:Rt,header:Ot[Rt],align:Ne.ZP.LEFT,render:e=>{let{row:t}=e;if(!t.name)return"\u2013";const a=dt().parse(location.search,{ignoreQueryPrefix:!0});return(0,d.jsx)(ut.h,{to:(0,E.ax)(E.ZP.tenant,void 0,{...a,[Qe.XV.diagnosticsTab]:S.qQ.partitions,selectedConsumer:t.name}),children:t.name})}},{name:At,header:Ot[At],align:Ne.ZP.RIGHT,resizeMinWidth:140,sortAccessor:e=>e.readSpeed.perMinute,render:e=>{let{row:t}=e;return(0,d.jsx)(it,{data:t.readSpeed})}},{name:kt,header:(0,d.jsx)(Ft,{}),className:Qt("lags-header"),sub:[{name:_t,header:zt[_t],align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,_.gC)(t.writeLag)}},{name:Mt,header:zt[Mt],align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,_.gC)(t.readLag)}},{name:Lt,header:zt[Lt],align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,_.gC)(t.readIdleTime)}}]}],Ut=(0,c.cn)("ydb-diagnostics-consumers"),Ht=e=>{let{path:t,database:a,type:s}=e;const r=(0,he.zf)(s),[i,o]=n.useState(""),[l]=(0,y.Rj)(),{currentData:c,isFetching:u,error:m}=We.useGetTopicQuery({path:t,database:a},{pollingInterval:l}),p=u&&void 0===c,h=(0,y.ix)((e=>et(e,t,a))),v=(0,y.ix)((e=>$e(e,t,a))),g=n.useMemo((()=>{if(!h)return[];const e=new RegExp(Ue()(i),"i");return h.filter((t=>e.test(String(t.name))))}),[h,i]);return p?(0,d.jsx)(A.a,{size:"m"}):m||h&&h.length?(0,d.jsxs)("div",{className:Ut(),children:[(0,d.jsxs)("div",{className:Ut("controls"),children:[(0,d.jsx)(He.o,{onChange:e=>{o(e)},placeholder:Dt("controls.search"),className:Ut("search"),value:i}),v&&(0,d.jsx)(lt,{data:v})]}),m?(0,d.jsx)(R.V,{error:m}):null,h?(0,d.jsx)("div",{className:Ut("table-wrapper"),children:(0,d.jsx)("div",{className:Ut("table-content"),children:(0,d.jsx)(le.G,{columnsWidthLSKey:"consumersColumnsWidth",wrapperClassName:Ut("table"),data:g,columns:Bt,settings:x.LE,emptyDataMessage:Dt("table.emptyDataMessage")})})}):null]}):(0,d.jsx)("div",{children:Dt("noConsumersMessage.".concat(r?"stream":"topic"))})};var Vt=a(19797),Gt=a(83326),Zt=a.n(Gt),Wt=a(87555);const Jt=ue.h.injectEndpoints({endpoints:e=>({getDescribe:e.query({queryFn:async(e,t)=>{let{paths:a,database:n}=e,{signal:s}=t;try{const e=await Promise.all(a.map((e=>window.api.getDescribe({path:e,database:n},{signal:s}))));return{data:e.reduce(((e,t)=>(null!==t&&void 0!==t&&t.Path&&(e[t.Path]=t),e)),{})}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"});a(55895);const Kt=(0,c.cn)("ydb-describe"),Yt=new Map,Xt=e=>{let{path:t,database:a,type:n}=e;const[s]=(0,y.Rj)(),r=(0,he.St)(n),i=(0,y.ix)((e=>(0,g.eU)(e,t,n,a)),Wt.wU);let o=[];r?i&&(o=[t,...i]):o=[t];const{currentData:l,isFetching:c,error:u}=Jt.useGetDescribeQuery(o.length?{paths:o,database:a}:oe.CN,{pollingInterval:s}),m=c&&void 0===l,p=l;let h;if(p){const e=Object.keys(p);h=1===e.length?p[e[0]]:p}return m||r&&!i?(0,d.jsx)(A.a,{size:"m"}):h||u?(0,d.jsxs)("div",{className:Kt(),children:[u?(0,d.jsx)(R.V,{error:u}):null,h?(0,d.jsxs)("div",{className:Kt("result"),children:[(0,d.jsx)(Zt(),{data:h,className:Kt("tree"),onClick:e=>{let{path:t}=e;const a=!Yt.get(t);Yt.set(t,a)},searchOptions:{debounceTime:300},isExpanded:e=>Yt.get(e)||!1}),(0,d.jsx)(Vt.m,{view:"flat-secondary",text:JSON.stringify(h),className:Kt("copy")})]}):null]}):(0,d.jsx)("div",{className:Kt("message-container"),children:"Empty"})};var $t=a(62206);const ea=e=>{const{PathType:t,PathSubType:a}=(null===e||void 0===e?void 0:e.Self)||{};return(0,he.d)(t,a)},ta=e=>{var t;return null===e||void 0===e||null===(t=e.UserAttributes)||void 0===t?void 0:t.some((e=>{let{Key:t,Value:a}=e;return"__async_replica"===t&&"true"===a}))};var aa=a(31954),na=a(93849);const sa=(0,na.a)({values:{PathType:e=>null===e||void 0===e?void 0:e.substring("EPathType".length),CreateStep:_.o0},labels:{PathType:(0,aa.Z)("common.type"),CreateStep:(0,aa.Z)("common.created")}}),ra=e=>{let{value:t,withSpeedLabel:a,...n}=e;const s=(0,Ge.td)({value:t,withSpeedLabel:a,...n}),r=(0,Ge.td)({value:t,withSpeedLabel:a,size:"b"});return(0,d.jsx)("span",{title:r,children:s})},ia=(e,t)=>e?(0,d.jsx)(ra,{value:e,significantDigits:2,...t}):null,oa=(0,na.a)({values:{Type:e=>null===e||void 0===e?void 0:e.substring(10),State:e=>null===e||void 0===e?void 0:e.substring(11),KeyColumnNames:e=>null===e||void 0===e?void 0:e.join(", "),DataColumnNames:e=>null===e||void 0===e?void 0:e.join(", "),DataSize:ia},labels:{KeyColumnNames:"Columns",DataColumnNames:"Includes"}}),la={[Le.tB.METERING_MODE_REQUEST_UNITS]:"request-units",[Le.tB.METERING_MODE_RESERVED_CAPACITY]:"reserved-capacity"},ca=(0,na.a)({values:{Partitions:e=>(0,_.uf)((null===e||void 0===e?void 0:e.length)||0),PQTabletConfig:e=>{const t=Math.round(e.PartitionConfig.LifetimeSeconds/x.RQ*100)/100;return"".concat((0,_.uf)(t)," hours")}},labels:{Partitions:"Partitions count",PQTabletConfig:"Retention"}}),da=(0,na.a)({values:{Codecs:e=>e&&Object.values(e.Codecs||{}).join(", "),MeteringMode:e=>e&&la[e]},labels:{MeteringMode:"Metering mode"}}),ua=(0,na.a)({values:{StorageLimitBytes:_.td,WriteSpeedInBytesPerSecond:_.t$},labels:{StorageLimitBytes:"Retention storage",WriteSpeedInBytesPerSecond:"Partitions write speed"}}),ma=(0,na.a)({values:{Mode:e=>null===e||void 0===e?void 0:e.substring("ECdcStreamMode".length),Format:e=>null===e||void 0===e?void 0:e.substring("ECdcStreamFormat".length)}}),pa=(0,na.a)({values:{CPU:_.LO,Memory:ia,Storage:ia,Network:_.t$,ReadThroughput:_.t$,WriteThroughput:_.t$},defaultValueFormatter:_.uf}),ha=(0,na.a)({values:{FollowerCount:_.uf},labels:{FollowerCountPerDataCenter:"FollowerCountPerDC"},defaultValueFormatter:e=>e&&String(e)}),va=(0,na.a)({values:{FollowerCount:_.uf,CrossDataCenterFollowerCount:_.uf}}),ga=(0,na.a)({values:{DataSize:ia,IndexSize:ia,LastAccessTime:_.o0,LastUpdateTime:_.o0},defaultValueFormatter:_.uf}),xa=new Set(["Type","State","DataSize","KeyColumnNames","DataColumnNames"]),ya=e=>{var t;let{data:a}=e;const n=ea(null===a||void 0===a?void 0:a.PathDescription);if(!a)return(0,d.jsxs)("div",{className:"error",children:["No ",n," data"]});const s=null===(t=a.PathDescription)||void 0===t?void 0:t.TableIndex,r=[];let i;for(i in s)xa.has(i)&&r.push(oa(i,null===s||void 0===s?void 0:s[i]));return(0,d.jsx)($t._P,{title:n,info:r})},ba=ue.h.injectEndpoints({endpoints:e=>({getOverview:e.query({queryFn:async(e,t)=>{let{paths:a,database:n}=e,{signal:s}=t;try{const[e,...t]=await Promise.all(a.map((e=>window.api.getDescribe({path:e,database:n},{signal:s}))));return{data:{data:e,additionalData:t}}}catch(r){return{error:r}}},providesTags:["All"]})})});var fa=a(69214);const ja=JSON.parse('{"external-objects.source-type":"Source Type","external-objects.data-source":"Data Source","external-objects.location":"Location","external-objects.auth-method":"Auth Method","external-objects.auth-method.none":"None","external-objects.auth-method.service-account":"Service Account","view.query-text":"Query Text"}'),Na=(0,xe.wZ)("ydb-tenant-objects-info",{en:ja}),Sa=(0,c.cn)("ydb-external-data-source-info"),wa=e=>{var t,a,n,s;return[{label:Na("external-objects.source-type"),value:null===(t=e.PathDescription)||void 0===t||null===(a=t.ExternalDataSourceDescription)||void 0===a?void 0:a.SourceType},sa("CreateStep",null===(n=e.PathDescription)||void 0===n||null===(s=n.Self)||void 0===s?void 0:s.CreateStep)]},Ta=e=>{var t;const{Location:a,Auth:n}=(null===(t=e.PathDescription)||void 0===t?void 0:t.ExternalDataSourceDescription)||{};return[...wa(e),{label:Na("external-objects.location"),value:(0,d.jsx)(fa.A,{name:a,showStatus:!1,hasClipboardButton:!0,clipboardButtonAlwaysVisible:!0,className:Sa("location")})},{label:Na("external-objects.auth-method"),value:null!==n&&void 0!==n&&n.ServiceAccount?Na("external-objects.auth-method.service-account"):Na("external-objects.auth-method.none")}]},Ca=e=>{let{data:t,prepareData:a}=e;const n=ea(null===t||void 0===t?void 0:t.PathDescription);return t?(0,d.jsx)($t._P,{title:n,info:a(t)}):(0,d.jsxs)("div",{className:"error",children:["No ",n," data"]})},Ea=e=>{let{data:t}=e;return(0,d.jsx)(Ca,{data:t,prepareData:Ta})};var Pa=a(86974),Ia=a(32270);const Da=(0,c.cn)("ydb-external-table-info"),Ra=(e,t)=>{var a,n;const{CreateStep:s}=(null===(a=e.PathDescription)||void 0===a?void 0:a.Self)||{},{SourceType:r,DataSourcePath:i}=(null===(n=e.PathDescription)||void 0===n?void 0:n.ExternalTableDescription)||{},o=null===i||void 0===i?void 0:i.split("/").pop();return[{label:Na("external-objects.source-type"),value:r},sa("CreateStep",s),{label:Na("external-objects.data-source"),value:i&&(0,d.jsx)("span",{title:i,children:(0,d.jsx)(Ia.j,{title:o||"",url:t})})}]},Aa=(e,t)=>{var a,n;const s=null===(a=e.PathDescription)||void 0===a||null===(n=a.ExternalTableDescription)||void 0===n?void 0:n.Location;return[...Ra(e,t),{label:Na("external-objects.location"),value:(0,d.jsx)(fa.A,{name:s,showStatus:!1,hasClipboardButton:!0,clipboardButtonAlwaysVisible:!0,className:Da("location")})}]},ka=e=>{var t,a;let{data:n,prepareData:s}=e;const r=(0,Pa.TH)(),i=(0,E.mB)(r),o=(0,E.vF)({...i,schema:null===n||void 0===n||null===(t=n.PathDescription)||void 0===t||null===(a=t.ExternalTableDescription)||void 0===a?void 0:a.DataSourcePath}),l=ea(null===n||void 0===n?void 0:n.PathDescription);return n?(0,d.jsx)($t._P,{title:l,info:s(n,o)}):(0,d.jsxs)("div",{className:"error",children:["No ",l," data"]})},Oa=e=>{let{data:t}=e;return(0,d.jsx)(ka,{data:t,prepareData:Aa})};var _a=a(10288),Ma=a(55334);const La=JSON.parse('{"no-data":"No data"}'),za=(0,xe.wZ)("ydb-definition-list",{en:La}),qa=(0,c.cn)("ydb-definition-list");function Fa(e){let{title:t,items:a,nameMaxWidth:n=220,copyPosition:s="outside",className:r,itemClassName:i,...o}=e;return(0,d.jsxs)("div",{className:qa(null),children:[t?(0,d.jsx)("div",{className:qa("title"),children:t}):null,a.length?(0,d.jsx)(Ma.w,{items:a,nameMaxWidth:n,copyPosition:s,className:qa("properties-list",r),itemClassName:qa("item",i),...o}):za("no-data")]})}const Qa=e=>{var t,a;const n=null===(t=e.PathDescription)||void 0===t||null===(a=t.ViewDescription)||void 0===a?void 0:a.QueryText;return[{name:Na("view.query-text"),copyText:n,content:(0,d.jsx)(_a.x,{variant:"code-2",wordBreak:"break-word",children:n})}]};function Ba(e){let{data:t}=e;const a=ea(null===t||void 0===t?void 0:t.PathDescription);if(!t)return(0,d.jsxs)("div",{className:"error",children:["No ",a," data"]});const n=Qa(t);return(0,d.jsx)(Fa,{title:a,items:n})}var Ua=a(77796);function Ha(e){let{state:t}=e;return t?"StandBy"in t?(0,d.jsx)(ve._,{theme:"info",children:"Standby"}):"Paused"in t?(0,d.jsx)(ve._,{theme:"info",children:"Paused"}):"Done"in t?(0,d.jsx)(ve._,{theme:"success",children:"Done"}):"Error"in t?(0,d.jsx)(ve._,{theme:"danger",children:"Error"}):(0,d.jsx)(ve._,{size:"s",children:"Unknown"}):null}const Va=JSON.parse('{"column.dstPath.name":"Dist","column.srcPath.name":"Source","everythingWithPrefix":"Everything with prefix:","noData":"No data.","title":"Replicated Paths"}'),Ga=(0,xe.wZ)("ydb-diagnostics-async-replication-paths",{en:Va}),Za=(0,c.cn)("ydb-async-replication-paths"),Wa=[{name:Ga("column.srcPath.name"),render:e=>{let{row:t}=e;return t.SrcPath},sortAccessor:e=>e.SrcPath},{name:Ga("column.dstPath.name"),render:e=>{let{row:t}=e;return t.DstPath},sortAccessor:e=>e.DstPath}];function Ja(e){let{config:t}=e;if(!t)return null;let a=Ga("noData");var n,s;t.Everything&&(a=(0,d.jsxs)("span",{children:[Ga("everythingWithPrefix")," ",(0,d.jsx)(_a.x,{variant:"code-inline-2",children:null!==(n=null===(s=t.Everything)||void 0===s?void 0:s.DstPrefix)&&void 0!==n?n:"undefined"}),"."]}));return t.Specific&&(a=(0,d.jsx)(le.G,{data:t.Specific.Targets,settings:x.E6,columns:Wa})),(0,d.jsxs)("div",{className:Za(),children:[(0,d.jsx)("div",{className:Za("title"),children:Ga("title")}),a]})}function Ka(e){let{connection:t}=e;return t?t.StaticCredentials?(0,d.jsx)(ve._,{value:t.StaticCredentials.User,theme:"normal",children:"user"}):"OAuthToken"in t?"OAuth":"unknown":null}const Ya=JSON.parse('{"credentials.label":"Credentials","noData":"No data for entity:","srcConnection.database.label":"Source Database Path","srcConnection.endpoint.label":"Source Cluster Endpoint","state.label":"State"}'),Xa=(0,xe.wZ)("ydb-diagnostics-async-replication-info",{en:Ya});function $a(e){var t,a;let{data:n}=e;const s=ea(null===n||void 0===n?void 0:n.PathDescription);if(!n)return(0,d.jsxs)("div",{className:"error",children:[Xa("noData")," ",s]});const r=function(e){var t,a;const n=(null===(t=e.PathDescription)||void 0===t?void 0:t.ReplicationDescription)||{},s=n.State,r=(null===(a=n.Config)||void 0===a?void 0:a.SrcConnectionParams)||{},{Endpoint:i,Database:o}=r,l=[];s&&l.push({name:Xa("state.label"),content:(0,d.jsx)(Ha,{state:s})});i&&l.push({name:Xa("srcConnection.endpoint.label"),copyText:i,content:(0,d.jsx)(_a.x,{variant:"code-inline-2",children:i})});o&&l.push({name:Xa("srcConnection.database.label"),copyText:o,content:(0,d.jsx)(_a.x,{variant:"code-inline-2",children:o})});r&&l.push({name:Xa("credentials.label"),content:(0,d.jsx)(Ka,{connection:r})});return l}(n);return(0,d.jsxs)(Ua.k,{direction:"column",gap:"4",children:[(0,d.jsx)(Fa,{title:s,items:r}),(0,d.jsx)(Ja,{config:null===(t=n.PathDescription)||void 0===t||null===(a=t.ReplicationDescription)||void 0===a?void 0:a.Config})]})}const en=JSON.parse('{"writeLagPopover":"Write lag, maximum among all topic partitions","writeIdleTimePopover":"Write idle time, maximum among all topic partitions"}'),tn=JSON.parse('{"writeLagPopover":"\u041b\u0430\u0433 \u0437\u0430\u043f\u0438\u0441\u0438, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0442\u043e\u043f\u0438\u043a\u0430","writeIdleTimePopover":"\u0412\u0440\u0435\u043c\u044f \u0431\u0435\u0437 \u0437\u0430\u043f\u0438\u0441\u0438, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0442\u043e\u043f\u0438\u043a\u0430"}'),an=(0,xe.wZ)("ydb-diagnostics-overview-topic-stats",{ru:tn,en:en}),nn=(0,c.cn)("ydb-overview-topic-stats"),sn=e=>[{label:"Store size",value:(0,_.td)(e.storeSize)},{label:(0,d.jsx)(pt,{text:"Write idle time",popoverContent:(0,d.jsx)(Et,{text:an("writeIdleTimePopover"),type:"write"})}),value:(0,Ze.tt)(e.partitionsIdleTime)},{label:(0,d.jsx)(pt,{text:"Write lag",popoverContent:(0,d.jsx)(Et,{text:an("writeLagPopover"),type:"write"})}),value:(0,Ze.tt)(e.partitionsWriteLag)},{label:"Average write speed",value:(0,d.jsx)(it,{data:e.writeSpeed,withValue:!1})}],rn=e=>{const t=e.writeSpeed;return[{label:"per minute",value:(0,_.t$)(t.perMinute)},{label:"per hour",value:(0,_.t$)(t.perHour)},{label:"per day",value:(0,_.t$)(t.perDay)}]},on=e=>{let{path:t,database:a}=e;const[s]=(0,y.Rj)(),{currentData:r,isFetching:i,error:o}=We.useGetTopicQuery({path:t,database:a},{pollingInterval:s}),l=i&&void 0===r,c=(0,y.ix)((e=>$e(e,t,a)));if(l)return(0,d.jsx)("div",{className:nn(),children:(0,d.jsx)(A.a,{size:"s"})});const u=o||!c?(0,d.jsx)(R.V,{error:o}):null;return(0,d.jsxs)("div",{className:nn(),children:[(0,d.jsx)("div",{className:nn("title"),children:"Stats"}),u,c?(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:nn("info"),children:(0,d.jsx)($t._P,{info:sn(c),multilineLabels:!0})}),(0,d.jsx)("div",{className:nn("bytes-written"),children:(0,d.jsx)($t._P,{info:rn(c)})})]}):null]})},ln=e=>{var t;const a=null===e||void 0===e||null===(t=e.PathDescription)||void 0===t?void 0:t.PersQueueGroup;if(!a)return[];const{Partitions:n=[],PQTabletConfig:s={PartitionConfig:{LifetimeSeconds:0}}}=a,{Codecs:r,MeteringMode:i}=s,{WriteSpeedInBytesPerSecond:o,StorageLimitBytes:l}=s.PartitionConfig;return[...(0,$t.Z6)(ca,{Partitions:n,PQTabletConfig:s}),...(0,$t.Z6)(ua,{StorageLimitBytes:l,WriteSpeedInBytesPerSecond:o}),...(0,$t.Z6)(da,{Codecs:r,MeteringMode:i})]},cn=(e,t)=>{var a,n,s;if(!e&&!t)return[];const r=null===e||void 0===e||null===(a=e.PathDescription)||void 0===a?void 0:a.CdcStreamDescription,{Mode:i,Format:o}=r||{};return[sa("CreateStep",null===e||void 0===e||null===(n=e.PathDescription)||void 0===n||null===(s=n.Self)||void 0===s?void 0:s.CreateStep),...(0,$t.Z6)(ma,{Mode:i,Format:o}),...ln(t)]},dn=e=>{let{path:t,database:a,data:n,topic:s}=e;const r=ea(null===n||void 0===n?void 0:n.PathDescription);return n&&s?(0,d.jsxs)("div",{children:[(0,d.jsx)($t._P,{title:r,info:cn(n,s)}),(0,d.jsx)(on,{path:t,database:a})]}):(0,d.jsxs)("div",{className:"error",children:["No ",r," data"]})},un=JSON.parse('{"page.title":"Database","pages.query":"Query","pages.diagnostics":"Diagnostics","summary.navigation":"Navigation","summary.showPreview":"Show preview","summary.source-type":"Source Type","summary.data-source":"Data Source","summary.copySchemaPath":"Copy schema path","summary.type":"Type","summary.subtype":"SubType","summary.id":"Id","summary.version":"Version","summary.created":"Created","summary.data-size":"Data size","summary.row-count":"Row count","summary.partitions":"Partitions count","summary.paths":"Paths","summary.shards":"Shards","summary.state":"State","summary.mode":"Mode","summary.format":"Format","summary.retention":"Retention","label.read-only":"ReadOnly","actions.copied":"The path is copied to the clipboard","actions.notCopied":"Couldn\u2019t copy the path","actions.copyPath":"Copy path","actions.openPreview":"Open preview","actions.createTable":"Create table...","actions.createExternalTable":"Create external table...","actions.createTopic":"Create topic...","actions.createColumnTable":"Create column table...","actions.createAsyncReplication":"Create async replication...","actions.createView":"Create view...","actions.dropTable":"Drop table...","actions.dropTopic":"Drop topic...","actions.dropView":"Drop view...","actions.alterTable":"Alter table...","actions.alterTopic":"Alter topic...","actions.selectQuery":"Select query...","actions.upsertQuery":"Upsert query...","actions.alterReplication":"Alter async replicaton...","actions.dropReplication":"Drop async replicaton...","actions.createDirectory":"Create directory","schema.tree.dialog.placeholder":"Relative path","schema.tree.dialog.invalid":"Invalid path","schema.tree.dialog.whitespace":"Whitespace is not allowed","schema.tree.dialog.empty":"Path is empty","schema.tree.dialog.header":"Create directory","schema.tree.dialog.description":"Inside","schema.tree.dialog.buttonCancel":"Cancel","schema.tree.dialog.buttonApply":"Create"}'),mn=(0,xe.wZ)("ydb-tenant",{en:un});function pn(e){let{data:t}=e;const a=ea(t);return ta(t)?(0,d.jsxs)(Ua.k,{gap:1,wrap:"nowrap",children:[a," ",(0,d.jsx)(ve._,{children:mn("label.read-only")})]}):a}const hn=JSON.parse('{"tableStats":"Table Stats","tabletMetrics":"Tablet Metrics","partitionConfig":"Partition Config","label.ttl":"TTL for rows","value.ttl":"column: \'{{columnName}}\', expire after: {{expireTime}}","label.standalone":"Standalone","label.partitioning":"Partitioning","label.partitioning-by-size":"Partitioning by size","value.partitioning-by-size.enabled":"Enabled, split size: {{size}}","label.partitioning-by-load":"Partitioning by load","label.partitions-min":"Min number of partitions","label.partitions-max":"Max number of partitions","label.read-replicas":"Read replicas (followers)","label.bloom-filter":"Bloom filter","enabled":"Enabled","disabled":"Disabled"}'),vn=(0,xe.wZ)("ydb-diagnostics-overview-table-info",{en:hn});var gn=a(87863),xn=a.n(gn),yn=a(5922),bn=a(55850);const fn=e=>e.SchemaPresetName&&void 0!==e.SchemaPresetId,jn=e=>{if(e.Enabled&&e.Enabled.ColumnName&&void 0!==e.Enabled.ExpireAfterSeconds){const t=vn("value.ttl",{columnName:e.Enabled.ColumnName,expireTime:(0,Ze.tt)(1e3*e.Enabled.ExpireAfterSeconds,1)});return{label:vn("label.ttl"),value:t}}};const Nn=(e,t)=>{if(!e)return{};const{PathDescription:a={}}=e,{TableStats:n={},TabletMetrics:s={},Table:{PartitionConfig:r={},TTLSettings:i}={},ColumnTableDescription:o={}}=a,{PartCount:l,RowCount:c,DataSize:u,IndexSize:m,ByKeyFilterSize:p,LastAccessTime:h,LastUpdateTime:v,ImmediateTxCompleted:g,PlannedTxCompleted:x,TxRejectedByOverload:y,TxRejectedBySpace:b,TxCompleteLagMsec:f,InFlightTxCount:j,RowUpdates:N,RowDeletes:S,RowReads:w,RangeReads:T,RangeReadRows:C}=n,{FollowerGroups:E,FollowerCount:P,CrossDataCenterFollowerCount:I}=r;let D=[];switch(t){case Le.gb.EPathTypeTable:D=((e,t)=>{var a;const{PartitioningPolicy:n={},FollowerGroups:s,EnableFilterByKey:r}=e,i=[],o=n.SizeToSplit&&Number(n.SizeToSplit)>0?vn("value.partitioning-by-size.enabled",{size:(0,_.td)(n.SizeToSplit)}):vn("disabled"),l=null!==(a=n.SplitByLoadSettings)&&void 0!==a&&a.Enabled?vn("enabled"):vn("disabled");if(i.push({label:vn("label.partitioning-by-size"),value:o},{label:vn("label.partitioning-by-load"),value:l},{label:vn("label.partitions-min"),value:(0,_.uf)(n.MinPartitionsCount||0)}),n.MaxPartitionsCount&&i.push({label:vn("label.partitions-max"),value:(0,_.uf)(n.MaxPartitionsCount)}),s&&s.length){const{RequireAllDataCenters:e,FollowerCountPerDataCenter:t,FollowerCount:a}=s[0];let n;n=e&&t?"PER_AZ: ".concat(a):"ANY_AZ: ".concat(a),i.push({label:vn("label.read-replicas"),value:n})}if(t){const e=jn(t);e&&i.push(e)}return(0,yn.D)(r)&&i.push({label:vn("label.bloom-filter"),value:vn(r?"enabled":"disabled")}),i})(r,i);break;case Le.gb.EPathTypeColumnTable:D=function(e){var t,a;const n=[];if(n.push({label:vn("label.standalone"),value:String(!fn(e))}),null!==(t=e.Sharding)&&void 0!==t&&null!==(a=t.HashSharding)&&void 0!==a&&a.Columns){const t=e.Sharding.HashSharding.Columns.join(", "),a="PARTITION BY HASH(".concat(t,")");n.push({label:vn("label.partitioning"),value:(0,d.jsx)(_a.x,{variant:"code-2",wordBreak:"break-word",children:a})})}if(e.TtlSettings){const t=jn(null===e||void 0===e?void 0:e.TtlSettings);t&&n.push(t)}return n}(o)}const R=(0,$t.Z6)(ga,{PartCount:l,RowCount:c,DataSize:u,IndexSize:m});(0,bn.kE)(p)&&(r.EnableFilterByKey||Number(p)>0)&&R.push({label:"BloomFilterSize",value:ia(p)});const A=[R,(0,$t.Z6)(ga,{LastAccessTime:h,LastUpdateTime:v}),(0,$t.Z6)(ga,{ImmediateTxCompleted:g,PlannedTxCompleted:x,TxRejectedByOverload:y,TxRejectedBySpace:b,TxCompleteLagMsec:f,InFlightTxCount:j}),(0,$t.Z6)(ga,{RowUpdates:N,RowDeletes:S,RowReads:w,RangeReads:T,RangeReadRows:C})],k=(0,$t.Z6)(pa,xn()(s,["GroupReadIops","GroupReadThroughput","GroupWriteIops","GroupWriteThroughput"]));let O=[];return Array.isArray(E)&&E.length>0?O=(0,$t.Z6)(ha,E[0]):void 0!==P?O.push(va("FollowerCount",P)):void 0!==I&&O.push(va("CrossDataCenterFollowerCount",I)),{generalInfo:D,tableStatsInfo:A,tabletMetricsInfo:k,partitionConfigInfo:O}},Sn=(0,c.cn)("ydb-diagnostics-table-info"),wn=e=>{let{data:t,type:a}=e;const s=(0,d.jsx)(pn,{data:null===t||void 0===t?void 0:t.PathDescription}),{generalInfo:r,tableStatsInfo:i,tabletMetricsInfo:o=[],partitionConfigInfo:l=[]}=n.useMemo((()=>Nn(t,a)),[t,a]);return(0,d.jsxs)("div",{className:Sn(),children:[(0,d.jsx)($t._P,{info:r,title:s,className:Sn("info-block"),renderEmptyState:()=>(0,d.jsx)("div",{className:Sn("title"),children:s})}),(0,d.jsxs)("div",{className:Sn("row"),children:[i?(0,d.jsx)("div",{className:Sn("col"),children:i.map(((e,t)=>(0,d.jsx)($t._P,{info:e,title:0===t?vn("tableStats"):void 0,className:Sn("info-block"),renderEmptyState:()=>null},t)))}):null,o.length>0||l.length>0?(0,d.jsxs)("div",{className:Sn("col"),children:[(0,d.jsx)($t._P,{info:o,title:vn("tabletMetrics"),className:Sn("info-block"),renderEmptyState:()=>null}),(0,d.jsx)($t._P,{info:l,title:vn("partitionConfig"),className:Sn("info-block"),renderEmptyState:()=>null})]}):null]})]})},Tn=e=>{let{data:t,path:a,database:n}=e;const s=ea(null===t||void 0===t?void 0:t.PathDescription);return t?(0,d.jsxs)("div",{children:[(0,d.jsx)($t._P,{title:s,info:ln(t)}),(0,d.jsx)(on,{path:a,database:n})]}):(0,d.jsxs)("div",{className:"error",children:["No ",s," data"]})};const Cn=function(e){let{type:t,path:a,database:s}=e;const[r]=(0,y.Rj)(),i=(0,he.St)(t),o=(0,y.ix)((e=>(0,g.eU)(e,a,t,s)),Wt.wU);let l=[];i?o&&(l=[a,...o]):l=[a];const{currentData:c,isFetching:u,error:m}=ba.useGetOverviewQuery(l.length?{paths:l,database:s}:oe.CN,{pollingInterval:r}),p=u&&void 0===c,{data:h,additionalData:v}=c||{},{error:x}=(0,g.hz)({path:a,database:s});return p||i&&!o?(0,d.jsx)(A.a,{size:"m"}):(0,d.jsxs)(n.Fragment,{children:[x?(0,d.jsx)(R.V,{error:x}):null,m?(0,d.jsx)(R.V,{error:m}):null,m&&!h?null:(()=>{var e;const n=null!==h&&void 0!==h?h:void 0,r={[Le.gb.EPathTypeInvalid]:void 0,[Le.gb.EPathTypeDir]:void 0,[Le.gb.EPathTypeTable]:void 0,[Le.gb.EPathTypeSubDomain]:void 0,[Le.gb.EPathTypeTableIndex]:()=>(0,d.jsx)(ya,{data:n}),[Le.gb.EPathTypeExtSubDomain]:void 0,[Le.gb.EPathTypeColumnStore]:void 0,[Le.gb.EPathTypeColumnTable]:void 0,[Le.gb.EPathTypeCdcStream]:()=>{var e;return(0,d.jsx)(dn,{path:a,database:s,data:n,topic:null!==(e=null===v||void 0===v?void 0:v[0])&&void 0!==e?e:void 0})},[Le.gb.EPathTypePersQueueGroup]:()=>(0,d.jsx)(Tn,{data:n,path:a,database:s}),[Le.gb.EPathTypeExternalTable]:()=>(0,d.jsx)(Oa,{data:n}),[Le.gb.EPathTypeExternalDataSource]:()=>(0,d.jsx)(Ea,{data:n}),[Le.gb.EPathTypeView]:()=>(0,d.jsx)(Ba,{data:n}),[Le.gb.EPathTypeReplication]:()=>(0,d.jsx)($a,{data:n})};return t&&(null===(e=r[t])||void 0===e?void 0:e.call(r))||(0,d.jsx)(wn,{data:n,type:t})})()]})};var En=a(2982),Pn=a(49687),In=a(8978),Dn=a(95280),Rn=a(67141),An=a(39633);const kn=["#7EB26D","#EAB839","#6ED0E0","#EF843C","#E24D42","#1F78C1","#BA43A9","#705DA0","#508642","#CCA300"];const On=e=>{switch(e){case"ms":return _n;case"size":return Mn;case"percent":return Ln;default:return}};function _n(e){return null===e?x.jX:(0,Ze.zm)((0,_.W0)(zn(e),2))}function Mn(e){return null===e?x.jX:(0,Ge.td)({value:zn(e),precision:3})}function Ln(e){return null===e?x.jX:Math.round(100*zn(e))+"%"}function zn(e){return(0,bn.kE)(e)?Number(e):0}const qn={"30m":30*x.sU,"1h":x.RQ,"1d":x.ii,"1w":7*x.ii},Fn=JSON.parse('{"not-supported":"Charts are not supported on current ydb version"}'),Qn=(0,xe.wZ)("ydb-metric-chart",{en:Fn}),Bn=ue.h.injectEndpoints({endpoints:e=>({getChartData:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await async function(e){let{database:t,metrics:a,timeFrame:n,maxDataPoints:s}=e,{signal:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=a.map((e=>"target=".concat(e.target))).join("&"),o=Math.round(Date.now()/1e3),l=o-qn[n];return window.api.getChartData({target:i,from:l,until:o,maxDataPoints:s,database:t},{signal:r})}(e,{signal:a});if(Array.isArray(t)){const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const a=e.map((e=>{let{datapoints:a,target:n}=e;const s=t.find((e=>e.target===n));if(!s)return;const r=a.map((e=>e[0]));return{...s,data:r}})).filter((e=>void 0!==e));return{timeline:e[0].datapoints.map((e=>1e3*e[1])),metrics:a}}(t,e.metrics);return{data:a}}return{error:new Error("string"===typeof t?Qn("not-supported"):t.error)}}catch(n){return{error:n}}},providesTags:["All"],keepUnusedDataFor:0})}),overrideExisting:"throw"}),Un=(0,c.cn)("ydb-metric-chart");In.X.set({plugins:[Rn.YagrPlugin]});const Hn=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{dataType:a,scaleRange:n}=t,s=On(a),r=!e.metrics.length,i=e.metrics.map(((e,t)=>{const a=e.color||kn[t],n=function(e,t){const a=(0,An.Vi)(e);if(!a.isValid())throw new Error("Invalid color is passed");return a.alpha(t).toRgbString()}(a,.1);return{id:e.target,name:e.title||e.target,data:e.data,formatter:s,lineColor:a,color:n,legendColorKey:"lineColor"}}));return{data:{timeline:e.timeline,graphs:i},libraryConfig:{chart:{size:{padding:r?[10,0,10,0]:void 0},series:{type:"area",spanGaps:!0,lineWidth:1.5},select:{zoom:!1}},scales:{y:{type:"linear",range:"nice",min:(null===n||void 0===n?void 0:n.min)||0,max:null===n||void 0===n?void 0:n.max}},axes:{y:{values:s?(e,t)=>t.map(s):void 0}},tooltip:{show:!0,tracking:"sticky"}}}},Vn={timeline:[],metrics:[]},Gn=e=>{let{database:t,title:a,metrics:s,timeFrame:r="1h",autorefresh:i,width:o=400,height:l=o/1.5,chartOptions:c,onChartDataStatusChange:u,isChartVisible:m}=e;const{currentData:p,error:h,isFetching:v,status:g}=Bn.useGetChartDataQuery({database:t,metrics:s,timeFrame:r,maxDataPoints:o/2},{pollingInterval:i}),x=v&&!p;n.useEffect((()=>null===u||void 0===u?void 0:u("fulfilled"===g?"success":"loading")),[g,u]);const y=Hn(p||Vn,c);return(0,d.jsxs)("div",{className:Un(null),style:{height:l,width:o},children:[(0,d.jsx)("div",{className:Un("title"),children:a}),x?(0,d.jsx)(A.a,{}):m?(0,d.jsxs)("div",{className:Un("chart"),children:[(0,d.jsx)(Dn.ZP,{type:"yagr",data:y}),h?(0,d.jsx)(R.V,{className:Un("error"),error:h}):null]}):null]})};var Zn=a(17176);const Wn=(0,c.cn)("ydb-timeframe-selector"),Jn=e=>{let{value:t,onChange:a,className:n}=e;return(0,d.jsx)("div",{className:Wn(null,n),children:Object.keys(qn).map((e=>(0,d.jsx)(Zn.z,{view:"flat",selected:t===e,onClick:()=>a(e),children:e},e)))})},Kn=(0,c.cn)("ydb-tenant-dashboard"),Yn=e=>{let{database:t,charts:a}=e;const[s,i]=n.useState(!0),[o="1h",l]=(0,r.useQueryParam)("timeframe",r.StringParam),[c]=(0,y.Rj)(),u=s?0:c,m=e=>{"success"===e&&i(!1)},p=1===a.length?872:428;return(0,d.jsxs)("div",{className:Kn(null),style:{display:s?"none":void 0},children:[(0,d.jsx)("div",{className:Kn("controls"),children:(0,d.jsx)(Jn,{value:o,onChange:l})}),(0,d.jsx)("div",{className:Kn("charts"),children:a.map((e=>{const a=e.metrics.map((e=>{let{target:t}=e;return t})).join("&");return(0,d.jsx)(Gn,{database:t,title:e.title,metrics:e.metrics,timeFrame:o,chartOptions:e.options,autorefresh:u,width:p,height:285.3333333333333,onChartDataStatusChange:m,isChartVisible:!s},a)}))})]})},Xn=JSON.parse('{"no-data":"No data","no-pools-data":"No pools data","top-nodes.empty-data":"No such nodes","top-groups.empty-data":"No such groups","top":"Top","nodes":"nodes","shards":"shards","groups":"groups","queries":"queries","tables":"tables","by-pools-usage":"by pools usage","by-cpu-time":"by cpu time, {{executionPeriod}}","by-cpu-usage":"by cpu usage","by-load":"by load","by-memory":"by memory","by-usage":"by usage","by-size":"by size","cards.cpu-label":"CPU","cards.storage-label":"Storage","cards.memory-label":"Memory","charts.queries-per-second":"Queries per second","charts.transaction-latency":"Transactions latencies {{percentile}}","charts.cpu-usage":"CPU usage by pool","charts.storage-usage":"Tablet storage usage","charts.memory-usage":"Memory usage","storage.tablet-storage-title":"Tablet storage","storage.tablet-storage-description":"Size of user data and indexes stored in schema objects (tables, topics, etc.)","storage.db-storage-title":"Database storage","storage.db-storage-description":"Size of data stored in distributed storage with all overheads for redundancy","executed-last-hour":"executed in the last hour"}'),$n=(0,xe.wZ)("ydb-diagnostics-tenant-overview",{en:Xn}),es=[{title:$n("charts.queries-per-second"),metrics:[{target:"queries.requests",title:$n("charts.queries-per-second")}]},{title:$n("charts.transaction-latency",{percentile:""}),metrics:[{target:"queries.latencies.p50",title:$n("charts.transaction-latency",{percentile:"p50"})},{target:"queries.latencies.p75",title:$n("charts.transaction-latency",{percentile:"p75"})},{target:"queries.latencies.p90",title:$n("charts.transaction-latency",{percentile:"p90"})},{target:"queries.latencies.p99",title:$n("charts.transaction-latency",{percentile:"p99"})}],options:{dataType:"ms"}}],ts=e=>{let{database:t}=e;return(0,d.jsx)(Yn,{database:t,charts:es})},as=ue.h.injectEndpoints({endpoints:e=>({getHealthcheckInfo:e.query({queryFn:async(e,t)=>{let{database:a,maxLevel:n}=e,{signal:s}=t;try{return{data:await window.api.getHealthcheckInfo({database:a,maxLevel:n},{signal:s})}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"}),ns={RED:0,ORANGE:1,YELLOW:2,BLUE:3,GREEN:4},ss=e=>e.sort(((e,t)=>(ns[e.status]||0)-(ns[t.status]||0))),rs=e=>{let{issue:t,data:a}=e;return ss(a.filter((e=>t.reason&&-1!==t.reason.indexOf(e.id))))},is=e=>ss(e.filter((t=>!e.find((e=>e.reason&&-1!==e.reason.indexOf(t.id)))))),os=e=>{let{data:t,roots:a}=e;return a?a.map((e=>{const a=os({roots:rs({issue:e,data:t}),data:t});return{...e,reasonsItems:a}})):[]},ls=e=>{const t={};for(const a of e)t[a.status]||(t[a.status]=0),t[a.status]++;return Object.entries(t).sort(((e,t)=>{let[a]=e,[n]=t;return(ns[a]||0)-(ns[n]||0)}))},cs=(0,Ve.P1)((e=>e),(e=>as.endpoints.getHealthcheckInfo.select({database:e}))),ds=(0,Ve.P1)((e=>e),((e,t)=>cs(t)),((e,t)=>{var a;return(null===(a=t(e).data)||void 0===a?void 0:a.issue_log)||[]})),us=(0,Ve.P1)(ds,(function(){return is(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])})),ms=(0,Ve.P1)([ds,us],(function(){return os({data:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],roots:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]})})),ps=(0,Ve.P1)(ds,(function(){return ls(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])}));let hs,vs;!function(e){e.UNSPECIFIED="UNSPECIFIED",e.GOOD="GOOD",e.DEGRADED="DEGRADED",e.MAINTENANCE_REQUIRED="MAINTENANCE_REQUIRED",e.EMERGENCY="EMERGENCY"}(hs||(hs={})),function(e){e.UNSPECIFIED="UNSPECIFIED",e.GREY="GREY",e.GREEN="GREEN",e.BLUE="BLUE",e.YELLOW="YELLOW",e.ORANGE="ORANGE",e.RED="RED"}(vs||(vs={}));const gs=function(e){let{autorefresh:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{currentData:a,isFetching:n,error:s,refetch:r}=as.useGetHealthcheckInfoQuery({database:e},{pollingInterval:t}),i=(null===a||void 0===a?void 0:a.self_check_result)||hs.UNSPECIFIED,o=(0,y.ix)((t=>ps(t,e)));return{issueTrees:(0,y.ix)((t=>ms(t,e))),issuesStatistics:o,loading:void 0===a&&n,error:s,refetch:r,selfCheckResult:i}};var xs=a(40067),ys=a(75850);const bs={[vs.UNSPECIFIED]:ys.K.Grey,[vs.GREY]:ys.K.Grey,[vs.GREEN]:ys.K.Green,[vs.BLUE]:ys.K.Blue,[vs.YELLOW]:ys.K.Yellow,[vs.ORANGE]:ys.K.Orange,[vs.RED]:ys.K.Red},fs=(0,c.cn)("issue-tree-item"),js=e=>{let{status:t,message:a,type:n,onClick:s}=e;return(0,d.jsxs)("div",{className:fs(),onClick:s,children:[(0,d.jsx)("div",{className:fs("field",{status:!0}),children:(0,d.jsx)(fa.A,{mode:"icons",status:t,name:n})}),(0,d.jsx)("div",{className:fs("field",{message:!0}),children:a})]})},Ns=(0,c.cn)("issue-tree"),Ss=e=>{let{issueTree:t}=e;const[a,s]=n.useState({}),r=n.useCallback((e=>e?(0,d.jsx)("div",{className:Ns("info-panel"),children:(0,d.jsx)(Zt(),{data:e,search:!1,isExpanded:()=>!0,className:Ns("inspector")})}):null),[]),i=n.useCallback((e=>e.map((e=>{const{id:t}=e,{status:n,message:o,type:l,reasonsItems:c,level:u,...m}=e,p="undefined"===typeof a[t]||a[t],h=()=>{s((e=>({...e,[t]:!p})))};return(0,d.jsxs)(xs.L,{name:(0,d.jsx)(js,{status:bs[n],message:o,type:l}),collapsed:p,hasArrow:!0,onClick:h,onArrowClick:h,level:u-1,children:[r(xn()(m,["reason"])),i(c||[])]},t)}))),[a,r]);return(0,d.jsx)("div",{className:Ns(),children:(0,d.jsx)("div",{className:Ns("block"),children:i([t])})})},ws=JSON.parse('{"title.healthcheck":"Healthcheck","label.update":"Update","label.show-details":"Show details","label.issues":"Issues:","status_message.ok":"No issues","no-data":"no healthcheck data"}'),Ts=JSON.parse('{"title.healthcheck":"Healthcheck","label.update":"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c","label.show-details":"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0441\u0442\u0438","label.issues":"\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u044b:","status_message.ok":"\u041d\u0435\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c","no-data":"\u043d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 healthcheck"}'),Cs=(0,xe.wZ)("ydb-diagnostics-healthcheck",{ru:Ts,en:ws}),Es=(0,c.cn)("healthcheck");function Ps(e){let{tenantName:t}=e;const[a]=(0,y.Rj)(),{issueTrees:s,loading:r,error:i}=gs(t,{autorefresh:a});return(0,d.jsx)("div",{className:Es("details"),children:(0,d.jsx)("div",{className:Es("details-content-wrapper"),children:i?(0,d.jsx)(R.V,{error:i,defaultMessage:Cs("no-data")}):r?(0,d.jsx)(A.a,{size:"m"}):s&&s.length?(0,d.jsx)(n.Fragment,{children:s.map((e=>(0,d.jsx)(Ss,{issueTree:e},e.id)))}):Cs("status_message.ok")})})}var Is=a(35240),Ds=a(32257),Rs=a(96261),As=a(68010),ks=a(80518),Os=a(71586),_s=a(88776);const Ms=(0,c.cn)("ydb-diagnostic-card");function Ls(e){let{children:t,className:a,active:n}=e;return(0,d.jsx)("div",{className:Ms({active:n},a),children:t})}const zs=(0,c.cn)("healthcheck"),qs={[hs.UNSPECIFIED]:Ds.Z,[hs.GOOD]:Rs.Z,[hs.DEGRADED]:As.Z,[hs.MAINTENANCE_REQUIRED]:ks.Z,[hs.EMERGENCY]:Os.Z};function Fs(e){const{tenantName:t,active:a}=e,[n]=(0,y.Rj)(),{currentData:s,isFetching:r,error:i}=as.useGetHealthcheckInfoQuery({database:t},{pollingInterval:n}),o=r&&void 0===s;return(0,d.jsxs)(Ls,{className:zs("preview"),active:a,children:[(0,d.jsx)("div",{className:zs("preview-header"),children:(0,d.jsx)("div",{className:zs("preview-title-wrapper"),children:(0,d.jsx)("div",{className:zs("preview-title"),children:Cs("title.healthcheck")})})}),(()=>{if(i)return(0,d.jsx)(R.V,{error:i,defaultMessage:Cs("no-data")});if(o)return(0,d.jsx)(A.a,{size:"m"});const e=(null===s||void 0===s?void 0:s.self_check_result)||hs.UNSPECIFIED,t=e.toLowerCase();return(0,d.jsx)("div",{className:zs("preview-content"),children:(0,d.jsxs)("div",{className:zs("preview-issue",{[t]:!0}),children:[(0,d.jsx)(_s.J,{className:zs("preview-status-icon"),data:qs[e]}),(0,d.jsx)("div",{className:zs("self-check-status-indicator"),children:e.replace(/_/g," ")})]})})})()]})}var Qs=a(67359),Bs=a(98366);const Us=(0,c.cn)("ydb-metrics-card"),Hs=e=>{let t;return"Warning"===e&&(t=ys.K.Yellow),"Danger"===e&&(t=ys.K.Red),t?(0,d.jsx)(Bs.J,{status:t,mode:"icons",size:"l"}):null};function Vs(e){let{active:t,label:a,status:n,metrics:s}=e;return(0,d.jsxs)(Ls,{className:Us({active:t}),active:t,children:[(0,d.jsxs)("div",{className:Us("header"),children:[a&&(0,d.jsx)("div",{className:Us("label"),children:a}),Hs(n)]}),(0,d.jsx)("div",{className:Us("content"),children:s.map(((e,t)=>{let{title:a,...n}=e;return(0,d.jsxs)("div",{className:Us("metric"),children:[(0,d.jsx)("div",{className:Us("metric-title"),children:a}),(0,d.jsx)(Qs.y,{size:"xs",colorizeProgress:!0,...n})]},t)}))})]})}const Gs=(0,c.cn)("metrics-cards");function Zs(e){let{poolsCpuStats:t,memoryStats:a,blobStorageStats:n,tabletStorageStats:s,tenantName:r}=e;const i=(0,Pa.TH)(),{metricsTab:o}=(0,y.ix)((e=>e.tenant)),l=(0,E.mB)(i),c=e=>e===o?"":e,u={[S.Xk.cpu]:(0,Qe.Sj)({...l,[Qe.XV.metricsTab]:c(S.Xk.cpu)}),[S.Xk.storage]:(0,Qe.Sj)({...l,[Qe.XV.metricsTab]:c(S.Xk.storage)}),[S.Xk.memory]:(0,Qe.Sj)({...l,[Qe.XV.metricsTab]:c(S.Xk.memory)}),[S.Xk.healthcheck]:(0,Qe.Sj)({...l,[Qe.XV.metricsTab]:c(S.Xk.healthcheck)})};return(0,d.jsxs)("div",{className:Gs(),children:[(0,d.jsx)(T.rU,{to:u.cpu,className:Gs("tab"),children:(0,d.jsx)(Ws,{poolsCpuStats:t,active:o===S.Xk.cpu})}),(0,d.jsx)(T.rU,{to:u.storage,className:Gs("tab"),children:(0,d.jsx)(Js,{blobStorageStats:n,tabletStorageStats:s,active:o===S.Xk.storage})}),(0,d.jsx)(T.rU,{to:u.memory,className:Gs("tab"),children:(0,d.jsx)(Ks,{memoryStats:a,active:o===S.Xk.memory})}),(0,d.jsx)(T.rU,{to:u.healthcheck,className:Gs("tab"),children:(0,d.jsx)(Fs,{tenantName:r,active:o===S.Xk.healthcheck})})]})}function Ws(e){let{poolsCpuStats:t=[],active:a}=e,n=Is.L.Unspecified;const s=t.filter((e=>!("Batch"===e.name||"IO"===e.name))).map((e=>{const{name:t,usage:a,limit:s,used:r}=e,i=(0,Pn.Vn)(a);return Is.l[i]>Is.l[n]&&(n=i),{title:t,value:r,capacity:s,warningThreshold:Pn.hJ,dangerThreshold:Pn.Gz}}));return(0,d.jsx)(Vs,{label:$n("cards.cpu-label"),active:a,metrics:s,status:n})}function Js(e){let{blobStorageStats:t=[],tabletStorageStats:a,active:n}=e,s=Is.L.Unspecified;const r=(a||t).map((e=>{const{name:t,used:a,limit:n,usage:r}=e,i=(0,Pn._W)(r);return Is.l[i]>Is.l[s]&&(s=i),{title:t,value:a,capacity:n,warningThreshold:Pn._g,dangerThreshold:Pn.nD,formatValues:_.QO}}));return(0,d.jsx)(Vs,{label:$n("cards.storage-label"),active:n,metrics:r,status:s})}function Ks(e){let{active:t,memoryStats:a=[]}=e,n=Is.L.Unspecified;const s=a.map((e=>{const{name:t,used:a,limit:s,usage:r}=e,i=(0,Pn.Lv)(r);return Is.l[i]>Is.l[n]&&(n=i),{title:t,value:a,capacity:s,warningThreshold:Pn.B8,dangerThreshold:Pn.nr,formatValues:_.QO}}));return(0,d.jsx)(Vs,{label:$n("cards.memory-label"),active:t,metrics:s,status:n})}var Ys=a(46925);const Xs=ue.h.injectEndpoints({endpoints:e=>({getTopNodes:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getNodes({type:"any",sortOrder:-1,limit:x.fl,...e},{signal:a});return{data:(0,Ys.nH)(t).Nodes}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var $s=a(96939);const er=(0,c.cn)("tenant-overview");function tr(e){let{title:t,error:a,loading:s,tableClassNameModifiers:r={},...i}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:er("title"),children:t}),a?(0,d.jsx)(R.V,{error:a}):null,(0,d.jsx)("div",{className:er("table",r),children:a&&0===i.data.length?null:s?(0,d.jsx)(ce.h,{rows:x.fl}):(0,d.jsx)(le.G,{settings:x.E6,...i})})]})}var ar=a(68036);const nr=e=>{let{prefix:t=$n("top"),entity:a,postfix:s,link:r,onClick:i}=e;return r?(0,d.jsxs)(n.Fragment,{children:[t," ",(0,d.jsx)(ar.h,{to:r,onClick:i,children:a})," ",s]}):"".concat(t," ").concat(a," ").concat(s)};function sr(e){let{tenantName:t,additionalNodesProps:a}=e;const n=(0,y.A3)(),[s]=(0,y.Rj)(),r=(0,$s.LF)(null===a||void 0===a?void 0:a.getNodeRef),{currentData:i,isFetching:o,error:l}=Xs.useGetTopNodesQuery({tenant:t,sortValue:"CPU"},{pollingInterval:s}),c=o&&void 0===i,u=i,m=nr({entity:$n("nodes"),postfix:$n("by-pools-usage"),link:(0,Qe.Sj)({...n,[Qe.XV.diagnosticsTab]:S.qQ.nodes})});return(0,d.jsx)(tr,{columnsWidthLSKey:$s.t5,data:u||[],columns:r,title:m,loading:c,error:l,emptyDataMessage:$n("top-nodes.empty-data")})}function rr(e){let{tenantName:t,additionalNodesProps:a}=e;const n=(0,y.A3)(),[s]=(0,y.Rj)(),r=(0,$s.sQ)(null===a||void 0===a?void 0:a.getNodeRef),{currentData:i,isFetching:o,error:l}=Xs.useGetTopNodesQuery({tenant:t,sortValue:"LoadAverage"},{pollingInterval:s}),c=o&&void 0===i,u=i,m=nr({entity:$n("nodes"),postfix:$n("by-load"),link:(0,Qe.Sj)({...n,[Qe.XV.diagnosticsTab]:S.qQ.nodes})});return(0,d.jsx)(tr,{columnsWidthLSKey:$s.t5,data:u||[],columns:r,title:m,loading:c,error:l,emptyDataMessage:$n("top-nodes.empty-data")})}var ir=a(83786),or=a(30667),lr=a(99683);const cr=(0,c.cn)("kv-truncated-query"),dr=e=>{let{value:t="",maxQueryHeight:a=6}=e;const s=t.split("\n");if(s.length>a){const e=s.slice(0,a).join("\n"),t="\n...\nThe request was truncated. Click on the line to show the full query on the query tab";return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("span",{className:cr(),children:e}),(0,d.jsx)("span",{className:cr("message",{color:"secondary"}),children:t})]})}return(0,d.jsx)(n.Fragment,{children:t})},ur=e=>{let{value:t=""}=e;return(0,d.jsx)(lr.l,{contentClassName:cr("popover-content"),content:t,children:t})},mr="CPUTime",pr="QueryText",hr="EndTime",vr="ReadRows",gr="ReadBytes",xr="UserSID",yr="OneLineQueryText",br="QueryHash",fr="Duration",jr="CPUCores",Nr="PeakTime",Sr="IntervalEnd",wr=[jr,"DataSize","InFlightTxCount"],Tr=[mr,hr,vr,gr,xr,fr],Cr=e=>Object.values(wr).includes(e);var Er=a(47694),Pr=a.n(Er);const Ir=6,Dr={...x.LE,dynamicRenderType:"variable"},Rr=(0,c.cn)("kv-top-queries"),Ar="topQueriesColumnsWidth",kr={name:mr,sortAccessor:e=>Number(e.CPUTimeUs),render:e=>{var t;let{row:a}=e;return(0,Ze.zm)((0,Ze.BO)(null!==(t=a.CPUTimeUs)&&void 0!==t?t:void 0))},width:120,align:Ne.ZP.RIGHT,sortable:!1},Or={name:pr,sortAccessor:e=>Number(e.CPUTimeUs),render:e=>{var t;let{row:a}=e;return(0,d.jsx)("div",{className:Rr("query"),children:(0,d.jsx)(dr,{value:null===(t=a.QueryText)||void 0===t?void 0:t.toString(),maxQueryHeight:Ir})})},sortable:!1,width:500},_r={name:hr,render:e=>{let{row:t}=e;return(0,_.o0)(new Date(t.EndTime).getTime())},align:Ne.ZP.RIGHT,width:200},Mr={name:vr,render:e=>{let{row:t}=e;return(0,_.uf)(t.ReadRows)},sortAccessor:e=>Number(e.ReadRows),align:Ne.ZP.RIGHT,width:150},Lr={name:gr,render:e=>{let{row:t}=e;return(0,_.uf)(t.ReadBytes)},sortAccessor:e=>Number(e.ReadBytes),align:Ne.ZP.RIGHT,width:150},zr={name:xr,render:e=>{let{row:t}=e;return(0,d.jsx)("div",{className:Rr("user-sid"),children:t.UserSID||"\u2013"})},sortAccessor:e=>String(e.UserSID),align:Ne.ZP.LEFT},qr={name:yr,header:"QueryText",render:e=>{var t;let{row:a}=e;return(0,d.jsx)(ur,{value:null===(t=a.QueryText)||void 0===t?void 0:t.toString()})},sortable:!1,width:500},Fr={name:br,render:e=>{let{row:t}=e;return a=String(t.QueryText),(Pr().str(a)>>>0).toString(16).toUpperCase().padStart(8,"0");var a},width:130,sortable:!1},Qr=[kr,Or,_r,{name:fr,header:"Duration",render:e=>{var t;let{row:a}=e;return(0,Ze.zm)((0,Ze.BO)(null!==(t=a.Duration)&&void 0!==t?t:void 0))},sortAccessor:e=>Number(e.Duration),align:Ne.ZP.RIGHT,width:150},Mr,Lr,zr],Br=[Fr,qr,kr];function Ur(e){let{tenantName:t}=e;const a=(0,y.zL)(),s=(0,Pa.TH)(),r=(0,Pa.k6)(),i=(0,E.mB)(s),[o]=(0,y.Rj)(),l=Br,{currentData:c,isFetching:u,error:m}=or.MU.useGetTopQueriesQuery({database:t},{pollingInterval:o}),p=u&&void 0===c,{result:h}=c||{},v=n.useCallback((e=>{const{QueryText:t}=e;a((0,ir.B8)({input:t}));const n=(0,E.mB)(s),i=(0,Qe.Sj)({...n,[S.bS]:S.m2.query,[Qe.XV.queryTab]:S._0.newQuery});r.push(i)}),[a,r,s]),g=nr({entity:$n("queries"),postfix:$n("by-cpu-time",{executionPeriod:$n("executed-last-hour")}),onClick:()=>{a((0,or.Im)({from:void 0,to:void 0}))},link:(0,Qe.Sj)({...i,[Qe.XV.diagnosticsTab]:S.qQ.topQueries})});return(0,d.jsx)(tr,{columnsWidthLSKey:Ar,data:h||[],columns:l,onRowClick:v,title:g,loading:p,error:(0,de.fV)(m),rowClassName:()=>er("top-queries-row")})}function Hr(e,t){const a=t?"CAST(SUBSTRING(CAST(Path AS String), ".concat(t.length,") AS Utf8) AS Path"):"Path";return"SELECT\n    ".concat(a,",\n    TabletId,\n    CPUCores,\nFROM `.sys/partition_stats`\nWHERE\n    Path='").concat(e,"'\n    OR Path LIKE '").concat(e,"/%'\nORDER BY CPUCores DESC\nLIMIT ").concat(x.fl)}const Vr=ue.h.injectEndpoints({endpoints:e=>({getTopShards:e.query({queryFn:async(e,t)=>{let{database:a,path:n=""}=e,{signal:s}=t;try{const e=await window.api.sendQuery({schema:"modern",query:Hr(n,a),database:a,action:"execute-scan"},{signal:s,withRetries:!0});return(0,de.gW)(e)?{error:e}:{data:(0,de.gY)(e)}}catch(r){return{error:r||new Error("Unauthorized")}}},providesTags:["All"]})}),overrideExisting:"throw"});var Gr=a(41919),Zr=a(86017);function Wr(e){let{path:t,location:a,...n}=e;const s=(0,E.mB)(a),r=(0,E.vF)({...s,schema:t});return(0,d.jsx)(Zr.r,{view:"normal",...n,href:r})}var Jr=a(80816);const Kr=(0,a(99106).p)(60,80,["success","warning","danger"]);var Yr=a(48169),Xr=a(92398);const $r="topShardsColumnsWidth",ei="TabletId",ti="CPUCores",ai="DataSize",ni="Path",si="NodeId",ri="InFlightTxCount",ii={TabletId:"TabletId",CPUCores:"CPUCores",DataSize:"DataSize (B)",Path:"Path",NodeId:"NodeId",PeakTime:"PeakTime",InFlightTxCount:"InFlightTxCount",IntervalEnd:"IntervalEnd"};const oi=(e,t)=>({name:ni,header:ii[ni],render:a=>{let{row:n}=a;return(0,d.jsx)(Wr,{path:e+n.Path,location:t,children:n.Path})},sortable:!1,width:300}),li={name:ti,header:ii[ti],render:e=>{let{row:t}=e;return a=t.CPUCores||0,"".concat((0,_.W0)(100*Number(a),2),"%");var a},align:Ne.ZP.RIGHT},ci={name:ai,header:ii[ai],render:e=>{let{row:t}=e;return(0,_.uf)(t.DataSize)},align:Ne.ZP.RIGHT},di={name:ei,header:ii[ei],render:e=>{var t;let{row:a}=e;return a.TabletId?(0,d.jsx)(fa.A,{name:null===(t=a.TabletId)||void 0===t?void 0:t.toString(),path:(0,E.fK)(a.TabletId),hasClipboardButton:!0,showStatus:!1,additionalControls:(0,d.jsx)(Gr.Q,{href:(0,Yr.wz)(a.TabletId)})}):"\u2013"},sortable:!1,width:220},ui={name:si,header:ii[si],render:e=>{let{row:t}=e;return t.NodeId?(0,d.jsx)(ut.h,{to:(0,Xr.a3)(t.NodeId),children:t.NodeId}):"\u2013"},align:Ne.ZP.RIGHT},mi={name:ti,header:ii[ti],render:e=>{let{row:t}=e;return(0,d.jsx)(Jr.a,{value:(0,_.W0)(100*Number(t.CPUCores),2),theme:Kr(100*Number(t.CPUCores))})},align:Ne.ZP.RIGHT,sortable:!1,width:140,resizeMinWidth:140},pi={name:ri,header:ii[ri],render:e=>{let{row:t}=e;return(0,_.uf)(t.InFlightTxCount)},align:Ne.ZP.RIGHT},hi=e=>{let{tenantName:t,path:a}=e;const n=(0,Pa.TH)(),s=(0,E.mB)(n),[r]=(0,y.Rj)(),{currentData:i,isFetching:o,error:l}=Vr.useGetTopShardsQuery({database:t,path:a},{pollingInterval:r}),c=o&&void 0===i,{result:u}=i||{},m=((e,t)=>[di,oi(e,t),mi])(t,n),p=nr({entity:$n("shards"),postfix:$n("by-cpu-usage"),link:(0,Qe.Sj)({...s,[Qe.XV.diagnosticsTab]:S.qQ.topShards})});return(0,d.jsx)(tr,{columnsWidthLSKey:$r,data:u||[],columns:m,title:p,loading:c,error:(0,de.fV)(l)})},vi=[{title:$n("charts.cpu-usage"),metrics:["IC","IO","Batch","User","System"].map((e=>({target:"resources.cpu.".concat(e,".usage"),title:e}))),options:{dataType:"percent",scaleRange:{min:0,max:1}}}];function gi(e){let{tenantName:t,additionalNodesProps:a}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Yn,{database:t,charts:vi}),(0,d.jsx)(rr,{tenantName:t,additionalNodesProps:a}),(0,d.jsx)(sr,{tenantName:t,additionalNodesProps:a}),(0,d.jsx)(hi,{tenantName:t,path:t}),(0,d.jsx)(Ur,{tenantName:t})]})}function xi(e){let{tenantName:t,additionalNodesProps:a}=e;const n=(0,y.A3)(),[s]=(0,y.Rj)(),r=(0,$s.Cj)({getNodeRef:null===a||void 0===a?void 0:a.getNodeRef}),{currentData:i,isFetching:o,error:l}=Xs.useGetTopNodesQuery({tenant:t,sortValue:"Memory",tablets:!0},{pollingInterval:s}),c=o&&void 0===i,u=i,m=nr({entity:$n("nodes"),postfix:$n("by-memory"),link:(0,Qe.Sj)({...n,[Qe.XV.diagnosticsTab]:S.qQ.nodes})});return(0,d.jsx)(tr,{columnsWidthLSKey:$s.t5,data:u||[],columns:r,title:m,loading:c,error:l,emptyDataMessage:$n("top-nodes.empty-data")})}const yi=[{title:$n("charts.memory-usage"),metrics:[{target:"resources.memory.used_bytes",title:$n("charts.memory-usage")}],options:{dataType:"size"}}];function bi(e){let{tenantName:t}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Yn,{database:t,charts:yi}),(0,d.jsx)(xi,{tenantName:t})]})}var fi=a(23373),ji=a(11431),Ni=a(92092);const Si=e=>{const{StoragePools:t,StorageGroups:a}=e,n=(0,Ni.sl)(a,t);return t&&n.sort(((e,t)=>t.Usage-e.Usage)),{groups:n.slice(0,x.fl)}},wi=ue.h.injectEndpoints({endpoints:e=>({getTopStorageGroups:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getStorageInfo({visibleEntities:"all",sortOrder:-1,sortValue:"Usage",limit:x.fl,version:ji.w.v2,...e},{signal:a});return{data:Si(t).groups||[]}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var Ti=a(77382);function Ci(e){let{tenant:t}=e;const a=(0,y.A3)(),[n]=(0,y.Rj)(),s=(0,Ti.mk)(),{currentData:r,isFetching:i,error:o}=wi.useGetTopStorageGroupsQuery({tenant:t},{pollingInterval:n}),l=i&&void 0===r,c=r,u=nr({entity:$n("groups"),postfix:$n("by-usage"),link:(0,Qe.Sj)({...a,[Qe.XV.diagnosticsTab]:S.qQ.storage})});return(0,d.jsx)(tr,{columnsWidthLSKey:Ti.Ty,data:c||[],columns:s,title:u,loading:l,error:o})}const Ei=e=>"\nSELECT\n    Path, SUM(DataSize) as Size\nFROM `".concat(e,"/.sys/partition_stats`\nGROUP BY Path\n    ORDER BY Size DESC\n    LIMIT ").concat(x.fl,"\n"),Pi=ue.h.injectEndpoints({endpoints:e=>({getTopTables:e.query({queryFn:async(e,t)=>{let{path:a}=e,{signal:n}=t;try{const e=await window.api.sendQuery({schema:"modern",query:Ei(a),database:a,action:"execute-scan"},{signal:n,withRetries:!0});return(0,de.gW)(e)?{error:e}:{data:(0,de.gY)(e)}}catch(s){return{error:s||"Unauthorized"}}},providesTags:["All"]})}),overrideExisting:"throw"}),Ii="topTablesTableColumnsWidth";function Di(e){let{path:t}=e;const a=(0,Pa.TH)(),[n]=(0,y.Rj)(),{currentData:s,error:r,isFetching:i}=Pi.useGetTopTablesQuery({path:t},{pollingInterval:n}),o=i&&void 0===s,{result:l}=s||{},c=[{name:"Size",width:100,sortable:!1,render:e=>{let{row:t}=e;return(e=>{const t=(0,Ge.dT)(null!==l&&void 0!==l&&l.length?Number(l[0].Size):0,0);return(0,Ge.td)({value:e,size:t,precision:1})})(Number(t.Size))},align:Ne.ZP.RIGHT},{name:"Path",width:700,sortable:!1,render:e=>{let{row:t}=e;return t.Path?(0,d.jsx)(lr.l,{content:t.Path,children:(0,d.jsx)(Wr,{path:String(t.Path),location:a,children:t.Path})}):null}}],u=nr({entity:$n("tables"),postfix:$n("by-size")});return(0,d.jsx)(tr,{columnsWidthLSKey:Ii,data:l||[],columns:c,title:u,loading:o,error:(0,de.fV)(r)})}const Ri=[{title:$n("charts.storage-usage"),metrics:[{target:"resources.storage.used_bytes",title:$n("charts.storage-usage")}],options:{dataType:"size"}}];function Ai(e){let{tenantName:t,metrics:a}=e;const{blobStorageUsed:s,tabletStorageUsed:r,blobStorageLimit:i,tabletStorageLimit:o}=a,l=[{label:(0,d.jsx)(pt,{text:$n("storage.tablet-storage-title"),popoverContent:$n("storage.tablet-storage-description")}),value:(0,d.jsx)(Qs.y,{value:r,capacity:o,formatValues:_.QO,colorizeProgress:!0,warningThreshold:75,dangerThreshold:85})},{label:(0,d.jsx)(pt,{text:$n("storage.db-storage-title"),popoverContent:$n("storage.db-storage-description")}),value:(0,d.jsx)(Qs.y,{value:s,capacity:i,formatValues:_.QO,colorizeProgress:!0,warningThreshold:75,dangerThreshold:85})}];return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Yn,{database:t,charts:Ri}),(0,d.jsx)(fi._,{className:er("storage-info"),title:"Storage details",info:l}),(0,d.jsx)(Di,{path:t}),(0,d.jsx)(Ci,{tenant:t})]})}function ki(e){var t,a,n;let{tenantName:s,additionalTenantProps:r,additionalNodesProps:i}=e;const{metricsTab:o}=(0,y.ix)((e=>e.tenant)),[l]=(0,y.Rj)(),{currentData:c,isFetching:u}=P.$1.useGetTenantInfoQuery({path:s},{pollingInterval:l}),m=u&&void 0===c,{Name:p,Type:h,Overall:v}=c||{},b=(0,he.TV)(h),{data:f}=(0,g.hz)({path:s,database:s}),{Tables:j,Topics:N}=(null===f||void 0===f||null===(t=f.PathDescription)||void 0===t||null===(a=t.DomainDescription)||void 0===a?void 0:a.DiskSpaceUsage)||{},w=[null===j||void 0===j?void 0:j.TotalSize,null===N||void 0===N?void 0:N.AccountSize,null===N||void 0===N?void 0:N.DataSize,null===N||void 0===N?void 0:N.ReserveSize,null===N||void 0===N?void 0:N.UsedReserveSize].reduce(((e,t)=>t?e+Number(t):e),0),T={...c,Metrics:{...null===c||void 0===c?void 0:c.Metrics,Storage:String(w)}},{blobStorage:C,tabletStorage:E,blobStorageLimit:I,tabletStorageLimit:D,poolsStats:R,memoryStats:A,blobStorageStats:k,tabletStorageStats:O}=(0,Pn.HH)(T),_={blobStorageUsed:C,blobStorageLimit:I,tabletStorageUsed:E,tabletStorageLimit:D};return m?(0,d.jsx)("div",{className:er("loader"),children:(0,d.jsx)(En.a,{size:"m"})}):(0,d.jsxs)("div",{className:er(),children:[(0,d.jsxs)("div",{className:er("info"),children:[(0,d.jsx)("div",{className:er("top-label"),children:b}),(0,d.jsxs)("div",{className:er("top"),children:[(0,d.jsx)("div",{className:er("tenant-name-wrapper"),children:(0,d.jsx)(fa.A,{status:v,name:p||x.FU,withLeftTrim:!0,hasClipboardButton:Boolean(c),clipboardButtonAlwaysVisible:!0})}),null===r||void 0===r||null===(n=r.getMonitoringLink)||void 0===n?void 0:n.call(r,p,h)]}),(0,d.jsx)(Zs,{poolsCpuStats:R,memoryStats:A,blobStorageStats:k,tabletStorageStats:O,tenantName:s})]}),(()=>{switch(o){case S.Xk.cpu:return(0,d.jsx)(gi,{tenantName:s,additionalNodesProps:i});case S.Xk.storage:return(0,d.jsx)(Ai,{tenantName:s,metrics:_});case S.Xk.memory:return(0,d.jsx)(bi,{tenantName:s});case S.Xk.healthcheck:return(0,d.jsx)(Ps,{tenantName:s});default:return(0,d.jsx)(ts,{database:s})}})()]})}const Oi=(0,c.cn)("kv-detailed-overview");const _i=function(e){const{type:t,tenantName:a,path:n,additionalTenantProps:s,additionalNodesProps:r}=e,i=a===n;return(0,d.jsx)("div",{className:Oi(),children:i?(0,d.jsx)("div",{className:Oi("section"),children:(0,d.jsx)(ki,{tenantName:a,additionalTenantProps:s,additionalNodesProps:r})}):(0,d.jsx)(Cn,{type:t,path:n,database:a})})},Mi={id:S.qQ.overview,title:"Info"},Li={id:S.qQ.schema,title:"Schema"},zi={id:S.qQ.topQueries,title:"Top queries"},qi={id:S.qQ.topShards,title:"Top shards"},Fi={id:S.qQ.nodes,title:"Nodes"},Qi={id:S.qQ.tablets,title:"Tablets"},Bi={id:S.qQ.storage,title:"Storage"},Ui={id:S.qQ.network,title:"Network"},Hi={id:S.qQ.describe,title:"Describe"},Vi={id:S.qQ.hotKeys,title:"Hot keys"},Gi={id:S.qQ.graph,title:"Graph"},Zi={id:S.qQ.consumers,title:"Consumers"},Wi={id:S.qQ.partitions,title:"Partitions"},Ji=[Mi,Qi,Hi],Ki=[Mi,zi,qi,Fi,Qi,Bi,Ui,Hi],Yi=[Mi,Li,qi,Fi,Gi,Qi,Vi,Hi],Xi=[Mi,Li,qi,Fi,Gi,Qi,Hi],$i=[Mi,qi,Fi,Hi],eo=[Mi,Zi,Wi,Fi,Qi,Hi],to=[Mi,Zi,Wi,Fi,Qi,Hi],ao=[Mi,Hi],no=[Mi,Hi],so=[Mi,Hi],ro={[Le.gb.EPathTypeInvalid]:void 0,[Le.gb.EPathTypeSubDomain]:Ki,[Le.gb.EPathTypeExtSubDomain]:Ki,[Le.gb.EPathTypeColumnStore]:Ki,[Le.gb.EPathTypeTable]:Yi,[Le.gb.EPathTypeColumnTable]:Xi,[Le.gb.EPathTypeDir]:$i,[Le.gb.EPathTypeTableIndex]:$i,[Le.gb.EPathTypeCdcStream]:eo,[Le.gb.EPathTypePersQueueGroup]:to,[Le.gb.EPathTypeExternalDataSource]:ao,[Le.gb.EPathTypeExternalTable]:no,[Le.gb.EPathTypeView]:so,[Le.gb.EPathTypeReplication]:Ji},io=e=>e&&ro[e]||$i;var oo=a(77280),lo=a(91387);const co=ue.h.injectEndpoints({endpoints:e=>({getHotKeys:e.query({queryFn:async(e,t)=>{let{path:a,database:n}=e,{signal:s}=t;try{var r;const e=await window.api.getHotKeys({path:a,database:n,enableSampling:!0},{signal:s});if(Array.isArray(e.hotkeys))return{data:e.hotkeys};await Promise.race([new Promise((e=>{setTimeout(e,5e3)})),new Promise(((e,t)=>{s.addEventListener("abort",t)}))]);return{data:null!==(r=(await window.api.getHotKeys({path:a,database:n,enableSampling:!1},{signal:s})).hotkeys)&&void 0!==r?r:null}}catch(i){return{error:i}}},providesTags:["All"]})}),overrideExisting:"throw"}),uo=JSON.parse('{"hot-keys-collecting":"Please wait a little while we are collecting hot keys samples...","no-data":"No information about hot keys","help":"Hot keys contains a list of table primary key values that are accessed most often. Sample is collected upon request to the tab during 5s time interval. Samples column indicates how many requests to the particular key value were registered during collection phase."}'),mo=(0,xe.wZ)("ydb-hot-keys",{en:uo});var po;function ho(){return ho=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ho.apply(this,arguments)}const vo=function(e){return n.createElement("svg",ho({viewBox:"0 0 12 7",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),po||(po=n.createElement("path",{d:"M8 7h3V5h1V2H6.66C6.085.79 4.86 0 3.5 0 1.57 0 0 1.57 0 3.5S1.57 7 3.5 7c1.36 0 2.59-.79 3.16-2H8v2zm2-1H9V4H5.97l-.115.335a2.5 2.5 0 110-1.67L5.97 3H11v1h-1v2zM3.5 5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zM3 3.5a.5.5 0 111 0 .5.5 0 01-1 0z"})))},go=(0,c.cn)("ydb-hot-keys"),xo={accessSample:"accessSample",keyValues:"keyValues"},yo=function(){return[...(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(((e,t)=>({name:e,header:(0,d.jsxs)("div",{className:go("primary-key-column"),children:[(0,d.jsx)(_s.J,{data:vo,width:12,height:7}),e]}),render:e=>{let{row:a}=e;return a.keyValues[t]},align:Ne.ZP.RIGHT,sortable:!1}))),{name:xo.accessSample,header:"Samples",render:e=>{let{row:t}=e;return t.accessSample},align:Ne.ZP.RIGHT,sortable:!1}]};function bo(e){var t,a;let{path:s,database:r}=e;const{currentData:i,isFetching:o,error:l}=co.useGetHotKeysQuery({path:s,database:r}),c=o&&void 0===i,{data:u,isLoading:m}=(0,g.hz)({path:s,database:r}),p=null===u||void 0===u||null===(t=u.PathDescription)||void 0===t||null===(a=t.Table)||void 0===a?void 0:a.KeyColumnNames,h=n.useMemo((()=>yo(p)),[p]);return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(fo,{}),c||m?(0,d.jsx)("div",{children:mo("hot-keys-collecting")}):l?(0,d.jsx)(R.V,{error:l}):i?(0,d.jsx)(le.G,{wrapperClassName:go("table"),columns:h,data:i,settings:x.LE,initialSortOrder:{columnId:xo.accessSample,order:Ne.ZP.DESCENDING}}):(0,d.jsx)("div",{children:mo("no-data")})]})}function fo(){const[e,t]=(0,y.yu)(x.RI);return e?null:(0,d.jsxs)(lo.Z,{theme:"info",view:"filled",type:"container",className:go("help-card"),children:[mo("help"),(0,d.jsx)(Zn.z,{className:go("help-card__close-button"),view:"flat",onClick:()=>t(!0),children:(0,d.jsx)(_s.J,{data:oo.Z,size:18})})]})}var jo=a(56350),No=a(74221);const So=ue.h.injectEndpoints({endpoints:e=>({getNetworkInfo:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.getNetwork({path:e,database:e},{signal:a})}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var wo=a(80839);const To=(0,c.cn)("node-network");function Co(){}function Eo(e){let{nodeId:t,connected:a,capacity:s,rack:r,status:i,onClick:o=Co,onMouseEnter:l=Co,onMouseLeave:c=Co,showID:u,isBlurred:m}=e;const p=n.useRef(null),h=i||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=Math.floor(e/t*100);return 100===a?ys.K.Green:a>=70?ys.K.Yellow:a>=1?ys.K.Red:ys.K.Grey}(a,s);return(0,d.jsx)("div",{ref:p,className:To({[h.toLowerCase()]:!0,id:u,blur:m}),onMouseEnter:()=>{l(p.current,{nodeId:t,connected:a,capacity:s,rack:r},"node")},onMouseLeave:()=>{c()},onClick:()=>o(t),children:u?t:null})}const Po=e=>null===e||void 0===e?void 0:e.reduce(((e,t)=>t.Connected?e+1:e),0);var Io,Do,Ro,Ao,ko,Oo,_o,Mo,Lo,zo,qo,Fo,Qo,Bo,Uo;function Ho(){return Ho=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ho.apply(this,arguments)}const Vo=function(e){return n.createElement("svg",Ho({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 221 204"},e),Io||(Io=n.createElement("path",{d:"M68.46 2.529v25.227c0 1.227.876 2.278 2.102 2.511 16.643 2.979 29.14 17.812 28.498 35.448-.642 18.045-15.359 32.703-33.345 33.403-17.636.643-32.41-11.854-35.448-28.44a2.562 2.562 0 00-2.51-2.102H2.528c-1.519 0-2.687 1.285-2.512 2.745 3.446 32.703 31.243 58.106 64.939 57.814 35.155-.292 63.829-29.024 64.121-64.18.292-33.695-25.17-61.492-57.873-64.938-1.46-.175-2.744.993-2.744 2.512z",fill:"#EBF2FA"})),Do||(Do=n.createElement("path",{d:"M22.736 18.354l17.811 17.812c.876.876 2.278.992 3.329.233 4.146-3.095 9.052-5.197 14.366-6.19 1.226-.233 2.102-1.226 2.102-2.511V2.528a2.502 2.502 0 00-2.803-2.51C44.46 1.418 32.488 6.674 22.91 14.674c-1.168.935-1.226 2.628-.175 3.68zm-9.403 6.133C6.093 33.83 1.303 45.16.02 57.54c-.176 1.46 1.05 2.745 2.51 2.745H27.7a2.562 2.562 0 002.511-2.103c.818-4.672 2.628-9.051 5.14-12.847a2.642 2.642 0 00-.293-3.212L17.13 24.312c-1.05-1.11-2.861-.993-3.796.175zm67.275 107.392h32.995c1.868 0 3.387 1.518 3.445 3.445v65.231a3.451 3.451 0 01-3.445 3.445H80.608a3.452 3.452 0 01-3.446-3.445v-65.231a3.451 3.451 0 013.446-3.445zm77.844 27.097h-32.878a3.514 3.514 0 00-3.503 3.504v37.959a3.514 3.514 0 003.503 3.504h32.878a3.515 3.515 0 003.504-3.504V162.48a3.515 3.515 0 00-3.504-3.504zm12.205 18.28h32.586a3.639 3.639 0 013.621 3.62v19.388a3.639 3.639 0 01-3.621 3.621h-32.586a3.639 3.639 0 01-3.62-3.621v-19.388a3.638 3.638 0 013.62-3.62z",fill:"#EBF2FA"})),Ro||(Ro=n.createElement("path",{d:"M134.275 171.532h-113c-5.84 0-10.628-4.789-10.628-10.629v-73.23c0-5.84 4.788-10.629 10.628-10.629h112.941c5.84 0 10.629 4.789 10.629 10.629v73.23c.058 5.899-4.731 10.629-10.57 10.629v0z",stroke:"#2EE5C0",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})),Ao||(Ao=n.createElement("path",{d:"M21.625 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074zM31.494 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074zM41.363 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074z",fill:"#2EE5C0"})),ko||(ko=n.createElement("path",{d:"M10.822 98.592h133.673",stroke:"#2EE5C0",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})),Oo||(Oo=n.createElement("path",{d:"M184.555 149.164L57.89 156.172c-4.263.234-7.767-3.037-7.767-7.3V51.114c0-4.263 3.504-7.533 7.767-7.3l126.665 7.008c3.27.176 5.898 3.33 5.898 7.008v84.327c0 3.679-2.628 6.832-5.898 7.007z",fill:"#027BF3"})),_o||(_o=n.createElement("path",{d:"M65.13 54.151c0 1.986-1.576 3.504-3.562 3.387-1.985-.058-3.562-1.752-3.562-3.737 0-1.986 1.635-3.504 3.562-3.387 1.927.058 3.562 1.752 3.562 3.737zm11.506.466a3.38 3.38 0 01-3.504 3.388c-1.927-.059-3.504-1.753-3.504-3.68a3.38 3.38 0 013.504-3.387c1.927.117 3.504 1.752 3.504 3.68zm7.825 3.855c1.869.117 3.387-1.402 3.387-3.329 0-1.927-1.518-3.562-3.387-3.62-1.927-.117-3.445 1.401-3.445 3.328 0 1.927 1.576 3.562 3.445 3.62z",fill:"#fff"})),Mo||(Mo=n.createElement("path",{d:"M75.467 142.974V85.277c-3.971-.525-8.584-.409-13.899.7v57.64l13.899-.643zM88.84 90.651v51.799l-11.096.467v-57.23c4.322.934 7.942 2.745 11.096 4.964zm13.431 13.899a1.618 1.618 0 01-.146-.176 1.487 1.487 0 00-.146-.175c-.42-.51-.841-1.026-1.265-1.546-2.875-3.522-5.874-7.197-9.538-10.25v49.93l11.095-.467V104.55zm13.432 5.722c-3.913-.058-7.709-.701-11.096-3.445v34.922l11.096-.468v-31.009zm13.431-.409c-2.764-.173-5.529.006-8.246.181-.957.062-1.907.123-2.849.169v30.951l11.095-.467v-30.834zm24.002 29.841l-8.234.35v-22.191c8.176 9.285 8.234 21.841 8.234 21.841zM140.113 113.6a19.774 19.774 0 012.453 1.927v24.644l-11.096.467v-30.483c2.92.467 5.782 1.46 8.643 3.445z",fill:"#00236B"})),Lo||(Lo=n.createElement("path",{d:"M55.745 76.436a2 2 0 103.123 2.499l-3.123-2.499zm5.766-4.006l1.575-1.233a2 2 0 00-3.136-.017l1.561 1.25zm2.63 6.605a2 2 0 103.15-2.465l-3.15 2.465zm107.94 53.502a2 2 0 00-2.499 3.123l2.499-3.123zm4.006 5.766l1.214 1.59a1.999 1.999 0 00.036-3.151l-1.25 1.561zm-6.644 2.557a1.999 1.999 0 102.427 3.179l-2.427-3.179zM58.868 78.935l4.205-5.256-3.123-2.499-4.205 5.256 3.123 2.499zm1.068-5.273l4.205 5.373 3.15-2.465-4.205-5.373-3.15 2.465zm109.646 61.998l5.256 4.205 2.499-3.123-5.256-4.205-2.499 3.123zm5.292 1.054l-5.431 4.146 2.427 3.179 5.431-4.146-2.427-3.179zM147.137 69.146a2 2 0 10-.149 3.998l.149-3.998zm29.634 5.107a2 2 0 10.149-3.997l-.149 3.997zm-29.657 5.404a2 2 0 00-.102 3.999l.102-3.999zm29.681 4.758a2 2 0 00.102-3.999l-.102 4zm-29.72 5.928a2 2 0 10-.023 4l.023-4zm29.759 4.176a2 2 0 10.024-4l-.024 4zm-29.846-21.375l29.783 1.11.149-3.998-29.783-1.11-.149 3.998zm.024 10.512l29.783.76.102-4-29.783-.759-.102 3.999zm.04 10.687l29.782.176.024-4-29.783-.175-.023 4zM143.442 71.202a2.458 2.458 0 01-2.57 2.453c-1.401-.058-2.569-1.285-2.569-2.686 0-1.402 1.168-2.57 2.569-2.453 1.46.058 2.57 1.285 2.57 2.686zm.001 10.396a2.458 2.458 0 01-2.57 2.453c-1.401-.059-2.569-1.285-2.569-2.686 0-1.46 1.168-2.57 2.569-2.453 1.46.058 2.57 1.284 2.57 2.686zm-2.57 12.848a2.458 2.458 0 002.57-2.453c0-1.402-1.11-2.628-2.57-2.686-1.401-.117-2.569 1.05-2.569 2.452s1.168 2.628 2.569 2.687z",fill:"#fff"})),zo||(zo=n.createElement("path",{opacity:.2,d:"M190.452 91.875V57.771c0-3.68-2.628-6.833-5.899-7.008l-23.651-1.285a35.18 35.18 0 00-1.752 10.98c0 17.635 12.79 31.826 28.09 31.65 1.051.06 2.16-.058 3.212-.233z",fill:"#00236B"})),qo||(qo=n.createElement("path",{d:"M220.645 58.883c0-16.585-11.621-30.775-26.454-31.651-15.3-.876-28.089 12.672-28.089 30.308s12.789 31.827 28.089 31.652c14.833-.117 26.454-13.724 26.454-30.309z",fill:"#FF4645"})),Fo||(Fo=n.createElement("path",{d:"M215.329 40.372c-4.788-7.475-12.38-12.614-21.14-13.14v31.01l21.14-17.87z",fill:"#FC0"})),Qo||(Qo=n.createElement("path",{d:"M215.329 40.372l-21.14 17.87 26.455.642c0-6.89-1.986-13.315-5.315-18.512z",fill:"#00236B"})),Bo||(Bo=n.createElement("path",{d:"M194.248 58.24V27.233c-15.301-.876-28.09 12.672-28.09 30.308l28.09.7z",fill:"#FF4645"})),Uo||(Uo=n.createElement("path",{d:"M161.151 14.734a2 2 0 10-4 0h4zm-4 4.204a2 2 0 004 0h-4zm4 8.876a2 2 0 10-4 0h4zm-4 4.555a2 2 0 004 0h-4zm10.819-6.816a2 2 0 000-4v4zm-4.263-4a2 2 0 100 4v-4zm-9.169 4a2 2 0 100-4v4zm-4.263-4a2 2 0 000 4v-4zm6.876-6.82v4.205h4v-4.204h-4zm0 13.08v4.556h4v-4.555h-4zm10.819-6.26h-4.263v4h4.263v-4zm-13.432 0h-4.263v4h4.263v-4z",fill:"#2EE5C0"})))},Go=(0,c.cn)("network");function Zo(e){var t,a;let{tenantName:s}=e;const[r]=(0,y.Rj)(),i=(0,y.ix)(wo.qz),o=(0,y.zL)(),[l,c]=n.useState(),[u,m]=n.useState(!1),[p,h]=n.useState(!1),{currentData:v,isFetching:g,error:x}=So.useGetNetworkInfoQuery(s,{pollingInterval:r});if(g&&void 0===v)return(0,d.jsx)("div",{className:"loader",children:(0,d.jsx)(En.a,{size:"l"})});const b=v,f=null!==(t=(null===b||void 0===b?void 0:b.Tenants)&&b.Tenants[0].Nodes)&&void 0!==t?t:[];if(!x&&0===f.length)return(0,d.jsx)("div",{className:"error",children:"no nodes data"});const j=Jo(f,"NodeType"),N=l?Jo(null!==(a=l.Peers)&&void 0!==a?a:[],"NodeType"):{};return(0,d.jsxs)("div",{className:Go(),children:[x?(0,d.jsx)(R.V,{error:x}):null,f.length>0?(0,d.jsx)("div",{className:Go("inner"),children:(0,d.jsxs)("div",{className:Go("nodes-row"),children:[(0,d.jsxs)("div",{className:Go("left"),children:[(0,d.jsx)("div",{className:Go("controls-wrapper"),children:(0,d.jsxs)("div",{className:Go("controls"),children:[(0,d.jsx)(No.T,{value:i,onChange:e=>{o((0,wo.M6)(e))},className:Go("problem-filter")}),(0,d.jsx)("div",{className:Go("checkbox-wrapper"),children:(0,d.jsx)(D.X,{onUpdate:()=>{m(!u)},checked:u,children:"ID"})}),(0,d.jsx)("div",{className:Go("checkbox-wrapper"),children:(0,d.jsx)(D.X,{onUpdate:()=>{h(!p)},checked:p,children:"Racks"})})]})}),(0,d.jsx)(Wo,{nodes:j,showId:u,showRacks:p,clickedNode:l,onClickNode:c})]}),(0,d.jsx)("div",{className:Go("right"),children:l?(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:Go("label"),children:["Connectivity of node"," ",(0,d.jsx)(T.rU,{className:Go("link"),to:(0,Xr.a3)(l.NodeId),children:l.NodeId})," ","to other nodes"]}),(0,d.jsx)("div",{className:Go("nodes-row"),children:(0,d.jsx)(Wo,{nodes:N,isRight:!0,showId:u,showRacks:p,clickedNode:l,onClickNode:c})})]}):(0,d.jsxs)("div",{className:Go("placeholder"),children:[(0,d.jsx)("div",{className:Go("placeholder-img"),children:(0,d.jsx)(_s.J,{data:Vo,width:221,height:204})}),(0,d.jsx)("div",{className:Go("placeholder-text"),children:"Select node to see its connectivity to other nodes"})]})})]})}):null]})}function Wo(e){let{nodes:t,isRight:a,showId:n,showRacks:s,clickedNode:r,onClickNode:i}=e;const o=(0,y.ix)(wo.qz),l=(0,y.zL)();let c=0;const u=Object.keys(t).map(((e,u)=>{const m=Jo(t[e],"Rack");return(0,d.jsxs)("div",{className:Go("nodes-container",{right:a}),children:[(0,d.jsxs)("div",{className:Go("nodes-title"),children:[e," nodes"]}),(0,d.jsx)("div",{className:Go("nodes"),children:s?Object.keys(m).map(((e,t)=>(0,d.jsxs)("div",{className:Go("rack-column"),children:[(0,d.jsx)("div",{className:Go("rack-index"),children:"undefined"===e?"?":e}),m[e].map(((e,t)=>{let s,u;return!a&&"Peers"in e&&e.Peers&&(s=Object.keys(e.Peers).length,u=Po(e.Peers)),o===wo.pu.PROBLEMS&&s!==u||o===wo.pu.ALL||a?(c++,(0,d.jsx)(Eo,{nodeId:e.NodeId,showID:n,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:s,connected:u,onMouseEnter:function(){l((0,O.hJ)(...arguments))},onMouseLeave:()=>{l((0,O.i8)())},onClick:a?void 0:()=>{i(r&&e.NodeId===r.NodeId?void 0:e)},isBlurred:!a&&r&&r.NodeId!==e.NodeId},t)):null}))]},t))):t[e].map(((e,t)=>{let s,u;const m=e&&"Peers"in e?e.Peers:void 0;return!a&&"Peers"in e&&e.Peers&&(s=e.Peers.length,u=Po(m)),o===wo.pu.PROBLEMS&&s!==u||o===wo.pu.ALL||a?(c++,(0,d.jsx)(Eo,{nodeId:e.NodeId,showID:n,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:null===m||void 0===m?void 0:m.length,connected:u,onMouseEnter:function(){l((0,O.hJ)(...arguments))},onMouseLeave:()=>{l((0,O.i8)())},onClick:a?void 0:()=>{i(r&&e.NodeId===r.NodeId?void 0:e)},isBlurred:!a&&r&&r.NodeId!==e.NodeId},t)):null}))})]},u)}));return o===wo.pu.PROBLEMS&&0===c?(0,d.jsx)(jo.Q,{name:"thumbsUp",width:"200"}):u}function Jo(e,t){return e.reduce(((e,a)=>(e[a[t]]?e[a[t]].push(a):e[a[t]]=[a],e)),{})}var Ko=a(99337),Yo=a(42703),Xo=a(48857),$o=a(30629);const el=JSON.parse('{"lagsPopover.writeLags":"Write lags statistics (time format dd hh:mm:ss)","lagsPopover.readLags":"Read lags statistics (time format dd hh:mm:ss)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"Consumer:","controls.consumerSelector.emptyOption":"No consumer","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"No partitions match the current search","noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers"}'),tl=JSON.parse('{"lagsPopover.writeLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0437\u0430\u043f\u0438\u0441\u0438 (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","lagsPopover.readLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0447\u0442\u0435\u043d\u0438\u044f (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"\u0427\u0438\u0442\u0430\u0442\u0435\u043b\u044c:","controls.consumerSelector.emptyOption":"\u041d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"\u041f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0438\u0441\u043a\u0443 \u043d\u0435\u0442 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439","noConsumersMessage.topic":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0442\u043e\u043f\u0438\u043a\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","noConsumersMessage.stream":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0440\u0438\u043c\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439"}'),al=(0,xe.wZ)("ydb-diagnostics-partitions",{ru:tl,en:el}),nl={PARTITION_ID:"partitionId",STORE_SIZE:"storeSize",WRITE_SPEED:"writeSpeed",READ_SPEED:"readSpeed",WRITE_LAGS:"writeLags",READ_LAGS:"readLags",UNCOMMITED_MESSAGES:"uncommitedMessages",UNREAD_MESSAGES:"unreadMessages",START_OFFSET:"startOffset",END_OFFSET:"endOffset",COMMITED_OFFSET:"commitedOffset",READ_SESSION_ID:"readSessionId",READER_NAME:"readerName",PARTITION_HOST:"partitionHost",CONNECTION_HOST:"connectionHost"},sl={[nl.PARTITION_ID]:"Partition ID",[nl.STORE_SIZE]:"Store size",[nl.WRITE_SPEED]:"Write speed",[nl.READ_SPEED]:"Read speed",[nl.WRITE_LAGS]:"Write lags, duration",[nl.READ_LAGS]:"Read lags, duration",[nl.UNCOMMITED_MESSAGES]:"Uncommited messages",[nl.UNREAD_MESSAGES]:"Unread messages",[nl.START_OFFSET]:"Start offset",[nl.END_OFFSET]:"End offset",[nl.COMMITED_OFFSET]:"Commited offset",[nl.READ_SESSION_ID]:"Read session ID",[nl.READER_NAME]:"Reader name",[nl.PARTITION_HOST]:"Partition host",[nl.CONNECTION_HOST]:"Connection host"},rl="partitionWriteLag",il="partitionWriteIdleTime",ol={[rl]:"write lag",[il]:"write idle time"},ll="consumerWriteLag",cl="consumerReadLag",dl="consumerReadIdleTime",ul={[ll]:"write lag",[cl]:"read lag",[dl]:"read idle time"},ml=[nl.PARTITION_ID,nl.STORE_SIZE,nl.WRITE_SPEED,nl.WRITE_LAGS,nl.START_OFFSET,nl.END_OFFSET,nl.PARTITION_HOST],pl=Object.values(nl),hl=e=>{let{consumers:t,selectedConsumer:a,onSelectedConsumerChange:s,selectDisabled:r,partitions:i,onSearchChange:o,hiddenColumns:l,onHiddenColumnsChange:c,initialColumnsIds:u}=e;const[m,p]=n.useState(""),[h,v]=n.useState("");n.useEffect((()=>{if(!i)return;const e=new RegExp(Ue()(h),"i"),t=new RegExp(Ue()(m),"i"),a=i.filter((a=>{const{partitionId:n,readerName:s,readSessionId:r,partitionNodeId:i,connectionNodeId:o,partitionHost:l,connectionHost:c}=a,d=e.test(n),u=[s,r,i,o,l,c].filter(Boolean).map(String),m=0===u.length||u.some((e=>t.test(e)));return d&&m}));o(a)}),[h,m,i,o]);const g=n.useMemo((()=>{const e=t&&t.length?t.map((e=>({value:e,content:e}))):[];return[{value:"",content:al("controls.consumerSelector.emptyOption")},...e]}),[t]),x=n.useMemo((()=>{const e=[];for(const t of u){const a=t===nl.PARTITION_ID,n={title:sl[t],selected:Boolean(!l.includes(t)),id:t,required:a,sticky:a?"start":void 0};a?e.unshift(n):e.push(n)}return e}),[u,l]),y=e=>(0,d.jsx)("div",{className:Tl("select-option",{empty:""===e.value}),children:e.content});return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(I.P,{className:Tl("consumer-select"),label:al("controls.consumerSelector"),options:g,value:[a],onUpdate:e=>{s(e[0])},filterable:t&&t.length>5,disabled:r||!t||!t.length,renderOption:y,renderSelectedOption:y}),(0,d.jsx)($o.o,{onChange:e=>{v(e)},placeholder:al("controls.partitionSearch"),className:Tl("search",{partition:!0}),value:h}),(0,d.jsx)($o.o,{onChange:e=>{p(e)},placeholder:al("controls.generalSearch"),className:Tl("search",{general:!0}),value:m}),(0,d.jsx)(Xo.N,{popupWidth:242,items:x,showStatus:!0,onUpdate:e=>{const t=[...l];e.forEach((e=>{e.selected||l.includes(e.id)?e.selected&&l.includes(e.id)&&t.splice(l.indexOf(e.id)):t.push(e.id)})),c(t)},sortable:!1},"TableColumnSetup")]})},vl=(0,c.cn)("ydb-diagnostics-partitions-columns-header"),gl=e=>{let{title:t}=e;return(0,d.jsx)("div",{className:vl("multiline"),children:t})},xl=()=>(0,d.jsx)("div",{className:vl("read-session"),children:sl[nl.READ_SESSION_ID]}),yl=()=>(0,d.jsx)(pt,{className:vl("lags"),text:sl[nl.WRITE_LAGS],popoverContent:(0,d.jsx)(Et,{text:al("lagsPopover.writeLags"),type:"write"})}),bl=()=>(0,d.jsx)(pt,{className:vl("lags"),text:sl[nl.READ_LAGS],popoverContent:(0,d.jsx)(Et,{text:al("lagsPopover.readLags"),type:"read"})}),fl=()=>(0,d.jsx)(pt,{className:vl("messages"),text:sl[nl.UNREAD_MESSAGES],popoverContent:(0,d.jsx)("div",{className:vl("messages-popover-content"),children:al("headers.unread")})}),jl=()=>(0,d.jsx)(pt,{className:vl("messages"),text:sl[nl.UNCOMMITED_MESSAGES],popoverContent:(0,d.jsx)("div",{className:vl("messages-popover-content"),children:al("headers.uncommited")})}),Nl=(0,c.cn)("ydb-diagnostics-partitions-columns"),Sl=[{name:nl.PARTITION_ID,header:(0,d.jsx)(gl,{title:sl[nl.PARTITION_ID]}),sortAccessor:e=>(0,bn.kE)(e.partitionId)&&Number(e.partitionId),align:Ne.ZP.LEFT,render:e=>{let{row:t}=e;return t.partitionId}},{name:nl.STORE_SIZE,header:(0,d.jsx)(gl,{title:sl[nl.STORE_SIZE]}),align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,_.td)(t.storeSize)}},{name:nl.WRITE_SPEED,header:sl[nl.WRITE_SPEED],align:Ne.ZP.LEFT,resizeMinWidth:140,sortAccessor:e=>e.writeSpeed.perMinute,render:e=>{let{row:t}=e;return(0,d.jsx)(it,{data:t.writeSpeed})}},{name:nl.READ_SPEED,header:sl[nl.READ_SPEED],align:Ne.ZP.LEFT,resizeMinWidth:140,sortAccessor:e=>{var t;return null===(t=e.readSpeed)||void 0===t?void 0:t.perMinute},render:e=>{let{row:t}=e;return(0,d.jsx)(it,{data:t.readSpeed})}},{name:nl.WRITE_LAGS,header:(0,d.jsx)(yl,{}),className:Nl("lags-header"),sub:[{name:rl,header:ol[rl],align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,_.gC)(t.partitionWriteLag)}},{name:il,header:ol[il],align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,_.gC)(t.partitionWriteIdleTime)}}]},{name:nl.READ_LAGS,header:(0,d.jsx)(bl,{}),className:Nl("lags-header"),sub:[{name:ll,header:ul[ll],align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,_.gC)(t.consumerWriteLag)}},{name:cl,header:ul[cl],align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,_.gC)(t.consumerReadLag)}},{name:dl,header:ul[dl],align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,_.gC)(t.consumerReadIdleTime)}}]},{name:nl.UNCOMMITED_MESSAGES,header:(0,d.jsx)(jl,{}),align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return t.uncommitedMessages}},{name:nl.UNREAD_MESSAGES,header:(0,d.jsx)(fl,{}),align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return t.unreadMessages}},{name:nl.START_OFFSET,header:(0,d.jsx)(gl,{title:sl[nl.START_OFFSET]}),sortAccessor:e=>(0,bn.kE)(e.startOffset)&&Number(e.startOffset),align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return t.startOffset}},{name:nl.END_OFFSET,header:(0,d.jsx)(gl,{title:sl[nl.END_OFFSET]}),sortAccessor:e=>(0,bn.kE)(e.endOffset)&&Number(e.endOffset),align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return t.endOffset}},{name:nl.COMMITED_OFFSET,header:(0,d.jsx)(gl,{title:sl[nl.COMMITED_OFFSET]}),sortAccessor:e=>(0,bn.kE)(e.commitedOffset)&&Number(e.commitedOffset),align:Ne.ZP.RIGHT,render:e=>{let{row:t}=e;return t.commitedOffset}},{name:nl.READ_SESSION_ID,header:(0,d.jsx)(xl,{}),align:Ne.ZP.LEFT,width:150,render:e=>{let{row:t}=e;return t.readSessionId?(0,d.jsx)(fa.A,{name:t.readSessionId,showStatus:!1,hasClipboardButton:!0}):"\u2013"}},{name:nl.READER_NAME,header:(0,d.jsx)(gl,{title:sl[nl.READER_NAME]}),align:Ne.ZP.LEFT,width:150,render:e=>{let{row:t}=e;return t.readerName?(0,d.jsx)(fa.A,{name:t.readerName,showStatus:!1,hasClipboardButton:!0}):"\u2013"}},{name:nl.PARTITION_HOST,header:(0,d.jsx)(gl,{title:sl[nl.PARTITION_HOST]}),align:Ne.ZP.LEFT,width:200,render:e=>{let{row:t}=e;return t.partitionNodeId&&t.partitionHost?(0,d.jsx)(fa.A,{name:t.partitionHost,path:(0,Xr.a3)(t.partitionNodeId),showStatus:!1,hasClipboardButton:!0}):"\u2013"}},{name:nl.CONNECTION_HOST,header:(0,d.jsx)(gl,{title:sl[nl.CONNECTION_HOST]}),align:Ne.ZP.LEFT,width:200,render:e=>{let{row:t}=e;return t.connectionNodeId&&t.connectionHost?(0,d.jsx)(fa.A,{name:t.connectionHost,path:(0,Xr.a3)(t.connectionNodeId),showStatus:!1,hasClipboardButton:!0}):"\u2013"}}],wl=Sl.filter((e=>ml.includes(e.name))),Tl=(0,c.cn)("ydb-diagnostics-partitions"),Cl=e=>{let{path:t,database:a}=e;const s=(0,y.zL)(),[r,i]=n.useState([]),o=(0,y.ix)((e=>Xe(e,t,a))),[l]=(0,y.Rj)(),{selectedConsumer:c}=(0,y.ix)((e=>e.partitions)),{currentData:u,isFetching:m,error:p}=We.useGetTopicQuery({path:t,database:a}),h=m&&void 0===u,{currentData:v,isFetching:g,error:b}=Ko.W.useGetNodesListQuery(void 0),f=g&&void 0===v,j=(0,y.ix)(Ko.d),[N,S]=(0,y.yu)(x.ZY),[w,T]=(e=>{const[t,a]=n.useState([]),[s,r]=n.useState([]);return n.useEffect((()=>{e?(a(Sl),r(pl)):(a(wl),r(ml))}),[e]),[t,s]})(c),C=h?oe.CN:{path:t,database:a,consumerName:c},{currentData:E,isFetching:P,error:I}=Yo.TB.useGetPartitionsQuery(C,{pollingInterval:l}),D=P&&void 0===E,A=E,k=n.useMemo((()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return null===e||void 0===e?void 0:e.map((e=>{const a=e.partitionNodeId&&t?t.get(e.partitionNodeId):void 0,n=e.connectionNodeId&&t?t.get(e.connectionNodeId):void 0;return{...e,partitionHost:a,connectionHost:n}}))}(A,j)),[A,j]);n.useEffect((()=>{const e=!h&&!o,t=c&&o&&!o.includes(c);(e||t)&&s((0,Yo.M$)(""))}),[s,h,c,o]);const O=n.useMemo((()=>w.filter((e=>!N.includes(e.name)))),[w,N]),_=e=>{S(e)},M=e=>{s((0,Yo.M$)(e))},L=h||f||D,z=b||p||I;return(0,d.jsxs)("div",{className:Tl(),children:[(0,d.jsx)("div",{className:Tl("controls"),children:(0,d.jsx)(hl,{consumers:o,selectedConsumer:c,onSelectedConsumerChange:M,selectDisabled:Boolean(z)||L,partitions:k,onSearchChange:i,hiddenColumns:N,onHiddenColumnsChange:_,initialColumnsIds:T})}),z?(0,d.jsx)(R.V,{error:z}):null,(0,d.jsx)("div",{className:Tl("table-wrapper"),children:(0,d.jsx)("div",{className:Tl("table-content"),children:E?L?(0,d.jsx)(ce.h,{className:Tl("loader")}):(0,d.jsx)(le.G,{columnsWidthLSKey:"partitionsColumnsWidth",wrapperClassName:Tl("table"),data:r,columns:O,settings:x.LE,emptyDataMessage:al("table.emptyDataMessage")}):null})})]})};var El=a(45998);const Pl=JSON.parse('{"date-format":"MM/DD/YYYY","date-time-format":"MM/DD/YYYY HH:mm"}'),Il=JSON.parse('{"date-format":"DD.MM.YYYY","date-time-format":"DD.MM.YYYY HH:mm"}'),Dl=(0,xe.wZ)("ydb-date-range",{ru:Il,en:Pl});var Rl=a(396);function Al(e){var t,a,n,s;return"relative"===(null===e||void 0===e||null===(t=e.start)||void 0===t?void 0:t.type)&&"relative"===(null===e||void 0===e||null===(a=e.end)||void 0===a?void 0:a.type)?"s":"relative"===(null===e||void 0===e||null===(n=e.start)||void 0===n?void 0:n.type)||"relative"===(null===e||void 0===e||null===(s=e.end)||void 0===s?void 0:s.type)?"m":"l"}const kl=(0,c.cn)("date-range"),Ol={start:{value:"now-1h",type:"relative"},end:{value:"now",type:"relative"}},_l=e=>{let{from:t,to:a,className:s,onChange:r}=e;const i=n.useCallback((e=>null===r||void 0===r?void 0:r(function(e){var t,a,n,s,r,i;return{from:"relative"===(null===e||void 0===e||null===(t=e.start)||void 0===t?void 0:t.type)?e.start.value.toString():String(null===(a=(0,Rl.J)(null===e||void 0===e||null===(n=e.start)||void 0===n?void 0:n.value))||void 0===a?void 0:a.valueOf()),to:"relative"===(null===e||void 0===e||null===(s=e.end)||void 0===s?void 0:s.type)?e.end.value.toString():String(null===(r=(0,Rl.J)(null===e||void 0===e||null===(i=e.end)||void 0===i?void 0:i.value))||void 0===r?void 0:r.valueOf())}}(e))),[r]),o=n.useMemo((()=>{if(t||a)return function(e){var t,a;const n=(0,Rl.KN)(null!==(t=e.from)&&void 0!==t?t:""),s=(0,Rl.KN)(null!==(a=e.to)&&void 0!==a?a:"");return{start:e.from?{type:n?"relative":"absolute",value:n?e.from:(0,Rl.J)(Number(e.from))}:null,end:e.to?{type:s?"relative":"absolute",value:s?e.to:(0,Rl.J)(Number(e.to))}:null}}({from:t,to:a})}),[t,a]),l=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,d.jsx)("div",{className:kl(null,s),children:(0,d.jsx)(El.H,{withPresets:!0,className:kl("range-input",{[Al(o)]:!0}),timeZone:l,value:o||Ol,allowNullableValues:!0,size:"m",format:Dl("date-time-format"),onUpdate:i,placeholder:"".concat(Dl("date-time-format")," - ").concat(Dl("date-time-format")),withApplyButton:!0})})};var Ml=a(47101);const Ll=JSON.parse('{"no-data":"No data","filter.text.placeholder":"Search by query text..."}'),zl=JSON.parse('{"no-data":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445","filter.text.placeholder":"\u0418\u0441\u043a\u0430\u0442\u044c \u043f\u043e \u0442\u0435\u043a\u0441\u0442\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0430..."}'),ql=(0,xe.wZ)("ydb-diagnostics-top-queries",{ru:zl,en:Ll}),Fl=(0,c.cn)("kv-top-queries"),Ql=e=>{let{tenantName:t,type:a}=e;const s=(0,y.zL)(),r=(0,Pa.TH)(),i=(0,Pa.k6)(),[o]=(0,y.Rj)(),l=(0,y.ix)((e=>e.executeTopQueries)),{currentData:c,isFetching:u,error:m}=or.MU.useGetTopQueriesQuery({database:t,filters:l},{pollingInterval:o}),p=u&&void 0===c,{result:h}=c||{},v=Qr.map((e=>{return{...e,sortable:(t=e.name,Object.values(Tr).includes(t))};var t})),g=n.useCallback((e=>{const{QueryText:t}=e;s((0,ir.B8)({input:t}));const a=(0,E.mB)(r),n=(0,Qe.Sj)({...a,[S.bS]:S.m2.query,[Qe.XV.queryTab]:S._0.newQuery});i.push(n)}),[s,i,r]),x=e=>{s((0,or.Im)({text:e}))},b=e=>{s((0,or.Im)(e))};return(0,d.jsxs)(Ml.l,{children:[(0,d.jsx)(Ml.l.Controls,{children:(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(He.o,{value:l.text,onChange:x,placeholder:ql("filter.text.placeholder"),className:Fl("search")}),(0,d.jsx)(_l,{from:l.from,to:l.to,onChange:b})]})}),m?(0,d.jsx)(R.V,{error:(0,de.fV)(m)}):null,(0,d.jsx)(Ml.l.Table,{loading:p,children:m&&!h?null:!h||(0,he.Jp)(a)?ql("no-data"):(0,d.jsx)(le.G,{columnsWidthLSKey:Ar,columns:v,data:h,settings:Dr,onRowClick:g,rowClassName:()=>Fl("row")})})]})};var Bl=a(9345),Ul=a(58660),Hl=a(79734);const Vl=JSON.parse('{"no-data":"No data","filters.mode.immediate":"Immediate","filters.mode.history":"Historical","description":"Historical data only tracks shards with CPU load over 70%"}'),Gl=JSON.parse('{"no-data":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445","filters.mode.immediate":"\u041c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u044b\u0435","filters.mode.history":"\u0418\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0435","description":"\u0418\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043e \u0448\u0430\u0440\u0434\u0430\u0445 \u0441 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u043e\u0439 CPU \u0432\u044b\u0448\u0435 70%"}'),Zl=(0,xe.wZ)("ydb-diagnostics-top-shards",{ru:Gl,en:Vl}),Wl=e=>{let{value:t,onChange:a}=e;const s=t.mode===Ul.F.Immediate?void 0:t.from,r=t.mode===Ul.F.Immediate?void 0:t.to;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)(Hl.E,{value:t.mode,onUpdate:e=>{if(!((e,t)=>Object.values(e).includes(t))(Ul.F,e)){const t=Object.values(Ul.F).join(", ");throw new Error('Unexpected TopShards mode "'.concat(e,'". Should be one of: ').concat(t))}a({mode:e})},children:[(0,d.jsx)(Hl.E.Option,{value:Ul.F.Immediate,children:Zl("filters.mode.immediate")}),(0,d.jsx)(Hl.E.Option,{value:Ul.F.History,children:Zl("filters.mode.history")})]}),(0,d.jsx)(_l,{from:s,to:r,onChange:e=>{a({mode:Ul.F.History,...e})}})]})},Jl=(0,c.cn)("top-shards"),Kl={...x.LE,dynamicRender:!1,externalSort:!0,disableSortReset:!0,defaultOrder:Ne.ZP.DESCENDING};function Yl(e){return e?(0,_.o0)(new Date(e).getTime()):"\u2013"}function Xl(e){return e?e.split(",").map((e=>({columnId:e,order:Ne.ZP.DESCENDING}))):void 0}function $l(e){return e.to="now",e.from="now-1h",e}const ec=e=>{let{tenantName:t,path:a,type:s}=e;const r=(0,y.zL)(),i=(0,Pa.TH)(),[o]=(0,y.Rj)(),l=(0,y.ix)((e=>e.shardsWorkload)),[c,u]=n.useState((()=>{const e={...l};return e.mode||(e.mode=Ul.F.Immediate),e.from||e.to||$l(e),e})),[m,p]=n.useState(jr),{currentData:h,isFetching:v,error:g}=Bl.Ag.useSendShardQueryQuery({database:t,path:a,sortOrder:(x=m,x?x.split(",").map((e=>({columnId:e,order:"DESC"}))):void 0),filters:c},{pollingInterval:o});var x;const b=v&&void 0===h,{result:f}=null!==h&&void 0!==h?h:{},j=e=>{p(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(Array.isArray(e)?e:[e]).map((e=>{let{columnId:t}=e;return t})).join(",")}(e))},N=e=>{const t={...e};if(!l.from&&!l.to&&!e.from&&!e.to)switch(e.mode){case Ul.F.Immediate:t.from=t.to=void 0;break;case Ul.F.History:$l(t)}r((0,Bl.K2)(e)),u((e=>({...e,...t})))},S=n.useMemo((()=>{const e=((e,t)=>[oi(e,t),li,ci,di,ui,pi])(t,i),a=e.map((e=>({...e,sortable:Cr(e.name)})));return c.mode===Ul.F.History&&(a.splice(5,0,{name:Nr,render:e=>{let{row:t}=e;return Yl(t.PeakTime)},sortable:!1}),a.push({name:Sr,render:e=>{let{row:t}=e;return Yl(t.IntervalEnd)}})),a}),[c.mode,i,t]);return(0,d.jsxs)(Ml.l,{children:[(0,d.jsx)(Ml.l.Controls,{children:(0,d.jsx)(Wl,{value:c,onChange:N})}),c.mode===Ul.F.History&&(0,d.jsx)("div",{className:Jl("hint"),children:Zl("description")}),g?(0,d.jsx)(R.V,{error:(0,de.fV)(g)}):null,(0,d.jsx)(Ml.l.Table,{loading:b,children:g&&!f?null:!f||(0,he.Jp)(s)?Zl("no-data"):(0,d.jsx)(le.G,{columnsWidthLSKey:$r,columns:S,data:f,settings:Kl,onSort:j,sortOrder:Xl(m)})})]})},tc=(0,c.cn)("kv-tenant-diagnostics");const ac=function(e){const t=n.useRef(null),a=(0,y.zL)(),{diagnosticsTab:i=S.qQ.overview}=(0,y.ix)((e=>e.tenant)),[o]=(0,r.useQueryParams)({name:r.StringParam,schema:r.StringParam,backend:r.StringParam,clusterName:r.StringParam}),l=(0,he.dw)(e.type)?e.path:e.tenantName,c=(0,he.dw)(e.type)||e.path===e.tenantName?Ki:io(e.type);let u=c.find((e=>e.id===i));return u||(u=c[0]),n.useEffect((()=>{u&&u.id!==i&&a((0,P.$v)(u.id))}),[u,i,a]),(0,d.jsxs)("div",{className:tc(),ref:t,children:[u?(0,d.jsx)(s.ql,{children:(0,d.jsx)("title",{children:u.title})}):null,(()=>{var e;return(0,d.jsx)("div",{className:tc("header-wrapper"),children:(0,d.jsxs)("div",{className:tc("tabs"),children:[(0,d.jsx)(w.m,{size:"l",items:c,activeTab:null===(e=u)||void 0===e?void 0:e.id,wrapTo:(e,t)=>{let{id:a}=e;const n=(0,E.ax)(E.ZP.tenant,void 0,{...o,[Qe.XV.diagnosticsTab]:a});return(0,d.jsx)(T.rU,{to:n,className:tc("tab"),children:t},a)},allowNotSelected:!0}),(0,d.jsx)(C.q,{})]})})})(),(0,d.jsx)("div",{className:tc("page-wrapper"),children:(()=>{var a;const{type:n,path:s}=e;switch(null===(a=u)||void 0===a?void 0:a.id){case S.qQ.overview:return(0,d.jsx)(_i,{type:n,tenantName:l,path:s,additionalTenantProps:e.additionalTenantProps,additionalNodesProps:e.additionalNodesProps});case S.qQ.schema:return(0,d.jsx)(Fe,{path:s,tenantName:l,type:n,extended:!0});case S.qQ.topQueries:return(0,d.jsx)(Ql,{tenantName:l,type:n});case S.qQ.topShards:return(0,d.jsx)(ec,{tenantName:l,path:s,type:n});case S.qQ.nodes:return(0,d.jsx)(se.G,{path:s,database:l,additionalNodesProps:e.additionalNodesProps,parentContainer:t.current});case S.qQ.tablets:return(0,d.jsx)(ie.J,{path:s,database:l});case S.qQ.storage:return(0,d.jsx)(re.V,{database:l,parentContainer:t.current});case S.qQ.network:return(0,d.jsx)(Zo,{tenantName:l});case S.qQ.describe:return(0,d.jsx)(Xt,{path:s,database:l,type:n});case S.qQ.hotKeys:return(0,d.jsx)(bo,{path:s,database:l});case S.qQ.graph:return(0,d.jsx)(ne,{path:s,database:l});case S.qQ.consumers:return(0,d.jsx)(Ht,{path:s,database:l,type:n});case S.qQ.partitions:return(0,d.jsx)(Cl,{path:s,database:l});default:return(0,d.jsx)("div",{children:"No data..."})}})()})]})},nc=JSON.parse('{"controls.query-mode-selector_type":"Query type:","tabs.newQuery":"Editor","tabs.history":"History","tabs.saved":"Saved","history.empty":"History is empty","history.empty-search":"Search result is empty","saved.empty":"There are no saved queries","delete-dialog.header":"Delete query","delete-dialog.question":"Are you sure you want to delete query","delete-dialog.delete":"Delete","delete-dialog.cancel":"Cancel","preview.title":"Preview","preview.not-available":"Preview is not available","preview.close":"Close preview","method-description.script":"For YQL-scripts combining DDL and DML.\\nAPI call: schema.scripting","method-description.scan":"Read-only queries, potentially reading a lot of data.\\nAPI call: table.ExecuteScan","method-description.data":"DML queries for changing and fetching data in serialization mode.\\nAPI call: table.executeDataQuery","method-description.query":"Any query. An experimental API call supposed to replace all existing methods.\\nAPI Call: query.ExecuteScript","method-description.pg":"Queries in postgresql syntax.\\nAPI call: query.ExecuteScript","transaction-mode-description.serializable":"Provides the strictest isolation level for custom transactions","transaction-mode-description.onlinero":"Each read operation in the transaction is reading the data that is most recent at execution time","transaction-mode-description.stalero":"Read operations within a transaction may return results that are slightly out-of-date (lagging by fractions of a second)","transaction-mode-description.snapshot":"All the read operations within a transaction access the database snapshot. All the data reads are consistent","transaction-mode-description.implicit":"No transaction","tracing-level-description.basic":"Spans of main component operations","tracing-level-description.detailed":"Highest detail applicable for diagnosing problems in production","tracing-level-description.diagnostic":"Detailed debugging information for developers","tracing-level-description.off":"No tracing","tracing-level-description.toplevel":"Lowest detail, no more than two spans per request to the component","tracing-level-description.trace":"Very detailed debugging information","statistics-mode-description.none":"Don\'t collect statistics","statistics-mode-description.basic":"Collect statistics","statistics-mode-description.full":"Collect statistics and query plan","statistics-mode-description.profile":"Collect statistics for individual tasks","query-duration.description":"Duration of server-side query execution","action.send-query":"Send query","action.send-selected-query":"Send selected query","action.previous-query":"Previous query in history","action.next-query":"Next query in history","action.save-query":"Save query","filter.text.placeholder":"Search by query text...","gear.tooltip":"Query execution settings have been changed for ","banner.query-settings.message":"Query results are displayed for ","history.queryText":"Query text","history.endTime":"End time","history.duration":"Duration"}'),sc=(0,xe.wZ)("ydb-query-editor",{en:nc}),rc=(0,c.cn)("ydb-queries-history"),ic="queriesHistoryTableColumnsWidth";const oc=function(e){let{changeUserInput:t}=e;const a=(0,y.zL)(),n=(0,y.ix)(ir.qV),s=(0,y.ix)(ir.vS),r=[...n].reverse(),i=[{name:"queryText",header:sc("history.queryText"),render:e=>{let{row:t}=e;return(0,d.jsx)("div",{className:rc("query"),children:(0,d.jsx)(dr,{value:t.queryText,maxQueryHeight:Ir})})},sortable:!1,width:600},{name:"EndTime",header:sc("history.endTime"),render:e=>{let{row:t}=e;return t.endTime?(0,_.o0)(t.endTime.toString()):"-"},align:"right",width:200,sortable:!1},{name:"Duration",header:sc("history.duration"),render:e=>{let{row:t}=e;return t.durationUs?(0,Ze.zm)((0,Ze.BO)(t.durationUs)):"-"},align:"right",width:150,sortable:!1}];return(0,d.jsxs)(Ml.l,{className:rc(),children:[(0,d.jsx)(Ml.l.Controls,{children:(0,d.jsx)(He.o,{value:s,onChange:e=>{a((0,ir.u$)(e))},placeholder:sc("filter.text.placeholder"),className:rc("search")})}),(0,d.jsx)(Ml.l.Table,{children:(0,d.jsx)(le.G,{columnsWidthLSKey:ic,columns:i,data:r,settings:Dr,emptyDataMessage:sc(s?"history.empty-search":"history.empty"),onRowClick:e=>(t({input:e.queryText}),void a((0,P.jk)(S._0.newQuery))),rowClassName:()=>rc("table-row")})})]})};var lc=a(84433),cc=a(77212);const dc=(0,a(30410).k)((async()=>({Editor:(await Promise.resolve().then(a.bind(a,93757))).default})),"Editor"),uc=ue.h.injectEndpoints({endpoints:e=>({cancelQuery:e.mutation({queryFn:async(e,t)=>{let{queryId:a,database:n}=e,{signal:s}=t;try{const e=await window.api.sendQuery({database:n,action:"cancel-query",query_id:a},{signal:s});if((0,de.gW)(e))return{error:e};return{data:(0,de.gY)(e)}}catch(r){return{error:r}}}})}),overrideExisting:"throw"});var mc=a(17880),pc=a(6544);const hc=new Set(["PlanNodeId","PlanNodeType","Node Type","Plans"]);function vc(e){const t=[];if(e.Operators){const a=[];for(const t of e.Operators){const e={name:t.Name,items:[]};for(const[a,n]of Object.entries(t)){if("Name"===a)continue;const t="string"===typeof n?n:JSON.stringify(n);e.items.push({name:a,value:t})}a.push(e)}t.push({group:"Operators",stats:a})}if("Connection"===e.PlanNodeType){const a=[];for(const[t,n]of Object.entries(e))hc.has(t)||a.push({name:t,value:"string"===typeof n?n:JSON.stringify(n)});a.length>0&&t.push({group:"Attributes",stats:a})}if(e.Stats){const a=[];for(const[t,n]of Object.entries(e.Stats))a.push({name:t,value:"string"===typeof n?n:JSON.stringify(n)});t.push({group:"Stats",stats:a})}return t}function gc(e){switch(e.PlanNodeType){case"Connection":return"connection";case"ResultSet":return"result";case"Query":return"query";default:return"stage"}}function xc(e){const t=[],a=[];const n=e,s={name:String(n.PlanNodeId),data:{id:n.PlanNodeId,type:gc(n),name:n["Node Type"]}};return t.push(s),function e(){let n=arguments.length>1?arguments[1]:void 0;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((s=>{var r;const i={name:String(s.PlanNodeId),data:{id:s.PlanNodeId,type:gc(s),name:s["Node Type"],operators:null===(r=s.Operators)||void 0===r?void 0:r.map((e=>e.Name)),stats:vc(s),tables:s.Tables}};t.push(i),a.push({from:n,to:i.name}),e(s.Plans,i.name)}))}(n.Plans,s.name),{nodes:t,links:a}}function yc(e){const t=[],a=e.map((e=>({node:e})));for(;a.length>0;){var n;const{node:e,subNodes:s}=a.pop(),r=e.Plans,i=null===(n=e.Operators)||void 0===n?void 0:n[0],o=s||t;if(i){const{"A-Cpu":e,"A-Rows":t,"E-Cost":n,"E-Rows":s,"E-Size":l,SsaProgram:c,Name:d,...u}=i,m={name:d,operationParams:u,aCpu:e,aRows:t,eCost:n,eRows:s,eSize:l,children:[]};if(o.push(m),r)for(let i=r.length-1;i>=0;i--)a.push({node:r[i],subNodes:m.children})}else if(r)for(let t=r.length-1;t>=0;t--)a.push({node:r[t],subNodes:o})}return t}const bc={v2:"0.2"},fc=Object.values(bc),jc=ue.h.injectEndpoints({endpoints:e=>({explainQuery:e.mutation({queryFn:async(e,t)=>{let{query:a,database:n,querySettings:s,enableTracingLevel:r,queryId:i}=e,{signal:o}=t,l="explain",c=de.jM.yql;"pg"===(null===s||void 0===s?void 0:s.queryMode)?(l="explain-query",c=de.jM.pg):null!==s&&void 0!==s&&s.queryMode&&(l="explain-".concat(null===s||void 0===s?void 0:s.queryMode));try{const e=await window.api.sendQuery({query:a,database:n,action:l,syntax:c,stats:null===s||void 0===s?void 0:s.statisticsMode,tracingLevel:null!==s&&void 0!==s&&s.tracingLevel&&r?pc.u[null===s||void 0===s?void 0:s.tracingLevel]:void 0,transaction_mode:"implicit"===(null===s||void 0===s?void 0:s.transactionMode)||null===s||void 0===s?void 0:s.transactionMode,timeout:(0,bn.kE)(null===s||void 0===s?void 0:s.timeout)?1e3*Number(null===s||void 0===s?void 0:s.timeout):void 0,query_id:i},{signal:o});if((0,de.gW)(e))return{error:e};const t=(e=>{const{plan:t,ast:a}=(0,de.CC)(e);if(!t)return{ast:a};const{tables:n,meta:s,Plan:r,SimplifiedPlan:i}=(0,de.y5)(t);if(-1===fc.indexOf(s.version))return{plan:{pristine:t,version:s.version},ast:a};let o,l=[],c=[];if(r){const e=xc(r);l=e.links,c=e.nodes}return i&&(o=yc([i])),{plan:{links:l,nodes:c,tables:n,version:s.version,pristine:t},simplifiedPlan:{plan:o,pristine:i},ast:a}})(e);return{data:t}}catch(d){return{error:d}}}})}),overrideExisting:"throw"});var Nc=a(89003);function Sc(e,t){const a=new Map(Object.entries(e)),n=new Map(Object.entries(t));return Array.from(a.keys()).filter((e=>a.get(e)!==n.get(e)))}const wc=JSON.parse('{"action.settings":"Query settings","form.query-mode":"Query type","form.timeout":"Timeout","form.transaction-mode":"Transaction mode","form.statistics-mode":"Statistics collection mode","form.tracing-level":"Tracing level","button-done":"Save","button-cancel":"Cancel","form.timeout.seconds":"sec","description.default":" (default)","docs":"Documentation"}'),Tc=JSON.parse('{"action.settings":"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430","form.query-mode":"\u0422\u0438\u043f \u0437\u0430\u043f\u0440\u043e\u0441\u0430","form.timeout":"\u0422\u0430\u0439\u043c\u0430\u0443\u0442","form.transaction-mode":"\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438","form.statistics-mode":"\u0420\u0435\u0436\u0438\u043c \u0441\u0431\u043e\u0440\u0430 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438","form.tracing-level":"Tracing level","button-done":"\u0413\u043e\u0442\u043e\u0432\u043e","button-cancel":"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c","form.timeout.seconds":"\u0441\u0435\u043a","description.default":" (default)","docs":"\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f"}'),Cc=(0,xe.wZ)("ydb-query-settings-dialog",{en:wc,ru:Tc}),Ec=[{value:de.cy.implicit,content:de.Nf[de.cy.implicit],text:sc("transaction-mode-description.implicit"),isDefault:!0},{value:de.cy.serializable,content:de.Nf[de.cy.serializable],text:sc("transaction-mode-description.serializable")},{value:de.cy.onlinero,content:de.Nf[de.cy.onlinero],text:sc("transaction-mode-description.onlinero")},{value:de.cy.stalero,content:de.Nf[de.cy.stalero],text:sc("transaction-mode-description.stalero")},{value:de.cy.snapshot,content:de.Nf[de.cy.snapshot],text:sc("transaction-mode-description.snapshot")}],Pc=[{value:de.wZ.query,content:de.U4[de.wZ.query],text:sc("method-description.query"),isDefault:!0},{value:de.wZ.script,content:de.U4[de.wZ.script],text:sc("method-description.script")},{value:de.wZ.scan,content:de.U4[de.wZ.scan],text:sc("method-description.scan")},{value:de.wZ.data,content:de.U4[de.wZ.data],text:sc("method-description.data")},{value:de.wZ.pg,content:de.U4[de.wZ.pg],text:sc("method-description.pg")}],Ic=[{value:de.$E.none,content:de.Ie[de.$E.none],text:sc("statistics-mode-description.none"),isDefault:!0},{value:de.$E.basic,content:de.Ie[de.$E.basic],text:sc("statistics-mode-description.basic")},{value:de.$E.full,content:de.Ie[de.$E.full],text:sc("statistics-mode-description.full")},{value:de.$E.profile,content:de.Ie[de.$E.profile],text:sc("statistics-mode-description.profile")}],Dc=[{value:de.Rm.off,content:de.Vj[de.Rm.off],text:sc("tracing-level-description.off")},{value:de.Rm.toplevel,content:de.Vj[de.Rm.toplevel],text:sc("tracing-level-description.toplevel")},{value:de.Rm.basic,content:de.Vj[de.Rm.basic],text:sc("tracing-level-description.basic")},{value:de.Rm.detailed,content:de.Vj[de.Rm.detailed],text:sc("tracing-level-description.detailed"),isDefault:!0},{value:de.Rm.diagnostic,content:de.Vj[de.Rm.diagnostic],text:sc("tracing-level-description.diagnostic")},{value:de.Rm.trace,content:de.Vj[de.Rm.trace],text:sc("tracing-level-description.trace")}],Rc={transactionMode:{title:Cc("form.transaction-mode"),options:Ec},queryMode:{title:Cc("form.query-mode"),options:Pc},statisticsMode:{title:Cc("form.statistics-mode"),options:Ic},tracingLevel:{title:Cc("form.tracing-level"),options:Dc},timeout:{title:Cc("form.timeout")}};function Ac(e){let{currentSettings:t,defaultSettings:a}=e;const n=Sc(t,a),s={};return n.forEach((e=>{const a=Rc[e],n=t[e];if("options"in a){var r;const e=null===(r=a.options.find((e=>e.value===n)))||void 0===r?void 0:r.content;s[a.title]=e}else s[a.title]=n})),s}var kc=a(14709);const Oc=()=>{const[e,t]=(0,kc.y)(x.RE);return[e?{transactionMode:e.transactionMode,queryMode:e.queryMode,statisticsMode:e.statisticsMode,tracingLevel:e.tracingLevel,timeout:e.timeout}:void 0,t]};var _c=a(66213);const Mc=()=>{const[e,t]=(0,kc.y)(x.Rn),[a]=Oc(),[n]=(0,_c.d)(),s=a?Sc(a,x.hl):[],r=n?Sc(n,x.hl):[],i=s.length>0,o=a?Ac({currentSettings:a,defaultSettings:x.hl}):{},l=n?Ac({currentSettings:n,defaultSettings:x.hl}):{},c=e&&Date.now()-e<1e3*x.nU;return{isBannerShown:i&&!c,isIndicatorShown:i&&c,closeBanner:()=>t(Date.now()),resetBanner:()=>t(void 0),changedCurrentSettings:r,changedCurrentSettingsDescriptions:l,changedLastExucutionSettings:s,changedLastExecutionSettingsDescriptions:o}},Lc="s-expression",zc="yql";var qc=a(44822);let Fc;!function(e){e.triggerCollapse="triggerCollapse",e.triggerExpand="triggerExpand",e.clear="clear"}(Fc||(Fc={}));const Qc=e=>{localStorage.setItem(e,"true")},Bc=e=>{localStorage.removeItem(e)};function Uc(e){return function(t,a){switch(a){case Fc.triggerCollapse:return Qc(e),{...t,triggerCollapse:!0,triggerExpand:!1,collapsed:!0};case Fc.triggerExpand:return Bc(e),{...t,triggerCollapse:!1,triggerExpand:!0,collapsed:!1};case Fc.clear:return Bc(e),{triggerCollapse:!1,triggerExpand:!1,collapsed:!1};default:return t}}}const Hc=(0,c.cn)("kv-pane-visibility-button");function Vc(e){let{onCollapse:t,onExpand:a,isCollapsed:s,initialDirection:r="top",className:i}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Zn.z,{view:"flat-secondary",onClick:t,className:Hc({hidden:s},i),title:"Collapse",children:(0,d.jsx)(_s.J,{data:qc.Z,className:Hc({[r]:!0})})}),(0,d.jsx)(Zn.z,{view:"flat-secondary",onClick:a,className:Hc({hidden:!s},i),title:"Expand",children:(0,d.jsx)(_s.J,{data:qc.Z,className:Hc({[r]:!0},"rotate")})})]})}var Gc=a(77936),Zc=a(90861);const Wc=(0,c.cn)("kv-divider");const Jc=function(){return(0,d.jsx)("div",{className:Wc()})},Kc=(0,c.cn)("ydb-query-elapsed-time");function Yc(e){let{className:t}=e;const[,a]=n.useState({}),[s]=n.useState(Date.now()),r=Date.now()-s;n.useEffect((()=>{const e=setInterval((()=>{a({})}),x.NO);return()=>{clearInterval(e)}}),[]);const i=r>x.RQ*x.NO?(0,Rl.x9)(r).format("hh:mm:ss"):(0,Rl.x9)(r).format("mm:ss");return(0,d.jsx)(ve._,{className:Kc(null,t),children:i})}var Xc=a(4140),$c=a(56963);const ed=function(e){let{disabled:t}=e;const a=(0,y.zL)();return(0,d.jsx)(Zn.z,{onClick:()=>{a((0,$c.Xl)())},view:"flat-secondary",disabled:t,title:"Fullscreen",children:(0,d.jsx)(_s.J,{data:Xc.Z})})};var td,ad=a(57107);function nd(){return nd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},nd.apply(this,arguments)}const sd=function(e){return n.createElement("svg",nd({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},e),td||(td=n.createElement("path",{fill:"currentColor",d:"M13.383 6.5a.309.309 0 00.305-.305V5.18a.328.328 0 00-.305-.305H11.25V2.742a.328.328 0 00-.305-.304H9.93a.309.309 0 00-.305.304v3.149c0 .355.254.609.61.609h3.148zm-7.008-.61V2.743a.328.328 0 00-.305-.304H5.055a.309.309 0 00-.305.304v2.133H2.617a.309.309 0 00-.304.305v1.015c0 .178.126.305.304.305h3.149c.33 0 .609-.254.609-.61zm0 7.618v-3.149c0-.33-.28-.609-.61-.609H2.618a.309.309 0 00-.304.305v1.015c0 .178.126.305.304.305H4.75v2.133c0 .178.127.305.305.305H6.07a.309.309 0 00.305-.305zm4.875 0v-2.133h2.133a.309.309 0 00.305-.305v-1.015a.328.328 0 00-.305-.305h-3.149c-.355 0-.609.28-.609.61v3.148c0 .178.127.305.305.305h1.015a.309.309 0 00.305-.305z"})))};var rd;const id=(0,c.cn)("ydb-fullscreen"),od=null!==(rd=document.getElementById("fullscreen-root"))&&void 0!==rd?rd:void 0;const ld=function(e){let{children:t,className:a}=e;const s=(0,y.ix)((e=>e.fullscreen)),r=(0,y.zL)(),i=n.useCallback((()=>{r((0,$c.vj)())}),[r]);n.useEffect((()=>{const e=e=>{"Escape"===e.key&&i()};return document.addEventListener("keydown",e,!1),()=>{document.removeEventListener("keydown",e,!1)}}),[i]);const[o,l]=n.useState(null);n.useEffect((()=>{const e=document.createElement("div");return null===od||void 0===od||od.appendChild(e),e.style.display="contents",l(e),()=>{l(null),e.remove()}}),[]);const c=n.useRef(null);return n.useLayoutEffect((()=>{var e;o&&(s?null===od||void 0===od||od.appendChild(o):null===(e=c.current)||void 0===e||e.appendChild(o))}),[o,s]),o?(0,d.jsx)("div",{ref:c,style:{display:"contents"},children:(0,d.jsx)(ad.h,{container:o,children:(0,d.jsxs)("div",{className:id({fullscreen:s},a),children:[(0,d.jsx)(Zn.z,{onClick:i,view:"raised",className:id("close-button"),children:(0,d.jsx)(_s.J,{data:sd})}),t]})})}):null};var cd=a(2128);function dd(e){const t=n.useRef(null),a=n.useId(),{data:s,opts:r,shapes:i}=e;return n.useEffect((()=>{const e=t.current;if(!e)return;e.innerHTML="",e.style.setProperty("width","100vw"),e.style.setProperty("height","100vh");const a=(0,cd.hP)(e.id,s,r,i);return a.render(),e.style.setProperty("width","100%"),e.style.setProperty("height","100%"),()=>{a.destroy()}}),[s,r,i]),(0,d.jsx)("div",{id:a,ref:t,style:{overflow:"auto"}})}const ud={renderNodeTitle:e=>{const t=e.name.split("|");return t.length>1?t[1]:e.name},textOverflow:"normal",initialZoomFitsCanvas:!0},md={node:cd.od};function pd(e){return(0,d.jsx)(dd,{...e,opts:ud,shapes:md})}var hd=a(65375),vd=a(22155),gd=a(27320),xd=a(39934);function yd(e){var t;const a=(0,de.dt)(e);return"object"===typeof a&&"Query was cancelled"===(null===(t=a.error)||void 0===t?void 0:t.message)}var bd=a(30490);const fd=(0,c.cn)("ydb-query-settings-description"),jd=e=>{let{querySettings:t,prefix:a}=e;return(0,d.jsxs)("div",{className:fd("message"),children:[a,Object.entries(t).map(((e,t,a)=>{let[n,s]=e;return(0,d.jsxs)("span",{className:fd("description-item"),children:["".concat(n,": ").concat(s),t<a.length-1?", ":null]},t)}))]})},Nd=(0,c.cn)("kv-query-execution-status"),Sd=()=>{const{isIndicatorShown:e,changedLastExecutionSettingsDescriptions:t}=Mc();return e?(0,d.jsx)(gd.u,{openDelay:0,content:(0,d.jsx)(jd,{prefix:sc("banner.query-settings.message"),querySettings:t}),children:(0,d.jsx)(_s.J,{data:As.Z,className:Nd("query-settings-icon")})}):null},wd=e=>{let t,a,{className:n,error:s,loading:r}=e;if(r)t=(0,d.jsx)(xd.y,{size:"xs"}),a="Running";else if((0,bd.IZ)(s)&&"ECONNABORTED"===s.code)t=(0,d.jsx)(_s.J,{data:hd.Z}),a="Connection aborted";else if(yd(s))t=(0,d.jsx)(_s.J,{data:vd.Z}),a="Stopped";else{const e=Boolean(s);t=(0,d.jsx)(_s.J,{data:e?ks.Z:Rs.Z,className:Nd("result-status-icon",{error:e})}),a=e?"Failed":"Completed"}return(0,d.jsxs)("div",{className:Nd(null,n),children:[t,a,yd(s)||r?null:(0,d.jsx)(Sd,{})]})},Td=n.memo((function(e){const{className:t,value:a}=e,s=(0,y.zL)();return n.useEffect((()=>()=>{s((0,O.i8)())}),[s]),(0,d.jsx)("span",{className:Dd("cell",t),onClick:e=>s((0,O.hJ)(e.target,a,"cell")),children:a})})),Cd=JSON.parse('{"empty":"Table is empty"}'),Ed=JSON.parse('{"empty":"\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u043f\u0443\u0441\u0442\u0430\u044f"}'),Pd=(0,xe.wZ)("ydb-query-result-table",{ru:Ed,en:Cd}),Id={...x.LE,stripedRows:!0,dynamicRenderType:"variable",dynamicItemSizeGetter:()=>40},Dd=(0,c.cn)("ydb-query-result-table"),Rd=(e,t)=>t,Ad=e=>{const{columns:t,data:a,settings:s,...r}=e,i=n.useMemo((()=>(0,de.Xh)(a)),[a]),o=n.useMemo((()=>t?(e=>e.length?e.map((e=>{let{name:t,type:a}=e;const n=(0,de.T$)(a);return{name:t,align:"number"===n?Ne.ZP.RIGHT:Ne.ZP.LEFT,sortAccessor:e=>{const a=e[t];return void 0===a||null===a?null:"number"===n?BigInt(a):a},render:e=>{let{row:a}=e;return(0,d.jsx)(Td,{value:String(a[t])})}}})):[])(t):(e=>e.length?Object.keys(e[0]).map((t=>({name:t,align:(0,bn.kE)(e[0][t])?Ne.ZP.RIGHT:Ne.ZP.LEFT,sortAccessor:e=>(0,bn.kE)(e[t])?Number(e[t]):e[t],render:e=>{let{row:a}=e;return(0,d.jsx)(Td,{value:String(a[t])})}}))):[])(i)),[i,t]),l=n.useMemo((()=>({...Id,...s})),[s]);return Array.isArray(a)?o.length?(0,d.jsx)(le.G,{data:i,columns:o,settings:l,rowKey:Rd,...r}):(0,d.jsx)("div",{className:Dd("message"),children:Pd("empty")}):null};function kd(e){let{children:t,mode:a}=e;return(0,y.ix)((e=>"single"===a?e.singleClusterMode:!e.singleClusterMode))?(0,d.jsx)(n.Fragment,{children:t}):null}var Od=a(34147),_d=a(89799),Md=a(24829);const Ld=(0,c.cn)("ydb-query-explain-simplified-plan");function zd(e){let{value:t,formatter:a}=e;if(!(0,bn.kE)(t))return;const n=a(Number(t));return(0,d.jsx)("div",{className:Ld("metrics-cell"),children:n})}var qd=a(33569);const Fd={Table:"var(--g-color-text-info)",Predicate:"var(--g-color-text-positive)",Condition:"var(--g-color-text-utility)"};function Qd(e){return e in Fd?Fd[e]:"var(--g-color-text-secondary)"}function Bd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=[],a=Object.entries(e);if(1===a.length){const e=a[0][1],n=Qd(a[0][0]);t.push((0,d.jsx)("span",{style:{color:n},children:(0,_.fm)(e)},"param"))}else{const a=function(e){const t=[],{Table:a,Predicate:n,Condition:s,...r}=e;return a&&t.push(["Table",a]),n&&t.push(["Predicate",n]),s&&t.push(["Condition",s]),t.concat(Object.entries(r))}(e);for(let e=0;e<a.length;e++){const[n,s]=a[e],r=Qd(n);e>0&&t.push(", "),t.push((0,d.jsxs)("span",{style:{color:r},children:[n,": ",(0,_.fm)(s)]},e))}}return t}function Ud(e){let{params:t}=e;return t?(0,d.jsxs)("span",{className:Ld("operation-params"),children:["(",Bd(t),")"]}):null}const Hd=25,Vd=9;function Gd(e){let{modifiers:t,left:a}=e;return(0,d.jsx)("div",{className:Ld("divider",t),style:{left:a}})}function Zd(e){let{row:t,depth:a=0,params:s}=e;const{name:r,operationParams:i,lines:o=""}=s,l=t.getLeafRows().length>0&&t.getIsExpanded(),c=n.useMemo((()=>function(e,t){const a=e.split(".").map(Number),n=[];for(let s=0;s<a.length;s++)s===a.length-1&&0!==s&&(a[s]?n.push((0,d.jsx)(Gd,{modifiers:{horizontal:!0},left:Vd+1+Hd*(s-1)},"last")):n.push((0,d.jsx)(Gd,{modifiers:{last:!0},left:Vd+Hd*(s-1)},"last"))),s===a.length-1&&t&&n.push((0,d.jsx)(Gd,{modifiers:{first:!0},left:Vd+Hd*s},"first")),a[s]&&n.push((0,d.jsx)(Gd,{left:Vd+Hd*(s-1)},s));return n}(o,l)),[o,l]);return(0,d.jsxs)("div",{style:{paddingLeft:Hd*a},className:Ld("operation-name"),children:[c,(0,d.jsxs)(Ua.k,{gap:1,alignItems:"flex-start",className:Ld("operation-content"),children:[t.getCanExpand()&&(0,d.jsx)(Zn.z,{view:"flat",size:"xs",onClick:t.getToggleExpandedHandler(),children:(0,d.jsx)(Zn.z.Icon,{children:(0,d.jsx)(qd.F,{direction:t.getIsExpanded()?"bottom":"right",size:14})})}),(0,d.jsx)("div",{className:Ld("operation-name-content"),children:(0,d.jsxs)("div",{children:[r,"\xa0",(0,d.jsx)(Ud,{params:i})]})})]})]})}function Wd(e){return(0,d.jsx)(zd,{value:e.getValue(),formatter:e=>e<1e8?(0,Md.X)(e).format():(0,bn.t_)(e,1)})}function Jd(e){let{name:t}=e;return(0,d.jsx)("div",{className:Ld("table-header-content"),children:t})}const Kd=[{accessorKey:"name",accessorFn:function(e){return{name:e.name,operationParams:e.operationParams,lines:e.lines}},header:()=>(0,d.jsx)(Jd,{name:"Operation"}),size:600,cell:e=>(0,d.jsx)(Zd,{row:e.row,depth:e.row.depth,params:e.getValue()})},{accessorKey:"aCpu",header:()=>(0,d.jsx)(Jd,{name:"A-Cpu"}),size:90,minSize:100,cell:function(e){return(0,d.jsx)(zd,{value:e.getValue(),formatter:e=>(0,Ze.zm)(Math.round(e))})},meta:{align:"right",verticalAlign:"top"}},{accessorKey:"aRows",header:()=>(0,d.jsx)(Jd,{name:"A-Rows"}),size:90,minSize:100,cell:Wd,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eCost",header:()=>(0,d.jsx)(Jd,{name:"E-Cost"}),size:90,minSize:100,cell:Wd,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eRows",header:()=>(0,d.jsx)(Jd,{name:"E-Rows"}),size:90,minSize:100,cell:Wd,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eSize",header:()=>(0,d.jsx)(Jd,{name:"E-Size"}),size:90,minSize:100,cell:Wd,meta:{align:"right",verticalAlign:"top"}}];function Yd(e){let{plan:t}=e;const a=n.useMemo((()=>function(e){if(!e)return[];const t=[{items:e,prefix:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",parentIndex:-1,parentArray:[]}],a=[];for(;t.length>0;){const{items:e,prefix:n,parentIndex:s,parentArray:r}=t.pop(),i=[];for(let a=0;a<e.length;a++){const s={...e[a]},r=a<e.length-1?1:0;let o="".concat(n,".").concat(r);n||(o=String(r)),s.lines=o,i.push(s),s.children&&t.push({items:s.children,prefix:o,parentIndex:a,parentArray:i})}-1===s?a.push(...i):r[s].children=i}return a}(t)),[t]),[s,r]=n.useState(!0),i=(0,Od.x)({columns:Kd,data:a,getSubRows:e=>e.children,enableExpanding:!0,onExpandedChange:r,state:{expanded:s}});return(0,d.jsx)("div",{className:Ld(),children:(0,d.jsx)(_d.i,{table:i,headerCellClassName:e=>{var t;let{column:a}=e;const n=null===(t=a.columnDef.meta)||void 0===t?void 0:t.align;return Ld("table-header-cell",{align:n})},cellClassName:e=>{var t,a;const n=null===e||void 0===e||null===(t=e.column.columnDef.meta)||void 0===t?void 0:t.align,s=null===e||void 0===e||null===(a=e.column.columnDef.meta)||void 0===a?void 0:a.verticalAlign;return Ld("table-cell",{align:n,"vertical-align":s})},className:Ld("table"),stickyHeader:!0})})}var Xd=a(67585),$d=a(57225),eu=a(76506);const tu=JSON.parse('{"default_collapse_label":"Show less","default_expand_label":"Show more","chars_count":[" ({{count}} symbol)"," ({{count}} symbols)"," ({{count}} symbols)"," ({{count}} symbols)"]}'),au=JSON.parse('{"default_collapse_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435","default_expand_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0435\u0449\u0451","chars_count":[" ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u0430)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"]}'),nu=(0,xe.wZ)("ydb-shorty-string",{ru:au,en:tu}),su=(0,c.cn)("kv-shorty-string");function ru(e){let{value:t="",limit:a=200,strict:s=!1,displayLength:r=!0,render:i=(e=>e),onToggle:o,expandLabel:l=nu("default_expand_label"),collapseLabel:c=nu("default_collapse_label")}=e;const[u,m]=n.useState(!1),p=(u?c:l)+(r&&!u?nu("chars_count",{count:t.length}):""),h=t.length>a+(s?0:p.length),v=u||!h?t:t.slice(0,a-4)+"\xa0...";return(0,d.jsxs)("div",{className:su(),children:[i(v),h?(0,d.jsx)(Zr.r,{className:su("toggle"),href:"#",onClick:e=>{e.stopPropagation(),e.preventDefault(),m((e=>!e)),null===o||void 0===o||o()},children:p}):null]})}const iu=["S_FATAL","S_ERROR","S_WARNING","S_INFO"];function ou(e){return function(e){return!!e&&void 0!==iu[e]}(e)?iu[e]:"S_INFO"}const lu=(0,c.cn)("kv-result-issues"),cu=(0,c.cn)("kv-issues"),du=(0,c.cn)("kv-issue");function uu(e){let{data:t}=e;const[a,s]=n.useState(!1),r="string"===typeof t||null===t||void 0===t?void 0:t.issues,i=Array.isArray(r)&&r.length>0;return(0,d.jsxs)("div",{className:lu(),children:[(0,d.jsxs)("div",{className:lu("error-message"),children:[(()=>{let e;if("string"===typeof t)e=t;else{var a,s;const r=ou(null===t||void 0===t||null===(a=t.error)||void 0===a?void 0:a.severity);e=(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(xu,{severity:r})," ",(0,d.jsx)("span",{className:lu("error-message-text"),children:null===t||void 0===t||null===(s=t.error)||void 0===s?void 0:s.message})]})}return e})(),i&&(0,d.jsx)(Zn.z,{view:"normal",onClick:()=>s(!a),children:a?"Hide details":"Show details"})]}),i&&a&&(0,d.jsx)(mu,{issues:r})]})}function mu(e){let{issues:t}=e;const a=null===t||void 0===t?void 0:t.reduce(((e,t)=>{var a;const n=null!==(a=t.severity)&&void 0!==a?a:10;return Math.min(e,n)}),10);return(0,d.jsx)("div",{className:cu(null),children:null===t||void 0===t?void 0:t.map(((e,t)=>(0,d.jsx)(pu,{issue:e,expanded:e===a},t)))})}function pu(e){let{issue:t,level:a=0}=e;const[s,r]=n.useState(!0),i=ou(t.severity),o=function(e){const{position:t}=e;if("object"!==typeof t||null===t||!(0,bn.kE)(t.row))return"";const{row:a,column:n}=t;return(0,bn.kE)(n)?"".concat(a,":").concat(n):"line ".concat(a)}(t),l=t.issues,c=Array.isArray(l)&&l.length>0,u=s?"bottom":"right";return(0,d.jsxs)("div",{className:du({leaf:!c,"has-issues":c}),children:[(0,d.jsxs)("div",{className:du("line"),children:[c&&(0,d.jsx)(Zn.z,{view:"flat-secondary",onClick:()=>r(!s),className:du("arrow-toggle"),children:(0,d.jsx)(qd.F,{direction:u,size:16})}),(0,d.jsx)(xu,{severity:i}),(0,d.jsxs)("span",{className:du("message"),children:[o&&(0,d.jsx)("span",{className:du("place-text"),title:"Position",children:o}),(0,d.jsx)("div",{className:du("message-text"),children:(0,d.jsx)(ru,{value:t.message,expandLabel:"Show full message"})})]}),t.issue_code?(0,d.jsxs)("span",{className:du("code"),children:["Code: ",t.issue_code]}):null]}),c&&s&&(0,d.jsx)("div",{className:du("issues"),children:(0,d.jsx)(hu,{issues:l,level:a+1,expanded:s})})]})}function hu(e){const{issues:t,level:a,expanded:n}=e;return(0,d.jsx)("div",{className:du("list"),children:t.map(((e,t)=>(0,d.jsx)(pu,{issue:e,level:a,expanded:n},t)))})}const vu={S_INFO:Xd.Z,S_WARNING:$d.Z,S_ERROR:Os.Z,S_FATAL:eu.Z},gu=(0,c.cn)("yql-issue-severity");function xu(e){let{severity:t}=e;const a=t.slice(2).toLowerCase();return(0,d.jsxs)("span",{className:gu({severity:a}),children:[(0,d.jsx)(_s.J,{className:gu("icon"),data:vu[t]}),(0,d.jsx)("span",{className:gu("title"),children:a})]})}const yu=(0,c.cn)("ydb-query-duration"),bu=e=>{let{duration:t}=e;if(!t)return null;const a=(0,Ze.tt)((0,Ze.BO)(t),1);return(0,d.jsx)("span",{className:yu(),children:(0,d.jsx)(pt,{className:yu("item-with-popover"),contentClassName:yu("popover-content"),text:a,popoverClassName:yu("popover"),popoverContent:sc("query-duration.description"),buttonProps:{className:yu("popover-button")}})})};var fu=a(68750);const ju=(0,c.cn)("ydb-query-settings-banner");function Nu(){const{isBannerShown:e,changedLastExecutionSettingsDescriptions:t,closeBanner:a}=Mc();return e?(0,d.jsx)(fu.b,{className:ju(),theme:"info",align:"baseline",message:(0,d.jsx)(jd,{prefix:sc("banner.query-settings.message"),querySettings:t}),onClose:a}):null}function Su(e){return e.replaceAll("\\","\\\\").replaceAll("\n","\\n").replaceAll("\r","\\r").replaceAll("\t","\\t")}var wu=a(77915);const Tu=ue.h.injectEndpoints({endpoints:function(e){return{checkTrace:e.query({queryFn:async(e,t)=>{let{url:a}=e,{signal:n}=t;try{if(!a)throw new Error("no tracecheck url provided");return{data:await window.api.checkTrace({url:a},{signal:n})}}catch(s){return{error:s}}}})}}});var Cu=a(42587);function Eu(e,t){return e.replace(/\${(\w+)}/g,((e,a)=>t[a]||e))}const Pu=JSON.parse('{"description.graph-is-not-supported":"Graph can not be rendered","action.result":"Result","action.stats":"Stats","action.schema":"Schema","action.stop":"Stop","action.explain-plan":"Explain Plan","action.copy":"Copy {{activeSection}}","trace":"Trace"}'),Iu=(0,xe.wZ)("ydb-execute-result",{en:Pu}),Du=(0,c.cn)("ydb-query-execute-result"),Ru=15*x.NO;function Au(e){return Boolean(e&&e.TraceCheck&&"string"===typeof e.TraceCheck.url)}function ku(e){var t;let{traceId:a}=e;const[s]=(0,r.useQueryParams)({clusterName:r.StringParam}),{data:{clusterData:i}={}}=wu.UM.useGetClusterInfoQuery(null!==(t=s.clusterName)&&void 0!==t?t:void 0,{skip:!a}),o=Boolean(Au(i)&&a),l=a&&Au(i)?Eu(i.TraceCheck.url,{traceId:a}):"",[c,u]=(0,Cu.$)(Ru);n.useEffect((()=>{u()}),[a,u]);const{currentData:m,error:p}=Tu.useCheckTraceQuery({url:l},{skip:!o||!c}),h=function(e){return Boolean(e&&e.TraceView&&"string"===typeof e.TraceView.url)}(i)&&a?Eu(i.TraceView.url,{traceId:a}):"";return h?(0,d.jsx)(Zn.z,{view:"flat-secondary",loading:!m&&!p,children:(0,d.jsx)(Ia.j,{className:Du("trace-link",{loading:!m&&!p}),title:Iu("trace"),url:h,external:!0})}):null}const Ou=(0,c.cn)("ydb-query-execute-result"),_u={result:"result",stats:"stats",schema:"schema",simplified:"simplified"};function Mu(e){var t,a,s;let{data:r,error:i,cancelError:l,isResultsCollapsed:c,onCollapseResults:u,onExpandResults:m,onStopButtonClick:p,theme:h,loading:v,cancelQueryLoading:g}=e;const[x,b]=n.useState(0),[f,j]=n.useState(_u.result),N=(0,y.zL)(),S=null===r||void 0===r?void 0:r.stats,T=null===r||void 0===r||null===(t=r.resultSets)||void 0===t?void 0:t.length,C=T&&T>0,E=C?null===r||void 0===r||null===(a=r.resultSets)||void 0===a?void 0:a[x].result:null===r||void 0===r?void 0:r.result,P=C?null===r||void 0===r||null===(s=r.resultSets)||void 0===s?void 0:s[x].columns:null===r||void 0===r?void 0:r.columns,{plan:I,simplifiedPlan:D}=n.useMemo((()=>function(e){var t,a,n;if(!e)return{};const{plan:s}=e;if(s){const e=(0,de.y5)(s);if(e.meta.version!==bc.v2)return{};const{Plan:t,SimplifiedPlan:a}=e;return{plan:t?{...xc(t),tables:e.tables}:void 0,simplifiedPlan:{plan:a?yc([a]):void 0,pristine:a}}}const{stats:r}=e,i=null===r||void 0===r||null===(t=r.Executions)||void 0===t||null===(a=t[0])||void 0===a||null===(n=a.TxPlansWithStats)||void 0===n?void 0:n[0];if(!i)return{};try{return{plan:xc(JSON.parse(i))}}catch(o){return{}}}(r)),[r]),R=[{value:_u.result,content:Iu("action.result")},{value:_u.stats,content:Iu("action.stats")}];I&&R.push({value:_u.schema,content:Iu("action.schema")}),null!==D&&void 0!==D&&D.plan&&R.push({value:_u.simplified,content:Iu("action.explain-plan")});const A=(0,de.dt)(i);n.useEffect((()=>()=>{N((0,$c.vj)())}),[N]);const k=(e,t)=>(0,d.jsx)(Ad,{data:e,columns:t,settings:{sortable:!1}}),O=()=>{switch(f){case _u.result:{const e=function(e){if(null===e||void 0===e||!e.length)return"";const t=Object.keys(e[0]),a=[t.map(Su).join("\t")];for(const n of e){const e=[];for(const a of t){const t=n[a];e.push(Su("object"===typeof t?JSON.stringify(t):"".concat(t)))}a.push(e.join("\t"))}return a.join("\n")}(E);return e}case _u.stats:return S;case _u.simplified:return null===D||void 0===D?void 0:D.pristine;default:return}};return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)("div",{className:Ou("controls"),children:[(0,d.jsxs)("div",{className:Ou("controls-right"),children:[(0,d.jsx)(wd,{error:i,loading:v}),!i&&!v&&(0,d.jsxs)(n.Fragment,{children:[void 0!==(null===S||void 0===S?void 0:S.DurationUs)&&(0,d.jsx)(bu,{duration:Number(S.DurationUs)}),R&&f&&(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Jc,{}),(0,d.jsx)(Hl.E,{options:R,value:f,onUpdate:e=>{j(e)}})]})]}),v?(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Yc,{className:Ou("elapsed-time")}),(0,d.jsxs)(Zn.z,{loading:g,onClick:p,className:Ou("stop-button",{error:Boolean(l)}),children:[(0,d.jsx)(_s.J,{data:Gc.Z,size:16}),Iu("action.stop")]})]}):null,(0,d.jsx)(kd,{mode:"multi",children:(0,d.jsx)(ku,{traceId:null===r||void 0===r?void 0:r.traceId})})]}),(0,d.jsxs)("div",{className:Ou("controls-left"),children:[(()=>{const e=O(),t=(0,_.fm)(e);return t?(0,d.jsx)(Zc.m,{text:t,view:"flat-secondary",title:Iu("action.copy",{activeSection:f})}):null})(),(0,d.jsx)(ed,{}),(0,d.jsx)(Vc,{onCollapse:u,onExpand:m,isCollapsed:c,initialDirection:"bottom"})]})]}),v||yd(i)?null:(0,d.jsx)(Nu,{}),(0,d.jsx)(o.s,{loading:v,children:(0,d.jsx)(ld,{children:i&&!yd(i)?A?"object"===typeof A?(0,d.jsx)(uu,{data:A}):(0,d.jsx)("div",{className:Ou("error"),children:A}):null:f===_u.result?(0,d.jsxs)("div",{className:Ou("result-wrapper"),children:[C&&T>1&&(0,d.jsx)("div",{children:(0,d.jsx)(w.m,{className:Ou("result-tabs"),size:"l",items:(0,yn.c$)(T).map((e=>({id:String(e),title:"Result #".concat(e+1)}))),activeTab:String(x),onSelectTab:e=>b(Number(e))})}),(0,d.jsx)("div",{className:Ou("result"),children:k(E,P)})]}):f===_u.stats?(0,d.jsx)("div",{className:Ou("inspector"),children:(0,d.jsx)(Zt(),{data:S,isExpanded:()=>!0,searchOptions:{debounceTime:300}})}):f===_u.schema?(null===I||void 0===I?void 0:I.links)&&(null===I||void 0===I?void 0:I.nodes)&&(null===I||void 0===I?void 0:I.nodes.length)?(0,d.jsx)("div",{className:Ou("explain-canvas-container"),children:(0,d.jsx)(pd,{data:I},h)}):Iu("description.graph-is-not-supported"):f===_u.simplified?(()=>{const{plan:e}=null!==D&&void 0!==D?D:{};return e?(0,d.jsx)(Yd,{plan:e}):null})():null})})]})}var Lu=a(93757);const zu=(0,c.cn)("ydb-query-explain-ast"),qu={automaticLayout:!0,selectOnLineNumbers:!0,readOnly:!0,minimap:{enabled:!1},wrappingIndent:"indent"};function Fu(e){let{ast:t,theme:a}=e;return(0,d.jsx)("div",{className:zu(),children:(0,d.jsx)(Lu.default,{language:Lc,value:t,options:qu,theme:"vs-".concat(a)})})}const Qu=JSON.parse('{"description.empty-result":"There is no {{activeOption}} for the request","description.graph-is-not-supported":"Graph can not be rendered","action.schema":"Schema","action.explain-plan":"Explain Plan","action.json":"JSON","action.ast":"AST","action.copy":"Copy {{activeOption}}","action.stop":"Stop"}'),Bu=(0,xe.wZ)("ydb-explain-result",{en:Qu}),Uu=(0,c.cn)("ydb-query-explain-graph");function Hu(e){let{explain:t,theme:a}=e;const{links:n,nodes:s,version:r}=null!==t&&void 0!==t?t:{},i=r===bc.v2,o=n&&s&&s.length;return i&&o?(0,d.jsx)("div",{className:Uu("canvas-container"),children:(0,d.jsx)(pd,{data:{links:n,nodes:s}},a)}):(0,d.jsx)("div",{className:Uu("text-message"),children:Bu("description.graph-is-not-supported")})}const Vu=(0,c.cn)("ydb-query-explain-text");function Gu(e){let{explain:t}=e;return(0,d.jsx)(Zt(),{data:t,isExpanded:()=>!0,className:Vu("inspector"),searchOptions:{debounceTime:300}})}const Zu=(0,c.cn)("ydb-query-explain-result"),Wu={schema:"schema",json:"json",ast:"ast",simplified:"simplified"},Ju={[Wu.schema]:Bu("action.schema"),[Wu.json]:Bu("action.json"),[Wu.ast]:Bu("action.ast"),[Wu.simplified]:Bu("action.explain-plan")},Ku=[{value:Wu.schema,content:Ju[Wu.schema]},{value:Wu.simplified,content:Ju[Wu.simplified]},{value:Wu.json,content:Ju[Wu.json]},{value:Wu.ast,content:Ju[Wu.ast]}];function Yu(e){let{explain:t,ast:a,theme:s,error:r,cancelError:i,loading:l,cancelQueryLoading:c,onCollapseResults:u,onExpandResults:m,onStopButtonClick:p,isResultsCollapsed:h,simplifiedPlan:v}=e;const g=(0,y.zL)(),[x,b]=n.useState(Wu.schema),[f,j]=n.useTransition();n.useEffect((()=>()=>{g((0,$c.vj)())}),[g]);const N=()=>(0,d.jsx)("div",{className:Zu("text-message"),children:Bu("description.empty-result",{activeOption:Ju[x]})}),S=(()=>{switch(x){case Wu.json:return null===t||void 0===t?void 0:t.pristine;case Wu.ast:return a;case Wu.simplified:return null===v||void 0===v?void 0:v.pristine;default:return}})(),w=(0,_.fm)(S);return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)("div",{className:Zu("controls"),children:[(0,d.jsxs)("div",{className:Zu("controls-right"),children:[(0,d.jsx)(wd,{error:r,loading:l}),!r&&!l&&(0,d.jsxs)(n.Fragment,{children:[void 0!==(null===t||void 0===t?void 0:t.DurationUs)&&(0,d.jsx)(bu,{duration:t.DurationUs}),(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Jc,{}),(0,d.jsx)(Hl.E,{options:Ku,value:x,onUpdate:e=>{j((()=>b(e)))}})]})]}),l?(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Yc,{className:Zu("elapsed-time")}),(0,d.jsxs)(Zn.z,{loading:c,onClick:p,className:Zu("stop-button",{error:Boolean(i)}),children:[(0,d.jsx)(_s.J,{data:Gc.Z,size:16}),Bu("action.stop")]})]}):null]}),(0,d.jsxs)("div",{className:Zu("controls-left"),children:[w&&(0,d.jsx)(Zc.m,{text:w,view:"flat-secondary",title:Bu("action.copy",{activeOption:x})}),(0,d.jsx)(ed,{disabled:Boolean(r)}),(0,d.jsx)(Vc,{onCollapse:u,onExpand:m,isCollapsed:h,initialDirection:"bottom"})]})]}),l||yd(r)?null:(0,d.jsx)(Nu,{}),(0,d.jsx)(o.s,{loading:l||f,children:(0,d.jsx)(ld,{className:Zu("result"),children:(()=>{if(yd(r))return null;if(r)return(0,d.jsx)("div",{className:Zu("text-message"),children:(0,de.fV)(r)});switch(x){case Wu.json:return null!==t&&void 0!==t&&t.pristine?(0,d.jsx)(Gu,{explain:t.pristine}):N();case Wu.ast:return a?(0,d.jsx)(Fu,{ast:a,theme:s}):N();case Wu.schema:var e;return null!==t&&void 0!==t&&null!==(e=t.nodes)&&void 0!==e&&e.length?(0,d.jsx)(Hu,{theme:s,explain:t}):N();case Wu.simplified:{const{plan:e}=null!==v&&void 0!==v?v:{};return null!==e&&void 0!==e&&e.length?(0,d.jsx)(Yd,{plan:e}):N()}default:return null}})()})})]})}const Xu=ue.h.injectEndpoints({endpoints:e=>({sendQuery:e.query({queryFn:async(e,t)=>{let{query:a,database:n,action:s}=e,{signal:r}=t;try{const e=await window.api.sendQuery({schema:"modern",query:a,database:n,action:s},{signal:r,withRetries:!0});return(0,de.gW)(e)?{error:e}:{data:(0,de.gY)(e)}}catch(i){return{error:i||new Error("Unauthorized")}}},providesTags:["All","PreviewData"]})}),overrideExisting:"throw"}),$u=(0,c.cn)("kv-preview"),em=e=>{var t;let{database:a,path:n,type:s}=e;const r=(0,y.zL)(),i=(0,he.vp)(s),[o]=(0,y.Rj)(),l="--!syntax_v1\nselect * from `".concat(n,"` limit 32"),{currentData:c,isFetching:u,error:m}=Xu.useSendQueryQuery({database:a,query:l,action:(0,he.uL)(s)?"execute-query":"execute-scan"},{pollingInterval:o,skip:!i,refetchOnMountOrArgChange:!0}),p=null!==c&&void 0!==c?c:{},h=()=>{r((0,g.m7)(!1))};if(u&&void 0===c)return(0,d.jsx)("div",{className:$u("loader-container"),children:(0,d.jsx)(En.a,{size:"m"})});let v;i?m&&(v=(0,d.jsx)("div",{className:$u("message-container","error"),children:(0,de.fV)(m)})):v=(0,d.jsx)("div",{className:$u("message-container"),children:sc("preview.not-available")});const x=null!==(t=v)&&void 0!==t?t:(0,d.jsx)("div",{className:$u("result"),children:(0,d.jsx)(Ad,{data:p.result,columns:p.columns})});return(0,d.jsxs)("div",{className:$u(),children:[(0,d.jsxs)("div",{className:$u("header"),children:[(0,d.jsxs)("div",{className:$u("title"),children:[sc("preview.title")," ",(0,d.jsx)("div",{className:$u("table-name"),children:n})]}),(0,d.jsxs)("div",{className:$u("controls-left"),children:[(0,d.jsx)(ed,{disabled:Boolean(m)}),(0,d.jsx)(Zn.z,{view:"flat-secondary",onClick:h,title:sc("preview.close"),children:(0,d.jsx)(_s.J,{data:oo.Z,size:18})})]})]}),(0,d.jsx)(ld,{children:x})]})};var tm=a(21645),am=a(46089),nm=a(30831),sm=a(25822),rm=a(77264);function im(){const[e]=(0,y.yu)(x.DG,[]),t=(0,y.ix)(Nc.zC).toLowerCase();return t?e.filter((e=>e.body.toLowerCase().includes(t))):e}const om=JSON.parse('{"action.save":"Save query","action.edit":"Edit query","action.save-as-new":"Save as new","action.edit-existing":"Edit existing","description":"The query will be saved in your browser","input-label":"Query name","input-placeholder":"Enter query name","button-apply":"Save","button-cancel":"Cancel","error.name-exists":"This name already exists","error.name-not-empty":"Name should not be empty"}'),lm=(0,xe.wZ)("ydb-save-query-dialog",{en:om}),cm=(0,c.cn)("ydb-save-query");function dm(e){let{isSaveButtonDisabled:t}=e;const a=(0,y.zL)(),n=(0,y.ix)(Nc.g0),s=()=>{a((0,Nc.lm)("save")),a((0,Nc.y3)())},r=()=>{a((0,Nc.PM)(n)),a((0,Nc.y3)())};return n?(()=>{const e=[{action:r,text:lm("action.edit-existing")},{action:s,text:lm("action.save-as-new")}];return(0,d.jsx)(nm.h,{items:e,renderSwitcher:e=>(0,d.jsx)(Zn.z,{...e,disabled:t,children:lm("action.edit")}),popupProps:{placement:"top"}})})():(0,d.jsx)(Zn.z,{onClick:s,disabled:t,children:lm("action.save")})}function um(){const e=im(),t=(0,y.zL)(),a=(0,y.ix)(Nc.oK),[s,r]=n.useState(""),[i,o]=n.useState(),l=()=>{t((0,Nc.lm)("idle")),r(""),o(void 0)};return(0,d.jsxs)(sm.V,{open:"save"===a,hasCloseButton:!1,size:"s",onClose:l,children:[(0,d.jsx)(sm.V.Header,{caption:lm("action.save")}),(0,d.jsxs)("form",{onSubmit:a=>{a.preventDefault();const n=(r=s)?e.some((e=>e.name.toLowerCase()===r.trim().toLowerCase()))?lm("error.name-exists"):void 0:lm("error.name-not-empty");var r;o(n),n||(t((0,Nc.PM)(s)),l())},children:[(0,d.jsxs)(sm.V.Body,{className:cm("dialog-body"),children:[(0,d.jsx)("div",{className:cm("dialog-row"),children:lm("description")}),(0,d.jsxs)("div",{className:cm("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"queryName",className:cm("field-title","required"),children:lm("input-label")}),(0,d.jsx)("div",{className:cm("control-wrapper"),children:(0,d.jsx)(rm.o,{id:"queryName",placeholder:lm("input-placeholder"),value:s,onUpdate:e=>{r(e),o(void 0)},hasClear:!0,autoFocus:!0,autoComplete:!1,validationState:i?"invalid":void 0,errorMessage:i})})]})]}),(0,d.jsx)(sm.V.Footer,{textButtonApply:lm("button-apply"),textButtonCancel:lm("button-cancel"),onClickButtonCancel:l,propsButtonApply:{type:"submit"}})]})]})}const mm=(0,c.cn)("ydb-query-editor-controls"),pm=e=>{let{onClick:t,runIsLoading:a}=e;const{changedCurrentSettings:n,changedCurrentSettingsDescriptions:s}=Mc(),r=n.length>0?{view:"outlined-info",selected:!0}:null;return(0,d.jsx)(gd.u,{disabled:0===n.length,content:(0,d.jsx)(jd,{prefix:sc("gear.tooltip"),querySettings:s}),openDelay:0,placement:["top-start"],children:(0,d.jsxs)(Zn.z,{onClick:t,loading:a,className:mm("gear-button"),...r,children:[(0,d.jsx)(_s.J,{data:tm.Z,size:16}),r?(0,d.jsxs)("div",{className:mm("changed-settings"),children:["(",n.length,")"]}):null]})})},hm=e=>{let{disabled:t,isLoading:a,highlightedAction:n,handleSendExecuteClick:s,onSettingsButtonClick:r,handleGetExplainQueryClick:i}=e;const o="execute"===n?"action":void 0,l="explain"===n?"action":void 0;return(0,d.jsxs)("div",{className:mm(),children:[(0,d.jsxs)("div",{className:mm("left"),children:[(0,d.jsxs)(Zn.z,{onClick:()=>{s()},disabled:t,loading:a,view:o,className:mm("run-button"),children:[(0,d.jsx)(_s.J,{data:am.Z,size:14}),"Run"]}),(0,d.jsx)(Zn.z,{onClick:()=>{i()},disabled:t,loading:a,view:l,children:"Explain"}),(0,d.jsx)(pm,{onClick:r,runIsLoading:a})]}),(0,d.jsx)(dm,{isSaveButtonDisabled:t})]})};var vm=a(48450);const gm=()=>-1,xm=(0,c.cn)("ydb-query-settings-select");function ym(e){return(0,d.jsx)("div",{className:xm("selector"),children:(0,d.jsx)(I.P,{options:e.settingOptions,value:[e.setting],onUpdate:t=>{e.onUpdateSetting(t[0])},getOptionHeight:gm,popupClassName:xm("popup"),renderOption:e=>(0,d.jsxs)("div",{className:xm("item"),children:[(0,d.jsxs)("div",{className:xm("item-title"),children:[e.content,e.isDefault?Cc("description.default"):""]}),e.text&&(0,d.jsx)("span",{className:xm("item-description"),children:e.text})]}),width:"max"})})}const bm=(0,c.cn)("ydb-query-settings-dialog");function fm(){const e=(0,y.zL)(),t=(0,y.ix)(Nc.oK),[a,s]=(0,y.dU)(),r=n.useCallback((()=>{e((0,Nc.lm)("idle"))}),[e]),i=n.useCallback((e=>{s(e),r()}),[r,s]);return(0,d.jsxs)(sm.V,{open:"settings"===t,size:"s",onClose:r,className:bm(),hasCloseButton:!1,children:[(0,d.jsx)(sm.V.Header,{caption:Cc("action.settings")}),(0,d.jsx)(jm,{initialValues:a,onSubmit:i,onClose:r})]})}function jm(e){let{initialValues:t,onSubmit:a,onClose:s}=e;const{control:r,handleSubmit:i}=(0,vm.cI)({defaultValues:t}),o=(0,mc.uY)();return(0,d.jsxs)("form",{onSubmit:i(a),children:[(0,d.jsxs)(sm.V.Body,{className:bm("dialog-body"),children:[(0,d.jsxs)(Ua.k,{direction:"row",alignItems:"flex-start",className:bm("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"queryMode",className:bm("field-title"),children:Rc.queryMode.title}),(0,d.jsx)("div",{className:bm("control-wrapper",{queryMode:!0}),children:(0,d.jsx)(vm.Qr,{name:"queryMode",control:r,render:e=>{let{field:t}=e;return(0,d.jsx)(ym,{setting:t.value,onUpdateSetting:t.onChange,settingOptions:Rc.queryMode.options})}})})]}),(0,d.jsxs)(Ua.k,{direction:"row",alignItems:"flex-start",className:bm("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"timeout",className:bm("field-title"),children:Rc.timeout.title}),(0,d.jsx)("div",{className:bm("control-wrapper"),children:(0,d.jsx)(vm.Qr,{name:"timeout",control:r,render:e=>{let{field:t}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(rm.o,{type:"number",...t,className:bm("timeout"),placeholder:"60"}),(0,d.jsx)("span",{className:bm("timeout-suffix"),children:Cc("form.timeout.seconds")})]})}})})]}),o&&(0,d.jsxs)(Ua.k,{direction:"row",alignItems:"flex-start",className:bm("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"tracingLevel",className:bm("field-title"),children:Rc.tracingLevel.title}),(0,d.jsx)("div",{className:bm("control-wrapper"),children:(0,d.jsx)(vm.Qr,{name:"tracingLevel",control:r,render:e=>{let{field:t}=e;return(0,d.jsx)(ym,{setting:t.value,onUpdateSetting:t.onChange,settingOptions:Rc.tracingLevel.options})}})})]}),(0,d.jsxs)(Ua.k,{direction:"row",alignItems:"flex-start",className:bm("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"transactionMode",className:bm("field-title"),children:Rc.transactionMode.title}),(0,d.jsx)("div",{className:bm("control-wrapper",{transactionMode:!0}),children:(0,d.jsx)(vm.Qr,{name:"transactionMode",control:r,render:e=>{let{field:t}=e;return(0,d.jsx)(ym,{setting:t.value,onUpdateSetting:t.onChange,settingOptions:Rc.transactionMode.options})}})})]}),(0,d.jsxs)(Ua.k,{direction:"row",alignItems:"flex-start",className:bm("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"statisticsMode",className:bm("field-title"),children:Rc.statisticsMode.title}),(0,d.jsx)("div",{className:bm("control-wrapper",{statisticsMode:!0}),children:(0,d.jsx)(vm.Qr,{name:"statisticsMode",control:r,render:e=>{let{field:t}=e;return(0,d.jsx)(ym,{setting:t.value,onUpdateSetting:t.onChange,settingOptions:Rc.statisticsMode.options})}})})]})]}),(0,d.jsx)(sm.V.Footer,{textButtonApply:Cc("button-done"),textButtonCancel:Cc("button-cancel"),onClickButtonCancel:s,propsButtonApply:{type:"submit"},renderButtons:(e,t)=>(0,d.jsxs)("div",{className:bm("buttons-container"),children:[(0,d.jsx)(Zr.r,{href:"https://ydb.tech/docs",target:"_blank",className:bm("documentation-link"),children:Cc("docs")}),(0,d.jsxs)("div",{className:bm("main-buttons"),children:[t,e]})]})})]})}const Nm={automaticLayout:!0,selectOnLineNumbers:!0,minimap:{enabled:!1}};const Sm="navigation",wm={EXECUTE:"execute",EXPLAIN:"explain"},Tm=(0,c.cn)("query-editor"),Cm={triggerExpand:!1,triggerCollapse:!1,collapsed:!0};const Em={saveQueryToHistory:ir.hO,goToPreviousQuery:ir.NU,goToNextQuery:ir.AJ,setShowPreview:g.m7,setTenantPath:ir.K0,setQueryAction:Nc.lm},Pm=(0,Wt.$j)((e=>({executeQuery:e.executeQuery,showPreview:e.schema.showPreview})),Em)((function(e){var t,a;const s=function(){const[e]=(0,y.yu)(x.y6),[t]=(0,y.yu)(x.XX);return n.useMemo((()=>{const a=Boolean(e);return{quickSuggestions:a,suggestOnTriggerCharacters:a,acceptSuggestionOnEnter:t?"on":"off",...Nm}}),[e,t])}(),{tenantName:r,path:i,setTenantPath:o,executeQuery:l,type:c,theme:u,changeUserInput:m,showPreview:p}=e,{tenantPath:v}=l,[g,b]=n.useState(),[f,j]=n.useState(!1),[N]=(0,y.dU)(),S=(0,mc.uY)(),[w,T]=Oc(),{resetBanner:C}=Mc(),[E]=(0,y.yu)(x.Rq),[P,I]=(0,y.yu)(x.w7),[D,R]=ir.mg.useExecuteQueryMutation(),[A,k]=jc.useExplainQueryMutation(),[O,_]=uc.useCancelQueryMutation();n.useEffect((()=>{v!==r&&(v&&m({input:""}),o(r))}),[m,o,r,v]);const[M,z]=n.useReducer(Uc(x.eG),Cm);n.useEffect((()=>{z(Fc.triggerCollapse)}),[]),n.useEffect((()=>{e.showPreview||f?z(Fc.triggerExpand):z(Fc.triggerCollapse)}),[e.showPreview,f]);const q=(0,y.xd)((()=>{var e;const{history:t}=l;return(null===(e=t.queries[t.queries.length-1])||void 0===e?void 0:e.queryText)||""})),F=(0,y.xd)((t=>{const{input:a,history:n}=l,s=E?"multi":"modern",i=null!==t&&void 0!==t?t:a;I(de.Jf.execute),(0,lc.isEqual)(w,N)||(C(),T(N));const o=(0,cc.Z)();if(b(wm.EXECUTE),D({query:i,database:r,querySettings:N,schema:s,enableTracingLevel:S,queryId:o}),j(!0),e.setShowPreview(!1),_.reset(),!t){var c;const{queries:t,currentIndex:s}=n;i!==(null===(c=t[s])||void 0===c?void 0:c.queryText)&&e.saveQueryToHistory(a,o)}z(Fc.triggerExpand)})),Q=()=>{e.setQueryAction("settings")},B=(0,y.xd)((()=>{const{input:t}=l;I(de.Jf.explain),(0,lc.isEqual)(w,N)||(C(),T(N));const a=(0,cc.Z)();b(wm.EXPLAIN),A({query:t,database:r,querySettings:N,enableTracingLevel:S,queryId:a}),j(!0),e.setShowPreview(!1),_.reset(),z(Fc.triggerExpand)})),U=R.isLoading?null===(t=R.originalArgs)||void 0===t?void 0:t.queryId:null===(a=k.originalArgs)||void 0===a?void 0:a.queryId,H=n.useCallback((()=>{U&&O({queryId:U,database:r})}),[U,O,r]),V=(0,y.xd)((()=>{P===de.Jf.explain?B():F()}));return(0,d.jsxs)("div",{className:Tm(),children:[(0,d.jsxs)(h,{direction:"vertical",defaultSizePaneKey:x.XN,triggerCollapse:M.triggerCollapse,triggerExpand:M.triggerExpand,minSize:[0,52],collapsedSizes:[100,0],onSplitStartDragAdditional:()=>{z(Fc.clear)},children:[(0,d.jsxs)("div",{className:Tm("pane-wrapper",{top:!0}),children:[(0,d.jsx)("div",{className:Tm("monaco-wrapper"),children:(0,d.jsx)("div",{className:Tm("monaco"),children:(0,d.jsx)(dc,{language:zc,value:l.input,options:s,onChange:t=>{e.changeUserInput({input:t})},editorDidMount:(t,a)=>{const n=function(e){const{KeyMod:t,KeyCode:a}=e,n=t.CtrlCmd;return{sendQuery:n|a.Enter,sendSelectedQuery:n|t.Shift|e.KeyCode.Enter,selectPreviousQuery:n|a.UpArrow,selectNextQuery:n|a.DownArrow,saveQuery:n|a.KeyS,saveSelectedQuery:n|t.Shift|a.KeyS}}(a);!function(e){const t=L()((()=>{e.layout()}),100);e.layout(),window.addEventListener("resize",t),e.onDidDispose((()=>{window.removeEventListener("resize",t)}))}(t),function(e,t){Dm(e.getValue(),t()),e.onDidChangeModelContent((()=>{Dm(e.getValue(),t())})),e.onDidDispose((()=>{window.onbeforeunload=null}))}(t,q),t.focus(),t.addAction({id:"sendQuery",label:sc("action.send-query"),keybindings:[n.sendQuery],precondition:void 0,keybindingContext:void 0,contextMenuGroupId:Sm,contextMenuOrder:1,run:()=>V()});const s=t.createContextKey("canSendSelectedText",!1);t.onDidChangeCursorSelection((e=>{let{selection:t,secondarySelections:a}=e;const n=t.selectionStartLineNumber!==t.positionLineNumber||t.selectionStartColumn!==t.positionColumn,r=a.length>0;s.set(n&&!r)})),t.addAction({id:"sendSelectedQuery",label:sc("action.send-selected-query"),keybindings:[n.sendSelectedQuery],precondition:"canSendSelectedText",contextMenuGroupId:Sm,contextMenuOrder:1,run:e=>{const t=e.getSelection(),a=e.getModel();if(t&&a){const e=a.getValueInRange({startLineNumber:t.getSelectionStart().lineNumber,startColumn:t.getSelectionStart().column,endLineNumber:t.getPosition().lineNumber,endColumn:t.getPosition().column});F(e)}}}),t.addAction({id:"previous-query",label:sc("action.previous-query"),keybindings:[n.selectPreviousQuery],contextMenuGroupId:Sm,contextMenuOrder:2,run:()=>{e.goToPreviousQuery()}}),t.addAction({id:"next-query",label:sc("action.next-query"),keybindings:[n.selectNextQuery],contextMenuGroupId:Sm,contextMenuOrder:3,run:()=>{e.goToNextQuery()}}),t.addAction({id:"save-query",label:sc("action.save-query"),keybindings:[n.saveQuery],run:()=>{e.setQueryAction("save")}})},theme:"vs-".concat(u)})})}),(0,d.jsx)(hm,{handleSendExecuteClick:F,onSettingsButtonClick:Q,isLoading:k.isLoading||R.isLoading,handleGetExplainQueryClick:B,disabled:!l.input,highlightedAction:P})]}),(0,d.jsx)("div",{className:Tm("pane-wrapper"),children:(0,d.jsx)(Im,{executeQueryData:R.data,executeQueryError:R.error,cancelQueryError:_.error,cancelQueryData:_.data,explainQueryData:k.data,explainQueryError:k.error,explainQueryLoading:k.isLoading,executeResultLoading:R.isLoading,cancelQueryLoading:_.isLoading,resultVisibilityState:M,onExpandResultHandler:()=>{z(Fc.triggerExpand)},onCollapseResultHandler:()=>{z(Fc.triggerCollapse)},onStopButtonClick:H,type:c,theme:u,resultType:g,tenantName:r,path:i,showPreview:p})})]}),(0,d.jsx)(um,{}),(0,d.jsx)(fm,{})]})}));function Im(e){let{executeQueryData:t,executeQueryError:a,cancelQueryError:n,explainQueryData:s,explainQueryError:r,explainQueryLoading:i,executeResultLoading:o,cancelQueryLoading:l,resultVisibilityState:c,onExpandResultHandler:u,onCollapseResultHandler:m,onStopButtonClick:p,type:h,theme:v,resultType:g,tenantName:x,path:y,showPreview:b}=e;if(b)return(0,d.jsx)(em,{database:x,path:y,type:h});if(g===wm.EXECUTE)return(0,d.jsx)(Mu,{data:t,error:a,cancelError:n,isResultsCollapsed:c.collapsed,onExpandResults:u,onCollapseResults:m,theme:v,loading:o,cancelQueryLoading:l,onStopButtonClick:p});if(g===wm.EXPLAIN){const{plan:e,ast:t,simplifiedPlan:a}=s||{};return(0,d.jsx)(Yu,{error:r,cancelError:n,explain:e,simplifiedPlan:a,ast:t,loading:i,cancelQueryLoading:l,theme:v,isResultsCollapsed:c.collapsed,onExpandResults:u,onCollapseResults:m,onStopButtonClick:p})}return null}function Dm(e,t){const a=!!e&&e!==t;window.onbeforeunload=a?e=>{e.preventDefault(),e.returnValue=""}:null}const Rm=[{id:S._0.newQuery,title:sc("tabs.newQuery")},{id:S._0.history,title:sc("tabs.history")},{id:S._0.saved,title:sc("tabs.saved")}],Am=e=>{let{className:t,activeTab:a}=e;const n=(0,Pa.TH)(),s=(0,E.mB)(n);return(0,d.jsx)("div",{className:t,children:(0,d.jsx)(w.m,{size:"l",allowNotSelected:!0,activeTab:a,items:Rm,wrapTo:(e,t)=>{let{id:a}=e;const n=(0,Qe.Sj)({...s,[Qe.XV.queryTab]:a});return(0,d.jsx)(ar.h,{to:n,children:t},a)}})})};var km=a(20847),Om=a(16459);const _m=(0,c.cn)("ydb-saved-queries"),Mm=e=>{let{visible:t,queryName:a,onCancelClick:n,onConfirmClick:s}=e;return(0,d.jsxs)(sm.V,{open:t,hasCloseButton:!1,size:"s",onClose:n,onEnterKeyDown:s,children:[(0,d.jsx)(sm.V.Header,{caption:sc("delete-dialog.header")}),(0,d.jsxs)(sm.V.Body,{className:_m("dialog-body"),children:[sc("delete-dialog.question"),(0,d.jsx)("span",{className:_m("dialog-query-name"),children:" ".concat(a,"?")})]}),(0,d.jsx)(sm.V.Footer,{textButtonApply:sc("delete-dialog.delete"),textButtonCancel:sc("delete-dialog.cancel"),onClickButtonCancel:n,onClickButtonApply:s})]})},Lm=e=>{let{changeUserInput:t}=e;const a=im(),s=(0,y.zL)(),r=(0,y.ix)(Nc.zC),[i,o]=n.useState(!1),[l,c]=n.useState(""),u=()=>{o(!1),c("")},m=[{name:"name",header:"Name",render:e=>{let{row:t}=e;return(0,d.jsx)("div",{className:_m("query-name"),children:t.name})},width:200},{name:"body",header:"Query Text",render:e=>{let{row:t}=e;return(0,d.jsxs)("div",{className:_m("query"),children:[(0,d.jsx)("div",{className:_m("query-body"),children:(0,d.jsx)(dr,{value:t.body,maxQueryHeight:Ir})}),(0,d.jsxs)("span",{className:_m("controls"),children:[(0,d.jsx)(Zn.z,{view:"flat-secondary",children:(0,d.jsx)(_s.J,{data:km.Z})}),(0,d.jsx)(Zn.z,{view:"flat-secondary",onClick:(a=t.name,e=>{e.stopPropagation(),o(!0),c(a)}),children:(0,d.jsx)(_s.J,{data:Om.Z})})]})]});var a},sortable:!1,resizeMinWidth:650}];return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)(Ml.l,{className:_m(),children:[(0,d.jsx)(Ml.l.Controls,{children:(0,d.jsx)(He.o,{onChange:e=>{s((0,Nc.b0)(e))},placeholder:sc("filter.text.placeholder"),className:_m("search")})}),(0,d.jsx)(Ml.l.Table,{children:(0,d.jsx)(le.G,{columnsWidthLSKey:"savedQueriesTableColumnsWidth",columns:m,data:a,settings:Dr,emptyDataMessage:sc(r?"history.empty-search":"saved.empty"),rowClassName:()=>_m("row"),onRowClick:e=>{return a=e.body,n=e.name,t({input:a}),s((0,Nc.GC)(n)),void s((0,P.jk)(S._0.newQuery));var a,n},initialSortOrder:{columnId:"name",order:Ne.ZP.ASCENDING}})})]}),(0,d.jsx)(Mm,{visible:i,queryName:l,onCancelClick:()=>{u()},onConfirmClick:()=>{u(),s((0,Nc.qF)(l)),c("")}})]})},zm=(0,c.cn)("ydb-query"),qm=e=>{const t=(0,y.zL)(),{queryTab:a=S._0.newQuery}=(0,y.ix)((e=>e.tenant)),r=e=>{t((0,ir.B8)(e))},i=n.useMemo((()=>Rm.find((e=>{let{id:t}=e;return t===a}))),[a]);return(0,d.jsxs)("div",{className:zm(),children:[i?(0,d.jsx)(s.ql,{children:(0,d.jsx)("title",{children:i.title})}):null,(0,d.jsx)(Am,{className:zm("tabs"),activeTab:a}),(0,d.jsx)("div",{className:zm("content"),children:(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(N,{show:a===S._0.newQuery,children:(0,d.jsx)(Pm,{changeUserInput:r,...e})}),(0,d.jsx)(N,{show:a===S._0.history,children:(0,d.jsx)(oc,{changeUserInput:r})}),(0,d.jsx)(N,{show:a===S._0.saved,children:(0,d.jsx)(Lm,{changeUserInput:r})})]})})]})};var Fm=a(68309),Qm=a(85807);const Bm=["query","diagnostics"],Um={query:Fm.Z,diagnostics:Qm.Z};const Hm=(0,c.cn)("ydb-tenant-navigation"),Vm=e=>{let{id:t,title:a,icon:n}=e;return{value:t,content:(0,d.jsxs)("span",{className:Hm("item"),children:[(0,d.jsx)(_s.J,{data:n,size:16,className:Hm("icon")}),(0,d.jsx)("span",{className:Hm("text"),children:a})]})}},Gm=()=>{const e=function(){const e=(0,Pa.k6)(),t=(0,Pa.TH)(),a=(0,E.mB)(t),[,s]=(0,y.yu)(x.pf),{tenantPage:r}=(0,y.ix)((e=>e.tenant)),i=n.useMemo((()=>{if(t.pathname!==E.ZP.tenant)return[];const n=Bm.map((t=>{const n=S.m2[t],i=(0,Qe.Sj)({...a,[S.bS]:n});return{id:n,title:mn("pages.".concat(t)),icon:Um[t],path:i,current:r===n,onForward:()=>{s(n),e.push(i)}}}));return n}),[r,s,t.pathname,e,a]);return i}();return(0,d.jsx)("div",{className:Hm(),children:(0,d.jsx)(Hl.E,{width:"auto",onUpdate:t=>{const a=e.find((e=>e.id===t));null===a||void 0===a||a.onForward()},size:"l",className:Hm("body"),value:(e.find((e=>e.current))||e[0]).id,options:e.map(Vm)})})},Zm=(0,c.cn)("object-general");const Wm=function(e){const t=(0,b.C)(),{tenantPage:a}=(0,y.ix)((e=>e.tenant));return(0,d.jsxs)("div",{className:Zm(),children:[(0,d.jsx)(Gm,{}),(()=>{const{type:s,additionalTenantProps:r,additionalNodesProps:i,tenantName:o,path:l}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(N,{show:a===S.m2.query,children:(0,d.jsx)(qm,{tenantName:o,path:l,theme:t,type:s})}),(0,d.jsx)(N,{show:a===S.m2.diagnostics,children:(0,d.jsx)(ac,{type:s,tenantName:o,path:l,additionalTenantProps:r,additionalNodesProps:i})})]})})()]})};var Jm=a(14495);const Km=ue.h.injectEndpoints({endpoints:e=>({getSchemaAcl:e.query({queryFn:async(e,t)=>{let{path:a,database:n}=e,{signal:s}=t;try{const e=await window.api.getSchemaAcl({path:a,database:n},{signal:s});return{data:{acl:e.Common.ACL,effectiveAcl:e.Common.EffectiveACL,owner:e.Common.Owner,interruptInheritance:e.Common.InterruptInheritance}}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"}),Ym=JSON.parse('{"title_rights":"Access Rights","title_effective-rights":"Effective Access Rights","title_owner":"Owner","title_interupt-inheritance":"Interrupt inheritance","description_empty":"No Acl data"}'),Xm=(0,xe.wZ)("ydb-acl",{en:Ym}),$m=(0,c.cn)("ydb-acl"),ep=e=>{if(e&&e.endsWith("@staff")&&!e.startsWith("svc_")){return e.split("@")[0]}return e},tp=["access","type","inheritance"],ap={access:"Access",type:"Access type",inheritance:"Inheritance type"},np="Allow",sp=new Set(["Object","Container"]);function rp(e){let{value:t}=e;const a="string"===typeof t?[t]:t;return(0,d.jsx)("div",{className:$m("definition-content"),children:a.map((e=>(0,d.jsx)("span",{children:e},e)))})}function ip(e){if(!e||!e.length)return[];const t=function(e){return e.map((e=>{const{AccessRules:t=[],AccessRights:a=[],AccessType:n,InheritanceType:s,Subject:r}=e,i=t.concat(a),o=n===np?void 0:n;let l;return((null===s||void 0===s?void 0:s.length)!==sp.size||s.some((e=>!sp.has(e))))&&(l=s),{access:i.length?i:void 0,type:o,inheritance:l,Subject:r}}))}(e);return t.map((e=>{let{Subject:t,...a}=e;const n=Object.entries(a).filter((e=>{let[t,a]=e;return Boolean(a)}));return 1===n.length&&"access"===n[0][0]?{name:t,content:(0,d.jsx)(rp,{value:n[0][1]}),multilineName:!0}:{label:(0,d.jsx)("span",{className:$m("group-label"),children:t}),items:tp.map((e=>{const t=a[e];if(t)return{name:ap[e],content:(0,d.jsx)(rp,{value:t}),multilineName:!0}})).filter(yn.D)}}))}const op=e=>{let{path:t,database:a}=e;const{currentData:s,isFetching:r,error:i}=Km.useGetSchemaAclQuery({path:t,database:a}),o=r&&!s,{acl:l,effectiveAcl:c,owner:u,interruptInheritance:m}=s||{},p=ip(l),h=ip(c),v=function(e){const t=ep(e);return t?[{name:t,content:Xm("title_owner"),multilineName:!0}]:[]}(u),g=m?[{name:Xm("title_interupt-inheritance"),content:(0,d.jsx)(_s.J,{data:Jm.Z,size:20}),multilineName:!0}]:[];if(o)return(0,d.jsx)(A.a,{});if(i)return(0,d.jsx)(R.V,{error:i});if(!l&&!u&&!c)return(0,d.jsx)(n.Fragment,{children:Xm("description_empty")});const x=v.concat(p);return(0,d.jsxs)("div",{className:$m(),children:[(0,d.jsx)(lp,{items:g}),(0,d.jsx)(lp,{items:x,title:Xm("title_rights")}),(0,d.jsx)(lp,{items:h,title:Xm("title_effective-rights")})]})};function lp(e){let{items:t,title:a}=e;return t.length?(0,d.jsxs)(n.Fragment,{children:[a&&(0,d.jsx)("div",{className:$m("list-title"),children:a}),(0,d.jsx)(Ma.w,{items:t,nameMaxWidth:200,className:$m("result",{"no-title":!a}),responsive:!0})]}):null}var cp=a(59687),dp=a(9593);const up=(e,t,a)=>{const{setActivePath:n}=a;return{openPreview:()=>{t(ue.h.util.invalidateTags(["PreviewData"])),t((0,g.m7)(!0)),t((0,P.Cs)(S.m2.query)),t((0,P.jk)(S._0.newQuery)),n(e)}}},mp=(e,t)=>(0,d.jsx)(Zn.z,{view:"flat-secondary",onClick:e.openPreview,title:mn("actions.openPreview"),size:t||"s",children:(0,d.jsx)(_s.J,{data:dp.Z})}),pp=(e,t,a)=>(n,s)=>{const r=up(n,e,t),i=mp(r,a);return{async_replication:void 0,database:void 0,directory:void 0,table:i,column_table:i,index_table:void 0,topic:void 0,stream:void 0,index:void 0,external_table:i,external_data_source:void 0,view:i}[s]},hp=(e,t,a)=>(n,s)=>{const r=up(n,e,t);return{preview:mp(r,a)}[s]};var vp=a(69886),gp=a.n(vp),xp=a(63660);const yp=function(e){let{name:t,title:a,type:n,content:s}=e;return xp.m.add({name:null!==t&&void 0!==t?t:"Request succeeded",title:null!==a&&void 0!==a?a:"Request succeeded",theme:"error"===n?"danger":"success",content:s,isClosable:!0,autoHiding:"success"===n&&5e3})},bp=e=>"-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table\nCREATE TABLE `".concat(e,"/ydb_row_table` (\n    category_id Uint64 NOT NULL,\n    id Uint64,\n    expire_at Datetime,\n    updated_on Datetime,\n    name Text,\n    `binary-payload` Bytes,\n    attributes JsonDocument,\n    -- uncomment to add a secondary index\n    -- INDEX idx_row_table_id GLOBAL SYNC ON ( id ) COVER ( name, attributes ), -- Secondary indexes docs https://ydb.tech/en/docs/yql/reference/syntax/create_table#secondary_index\n    PRIMARY KEY (category_id, id)\n) \nWITH (\n    AUTO_PARTITIONING_BY_SIZE = ENABLED,\n    AUTO_PARTITIONING_PARTITION_SIZE_MB = 2048,\n    AUTO_PARTITIONING_BY_LOAD = ENABLED,\n    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = 4,\n    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = 1024\n    -- uncomment to create a table with predefined partitions\n    -- , UNIFORM_PARTITIONS = 4 -- The number of partitions for uniform initial table partitioning.\n                            -- The primary key's first column must have type Uint64 or Uint32.\n                            -- A created table is immediately divided into the specified number of partitions\n    -- uncomment to launch read only replicas in every AZ\n    -- , READ_REPLICAS_SETTINGS = 'PER_AZ:1' -- Enable read replicas for stale read, launch one replica in every availability zone\n    -- uncomment to enable ttl\n    -- , TTL = Interval(\"PT1H\") ON expire_at -- Enable background deletion of expired rows https://ydb.tech/en/docs/concepts/ttl\n    -- uncomment to create a table with a bloom filter\n    -- , KEY_BLOOM_FILTER = ENABLED -- With a Bloom filter, you can more efficiently determine\n                               -- if some keys are missing in a table when making multiple single queries by the primary key.\n)"),fp=e=>"-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table#olap-tables\nCREATE TABLE `".concat(e,"/ydb_column_table` (\n    id Int64 NOT NULL,\n    author Text,\n    title Text,\n    body Text,\n    PRIMARY KEY (id)\n)\nPARTITION BY HASH(id)\nWITH (STORE = COLUMN)"),jp=()=>'CREATE OBJECT secret_name (TYPE SECRET) WITH value="secret_value";\n\nCREATE ASYNC REPLICATION my_replication\nFOR `/remote_database/table_name` AS `local_table_name` --[, `/remote_database/another_table_name` AS `another_local_table_name` ...]\nWITH (\n    CONNECTION_STRING="grpcs://mydb.ydb.tech:2135/?database=/remote_database",\n    TOKEN_SECRET_NAME = "secret_name"\n    -- ENDPOINT="mydb.ydb.tech:2135",\n    -- DATABASE=`/remote_database`,\n    -- USER="user",\n    -- PASSWORD_SECRET_NAME="your_password"\n);',Np=e=>"ALTER TABLE `".concat(e,"`\n    ADD COLUMN is_deleted Bool;"),Sp=e=>"SELECT *\n    FROM `".concat(e,"`\n    LIMIT 10;"),wp=e=>"UPSERT INTO `".concat(e,"`\n    ( `id`, `name` )\nVALUES ( );"),Tp=e=>"DROP EXTERNAL TABLE `".concat(e,"`;"),Cp=e=>{const t=e.split("/").slice(0,-1).join("/");return"CREATE EXTERNAL TABLE `".concat(t,'/my_external_table` (\n    column1 Int,\n    column2 Int\n) WITH (\n    DATA_SOURCE="').concat(e,'",\n    LOCATION="",\n    FORMAT="json_as_string",\n    `file_pattern`=""\n);')},Ep=e=>"-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_topic\nCREATE TOPIC `".concat(e,"/my_topic` (\n    CONSUMER consumer1,\n    CONSUMER consumer2 WITH (read_from = Datetime('1970-01-01T00:00:00Z')) -- Sets up the message write time starting from which the consumer will receive data.\n                                                                           -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format). \n                                                                           -- Default value: now\n) WITH (\n    min_active_partitions = 1, -- Minimum number of topic partitions.\n    partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.\n    retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.\n    retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. \n                              -- When this value is exceeded, the older data is cleared, like under a retention policy. \n                              -- 0 is interpreted as unlimited.\n    partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.\n    partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. \n                                    -- When set to zero, the actual write_burst value is equalled to \n                                    -- the quota value (this allows write bursts of up to one second).\n);"),Pp=e=>"-- docs: https://ydb.tech/en/docs/yql/reference/syntax/alter_topic\nALTER TOPIC `".concat(e,"`\n    ADD CONSUMER new_consumer WITH (read_from = Datetime('1970-01-01T00:00:00Z')), -- Sets up the message write time starting from which the consumer will receive data.\n                                                                                   -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format).\n                                                                                   -- Default value: now\n    ALTER CONSUMER consumer1 SET (read_from = Datetime('1970-01-01T00:00:00Z')),\n    DROP CONSUMER consumer2,\n    SET (\n        min_active_partitions = 1, -- Minimum number of topic partitions.\n        partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.\n        retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.\n        retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. \n                                  -- When this value is exceeded, the older data is cleared, like under a retention policy. \n                                  -- 0 is interpreted as unlimited.\n        partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.\n        partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. \n                                        -- When set to zero, the actual write_burst value is equalled to\n                                        -- the quota value (this allows write bursts of up to one second).\n    );"),Ip=e=>"DROP TOPIC `".concat(e,"`;"),Dp=e=>"CREATE VIEW `".concat(e,"/my_view` WITH (security_invoker = TRUE) AS SELECT 1;"),Rp=e=>"DROP VIEW `".concat(e,"`;"),Ap=e=>"DROP ASYNC REPLICATION `".concat(e,"`;"),kp=e=>"ALTER ASYNC REPLICATION `".concat(e,'` SET (STATE = "DONE", FAILOVER_MODE = "FORCE");'),Op=(e,t)=>(a,n)=>{const s=((e,t,a)=>{const{setActivePath:n,updateQueryExecutionSettings:s,showCreateDirectoryDialog:r}=a,i=(a,r)=>()=>{r&&s({queryMode:r}),t((0,ir.B8)({input:a(e)})),t((0,P.Cs)(S.m2.query)),t((0,P.jk)(S._0.newQuery)),n(e)};return{createDirectory:r?()=>{r(e)}:void 0,createTable:i(bp,"script"),createColumnTable:i(fp,"script"),createAsyncReplication:i(jp,"script"),alterAsyncReplication:i(kp,"script"),dropAsyncReplication:i(Ap,"script"),alterTable:i(Np,"script"),selectQuery:i(Sp),upsertQuery:i(wp),createExternalTable:i(Cp,"script"),dropExternalTable:i(Tp,"script"),selectQueryFromExternalTable:i(Sp,"query"),createTopic:i(Ep,"script"),alterTopic:i(Pp,"script"),dropTopic:i(Ip,"script"),createView:i(Dp,"script"),dropView:i(Rp,"script"),copyPath:()=>{try{gp()(e),yp({name:"Copied",title:mn("actions.copied"),type:"success"})}catch{yp({name:"Not copied",title:mn("actions.notCopied"),type:"error"})}}}})(a,e,t),r={text:mn("actions.copyPath"),action:s.copyPath},i=[[r],[{text:mn("actions.createTable"),action:s.createTable},{text:mn("actions.createColumnTable"),action:s.createColumnTable},{text:mn("actions.createAsyncReplication"),action:s.createAsyncReplication},{text:mn("actions.createTopic"),action:s.createTopic},{text:mn("actions.createView"),action:s.createView}]];s.createDirectory&&i.splice(1,0,[{text:mn("actions.createDirectory"),action:s.createDirectory}]);const o=[[r],[{text:mn("actions.alterTable"),action:s.alterTable},{text:mn("actions.selectQuery"),action:s.selectQuery},{text:mn("actions.upsertQuery"),action:s.upsertQuery}]],l=[[r],[{text:mn("actions.alterTopic"),action:s.alterTopic},{text:mn("actions.dropTopic"),action:s.dropTopic}]],c=[[r],[{text:mn("actions.selectQuery"),action:s.selectQueryFromExternalTable}],[{text:mn("actions.dropTable"),action:s.dropExternalTable}]],d=[[r],[{text:mn("actions.createExternalTable"),action:s.createExternalTable}]],u=[[r],[{text:mn("actions.selectQuery"),action:s.selectQuery}],[{text:mn("actions.dropView"),action:s.dropView}]],m=[r];return{async_replication:[[r],[{text:mn("actions.alterReplication"),action:s.alterAsyncReplication},{text:mn("actions.dropReplication"),action:s.dropAsyncReplication}]],database:i,directory:i,table:o,column_table:o,index_table:m,topic:l,stream:m,index:m,external_table:c,external_data_source:d,view:u}[n]},_p=(0,c.cn)("ydb-schema-create-directory-dialog"),Mp="relativePath";function Lp(e){let{open:t,onClose:a,database:s,parentPath:r,onSuccess:i}=e;const[o,l]=n.useState(""),[c,u]=n.useState(""),[m,p]=g.m3.useCreateDirectoryMutation(),h=()=>{l(""),p.reset()},v=()=>{a(),u(""),h()};return(0,d.jsxs)(sm.V,{open:t,onClose:v,size:"s",children:[(0,d.jsx)(sm.V.Header,{caption:mn("schema.tree.dialog.header")}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=(a=c)?/\s/.test(a)?mn("schema.tree.dialog.whitespace"):"":mn("schema.tree.dialog.empty");var a;l(t),t||(()=>{const e="".concat(r,"/").concat(c);m({database:s,path:e}).unwrap().then((()=>{v(),i(c)}))})()},children:[(0,d.jsxs)(sm.V.Body,{children:[(0,d.jsxs)("label",{htmlFor:Mp,className:_p("label"),children:[(0,d.jsx)("span",{className:_p("description"),children:mn("schema.tree.dialog.description")}),"".concat(r,"/")]}),(0,d.jsx)("div",{className:_p("input-wrapper"),children:(0,d.jsx)(rm.o,{placeholder:mn("schema.tree.dialog.placeholder"),value:c,onUpdate:e=>{u(e),h()},autoFocus:!0,hasClear:!0,autoComplete:!1,disabled:p.isLoading,validationState:o?"invalid":void 0,id:Mp,errorMessage:o})}),p.isError&&(0,d.jsx)(R.V,{error:p.error,defaultMessage:mn("schema.tree.dialog.invalid")})]}),(0,d.jsx)(sm.V.Footer,{loading:p.isLoading,textButtonApply:mn("schema.tree.dialog.buttonApply"),textButtonCancel:mn("schema.tree.dialog.buttonCancel"),onClickButtonCancel:v,propsButtonApply:{type:"submit"}})]})]})}function zp(e){const t=(0,mc.j0)(),{rootPath:a,rootName:s,rootType:r,currentPath:i,onActivePathUpdate:o}=e,l=(0,y.zL)(),[c,u]=(0,y.dU)(),[m,p]=n.useState(!1),[h,v]=n.useState(""),[x,b]=n.useState("");n.useEffect((()=>{null!==i&&void 0!==i&&i.startsWith(a)||o(a)}),[i,o,a]);return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Lp,{onClose:()=>{p(!1)},open:m,database:a,parentPath:h,onSuccess:e=>{const t="".concat(h,"/").concat(e);o(t),b(t)}}),(0,d.jsx)(cp.f,{rootState:{path:a,name:s,type:(0,he.lZ)(r),collapsed:!1},fetchPath:async e=>{let t;for(;;){const n=l(g.m3.endpoints.getSchema.initiate({path:e,database:a},{forceRefetch:!0})),{data:s,originalArgs:r}=await n;if(n.unsubscribe(),(null===r||void 0===r?void 0:r.path)===e){t=null===s||void 0===s?void 0:s[e];break}}if(!t)throw new Error("no describe data about path ".concat(e));const{PathDescription:{Children:n=[]}={}}=t;return n.map((e=>{const{Name:t="",PathType:a,PathSubType:n}=e;return{name:t,type:(0,he.lZ)(a,n),expandable:!(0,he.Sb)(a,n)}}))},getActions:Op(l,{setActivePath:o,updateQueryExecutionSettings:e=>u({...c,...e}),showCreateDirectoryDialog:t?e=>{v(e),p(!0)}:void 0}),renderAdditionalNodeElements:pp(l,{setActivePath:o}),activePath:i,onActivePathUpdate:o,cache:!1,virtualize:!0},x)]})}function qp(e,t){const a=e.replace(/^\/+|\/+$/g,""),n=t.replace(/^\/+|\/+$/g,"");if(!a.startsWith(n))return a||"/";let s=a.slice(n.length);return s=s.replace(/^\/+/,"")||"/",s}const Fp=(0,c.cn)("object-summary"),Qp=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:Boolean(localStorage.getItem(x.Mn))});function Bp(e){var t;let{type:a,subType:s,tenantName:i,path:o,onCollapseSummary:l,onExpandSummary:c,isCollapsed:u}=e;const m=(0,y.zL)(),[,p]=(0,r.useQueryParam)("schema",r.StringParam),[v,b]=n.useReducer(Uc(x.Mn),void 0,Qp),{summaryTab:f=S.uw.overview}=(0,y.ix)((e=>e.tenant)),j=(0,Pa.TH)(),N=dt().parse(j.search,{ignoreQueryPrefix:!0}),{data:C}=(0,g.hz)({path:o,database:i}),I=null===C||void 0===C||null===(t=C.PathDescription)||void 0===t?void 0:t.Self;n.useEffect((()=>{const e=(0,he.vp)(a);!a||e||Qe.Cc.find((e=>e.id===f))||m((0,P.Tu)(S.uw.overview))}),[m,a,f]);const D=()=>{const e=(0,he.vp)(a)?[...Qe.Cc,...Qe.c7]:Qe.Cc;return(0,d.jsx)("div",{className:Fp("tabs"),children:(0,d.jsx)(w.m,{size:"l",items:e,activeTab:f,wrapTo:(e,t)=>{let{id:a}=e;const n=(0,E.ax)(E.ZP.tenant,void 0,{...N,name:i,[Qe.XV.summaryTab]:a});return(0,d.jsx)(T.rU,{to:n,className:Fp("tab"),children:t},a)},allowNotSelected:!0})})},R=()=>{switch(f){case S.uw.acl:return(0,d.jsx)(op,{path:o,database:i});case S.uw.schema:return(0,d.jsx)(Fe,{type:a,path:o,tenantName:i});default:return(()=>{var e;if(!I)return;const{CreateStep:t,PathType:a,PathSubType:n,PathId:s,PathVersion:r}=I,i=[];i.push({label:mn("summary.type"),value:null===a||void 0===a?void 0:a.replace(/^EPathType/,"")}),n!==Le.mR.EPathSubTypeEmpty&&i.push({label:mn("summary.subtype"),value:null===n||void 0===n?void 0:n.replace(/^EPathSubType/,"")}),i.push({label:mn("summary.id"),value:s}),i.push({label:mn("summary.version"),value:r}),i.push({label:mn("summary.created"),value:(0,_.o0)(t)});const{PathDescription:o}=C;if(null!==o&&void 0!==o&&o.TableStats){const{DataSize:e,RowCount:t}=o.TableStats;i.push({label:mn("summary.data-size"),value:ia(e)},{label:mn("summary.row-count"),value:(0,_.uf)(t)})}const l=(0,d.jsx)(pn,{data:o}),c=()=>{var e,t;return[{label:mn("summary.paths"),value:null===o||void 0===o||null===(e=o.DomainDescription)||void 0===e?void 0:e.PathsInside},{label:mn("summary.shards"),value:null===o||void 0===o||null===(t=o.DomainDescription)||void 0===t?void 0:t.ShardsInside}]},u={[Le.gb.EPathTypeInvalid]:void 0,[Le.gb.EPathTypeDir]:void 0,[Le.gb.EPathTypeTable]:()=>{var e;return[{label:mn("summary.partitions"),value:null===o||void 0===o||null===(e=o.TablePartitions)||void 0===e?void 0:e.length}]},[Le.gb.EPathTypeSubDomain]:c,[Le.gb.EPathTypeTableIndex]:void 0,[Le.gb.EPathTypeExtSubDomain]:c,[Le.gb.EPathTypeColumnStore]:()=>{var e,t;return[{label:mn("summary.partitions"),value:null===o||void 0===o||null===(e=o.ColumnStoreDescription)||void 0===e||null===(t=e.ColumnShards)||void 0===t?void 0:t.length}]},[Le.gb.EPathTypeColumnTable]:()=>{var e,t,a;return[{label:mn("summary.partitions"),value:null===o||void 0===o||null===(e=o.ColumnTableDescription)||void 0===e||null===(t=e.Sharding)||void 0===t||null===(a=t.ColumnShards)||void 0===a?void 0:a.length}]},[Le.gb.EPathTypeCdcStream]:()=>{const{Mode:e,Format:t}=(null===o||void 0===o?void 0:o.CdcStreamDescription)||{};return[{label:mn("summary.mode"),value:null===e||void 0===e?void 0:e.replace(/^ECdcStreamMode/,"")},{label:mn("summary.format"),value:null===t||void 0===t?void 0:t.replace(/^ECdcStreamFormat/,"")}]},[Le.gb.EPathTypePersQueueGroup]:()=>{var e,t,a;const n=null===o||void 0===o?void 0:o.PersQueueGroup,s=null===n||void 0===n||null===(e=n.PQTabletConfig)||void 0===e||null===(t=e.PartitionConfig)||void 0===t?void 0:t.LifetimeSeconds;return[{label:mn("summary.partitions"),value:null===n||void 0===n||null===(a=n.Partitions)||void 0===a?void 0:a.length},{label:mn("summary.retention"),value:s&&(0,_.xh)(s)}]},[Le.gb.EPathTypeExternalTable]:()=>{var e,t;const a=(0,E.vF)({...N,schema:null===o||void 0===o||null===(e=o.ExternalTableDescription)||void 0===e?void 0:e.DataSourcePath}),{SourceType:n,DataSourcePath:s}=(null===o||void 0===o?void 0:o.ExternalTableDescription)||{},r=(null===s||void 0===s||null===(t=s.match(/([^/]*)\/*$/))||void 0===t?void 0:t[1])||"";return[{label:mn("summary.source-type"),value:n},{label:mn("summary.data-source"),value:s&&(0,d.jsx)("span",{title:s,children:(0,d.jsx)(Ia.j,{title:r||"",url:a})})}]},[Le.gb.EPathTypeExternalDataSource]:()=>{var e;return[{label:mn("summary.source-type"),value:null===o||void 0===o||null===(e=o.ExternalDataSourceDescription)||void 0===e?void 0:e.SourceType}]},[Le.gb.EPathTypeView]:void 0,[Le.gb.EPathTypeReplication]:()=>{var e;const t=null===o||void 0===o||null===(e=o.ReplicationDescription)||void 0===e?void 0:e.State;return t?[{label:mn("summary.state"),value:(0,d.jsx)(Ha,{state:t})}]:[]}},m=a&&(null===(e=u[a])||void 0===e?void 0:e.call(u))||[];return i.push(...m),(0,d.jsx)(fi._,{title:l,info:i.filter((e=>e.value))})})()}},A=()=>{b(Fc.triggerCollapse)},k=()=>{b(Fc.triggerExpand)},O=()=>{b(Fc.clear)},M=()=>{const e=(0,he.vp)(a)&&!(0,he.dC)(s);return(0,d.jsxs)(n.Fragment,{children:[e&&hp(m,{setActivePath:p},"m")(o,"preview"),(0,d.jsx)(Zc.m,{text:o,view:"flat-secondary",title:mn("summary.copySchemaPath")}),(0,d.jsx)(Vc,{onCollapse:A,onExpand:k,isCollapsed:v.collapsed,initialDirection:"bottom"})]})},L=()=>{const{Status:e,Reason:t}=null!==C&&void 0!==C?C:{};let n;return!a&&e&&t&&(n="".concat(e,": ").concat(t)),a?(0,d.jsx)("div",{className:Fp("entity-type"),children:a.replace("EPathType","")}):(0,d.jsx)("div",{className:Fp("entity-type",{error:!0}),children:(0,d.jsx)(mt.J,{content:n,offset:{left:0}})})};return(0,d.jsxs)("div",{className:Fp(),children:[(0,d.jsx)("div",{className:Fp({hidden:u}),children:(0,d.jsxs)(h,{direction:"vertical",defaultSizePaneKey:x.wr,onSplitStartDragAdditional:O,triggerCollapse:v.triggerCollapse,triggerExpand:v.triggerExpand,minSize:[200,52],collapsedSizes:[100,0],children:[(0,d.jsx)(Up,{tenantName:i,path:o}),(0,d.jsxs)("div",{className:Fp("info"),children:[(0,d.jsxs)("div",{className:Fp("sticky-top"),children:[(0,d.jsxs)("div",{className:Fp("info-header"),children:[(0,d.jsxs)("div",{className:Fp("info-title"),children:[L(),(0,d.jsx)("div",{className:Fp("path-name"),children:qp(o,i)})]}),(0,d.jsx)("div",{className:Fp("info-controls"),children:M()})]}),D()]}),(0,d.jsx)("div",{className:Fp("overview-wrapper"),children:R()})]})]})}),(0,d.jsx)(Vc,{onCollapse:l,onExpand:c,isCollapsed:u,initialDirection:"left",className:Fp("action-button")})]})}function Up(e){var t;let{tenantName:a,path:n}=e;const{data:s={},isLoading:i}=(0,g.hz)({path:a,database:a}),o=null===s||void 0===s||null===(t=s.PathDescription)||void 0===t?void 0:t.Self,[,l]=(0,r.useQueryParam)("schema",r.StringParam);return!o&&i?(0,d.jsx)("div",{children:(0,d.jsx)(A.a,{})}):(0,d.jsxs)("div",{className:Fp("tree-wrapper"),children:[(0,d.jsx)("div",{className:Fp("tree-header"),children:mn("summary.navigation")}),(0,d.jsx)("div",{className:Fp("tree"),children:o?(0,d.jsx)(zp,{rootPath:a,rootName:o.Name||a,rootType:o.PathType,currentPath:n,onActivePathUpdate:l}):null})]})}const Hp=(0,c.cn)("tenant-page"),Vp=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:Boolean(localStorage.getItem(x.sO))});function Gp(e){var t;const[l,c]=n.useReducer(Uc(x.sO),void 0,Vp),[{name:u,schema:m}]=(0,r.useQueryParams)({name:r.StringParam,schema:r.StringParam});if(!u)throw new Error("Tenant name is not defined");const p=n.useRef();n.useEffect((()=>{if(p.current!==u){(async()=>{const{registerYQLCompletionItemProvider:e}=await a.e(9079).then(a.bind(a,99079));e(u)})().catch(console.error),p.current=u}}),[u]);const b=(0,y.zL)();n.useEffect((()=>{b((0,v.J)("tenant",{tenantName:u}))}),[u,b]);const f=null!==m&&void 0!==m?m:u,{data:j,error:N,isLoading:S}=(0,g.hz)({path:f,database:u}),{PathType:w,PathSubType:T}=(null===j||void 0===j||null===(t=j.PathDescription)||void 0===t?void 0:t.Self)||{},C=(0,i.u)(N),[E,P]=n.useState(!0);E&&!S&&P(!1);const I=f||mn("page.title");return(0,d.jsxs)("div",{className:Hp(),children:[(0,d.jsx)(s.ql,{defaultTitle:"".concat(I," \u2014 YDB Monitoring"),titleTemplate:"%s \u2014 ".concat(I," \u2014 YDB Monitoring")}),(0,d.jsx)(o.s,{loading:E,children:(0,d.jsx)(i.S,{error:C?N:void 0,children:(0,d.jsxs)(h,{defaultSizePaneKey:x.z4,defaultSizes:[25,75],triggerCollapse:l.triggerCollapse,triggerExpand:l.triggerExpand,minSize:[36,200],onSplitStartDragAdditional:()=>{c(Fc.clear)},children:[(0,d.jsx)(Bp,{type:w,subType:T,tenantName:u,path:f,onCollapseSummary:()=>{c(Fc.triggerCollapse)},onExpandSummary:()=>{c(Fc.triggerExpand)},isCollapsed:l.collapsed}),(0,d.jsx)("div",{className:Hp("main"),children:(0,d.jsx)(Wm,{type:w,additionalTenantProps:e.additionalTenantProps,additionalNodesProps:e.additionalNodesProps,tenantName:u,path:f})})]})})})]})}},76386:(e,t,a)=>{"use strict";a.d(t,{_:()=>s});var n=a(51688);const s=a(905).h.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async(e,t)=>{let{id:a,database:s,nodeId:r}=e,{signal:i}=t;try{const[e,t,o]=await Promise.all([window.api.getTablet({id:a,database:s,nodeId:r},{signal:i}),window.api.getTabletHistory({id:a,database:s,nodeId:r},{signal:i}),window.api.getNodesList({signal:i})]),l=(0,n.dn)(o),c=Object.keys(t).reduce(((e,a)=>{var n;const s=null===(n=t[a])||void 0===n?void 0:n.TabletStateInfo;if(s&&s.length){const t=s.find((e=>e.Leader))||s[0],{ChangeTime:n,Generation:r,State:i,Leader:o,FollowerId:c}=t,d=l&&a?l.get(Number(a)):void 0;"Dead"!==i&&e.push({nodeId:a,generation:r,changeTime:n,state:i,leader:o,followerId:c,fqdn:d})}return e}),[]),{TabletStateInfo:d=[]}=e,[u={}]=d,{TabletId:m}=u;return{data:{id:m,data:u,history:c}}}catch(o){return{error:o}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async(e,t)=>{let{tenantId:a}=e,{signal:n}=t;try{const e=await window.api.getTabletDescribe(a,{signal:n}),{SchemeShard:t,PathId:s}=a;return{data:(null===e||void 0===e?void 0:e.Path)||"".concat(t,":").concat(s)}}catch(s){return{error:s}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async(e,t)=>{let{id:a,hiveId:n}=e,{signal:s}=t;try{return{data:await window.api.getTabletFromHive({id:a,hiveId:n},{signal:s})}}catch(r){return{error:r}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async e=>{let{id:t}=e;try{return{data:await window.api.killTablet(t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.stopTablet(t,a)}}catch(n){return{error:n}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.resumeTablet(t,a)}}catch(n){return{error:n}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})},24960:()=>{},26759:()=>{},56272:()=>{}}]);