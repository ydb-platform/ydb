(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[24456],{2748:()=>{},31893:(e,t,a)=>{"use strict";a.r(t),a.d(t,{YDBSyntaxHighlighter:()=>j});var n=a(59284),s=a(95776),r=a(29529);const i=(0,a(77506).cn)("ydb-syntax-highlighter"),o={name:"yql-light",type:"light",tokenColors:[{scope:["comment.block"],settings:{foreground:"#969896",fontStyle:"italic"}},{scope:["string.quoted.double"],settings:{foreground:"#a31515"}},{scope:["string.interpolated"],settings:{foreground:"#338186"}},{scope:["entity.name.function"],settings:{foreground:"#7a3e9d"}},{scope:["entity.name.type"],settings:{foreground:"#4d932d"}},{scope:["keyword.control"],settings:{foreground:"#0000ff"}},{scope:["constant.numeric"],settings:{foreground:"#098658"}},{scope:["support.constant"],settings:{foreground:"#7497c4"}},{scope:["variable.parameter"],settings:{foreground:"#000000"}},{scope:["variable.other"],settings:{foreground:"#000000"}}]},l={name:"yql-dark",type:"dark",colors:{"editor.foreground":"#d4d4d4","editor.background":"#1e1e1e"},tokenColors:[{scope:["comment.block"],settings:{foreground:"#969896",fontStyle:"italic"}},{scope:["string.quoted.double"],settings:{foreground:"#ce9178"}},{scope:["string.interpolated"],settings:{foreground:"#338186"}},{scope:["entity.name.function"],settings:{foreground:"#9e7bb0"}},{scope:["entity.name.type"],settings:{foreground:"#6A8759"}},{scope:["keyword.control"],settings:{foreground:"#569cd6"}},{scope:["constant.numeric"],settings:{foreground:"#b5cea8"}},{scope:["support.constant"],settings:{foreground:"#7497c4"}},{scope:["variable.parameter"],settings:{foreground:"#D4D4D4"}},{scope:["variable.other"],settings:{foreground:"#D4D4D4"}}]};var c=a(4095);const d="yql-light",u="yql-dark",p="github-light",h="github-dark";let m=null;const g=new Set,v=new Set;async function y(){return m||(m=(async()=>{const{createHighlighter:e}=await a.e(71055).then(a.bind(a,71055));return e({themes:[],langs:[]})})()),m}async function x(e){if(g.has(e))return;const t=await y();try{"yql"===e?await t.loadLanguage(c):await t.loadLanguage(e),g.add(e)}catch(a){throw console.error(`Failed to load language: ${e}`,a),a}}async function b(e){if(v.has(e))return;const t=await y();try{e===d?await t.loadTheme(o):e===u?await t.loadTheme(l):await t.loadTheme(e),v.add(e)}catch(a){throw console.error(`Failed to load theme: ${e}`,a),a}}var f=a(60712);function j({text:e,language:t,className:a,transparentBackground:o=!0,withClipboardButton:l}){const[c,m]=n.useState(""),[g,v]=n.useState(!0),j=(0,s.x)();n.useEffect((()=>{let a=!1;return async function(){v(!0);try{const n=await async function(e,t,a){const n="dark"===a;let s=n?h:p;return"yql"===t&&(s=n?u:d),await Promise.all([x(t),b(s)]),(await y()).codeToHtml(e,{lang:t,theme:s})}(e,t,j);a||m(n)}catch(n){console.error("Failed to highlight code:",n)}finally{a||v(!1)}}(),()=>{a=!0}}),[e,t,j]);let T={};null!==l&&void 0!==l&&l.alwaysVisible&&(T=!1===l.withLabel?{paddingRight:40}:{paddingRight:80});const S={...T};return o&&(S.background="transparent"),(0,f.jsxs)("div",{className:i(null,a),children:[(()=>{if(!l)return null;const{alwaysVisible:t,copyText:a,...n}=l;return(0,f.jsx)("div",{className:i("sticky-container"),onClick:e=>e.stopPropagation(),children:(0,f.jsx)(r.b,{...n,copyText:a||e,className:i("copy",{visible:t}),view:"flat-secondary"})})})(),g||!c?(0,f.jsx)("div",{style:S,className:i("content",{transparent:o}),children:(0,f.jsx)("pre",{children:(0,f.jsx)("code",{children:e})})}):(0,f.jsx)("div",{className:i("content",{transparent:o}),style:S,dangerouslySetInnerHTML:{__html:c}})]})}},38389:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Tenant:()=>Zj});var n=a(59284),s=a(61750),r=a(57166),i=a(98167),o=a(61283),l=a(77506),c=a(60712);const d=(0,l.cn)("kv-split"),u=[0,100],p=[50,50];const h=function(e){const[t,a]=n.useState(),s=t=>{const{defaultSizePaneKey:a}=e;localStorage.setItem(a,t.join(","))};return n.useEffect((()=>{const{collapsedSizes:t,triggerCollapse:n}=e;if(n){const e=t||u;s(e),a(e)}}),[e.triggerCollapse]),n.useEffect((()=>{const{triggerExpand:t,defaultSizes:n}=e,r=n||p;t&&(s(r),a(r))}),[e.triggerExpand]),(0,c.jsx)(n.Fragment,{children:(0,c.jsx)(o.A,{direction:e.direction||"horizontal",sizes:t||(()=>{var t;const{defaultSizePaneKey:a,defaultSizes:n=p,initialSizes:s}=e;if(s)return s;return(null===(t=localStorage.getItem(a))||void 0===t?void 0:t.split(",").map(Number))||n})(),minSize:e.minSize||[0,0],onDrag:t=>{const{onSplitDragAdditional:a}=e;a&&a(),s(t)},className:d(null,e.direction||"horizontal"),gutterSize:8,onDragStart:()=>{const{onSplitStartDragAdditional:t}=e;t&&t(),a(void 0)},expandToMin:!0,children:e.children})})};var m=a(40174),g=a(21334);const v=g.F.injectEndpoints({endpoints:e=>({getOverview:e.query({queryFn:async({path:e,database:t,timeout:a,databaseFullPath:n},{signal:s})=>{try{return{data:await window.api.viewer.getDescribe({path:{path:e,databaseFullPath:n},database:t,timeout:a},{signal:s})}}catch(r){return{error:r}}},serializeQueryArgs:({queryArgs:e})=>{const{database:t,path:a}=e;return{database:t,path:a}},keepUnusedDataFor:0,providesTags:["All","SchemaTree"]})})});var y=a(29078),x=a(18517),b=a(51114),f=a(76086),j=a(47779),T=a(81288),S=a(81188),w=a(84279),E=a(52531),_=a(96727),N=a(29859),C=a(90053),P=a(89898),I=a(67028),A=a(67298),D=a(12888),R=a(17253),k=a(61323),O=a(12207),M=a(48139),F=a(44508),L=a(52248),q=a(90565),z=a(49818),U=a(56839),Q=a(61758),G=a.n(Q),B=a(92459),$=a(58351);const H=(0,l.cn)("heatmap"),V={width:0,height:0},W=10,J=e=>{const[t,a]=n.useState(V),{tablets:s}=e,r=n.useRef(null),i=n.useRef(null),o=(0,B.Cs)();n.useEffect((()=>{const e=r.current,a=e.getContext("2d");a.clearRect(0,0,e.offsetWidth,e.offsetHeight),s.map(function(e){return(a,n)=>{const{columnsCount:s}=t,r=n%s*12,i=12*Math.floor(n/s);e.fillStyle=a.color||"grey",e.fillRect(r,i,W,W)}}(a))})),n.useLayoutEffect((()=>{const e=i.current;if(e){const t=e.offsetWidth-15,n=Math.floor(t/12),r=Math.ceil(s.length/n);a({width:t,height:12*r,columnsCount:n,rowsCount:r})}}),[]);const l=()=>{let e=r.current,t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t},d=()=>{let e=r.current,t=0;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t},u=(e,a)=>{const{columnsCount:n}=t,s=Math.floor(e/12);return n*Math.floor(a/12)+s},p=G()(((t,a)=>{const n=new CustomEvent("scroll");window.dispatchEvent(n);const r=e.parentRef.current,i=t-d()+r.scrollLeft,o=a-l()+r.scrollTop,c=u(i,o),p=s[c];if(p){const n={name:p.currentMetric,value:p.formattedValue};e.showTooltip(void 0,p,"tablet",n,{left:t-20,top:a-20})}else e.hideTooltip()}),20);return(0,c.jsx)("div",{ref:i,className:H("canvas-container"),onMouseLeave:()=>{setTimeout((()=>{e.hideTooltip()}),40)},children:(0,c.jsx)("canvas",{ref:r,width:t.width,height:t.height,onClick:t=>{const a=e.parentRef.current,n=t.clientX-d()+a.scrollLeft,r=t.clientY-l()+a.scrollTop,i=u(n,r),c=s[i];c&&window.open((e=>{const{TabletId:t}=e,a=window.location.hostname,n=o(t);return`https://${[a,$.P8,n].map((e=>e.startsWith("/")?e.slice(1):e)).filter(Boolean).join("/")}`})(c),"_blank")},onMouseMove:e=>p(e.clientX,e.clientY)})})},K={r:255,g:4,b:0},Y={r:255,g:219,b:77},Z={r:59,g:201,b:53},X={CPU:{min:0,max:1e6},Network:{min:0,max:1e9},Storage:{min:0,max:2e9},DataSize:{min:0,max:2e9},RowCount:{min:0},IndexSize:{min:0}},ee=e=>{const t=e.toString(16);return 1===t.length?`0${t}`:t},te=(e,t,a)=>{if(1===e)return[t];if(2===e)return[t,a];const n=(t.r-a.r)/(e-1),s=(t.g-a.g)/(e-1),r=(t.b-a.b)/(e-1),i=[];for(let o=0;o<e;o++)i.push({r:Math.round(t.r-n*o),g:Math.round(t.g-s*o),b:Math.round(t.b-r*o)});return i.map((e=>(({r:e,g:t,b:a})=>`#${ee(e)}${ee(t)}${ee(a)}`)(e)))},ae=e=>{const t=Math.floor(e/2),a=t+1;return[...te(e%2===0?t:t+1,Z,Y),...te(a,Y,K).slice(1)]},ne=(e,t)=>{const a=new Set,n=X[e]||{};t.forEach((t=>{var n;a.add(Number(null===(n=t.metrics)||void 0===n?void 0:n[e]))})),Number.isInteger(n.min)&&a.add(n.min),Number.isInteger(n.max)&&a.add(n.max);const s=Array.from(a.values()).sort(((e,t)=>e-t));return{min:s[0],max:s[s.length-1]}},se=(0,l.cn)("histogram"),re=e=>{const t=n.useRef(),{data:a={},maxCount:s}=e,{count:r,leftBound:i,rightBound:o,color:l}=a,d=r/s*100;return(0,c.jsx)("div",{ref:t,className:se("item"),style:{backgroundColor:l,height:`${d}%`},onMouseEnter:()=>{const a=t.current;e.showTooltip(a,{count:r,leftBound:i,rightBound:o},"histogram")},onMouseLeave:e.hideTooltip})},ie=e=>{const{tablets:t,currentMetric:a}=e,{min:n,max:s}=ne(a,t),r=ae(50),i=(s-n)/50,o=r.map(((e,t)=>({color:e,count:0,leftBound:(0,U.ZV)(n+t*i),rightBound:(0,U.ZV)(n+(t+1)*i)})));let l=0;t.forEach((e=>{var t,n;const s=a&&Number(null===(t=e.metrics)||void 0===t?void 0:t[a]),r=Math.floor(s/i),c=(null===(n=o[r])||void 0===n?void 0:n.count)+1;c>l&&(l=c),o[r]={...o[r],count:c}}));return(0,c.jsx)("div",{className:se(),children:(0,c.jsxs)("div",{className:se("chart"),children:[Boolean(s)&&o.map(((t,a)=>(0,c.jsx)(re,{data:t,maxCount:l,showTooltip:e.showTooltip,hideTooltip:e.hideTooltip},a))),(0,c.jsx)("div",{className:se("x-min"),children:(0,U.ZV)(n)}),(0,c.jsx)("div",{className:se("x-max"),children:(0,U.ZV)(s)}),(0,c.jsx)("div",{className:se("y-min"),children:"0"}),(0,c.jsx)("div",{className:se("y-max"),children:(0,U.ZV)(l)})]})})},oe=(0,l.cn)("heatmap"),le=ae(500),ce=({path:e,database:t,databaseFullPath:a})=>{const s=(0,j.YQ)(),r=n.createRef(),[i]=(0,j.Nt)(),{currentData:o,isFetching:l,error:d}=q.f1.useGetHeatmapTabletsInfoQuery({path:e,database:t,databaseFullPath:a},{pollingInterval:i}),u=l&&void 0===o,{tablets:p=[],metrics:h}=o||{},{sort:m,heatmap:g,currentMetric:v}=(0,j.N4)((e=>e.heatmap)),y=(...e)=>{s((0,z.DK)(...e))},x=()=>{s((0,z.w7)())},b=e=>{s((0,q.nd)({currentMetric:e[0]}))},T=()=>{s((0,q.nd)({sort:!m}))},S=()=>{s((0,q.nd)({heatmap:!g}))},w=()=>{const{min:e,max:t}=ne(v,p),a=p.map((a=>{var n;const s=v&&Number(null===(n=a.metrics)||void 0===n?void 0:n[v]),r=((e,t,a)=>0===a?0:Math.round((e-t)/(a-t)*499))(s,e,t),i=le[r];return{...a,color:i,value:s,formattedValue:(0,U.ZV)(s),currentMetric:v}})),n=m?a.sort(((e,t)=>Number(t.value)-Number(e.value))):a;return(0,c.jsx)("div",{ref:r,className:oe("items"),children:(0,c.jsx)(J,{tablets:n,parentRef:r,showTooltip:y,hideTooltip:x})})};return u?(0,c.jsx)(L.a,{}):(()=>{const{min:e,max:t}=ne(v,p);let a;return d&&!o||(a=g?w():(0,c.jsx)(ie,{tablets:p,currentMetric:v,showTooltip:y,hideTooltip:x})),(0,c.jsxs)("div",{className:oe(),children:[(0,c.jsxs)("div",{className:oe("filters"),children:[(0,c.jsx)(O.l,{className:oe("heatmap-select"),value:v?[v]:[],options:h,onUpdate:b,width:200}),(0,c.jsx)("div",{className:oe("sort-checkbox"),children:(0,c.jsx)(M.S,{onUpdate:T,checked:m,children:"Sort"})}),(0,c.jsx)("div",{className:oe("histogram-checkbox"),children:(0,c.jsx)(M.S,{onUpdate:S,checked:g,children:"Heatmap"})}),(0,c.jsxs)("div",{className:oe("limits"),children:[(0,c.jsxs)("div",{className:oe("limits-block"),children:[(0,c.jsx)("div",{className:oe("limits-title"),children:"min:"}),(0,c.jsx)("div",{className:oe("limits-value"),children:Number.isInteger(e)?(0,U.ZV)(e):f.Pd})]}),(0,c.jsxs)("div",{className:oe("limits-block"),children:[(0,c.jsx)("div",{className:oe("limits-title"),children:"max:"}),(0,c.jsx)("div",{className:oe("limits-value"),children:Number.isInteger(t)?(0,U.ZV)(t):f.Pd})]}),(0,c.jsxs)("div",{className:oe("limits-block"),children:[(0,c.jsx)("div",{className:oe("limits-title"),children:"count:"}),(0,c.jsx)("div",{className:oe("limits-value"),children:(0,U.ZV)(p.length)})]})]})]}),d?(0,c.jsx)(F.o,{error:d}):null,a]})})()};var de=a(49348),ue=a(35400),pe=a(19228),he=a(69326),me=a(95963),ge=a(48372);const ve=JSON.parse('{"title_empty":"No operations data","pleaceholder_search":"Search operations","placeholder_kind":"Select operation kind","kind_ssBackgrounds":"SS/Backgrounds","kind_export_s3":"Export/S3","kind_export_yt":"Export/YT","kind_import_s3":"Import/S3","kind_buildIndex":"Build Index","column_operationId":"Operation ID","column_status":"Status","column_createdBy":"Created By","column_createTime":"Create Time","column_endTime":"End Time","column_duration":"Duration","column_state":"State","column_progress":"Progress","label_duration-ongoing":"{{value}} (ongoing)","value_progress_unspecified":"Unspecified","value_progress_preparing":"Preparing","value_progress_transfer_data":"Transferring Data","value_progress_build_indexes":"Building Indexes","value_progress_done":"Done","value_progress_cancellation":"Cancelling","value_progress_cancelled":"Cancelled","value_progress_create_changefeeds":"Creating Changefeeds","header_cancel":"Cancel operation","header_forget":"Forget operation","text_cancel":"The operation will be cancelled. Do you want to proceed?","text_forget":"The operation will be forgotten. Do you want to proceed?","text_forgotten":"The operation {{id}} has been forgotten","text_cancelled":"The operation {{id}} has been cancelled"}'),ye=(0,ge.g4)("ydb-operations",{en:ve}),xe="id",be="status",fe="created_by",je="create_time",Te="end_time",Se="duration",we="state",Ee="progress",_e={[xe]:ye("column_operationId"),[be]:ye("column_status"),[fe]:ye("column_createdBy"),[je]:ye("column_createTime"),[Te]:ye("column_endTime"),[Se]:ye("column_duration"),[we]:ye("column_state"),[Ee]:ye("column_progress")},Ne=[{value:"export/s3",content:ye("kind_export_s3")},{value:"export/yt",content:ye("kind_export_yt")},{value:"import/s3",content:ye("kind_import_s3")},{value:"ss/backgrounds",content:ye("kind_ssBackgrounds")},{value:"buildindex",content:ye("kind_buildIndex")}],Ce=(0,l.cn)("operations");function Pe({kind:e,searchValue:t,handleKindChange:a,handleSearchChange:s}){return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(me.v,{value:t,onChange:s,placeholder:ye("pleaceholder_search"),className:Ce("search")}),(0,c.jsx)(O.l,{value:[e],width:150,options:Ne,onUpdate:e=>a(e[0])})]})}var Ie=a(14750),Ae=a(58272),De=a(45345),Re=a(88908),ke=a(32752),Oe=a(8979),Me=a(47653),Fe=a(22983),Le=a(71661);const qe=g.F.injectEndpoints({endpoints:e=>({getOperationList:e.infiniteQuery({infiniteQueryOptions:{initialPageParam:void 0,getNextPageParam:e=>"0"===e.next_page_token?void 0:e.next_page_token},queryFn:async({queryArg:e,pageParam:t},{signal:a})=>{try{var n;const s={database:e.database,kind:e.kind,page_size:null!==(n=e.page_size)&&void 0!==n?n:20,page_token:t},r=function(e){return Array.isArray(e.operations)?e:{...e,operations:[],next_page_token:"0"}}(await window.api.operation.getOperationList(s,{signal:a}));return{data:r}}catch(s){return{error:s}}},providesTags:["All"]}),cancelOperation:e.mutation({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.operation.cancelOperation(e,{signal:t})}}catch(a){return{error:a}}}}),forgetOperation:e.mutation({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.operation.forgetOperation(e,{signal:t})}}catch(a){return{error:a}}}})}),overrideExisting:"throw"});let ze=function(e){return e.STATUS_CODE_UNSPECIFIED="STATUS_CODE_UNSPECIFIED",e.SUCCESS="SUCCESS",e.BAD_REQUEST="BAD_REQUEST",e.UNAUTHORIZED="UNAUTHORIZED",e.INTERNAL_ERROR="INTERNAL_ERROR",e.ABORTED="ABORTED",e.UNAVAILABLE="UNAVAILABLE",e.OVERLOADED="OVERLOADED",e.SCHEME_ERROR="SCHEME_ERROR",e.GENERIC_ERROR="GENERIC_ERROR",e.TIMEOUT="TIMEOUT",e.BAD_SESSION="BAD_SESSION",e.PRECONDITION_FAILED="PRECONDITION_FAILED",e.ALREADY_EXISTS="ALREADY_EXISTS",e.NOT_FOUND="NOT_FOUND",e.SESSION_EXPIRED="SESSION_EXPIRED",e.CANCELLED="CANCELLED",e.UNDETERMINED="UNDETERMINED",e.UNSUPPORTED="UNSUPPORTED",e.SESSION_BUSY="SESSION_BUSY",e.EXTERNAL_ERROR="EXTERNAL_ERROR",e}({});const Ue="type.googleapis.com/Ydb.Table.IndexBuildMetadata",Qe="type.googleapis.com/Ydb.Import.ImportFromS3Metadata",Ge="type.googleapis.com/Ydb.Export.ExportToS3Metadata",Be="type.googleapis.com/Ydb.Export.ExportToYtMetadata";var $e=a(60940),He=a(73891);function Ve(e){return!!e&&e["@type"]===Ue}function We(e){return function(e){return!!e&&e["@type"]===Qe}(e)||function(e){return!!e&&e["@type"]===Ge}(e)||function(e){return!!e&&e["@type"]===Be}(e)}function Je(e,t){const a=e.metadata;if(!a)return null;if(Ve(a)&&"number"===typeof a.progress)return`${Math.round(a.progress)}%`;if(We(a)){const e=function(e){if(null===e||void 0===e||!e.items_progress||0===e.items_progress.length)return null;let t=0,a=0;for(const n of e.items_progress)void 0!==n.parts_total&&n.parts_total>0&&(t+=n.parts_total,a+=n.parts_completed||0);return 0===t?null:Math.round(a/t*100)}(a);if(null!==e)return`${e}%`;if(a.progress){const e="string"===typeof a.progress?a.progress:String(a.progress),n=`value_progress_${e.replace(/^PROGRESS_/,"").toLowerCase()}`;try{const e=t(n);if(e&&e!==n)return e}catch{}return e}}return null}const Ke=["import/s3","export/s3","export/yt"];function Ye({database:e,refreshTable:t,kind:a}){const n="buildindex"===a,s=Ke.includes(a),r=[{name:xe,header:_e[xe],width:340,render:({row:e})=>{if(!e.id)return f.Pd;const t=n&&(e=>{const{metadata:t}=e;return Ve(t)&&t.description?JSON.stringify(t.description,null,2):""})(e)||e.id;return(0,c.jsx)(Le.s,{placement:["top","bottom"],content:t,children:e.id})}},{name:be,header:_e[be],render:({row:e})=>e.status?(0,c.jsx)(Re.E,{color:e.status===ze.SUCCESS?"positive":"danger",children:e.status}):f.Pd}];return n&&r.push({name:we,header:_e[we],render:({row:e})=>{const t=e.metadata;return null!==t&&void 0!==t&&t.state?t.state:f.Pd}}),(n||s)&&r.push({name:Ee,header:_e[Ee],render:({row:e})=>{const t=Je(e,ye);return null===t?f.Pd:t}}),n||r.push({name:fe,header:_e[fe],render:({row:e})=>e.created_by?e.created_by:f.Pd},{name:je,header:_e[je],render:({row:e})=>e.create_time?(0,U.r6)((0,He.ee)(e.create_time)):f.Pd},{name:Te,header:_e[Te],render:({row:e})=>e.end_time?(0,U.r6)((0,He.ee)(e.end_time)):f.Pd},{name:Se,header:_e[Se],render:({row:e})=>{let t=0;if(!e.create_time)return f.Pd;const a=(0,He.ee)(e.create_time);if(e.end_time){t=(0,He.ee)(e.end_time)-a}else t=Date.now()-a;const n=t>f.Jg*f.KF?(0,Ie.p0)(t).format("hh:mm:ss"):(0,Ie.p0)(t).format("mm:ss");return e.end_time?n:ye("label_duration-ongoing",{value:n})}}),r.push({name:"Actions",sortable:!1,resizeable:!1,header:"",render:({row:a})=>(0,c.jsx)(Ze,{operation:a,database:e,refreshTable:t})}),r}function Ze({operation:e,database:t,refreshTable:a}){const[n,{isLoading:s}]=qe.useCancelOperationMutation(),[r,{isLoading:i}]=qe.useForgetOperationMutation(),o=e.id;if(!o)return null;const l=i,d=s||!0===e.ready;return(0,c.jsxs)(ke.s,{gap:"2",children:[(0,c.jsx)(Oe.m,{title:ye("header_forget"),placement:["left","bottom"],disabled:l,children:(0,c.jsx)("div",{children:(0,c.jsx)(Fe.B,{buttonView:"outlined",dialogHeader:ye("header_forget"),dialogText:ye("text_forget"),onConfirmAction:()=>r({id:o,database:t}).unwrap().then((()=>{(0,$e.A)({name:"Forgotten",title:ye("text_forgotten",{id:o}),theme:"success"}),a()})),buttonDisabled:l,children:(0,c.jsx)(Me.I,{data:Ae.A})})})}),(0,c.jsx)(Oe.m,{title:ye("header_cancel"),placement:["right","bottom"],disabled:d,children:(0,c.jsx)("div",{children:(0,c.jsx)(Fe.B,{popoverDisabled:d,buttonView:"outlined",dialogHeader:ye("header_cancel"),dialogText:ye("text_cancel"),onConfirmAction:()=>n({id:o,database:t}).unwrap().then((()=>{(0,$e.A)({name:"Cancelled",title:ye("text_cancelled",{id:o}),theme:"success"}),a()})),buttonDisabled:d,children:(0,c.jsx)(Me.I,{data:De.A})})})})]})}var Xe=a(13847);var et=a(80987),tt=a(370);const at=tt.z.enum(["ss/backgrounds","export/s3","export/yt","import/s3","buildindex"]).catch("buildindex");function nt({database:e,scrollContainerRef:t}){const{kind:a,searchValue:s,pageSize:i,handleKindChange:o,handleSearchChange:l}=function(){var e,t,a;const[n,s]=(0,et.useQueryParams)({kind:et.StringParam,search:et.StringParam,pageSize:et.NumberParam,pageToken:et.StringParam});return{kind:at.parse(n.kind),searchValue:null!==(e=n.search)&&void 0!==e?e:"",pageSize:null!==(t=n.pageSize)&&void 0!==t?t:void 0,pageToken:null!==(a=n.pageToken)&&void 0!==a?a:void 0,handleKindChange:e=>{s({kind:e},"replaceIn")},handleSearchChange:e=>{s({search:e||void 0},"replaceIn")},handlePageSizeChange:e=>{s({pageSize:e},"replaceIn")},handlePageTokenChange:e=>{s({pageToken:e},"replaceIn")}}}(),{operations:d,isLoading:u,isLoadingMore:p,error:h,refreshTable:m}=function({database:e,kind:t,pageSize:a=20,searchValue:s,scrollContainerRef:r}){const{data:i,error:o,isLoading:l,isFetchingNextPage:c,hasNextPage:d,fetchNextPage:u,refetch:p}=qe.useGetOperationListInfiniteQuery({database:e,kind:t,page_size:a}),h=n.useMemo((()=>null!==i&&void 0!==i&&i.pages?i.pages.flatMap((e=>e.operations||[])):[]),[i]),m=n.useMemo((()=>s?h.filter((e=>{var t;return null===(t=e.id)||void 0===t?void 0:t.toLowerCase().includes(s.toLowerCase())})):h),[h,s]),g=n.useCallback((async()=>{const e=null===r||void 0===r?void 0:r.current;if(!e||!d||c)return;const{scrollHeight:t,clientHeight:a}=e;t<=a&&await u()}),[r,d,c,u]);return n.useLayoutEffect((()=>{if(!c){const e=requestAnimationFrame((()=>{g()}));return()=>cancelAnimationFrame(e)}}),[i,c,g]),n.useEffect((()=>{const e=null===r||void 0===r?void 0:r.current;if(!e)return;const t=()=>{const{scrollTop:t,scrollHeight:a,clientHeight:n}=e;a-t-n<100&&d&&!c&&u()};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}),[r,d,c,u]),n.useEffect((()=>{const e=(0,Xe.throttle)(g,200,{trailing:!0,leading:!0});return window.addEventListener("resize",e),()=>{e.cancel(),window.removeEventListener("resize",e)}}),[g]),{operations:m,isLoading:l,isLoadingMore:c,error:o,refreshTable:p}}({database:e,kind:a,pageSize:i,searchValue:s,scrollContainerRef:t}),g=n.useMemo((()=>({...f.N3,sortable:!1})),[]);return h?(0,c.jsx)(r.A,{error:h,position:"left"}):(0,c.jsxs)(he.L,{children:[(0,c.jsx)(he.L.Controls,{children:(0,c.jsx)(Pe,{kind:a,searchValue:s,handleKindChange:o,handleSearchChange:l})}),(0,c.jsxs)(he.L.Table,{loading:u,className:Ce("table"),children:[d.length>0||u?(0,c.jsx)(ue.l,{columns:Ye({database:e,refreshTable:m,kind:a}),columnsWidthLSKey:"selectedOperationColumns",data:d,settings:g,emptyDataMessage:ye("title_empty")}):(0,c.jsx)("div",{children:ye("title_empty")}),p&&(0,c.jsx)(pe.Q,{showHeader:!1,rows:3,delay:0,className:Ce("loading-more")})]})]})}var st=a(1349),rt=a(71635);let it=function(e){return e.EPathTypeInvalid="EPathTypeInvalid",e.EPathTypeDir="EPathTypeDir",e.EPathTypeTable="EPathTypeTable",e.EPathTypePersQueueGroup="EPathTypePersQueueGroup",e.EPathTypeSubDomain="EPathTypeSubDomain",e.EPathTypeSysView="EPathTypeSysView",e.EPathTypeTableIndex="EPathTypeTableIndex",e.EPathTypeExtSubDomain="EPathTypeExtSubDomain",e.EPathTypeColumnStore="EPathTypeColumnStore",e.EPathTypeColumnTable="EPathTypeColumnTable",e.EPathTypeCdcStream="EPathTypeCdcStream",e.EPathTypeExternalDataSource="EPathTypeExternalDataSource",e.EPathTypeExternalTable="EPathTypeExternalTable",e.EPathTypeView="EPathTypeView",e.EPathTypeReplication="EPathTypeReplication",e.EPathTypeTransfer="EPathTypeTransfer",e.EPathTypeResourcePool="EPathTypeResourcePool",e.EPathTypeStreamingQuery="EPathTypeStreamingQuery",e}({}),ot=function(e){return e.EPathSubTypeEmpty="EPathSubTypeEmpty",e.EPathSubTypeSyncIndexImplTable="EPathSubTypeSyncIndexImplTable",e.EPathSubTypeAsyncIndexImplTable="EPathSubTypeAsyncIndexImplTable",e.EPathSubTypeStreamImpl="EPathSubTypeStreamImpl",e.EPathSubTypeVectorKmeansTreeIndexImplTable="EPathSubTypeVectorKmeansTreeIndexImplTable",e.EPathSubTypeFulltextIndexImplTable="EPathSubTypeFulltextIndexImplTable",e}({});let lt=function(e){return e.ColumnCodecPlain="ColumnCodecPlain",e.ColumnCodecLZ4="ColumnCodecLZ4",e.ColumnCodecZSTD="ColumnCodecZSTD",e}({});let ct=function(e){return e.METERING_MODE_RESERVED_CAPACITY="METERING_MODE_RESERVED_CAPACITY",e.METERING_MODE_REQUEST_UNITS="METERING_MODE_REQUEST_UNITS",e}({});let dt=function(e){return e.EIndexTypeInvalid="EIndexTypeInvalid",e.EIndexTypeGlobal="EIndexTypeGlobal",e.EIndexTypeGlobalAsync="EIndexTypeGlobalAsync",e.EIndexTypeGlobalVectorKmeansTree="EIndexTypeGlobalVectorKmeansTree",e.EIndexTypeGlobalFulltext="EIndexTypeGlobalFulltext",e}({});function ut(e,t){const a=e.replace(/^\/+|\/+$/g,""),n=t.replace(/^\/+|\/+$/g,"");if(!a.startsWith(n))return a||"/";if(a===n)return`/${a}`;let s=a.slice(n.length);return s=s.replace(/^\/+/,"")||"/",s}function pt(e,t){return t===it.EPathTypeDir&&(2===e.split("/").length&&e.startsWith("/"))}var ht=a(11822);function mt(e){return`SELECT * FROM \`${e}\` LIMIT 0`}const gt=g.F.injectEndpoints({endpoints:e=>({getViewSchema:e.query({queryFn:async({database:e,path:t,databaseFullPath:a,timeout:n})=>{try{var s,r;const i=ut(t,a),o=await window.api.viewer.sendQuery({query:mt(i),database:e,action:"execute-scan",timeout:n,internal_call:!0},{withRetries:!0});return(0,ht.We)(o)?{error:o}:{data:(null===o||void 0===o||null===(s=o.result)||void 0===s||null===(r=s[0])||void 0===r?void 0:r.columns)||[]}}catch(i){return{error:i}}},serializeQueryArgs:({queryArgs:e})=>{const{database:t,path:a}=e;return{database:t,path:a}},providesTags:["All","SchemaTree"]})}),overrideExisting:"throw"}),vt=JSON.parse('{"page.title":"Database","pages.query":"Query","pages.diagnostics":"Diagnostics","summary.navigation":"Navigation","summary.showPreview":"Show preview","summary.source-type":"Source Type","summary.data-source":"Data Source","summary.copySchemaPath":"Copy schema path","summary.type":"Type","summary.subtype":"SubType","summary.id":"Id","summary.version":"Version","summary.created":"Created","summary.data-size":"Data size","summary.row-count":"Row count","summary.partitions":"Partitions count","summary.paths":"Paths","summary.shards":"Shards","summary.state":"State","summary.mode":"Mode","summary.format":"Format","summary.retention":"Retention","label.read-only":"ReadOnly","actions.copied":"The path is copied to the clipboard","actions.notCopied":"Couldn\u2019t copy the path","actions.copyPath":"Copy path","actions.connectToDB":"Connect to DB","actions.dropIndex":"Drop index","actions.openPreview":"Open preview","actions.openMonitoring":"Monitoring","actions.createTable":"Create table...","actions.createExternalTable":"Create external table...","actions.createTopic":"Create topic...","actions.createColumnTable":"Create column table...","actions.createAsyncReplication":"Create async replication...","actions.createTransfer":"Create transfer...","actions.createView":"Create view...","actions.createStreamingQuery":"Create streaming query...","actions.dropTable":"Drop table...","actions.dropTopic":"Drop topic...","actions.dropView":"Drop view...","actions.alterTable":"Alter table...","actions.manageColumns":"Manage columns...","actions.manageAutoPartitioning":"Manage auto partitioning...","actions.addTableIndex":"Add index...","actions.createCdcStream":"Create changefeed...","actions.alterTopic":"Alter topic...","actions.selectQuery":"Select query...","actions.upsertQuery":"Upsert query...","actions.alterReplication":"Alter async replicaton...","actions.alterTransfer":"Alter transfer...","actions.dropReplication":"Drop async replicaton...","actions.dropTransfer":"Drop transfer...","actions.dropStreamingQuery":"Drop query...","actions.alterStreamingQuerySettings":"Alter query settings...","actions.alterStreamingQueryText":"Alter query text...","actions.createDirectory":"Create directory","schema.tree.dialog.placeholder":"Relative path","schema.tree.dialog.invalid":"Invalid path","schema.tree.dialog.whitespace":"Whitespace is not allowed","schema.tree.dialog.empty":"Path is empty","schema.tree.dialog.header":"Create directory","schema.tree.dialog.description":"Inside","schema.tree.dialog.buttonCancel":"Cancel","schema.tree.dialog.buttonApply":"Create","label_healthcheck-dashboard":"Healthcheck Dashboard","description_ok":"Everything is working fine.","description_degraded":"Some issues, but still working.","description_maintenance":"Working, but needs urgent attention to avoid failure.","description_emergency":"Something is broken and not working.","label_download":"Download healthcheck data","label_grant-access":"Grant access","context_grant-access":"Please note that granular rights can be combined into groups","entity-name_database":"Database","entity-name_directory":"Directory","entity-name_table":"Table","entity-name_system-view":"System view","entity-name_secondary-index":"Secondary Index","entity-name_vector-index":"Vector Index","entity-name_fulltext-index":"Fulltext Index","entity-name_tablestore":"Tablestore","entity-name_column-oriented-table":"Column-oriented table","entity-name_changefeed":"Changefeed","entity-name_topic":"Topic","entity-name_external-data-source":"External Data Source","entity-name_external-table":"External Table","entity-name_view":"View","entity-name_async-replication":"Async Replication","entity-name_transfer":"Transfer","entity-name_resource-pool":"Resource Pool","entity-name_secondary-index-table":"Secondary Index Table","entity-name_vector-index-table":"Vector Index Table","entity-name_fulltext-index-table":"Fulltext Index Table","entity-name_streaming_query":"Streaming Query"}'),yt=(0,ge.g4)("ydb-tenant",{en:vt}),xt={[ot.EPathSubTypeSyncIndexImplTable]:"index_table",[ot.EPathSubTypeAsyncIndexImplTable]:"index_table",[ot.EPathSubTypeVectorKmeansTreeIndexImplTable]:"index_table",[ot.EPathSubTypeFulltextIndexImplTable]:"index_table",[ot.EPathSubTypeStreamImpl]:void 0,[ot.EPathSubTypeEmpty]:void 0},bt={[it.EPathTypeInvalid]:void 0,[it.EPathTypeSubDomain]:"database",[it.EPathTypeExtSubDomain]:"database",[it.EPathTypeDir]:"directory",[it.EPathTypeColumnStore]:"directory",[it.EPathTypeTable]:"table",[it.EPathTypeSysView]:"system_table",[it.EPathTypeTableIndex]:"index",[it.EPathTypeColumnTable]:"column_table",[it.EPathTypeCdcStream]:"stream",[it.EPathTypePersQueueGroup]:"topic",[it.EPathTypeExternalDataSource]:"external_data_source",[it.EPathTypeExternalTable]:"external_table",[it.EPathTypeView]:"view",[it.EPathTypeReplication]:"async_replication",[it.EPathTypeTransfer]:"transfer",[it.EPathTypeResourcePool]:"resource_pool",[it.EPathTypeStreamingQuery]:"streaming_query"},ft={table:it.EPathTypeTable,index:it.EPathTypeTableIndex,column_table:it.EPathTypeColumnTable,external_table:it.EPathTypeExternalTable,view:it.EPathTypeView},jt={streaming_query:it.EPathTypeStreamingQuery},Tt=(e=it.EPathTypeDir,t,a="directory")=>t&&xt[t]||bt[e]||a,St={[ot.EPathSubTypeSyncIndexImplTable]:yt("entity-name_secondary-index-table"),[ot.EPathSubTypeAsyncIndexImplTable]:yt("entity-name_secondary-index-table"),[ot.EPathSubTypeVectorKmeansTreeIndexImplTable]:yt("entity-name_vector-index-table"),[ot.EPathSubTypeFulltextIndexImplTable]:yt("entity-name_fulltext-index-table"),[ot.EPathSubTypeStreamImpl]:void 0,[ot.EPathSubTypeEmpty]:void 0},wt={[it.EPathTypeInvalid]:void 0,[it.EPathTypeSubDomain]:yt("entity-name_database"),[it.EPathTypeExtSubDomain]:yt("entity-name_database"),[it.EPathTypeDir]:yt("entity-name_directory"),[it.EPathTypeTable]:yt("entity-name_table"),[it.EPathTypeSysView]:yt("entity-name_system-view"),[it.EPathTypeTableIndex]:yt("entity-name_secondary-index"),[it.EPathTypeColumnStore]:yt("entity-name_tablestore"),[it.EPathTypeColumnTable]:yt("entity-name_column-oriented-table"),[it.EPathTypeCdcStream]:yt("entity-name_changefeed"),[it.EPathTypePersQueueGroup]:yt("entity-name_topic"),[it.EPathTypeExternalDataSource]:yt("entity-name_external-data-source"),[it.EPathTypeExternalTable]:yt("entity-name_external-table"),[it.EPathTypeStreamingQuery]:yt("entity-name_streaming_query"),[it.EPathTypeView]:yt("entity-name_view"),[it.EPathTypeReplication]:yt("entity-name_async-replication"),[it.EPathTypeTransfer]:yt("entity-name_transfer"),[it.EPathTypeResourcePool]:yt("entity-name_resource-pool")},Et={[dt.EIndexTypeInvalid]:void 0,[dt.EIndexTypeGlobal]:yt("entity-name_secondary-index"),[dt.EIndexTypeGlobalAsync]:yt("entity-name_secondary-index"),[dt.EIndexTypeGlobalVectorKmeansTree]:yt("entity-name_vector-index"),[dt.EIndexTypeGlobalFulltext]:yt("entity-name_fulltext-index")},_t={UnknownTenantType:"Database",Domain:"Cluster Root",Dedicated:"Dedicated Database",Shared:"Shared Database",Serverless:"Serverless Database"},Nt={[it.EPathTypeTable]:!0,[it.EPathTypeColumnTable]:!0,[it.EPathTypeSysView]:!0,[it.EPathTypeExternalTable]:!0,[it.EPathTypeView]:!0,[it.EPathTypeInvalid]:!1,[it.EPathTypeDir]:!1,[it.EPathTypeSubDomain]:!1,[it.EPathTypeTableIndex]:!1,[it.EPathTypeExtSubDomain]:!1,[it.EPathTypeColumnStore]:!1,[it.EPathTypeCdcStream]:!1,[it.EPathTypePersQueueGroup]:!1,[it.EPathTypeExternalDataSource]:!1,[it.EPathTypeReplication]:!1,[it.EPathTypeTransfer]:!1,[it.EPathTypeResourcePool]:!1,[it.EPathTypeStreamingQuery]:!1},Ct=e=>{var t;return null!==(t=e&&Nt[e])&&void 0!==t&&t},Pt=(ot.EPathSubTypeSyncIndexImplTable,ot.EPathSubTypeAsyncIndexImplTable,ot.EPathSubTypeVectorKmeansTreeIndexImplTable,ot.EPathSubTypeFulltextIndexImplTable,ot.EPathSubTypeStreamImpl,ot.EPathSubTypeEmpty,{[it.EPathTypeColumnStore]:!0,[it.EPathTypeColumnTable]:!0,[it.EPathTypeInvalid]:!1,[it.EPathTypeDir]:!1,[it.EPathTypeTable]:!1,[it.EPathTypeSysView]:!1,[it.EPathTypeSubDomain]:!1,[it.EPathTypeTableIndex]:!1,[it.EPathTypeExtSubDomain]:!1,[it.EPathTypeCdcStream]:!1,[it.EPathTypePersQueueGroup]:!1,[it.EPathTypeExternalDataSource]:!1,[it.EPathTypeExternalTable]:!1,[it.EPathTypeStreamingQuery]:!1,[it.EPathTypeView]:!1,[it.EPathTypeReplication]:!1,[it.EPathTypeTransfer]:!1,[it.EPathTypeResourcePool]:!1}),It=e=>{var t;return null!==(t=e&&Pt[e])&&void 0!==t&&t},At={[it.EPathTypeSubDomain]:!0,[it.EPathTypeExtSubDomain]:!0,[it.EPathTypeInvalid]:!1,[it.EPathTypeDir]:!1,[it.EPathTypeColumnStore]:!1,[it.EPathTypeColumnTable]:!1,[it.EPathTypeTable]:!1,[it.EPathTypeSysView]:!1,[it.EPathTypeTableIndex]:!1,[it.EPathTypeCdcStream]:!1,[it.EPathTypePersQueueGroup]:!1,[it.EPathTypeExternalDataSource]:!1,[it.EPathTypeExternalTable]:!1,[it.EPathTypeStreamingQuery]:!1,[it.EPathTypeView]:!1,[it.EPathTypeReplication]:!1,[it.EPathTypeTransfer]:!1,[it.EPathTypeResourcePool]:!1},Dt=e=>{var t;return null!==(t=e&&At[e])&&void 0!==t&&t},Rt={[ot.EPathSubTypeSyncIndexImplTable]:!0,[ot.EPathSubTypeAsyncIndexImplTable]:!0,[ot.EPathSubTypeVectorKmeansTreeIndexImplTable]:!0,[ot.EPathSubTypeFulltextIndexImplTable]:!0,[ot.EPathSubTypeStreamImpl]:!0,[ot.EPathSubTypeEmpty]:!1},kt={[it.EPathTypeCdcStream]:!1,[it.EPathTypePersQueueGroup]:!0,[it.EPathTypeExternalDataSource]:!0,[it.EPathTypeExternalTable]:!0,[it.EPathTypeView]:!0,[it.EPathTypeResourcePool]:!0,[it.EPathTypeReplication]:!0,[it.EPathTypeTransfer]:!0,[it.EPathTypeInvalid]:!1,[it.EPathTypeColumnStore]:!1,[it.EPathTypeColumnTable]:!1,[it.EPathTypeDir]:!1,[it.EPathTypeTable]:!1,[it.EPathTypeSysView]:!1,[it.EPathTypeSubDomain]:!1,[it.EPathTypeTableIndex]:!1,[it.EPathTypeExtSubDomain]:!1,[it.EPathTypeStreamingQuery]:!0},Ot=(e,t)=>{var a;return null!==(a=t&&Rt[t]||e&&kt[e])&&void 0!==a&&a},Mt=e=>e===it.EPathTypeExternalTable,Ft=e=>e===it.EPathTypeTable,Lt=e=>e===it.EPathTypeView,qt=e=>e===it.EPathTypeSysView;var zt=a(52443),Ut=a(24543);const Qt=JSON.parse('{"column-title.id":"Id","column-title.name":"Name","column-title.type":"Type","column-title.notNull":"NotNull","column-title.autoIncrement":"AutoIncrement","column-title.defaultValue":"Default","column-title.family":"Family","column-title.media":"Media","column-title.compression":"Compression","primary-key.title":"Primary key:","partitioning-key.title":"Partitioning key:"}'),Gt=(0,ge.g4)("ydb-schema-viewer",{en:Qt}),Bt=(0,l.cn)("schema-viewer");const $t=({tableData:e,extended:t,type:a})=>{const n="primary"===a?function(e){return e.filter((e=>Boolean(void 0!==e.keyColumnIndex&&-1!==e.keyColumnIndex&&e.name))).sort(((e,t)=>e.keyColumnIndex-t.keyColumnIndex)).map((e=>e.name))}(e):function(e){return e.filter((e=>Boolean(void 0!==e.partitioningColumnIndex&&-1!==e.partitioningColumnIndex&&e.name))).sort(((e,t)=>e.partitioningColumnIndex-t.partitioningColumnIndex)).map((e=>e.name))}(e),s=t?3:n.length,r=n.slice(0,s),i=n.slice(s);return n.length>0?(0,c.jsxs)("div",{className:Bt("keys",{summary:!t,type:a}),children:[(0,c.jsx)("div",{className:Bt("keys-header"),children:Gt("primary"===a?"primary-key.title":"partitioning-key.title")}),(0,c.jsxs)("div",{className:Bt("keys-values"),children:[" "+r.join(", "),i.length?(0,c.jsx)(Ut.u,{className:Bt("more-badge"),placement:["bottom"],hasArrow:!1,pinOnClick:!0,content:(0,c.jsx)("div",{className:Bt("popup-content"),children:i.map((e=>(0,c.jsx)("div",{className:Bt("popup-item"),children:e},e)))}),children:(0,c.jsx)(zt.J,{className:Bt("keys-label"),children:`+${i.length}`})}):null]})]}):null};var Ht=a(4557);function Vt({data:e,name:t,header:a,sortable:n}){const s="string"===typeof a?a.length:t.length;let r=n?s+2:s;if(e)for(const i of e){let e=0;if(i[t]&&(e=String(i[t]).length),r=Math.max(r,e),10*r+20>=600)return 600}return 10*r+20}var Wt=a(34671);const Jt="name",Kt="type",Yt="notNull",Zt="autoIncrement",Xt="defaultValue",ea="familyName",ta="prefferedPoolKind",aa="columnCodec",na={name:"id",get header(){return Gt("column-title.id")},width:60,align:Ht.Ay.RIGHT,render:({row:e})=>{const t=(0,c.jsx)(Me.I,{className:Bt("key-icon"),size:12,data:Wt.A});return(0,c.jsxs)("span",{className:Bt("id-wrapper"),children:[e.id,void 0===e.keyColumnIndex||-1===e.keyColumnIndex?null:t]})}},sa={name:Jt,get header(){return Gt("column-title.name")},width:120,render:({row:e})=>e.name},ra={name:Kt,get header(){return Gt("column-title.type")},width:100,render:({row:e})=>e.type},ia={name:Yt,get header(){return Gt("column-title.notNull")},width:100,defaultOrder:Ht.Ay.DESCENDING,render:({row:e})=>{if(e.notNull)return"\u2713"}},oa={name:Zt,get header(){return Gt("column-title.autoIncrement")},width:100,defaultOrder:Ht.Ay.DESCENDING,render:({row:e})=>{if(e.autoIncrement)return"\u2713"}},la={name:Xt,get header(){return Gt("column-title.defaultValue")},width:100,render:({row:e})=>String(e.defaultValue)},ca={name:ea,get header(){return Gt("column-title.family")},width:100,render:({row:e})=>e.familyName},da={name:ta,get header(){return Gt("column-title.media")},width:100,render:({row:e})=>e.prefferedPoolKind},ua={name:aa,get header(){return Gt("column-title.compression")},width:130,render:({row:e})=>e.columnCodec};function pa(e,t){if(!t)return e;const a=t.slice(0,100);return e.map((e=>({...e,width:Vt({data:a,name:e.name,header:"string"===typeof e.header?e.header:void 0,sortable:e.sortable||void 0===e.sortable})})))}function ha(e={}){const t=function(e){var t,a,n;return null!==(t=null===e||void 0===e||null===(a=e.PartitionConfig)||void 0===a||null===(n=a.ColumnFamilies)||void 0===n?void 0:n.reduce(((e,t)=>t.Id?{...e,[t.Id]:t}:e),{}))&&void 0!==t?t:{}}(e),{Columns:a,KeyColumnNames:n}=e,s=null===a||void 0===a?void 0:a.map((e=>{var a,s,r,i;const{Id:o,Name:l,NotNull:c,Type:d,Family:u,DefaultFromSequence:p,DefaultFromLiteral:h}=e,m=null!==(a=null===n||void 0===n?void 0:n.findIndex((e=>e===l)))&&void 0!==a?a:-1,g=u?t[u].Name:void 0,v=u?null===(s=t[u].StorageConfig)||void 0===s||null===(r=s.Data)||void 0===r?void 0:r.PreferredPoolKind:void 0,y=u?function(e){if(e)return e===lt.ColumnCodecPlain?"None":e.replace("ColumnCodec","").toLocaleLowerCase()}(t[u].ColumnCodec):void 0;return{id:o,name:l,keyColumnIndex:m,type:d,notNull:c,autoIncrement:Boolean(p),defaultValue:null!==(i=Object.values((null===h||void 0===h?void 0:h.value)||{})[0])&&void 0!==i?i:"-",familyName:g,prefferedPoolKind:v,columnCodec:y}}));return null!==s&&void 0!==s?s:[]}function ma(e,t){const{Table:a,ColumnTableDescription:n,ExternalTableDescription:s}=(null===t||void 0===t?void 0:t.PathDescription)||{};return Ft(e)||qt(e)?ha(a):It(e)?function(e={}){const{Schema:t={},Sharding:a={}}=e,{Columns:n,KeyColumnNames:s}=t,{HashSharding:r={}}=a,{Columns:i=[]}=r,o=null===n||void 0===n?void 0:n.map((e=>{var t,a;const{Id:n,Name:r,Type:o,NotNull:l}=e,c=null!==(t=null===s||void 0===s?void 0:s.findIndex((e=>e===r)))&&void 0!==t?t:-1,d=null!==(a=null===i||void 0===i?void 0:i.findIndex((e=>e===r)))&&void 0!==a?a:-1;return{id:n,name:r,keyColumnIndex:c,partitioningColumnIndex:d,type:o,notNull:l}}));return[...(null===o||void 0===o?void 0:o.filter((e=>-1!==e.keyColumnIndex)))||[],...(null===o||void 0===o?void 0:o.filter((e=>-1===e.keyColumnIndex)))||[]]}(n):Mt(e)?function(e={}){const{Columns:t}=e;return(null===t||void 0===t?void 0:t.map((e=>{const{Id:t,Name:a,Type:n,NotNull:s}=e;return{id:t,name:a,type:n,notNull:s}})))||[]}(s):[]}function ga(e){return(null===e||void 0===e?void 0:e.map((e=>{var t;return{type:null!==(t=e.type)&&void 0!==t&&t.endsWith("?")?e.type.slice(0,-1):e.type,name:e.name}})))||[]}const va=({type:e,path:t,database:a,extended:s=!1,databaseFullPath:r})=>{const[i]=(0,j.Nt)(),o=s?i:void 0,{currentData:l,isFetching:d}=v.useGetOverviewQuery({path:t,database:a,databaseFullPath:r},{pollingInterval:o,skip:Lt(e)}),{currentData:u,isFetching:p}=gt.useGetViewSchemaQuery({path:t,database:a,databaseFullPath:r},{pollingInterval:o,skip:!Lt(e)}),h=p&&void 0===u||d&&void 0===l,m=n.useMemo((()=>Lt(e)?ga(u):ma(e,l)),[l,e,u]),g=n.useMemo((()=>m.some((e=>e.autoIncrement))),[m]),y=n.useMemo((()=>m.some((e=>e.defaultValue))),[m]),x=n.useMemo((()=>Lt(e)?pa([sa,ra],m):qt(e)||Mt(e)||It(e)?function(e){return pa([na,sa,ra,ia],e)}(m):Ft(e)?function(e,t,a,n){const s=[na,sa,ra,ia];return n&&s.push(la),t&&s.push(ca,da,ua),a&&s.push(oa),pa(s,e)}(m,s,g,y):[]),[e,s,g,y,m]);return h?(0,c.jsx)(pe.Q,{}):(0,c.jsxs)(n.Fragment,{children:[(0,c.jsxs)("div",{className:Bt("keys-wrapper"),children:[(0,c.jsx)($t,{tableData:m,extended:s,type:"primary"}),(0,c.jsx)($t,{tableData:m,extended:s,type:"partitioning"})]}),(0,c.jsx)("div",{className:Bt(),children:(0,c.jsx)(ue.l,{columnsWidthLSKey:"schemaTableColumnsWidth",data:m,columns:x,settings:f.N3})})]})},ya=n.createContext(void 0),xa=({children:e,path:t,database:a,type:s,subType:r,databaseFullPath:i})=>{const o=n.useMemo((()=>({path:t,database:a,type:s,subType:r,databaseFullPath:i})),[t,a,s,r,i]);return(0,c.jsx)(ya.Provider,{value:o,children:e})},ba=()=>{const e=n.useContext(ya);if(void 0===e)throw Error("useCurrentSchema must be used within a TenantContextProvider");return e};var fa=a(32836),ja=a(80136),Ta=a(53850);const Sa=g.F.injectEndpoints({endpoints:e=>({getSchemaAcl:e.query({queryFn:async({path:e,database:t,dialect:a,databaseFullPath:n},{signal:s})=>{try{const r=await window.api.viewer.getSchemaAcl({path:{path:e,databaseFullPath:n},database:t,dialect:a},{signal:s});return{data:{acl:r.Common.ACL,effectiveAcl:r.Common.EffectiveACL,owner:r.Common.Owner,interruptInheritance:r.Common.InterruptInheritance}}}catch(r){return{error:r}}},providesTags:["All","AccessRights"]}),getAvailablePermissions:e.query({queryFn:async({database:e,dialect:t,databaseFullPath:a},{signal:n})=>{try{return{data:(await window.api.viewer.getAvailablePermissions({path:{path:a,databaseFullPath:a},database:e,dialect:t},{signal:n})).AvailablePermissions}}catch(s){return{error:s}}}}),updateAccess:e.mutation({queryFn:async({database:e,databaseFullPath:t,path:a,rights:n,dialect:s})=>{try{return{data:await window.api.viewer.updateAccessRights({database:e,rights:n,dialect:s,path:{path:a,databaseFullPath:t}})}}catch(r){return{error:r}}},invalidatesTags:(e,t)=>t?[]:["AccessRights"]})}),overrideExisting:"throw"}),wa=(0,Ta.Mz)((e=>e),((e,t)=>t),((e,t,a)=>a),((e,t,a,n)=>n),((e,t,a,n)=>Sa.endpoints.getSchemaAcl.select({path:e,database:t,databaseFullPath:a,dialect:n}))),Ea=(0,Ta.Mz)((e=>e),((e,t,a,n,s)=>wa(t,a,n,s)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.owner})),_a=(0,Ta.Mz)((e=>e),((e,t,a,n,s)=>wa(t,a,n,s)),((e,t)=>t(e).data)),Na=(0,Ta.Mz)(((e,t,a,n,s)=>_a(e,t,a,n,s)),(e=>{if(!e)return null;const{acl:t,effectiveAcl:a}=e,n={};return null!==t&&void 0!==t&&t.length&&t.forEach((e=>{var t,a;e.Subject&&(n[e.Subject]||(n[e.Subject]={explicit:new Set,effective:new Set}),null===(t=e.AccessRules)||void 0===t||t.forEach((t=>{n[e.Subject].explicit.add(t)})),null===(a=e.AccessRights)||void 0===a||a.forEach((t=>{n[e.Subject].explicit.add(t)})))})),null!==a&&void 0!==a&&a.length&&a.forEach((e=>{var t,a;e.Subject&&(n[e.Subject]||(n[e.Subject]={explicit:new Set,effective:new Set}),null===(t=e.AccessRules)||void 0===t||t.forEach((t=>{n[e.Subject].effective.add(t)})),null===(a=e.AccessRights)||void 0===a||a.forEach((t=>{n[e.Subject].effective.add(t)})))})),n})),Ca=(0,Ta.Mz)(((e,t,a,n,s)=>Na(e,t,a,n,s)),(e=>e?Object.entries(e).map((([e,t])=>({subject:e,explicit:Array.from(t.explicit),effective:Array.from(t.effective)}))):null)),Pa=(0,Ta.Mz)([(e,t)=>t,(e,t,a,n,s,r)=>Na(e,a,n,s,r)],((e,t)=>{var a;if(!e||!t)return[];const n=(null===(a=t[e])||void 0===a?void 0:a.explicit)||new Set;return Array.from(n)})),Ia=(0,Ta.Mz)([(e,t)=>t,(e,t,a,n,s,r)=>Na(e,a,n,s,r)],((e,t)=>{var a,n;if(!e||!t)return new Set;const s=(null===(a=t[e])||void 0===a?void 0:a.explicit)||new Set,r=(null===(n=t[e])||void 0===n?void 0:n.effective)||new Set,i=Array.from(r).filter((e=>!s.has(e)));return new Set(i)})),Aa=(0,Ta.Mz)((e=>e),((e,t)=>t),((e,t,a)=>a),((e,t,a)=>Sa.endpoints.getAvailablePermissions.select({database:e,dialect:a,databaseFullPath:t}))),Da=(0,Ta.Mz)((e=>e),((e,t,a,n)=>Aa(t,a,n)),((e,t)=>t(e).data));function Ra(){const[{showHealthcheck:e,database:t,schema:a,view:s,issuesFilter:r,showGrantAccess:i,aclSubject:o,name:l},c]=(0,et.useQueryParams)({name:et.StringParam,showHealthcheck:et.BooleanParam,database:et.StringParam,schema:et.StringParam,view:et.StringParam,issuesFilter:et.StringParam,showGrantAccess:et.BooleanParam,aclSubject:et.StringParam}),d=n.useCallback((e=>{c({showHealthcheck:e||void 0},"replaceIn")}),[c]),u=n.useCallback((e=>{c({aclSubject:e},"replaceIn")}),[c]),p=n.useCallback((e=>{c({showGrantAccess:e||void 0},"replaceIn")}),[c]),h=n.useCallback((e=>{c({database:e},"replaceIn")}),[c]),m=n.useCallback((e=>{c({schema:e},"replaceIn")}),[c]),g=n.useCallback((e=>{c({issuesFilter:e},"replaceIn")}),[c]),v=n.useCallback((e=>{c({view:e},"replaceIn")}),[c]);return n.useEffect((()=>{l&&!t&&c({database:l,name:void 0},"replaceIn")}),[t,l,c]),{showHealthcheck:e,handleShowHealthcheckChange:d,database:t||l,handleDatabaseChange:h,showGrantAccess:i,handleShowGrantAccessChange:p,schema:a,handleSchemaChange:m,view:s,handleHealthcheckViewChange:v,issuesFilter:r,handleIssuesFilterChange:g,aclSubject:o,handleAclSubjectChange:u}}var ka=a(70960),Oa=a(65872),Ma=a(89449),Fa=a(11442),La=a(70992);const qa=(0,l.cn)("ydb-subject-with-avatar");function za({subject:e,title:t,renderIcon:a}){return(0,c.jsxs)(ke.s,{gap:2,alignItems:"center",children:[(0,c.jsxs)("div",{className:qa("avatar-wrapper"),children:[(0,c.jsx)(La.e,{theme:"brand",text:e,title:e}),null===a||void 0===a?void 0:a()]}),(0,c.jsxs)(ke.s,{direction:"column",overflow:"hidden",children:[(0,c.jsx)(Re.E,{variant:"body-2",className:qa("subject"),children:e}),t&&(0,c.jsx)(Re.E,{variant:"body-2",color:"secondary",children:t})]})]})}const Ua=JSON.parse('{"title_owner":"owner","action_change-owner":"Change owner","description_owner":"The owner has complete management authority over the object and cannot acquire or lose any rights associated with it.","action_grant-access":"Grant Access","label_explicit-rights":"Explicit rights","label_effective-rights":"Effective rights","label_subject":"Subject","descrtiption_empty-rights":"No access rights","decription_enter-subject":"Enter subject","action_cancel":"Cancel","action_apply":"Apply","title_owner-changed":"Owner has been successfully changed","description_explicit-rights":"Direct granted permissions","description_effective-rights":"Total active permissions from inheritance and direct grants","action_revoke":"Revoke","label_revoke-all-rights":"Revoke all explicit rights","descripition_no-rights-to-revoke":"No rights to revoke","description_grant-explicit-rights":"Grant explicit rights","description_revoke-all-rights":"Are you sure you want to revoke all explicit rights for:","description_rights-revoked":"Explicit rights has been successfully revoked"}'),Qa=(0,ge.g4)("ydb-access-rights",{en:Ua}),Ga=(0,l.cn)("ydb-access-rights");var Ba=a(16332),$a=a(71989),Ha=a(79602),Va=a(65809);const Wa="change-owner-dialog";const Ja=Ba.Ay.create((({path:e,database:t,databaseFullPath:a})=>{const n=Ba.Ay.useModal();return(0,c.jsx)(Ka,{onClose:()=>{n.resolve(!1),n.hide(),n.remove()},open:n.visible,path:e,database:t,databaseFullPath:a})}));function Ka({open:e,onClose:t,path:a,database:s,databaseFullPath:r}){const[i,o]=n.useState(""),[l,d]=n.useState(""),[u,p]=Sa.useUpdateAccessMutation(),h=(0,j.XC)(),m=n.useRef(null),g=()=>{u({path:a,database:s,databaseFullPath:r,dialect:h,rights:{ChangeOwnership:{Subject:i}}}).unwrap().then((()=>{t(),(0,$e.A)({name:"updateOwner",content:Qa("title_owner-changed"),autoHiding:3e3})})).catch((e=>{d((0,Va.$)(e))}))};return(0,c.jsxs)($a.l,{open:e,size:"s",onClose:t,onEnterKeyDown:g,initialFocus:m,children:[(0,c.jsx)($a.l.Header,{caption:Qa("action_change-owner")}),(0,c.jsx)($a.l.Body,{children:(0,c.jsxs)("div",{className:Ga("dialog-content-wrapper"),children:[(0,c.jsx)(Ha.k,{controlRef:m,id:"queryName",placeholder:Qa("decription_enter-subject"),value:i,onUpdate:e=>{o(e),d("")},hasClear:!0,autoFocus:!0,autoComplete:!1}),l&&(0,c.jsx)(Re.E,{color:"danger",className:Ga("dialog-error"),title:l,children:l})]})}),(0,c.jsx)($a.l.Footer,{onClickButtonApply:g,textButtonCancel:Qa("action_cancel"),textButtonApply:Qa("action_apply"),onClickButtonCancel:t,propsButtonApply:{loading:p.isLoading,disabled:!i.length}})]})}function Ya(){const e=(0,I.nz)(),{path:t,database:a,databaseFullPath:n}=ba(),s=(0,j.XC)(),r=(0,j.N4)((e=>Ea(e,t,a,n,s)));if(!r)return null;return(0,c.jsxs)(ke.s,{gap:4,alignItems:"center",children:[(0,c.jsx)(Ma.Z,{view:"filled",className:Ga("owner-card"),children:(0,c.jsxs)(ke.s,{alignItems:"center",justifyContent:"space-between",gap:9,children:[(0,c.jsx)(za,{subject:r,renderIcon:()=>(0,c.jsx)(ke.s,{alignItems:"center",justifyContent:"center",className:Ga("icon-wrapper"),children:(0,c.jsx)(Me.I,{data:ka.A,size:14,className:Ga("avatar-icon")})}),title:Qa("title_owner")}),e&&(0,c.jsxs)(ke.s,{gap:1,alignItems:"center",children:[(0,c.jsx)(Fa.c,{className:Ga("owner-divider"),orientation:"vertical"}),(0,c.jsx)(Oe.m,{title:Qa("action_change-owner"),children:(0,c.jsx)(ja.$,{view:"flat-secondary",onClick:()=>async function({path:e,database:t,databaseFullPath:a}){return await Ba.Ay.show(Wa,{id:Wa,path:e,database:t,databaseFullPath:a})}({path:t,database:a,databaseFullPath:n}),children:(0,c.jsx)(Me.I,{data:Oa.A})})})]})]})}),(0,c.jsx)(Re.E,{color:"secondary",className:Ga("owner-description"),children:Qa("description_owner")})]})}Ba.Ay.register(Wa,Ja);var Za=a(78491),Xa=a(10800);const en="revoke-all-rights-dialog";const tn=Ba.Ay.create((({path:e,database:t,subject:a,databaseFullPath:n})=>{const s=Ba.Ay.useModal();return(0,c.jsx)(an,{onClose:()=>{s.resolve(!1),s.hide(),s.remove()},open:s.visible,path:e,database:t,subject:a,databaseFullPath:n})}));function an({open:e,onClose:t,path:a,database:s,databaseFullPath:r,subject:i}){const o=(0,j.XC)(),l=(0,j.N4)((e=>Pa(e,i,a,s,r,o))),[d,u]=n.useState(""),[p,h]=Sa.useUpdateAccessMutation();return(0,c.jsxs)($a.l,{open:e,size:"s",onClose:t,children:[(0,c.jsx)($a.l.Header,{caption:Qa("label_revoke-all-rights")}),(0,c.jsx)($a.l.Body,{children:(0,c.jsxs)(ke.s,{direction:"column",gap:5,children:[(0,c.jsx)(Re.E,{variant:"body-2",children:Qa("description_revoke-all-rights")}),(0,c.jsx)(za,{subject:i})]})}),(0,c.jsx)($a.l.Footer,{onClickButtonApply:()=>{p({path:a,database:s,databaseFullPath:r,dialect:o,rights:{RemoveAccess:[{Subject:i,AccessRights:Array.from(l),AccessType:"Allow"}]}}).unwrap().then((()=>{t(),(0,$e.A)({name:"revokeAllRights",content:Qa("description_rights-revoked"),autoHiding:3e3})})).catch((e=>{u((0,Va.$)(e))}))},textButtonCancel:Qa("action_cancel"),textButtonApply:Qa("action_revoke"),onClickButtonCancel:t,propsButtonApply:{loading:h.isLoading,view:"outlined-danger"},children:d&&(0,c.jsx)(Re.E,{color:"danger",title:d,children:d})})]})}Ba.Ay.register(en,tn);function nn({subject:e,className:t}){return(0,I.nz)()?(0,c.jsxs)(ke.s,{gap:1,className:t,alignItems:"center",children:[(0,c.jsx)(sn,{subject:e}),(0,c.jsx)(rn,{subject:e})]}):null}function sn({subject:e}){const{handleShowGrantAccessChange:t,handleAclSubjectChange:a}=Ra();return(0,c.jsx)(Oe.m,{title:Qa("description_grant-explicit-rights"),children:(0,c.jsx)(ja.$,{view:"outlined",onClick:()=>{t(!0),a(e)},size:"s",children:(0,c.jsx)(Me.I,{data:Oa.A})})})}function rn({subject:e}){const{path:t,database:a,databaseFullPath:n}=ba(),s=(0,j.XC)(),r=0===(0,j.N4)((r=>Pa(r,e,t,a,n,s))).length;return(0,c.jsx)(Oe.m,{title:Qa(r?"descripition_no-rights-to-revoke":"label_revoke-all-rights"),children:(0,c.jsx)("div",{className:Ga("button-wrapper"),children:(0,c.jsx)(ja.$,{onClick:async()=>{await async function({path:e,database:t,subject:a,databaseFullPath:n}){return await Ba.Ay.show(en,{id:en,path:e,database:t,subject:a,databaseFullPath:n})}({path:t,database:a,databaseFullPath:n,subject:e})},disabled:r,view:"outlined",size:"s",children:(0,c.jsx)(Me.I,{data:Xa.A})})})})}const on=[{name:"subject",width:210,get header(){return Qa("label_subject")},render:({row:{subject:e}})=>(0,c.jsx)(za,{subject:e})},{name:"explicit",width:400,get header(){return(0,c.jsx)(Za.$,{header:Qa("label_explicit-rights"),note:Qa("description_explicit-rights")})},render:({row:{subject:e,explicit:t}})=>(0,c.jsxs)(ke.s,{justifyContent:"space-between",alignItems:"center",className:Ga("rights-wrapper"),children:[(0,c.jsx)(ke.s,{gap:2,wrap:"wrap",children:t.map((e=>(0,c.jsx)(zt.J,{theme:"normal",size:"xs",children:e},e)))}),(0,c.jsx)(nn,{subject:e,className:Ga("rights-actions")})]}),sortable:!1},{name:"effective",width:400,get header(){return(0,c.jsx)(Za.$,{header:Qa("label_effective-rights"),note:Qa("description_effective-rights")})},render:({row:{effective:e}})=>(0,c.jsx)(ke.s,{gap:2,wrap:"wrap",children:e.map((e=>(0,c.jsx)(zt.J,{theme:"unknown",size:"xs",children:e},e)))}),sortable:!1}],ln={...f.N3,dynamicRender:!1};function cn(){const{path:e,database:t,databaseFullPath:a}=ba(),n=(0,j.XC)(),s=(0,j.N4)((s=>Ca(s,e,t,a,n)));return(0,c.jsx)(ue.l,{columnsWidthLSKey:"right-table-columns-width",columns:on,data:null!==s&&void 0!==s?s:[],settings:ln,emptyDataMessage:Qa("descrtiption_empty-rights"),wrapperClassName:Ga("rights-table")})}function dn(){const{path:e,database:t,databaseFullPath:a}=ba(),s=(0,I.nz)(),[r]=(0,j.Nt)(),o=(0,j.XC)(),{isFetching:l,currentData:d,error:u}=Sa.useGetSchemaAclQuery({path:e,database:t,dialect:o,databaseFullPath:a},{pollingInterval:r}),{handleShowGrantAccessChange:p}=Ra(),h=l&&!d;return(0,c.jsx)(i.r,{loading:h,children:u?(0,c.jsx)(F.o,{error:u}):(0,c.jsxs)(n.Fragment,{children:[(0,c.jsxs)(ke.s,{gap:10,justifyContent:"space-between",alignItems:"start",className:Ga("header"),children:[(0,c.jsx)(Ya,{}),s&&(0,c.jsxs)(ja.$,{view:"action",onClick:()=>{p(!0)},children:[(0,c.jsx)(Me.I,{data:fa.A}),Qa("action_grant-access")]})]}),(0,c.jsx)(cn,{})]})})}var un=a(23536),pn=a.n(un),hn=a(46549);const mn=g.F.injectEndpoints({endpoints:e=>({getTopic:e.query({queryFn:async({path:e,database:t,databaseFullPath:a})=>{try{const n=await window.api.viewer.getTopic({path:{path:e,databaseFullPath:a},database:t});return"object"!==typeof n?{error:{}}:{data:n}}catch(n){return{error:n}}},providesTags:["All"]}),getTopicData:e.query({queryFn:async e=>{try{return{data:await window.api.viewer.getTopicData({message_size_limit:100,...e})}}catch(t){return{error:t}}},keepUnusedDataFor:0})}),overrideExisting:"throw"}),gn=(0,Ta.Mz)((e=>e),((e,t)=>t),((e,t,a)=>a),((e,t,a)=>mn.endpoints.getTopic.select({path:e,database:t,databaseFullPath:a}))),vn=(0,Ta.Mz)((e=>e),((e,t,a,n)=>gn(t,a,n)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.topic_stats})),yn=(0,Ta.Mz)((e=>e),((e,t,a,n)=>gn(t,a,n)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.consumers})),xn=(0,Ta.Mz)(yn,(e=>null===e||void 0===e?void 0:e.map((e=>null===e||void 0===e?void 0:e.name)).filter((e=>void 0!==e)))),bn=(0,Ta.Mz)(vn,(e=>{if(!e)return;const{store_size_bytes:t="0",min_last_write_time:a,max_write_time_lag:n,bytes_written:s}=e||{};return{storeSize:t,partitionsIdleTime:(0,He.MC)(a),partitionsWriteLag:(0,He.i6)(n),writeSpeed:(0,hn.ey)(s)}})),fn=(0,Ta.Mz)(yn,(e=>null===e||void 0===e?void 0:e.map((e=>{const{name:t,consumer_stats:a}=e||{},{min_partitions_last_read_time:n,max_read_time_lag:s,max_write_time_lag:r,bytes_read:i}=a||{};return{name:t,readSpeed:(0,hn.ey)(i),writeLag:(0,He.i6)(r),readLag:(0,He.i6)(s),readIdleTime:(0,He.MC)(n)}}))));var jn=a(58611);const Tn=JSON.parse('{"averageSpeed":"Average speed","perMinute":"per minute","perHour":"per hour","perDay":"per day"}'),Sn=JSON.parse('{"averageSpeed":"\u0421\u0440\u0435\u0434\u043d\u044f\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c","perMinute":"\u0437\u0430 \u043c\u0438\u043d\u0443\u0442\u0443","perHour":"\u0437\u0430 \u0447\u0430\u0441","perDay":"\u0437\u0430 \u0434\u0435\u043d\u044c"}'),wn=(0,ge.g4)("ydb-components-speed-multimeter",{ru:Sn,en:Tn}),En=(0,l.cn)("speed-multimeter"),_n=({data:e,speedSize:t="kb",withValue:a=!0,withPopover:s=!0})=>{const{perMinute:r=0,perHour:i=0,perDay:o=0}=e||{},l=[r,i,o],d=e=>(0,hn.z3)({value:e,size:t,withSpeedLabel:!0}),u=[{value:d(r),label:wn("perMinute")},{value:d(i),label:wn("perHour")},{value:d(o),label:wn("perDay")}],[p,h]=n.useState(0),[m,g]=n.useState(a?0:void 0),[v,y]=n.useState(),x=e=>m===e,b=e=>v===e;return(0,c.jsx)("div",{className:En(),children:(0,c.jsxs)("div",{className:En("content"),children:[a&&(0,c.jsx)("div",{className:En("displayed-value"),children:d(l[p])}),(0,c.jsx)(jn.A,{content:(0,c.jsxs)("div",{className:En("popover-content"),children:[(0,c.jsx)("span",{className:En("popover-header"),children:wn("averageSpeed")}),u.map(((e,t)=>{return(0,c.jsx)("span",{className:En("popover-row",(a=x(t),a?{color:"primary"}:{color:"secondary"})),children:`${e.label}: ${e.value}`},t);var a}))]}),className:En("popover-container",f.zQ),placement:"bottom",disabled:!s,hasArrow:!0,children:(0,c.jsx)("div",{className:En("bars"),onMouseLeave:()=>{h(0),g(a?0:void 0),y(void 0)},children:(()=>{const e=Math.max(...l,0)||1;return l.map(((t,a)=>(0,c.jsx)("div",{className:En("bar-container",{highlighted:b(a)}),onMouseEnter:()=>(e=>{h(e),g(e),y(e)})(a),children:(0,c.jsx)("div",{className:En("bar",{color:x(a)?"dark":"light"}),style:{width:100*t/e+"%"}})},a)))})()})})]})})},Nn=(0,l.cn)("ydb-diagnostics-consumers-topic-stats"),Cn=({data:e})=>{const{writeSpeed:t,partitionsWriteLag:a,partitionsIdleTime:n}=e||{},s=[{label:"Write speed",value:(0,c.jsx)(_n,{data:t})},{label:"Write lag",value:(0,U.lr)(a||0)},{label:"Write idle time",value:(0,U.lr)(n||0)}];return(0,c.jsx)("div",{className:Nn("wrapper"),children:s.map(((e,t)=>(0,c.jsxs)("div",{className:Nn("item"),children:[(0,c.jsx)("div",{className:Nn("label"),children:e.label}),(0,c.jsx)("div",{className:Nn("value"),children:e.value})]},t)))})};var Pn=a(74309),In=a.n(Pn),An=a(44294),Dn=a(15017),Rn=a(54309),kn=a(20263);const On=({text:e,popoverContent:t,popoverClassName:a,className:n})=>(0,c.jsxs)("div",{className:n,children:[e,"\xa0",(0,c.jsx)(kn.H,{className:a,children:t})]}),Mn=70,Fn=54,Ln=268,qn="#ADE8F5",zn="#f5be9d",Un=({width:e,height:t,transform:a})=>(0,c.jsx)("path",{d:`M-${e/2} 0 c0 -${t}, ${e} -${t}, ${e} 0`,fill:"none",strokeDasharray:"4,6",stroke:"#28f",strokeWidth:"1.6",transform:a}),Qn=({width:e})=>(0,c.jsx)("path",{fill:"none",strokeWidth:"2",d:`M0 0 h${e} l-10 -5 m0 10 l10 -5`}),Gn=()=>(0,c.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,c.jsx)("g",{transform:"translate(0, 27)",stroke:zn,children:(0,c.jsx)(Qn,{width:203})}),(0,c.jsxs)("g",{transform:"translate(30, 0)",children:[(0,c.jsxs)("g",{transform:"translate(35, 27)",children:[(0,c.jsx)(Un,{width:Mn,height:15}),(0,c.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,c.jsxs)("g",{transform:"translate(119, 27)",children:[(0,c.jsx)(Un,{width:98,height:15}),(0,c.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"write idle time"})})]})]}),(0,c.jsxs)("g",{transform:"translate(30, 0)",children:[(0,c.jsxs)("g",{transform:"translate(0, 27)",children:[(0,c.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:zn}),(0,c.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,c.jsxs)("g",{transform:"translate(70, 27)",children:[(0,c.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:zn}),(0,c.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,c.jsx)("g",{transform:"translate(168, 27)",children:(0,c.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),Bn=()=>(0,c.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,c.jsx)("g",{transform:"translate(0, 27)",stroke:qn,children:(0,c.jsx)(Qn,{width:Ln})}),(0,c.jsxs)("g",{transform:"translate(30, 0)",children:[(0,c.jsxs)("g",{transform:"translate(105, 27)",children:[(0,c.jsx)(Un,{width:Mn,height:15}),(0,c.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"read lag"})})]}),(0,c.jsxs)("g",{transform:"translate(35, 27)",children:[(0,c.jsx)(Un,{width:Mn,height:15}),(0,c.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,c.jsxs)("g",{transform:"translate(182, 27)",children:[(0,c.jsx)(Un,{width:91,height:15}),(0,c.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"read idle time"})})]})]}),(0,c.jsxs)("g",{transform:"translate(30, 27)",children:[(0,c.jsxs)("g",{transform:"translate(0, 0)",children:[(0,c.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:qn}),(0,c.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,c.jsxs)("g",{transform:"translate(70, 0)",children:[(0,c.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:qn}),(0,c.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,c.jsxs)("g",{transform:"translate(140, 0)",children:[(0,c.jsx)("use",{x:"-2",y:"-10",xlinkHref:"#check",stroke:qn}),(0,c.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"read time"})})]}),(0,c.jsx)("g",{transform:"translate(224, 0)",children:(0,c.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,c.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),$n=({id:e,fill:t})=>(0,c.jsx)("pattern",{id:e,x:"0",y:"0",width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,c.jsx)("path",{d:"M0 5L5 0H8L0 8V5M5 8L8 5V8Z",fill:t})}),Hn=()=>(0,c.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 268 54",width:Ln,height:Fn,children:[(0,c.jsxs)("defs",{children:[(0,c.jsx)("g",{id:"check",children:(0,c.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,c.jsx)($n,{id:"latest-read",fill:qn}),(0,c.jsx)($n,{id:"latest-write",fill:zn})]}),(0,c.jsx)(Gn,{})]}),Vn=()=>(0,c.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 268 54",width:Ln,height:Fn,children:[(0,c.jsxs)("defs",{children:[(0,c.jsx)("g",{id:"check",children:(0,c.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,c.jsx)($n,{id:"latest-read",fill:qn}),(0,c.jsx)($n,{id:"latest-write",fill:zn})]}),(0,c.jsx)(Bn,{})]}),Wn=(0,l.cn)("ydb-lag-popover-content"),Jn=({text:e,type:t})=>(0,c.jsxs)("div",{className:Wn({type:t}),children:[(0,c.jsx)("div",{className:Wn("text"),children:e}),(0,c.jsx)("div",{children:"read"===t?(0,c.jsx)(Vn,{}):(0,c.jsx)(Hn,{})})]}),Kn=JSON.parse('{"noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers","lagsPopover.readLags":"Read lags statistics, maximum among all consumer partitions (time format dd hh:mm:ss)","table.emptyDataMessage":"No consumers match the current search","controls.search":"Consumer"}'),Yn=JSON.parse('{"noConsumersMessage.topic":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0442\u043e\u043f\u0438\u043a\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","noConsumersMessage.stream":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0440\u0438\u043c\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","lagsPopover.readLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0447\u0442\u0435\u043d\u0438\u044f, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","table.emptyDataMessage":"\u041f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0438\u0441\u043a\u0443 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","controls.search":"Consumer"}'),Zn=(0,ge.g4)("ydb-diagnostics-consumers",{ru:Yn,en:Kn}),Xn="consumer",es="readSpeed",ts="readLags",as={[Xn]:"Consumer",[es]:"Read speed",[ts]:"Read lags, duration"},ns="writeLag",ss="readLag",rs="readIdleTime",is={[ns]:"write lag",[ss]:"read lag",[rs]:"read idle time"},os=(0,l.cn)("ydb-diagnostics-consumers-columns-header"),ls=()=>(0,c.jsx)(On,{className:os("lags"),text:as[ts],popoverContent:(0,c.jsx)(Jn,{text:Zn("lagsPopover.readLags"),type:"read"})}),cs=(0,l.cn)("ydb-diagnostics-consumers-columns"),ds=[{name:Xn,header:as[Xn],align:Ht.Ay.LEFT,render:({row:e})=>e.name?(0,c.jsx)(us,{name:e.name}):Dn.EMPTY_DATA_PLACEHOLDER},{name:es,header:as[es],align:Ht.Ay.RIGHT,resizeMinWidth:140,sortAccessor:e=>e.readSpeed.perMinute,render:({row:e})=>(0,c.jsx)(_n,{data:e.readSpeed})},{name:ts,header:(0,c.jsx)(ls,{}),className:cs("lags-header"),sub:[{name:ns,header:is[ns],align:Ht.Ay.RIGHT,render:({row:e})=>(0,U.lr)(e.writeLag)},{name:ss,header:is[ss],align:Ht.Ay.RIGHT,render:({row:e})=>(0,U.lr)(e.readLag)},{name:rs,header:is[rs],align:Ht.Ay.RIGHT,render:({row:e})=>(0,U.lr)(e.readIdleTime)}]}];function us({name:e}){const t=In().parse(location.search,{ignoreQueryPrefix:!0});return(0,c.jsx)(An.E,{to:(0,B.YL)({...t,[Rn.vh.diagnosticsTab]:E.iJ.partitions,selectedConsumer:e}),children:e})}const ps=(0,l.cn)("ydb-diagnostics-consumers"),hs=({path:e,database:t,type:a,databaseFullPath:s})=>{const r=(e=>e===it.EPathTypeCdcStream)(a),[i,o]=n.useState(""),[l]=(0,j.Nt)(),{currentData:d,isFetching:u,error:p}=mn.useGetTopicQuery({path:e,database:t,databaseFullPath:s},{pollingInterval:l}),h=u&&void 0===d,m=(0,j.N4)((a=>fn(a,e,t,s))),g=(0,j.N4)((a=>bn(a,e,t,s))),v=n.useMemo((()=>{if(!m)return[];const e=new RegExp(pn()(i),"i");return m.filter((t=>e.test(String(t.name))))}),[m,i]);return h?(0,c.jsx)(L.a,{size:"m"}):p||m&&m.length?(0,c.jsxs)("div",{className:ps(),children:[(0,c.jsxs)("div",{className:ps("controls"),children:[(0,c.jsx)(me.v,{onChange:e=>{o(e)},placeholder:Zn("controls.search"),className:ps("search"),value:i}),g&&(0,c.jsx)(Cn,{data:g})]}),p?(0,c.jsx)(F.o,{error:p}):null,m?(0,c.jsx)("div",{className:ps("table-wrapper"),children:(0,c.jsx)("div",{className:ps("table-content"),children:(0,c.jsx)(ue.l,{columnsWidthLSKey:"consumersColumnsWidth",wrapperClassName:ps("table"),data:v,columns:ds,settings:f.N3,emptyDataMessage:Zn("table.emptyDataMessage")})})}):null]}):(0,c.jsx)("div",{children:Zn("noConsumersMessage."+(r?"stream":"topic"))})};var ms=a(77577),gs=a(9068);const vs=(0,l.cn)("ydb-describe"),ys=({path:e,database:t,databaseFullPath:a})=>{const[n]=(0,j.Nt)(),{currentData:s,isFetching:r,error:i}=v.useGetOverviewQuery({path:e,database:t,databaseFullPath:a},{pollingInterval:n}),o=r&&void 0===s,l=(0,gs.qI)(s);return o?(0,c.jsx)(L.a,{size:"m"}):s||i?(0,c.jsxs)("div",{className:vs(),children:[i?(0,c.jsx)(F.o,{error:i}):null,s?(0,c.jsx)("div",{className:vs("result"),children:(0,c.jsx)(ms.p,{value:l,withClipboardButton:{withLabel:!1,copyText:JSON.stringify(s)},search:!0,collapsedInitially:!0})}):null]}):(0,c.jsx)("div",{className:vs("message-container"),children:"Empty"})};var xs=a(60073);const bs=e=>{const{PathType:t,PathSubType:a}=(null===e||void 0===e?void 0:e.Self)||{};var n,s;return t===it.EPathTypeTableIndex?(s=null===e||void 0===e||null===(n=e.TableIndex)||void 0===n?void 0:n.Type)&&Et[s]:((e,t)=>t&&St[t]||e&&wt[e])(t,a)},fs=e=>{var t;return null===e||void 0===e||null===(t=e.UserAttributes)||void 0===t?void 0:t.some((({Key:e,Value:t})=>"__async_replica"===e&&"true"===t))},js=JSON.parse('{"title_index-settings":"Index Settings","field_clusters":"Clusters","field_levels":"Levels","field_vector_dimension":"Vector Dimension","field_vector_type":"Vector Type","field_metric":"Metric","field_columns":"Columns","field_includes":"Includes","field_data-size":"Data Size","field_layout":"Layout","field_tokenizer":"Tokenizer","field_language":"Language","field_use_filter_lowercase":"Filter Lowercase","field_use_filter_stopwords":"Filter Stopwords","field_use_filter_ngram":"Filter Ngram","field_use_filter_edge_ngram":"Filter Edge Ngram","field_filter_ngram_min_length":"Filter Ngram Min Length","field_filter_ngram_max_length":"Filter Ngram Max Length","field_use_filter_length":"Filter Length","field_filter_length_min":"Filter Length Min","field_filter_length_max":"Filter Length Max","filter_enabled":"Enabled","filter_disabled":"Disabled","alert_no-entity-data":"No {{entity}} data"}'),Ts=(0,ge.g4)("info-viewer-schema-index-info",{en:js});var Ss=a(5741),ws=a(82176);const Es=(0,ws.H)({values:{PathType:e=>null===e||void 0===e?void 0:e.substring(9),CreateStep:e=>(0,U.r6)(e,{defaultValue:f.Pd})},labels:{PathType:(0,Ss.A)("common.type"),CreateStep:(0,Ss.A)("common.created")}}),_s=({value:e,withSpeedLabel:t,...a})=>{const n=(0,hn.z3)({value:e,withSpeedLabel:t,...a}),s=(0,hn.z3)({value:e,withSpeedLabel:t,size:"b"});return(0,c.jsx)("span",{title:s,children:n})},Ns=(e,t)=>e?(0,c.jsx)(_s,{value:e,...t}):null,Cs=(0,ws.H)({values:{Type:e=>null===e||void 0===e?void 0:e.substring(10),State:e=>null===e||void 0===e?void 0:e.substring(11),KeyColumnNames:e=>null===e||void 0===e?void 0:e.join(", "),DataColumnNames:e=>null===e||void 0===e?void 0:e.join(", "),DataSize:Ns},labels:{KeyColumnNames:Ts("field_columns"),DataColumnNames:Ts("field_includes"),DataSize:Ts("field_data-size")}}),Ps={[ct.METERING_MODE_REQUEST_UNITS]:"request-units",[ct.METERING_MODE_RESERVED_CAPACITY]:"reserved-capacity"},Is=(0,ws.H)({values:{Partitions:e=>(0,U.ZV)((null===e||void 0===e?void 0:e.length)||0),PQTabletConfig:e=>{const t=Math.round(e.PartitionConfig.LifetimeSeconds/f.Jg*100)/100;return`${(0,U.ZV)(t)} hours`}},labels:{Partitions:"Partitions count",PQTabletConfig:"Retention"}}),As=(0,ws.H)({values:{Codecs:e=>e&&Object.values(e.Codecs||{}).join(", "),MeteringMode:e=>e&&Ps[e]},labels:{MeteringMode:"Metering mode"}}),Ds=(0,ws.H)({values:{StorageLimitBytes:U.z3,WriteSpeedInBytesPerSecond:U.tC},labels:{StorageLimitBytes:"Retention storage",WriteSpeedInBytesPerSecond:"Partitions write speed"}}),Rs=(0,ws.H)({values:{Mode:e=>null===e||void 0===e?void 0:e.substring(14),Format:e=>null===e||void 0===e?void 0:e.substring(16)}}),ks=(0,ws.H)({values:{CPU:U.iM,Memory:Ns,Storage:Ns,Network:U.tC,ReadThroughput:U.tC,WriteThroughput:U.tC},defaultValueFormatter:U.ZV}),Os=(0,ws.H)({values:{FollowerCount:U.ZV},labels:{FollowerCountPerDataCenter:"FollowerCountPerDC"},defaultValueFormatter:e=>e&&String(e)}),Ms=(0,ws.H)({values:{FollowerCount:U.ZV,CrossDataCenterFollowerCount:U.ZV}}),Fs=(0,ws.H)({values:{DataSize:Ns,IndexSize:Ns,LastAccessTime:U.r6,LastUpdateTime:U.r6},defaultValueFormatter:U.ZV}),Ls=["Type","State","DataSize","KeyColumnNames","DataColumnNames"];function qs(e){const t=[];return e?(new Set(Ls).forEach((a=>{const n=e[a];void 0!==n&&t.push(Cs(a,n))})),t):t}const zs=(0,l.cn)("ydb-diagnostics-table-info"),Us=({data:e})=>{var t;const a=bs(null===e||void 0===e?void 0:e.PathDescription);if(!e)return(0,c.jsx)("div",{className:"error",children:Ts("alert_no-entity-data",{entity:a})});const n=null===(t=e.PathDescription)||void 0===t?void 0:t.TableIndex,s=qs(n);let r=[];var i,o;(null===n||void 0===n?void 0:n.Type)===dt.EIndexTypeGlobalVectorKmeansTree&&(r=function(e){const t=[];if(!e)return t;const a=(0,ws.H)({values:{clusters:e=>"number"===typeof e?(0,U.ZV)(e):e,levels:e=>"number"===typeof e?(0,U.ZV)(e):e},labels:{clusters:Ts("field_clusters"),levels:Ts("field_levels")}}),{clusters:n,levels:s,settings:r}=e;void 0!==n&&t.push(a("clusters",n)),void 0!==s&&t.push(a("levels",s));const i=(0,ws.H)({values:{vector_dimension:e=>"number"===typeof e?(0,U.ZV)(e):e,vector_type:e=>"string"===typeof e?e.replace(/^VECTOR_TYPE_/,""):e},labels:{vector_dimension:Ts("field_vector_dimension"),vector_type:Ts("field_vector_type"),metric:Ts("field_metric")}}),{metric:o,vector_type:l,vector_dimension:c}=null!==r&&void 0!==r?r:{};return void 0!==o&&t.push(i("metric",o)),void 0!==l&&t.push(i("vector_type",l)),void 0!==c&&t.push(i("vector_dimension",c)),t}(null===n||void 0===n||null===(i=n.VectorIndexKmeansTreeDescription)||void 0===i?void 0:i.Settings));(null===n||void 0===n?void 0:n.Type)===dt.EIndexTypeGlobalFulltext&&(r=function(e){var t,a;const n=[];if(!e)return n;const s=(0,ws.H)({values:{layout:e=>e},labels:{layout:Ts("field_layout")}}),{layout:r}=e;void 0!==r&&n.push(s("layout",r));const i=(0,ws.H)({values:{tokenizer:e=>e,language:e=>e,use_filter_lowercase:e=>Ts(!0===e?"filter_enabled":"filter_disabled"),use_filter_stopwords:e=>Ts(!0===e?"filter_enabled":"filter_disabled"),use_filter_ngram:e=>Ts(!0===e?"filter_enabled":"filter_disabled"),use_filter_edge_ngram:e=>Ts(!0===e?"filter_enabled":"filter_disabled"),filter_ngram_min_length:e=>"number"===typeof e?(0,U.ZV)(e):e,filter_ngram_max_length:e=>"number"===typeof e?(0,U.ZV)(e):e,use_filter_length:e=>Ts(!0===e?"filter_enabled":"filter_disabled"),filter_length_min:e=>"number"===typeof e?(0,U.ZV)(e):e,filter_length_max:e=>"number"===typeof e?(0,U.ZV)(e):e},labels:{tokenizer:Ts("field_tokenizer"),language:Ts("field_language"),use_filter_lowercase:Ts("field_use_filter_lowercase"),use_filter_stopwords:Ts("field_use_filter_stopwords"),use_filter_ngram:Ts("field_use_filter_ngram"),use_filter_edge_ngram:Ts("field_use_filter_edge_ngram"),filter_ngram_min_length:Ts("field_filter_ngram_min_length"),filter_ngram_max_length:Ts("field_filter_ngram_max_length"),use_filter_length:Ts("field_use_filter_length"),filter_length_min:Ts("field_filter_length_min"),filter_length_max:Ts("field_filter_length_max")}}),o=null===(t=e.columns)||void 0===t||null===(a=t.filter((e=>void 0!==e.analyzers))[0])||void 0===a?void 0:a.analyzers,{tokenizer:l,language:c,use_filter_lowercase:d,use_filter_stopwords:u,use_filter_ngram:p,use_filter_edge_ngram:h,filter_ngram_min_length:m,filter_ngram_max_length:g,use_filter_length:v,filter_length_min:y,filter_length_max:x}=null!==o&&void 0!==o?o:{};return void 0!==l&&n.push(i("tokenizer",l)),void 0!==c&&n.push(i("language",c)),void 0!==d&&n.push(i("use_filter_lowercase",d)),void 0!==u&&n.push(i("use_filter_stopwords",u)),void 0!==p&&n.push(i("use_filter_ngram",p)),void 0!==h&&n.push(i("use_filter_edge_ngram",h)),void 0!==m&&n.push(i("filter_ngram_min_length",m)),void 0!==g&&n.push(i("filter_ngram_max_length",g)),void 0!==v&&n.push(i("use_filter_length",v)),void 0!==y&&n.push(i("filter_length_min",y)),void 0!==x&&n.push(i("filter_length_max",x)),n}(null===n||void 0===n||null===(o=n.FulltextIndexDescription)||void 0===o?void 0:o.Settings));return(0,c.jsxs)("div",{className:zs(),children:[(0,c.jsx)(xs.z_,{info:s,title:a,className:zs("info-block"),renderEmptyState:()=>(0,c.jsx)("div",{className:zs("title"),children:a})}),r&&r.length?(0,c.jsx)(xs.z_,{info:r,title:Ts("title_index-settings"),className:zs("info-block")}):null]})};var Qs=a(90101);const Gs=JSON.parse('{"no-data":"No data"}'),Bs=(0,ge.g4)("ydb-definition-list",{en:Gs}),$s=(0,l.cn)("ydb-definition-list");function Hs({title:e,items:t,nameMaxWidth:a=220,className:n,...s}){return(0,c.jsxs)("div",{className:$s(null),children:[e?(0,c.jsx)("div",{className:$s("title"),children:e}):null,t.length?(0,c.jsx)(Qs.u,{nameMaxWidth:a,className:$s("properties-list",n),...s,children:t.map((e=>(0,c.jsx)(Qs.u.Item,{children:e.content,...e},e.name)))}):Bs("no-data")]})}const Vs=JSON.parse('{"created":"Created","external-objects.source-type":"Source Type","external-objects.data-source":"Data Source","external-objects.location":"Location","external-objects.auth-method":"Auth Method","external-objects.auth-method.none":"None","external-objects.auth-method.service-account":"Service Account","external-objects.auth-method.aws":"AWS","external-objects.auth-method.token":"Token","external-objects.auth-method.basic":"Basic","external-objects.auth-method.mdb-basic":"MDB Basic","view.query-text":"Query Text","field_system-view-type":"System view type","no-entity-data":"No {{entityName}} data"}'),Ws=(0,ge.g4)("ydb-tenant-objects-info",{en:Vs});function Js(e){return{name:Ws("created"),content:(0,U.r6)(e,{defaultValue:f.Pd})}}function Ks(e){return(0,c.jsx)(Re.E,{variant:"body-2",color:"danger",children:Ws("no-entity-data",{entityName:null!==e&&void 0!==e?e:""})})}function Ys(e){var t,a,n,s;const r=[{name:Ws("external-objects.source-type"),content:null===(t=e.PathDescription)||void 0===t||null===(a=t.ExternalDataSourceDescription)||void 0===a?void 0:a.SourceType}],i=null===(n=e.PathDescription)||void 0===n||null===(s=n.Self)||void 0===s?void 0:s.CreateStep;return Number(i)&&r.push(Js(i)),r}function Zs(e){var t;const{Auth:a}=(null===(t=e.PathDescription)||void 0===t?void 0:t.ExternalDataSourceDescription)||{};return null!==a&&void 0!==a&&a.ServiceAccount?Ws("external-objects.auth-method.service-account"):null!==a&&void 0!==a&&a.Aws?Ws("external-objects.auth-method.aws"):null!==a&&void 0!==a&&a.Token?Ws("external-objects.auth-method.token"):null!==a&&void 0!==a&&a.Basic?Ws("external-objects.auth-method.basic"):null!==a&&void 0!==a&&a.MdbBasic?Ws("external-objects.auth-method.mdb-basic"):Ws("external-objects.auth-method.none")}function Xs(e){var t;const{Location:a}=(null===(t=e.PathDescription)||void 0===t?void 0:t.ExternalDataSourceDescription)||{};return[...Ys(e),{name:Ws("external-objects.location"),content:a,copyText:a},{name:Ws("external-objects.auth-method"),content:Zs(e)}]}const er=({data:e,prepareData:t})=>{const a=bs(null===e||void 0===e?void 0:e.PathDescription);return e?(0,c.jsx)(Hs,{title:a,items:t(e)}):Ks(a)},tr=({data:e})=>(0,c.jsx)(er,{data:e,prepareData:Xs});var ar=a(10755),nr=a(25196);const sr=(e,t)=>{var a,n;const{CreateStep:s}=(null===(a=e.PathDescription)||void 0===a?void 0:a.Self)||{},{SourceType:r,DataSourcePath:i}=(null===(n=e.PathDescription)||void 0===n?void 0:n.ExternalTableDescription)||{},o=null===i||void 0===i?void 0:i.split("/").pop(),l=[{name:Ws("external-objects.source-type"),content:r}];return Number(s)&&l.push(Js(s)),l.push({name:Ws("external-objects.data-source"),content:i&&(0,c.jsx)("span",{title:i,children:(0,c.jsx)(nr.K,{title:o||"",url:t})})}),l},rr=(e,t)=>{var a,n;const s=null===(a=e.PathDescription)||void 0===a||null===(n=a.ExternalTableDescription)||void 0===n?void 0:n.Location;return[...sr(e,t),{name:Ws("external-objects.location"),content:s,copyText:s}]},ir=({data:e,prepareData:t})=>{var a,n;const s=(0,ar.zy)(),r=(0,B.mA)(s),i=(0,B.Ow)({...r,schema:null===e||void 0===e||null===(a=e.PathDescription)||void 0===a||null===(n=a.ExternalTableDescription)||void 0===n?void 0:n.DataSourcePath}),o=bs(null===e||void 0===e?void 0:e.PathDescription);return e?(0,c.jsx)(Hs,{title:o,items:t(e,i)}):Ks(o)},or=({data:e})=>(0,c.jsx)(ir,{data:e,prepareData:rr});function lr(e){if(e)return e.startsWith("E")?e.slice(1):e}function cr({data:e}){const t=bs(null===e||void 0===e?void 0:e.PathDescription);if(!e)return Ks(t);const a=(e=>{var t,a;const n=null===(t=e.PathDescription)||void 0===t||null===(a=t.SysViewDescription)||void 0===a?void 0:a.Type;return[{name:Ws("field_system-view-type"),content:lr(n)}]})(e);return(0,c.jsx)(Hs,{title:t,items:a})}var dr=a(31893);function ur({data:e}){const t=bs(null===e||void 0===e?void 0:e.PathDescription);if(!e)return Ks(t);const a=(e=>{var t,a;const n=null===(t=e.PathDescription)||void 0===t||null===(a=t.ViewDescription)||void 0===a?void 0:a.QueryText;return[{name:Ws("view.query-text"),copyText:n,content:n?(0,c.jsx)(dr.YDBSyntaxHighlighter,{language:"yql",text:n}):null}]})(e);return(0,c.jsx)(Hs,{title:t,items:a})}function pr({state:e}){return e?"StandBy"in e?(0,c.jsx)(zt.J,{theme:"info",children:"Standby"}):"Paused"in e?(0,c.jsx)(zt.J,{theme:"info",children:"Paused"}):"Done"in e?(0,c.jsx)(zt.J,{theme:"success",children:"Done"}):"Error"in e?(0,c.jsx)(zt.J,{theme:"danger",children:"Error"}):(0,c.jsx)(zt.J,{size:"s",children:"Unknown"}):null}const hr=JSON.parse('{"column.dstPath.name":"Dist","column.srcPath.name":"Source","everythingWithPrefix":"Everything with prefix:","noData":"No data.","title":"Replicated Paths"}'),mr=(0,ge.g4)("ydb-diagnostics-async-replication-paths",{en:hr}),gr=(0,l.cn)("ydb-async-replication-paths"),vr=[{name:mr("column.srcPath.name"),render:({row:e})=>e.SrcPath,sortAccessor:e=>e.SrcPath},{name:mr("column.dstPath.name"),render:({row:e})=>e.DstPath,sortAccessor:e=>e.DstPath}];function yr({config:e}){if(!e)return null;let t=mr("noData");var a,n;e.Everything&&(t=(0,c.jsxs)("span",{children:[mr("everythingWithPrefix")," ",(0,c.jsx)(Re.E,{variant:"code-inline-2",children:null!==(a=null===(n=e.Everything)||void 0===n?void 0:n.DstPrefix)&&void 0!==a?a:"undefined"}),"."]}));return e.Specific&&(t=(0,c.jsx)(ue.l,{data:e.Specific.Targets,settings:f.jp,columns:vr})),(0,c.jsxs)("div",{className:gr(),children:[(0,c.jsx)("div",{className:gr("title"),children:mr("title")}),t]})}function xr({connection:e}){return e?e.StaticCredentials?(0,c.jsx)(zt.J,{value:e.StaticCredentials.User,theme:"normal",children:"user"}):"OAuthToken"in e?"OAuth":"unknown":null}const br=JSON.parse('{"credentials.label":"Credentials","noData":"No data for entity:","srcConnection.database.label":"Source Database Path","srcConnection.endpoint.label":"Source Cluster Endpoint","state.label":"State"}'),fr=(0,ge.g4)("ydb-diagnostics-async-replication-info",{en:br});function jr({data:e}){var t,a;const n=bs(null===e||void 0===e?void 0:e.PathDescription);if(!e)return(0,c.jsxs)("div",{className:"error",children:[fr("noData")," ",n]});const s=function(e){var t,a;const n=(null===(t=e.PathDescription)||void 0===t?void 0:t.ReplicationDescription)||{},s=n.State,r=(null===(a=n.Config)||void 0===a?void 0:a.SrcConnectionParams)||{},{Endpoint:i,Database:o}=r,l=[];s&&l.push({name:fr("state.label"),content:(0,c.jsx)(pr,{state:s})});i&&l.push({name:fr("srcConnection.endpoint.label"),copyText:i,content:(0,c.jsx)(Re.E,{variant:"code-inline-2",children:i})});o&&l.push({name:fr("srcConnection.database.label"),copyText:o,content:(0,c.jsx)(Re.E,{variant:"code-inline-2",children:o})});r&&l.push({name:fr("credentials.label"),content:(0,c.jsx)(xr,{connection:r})});return l}(e);return(0,c.jsxs)(ke.s,{direction:"column",gap:"4",children:[(0,c.jsx)(Hs,{title:n,items:s}),(0,c.jsx)(yr,{config:null===(t=e.PathDescription)||void 0===t||null===(a=t.ReplicationDescription)||void 0===a?void 0:a.Config})]})}const Tr=JSON.parse('{"writeLagPopover":"Write lag, maximum among all topic partitions","writeIdleTimePopover":"Write idle time, maximum among all topic partitions"}'),Sr=JSON.parse('{"writeLagPopover":"\u041b\u0430\u0433 \u0437\u0430\u043f\u0438\u0441\u0438, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0442\u043e\u043f\u0438\u043a\u0430","writeIdleTimePopover":"\u0412\u0440\u0435\u043c\u044f \u0431\u0435\u0437 \u0437\u0430\u043f\u0438\u0441\u0438, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0442\u043e\u043f\u0438\u043a\u0430"}'),wr=(0,ge.g4)("ydb-diagnostics-overview-topic-stats",{ru:Sr,en:Tr}),Er=(0,l.cn)("ydb-overview-topic-stats"),_r=e=>[{label:"Store size",value:(0,U.z3)(e.storeSize)},{label:(0,c.jsx)(On,{text:"Write idle time",popoverContent:(0,c.jsx)(Jn,{text:wr("writeIdleTimePopover"),type:"write"})}),value:(0,He.Bi)(e.partitionsIdleTime)},{label:(0,c.jsx)(On,{text:"Write lag",popoverContent:(0,c.jsx)(Jn,{text:wr("writeLagPopover"),type:"write"})}),value:(0,He.Bi)(e.partitionsWriteLag)},{label:"Average write speed",value:(0,c.jsx)(_n,{data:e.writeSpeed,withValue:!1})}],Nr=e=>{const t=e.writeSpeed;return[{label:"per minute",value:(0,U.tC)(t.perMinute)},{label:"per hour",value:(0,U.tC)(t.perHour)},{label:"per day",value:(0,U.tC)(t.perDay)}]},Cr=({path:e,database:t,databaseFullPath:a})=>{const[s]=(0,j.Nt)(),{currentData:r,isFetching:i,error:o}=mn.useGetTopicQuery({path:e,database:t,databaseFullPath:a},{pollingInterval:s}),l=i&&void 0===r,d=(0,j.N4)((n=>bn(n,e,t,a)));if(l)return(0,c.jsx)("div",{className:Er(),children:(0,c.jsx)(L.a,{size:"s"})});const u=o||!d?(0,c.jsx)(F.o,{error:o}):null;return(0,c.jsxs)("div",{className:Er(),children:[(0,c.jsx)("div",{className:Er("title"),children:"Stats"}),u,d?(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)("div",{className:Er("info"),children:(0,c.jsx)(xs.z_,{info:_r(d),multilineLabels:!0})}),(0,c.jsx)("div",{className:Er("bytes-written"),children:(0,c.jsx)(xs.z_,{info:Nr(d)})})]}):null]})},Pr=e=>{var t,a,n;if(!e)return[];const s=null===e||void 0===e||null===(t=e.PathDescription)||void 0===t?void 0:t.CdcStreamDescription,{Mode:r,Format:i}=s||{},o=(0,xs.jl)(Rs,{Mode:r,Format:i}),l=null===e||void 0===e||null===(a=e.PathDescription)||void 0===a||null===(n=a.Self)||void 0===n?void 0:n.CreateStep;return Number(l)&&o.unshift(Es("CreateStep",l)),o},Ir=({path:e,database:t,data:a,databaseFullPath:n})=>{const s=bs(null===a||void 0===a?void 0:a.PathDescription);return a?(0,c.jsxs)("div",{children:[(0,c.jsx)(xs.z_,{title:s,info:Pr(a)}),(0,c.jsx)(Cr,{path:e,databaseFullPath:n,database:t})]}):(0,c.jsxs)("div",{className:"error",children:["No ",s," data"]})};function Ar(e){const t=e.replace(/'/g,"''");return`${f.Zi}\nSELECT\n    Status AS State,\n    Issues AS Error,\n    Text\nFROM \`.sys/streaming_queries\`\nWHERE Path = '${t}'\nLIMIT 1`}const Dr=g.F.injectEndpoints({endpoints:e=>({getStreamingQueryInfo:e.query({queryFn:async({database:e,path:t},{signal:a})=>{try{const n=await window.api.viewer.sendQuery({query:Ar(t),database:e,action:"execute-scan",internal_call:!0},{signal:a,withRetries:!0});if((0,ht.We)(n))return{error:n};return{data:(0,ht.fW)(n)}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var Rr=a(68774);const kr=JSON.parse('{"alert_no-data":"No data for entity:","field_query-state":"State","field_query-error":"Error","field_query-text":"Text"}'),Or=(0,ge.g4)("ydb-diagnostics-streaming-query-info",{en:kr});function Mr({data:e,database:t,path:a}){const n=bs(null===e||void 0===e?void 0:e.PathDescription);if(!e)return(0,c.jsxs)("div",{className:"error",children:[Or("alert_no-data")," ",n]});const{data:s}=Dr.useGetStreamingQueryInfoQuery({database:t,path:a},{skip:!t||!a}),r=function(e){var t,a,n,s,r,i,o,l,d,u,p,h;if(!e)return[];const m=[],g=(0,U.vN)(null===(t=e.resultSets)||void 0===t||null===(a=t[0])||void 0===a||null===(n=a.result)||void 0===n||null===(s=n[0])||void 0===s?void 0:s.State),v=(0,U.vN)(null===(r=e.resultSets)||void 0===r||null===(i=r[0])||void 0===i||null===(o=i.result)||void 0===o||null===(l=o[0])||void 0===l?void 0:l.Text);let y=(0,U.qe)(v);y=(0,U.YY)(y);const x=null===(d=e.resultSets)||void 0===d||null===(u=d[0])||void 0===u||null===(p=u.result)||void 0===p||null===(h=p[0])||void 0===h?void 0:h.Error,b=function(e){if("string"===typeof e)try{const t=JSON.parse(e);return(0,ht.CR)(t)?t:void 0}catch{return e}if((0,ht.CR)(e))return e;return}(x);m.push({name:Or("field_query-state"),content:(0,c.jsx)(Lr,{state:g})}),b&&m.push({name:Or("field_query-error"),content:(0,c.jsx)(Rr.vt,{data:b})});return m.push({name:Or("field_query-text"),copyText:y,content:y?(0,c.jsx)(dr.YDBSyntaxHighlighter,{language:"yql",text:y}):null}),m}(s);return(0,c.jsx)(Hs,{title:n,items:r})}const Fr={CREATING:"info",CREATED:"normal",STARTING:"info",RUNNING:"success",STOPPING:"info",STOPPED:"normal",COMPLETED:"success",SUSPENDED:"warning",FAILED:"danger"};function Lr({state:e}){var t;if(!e)return null;const a=null!==(t=Fr[e])&&void 0!==t?t:"normal";return(0,c.jsx)(zt.J,{theme:a,children:e})}function qr({data:e}){const t=bs(e);return fs(e)?(0,c.jsxs)(ke.s,{gap:1,wrap:"nowrap",children:[t," ",(0,c.jsx)(zt.J,{children:yt("label.read-only")})]}):t}const zr=JSON.parse('{"tableStats":"Table Stats","tabletMetrics":"Tablet Metrics","partitionConfig":"Partition Config","label.ttl":"TTL for rows","value.ttl":"column: \'{{columnName}}\', expire after: {{expireTime}}","label.standalone":"Standalone","label.partitioning":"Partitioning","label.partitioning-by-size":"Partitioning by size","value.partitioning-by-size.enabled":"Enabled, split size: {{size}}","label.partitioning-by-load":"Partitioning by load","label.partitions-min":"Min number of partitions","label.partitions-max":"Max number of partitions","label.read-replicas":"Read replicas (followers)","label.bloom-filter":"Bloom filter","enabled":"Enabled","disabled":"Disabled"}'),Ur=(0,ge.g4)("ydb-diagnostics-overview-table-info",{en:zr});var Qr=a(62091),Gr=a.n(Qr),Br=a(7435),$r=a(41650);const Hr=e=>{if(e.Enabled&&e.Enabled.ColumnName&&void 0!==e.Enabled.ExpireAfterSeconds){const t=Ur("value.ttl",{columnName:e.Enabled.ColumnName,expireTime:(0,He.Bi)(1e3*e.Enabled.ExpireAfterSeconds,1)});return{label:Ur("label.ttl"),value:t}}};const Vr=(e,t)=>{if(!e)return{};const{PathDescription:a={}}=e,{TableStats:n={},TabletMetrics:s={},Table:{PartitionConfig:r={},TTLSettings:i}={},ColumnTableDescription:o={}}=a,{PartCount:l,RowCount:d,DataSize:u,IndexSize:p,ByKeyFilterSize:h,LastAccessTime:m,LastUpdateTime:g,ImmediateTxCompleted:v,PlannedTxCompleted:y,TxRejectedByOverload:x,TxRejectedBySpace:b,TxCompleteLagMsec:f,InFlightTxCount:j,RowUpdates:T,RowDeletes:S,RowReads:w,RangeReads:E,RangeReadRows:_}=n,{FollowerGroups:N,FollowerCount:C,CrossDataCenterFollowerCount:P}=r;let I=[];switch(t){case it.EPathTypeTable:I=((e,t)=>{var a;const{PartitioningPolicy:n={},FollowerGroups:s,EnableFilterByKey:r}=e,i=[],o=n.SizeToSplit&&Number(n.SizeToSplit)>0?Ur("value.partitioning-by-size.enabled",{size:(0,U.z3)(n.SizeToSplit)}):Ur("disabled"),l=null!==(a=n.SplitByLoadSettings)&&void 0!==a&&a.Enabled?Ur("enabled"):Ur("disabled");if(i.push({label:Ur("label.partitioning-by-size"),value:o},{label:Ur("label.partitioning-by-load"),value:l},{label:Ur("label.partitions-min"),value:(0,U.ZV)(n.MinPartitionsCount||0)}),n.MaxPartitionsCount&&i.push({label:Ur("label.partitions-max"),value:(0,U.ZV)(n.MaxPartitionsCount)}),s&&s.length){const{RequireAllDataCenters:e,FollowerCountPerDataCenter:t,FollowerCount:a}=s[0];let n;n=e&&t?`PER_AZ: ${a}`:`ANY_AZ: ${a}`,i.push({label:Ur("label.read-replicas"),value:n})}if(t){const e=Hr(t);e&&i.push(e)}return(0,Br.f8)(r)&&i.push({label:Ur("label.bloom-filter"),value:Ur(r?"enabled":"disabled")}),i})(r,i);break;case it.EPathTypeColumnTable:I=function(e){var t,a;const n=[];var s;if(n.push({label:Ur("label.standalone"),value:String((s=e,!(s.SchemaPresetName&&void 0!==s.SchemaPresetId)))}),null!==(t=e.Sharding)&&void 0!==t&&null!==(a=t.HashSharding)&&void 0!==a&&a.Columns){const t=`PARTITION BY HASH(${e.Sharding.HashSharding.Columns.join(", ")})`;n.push({label:Ur("label.partitioning"),value:(0,c.jsx)(Re.E,{variant:"code-2",wordBreak:"break-word",children:t})})}if(e.TtlSettings){const t=Hr(null===e||void 0===e?void 0:e.TtlSettings);t&&n.push(t)}return n}(o)}const A=(0,xs.jl)(Fs,{PartCount:l,RowCount:d,DataSize:u,IndexSize:p});(0,$r.kf)(h)&&(r.EnableFilterByKey||Number(h)>0)&&A.push({label:"BloomFilterSize",value:Ns(h)});const D=[A,(0,xs.jl)(Fs,{LastAccessTime:m,LastUpdateTime:g}),(0,xs.jl)(Fs,{ImmediateTxCompleted:v,PlannedTxCompleted:y,TxRejectedByOverload:x,TxRejectedBySpace:b,TxCompleteLagMsec:f,InFlightTxCount:j}),(0,xs.jl)(Fs,{RowUpdates:T,RowDeletes:S,RowReads:w,RangeReads:E,RangeReadRows:_})],R=(0,xs.jl)(ks,Gr()(s,["GroupReadIops","GroupReadThroughput","GroupWriteIops","GroupWriteThroughput"]));let k=[];return Array.isArray(N)&&N.length>0?k=(0,xs.jl)(Os,N[0]):void 0!==C?k.push(Ms("FollowerCount",C)):void 0!==P&&k.push(Ms("CrossDataCenterFollowerCount",P)),{generalInfo:I,tableStatsInfo:D,tabletMetricsInfo:R,partitionConfigInfo:k}},Wr=(0,l.cn)("ydb-diagnostics-table-info"),Jr=({data:e,type:t})=>{const a=(0,c.jsx)(qr,{data:null===e||void 0===e?void 0:e.PathDescription}),{generalInfo:s,tableStatsInfo:r,tabletMetricsInfo:i=[],partitionConfigInfo:o=[]}=n.useMemo((()=>Vr(e,t)),[e,t]);return(0,c.jsxs)("div",{className:Wr(),children:[(0,c.jsx)(xs.z_,{info:s,title:a,className:Wr("info-block"),renderEmptyState:()=>(0,c.jsx)("div",{className:Wr("title"),children:a})}),(0,c.jsxs)("div",{className:Wr("row"),children:[r?(0,c.jsx)("div",{className:Wr("col"),children:r.map(((e,t)=>(0,c.jsx)(xs.z_,{info:e,title:0===t?Ur("tableStats"):void 0,className:Wr("info-block"),renderEmptyState:()=>null},t)))}):null,i.length>0||o.length>0?(0,c.jsxs)("div",{className:Wr("col"),children:[(0,c.jsx)(xs.z_,{info:i,title:Ur("tabletMetrics"),className:Wr("info-block"),renderEmptyState:()=>null}),(0,c.jsx)(xs.z_,{info:o,title:Ur("partitionConfig"),className:Wr("info-block"),renderEmptyState:()=>null})]}):null]})]})},Kr=e=>{var t;const a=null===e||void 0===e||null===(t=e.PathDescription)||void 0===t?void 0:t.PersQueueGroup;if(!a)return[];const{Partitions:n=[],PQTabletConfig:s={PartitionConfig:{LifetimeSeconds:0}}}=a,{Codecs:r,MeteringMode:i}=s,{WriteSpeedInBytesPerSecond:o,StorageLimitBytes:l}=s.PartitionConfig;return[...(0,xs.jl)(Is,{Partitions:n,PQTabletConfig:s}),...(0,xs.jl)(Ds,{StorageLimitBytes:l,WriteSpeedInBytesPerSecond:o}),...(0,xs.jl)(As,{Codecs:r,MeteringMode:i})]},Yr=({data:e,path:t,database:a,databaseFullPath:n})=>{const s=bs(null===e||void 0===e?void 0:e.PathDescription);if(!e)return(0,c.jsxs)("div",{className:"error",children:["No ",s," data"]});return(0,c.jsxs)("div",{children:[(0,c.jsx)(xs.z_,{title:s,info:Kr(e)}),(()=>{var s,r;return(null===(s=e.PathDescription)||void 0===s||null===(r=s.Self)||void 0===r?void 0:r.PathSubType)===ot.EPathSubTypeStreamImpl?null:(0,c.jsx)(Cr,{path:t,database:a,databaseFullPath:n})})()]})},Zr=g.F.injectEndpoints({endpoints:e=>({getReplication:e.query({queryFn:async({path:e,database:t,databaseFullPath:a})=>{try{const n=await window.api.viewer.getReplication({path:{path:e,databaseFullPath:a},database:t});return"object"!==typeof n?{error:{}}:{data:n}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});function Xr({connection:e}){return e?e.StaticCredentials?(0,c.jsx)(zt.J,{value:e.StaticCredentials.User,theme:"normal",children:"user"}):"OAuthToken"in e?void 0!==e.OAuthToken&&("Token"in e.OAuthToken||"TokenSecretName"in e.OAuthToken)?"OAuth":"":"unknown":null}const ei=JSON.parse('{"credentials.label":"Credentials","noData":"No data for entity:","srcConnection.database.label":"Source Database Path","srcConnection.endpoint.label":"Source Cluster Endpoint","state.label":"State","state.error":"Error","srcPath.label":"Source Topic","dstPath.label":"Destination Table","transformLambda.label":"Transformation Lambda"}'),ti=(0,ge.g4)("ydb-diagnostics-transfer-info",{en:ei});function ai({path:e,database:t,data:a,databaseFullPath:n}){const s=bs(null===a||void 0===a?void 0:a.PathDescription);if(!a)return(0,c.jsxs)("div",{className:"error",children:[ti("noData")," ",s]});const{data:r}=Zr.useGetReplicationQuery({path:e,database:t,databaseFullPath:n},{}),i=function(e,t){var a,n,s,r,i,o;const l=(null===(a=e.PathDescription)||void 0===a?void 0:a.ReplicationDescription)||{},d=(null===(n=l.Config)||void 0===n?void 0:n.SrcConnectionParams)||{},{Endpoint:u,Database:p}=d,h=null===(s=l.Config)||void 0===s||null===(r=s.TransferSpecific)||void 0===r?void 0:r.Target,m=null===h||void 0===h?void 0:h.SrcPath,g=null===h||void 0===h?void 0:h.DstPath,v=null===h||void 0===h?void 0:h.TransformLambda,y=[];t&&y.push({name:ti("state.label"),content:ni(t)});null!==t&&void 0!==t&&null!==(i=t.error)&&void 0!==i&&i.issues&&null!==(o=t.error.issues[0])&&void 0!==o&&o.message&&y.push({name:ti("state.error"),copyText:t.error.issues[0].message,content:(0,c.jsx)(Re.E,{variant:"code-inline-2",color:"danger",children:t.error.issues[0].message})});u&&y.push({name:ti("srcConnection.endpoint.label"),copyText:u,content:(0,c.jsx)(Re.E,{variant:"code-inline-2",children:u})});p&&y.push({name:ti("srcConnection.database.label"),copyText:p,content:(0,c.jsx)(Re.E,{variant:"code-inline-2",children:p})});d&&y.push({name:ti("credentials.label"),content:(0,c.jsx)(Xr,{connection:d})});return y.push({name:ti("srcPath.label"),copyText:m,content:(0,c.jsx)(Re.E,{variant:"code-inline-2",children:m})}),y.push({name:ti("dstPath.label"),copyText:g,content:(0,c.jsx)(Re.E,{variant:"code-inline-2",children:g})}),y.push({name:ti("transformLambda.label"),copyText:v,content:v?(0,c.jsx)(dr.YDBSyntaxHighlighter,{language:"yql",text:v}):null}),y}(a,r);return(0,c.jsx)(ke.s,{direction:"column",gap:"4",children:(0,c.jsx)(Hs,{title:s,items:i})})}function ni(e){return e?"running"in e?(0,c.jsx)(zt.J,{theme:"info",children:"Running"}):"paused"in e?(0,c.jsx)(zt.J,{theme:"info",children:"Paused"}):"done"in e?(0,c.jsx)(zt.J,{theme:"success",children:"Done"}):"error"in e?(0,c.jsx)(zt.J,{theme:"danger",children:"Error"}):(0,c.jsx)(zt.J,{size:"s",children:"Unknown"}):null}const si=function({type:e,path:t,database:a,databaseFullPath:s}){const[r]=(0,j.Nt)(),{currentData:i,isFetching:o,error:l}=v.useGetOverviewQuery({path:t,database:a,databaseFullPath:s},{pollingInterval:r});return o&&void 0===i?(0,c.jsx)(L.a,{size:"m"}):(0,c.jsxs)(n.Fragment,{children:[l?(0,c.jsx)(F.o,{error:l}):null,l&&!i?null:(()=>{var n;const r=null!==i&&void 0!==i?i:void 0,o={[it.EPathTypeInvalid]:void 0,[it.EPathTypeDir]:void 0,[it.EPathTypeResourcePool]:void 0,[it.EPathTypeTable]:void 0,[it.EPathTypeSysView]:()=>(0,c.jsx)(cr,{data:r}),[it.EPathTypeSubDomain]:void 0,[it.EPathTypeTableIndex]:()=>(0,c.jsx)(Us,{data:r}),[it.EPathTypeExtSubDomain]:void 0,[it.EPathTypeColumnStore]:void 0,[it.EPathTypeColumnTable]:void 0,[it.EPathTypeCdcStream]:()=>(0,c.jsx)(Ir,{path:t,database:a,databaseFullPath:s,data:r}),[it.EPathTypePersQueueGroup]:()=>(0,c.jsx)(Yr,{data:r,path:t,databaseFullPath:s,database:a}),[it.EPathTypeExternalTable]:()=>(0,c.jsx)(or,{data:r}),[it.EPathTypeExternalDataSource]:()=>(0,c.jsx)(tr,{data:r}),[it.EPathTypeView]:()=>(0,c.jsx)(ur,{data:r}),[it.EPathTypeReplication]:()=>(0,c.jsx)(jr,{data:r}),[it.EPathTypeTransfer]:()=>(0,c.jsx)(ai,{path:t,databaseFullPath:s,database:a,data:r}),[it.EPathTypeStreamingQuery]:()=>(0,c.jsx)(Mr,{data:r,path:t,database:a})};return e&&(null===(n=o[e])||void 0===n?void 0:n.call(o))||(0,c.jsx)(Jr,{data:r,type:e})})()]})};var ri=a(43726),ii=a(10508),oi=a(54503),li=a(95315),ci=a(27720);const di=JSON.parse('{"title_queries-activity":"Queries Activity","context_monitor-changes-realtime":"Monitor changes in real time","value_per-sec":"{{count}} per sec","value_ms":"{{time}} ms","field_running-queries":"Running Queries","field_applications":"Applications","field_users":"Users","action_open-running-queries":"Open Running Queries"}'),ui="ydb-queries-activity-bar";ge.Ru.registerKeyset(ge.JA.En,ui,di);const pi=ge.Ru.keyset(ui),hi=(0,l.cn)("queries-activity-alert");function mi({runningQueriesCount:e,uniqueApplications:t,uniqueUsers:a}){const n=(0,ar.W6)(),s=(0,ar.zy)();return(0,c.jsx)("div",{className:hi(),children:(0,c.jsx)(Ma.Z,{className:hi("card"),type:"container",view:"outlined",children:(0,c.jsxs)(ke.s,{direction:"row",justifyContent:"space-between",alignItems:"center",gap:4,className:hi("content"),children:[(0,c.jsx)(ke.s,{children:(0,c.jsx)(Re.E,{variant:"subheader-2",className:hi("title"),children:pi("title_queries-activity")})}),(0,c.jsxs)(ke.s,{wrap:!0,alignItems:"center",gap:1,className:hi("stats"),children:[(0,c.jsx)(zt.J,{theme:e>0?"success":"unknown",icon:(0,c.jsx)(Me.I,{data:oi.A}),size:"s",value:String(e),children:pi("field_running-queries")}),(0,c.jsx)(zt.J,{theme:"unknown",icon:(0,c.jsx)(Me.I,{data:li.A}),size:"s",value:String(t),children:pi("field_applications")}),(0,c.jsx)(zt.J,{theme:"unknown",icon:(0,c.jsx)(Me.I,{data:ci.A}),size:"s",value:String(a),children:pi("field_users")}),e>0&&(0,c.jsx)(ja.$,{view:"outlined",size:"s",onClick:()=>{const e=(0,B.mA)(s),t=(0,B.YL)({...e,[Rn.vh.diagnosticsTab]:E.iJ.topQueries,queryMode:"running"});n.push(t)},className:hi("open-queries-button"),children:pi("action_open-running-queries")})]})]})})})}var gi=a(93537),vi=a(19295),yi=a(60461);const xi=JSON.parse('{"action_open-monitoring":"Monitoring","top-nodes.empty-data":"No such nodes","title_top-nodes-load":"Top nodes by load","title_top-nodes-pool":"Top nodes by pools usage","cards.cpu-label":"CPU load","cards.storage-label":"Storage","cards.memory-label":"Memory used","cards.network-label":"Network","cards.network-note":"Network throughput is the average outgoing bandwidth usage across all nodes in the database","context_cpu-load":"CPU load","context_storage-groups":"Storage: {{count}} groups","context_memory-used":"Memory used","context_network-usage":"Network usage","context_cpu-description":"CPU load is calculated as the cumulative usage across all actor system pools in the database","context_memory-description":"Memory usage is the total memory consumed by all processes in the database","context_storage-description":"Storage usage shows how much data is stored in the database including user data and indexes","context_network-description":"Network throughput is the average outgoing bandwidth usage across all nodes in the database","charts.queries-per-second":"Queries per second","charts.queries-latency":"Queries latencies {{percentile}}","charts.cpu-usage":"CPU usage by pool","charts.storage-usage":"Tablet storage usage","charts.memory-usage":"Memory usage","charts.network-utilization":"Network utilization","title_storage-details":"Storage Details","storage.tablet-storage-title":"Tablet storage","storage.tablet-storage-description":"Size of user data and indexes stored in schema objects (tables, topics, etc.)","storage.db-storage-title":"Database storage","storage.db-storage-description":"Size of data stored in distributed storage with all overheads for redundancy","title_top-shards":"Top shards by CPU usage","title_top-queries":"Top queries by CPU usage","title_top-tables-by-size":"Top tables by size","title_top-groups-by-usage":"Top groups by usage","title_top-nodes-by-memory":"Top nodes by memory","title_nodes-by-ping":"Top nodes by ping time","title_nodes-by-skew":"Top nodes by clock skew","title_memory-details":"Memory Details","field_memory-usage":"Memory usage","context_capacity-usage":"{{value}} of {{capacity}}","title_network-stats-unavailable":"Network Statistics Unavailable","context_network-stats-unavailable":"Network ping and clock skew statistics require a newer backend version. Please upgrade your YDB installation to access these features.","value_serverless":"Serverless","context_serverless-tooltip":"Some metrics are hidden in Serverless mode \u2014 resources scale automatically based on workload","context_serverless-autoscaled":"Auto-Scaled Resources","context_serverless-storage-subtitle":"{{legend}} | {{groups}} groups"}'),bi=(0,ge.g4)("ydb-diagnostics-tenant-overview",{en:xi}),fi=[{title:bi("charts.queries-per-second"),metrics:[{target:"queries.requests",title:bi("charts.queries-per-second")}]},{title:bi("charts.queries-latency",{percentile:""}),metrics:[{target:"queries.latencies.p50",title:"p50"},{target:"queries.latencies.p75",title:"p75"},{target:"queries.latencies.p90",title:"p90"},{target:"queries.latencies.p99",title:"p99"}],options:{dataType:"ms",showLegend:!0}}];var ji=a(66643),Ti=a(40014),Si=a(25533),wi=a(13066),Ei=a(15151);const _i={"30m":30*f.r0,"1h":f.Jg,"1d":f.tt,"1w":7*f.tt},Ni=JSON.parse('{"value_30m":"Last 30 min","value_1h":"Last hour","value_1d":"Last day","value_1w":"Last week"}'),Ci=(0,ge.g4)("ydb-timeframe-dropdown",{en:Ni}),Pi=e=>{switch(e){case"30m":return Ci("value_30m");case"1h":return Ci("value_1h");case"1d":return Ci("value_1d");case"1w":return Ci("value_1w");default:return e}},Ii=(0,l.cn)("ydb-timeframe-dropdown"),Ai=({value:e,onChange:t,className:a,size:s="s",view:r="flat-secondary"})=>{const i=n.useMemo((()=>Object.keys(_i).map((e=>({text:Pi(e),action:()=>t(e)})))),[t]);return(0,c.jsx)(Ei.r,{renderSwitcher:t=>(0,c.jsxs)(ja.$,{...t,size:s,view:r,className:Ii(null,a),children:[Pi(e),(0,c.jsx)(Me.I,{data:wi.A,size:12})]}),items:i,popupProps:{placement:"bottom-start"}})};var Di=a(90474);const Ri=["#7EB26D","#EAB839","#6ED0E0","#EF843C","#E24D42","#1F78C1","#BA43A9","#705DA0","#508642","#CCA300"];function ki(e){return null===e?f.Pd:(0,He.Xo)((0,U.CR)((0,$r.y3)(e),2))}function Oi(e){return null===e?f.Pd:(0,hn.z3)({value:(0,$r.y3)(e),precision:3})}function Mi(e){return null===e?f.Pd:Math.round(100*(0,$r.y3)(e))+"%"}const Fi=JSON.parse('{"not-supported":"Charts are not supported on current ydb version"}'),Li=(0,ge.g4)("ydb-metric-chart",{en:Fi}),qi=g.F.injectEndpoints({endpoints:e=>({getChartData:e.query({queryFn:async(e,{signal:t})=>{try{const a=await(async({database:e,metrics:t,timeFrame:a,maxDataPoints:n},{signal:s}={})=>{const r=t.map((e=>`target=${e.target}`)).join("&"),i=Math.round(Date.now()/1e3),o=i-_i[a];return window.api.viewer.getChartData({target:r,from:o,until:i,maxDataPoints:n,database:e},{signal:s})})(e,{signal:t});if(Array.isArray(a)){return{data:((e=[],t)=>{const a=e.map((({datapoints:e,target:a})=>{const n=t.find((e=>e.target===a));if(!n)return;const s=e.map((e=>e[0]));return{...n,data:s}})).filter((e=>void 0!==e));return{timeline:e[0].datapoints.map((e=>1e3*e[1])),metrics:a}})(a,e.metrics)}}return{error:new Error("string"===typeof a?Li("not-supported"):a.error)}}catch(a){return{error:a}}},providesTags:["All"],keepUnusedDataFor:0})}),overrideExisting:"throw"}),zi=(0,l.cn)("ydb-metric-chart");ji.W.set({plugins:[Si.YagrPlugin]});const Ui=(e,t={})=>{const{dataType:a,scaleRange:n,showLegend:s}=t,r=(e=>{switch(e){case"ms":return ki;case"size":return Oi;case"percent":return Mi;default:return}})(a),i=!e.metrics.length,o=e.metrics.map(((e,t)=>{const a=e.color||Ri[t],n=function(e,t){const a=(0,Di.Mj)(e);if(!a.isValid())throw new Error("Invalid color is passed");return a.alpha(t).toRgbString()}(a,.1);return{id:e.target,name:e.title||e.target,data:e.data,formatter:r,lineColor:a,color:n,legendColorKey:"lineColor"}}));return{data:{timeline:e.timeline,graphs:o},libraryConfig:{chart:{size:{padding:i?[10,0,10,0]:void 0},series:{type:"area",spanGaps:!0,lineWidth:1.5},select:{zoom:!1}},scales:{y:{type:"linear",range:"nice",min:(null===n||void 0===n?void 0:n.min)||0,max:null===n||void 0===n?void 0:n.max}},axes:{y:{values:r?(e,t)=>t.map(r):void 0}},tooltip:{show:!0,tracking:"sticky"},legend:{show:s}}}},Qi={timeline:[],metrics:[]},Gi=({database:e,metrics:t,defaultTimeFrame:a="1h",autorefresh:s,width:r=400,height:i=r/1.5,chartOptions:o,onChartDataStatusChange:l,isChartVisible:d,title:u})=>{const[p,h]=n.useState(a),{currentData:m,error:g,isFetching:v,status:y}=qi.useGetChartDataQuery({database:e,metrics:t,timeFrame:p,maxDataPoints:300},{pollingInterval:s}),x=v&&!m;n.useEffect((()=>null===l||void 0===l?void 0:l("fulfilled"===y?"success":"loading")),[y,l]);const b=Ui(m||Qi,o);return(0,c.jsxs)("div",{className:zi(),style:{height:i},children:[(0,c.jsxs)(ke.s,{className:zi("toolbar"),justifyContent:"space-between",alignItems:"center",children:[(0,c.jsx)("div",{children:u}),(0,c.jsx)(Ai,{value:p,onChange:h})]}),x?(0,c.jsx)(L.a,{}):d?(0,c.jsxs)("div",{className:zi("chart"),children:[(0,c.jsx)(Ti.Ay,{type:"yagr",data:b}),g?(0,c.jsx)(F.o,{className:zi("error"),error:g}):null]}):null]})},Bi=(0,l.cn)("queries-activity-bar");function $i({database:e,expanded:t,onChartDataStatusChange:a}){const[s]=(0,j.Nt)(),[r,i]=n.useState(!1),o=e=>fi.find((t=>t.metrics.some((t=>t.target===e)))),l=o("queries.requests"),d=o("queries.latencies.p99"),u=r?s:0,p=n.useCallback((e=>{"success"===e&&i(!0),null===a||void 0===a||a(e)}),[a]);return l&&d?(0,c.jsxs)(ke.s,{className:Bi("charts"),gap:4,direction:"row",style:{display:t?void 0:"none"},children:[(0,c.jsx)(ke.s,{direction:"column",gap:3,grow:!0,basis:0,minWidth:0,children:(0,c.jsx)(Gi,{database:e,metrics:l.metrics,autorefresh:u,height:292,chartOptions:l.options,onChartDataStatusChange:p,isChartVisible:r&&t,title:l.title})}),(0,c.jsx)(ke.s,{direction:"column",gap:3,grow:!0,basis:0,minWidth:0,children:(0,c.jsx)(Gi,{database:e,metrics:d.metrics,autorefresh:u,height:326.5,chartOptions:d.options,onChartDataStatusChange:p,isChartVisible:r&&t,title:d.title})})]}):(console.warn("Required chart configurations not found in defaultDashboardConfig"),null)}const Hi=1e-6;let Vi=function(e){return e.Up="up",e.Down="down",e}({});const Wi=e=>e>=1?`+${e.toFixed(0)}`:e>0?`+${e.toFixed(1)}`:e.toFixed(1),Ji=(0,l.cn)("queries-activity-bar");function Ki({database:e,runningQueriesCount:t,uniqueApplications:a,uniqueUsers:s,qps:r,latency:i}){var o,l,d,u,p,h;const m=(0,ar.W6)(),g=(0,ar.zy)(),[v,y]=n.useState(!1);return(0,c.jsx)("div",{className:Ji({expanded:v}),children:(0,c.jsxs)(Ma.Z,{className:Ji("card"),type:"container",view:v?"outlined":"raised",children:[(0,c.jsxs)(ke.s,{className:Ji("header"),onClick:()=>{y(!v)},justifyContent:"space-between",alignItems:"center",gap:3,children:[(0,c.jsxs)(ke.s,{direction:"column",children:[(0,c.jsx)(Re.E,{variant:"subheader-2",className:Ji("title"),children:pi("title_queries-activity")}),(0,c.jsx)(Re.E,{color:"secondary",variant:"caption-2",className:Ji("subtitle"),children:pi("context_monitor-changes-realtime")})]}),(0,c.jsxs)(ke.s,{alignItems:"center",gap:4,children:[(0,c.jsxs)(ke.s,{alignItems:"center",gap:1,children:[(0,c.jsx)(zt.J,{theme:t>0?"success":"unknown",size:"s",icon:(0,c.jsx)(Me.I,{data:oi.A,size:14}),children:t}),(0,c.jsx)(zt.J,{theme:"unknown",icon:(0,c.jsx)(Me.I,{data:gi.A}),size:"s",value:Wi(null!==(o=null===r||void 0===r||null===(l=r.trend)||void 0===l?void 0:l.value)&&void 0!==o?o:0),children:pi("value_per-sec",{count:null!==(d=null===r||void 0===r?void 0:r.value)&&void 0!==d?d:"0"})}),(0,c.jsx)(zt.J,{theme:"unknown",icon:(0,c.jsx)(Me.I,{data:vi.A}),size:"s",value:Wi(null!==(u=null===i||void 0===i||null===(p=i.trend)||void 0===p?void 0:p.value)&&void 0!==u?u:0),children:pi("value_ms",{time:null!==(h=null===i||void 0===i?void 0:i.value)&&void 0!==h?h:"0"})})]}),(0,c.jsx)(yi.I,{direction:v?"top":"bottom",size:16})]})]}),v&&(0,c.jsx)(ke.s,{direction:"column",gap:4,className:Ji("content"),children:(0,c.jsxs)(ke.s,{wrap:!0,alignItems:"center",gap:1,className:Ji("stats"),children:[(0,c.jsx)(zt.J,{theme:"unknown",icon:(0,c.jsx)(Me.I,{data:oi.A}),size:"s",value:String(t),children:pi("field_running-queries")}),(0,c.jsx)(zt.J,{theme:"unknown",icon:(0,c.jsx)(Me.I,{data:li.A}),size:"s",value:String(a),children:pi("field_applications")}),(0,c.jsx)(zt.J,{theme:"unknown",icon:(0,c.jsx)(Me.I,{data:ci.A}),size:"s",value:String(s),children:pi("field_users")}),t>0&&(0,c.jsx)(ja.$,{view:"outlined",size:"s",onClick:()=>{const e=(0,B.mA)(g),t=(0,B.YL)({...e,[Rn.vh.diagnosticsTab]:E.iJ.topQueries,queryMode:"running"});m.push(t)},className:Ji("open-queries-button"),children:pi("action_open-running-queries")})]})}),(0,c.jsx)($i,{database:e,expanded:v})]})})}var Yi=a(1608);const Zi=(0,l.cn)("queries-activity-skeleton");function Xi(){return(0,c.jsx)(Yi.E,{className:Zi("skeleton")})}var eo=a(68712),to=a(12482),ao=a(75022);function no(e){var t,a,s,r,i,o,l;const[c]=(0,j.Nt)(),d=c,u=!1===(0,ao.N)((t=>(0,eo.TH)(t,e))),{data:p}=to.Ke.useGetRunningQueriesQuery({database:e,filters:{}},{pollingInterval:d}),{data:h,isSuccess:m,isError:g}=qi.useGetChartDataQuery({database:e,metrics:[{target:"queries.requests"}],timeFrame:"1h",maxDataPoints:30},{pollingInterval:d,skip:u}),{data:v}=qi.useGetChartDataQuery({database:e,metrics:[{target:"queries.latencies.p99"}],timeFrame:"1h",maxDataPoints:30},{pollingInterval:d,skip:u}),y=(null===p||void 0===p||null===(t=p.resultSets)||void 0===t||null===(a=t[0])||void 0===a||null===(s=a.result)||void 0===s?void 0:s.length)||0,x=n.useMemo((()=>!u&&(!!m||!g&&null)),[m,g,u]),b=n.useMemo((()=>{var e,t;return(e=>{var t,a;const n={value:Hi.toFixed(0),trend:{value:Hi,direction:Vi.Up}};if(!e)return n;if(0===e.length)return n;const s=null!==(t=e[e.length-1])&&void 0!==t?t:Hi,r=e.length>=2&&null!==(a=e[e.length-2])&&void 0!==a?a:Hi;let i;if(r>0){const e=s-r;i={value:Math.abs(e),direction:e>=0?Vi.Up:Vi.Down}}else i={value:Hi,direction:Vi.Up};return{value:s.toFixed(0),trend:i}})(null===h||void 0===h||null===(e=h.metrics)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.data)}),[null===h||void 0===h||null===(r=h.metrics)||void 0===r||null===(i=r[0])||void 0===i?void 0:i.data]),f=n.useMemo((()=>{var e,t;return(e=>{var t,a;if(!e)return{value:Hi.toFixed(1),trend:{value:Hi,direction:Vi.Up}};if(0===e.length)return{value:Hi.toFixed(1),trend:{value:Hi,direction:Vi.Up}};const n=null!==(t=e[e.length-1])&&void 0!==t?t:Hi,s=e.length>=2&&null!==(a=e[e.length-2])&&void 0!==a?a:Hi;let r;if(s>0){const e=n-s;r={value:Math.abs(e),direction:e>=0?Vi.Up:Vi.Down}}else r={value:Hi,direction:Vi.Up};return{value:n.toFixed(1),trend:r}})(null===v||void 0===v||null===(e=v.metrics)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.data)}),[null===v||void 0===v||null===(o=v.metrics)||void 0===o||null===(l=o[0])||void 0===l?void 0:l.data]);return{runningQueriesCount:y,uniqueApplications:n.useMemo((()=>{var e,t,a;const n=new Set;return null===p||void 0===p||null===(e=p.resultSets)||void 0===e||null===(t=e[0])||void 0===t||null===(a=t.result)||void 0===a||a.forEach((e=>{e.ApplicationName&&n.add(String(e.ApplicationName))})),n.size}),[p]),uniqueUsers:n.useMemo((()=>{var e,t,a;const n=new Set;return null===p||void 0===p||null===(e=p.resultSets)||void 0===e||null===(t=e[0])||void 0===t||null===(a=t.result)||void 0===a||a.forEach((e=>{e.UserSID&&n.add(String(e.UserSID))})),n.size}),[p]),qps:b,latency:f,areChartsAvailable:x}}function so({database:e}){const{runningQueriesCount:t,uniqueApplications:a,uniqueUsers:n,qps:s,latency:r,areChartsAvailable:i}=no(e);return null===i?(0,c.jsx)(Xi,{}):!1===i?(0,c.jsx)(mi,{runningQueriesCount:t,uniqueApplications:a,uniqueUsers:n}):(0,c.jsx)(Ki,{database:e,runningQueriesCount:t,uniqueApplications:a,uniqueUsers:n,qps:s,latency:r})}var ro=a(42214),io=a(44526),oo=a(28232),lo=a(86557),co=a(54090);let uo=function(e){return e.UNSPECIFIED="UNSPECIFIED",e.GOOD="GOOD",e.DEGRADED="DEGRADED",e.MAINTENANCE_REQUIRED="MAINTENANCE_REQUIRED",e.EMERGENCY="EMERGENCY",e}({}),po=function(e){return e.UNSPECIFIED="UNSPECIFIED",e.GREY="GREY",e.GREEN="GREEN",e.BLUE="BLUE",e.YELLOW="YELLOW",e.ORANGE="ORANGE",e.RED="RED",e}({});const ho={[po.UNSPECIFIED]:co.m.Grey,[po.GREY]:co.m.Grey,[po.GREEN]:co.m.Green,[po.BLUE]:co.m.Blue,[po.YELLOW]:co.m.Yellow,[po.ORANGE]:co.m.Orange,[po.RED]:co.m.Red};const mo=g.F.injectEndpoints({endpoints:e=>({getHealthcheckInfo:e.query({queryFn:async({database:e,maxLevel:t},{signal:a})=>{try{return{data:await window.api.viewer.getHealthcheckInfo({database:e,maxLevel:t},{signal:a})}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"}),go={RED:0,ORANGE:1,YELLOW:2,BLUE:3,GREEN:4},vo=e=>e.sort(((e,t)=>(e.status&&go[e.status]||0)-(t.status&&go[t.status]||0))),yo=(0,Ta.Mz)((e=>e),(e=>mo.endpoints.getHealthcheckInfo.select({database:e}))),xo=(0,Ta.Mz)((e=>e),((e,t)=>yo(t)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.self_check_result})),bo=(0,Ta.Mz)((e=>e),((e,t)=>yo(t)),((e,t)=>{var a;return(null===(a=t(e).data)||void 0===a?void 0:a.issue_log)||[]})),fo=(0,Ta.Mz)(bo,((e=[])=>{return vo((t=e).filter((e=>!t.find((t=>t.reason&&-1!==t.reason.indexOf(e.id))))));var t})),jo=(0,Ta.Mz)([bo,fo],((e=[],t=[])=>t.map((t=>vo(function(e,t){const a=[];if(!t.reason||0===t.reason.length)return[t];for(const n of t.reason){const t=e.find((e=>e.id===n));if(!t)continue;const s=[t],r=t.type;for(;s.length>0;){const t=s.pop();if(t.reason&&0!==t.reason.length)for(const a of t.reason){const n=e.find((e=>e.id===a));if(!n)continue;const i={...n,parent:t,firstParentType:r};s.push(i)}else a.push(t)}}return a}(e,t)))).flat())),To=(0,Ta.Mz)((e=>e),((e,t)=>yo(t)),((e,t)=>t(e).data));var So=a(64280),wo=a(5744),Eo=a(45720),_o=a(18677),No=a(71153);const Co={[uo.UNSPECIFIED]:"",[uo.GOOD]:yt("description_ok"),[uo.DEGRADED]:yt("description_degraded"),[uo.MAINTENANCE_REQUIRED]:yt("description_maintenance"),[uo.EMERGENCY]:yt("description_emergency")},Po={[uo.UNSPECIFIED]:So.A,[uo.GOOD]:wo.A,[uo.DEGRADED]:Eo.A,[uo.MAINTENANCE_REQUIRED]:_o.A,[uo.EMERGENCY]:No.A},Io=JSON.parse('{"description_problems":["There is {{count}} issue.","There are {{count}} issues.","There are {{count}} issues.","There are {{count}} issues."],"action_review-issues":"Review issues","description_no-data":"No healthcheck data"}'),Ao=(0,ge.g4)("ydb-diagnostics-healthcheck",{en:Io}),Do=(0,l.cn)("ydb-healthcheck-preview"),Ro={[uo.UNSPECIFIED]:"normal",[uo.GOOD]:"success",[uo.DEGRADED]:"info",[uo.MAINTENANCE_REQUIRED]:"warning",[uo.EMERGENCY]:"danger"};function ko(e){var t;const{database:a}=e,[n]=(0,j.Nt)(),{handleShowHealthcheckChange:s}=Ra(),{currentData:r,isFetching:i,error:o}=mo.useGetHealthcheckInfoQuery({database:a},{pollingInterval:n}),l=i&&void 0===r,d=(null===r||void 0===r?void 0:r.self_check_result)||uo.UNSPECIFIED,u=d.toLowerCase();if(l)return(0,c.jsx)(Yi.E,{className:Do("skeleton")});const p=null===r||void 0===r||null===(t=r.issue_log)||void 0===t?void 0:t.filter((e=>!e.reason)).length,h=p?Ao("description_problems",{count:p}):"";if("GOOD"===d&&!p&&!l)return null;return(0,c.jsx)(lo.F,{className:Do(),theme:Ro[d],view:o?"outlined":"filled",message:o?(0,c.jsx)(F.o,{error:o,defaultMessage:Ao("description_no-data")}):(0,c.jsxs)(ke.s,{gap:1,alignItems:"center",justifyContent:"space-between",className:Do("alert-message"),children:[(0,c.jsxs)(ke.s,{gap:1,alignItems:"center",children:[Co[d],h?` ${h}`:""]}),p&&(0,c.jsx)(ja.$,{onClick:()=>{s(!0)},children:Ao("action_review-issues")})]}),icon:(0,c.jsx)(Me.I,{size:18,data:Po[d],className:Do("icon",{[u]:!0})})})}var Oo=a(17270),Mo=(a(8861),a(35736));const Fo=(e=[])=>{const t=Number(e.reduce(((e,t)=>e+(t.used||0)),0).toFixed(2)),a=Number(e.reduce(((e,t)=>e+(t.limit||0)),0).toFixed(2)),n=a>0?t/a*100:0;return{totalUsed:t,totalLimit:a,usagePercent:n,status:(0,Mo.w)({fillWidth:n,colorizeProgress:!0})}};var Lo=a(52905),qo=a(57428),zo=a(21049);const Uo=(0,l.cn)("tenant-tab-card");function Qo({text:e,active:t,helpText:a,subtitle:n}){return(0,c.jsx)("div",{className:Uo({active:t}),children:(0,c.jsx)(Ma.Z,{className:Uo("card-container",{active:t}),type:"container",view:t?"outlined":"raised",children:(0,c.jsxs)("div",{className:Uo("legend-wrapper"),children:[(0,c.jsx)(zo.e.Legend,{variant:"subheader-2",note:a,noteIconSize:"s",children:e}),n?(0,c.jsx)(zo.e.Legend,{variant:"body-1",color:"secondary",children:n}):null]})})})}var Go=a(18836);const Bo=(0,l.cn)("tenant-tab-card");function $o({active:e,children:t}){return(0,c.jsx)("div",{className:Bo({active:e}),children:(0,c.jsx)(Ma.Z,{className:Bo("card-container",{active:e}),type:"container",view:e?"outlined":"raised",children:t})})}function Ho({text:e,value:t,limit:a,helpText:s,legendFormatter:r,active:i}){const o=n.useMemo((()=>(0,Go.s)({value:t,capacity:a,legendFormatter:r})),[t,a,r]),{status:l,percents:d,legend:u,fill:p}=o;return(0,c.jsx)($o,{active:i,children:(0,c.jsxs)(ke.s,{gap:3,alignItems:"center",children:[(0,c.jsx)(zo.e,{size:"small",status:l,fillWidth:p,className:Bo("doughnut"),children:(0,c.jsx)(zo.e.Value,{variant:"subheader-1",children:d})}),(0,c.jsxs)("div",{className:Bo("legend-wrapper"),children:[(0,c.jsx)(zo.e.Legend,{variant:"subheader-2",children:u}),(0,c.jsx)(zo.e.Legend,{variant:"body-1",color:"secondary",note:s,noteIconSize:"s",children:e})]})]})})}const Vo=(0,l.cn)("tenant-metrics-tabs");function Wo({to:e,active:t,isServerless:a,cpu:n}){return(0,c.jsx)("div",{className:Vo("link-container",{active:t}),children:(0,c.jsx)(Lo.N_,{to:e,className:Vo("link"),children:a?(0,c.jsx)(Qo,{text:bi("context_cpu-load"),active:t,helpText:bi("context_cpu-description"),subtitle:bi("context_serverless-autoscaled")}):(0,c.jsx)(Ho,{text:bi("context_cpu-load"),value:n.totalUsed,limit:n.totalLimit,legendFormatter:qo.vs,active:t,helpText:bi("context_cpu-description")})})})}const Jo=(0,l.cn)("tenant-metrics-tabs");function Ko({to:e,active:t,memory:a}){return(0,c.jsx)("div",{className:Jo("link-container",{active:t}),children:(0,c.jsx)(Lo.N_,{to:e,className:Jo("link"),children:(0,c.jsx)(Ho,{text:bi("context_memory-used"),value:a.totalUsed,limit:a.totalLimit,legendFormatter:qo.cO,active:t,helpText:bi("context_memory-description")})})})}var Yo=a(15619);const Zo=(0,l.cn)("tenant-tab-card");function Xo({active:e,children:t}){return(0,c.jsx)("div",{className:Zo({active:e}),children:(0,c.jsx)(Ma.Z,{className:Zo("card-container",{active:e}),type:"container",view:e?"outlined":"raised",children:t})})}function el({text:e,fillPercent:t,helpText:a,legendText:s,active:r}){const{status:i,percents:o,fill:l}=n.useMemo((()=>(0,Go.v)({fillWidth:t})),[t]);return(0,c.jsx)(Xo,{active:r,children:(0,c.jsxs)(ke.s,{gap:3,alignItems:"center",children:[(0,c.jsx)(zo.e,{size:"small",status:i,fillWidth:l,className:Zo("doughnut"),children:(0,c.jsx)(zo.e.Value,{variant:"subheader-1",children:o})}),(0,c.jsxs)("div",{className:Zo("legend-wrapper"),children:[(0,c.jsx)(zo.e.Legend,{variant:"subheader-2",children:s}),(0,c.jsx)(zo.e.Legend,{variant:"body-1",color:"secondary",note:a,noteIconSize:"s",children:e})]})]})})}const tl=(0,l.cn)("tenant-metrics-tabs");function al({to:e,active:t,networkUtilization:a,networkThroughput:n}){const s=100*a,r=(0,Yo.z)({value:n,withSpeedLabel:!0});return(0,c.jsx)("div",{className:tl("link-container",{active:t}),children:(0,c.jsx)(Lo.N_,{to:e,className:tl("link"),children:(0,c.jsx)(el,{text:bi("context_network-usage"),fillPercent:s,legendText:r,active:t,helpText:bi("context_network-description")})})})}const nl=(0,l.cn)("tenant-metrics-tabs");function sl(){return(0,c.jsx)("div",{className:nl("link-container",{placeholder:!0}),children:(0,c.jsx)("div",{className:nl("link"),children:(0,c.jsx)(Qo,{text:f.pI,active:!1,helpText:void 0,subtitle:f.pI})})})}const rl=(0,l.cn)("tenant-metrics-tabs");function il({to:e,active:t,isServerless:a,storage:n,storageGroupsCount:s}){const r=void 0===s||a?bi("cards.storage-label"):bi("context_storage-groups",{count:s});return(0,c.jsx)("div",{className:rl("link-container",{active:t}),children:(0,c.jsx)(Lo.N_,{to:e,className:rl("link"),children:a?(0,c.jsx)(Qo,{text:r,active:t,helpText:bi("context_storage-description"),subtitle:n.totalLimit?bi("context_serverless-storage-subtitle",{groups:String(null!==s&&void 0!==s?s:0),legend:(0,qo.cO)({value:n.totalUsed,capacity:n.totalLimit})}):void 0}):(0,c.jsx)(Ho,{text:r,value:n.totalUsed,limit:n.totalLimit,legendFormatter:qo.cO,active:t,helpText:bi("context_storage-description")})})})}const ol=(0,l.cn)("tenant-metrics-tabs");function ll({poolsCpuStats:e,memoryStats:t,blobStorageStats:a,tabletStorageStats:s,networkUtilization:r,networkThroughput:i,storageGroupsCount:o,databaseType:l,activeTab:d}){const u=(0,ar.zy)(),p=(0,B.mA)(u),h={[E.pA.cpu]:(0,B.YL)({...p,[Rn.vh.metricsTab]:E.pA.cpu}),[E.pA.storage]:(0,B.YL)({...p,[Rn.vh.metricsTab]:E.pA.storage}),[E.pA.memory]:(0,B.YL)({...p,[Rn.vh.metricsTab]:E.pA.memory}),[E.pA.network]:(0,B.YL)({...p,[Rn.vh.metricsTab]:E.pA.network})},m=n.useMemo((()=>(e||[]).filter((e=>!("Batch"===e.name||"IO"===e.name)))),[e]),g=n.useMemo((()=>Fo(m)),[m]),v=n.useMemo((()=>s||a||[]),[s,a]),y=n.useMemo((()=>Fo(v)),[v]),x=n.useMemo((()=>Fo(t)),[t]),[b]=(0,j.iK)(Oo.GS.SHOW_NETWORK_UTILIZATION),f="Serverless"===l;return(0,c.jsxs)(ke.s,{className:ol({serverless:Boolean(f)}),alignItems:"center",children:[(0,c.jsx)(Wo,{to:h[E.pA.cpu],active:d===E.pA.cpu,isServerless:Boolean(f),cpu:{totalUsed:g.totalUsed,totalLimit:g.totalLimit}}),(0,c.jsx)(il,{to:h[E.pA.storage],active:d===E.pA.storage,isServerless:Boolean(f),storage:{totalUsed:y.totalUsed,totalLimit:y.totalLimit},storageGroupsCount:o}),f?(0,c.jsx)(sl,{}):(0,c.jsx)(Ko,{to:h[E.pA.memory],active:d===E.pA.memory,memory:{totalUsed:x.totalUsed,totalLimit:x.totalLimit}}),(()=>{if(!b)return null;return void 0!==r&&void 0!==i&&isFinite(r)&&isFinite(i)?f?(0,c.jsx)(sl,{}):(0,c.jsx)(al,{to:h[E.pA.network],active:d===E.pA.network,networkUtilization:r,networkThroughput:i}):null})()]})}const cl={id:E.iJ.overview,title:"Info"},dl={id:E.iJ.schema,title:"Schema"},ul={id:E.iJ.topQueries,title:"Queries"},pl={id:E.iJ.topShards,title:"Top shards"},hl={id:E.iJ.access,title:"Access"},ml={id:E.iJ.backups,title:"Backups"},gl={id:E.iJ.nodes,title:"Nodes"},vl={id:E.iJ.tablets,title:"Tablets"},yl={id:E.iJ.storage,title:"Storage"},xl={id:E.iJ.network,title:"Network"},bl={id:E.iJ.describe,title:"Describe"},fl={id:E.iJ.hotKeys,title:"Hot keys"},jl={id:E.iJ.graph,title:"Graph"},Tl={id:E.iJ.consumers,title:"Consumers"},Sl={id:E.iJ.partitions,title:"Partitions"},wl={id:E.iJ.topicData,title:"Data"},El={id:E.iJ.configs,title:"Configs"},_l={id:E.iJ.operations,title:"Operations"},Nl={id:E.iJ.monitoring,title:"Monitoring",badge:{text:"New",theme:"normal",size:"xs"}},Cl=[cl,vl,bl,hl],Pl=[cl,vl,bl,hl],Il=[cl,Nl,ul,pl,gl,vl,yl,xl,bl,El,hl,_l,ml],Al=[cl,Nl,ul,pl,vl,bl,El,_l],Dl=[cl,dl,pl,gl,jl,vl,fl,bl,hl],Rl=[cl,dl,pl,gl,vl,bl,hl],kl=[cl,dl,gl,bl,hl],Ol=[cl,pl,gl,bl,hl],Ml=[cl,Tl,Sl,wl,gl,bl,hl],Fl=[cl,gl,vl,bl,hl],Ll=[cl,Tl,Sl,wl,gl,vl,bl,hl],ql=[cl,bl,hl],zl=[cl,dl,bl,hl],Ul=[cl,dl,bl,hl],Ql=[cl,bl,hl],Gl={[it.EPathTypeInvalid]:void 0,[it.EPathTypeSubDomain]:Il,[it.EPathTypeExtSubDomain]:Il,[it.EPathTypeColumnStore]:Il,[it.EPathTypeTable]:Dl,[it.EPathTypeColumnTable]:Rl,[it.EPathTypeSysView]:kl,[it.EPathTypeDir]:Ol,[it.EPathTypeTableIndex]:Ol,[it.EPathTypeCdcStream]:Ml,[it.EPathTypePersQueueGroup]:Ll,[it.EPathTypeExternalDataSource]:ql,[it.EPathTypeExternalTable]:zl,[it.EPathTypeStreamingQuery]:Ql,[it.EPathTypeView]:Ul,[it.EPathTypeReplication]:Cl,[it.EPathTypeTransfer]:Pl,[it.EPathTypeResourcePool]:Ol},Bl={[ot.EPathSubTypeStreamImpl]:Fl,[ot.EPathSubTypeSyncIndexImplTable]:void 0,[ot.EPathSubTypeAsyncIndexImplTable]:void 0,[ot.EPathSubTypeVectorKmeansTreeIndexImplTable]:void 0,[ot.EPathSubTypeFulltextIndexImplTable]:void 0,[ot.EPathSubTypeEmpty]:void 0};function $l(e,t,a={}){let n=e;(e=>e===it.EPathTypeCdcStream||e===it.EPathTypePersQueueGroup)(t)&&!a.hasTopicData&&(n=n.filter((e=>e.id!==E.iJ.topicData)));const s=[];return a.hasBackups||s.push(E.iJ.backups),a.hasConfigs||s.push(E.iJ.configs),a.hasAccess||s.push(E.iJ.access),a.hasMonitoring||s.push(E.iJ.monitoring),n.filter((e=>!s.includes(e.id)))}const Hl=(e,t,a)=>{const n=function(e,t){return(t?Bl[t]:void 0)||(e?Gl[e]:void 0)||Ol}(e,t);return $l(Dt(e)||(null===a||void 0===a?void 0:a.isTopLevel)?"Serverless"===(null===a||void 0===a?void 0:a.databaseType)?Al:Il:n,e,a)},Vl=()=>{const[e]=(0,et.useQueryParams)({database:et.StringParam,schema:et.StringParam,backend:et.StringParam,clusterName:et.StringParam});return n.useCallback(((t,a)=>(0,B.YL)({...e,[Rn.vh.diagnosticsTab]:t,...a})),[e])};var Wl=a(2796);const Jl=JSON.parse('{"action_see-all":"See all"}'),Kl=(0,ge.g4)("ydb-see-all-button",{en:Jl});function Yl({to:e,className:t,onClick:a}){return(0,c.jsx)(An.E,{className:t,to:e,onClick:a,children:(0,c.jsxs)(ke.s,{alignItems:"center",gap:1,children:[(0,c.jsx)(Re.E,{children:Kl("action_see-all")}),(0,c.jsx)(Me.I,{data:Wl.A,size:16})]})})}const Zl=(0,l.cn)("ydb-stats-wrapper");function Xl({children:e,className:t,title:a,description:n,allEntitiesLink:s,onAllEntitiesClick:r}){return(0,c.jsxs)(ke.s,{className:Zl(null,t),gap:2,direction:"column",children:[(0,c.jsxs)(ke.s,{justifyContent:"space-between",wrap:"nowrap",className:Zl("header"),children:[(0,c.jsxs)(ke.s,{direction:"column",children:[(0,c.jsx)(Re.E,{variant:"subheader-2",children:a}),n&&(0,c.jsx)(Re.E,{color:"secondary",children:n})]}),s&&(0,c.jsx)(Yl,{to:s,onClick:r})]}),e]})}const ec=(0,l.cn)("ydb-tenant-dashboard"),tc=({database:e,charts:t})=>{const a=(0,I.iC)(),[s,r]=n.useState(!1),i=n.useMemo((()=>!a&&!s),[a,s]),[o]=(0,j.Nt)(),l=i?0:o;if(!1===a)return null;const d=e=>{"success"===e&&r(!0)},u=1===t.length?872:428,p=428/1.5;return(0,c.jsx)("div",{className:ec(null),style:{display:i?"none":void 0},children:(0,c.jsx)("div",{className:ec("charts"),children:t.map(((t,a)=>(0,c.jsx)(Gi,{database:e,metrics:t.metrics,chartOptions:t.options,autorefresh:l,width:u,height:p,onChartDataStatusChange:d,isChartVisible:!i,title:t.title},a)))})})};var ac=a(95109),nc=a(86782),sc=a(15298),rc=a(40781);const ic=(0,l.cn)("tenant-overview");function oc({title:e,error:t,loading:a,tableClassNameModifiers:s={},withData:r,children:i}){return(0,c.jsxs)(n.Fragment,{children:[e&&(0,c.jsx)("div",{className:ic("title"),children:e}),t?(0,c.jsx)(F.o,{error:t}):null,(0,c.jsx)("div",{className:ic("table",s),children:t&&!r?null:a?(0,c.jsx)(pe.Q,{rows:f.Nz}):i})]})}function lc({database:e}){const[t]=(0,j.Nt)(),[a,n]=function(e){const t={...(0,ac.Nh)(e),width:void 0},a=[(0,ac.kv)(),(0,ac._E)(),t],n=a.map((e=>e.name));return[a,(0,rc.R)(n,nc.fN)]}({database:e}),{currentData:s,isFetching:r,error:i}=sc.s.useGetNodesQuery({tenant:e,type:"any",sort:"-CPU",limit:f.Nz,tablets:!1,fieldsRequired:n},{pollingInterval:t}),o=r&&void 0===s,l=(null===s||void 0===s?void 0:s.nodes)||[];return(0,c.jsx)(oc,{loading:o,error:i,withData:Boolean(s),children:(0,c.jsx)(ue.l,{columnsWidthLSKey:nc.zO,data:l,columns:a,emptyDataMessage:bi("top-nodes.empty-data"),settings:f.jp})})}function cc({database:e}){const[t]=(0,j.Nt)(),[a,n]=function(e){const t={...(0,ac.Nh)(e),width:void 0},a=[(0,ac.fR)(),(0,ac._E)(),t,(0,ac.Rn)()],n=a.map((e=>e.name));return[a,(0,rc.R)(n,nc.fN)]}({database:e}),{currentData:s,isFetching:r,error:i}=sc.s.useGetNodesQuery({tenant:e,type:"any",sort:"-LoadAverage",limit:f.Nz,tablets:!1,fieldsRequired:n},{pollingInterval:t}),o=r&&void 0===s,l=(null===s||void 0===s?void 0:s.nodes)||[];return(0,c.jsx)(oc,{loading:o,error:i,withData:Boolean(s),children:(0,c.jsx)(ue.l,{columnsWidthLSKey:nc.zO,data:l,columns:a,emptyDataMessage:bi("top-nodes.empty-data"),settings:f.jp})})}var dc=a(81240),uc=a(52065),pc=a(55929),hc=a(9873);const mc=JSON.parse('{"description_copy":"Copy link to clipboard","description_copied":"Copied to clipboard"}'),gc=(0,ge.g4)("ydb-copy-link-button",{en:mc}),vc=(0,l.cn)("ydb-copy-link-button"),yc=e=>{const{size:t="m",hasTooltip:a=!0,status:n,closeDelay:s,title:r,...i}=e,o=null!==r&&void 0!==r?r:gc("description_copy");return(0,c.jsx)(Oe.m,{title:"success"===n?gc("description_copied"):o,disabled:!a,closeDelay:s,children:(0,c.jsx)(ja.$,{view:"flat",size:t,...i,children:(0,c.jsx)(ja.$.Icon,{className:vc("icon"),children:(0,c.jsx)(Me.I,{data:pc.A,size:16})})})})};function xc(e){const{text:t,...a}=e,s=n.useRef(),[r,i]=n.useState(void 0),[o,l]=n.useState(!1),d=1200;n.useEffect((()=>window.clearTimeout(s.current)),[]);const u=n.useCallback((()=>{l(!1),i(d),window.clearTimeout(s.current),s.current=window.setTimeout((()=>{l(!0)}),1e3)}),[d]);return(0,c.jsx)(hc.$,{text:t,timeout:d,onCopy:u,children:e=>(0,c.jsx)(yc,{...a,closeDelay:r,hasTooltip:!o,status:e})})}var bc=a(48681);function fc({container:e,children:t,disablePortal:a}){const s=e;return a?(0,c.jsx)(n.Fragment,{children:t}):s?bc.createPortal(t,s):null}a(14221);const jc=(0,l.cn)("ydb-drawer"),Tc=({isVisible:e,onClose:t,children:a,drawerId:s="drawer",storageKey:r="drawer-width",defaultWidth:i,direction:o="right",className:l,detectClickOutside:d=!1,isPercentageWidth:u,hideVeil:p=!0})=>{const[h,m]=n.useState((()=>{const e=localStorage.getItem(r);return(0,$r.kf)(e)?Number(e):i})),g=n.useRef(null),{containerWidth:v,itemContainerRef:y}=(0,P.g)(),x=n.useMemo((()=>u&&v>0?Math.round(v*(h||60)/100):h||600),[v,u,h]);n.useEffect((()=>{if(!d)return;const a=a=>{!a._capturedInsideDrawer&&a.isTrusted&&e&&g.current&&!g.current.contains(a.target)&&t()};return document.addEventListener("click",a),()=>{document.removeEventListener("click",a)}}),[e,t,d]);const b=null===y||void 0===y?void 0:y.current;return b?(0,c.jsx)(fc,{container:b,children:(0,c.jsx)(uc.f,{onEscape:t,onVeilClick:t,hideVeil:p,className:jc("container",l),children:(0,c.jsx)(uc.D,{id:s,visible:e,resizable:!0,maxResizeWidth:v,width:u?x:h,onResize:e=>{if(u&&v>0){const t=Math.round(e/v*100);m(t),localStorage.setItem(r,t.toString())}else m(e),localStorage.setItem(r,e.toString())},direction:o,className:jc("item"),ref:d?g:void 0,children:(0,c.jsx)("div",{className:jc("click-handler"),onClickCapture:e=>{e.nativeEvent._capturedInsideDrawer=!0},children:a})})})}):null},Sc=({children:e,renderDrawerContent:t,isDrawerVisible:a,onCloseDrawer:s,drawerId:r,storageKey:i,defaultWidth:o,direction:l,className:d,detectClickOutside:u,isPercentageWidth:p,drawerControls:h=[],title:m,headerClassName:g,hideVeil:v})=>{n.useEffect((()=>()=>{s()}),[s]);return(0,c.jsxs)(n.Fragment,{children:[e,(0,c.jsx)(Tc,{hideVeil:v,isVisible:a,onClose:s,drawerId:r,storageKey:i,defaultWidth:o,direction:l,className:d,detectClickOutside:u,isPercentageWidth:p,children:a?(0,c.jsxs)("div",{className:jc("content-wrapper"),children:[(()=>{const e=[];for(const t of h)switch(t.type){case"close":e.push((0,c.jsx)(Oe.m,{title:"Close",children:(0,c.jsx)(ja.$,{view:"flat",onClick:s,children:(0,c.jsx)(Me.I,{data:dc.A,size:16})})},"close"));break;case"copyLink":e.push((0,c.jsx)(xc,{text:t.link},"copyLink"));break;case"custom":e.push((0,c.jsx)(n.Fragment,{children:t.node},t.key))}return(0,c.jsxs)(ke.s,{justifyContent:"space-between",alignItems:"center",className:jc("header-wrapper",g),children:[(0,c.jsx)(Re.E,{variant:"subheader-2",children:m}),(0,c.jsx)(ke.s,{className:jc("controls"),children:e})]})})(),t()]}):null})]})};var wc=a(73289),Ec=a(70206),_c=a.n(Ec);const Nc=e=>(_c().str(e)>>>0).toString(16).toUpperCase().padStart(8,"0"),Cc={...f.N3,dynamicRenderType:"simple"},Pc=JSON.parse('{"cpu-time":"CPU Time","read-rows":"Read Rows","read-bytes":"Read Bytes","query-hash":"Query Hash","user":"User","start-time":"Start time","end-time":"End time","duration":"Duration","query-text":"Query text","application":"Application","request-units":"Request Units"}'),Ic=(0,ge.g4)("ydb-top-queries-columns",{en:Pc}),Ac={...Cc,disableSortReset:!0,externalSort:!0,dynamicRenderType:"uniform"};function Dc(e){const t=[];var a,n;(e.QueryText&&t.push({label:Ic("query-hash"),value:Nc(String(e.QueryText))}),void 0!==e.CPUTimeUs)&&t.push({label:Ic("cpu-time"),value:(0,He.Xo)((0,He.Jc)(null!==(a=e.CPUTimeUs)&&void 0!==a?a:void 0))});void 0!==e.Duration&&t.push({label:Ic("duration"),value:(0,He.Xo)((0,He.Jc)(null!==(n=e.Duration)&&void 0!==n?n:void 0))});return void 0!==e.ReadBytes&&t.push({label:Ic("read-bytes"),value:(0,U.ZV)(e.ReadBytes)}),void 0!==e.RequestUnits&&t.push({label:Ic("request-units"),value:(0,U.ZV)(e.RequestUnits)}),e.EndTime&&t.push({label:Ic("end-time"),value:(0,U.r6)(new Date(e.EndTime).getTime())}),void 0!==e.ReadRows&&t.push({label:Ic("read-rows"),value:(0,U.ZV)(e.ReadRows)}),e.UserSID&&t.push({label:Ic("user"),value:e.UserSID}),e.ApplicationName&&t.push({label:Ic("application"),value:e.ApplicationName}),e.QueryStartAt&&t.push({label:Ic("start-time"),value:(0,U.r6)(new Date(e.QueryStartAt).getTime())}),t}const Rc=JSON.parse('{"no-data":"No data","filter.text.placeholder":"Search by query text or userSID...","mode_top":"Top","mode_running":"Running","timeframe_hour":"Per hour","timeframe_minute":"Per minute","query-details.title":"Query","query-details.open-in-editor":"Open in Editor","query-details.close":"Close","query-details.query.title":"Query Text","query-details.not-found.title":"Not found","query-details.not-found.description":"This query no longer exists"}'),kc=(0,ge.g4)("ydb-diagnostics-top-queries",{en:Rc});var Oc;function Mc(){return Mc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Mc.apply(null,arguments)}const Fc=function(e){return n.createElement("svg",Mc({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100"},e),Oc||(Oc=n.createElement("g",{fill:"none",fillRule:"evenodd"},n.createElement("g",{fill:"currentColor",fillRule:"nonzero"},n.createElement("path",{d:"M72.844 36.587a1 1 0 011.414.017c2.607 2.67 4.53 5.866 5.672 9.573C84.845 62.124 74.557 73 50 73S15.155 62.124 20.07 46.177c1.122-3.641 2.998-6.79 5.535-9.432a1 1 0 011.442 1.386c-2.323 2.418-4.036 5.296-5.066 8.635C17.502 61.297 26.681 71 50 71s32.498-9.703 28.019-24.234c-1.048-3.4-2.805-6.32-5.192-8.765a1 1 0 01.017-1.414z"}),n.createElement("path",{d:"M84.876 52.008a1 1 0 01.363 1.963l-.115.021-8 1a1 1 0 01-.363-1.963l.115-.021 8-1zm-8.838 5.717a1 1 0 011.123-.712l.114.025 7 2a1 1 0 01-.436 1.95l-.114-.026-7-2a1 1 0 01-.687-1.237zM15.128 52.008a1 1 0 00-.37 1.962l.114.022 7.733 1a1 1 0 00.371-1.962l-.115-.022-7.733-1zM23.425 57.715a1 1 0 00-1.13-.7l-.114.026-6.732 2a1 1 0 00.455 1.944l.114-.026 6.733-2a1 1 0 00.674-1.244zM69.857 19.01a1 1 0 01.951.401c3.511 4.821 4.55 11.746 3.18 20.74a1 1 0 11-1.977-.302c1.241-8.148.416-14.366-2.42-18.683l-.051-.075-.093.018c-4.025.803-7.448 3.451-10.29 8.011l-.243.396a1 1 0 01-1.074.46C54.91 29.324 52.296 29 50 29c-2.296 0-4.91.324-7.84.976a1 1 0 01-1.074-.46c-2.807-4.666-6.193-7.42-10.18-8.331l-.447-.094-.05.075c-2.771 4.219-3.623 10.253-2.502 18.13l.082.553a1 1 0 11-1.978.302c-1.37-8.994-.33-15.919 3.18-20.74a1 1 0 01.952-.4c4.84.7 8.902 3.617 12.161 8.678l.117.184.6-.12c2.338-.46 4.488-.71 6.449-.748L50 27c2.102 0 4.428.251 6.98.753l.598.12.118-.184c3.176-4.931 7.114-7.827 11.79-8.62l.37-.059z"})),n.createElement("path",{fill:"currentColor",fillRule:"nonzero",d:"M36.744 52.332l.185.21a30.417 30.417 0 011.891 2.432c.47.674.88 1.33 1.216 1.96.617 1.158.964 2.185.964 3.09C41 62.774 38.76 65 36 65s-5-2.226-5-4.976c0-.905.347-1.932.964-3.09.336-.63.746-1.286 1.216-1.959a30.417 30.417 0 012.076-2.643 1 1 0 011.488 0zM36 54.552c-.404.5-.804 1.028-1.18 1.567a17.597 17.597 0 00-1.09 1.756c-.478.894-.73 1.641-.73 2.15C33 61.665 34.342 63 36 63s3-1.334 3-2.976c0-.508-.252-1.255-.73-2.15a17.597 17.597 0 00-1.09-1.755A28.101 28.101 0 0036 54.552zm10.769 10.087a1 1 0 11-1.538-1.278C46.473 61.868 48.172 61 50 61c1.828 0 3.527.868 4.769 2.36a1 1 0 11-1.538 1.28C52.355 63.585 51.208 63 50 63c-1.208 0-2.355.586-3.231 1.64zm-15.114-14a1 1 0 01.69-1.878c.724.266 1.587.413 2.495.413 1.456 0 2.775-.38 3.557-.972a1 1 0 111.206 1.596c-1.156.874-2.897 1.376-4.763 1.376-1.14 0-2.235-.186-3.185-.536zm28.742-.841a1 1 0 111.206-1.596c.782.592 2.101.972 3.558.972.908 0 1.77-.147 2.494-.413a1 1 0 11.69 1.877c-.95.35-2.045.536-3.184.536-1.867 0-3.608-.502-4.764-1.376z"}))))},Lc=(0,l.cn)("kv-top-queries"),qc=({onClose:e})=>(0,c.jsxs)(ke.s,{justifyContent:"center",alignItems:"center",direction:"column",className:Lc("not-found-container"),children:[(0,c.jsx)(Me.I,{data:Fc,size:100}),(0,c.jsx)(Re.E,{variant:"subheader-2",className:Lc("not-found-title"),children:kc("query-details.not-found.title")}),(0,c.jsx)(Re.E,{variant:"body-1",color:"complementary",className:Lc("not-found-description"),children:kc("query-details.not-found.description")}),(0,c.jsx)(ja.$,{size:"m",view:"normal",className:Lc("not-found-close"),onClick:e,children:kc("query-details.close")})]});var zc=a(968);const Uc=(0,l.cn)("ydb-query-details"),Qc=({queryText:e,infoItems:t,onOpenInEditor:a})=>(0,c.jsx)(ke.s,{direction:"column",className:Uc(),children:(0,c.jsxs)(ke.s,{direction:"column",className:Uc("content"),children:[(0,c.jsx)(xs.z_,{info:t}),(0,c.jsxs)("div",{className:Uc("query-content"),children:[(0,c.jsxs)("div",{className:Uc("query-header"),children:[(0,c.jsx)("div",{className:Uc("query-title"),children:kc("query-details.query.title")}),(0,c.jsxs)(ja.$,{view:"flat-secondary",size:"m",onClick:a,className:Uc("editor-button"),children:[(0,c.jsx)(Me.I,{data:zc.A,size:16}),kc("query-details.open-in-editor")]})]}),(0,c.jsx)(dr.YDBSyntaxHighlighter,{language:"yql",text:e,withClipboardButton:{alwaysVisible:!0,withLabel:!1}})]})]})}),Gc=({row:e,onClose:t})=>{const a=(0,j.YQ)(),s=(0,ar.zy)(),r=(0,ar.W6)(),i=n.useCallback((()=>{if(e){const t=e.QueryText;a((0,wc.iZ)({input:t})),a((0,wc.Xb)(!1));const n=(0,B.mA)(s),i=(0,B.YL)({...n,[E.Dt]:E.Dg.query,[Rn.vh.queryTab]:E.tQ.newQuery});r.push(i)}}),[a,r,s,e]);return e?(0,c.jsx)(Qc,{queryText:e.QueryText,infoItems:Dc(e),onOpenInEditor:i}):(0,c.jsx)(qc,{onClose:t})},Bc=(0,l.cn)("kv-top-queries");function $c({columns:e,data:t,loading:a,onRowClick:s,columnsWidthLSKey:r,emptyDataMessage:i,sortOrder:o,onSort:l,selectedRow:d,onSelectedRowChange:u,drawerControls:p,drawerId:h="query-details",storageKey:m="kv-top-queries-drawer-width",tableSettings:g=Ac}){const[v,y]=n.useState(void 0),x=void 0===d?v:d,b=u||y,f=n.useCallback((()=>{b(void 0)}),[b]),j=void 0!==x,T=n.useCallback(((e,t,a)=>{null===a||void 0===a||a.stopPropagation(),b(e),null===s||void 0===s||s(e,t,a)}),[s,b]),S=n.useCallback((()=>(0,c.jsx)(Gc,{row:x,onClose:f})),[x,f]),w=n.useMemo((()=>[{type:"close"}]),[]),E=p||w;return(0,c.jsx)(Sc,{isDrawerVisible:j,onCloseDrawer:f,renderDrawerContent:S,drawerId:h,storageKey:m,detectClickOutside:!0,isPercentageWidth:!0,title:kc("query-details.title"),drawerControls:E,children:(0,c.jsx)(ue.l,{emptyDataMessage:i||kc("no-data"),columnsWidthLSKey:r,columns:e,data:t,isFetching:a,settings:g,onRowClick:T,rowClassName:e=>Bc("row",{active:(0,Xe.isEqual)(e,x)}),sortOrder:o,onSort:l})})}const Hc=(0,l.cn)("ydb-fixed-height-query"),Vc=({value:e="",lines:t=4,hasClipboardButton:a,clipboardButtonAlwaysVisible:n,mode:s="fixed"})=>{const r=20*t+0+"px",i=e.replace(/^(\s*\n)+/,""),o="fixed"===s?{height:r}:{maxHeight:r};return(0,c.jsx)("div",{className:Hc(),style:{...o,"--line-clamp":t},children:(0,c.jsx)(dr.YDBSyntaxHighlighter,{language:"yql",text:i,withClipboardButton:a?{alwaysVisible:n,copyText:e,withLabel:!1,size:"xs"}:void 0})})},Wc="topQueriesColumnsWidth",Jc="CPUTime",Kc="QueryText",Yc="EndTime",Zc="ReadRows",Xc="ReadBytes",ed="UserSID",td="QueryHash",ad="Duration",nd="QueryStartAt",sd="ApplicationName",rd="RequestUnits",id=["QueryHash","CPUTime","QueryText","EndTime","Duration","ReadRows","ReadBytes","RequestUnits","UserSID"],od=["CPUTime","QueryText"],ld=["QueryHash","UserSID","QueryStartAt","QueryText","ApplicationName"],cd=["QueryStartAt","QueryText"],dd={get CPUTime(){return Ic("cpu-time")},get QueryText(){return Ic("query-text")},get EndTime(){return Ic("end-time")},get ReadRows(){return Ic("read-rows")},get ReadBytes(){return Ic("read-bytes")},get UserSID(){return Ic("user")},get OneLineQueryText(){return Ic("query-text")},get QueryHash(){return Ic("query-hash")},get Duration(){return Ic("duration")},get QueryStartAt(){return Ic("start-time")},get ApplicationName(){return Ic("application")},get RequestUnits(){return Ic("request-units")}},ud={CPUTime:"CPUTimeUs",QueryText:void 0,EndTime:void 0,ReadRows:void 0,ReadBytes:"ReadBytes",UserSID:void 0,OneLineQueryText:void 0,QueryHash:void 0,Duration:"Duration",QueryStartAt:void 0,ApplicationName:void 0,RequestUnits:"RequestUnits"},pd={CPUTime:void 0,QueryText:void 0,EndTime:void 0,ReadRows:void 0,ReadBytes:void 0,UserSID:"UserSID",OneLineQueryText:void 0,QueryHash:void 0,Duration:void 0,QueryStartAt:"QueryStartAt",ApplicationName:"ApplicationName",RequestUnits:void 0};function hd(e){return ud[e]}function md(e){return pd[e]}const gd=(0,l.cn)("kv-top-queries"),vd={name:Jc,header:dd.CPUTime,render:({row:e})=>{var t;return(0,He.Xo)((0,He.Jc)(null!==(t=e.CPUTimeUs)&&void 0!==t?t:void 0))},width:120,align:Ht.Ay.RIGHT},yd={name:Kc,header:dd.QueryText,render:({row:e})=>{var t;return(0,c.jsx)("div",{className:gd("query"),children:(0,c.jsx)(Vc,{value:null===(t=e.QueryText)||void 0===t?void 0:t.toString(),lines:3,hasClipboardButton:!0})})},width:500},xd={name:Kc,header:dd.QueryText,render:({row:e})=>{var t;return(0,c.jsx)("div",{className:gd("query"),children:(0,c.jsx)(Vc,{value:null===(t=e.QueryText)||void 0===t?void 0:t.toString(),lines:6,hasClipboardButton:!0,mode:"max"})})},width:500},bd={name:Yc,header:dd.EndTime,render:({row:e})=>(0,U.r6)(new Date(e.EndTime).getTime()),align:Ht.Ay.RIGHT,width:200},fd={name:Zc,header:dd.ReadRows,render:({row:e})=>(0,U.ZV)(e.ReadRows),align:Ht.Ay.RIGHT,width:150},jd={name:Xc,header:dd.ReadBytes,render:({row:e})=>(0,U.ZV)(e.ReadBytes),align:Ht.Ay.RIGHT,width:150},Td={name:ed,header:dd.UserSID,render:({row:e})=>(0,c.jsx)("div",{className:gd("user-sid"),children:e.UserSID||Dn.EMPTY_DATA_PLACEHOLDER}),align:Ht.Ay.LEFT,width:120},Sd={name:td,header:dd.QueryHash,render:({row:e})=>Nc(String(e.QueryText)),width:130},wd={name:ad,header:dd.Duration,render:({row:e})=>{var t;return(0,He.Xo)((0,He.Jc)(null!==(t=e.Duration)&&void 0!==t?t:void 0))},align:Ht.Ay.RIGHT,width:150},Ed={name:nd,header:dd.QueryStartAt,render:({row:e})=>(0,U.r6)(new Date(e.QueryStartAt).getTime()),resizeable:!1,width:160},_d={name:rd,header:dd.RequestUnits,render:({row:e})=>(0,U.ZV)(e.RequestUnits),align:Ht.Ay.RIGHT,width:150},Nd={name:sd,header:dd.ApplicationName,render:({row:e})=>(0,c.jsx)("div",{className:gd("user-sid"),children:e.ApplicationName||Dn.EMPTY_DATA_PLACEHOLDER})};const Cd={encode:e=>{if(void 0!==e&&null!==e&&Array.isArray(e))return encodeURIComponent(JSON.stringify(e))},decode:e=>{if("string"!==typeof e||!e)return[];try{return JSON.parse(decodeURIComponent(e))}catch{return[]}}};function Pd(e){const{paramName:t,schema:a,defaultSort:s}=e,[r,i]=(0,et.useQueryParam)(t,Cd);return{sortParam:n.useMemo((()=>{if(!r||!Array.isArray(r)||0===r.length)return[s];const e=r.filter((e=>{try{return a.parse(e.columnId),!0}catch{return!1}}));return e.length?e:[s]}),[r,a,s]),updateSortParam:n.useCallback((e=>{i(e||[],"replaceIn")}),[i])}}const Id=tt.z.enum([Jc,ad,Zc,Xc,Kc]).catch(Jc),Ad={columnId:Jc,order:Ht.Ay.DESCENDING};function Dd(){var e,t;const{sortParam:a,updateSortParam:s}=Pd({paramName:"topSort",schema:Id,defaultSort:Ad}),[r,i]=(0,j.GY)({initialSortColumn:(null===a||void 0===a||null===(e=a[0])||void 0===e?void 0:e.columnId)||Ad.columnId,initialSortOrder:(null===a||void 0===a||null===(t=a[0])||void 0===t?void 0:t.order)||Ad.order,multiple:!0,fixedOrderType:Ht.Ay.DESCENDING,onSort:s});return{tableSort:r,handleTableSort:i,backendSort:n.useMemo((()=>(0,j.JN)(r,hd)),[r])}}const Rd=[Sd,xd,vd];function kd({database:e}){var t,a;const[n]=(0,j.Nt)(),{backendSort:s}=Dd(),{currentData:r,isFetching:i,error:o}=to.Ke.useGetTopQueriesQuery({database:e,timeFrame:"hour",limit:f.Nz,sortOrder:s},{pollingInterval:n}),l=i&&void 0===r,d=(null===r||void 0===r||null===(t=r.resultSets)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.result)||[];return(0,c.jsx)(oc,{loading:l,error:(0,ht.Cb)(o),withData:Boolean(r),children:(0,c.jsx)($c,{columnsWidthLSKey:Wc,data:d,columns:Rd,tableSettings:f.jp,drawerId:"tenant-overview-query-details",storageKey:"tenant-overview-queries-drawer-width"})})}var Od=a(34271),Md=a(42972);function Fd(e,t){return(0,Md.Q7)({databaseFullPath:t,path:e,selectFields:["Path","TabletId","CPUCores"],sortOrder:[{columnId:"CPUCores",order:-1}],limit:f.Nz})}const Ld=g.F.injectEndpoints({endpoints:e=>({getTopShards:e.query({queryFn:async({database:e,databaseFullPath:t},{signal:a})=>{try{const n=await window.api.viewer.sendQuery({query:Fd(t,t),database:e,action:"execute-scan",internal_call:!0},{signal:a,withRetries:!0});return(0,ht.We)(n)?{error:n}:{data:(0,ht.fW)(n)}}catch(n){return{error:n||new Error("Unauthorized")}}},providesTags:["All"]})}),overrideExisting:"throw"}),qd=["TabletId","Path","CPUCores"],zd=({database:e,databaseFullPath:t})=>{var a,n;const s=(0,Od.x)("ShardsTable"),[r]=(0,j.Nt)(),{currentData:i,isFetching:o,error:l}=Ld.useGetTopShardsQuery({database:e,databaseFullPath:t},{pollingInterval:r}),d=o&&void 0===i,u=(null===i||void 0===i||null===(a=i.resultSets)||void 0===a||null===(n=a[0])||void 0===n?void 0:n.result)||[];return(0,c.jsx)(oc,{loading:d,error:(0,ht.Cb)(l),withData:Boolean(i),children:(0,c.jsx)(s,{data:u,databaseFullPath:t,columnsIds:qd,settings:f.jp})})},Ud=[{title:bi("charts.cpu-usage"),metrics:["IC","IO","Batch","User","System"].map((e=>({target:`resources.cpu.${e}.usage`,title:e}))),options:{dataType:"percent",scaleRange:{min:0,max:1},showLegend:!0}}];function Qd({database:e,databaseType:t,databaseFullPath:a}){const s=(0,j.YQ)(),r=Vl(),i=r(E.iJ.nodes),o=r(E.iJ.topShards),l=r(E.iJ.topQueries),d="Serverless"===t;return(0,c.jsxs)(ke.s,{direction:"column",gap:4,children:[!d&&(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(tc,{database:e,charts:Ud}),(0,c.jsx)(Xl,{allEntitiesLink:i,title:bi("title_top-nodes-load"),children:(0,c.jsx)(cc,{database:e})}),(0,c.jsx)(Xl,{title:bi("title_top-nodes-pool"),allEntitiesLink:i,children:(0,c.jsx)(lc,{database:e})})]}),(0,c.jsx)(Xl,{title:bi("title_top-shards"),allEntitiesLink:o,children:(0,c.jsx)(zd,{database:e,databaseFullPath:a})}),(0,c.jsx)(Xl,{title:bi("title_top-queries"),allEntitiesLink:l,onAllEntitiesClick:()=>s((0,to.TX)({from:void 0,to:void 0})),children:(0,c.jsx)(kd,{database:e})})]})}var Gd=a(18863),Bd=a(96344);const $d={en:JSON.parse('{"alert_no-data":"No data","context_capacity-usage":"{{value}} of {{capacity}}"}')},Hd=(0,ge.g4)("progress-wrapper",$d),Vd=100;function Wd(e,t,a){return a<=0?String(e):Hd("context_capacity-usage",{value:e,capacity:t})}function Jd(e,t,a){if(a){const n=a(Number(e),Number(t));return[n[0],n[1]]}return[e,t]}function Kd({children:e,displayText:t,withCapacityUsage:a=!1,className:n,width:s}){const r=function(e){const t="full"===e,a=t?0:Math.max(0,e||400);return{width:t?"100%":`${a}px`,flex:t?"1":"none"}}(s);return(0,c.jsxs)(ke.s,{alignItems:"center",gap:"2",className:n,children:[(0,c.jsx)("div",{style:r,children:e}),a&&t&&(0,c.jsx)(Re.E,{variant:"body-1",color:"secondary",children:t})]})}function Yd({value:e,capacity:t,formatValues:a=Mo.g,className:s,width:r,size:i="s",withCapacityUsage:o=!1}){const l=(0,$r.y3)(e),d=(0,$r.y3)(t),u=function(e,t){const a=t>0?Math.floor(e/t*Vd):Vd,n=Math.max(0,a);return Math.min(n,Vd)}(l,d),[p,h]=n.useMemo((()=>Jd(e,t,a)),[a,e,t]),m=n.useMemo((()=>Wd(p,h,d)),[p,h,d]);return g=e,(0,$r.kf)(g)&&(0,$r.y3)(g)>=0?(0,c.jsx)(Kd,{displayText:m,withCapacityUsage:o,className:s,width:r,children:(0,c.jsx)(Bd.k,{value:u,theme:"success",size:i})}):(0,c.jsx)("div",{className:s,children:Hd("alert_no-data")});var g}var Zd=a(90327);function Xd({stack:e,totalCapacity:t,formatValues:a=Mo.g,className:s,width:r,size:i="s",withCapacityUsage:o=!1}){const l=n.useMemo((()=>e.filter((e=>!e.isInfo&&e.value>0))),[e]),d=n.useMemo((()=>l.reduce(((e,t)=>e+t.value),0)),[l]),u=n.useMemo((()=>(0,$r.y3)(t)),[t]),p=u||d,h=n.useMemo((()=>l.map((e=>({value:p>0?e.value/p*Vd:0,color:(0,Zd.AB)(e.key),title:e.label})))),[l,p]),[m,g]=n.useMemo((()=>Jd(d,u||d,a)),[a,d,u]),v=n.useMemo((()=>Wd(m,g,u||0)),[m,g,u]);return 0===l.length?(0,c.jsx)("div",{className:s,children:Hd("alert_no-data")}):(0,c.jsx)(Kd,{displayText:v,withCapacityUsage:o,className:s,width:r,children:(0,c.jsx)(Bd.k,{value:Vd,stack:h,size:i})})}function eu(e){return"stack"in e&&e.stack?(0,c.jsx)(Xd,{...e}):(0,c.jsx)(Yd,{...e})}var tu=a(27662);const au=(0,l.cn)("memory-details");function nu({segments:e,className:t}){return(0,c.jsx)(Qs.u,{nameMaxWidth:200,responsive:!0,className:t,children:e.map((e=>{const t=(0,Zd.AB)(e.key),[a,n]=(0,U.vX)(e.value,e.capacity),s=e.capacity?Hd("context_capacity-usage",{value:a,capacity:n}):a,r=e.capacity?e.value/e.capacity*100:100,i={"--g-progress-filled-background-color":t};return(0,c.jsx)(Qs.u.Item,{name:(0,c.jsxs)(ke.s,{alignItems:"center",gap:"1",children:[(0,c.jsx)("div",{className:au("segment-indicator"),style:{backgroundColor:t}}),(0,c.jsx)(Re.E,{variant:"body-1",color:"secondary",children:e.label})]}),children:(0,c.jsxs)(ke.s,{alignItems:"center",gap:"3",children:[(0,c.jsx)("div",{className:au("segment-progress"),children:(0,c.jsx)("div",{style:i,children:(0,c.jsx)(Bd.k,{value:r,size:"s",className:au("progress-bar")})})}),(0,c.jsx)(Re.E,{variant:"body-1",color:"secondary",children:s})]})},e.key)}))})}const su=(0,l.cn)("memory-details");function ru({memoryStats:e}){const t=n.useMemo((()=>void 0===e.AnonRss?(0,$r.y3)(e.AllocatedMemory)+(0,$r.y3)(e.AllocatorCachesMemory):(0,$r.y3)(e.AnonRss)),[e.AnonRss,e.AllocatedMemory,e.AllocatorCachesMemory]),a=n.useMemo((()=>(0,Zd.Sb)(e,t)),[e,t]),s=n.useMemo((()=>a.filter((e=>!e.isInfo&&e.value>0))),[a]),r=n.useCallback(((e,t)=>(0,U.vX)(e,t)),[]);return(0,c.jsxs)(ke.s,{direction:"column",alignItems:"flex-start",gap:"3",children:[(0,c.jsx)("div",{className:su("header"),children:(0,c.jsx)(Re.E,{variant:"body-1",className:su("title"),children:(0,tu.A)("text_memory-details")})}),(0,c.jsxs)(ke.s,{direction:"column",alignItems:"flex-start",gap:"4",width:"100%",children:[(0,c.jsx)("div",{className:su("main-progress"),children:(0,c.jsx)(eu,{stack:a,totalCapacity:e.HardLimit,formatValues:r,className:su("main-progress-bar"),size:"m",width:"full"})}),(0,c.jsx)(nu,{segments:s,className:su("memory-segments-list")})]})]})}function iu({database:e}){const[t]=(0,j.Nt)(),[a,n]=function(e){const t=[(0,ac._E)(),(0,ac.Nh)(e),(0,ac.jl)(),(0,ac.fR)(),(0,ac.iX)(),(0,ac.oz)(),(0,ac.qp)(e)],a=t.map((e=>e.name));return[t,(0,rc.R)(a,nc.fN)]}({database:e}),{currentData:s,isFetching:r,error:i}=sc.s.useGetNodesQuery({tenant:e,type:"any",tablets:!0,sort:"-Memory",limit:f.Nz,fieldsRequired:n},{pollingInterval:t}),o=r&&void 0===s,l=(null===s||void 0===s?void 0:s.nodes)||[];return(0,c.jsx)(oc,{loading:o,error:i,withData:Boolean(s),children:(0,c.jsx)(ue.l,{columnsWidthLSKey:nc.zO,data:l,columns:a,emptyDataMessage:bi("top-nodes.empty-data"),settings:f.jp})})}const ou=[{title:bi("charts.memory-usage"),metrics:[{target:"resources.memory.used_bytes",title:bi("charts.memory-usage")}],options:{dataType:"size"}}],lu=(0,l.cn)("tenant-memory");function cu({database:e,memoryStats:t,memoryUsed:a,memoryLimit:n}){const s=(0,j.e4)();return(0,c.jsxs)("div",{className:lu(),children:[(0,c.jsx)(tc,{database:e,charts:ou}),t?(0,c.jsx)(ru,{memoryStats:t}):(0,c.jsx)(Gd.z,{variant:"small",title:bi("title_memory-details"),info:[{label:bi("field_memory-usage"),value:(0,c.jsx)(eu,{value:a,capacity:n,formatValues:U.vX,withCapacityUsage:!0,className:lu("fallback-progress-wrapper"),size:"m",width:400})}]}),(0,c.jsx)(Xl,{title:bi("title_top-nodes-by-memory"),allEntitiesLink:(0,B.YL)({...s,[Rn.vh.diagnosticsTab]:E.iJ.nodes}),children:(0,c.jsx)(iu,{database:e})})]})}function du({database:e}){const[t]=(0,j.Nt)(),[a,n]=function(e){const t=[(0,ac._E)(),(0,ac.b8)(e),(0,ac.jl)(),(0,ac.wN)()],a=t.map((e=>e.name)),n=(0,rc.R)(a,nc.fN);return[t.map((e=>({...e,sortable:!1}))),n]}({database:e}),{currentData:s,isFetching:r,error:i}=sc.s.useGetNodesQuery({tenant:e,type:"any",sort:"-PingTime",limit:f.Nz,tablets:!1,fieldsRequired:n},{pollingInterval:t}),o=r&&void 0===s,l=(null===s||void 0===s?void 0:s.nodes)||[];return(0,c.jsx)(oc,{loading:o,error:i,withData:Boolean(s),children:(0,c.jsx)(ue.l,{columnsWidthLSKey:nc.zO,data:l,columns:a,emptyDataMessage:bi("top-nodes.empty-data"),settings:f.jp})})}function uu({database:e}){const[t]=(0,j.Nt)(),[a,n]=function(e){const t=[(0,ac._E)(),(0,ac.b8)(e),(0,ac.jl)(),(0,ac.pt)()],a=t.map((e=>e.name)),n=(0,rc.R)(a,nc.fN);return[t.map((e=>({...e,sortable:!1}))),n]}({database:e}),{currentData:s,isFetching:r,error:i}=sc.s.useGetNodesQuery({tenant:e,type:"any",sort:"-ClockSkew",limit:f.Nz,tablets:!1,fieldsRequired:n},{pollingInterval:t}),o=r&&void 0===s,l=(null===s||void 0===s?void 0:s.nodes)||[];return(0,c.jsx)(oc,{loading:o,error:i,withData:Boolean(s),children:(0,c.jsx)(ue.l,{columnsWidthLSKey:nc.zO,data:l,columns:a,emptyDataMessage:bi("top-nodes.empty-data"),settings:f.jp})})}const pu=(0,l.cn)("tenant-network");function hu({database:e}){const t=(0,j.e4)(),[a]=(0,j.iK)(Oo.GS.ENABLE_NETWORK_TABLE),n=a?{[Rn.vh.diagnosticsTab]:E.iJ.network}:{[Rn.vh.diagnosticsTab]:E.iJ.nodes},s=(0,B.YL)({...t,...n});return(0,c.jsxs)(ke.s,{direction:"column",gap:4,className:pu(),children:[(0,c.jsx)(Xl,{title:bi("title_nodes-by-ping"),allEntitiesLink:s,children:(0,c.jsx)(du,{database:e})}),(0,c.jsx)(Xl,{title:bi("title_nodes-by-skew"),allEntitiesLink:s,children:(0,c.jsx)(uu,{database:e})})]})}var mu=a(10174),gu=a(74006),vu=a(74319);function yu({tenant:e}){const t=(0,I.Pm)(),a=(0,I.YA)(),[n]=(0,j.Nt)(),[s,r]=function(){const e=(0,gu.k)(),t=e.map((e=>e.name));return[e,(0,rc.R)(t,vu.YX)]}(),{currentData:i,isFetching:o,error:l}=mu.S.useGetStorageGroupsInfoQuery({database:e,sort:"-Usage",with:"all",limit:f.Nz,shouldUseGroupsHandler:a,fieldsRequired:r},{pollingInterval:n,skip:!t}),d=o&&void 0===i,u=(null===i||void 0===i?void 0:i.groups)||[];return(0,c.jsx)(oc,{loading:d||!t,error:l,withData:Boolean(i),children:(0,c.jsx)(ue.l,{columnsWidthLSKey:vu.qK,data:u,columns:s,settings:f.jp})})}var xu=a(91135);const bu=g.F.injectEndpoints({endpoints:e=>({getTopTables:e.query({queryFn:async({database:e},{signal:t})=>{try{const a=await window.api.viewer.sendQuery({query:`${f.Zi}\nSELECT\n    Path, SUM(DataSize) as Size\nFROM \`.sys/partition_stats\`\nGROUP BY Path\nORDER BY Size DESC\nLIMIT ${f.Nz}\n`,database:e,action:"execute-scan",internal_call:!0},{signal:t,withRetries:!0});return(0,ht.We)(a)?{error:a}:{data:(0,ht.fW)(a)}}catch(a){return{error:a||"Unauthorized"}}},providesTags:["All"]})}),overrideExisting:"throw"});function fu({database:e}){var t,a;const[s]=(0,j.Nt)(),{currentData:r,error:i,isFetching:o}=bu.useGetTopTablesQuery({database:e},{pollingInterval:s}),l=o&&void 0===r,d=(null===r||void 0===r||null===(t=r.resultSets)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.result)||[],u=(0,hn.fn)(null!==d&&void 0!==d&&d.length?Number(d[0].Size):0),p=n.useMemo((()=>function(e){return[{name:"Size",width:100,render:({row:t})=>(0,hn.z3)({value:Number(t.Size),size:e,precision:1}),align:Ht.Ay.RIGHT},{name:"Path",width:700,render:({row:e})=>e.Path?(0,c.jsx)(Le.s,{content:e.Path,children:(0,c.jsx)(xu.I,{path:String(e.Path),children:e.Path})}):null}]}(u)),[u]);return(0,c.jsx)(oc,{loading:l,error:(0,ht.Cb)(i),withData:Boolean(r),children:(0,c.jsx)(ue.l,{columnsWidthLSKey:"topTablesTableColumnsWidth",data:d,columns:p,settings:f.jp})})}const ju=[{title:bi("charts.storage-usage"),metrics:[{target:"resources.storage.used_bytes",title:bi("charts.storage-usage")}],options:{dataType:"size"}}];function Tu({database:e,metrics:t,databaseType:a}){const{blobStorageUsed:n,tabletStorageUsed:s,blobStorageLimit:r,tabletStorageLimit:i}=t,o=(0,j.e4)(),l=[{label:(0,c.jsx)(On,{text:bi("storage.tablet-storage-title"),popoverContent:bi("storage.tablet-storage-description")}),value:(0,c.jsx)(eu,{value:s,capacity:i,formatValues:U.j9,withCapacityUsage:!0})},{label:(0,c.jsx)(On,{text:bi("storage.db-storage-title"),popoverContent:bi("storage.db-storage-description")}),value:(0,c.jsx)(eu,{value:n,capacity:r,formatValues:U.j9,withCapacityUsage:!0})}];return"Serverless"===a?(0,c.jsx)(ke.s,{direction:"column",gap:4,children:(0,c.jsx)(Xl,{title:bi("title_top-tables-by-size"),allEntitiesLink:(0,B.YL)({...o,[Rn.vh.diagnosticsTab]:E.iJ.storage}),children:(0,c.jsx)(fu,{database:e})})}):(0,c.jsxs)(ke.s,{direction:"column",gap:4,children:[(0,c.jsx)(tc,{database:e,charts:ju}),(0,c.jsx)(Gd.z,{variant:"small",title:bi("title_storage-details"),info:l}),(0,c.jsx)(Xl,{title:bi("title_top-tables-by-size"),children:(0,c.jsx)(fu,{database:e})}),(0,c.jsx)(Xl,{title:bi("title_top-groups-by-usage"),allEntitiesLink:(0,B.YL)({...o,[Rn.vh.diagnosticsTab]:E.iJ.storage}),children:(0,c.jsx)(yu,{tenant:e})})]})}function Su({database:e,databaseFullPath:t,additionalTenantProps:a}){var n,s;const{metricsTab:r}=(0,j.N4)((e=>e.tenant)),[o]=(0,j.Nt)(),l=(0,oo.H)(),d=(0,j.YQ)(),u=(0,I.$h)(),{currentData:p,isFetching:h}=x.z6.useGetTenantInfoQuery({database:e,clusterName:l,isMetaDatabasesAvailable:u},{pollingInterval:o}),m=h&&void 0===p,{Name:g,Type:y,Overall:b}=p||{},T="Serverless"===y,S=T&&r!==E.pA.cpu&&r!==E.pA.storage?E.pA.cpu:r,w=(_=y)&&_t[_];var _;const{currentData:N}=v.useGetOverviewQuery({path:t,database:e,databaseFullPath:t},{pollingInterval:o}),{Tables:C,Topics:P}=(null===N||void 0===N||null===(n=N.PathDescription)||void 0===n||null===(s=n.DomainDescription)||void 0===s?void 0:s.DiskSpaceUsage)||{},D=[null===C||void 0===C?void 0:C.TotalSize,null===P||void 0===P?void 0:P.DataSize].reduce(((e,t)=>t?e+Number(t):e),0),k={...p,Metrics:{...null===p||void 0===p?void 0:p.Metrics,Storage:String(D)}},{blobStorage:O,tabletStorage:M,blobStorageLimit:F,tabletStorageLimit:L,poolsStats:q,memoryStats:z,blobStorageStats:U,tabletStorageStats:Q,networkUtilization:G,networkThroughput:B}=(0,ro.uI)(k),$={blobStorageUsed:O,blobStorageLimit:F,tabletStorageUsed:M,tabletStorageLimit:L},H=(0,io.y)(a,g,y),{monitoring:V}=(0,A.Zd)(),W=(0,R.P)(null===p||void 0===p?void 0:p.ControlPlane,V);return(0,c.jsx)(i.r,{loading:m,children:(0,c.jsxs)("div",{className:ic(),children:[(0,c.jsxs)("div",{className:ic("info"),children:[(0,c.jsxs)(ke.s,{alignItems:"center",gap:"2",className:ic("top-label"),children:[w,W&&(0,c.jsxs)(ja.$,{view:"normal",onClick:()=>{d((0,x.es)(E.Dg.diagnostics)),d((0,x.WO)(E.iJ.monitoring))},children:[(0,c.jsx)(Me.I,{data:ri.A,size:16}),bi("action_open-monitoring")]})]}),(0,c.jsxs)(ke.s,{alignItems:"center",gap:"1",className:ic("top"),children:[(0,c.jsxs)(ke.s,{alignItems:"center",style:{overflow:"hidden"},children:[(0,c.jsx)(ii.c,{status:b,name:g||f.oK,withLeftTrim:!0,hasClipboardButton:Boolean(p),clipboardButtonAlwaysVisible:!0}),T?(0,c.jsx)("div",{className:ic("serverless-tag"),children:(0,c.jsx)(zt.J,{theme:"clear",size:"s",className:ic("serverless-tag-label"),children:(0,c.jsxs)(ke.s,{alignItems:"center",gap:"2",children:[bi("value_serverless"),(0,c.jsx)(kn.H,{iconSize:"s",className:ic("serverless-tag-tooltip"),children:bi("context_serverless-tooltip")})]})})}):null]}),H.length>0&&(0,c.jsx)(ke.s,{gap:"2",children:H.map((({title:e,url:t,icon:a})=>(0,c.jsx)(ja.$,{href:t,target:"_blank",size:"xs",title:e,children:(0,c.jsx)(Me.I,{data:a})},e)))})]}),(0,c.jsxs)(ke.s,{direction:"column",gap:4,children:[!T&&(0,c.jsx)(ko,{database:e}),(0,c.jsx)(so,{database:e}),(0,c.jsx)(ll,{poolsCpuStats:q,memoryStats:z,blobStorageStats:U,tabletStorageStats:Q,networkUtilization:G,networkThroughput:B,storageGroupsCount:k.StorageGroups?Number(k.StorageGroups):void 0,databaseType:y,activeTab:S})]})]}),(0,c.jsx)("div",{className:ic("tab-content"),children:(()=>{switch(S){case E.pA.cpu:return(0,c.jsx)(Qd,{database:e,databaseType:y,databaseFullPath:t});case E.pA.storage:return(0,c.jsx)(Tu,{database:e,metrics:$,databaseType:y});case E.pA.memory:return(0,c.jsx)(cu,{database:e,memoryUsed:k.MemoryUsed,memoryLimit:k.MemoryLimit,memoryStats:k.MemoryStats});case E.pA.network:return(0,c.jsx)(hu,{database:e});default:return null}})()})]})})}const wu=(0,l.cn)("kv-detailed-overview");const Eu=function({type:e,database:t,databaseFullPath:a,path:n,additionalTenantProps:s}){const r=a===n;return(0,c.jsx)("div",{className:wu(),children:r?(0,c.jsx)("div",{className:wu("section"),children:(0,c.jsx)(Su,{database:t,databaseFullPath:a,additionalTenantProps:s})}):(0,c.jsx)(si,{type:e,path:n,database:t,databaseFullPath:a})})};var _u=a(66212);const Nu=(0,l.cn)("kv-tenant-diagnostics");function Cu({id:e,title:t,linkPath:a,badge:n}){return(0,c.jsx)(_u.o,{value:e,children:(0,c.jsxs)(An.E,{to:a,as:"tab",children:[t,n&&(0,c.jsx)(zt.J,{className:Nu("tab-badge"),theme:n.theme,size:n.size,children:n.text})]})},e)}const Pu=g.F.injectEndpoints({endpoints:e=>({getHotKeys:e.query({queryFn:async({path:e,database:t,databaseFullPath:a},{signal:n})=>{try{var s;const r=await window.api.viewer.getHotKeys({path:{path:e,databaseFullPath:a},database:t,enableSampling:!0},{signal:n});if(Array.isArray(r.hotkeys))return{data:r.hotkeys};await Promise.race([new Promise((e=>{setTimeout(e,5e3)})),new Promise(((e,t)=>{n.addEventListener("abort",t)}))]);return{data:null!==(s=(await window.api.viewer.getHotKeys({path:{path:e,databaseFullPath:a},database:t,enableSampling:!1},{signal:n})).hotkeys)&&void 0!==s?s:null}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"}),Iu=JSON.parse('{"hot-keys-collecting":"Please wait a little while we are collecting hot keys samples...","no-data":"No information about hot keys","help":"Hot keys contains a list of table primary key values that are accessed most often. Sample is collected upon request to the tab during 5s time interval. Samples column indicates how many requests to the particular key value were registered during collection phase."}'),Au=(0,ge.g4)("ydb-hot-keys",{en:Iu});var Du;function Ru(){return Ru=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ru.apply(null,arguments)}const ku=function(e){return n.createElement("svg",Ru({viewBox:"0 0 12 7",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),Du||(Du=n.createElement("path",{d:"M8 7h3V5h1V2H6.66C6.085.79 4.86 0 3.5 0 1.57 0 0 1.57 0 3.5S1.57 7 3.5 7c1.36 0 2.59-.79 3.16-2H8v2zm2-1H9V4H5.97l-.115.335a2.5 2.5 0 110-1.67L5.97 3H11v1h-1v2zM3.5 5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zM3 3.5a.5.5 0 111 0 .5.5 0 01-1 0z"})))},Ou=(0,l.cn)("ydb-hot-keys"),Mu="accessSample";function Fu({path:e,database:t,databaseFullPath:a}){var s,r;const{currentData:i,isFetching:o,error:l}=Pu.useGetHotKeysQuery({path:e,database:t,databaseFullPath:a}),d=o&&void 0===i,[u]=(0,j.Nt)(),{currentData:p,isLoading:h}=v.useGetOverviewQuery({path:e,database:t,databaseFullPath:a},{pollingInterval:u}),m=null===p||void 0===p||null===(s=p.PathDescription)||void 0===s||null===(r=s.Table)||void 0===r?void 0:r.KeyColumnNames,g=n.useMemo((()=>((e=[])=>[...e.map(((e,t)=>({name:e,header:(0,c.jsxs)("div",{className:Ou("primary-key-column"),children:[(0,c.jsx)(Me.I,{data:ku,width:12,height:7}),e]}),render:({row:e})=>e.keyValues[t],align:Ht.Ay.RIGHT,sortable:!1}))),{name:Mu,header:"Samples",render:({row:e})=>e.accessSample,align:Ht.Ay.RIGHT,sortable:!1}])(m)),[m]);return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(Lu,{}),d||h?(0,c.jsx)("div",{children:Au("hot-keys-collecting")}):l?(0,c.jsx)(F.o,{error:l}):i?(0,c.jsx)(ue.l,{wrapperClassName:Ou("table"),columns:g,data:i,settings:f.N3,initialSortOrder:{columnId:Mu,order:Ht.Ay.DESCENDING}}):(0,c.jsx)("div",{children:Au("no-data")})]})}function Lu(){const[e,t]=(0,j.iK)(Oo.GS.IS_HOTKEYS_HELP_HIDDEN);return e?null:(0,c.jsxs)(Ma.Z,{theme:"info",view:"filled",type:"container",className:Ou("help-card"),children:[Au("help"),(0,c.jsx)(ja.$,{className:Ou("help-card__close-button"),view:"flat",onClick:()=>t(!0),children:(0,c.jsx)(Me.I,{data:dc.A,size:18})})]})}var qu=a(55340),zu=a(78321),Uu=a(63738),Qu=a(19280),Gu=a(32935);const Bu=g.F.injectEndpoints({endpoints:e=>({getNetworkInfo:e.query({queryFn:async({database:e,databaseFullPath:t},{signal:a})=>{try{return{data:await window.api.viewer.getNetwork({path:{path:t,databaseFullPath:t},database:e},{signal:a})}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});function $u(){const[{withProblems:e},t]=(0,et.useQueryParams)({withProblems:et.BooleanParam}),a=n.useCallback((e=>{t({withProblems:e||void 0},"replaceIn")}),[t]);return{withProblems:Boolean(e),handleWithProblemsChange:a}}const Hu=(0,l.cn)("node-network");function Vu(){}function Wu({nodeId:e,connected:t,capacity:a,rack:s,status:r,onClick:i=Vu,onMouseEnter:o=Vu,onMouseLeave:l=Vu,showID:d,isBlurred:u}){const p=n.useRef(null),h=r||function(e=0,t=0){const a=Math.floor(e/t*100);return 100===a?co.m.Green:a>=70?co.m.Yellow:a>=1?co.m.Red:co.m.Grey}(t,a);return(0,c.jsx)("div",{ref:p,className:Hu({[h.toLowerCase()]:!0,id:d,blur:u}),onMouseEnter:()=>{o(p.current,{nodeId:e,connected:t,capacity:a,rack:s},"node")},onMouseLeave:()=>{l()},onClick:()=>i(e),children:d?e:null})}const Ju=e=>null===e||void 0===e?void 0:e.reduce(((e,t)=>t.Connected?e+1:e),0);var Ku,Yu,Zu,Xu,ep,tp,ap,np,sp,rp,ip,op,lp,cp,dp;function up(){return up=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},up.apply(null,arguments)}const pp=function(e){return n.createElement("svg",up({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 221 204"},e),Ku||(Ku=n.createElement("path",{d:"M68.46 2.529v25.227c0 1.227.876 2.278 2.102 2.511 16.643 2.979 29.14 17.812 28.498 35.448-.642 18.045-15.359 32.703-33.345 33.403-17.636.643-32.41-11.854-35.448-28.44a2.562 2.562 0 00-2.51-2.102H2.528c-1.519 0-2.687 1.285-2.512 2.745 3.446 32.703 31.243 58.106 64.939 57.814 35.155-.292 63.829-29.024 64.121-64.18.292-33.695-25.17-61.492-57.873-64.938-1.46-.175-2.744.993-2.744 2.512z",fill:"#EBF2FA"})),Yu||(Yu=n.createElement("path",{d:"M22.736 18.354l17.811 17.812c.876.876 2.278.992 3.329.233 4.146-3.095 9.052-5.197 14.366-6.19 1.226-.233 2.102-1.226 2.102-2.511V2.528a2.502 2.502 0 00-2.803-2.51C44.46 1.418 32.488 6.674 22.91 14.674c-1.168.935-1.226 2.628-.175 3.68zm-9.403 6.133C6.093 33.83 1.303 45.16.02 57.54c-.176 1.46 1.05 2.745 2.51 2.745H27.7a2.562 2.562 0 002.511-2.103c.818-4.672 2.628-9.051 5.14-12.847a2.642 2.642 0 00-.293-3.212L17.13 24.312c-1.05-1.11-2.861-.993-3.796.175zm67.275 107.392h32.995c1.868 0 3.387 1.518 3.445 3.445v65.231a3.451 3.451 0 01-3.445 3.445H80.608a3.452 3.452 0 01-3.446-3.445v-65.231a3.451 3.451 0 013.446-3.445zm77.844 27.097h-32.878a3.514 3.514 0 00-3.503 3.504v37.959a3.514 3.514 0 003.503 3.504h32.878a3.515 3.515 0 003.504-3.504V162.48a3.515 3.515 0 00-3.504-3.504zm12.205 18.28h32.586a3.639 3.639 0 013.621 3.62v19.388a3.639 3.639 0 01-3.621 3.621h-32.586a3.639 3.639 0 01-3.62-3.621v-19.388a3.638 3.638 0 013.62-3.62z",fill:"#EBF2FA"})),Zu||(Zu=n.createElement("path",{d:"M134.275 171.532h-113c-5.84 0-10.628-4.789-10.628-10.629v-73.23c0-5.84 4.788-10.629 10.628-10.629h112.941c5.84 0 10.629 4.789 10.629 10.629v73.23c.058 5.899-4.731 10.629-10.57 10.629v0z",stroke:"#2EE5C0",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})),Xu||(Xu=n.createElement("path",{d:"M21.625 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074zM31.494 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074zM41.363 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074z",fill:"#2EE5C0"})),ep||(ep=n.createElement("path",{d:"M10.822 98.592h133.673",stroke:"#2EE5C0",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})),tp||(tp=n.createElement("path",{d:"M184.555 149.164L57.89 156.172c-4.263.234-7.767-3.037-7.767-7.3V51.114c0-4.263 3.504-7.533 7.767-7.3l126.665 7.008c3.27.176 5.898 3.33 5.898 7.008v84.327c0 3.679-2.628 6.832-5.898 7.007z",fill:"#027BF3"})),ap||(ap=n.createElement("path",{d:"M65.13 54.151c0 1.986-1.576 3.504-3.562 3.387-1.985-.058-3.562-1.752-3.562-3.737 0-1.986 1.635-3.504 3.562-3.387 1.927.058 3.562 1.752 3.562 3.737zm11.506.466a3.38 3.38 0 01-3.504 3.388c-1.927-.059-3.504-1.753-3.504-3.68a3.38 3.38 0 013.504-3.387c1.927.117 3.504 1.752 3.504 3.68zm7.825 3.855c1.869.117 3.387-1.402 3.387-3.329 0-1.927-1.518-3.562-3.387-3.62-1.927-.117-3.445 1.401-3.445 3.328 0 1.927 1.576 3.562 3.445 3.62z",fill:"#fff"})),np||(np=n.createElement("path",{d:"M75.467 142.974V85.277c-3.971-.525-8.584-.409-13.899.7v57.64l13.899-.643zM88.84 90.651v51.799l-11.096.467v-57.23c4.322.934 7.942 2.745 11.096 4.964zm13.431 13.899a1.618 1.618 0 01-.146-.176 1.487 1.487 0 00-.146-.175c-.42-.51-.841-1.026-1.265-1.546-2.875-3.522-5.874-7.197-9.538-10.25v49.93l11.095-.467V104.55zm13.432 5.722c-3.913-.058-7.709-.701-11.096-3.445v34.922l11.096-.468v-31.009zm13.431-.409c-2.764-.173-5.529.006-8.246.181-.957.062-1.907.123-2.849.169v30.951l11.095-.467v-30.834zm24.002 29.841l-8.234.35v-22.191c8.176 9.285 8.234 21.841 8.234 21.841zM140.113 113.6a19.774 19.774 0 012.453 1.927v24.644l-11.096.467v-30.483c2.92.467 5.782 1.46 8.643 3.445z",fill:"#00236B"})),sp||(sp=n.createElement("path",{d:"M55.745 76.436a2 2 0 103.123 2.499l-3.123-2.499zm5.766-4.006l1.575-1.233a2 2 0 00-3.136-.017l1.561 1.25zm2.63 6.605a2 2 0 103.15-2.465l-3.15 2.465zm107.94 53.502a2 2 0 00-2.499 3.123l2.499-3.123zm4.006 5.766l1.214 1.59a1.999 1.999 0 00.036-3.151l-1.25 1.561zm-6.644 2.557a1.999 1.999 0 102.427 3.179l-2.427-3.179zM58.868 78.935l4.205-5.256-3.123-2.499-4.205 5.256 3.123 2.499zm1.068-5.273l4.205 5.373 3.15-2.465-4.205-5.373-3.15 2.465zm109.646 61.998l5.256 4.205 2.499-3.123-5.256-4.205-2.499 3.123zm5.292 1.054l-5.431 4.146 2.427 3.179 5.431-4.146-2.427-3.179zM147.137 69.146a2 2 0 10-.149 3.998l.149-3.998zm29.634 5.107a2 2 0 10.149-3.997l-.149 3.997zm-29.657 5.404a2 2 0 00-.102 3.999l.102-3.999zm29.681 4.758a2 2 0 00.102-3.999l-.102 4zm-29.72 5.928a2 2 0 10-.023 4l.023-4zm29.759 4.176a2 2 0 10.024-4l-.024 4zm-29.846-21.375l29.783 1.11.149-3.998-29.783-1.11-.149 3.998zm.024 10.512l29.783.76.102-4-29.783-.759-.102 3.999zm.04 10.687l29.782.176.024-4-29.783-.175-.023 4zM143.442 71.202a2.458 2.458 0 01-2.57 2.453c-1.401-.058-2.569-1.285-2.569-2.686 0-1.402 1.168-2.57 2.569-2.453 1.46.058 2.57 1.285 2.57 2.686zm.001 10.396a2.458 2.458 0 01-2.57 2.453c-1.401-.059-2.569-1.285-2.569-2.686 0-1.46 1.168-2.57 2.569-2.453 1.46.058 2.57 1.284 2.57 2.686zm-2.57 12.848a2.458 2.458 0 002.57-2.453c0-1.402-1.11-2.628-2.57-2.686-1.401-.117-2.569 1.05-2.569 2.452s1.168 2.628 2.569 2.687z",fill:"#fff"})),rp||(rp=n.createElement("path",{opacity:.2,d:"M190.452 91.875V57.771c0-3.68-2.628-6.833-5.899-7.008l-23.651-1.285a35.18 35.18 0 00-1.752 10.98c0 17.635 12.79 31.826 28.09 31.65 1.051.06 2.16-.058 3.212-.233z",fill:"#00236B"})),ip||(ip=n.createElement("path",{d:"M220.645 58.883c0-16.585-11.621-30.775-26.454-31.651-15.3-.876-28.089 12.672-28.089 30.308s12.789 31.827 28.089 31.652c14.833-.117 26.454-13.724 26.454-30.309z",fill:"#FF4645"})),op||(op=n.createElement("path",{d:"M215.329 40.372c-4.788-7.475-12.38-12.614-21.14-13.14v31.01l21.14-17.87z",fill:"#FC0"})),lp||(lp=n.createElement("path",{d:"M215.329 40.372l-21.14 17.87 26.455.642c0-6.89-1.986-13.315-5.315-18.512z",fill:"#00236B"})),cp||(cp=n.createElement("path",{d:"M194.248 58.24V27.233c-15.301-.876-28.09 12.672-28.09 30.308l28.09.7z",fill:"#FF4645"})),dp||(dp=n.createElement("path",{d:"M161.151 14.734a2 2 0 10-4 0h4zm-4 4.204a2 2 0 004 0h-4zm4 8.876a2 2 0 10-4 0h4zm-4 4.555a2 2 0 004 0h-4zm10.819-6.816a2 2 0 000-4v4zm-4.263-4a2 2 0 100 4v-4zm-9.169 4a2 2 0 100-4v4zm-4.263-4a2 2 0 000 4v-4zm6.876-6.82v4.205h4v-4.204h-4zm0 13.08v4.556h4v-4.555h-4zm10.819-6.26h-4.263v4h4.263v-4zm-13.432 0h-4.263v4h4.263v-4z",fill:"#2EE5C0"})))},hp=(0,l.cn)("network");function mp({database:e,databaseFullPath:t}){var a,s;const[r]=(0,j.Nt)(),{withProblems:i,handleWithProblemsChange:o}=$u(),[l,d]=n.useState(),[u,p]=n.useState(!1),[h,m]=n.useState(!1),{currentData:g,isFetching:v,error:y}=Bu.useGetNetworkInfoQuery({database:e,databaseFullPath:t},{pollingInterval:r});if(v&&void 0===g)return(0,c.jsx)("div",{className:"loader",children:(0,c.jsx)(Uu.a,{size:"l"})});const x=g,b=null!==(a=(null===x||void 0===x?void 0:x.Tenants)&&x.Tenants[0].Nodes)&&void 0!==a?a:[];if(!y&&0===b.length)return(0,c.jsx)("div",{className:"error",children:"no nodes data"});const f=vp(b,"NodeType"),T=l?vp(null!==(s=l.Peers)&&void 0!==s?s:[],"NodeType"):{};return(0,c.jsxs)("div",{className:hp(),children:[y?(0,c.jsx)(F.o,{error:y}):null,b.length>0?(0,c.jsx)("div",{className:hp("inner"),children:(0,c.jsxs)("div",{className:hp("nodes-row"),children:[(0,c.jsxs)("div",{className:hp("left"),children:[(0,c.jsx)("div",{className:hp("controls-wrapper"),children:(0,c.jsxs)("div",{className:hp("controls"),children:[(0,c.jsx)(Gu.k,{value:i,onChange:o,className:hp("problem-filter")}),(0,c.jsx)("div",{className:hp("checkbox-wrapper"),children:(0,c.jsx)(M.S,{onUpdate:()=>{p(!u)},checked:u,children:"ID"})}),(0,c.jsx)("div",{className:hp("checkbox-wrapper"),children:(0,c.jsx)(M.S,{onUpdate:()=>{m(!h)},checked:h,children:"Racks"})})]})}),(0,c.jsx)(gp,{nodes:f,showId:u,showRacks:h,clickedNode:l,onClickNode:d})]}),(0,c.jsx)("div",{className:hp("right"),children:l?(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:hp("label"),children:["Connectivity of node"," ",(0,c.jsx)(Lo.N_,{className:hp("link"),to:(0,B.vI)({id:l.NodeId}),children:l.NodeId})," ","to other nodes"]}),(0,c.jsx)("div",{className:hp("nodes-row"),children:(0,c.jsx)(gp,{nodes:T,isRight:!0,showId:u,showRacks:h,clickedNode:l,onClickNode:d})})]}):(0,c.jsxs)("div",{className:hp("placeholder"),children:[(0,c.jsx)("div",{className:hp("placeholder-img"),children:(0,c.jsx)(Me.I,{data:pp,width:221,height:204})}),(0,c.jsx)("div",{className:hp("placeholder-text"),children:"Select node to see its connectivity to other nodes"})]})})]})}):null]})}function gp({nodes:e,isRight:t,showId:a,showRacks:n,clickedNode:s,onClickNode:r}){const{withProblems:i}=$u(),o=(0,j.YQ)();let l=0;const d=Object.keys(e).map(((d,u)=>{const p=vp(e[d],"Rack");return(0,c.jsxs)("div",{className:hp("nodes-container",{right:t}),children:[(0,c.jsxs)("div",{className:hp("nodes-title"),children:[d," nodes"]}),(0,c.jsx)("div",{className:hp("nodes"),children:n?Object.keys(p).map(((e,n)=>(0,c.jsxs)("div",{className:hp("rack-column"),children:[(0,c.jsx)("div",{className:hp("rack-index"),children:"undefined"===e?"?":e}),p[e].map(((e,n)=>{let d,u;return!t&&"Peers"in e&&e.Peers&&(d=Object.keys(e.Peers).length,u=Ju(e.Peers)),i&&d!==u||!i||t?(l++,(0,c.jsx)(Wu,{nodeId:e.NodeId,showID:a,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:d,connected:u,onMouseEnter:(...e)=>{o((0,z.DK)(...e))},onMouseLeave:()=>{o((0,z.w7)())},onClick:t?void 0:()=>{r(s&&e.NodeId===s.NodeId?void 0:e)},isBlurred:!t&&s&&s.NodeId!==e.NodeId},n)):null}))]},n))):e[d].map(((e,n)=>{let d,u;const p=e&&"Peers"in e?e.Peers:void 0;return!t&&"Peers"in e&&e.Peers&&(d=e.Peers.length,u=Ju(p)),i&&d!==u||!i||t?(l++,(0,c.jsx)(Wu,{nodeId:e.NodeId,showID:a,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:null===p||void 0===p?void 0:p.length,connected:u,onMouseEnter:(...e)=>{o((0,z.DK)(...e))},onMouseLeave:()=>{o((0,z.w7)())},onClick:t?void 0:()=>{r(s&&e.NodeId===s.NodeId?void 0:e)},isBlurred:!t&&s&&s.NodeId!==e.NodeId},n)):null}))})]},u)}));return i&&0===l?(0,c.jsx)(Qu.v,{name:"thumbsUp",width:200}):d}function vp(e,t){return e.reduce(((e,a)=>(e[a[t]]?e[a[t]].push(a):e[a[t]]=[a],e)),{})}function yp({database:e,path:t,databaseFullPath:a,scrollContainerRef:n}){const s=(0,I.Pm)(),r=(0,zu.b)();return(0,c.jsx)(i.r,{loading:!s,children:r?(0,c.jsx)(qu.x,{path:t,databaseFullPath:a,database:e,scrollContainerRef:n}):(0,c.jsx)(mp,{database:e,databaseFullPath:a})})}var xp=a(4980),bp=a(10671),fp=a(24600),jp=a(47058),Tp=a(59134);const Sp=JSON.parse('{"lagsPopover.writeLags":"Write lags statistics (time format dd hh:mm:ss)","lagsPopover.readLags":"Read lags statistics (time format dd hh:mm:ss)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"Consumer:","controls.consumerSelector.emptyOption":"No consumer","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"No partitions match the current search","noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers"}'),wp=JSON.parse('{"lagsPopover.writeLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0437\u0430\u043f\u0438\u0441\u0438 (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","lagsPopover.readLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0447\u0442\u0435\u043d\u0438\u044f (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"\u0427\u0438\u0442\u0430\u0442\u0435\u043b\u044c:","controls.consumerSelector.emptyOption":"\u041d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"\u041f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0438\u0441\u043a\u0443 \u043d\u0435\u0442 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439","noConsumersMessage.topic":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0442\u043e\u043f\u0438\u043a\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","noConsumersMessage.stream":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0440\u0438\u043c\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439"}'),Ep=(0,ge.g4)("ydb-diagnostics-partitions",{ru:wp,en:Sp}),_p=({consumers:e,selectedConsumer:t,onSelectedConsumerChange:a,selectDisabled:s,partitions:r,onSearchChange:i})=>{const[o,l]=n.useState(""),[d,u]=n.useState("");n.useEffect((()=>{if(!r)return;const e=new RegExp(pn()(d),"i"),t=new RegExp(pn()(o),"i"),a=r.filter((a=>{const{partitionId:n,readerName:s,readSessionId:r,partitionNodeId:i,connectionNodeId:o,partitionHost:l,connectionHost:c}=a,d=e.test(String(n)),u=[s,r,i,o,l,c].filter(Boolean).map(String),p=0===u.length||u.some((e=>t.test(e)));return d&&p}));i(a)}),[d,o,r,i]);const p=n.useMemo((()=>{const t=e&&e.length?e.map((e=>({value:e,content:e}))):[];return[{value:"",content:Ep("controls.consumerSelector.emptyOption")},...t]}),[e]),h=e=>(0,c.jsx)("div",{className:Zp("select-option",{empty:""===e.value}),children:e.content});return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(O.l,{className:Zp("consumer-select"),label:Ep("controls.consumerSelector"),options:p,value:[t||""],onUpdate:e=>{a(e[0]||void 0)},filterable:e&&e.length>5,disabled:s||!e||!e.length,renderOption:h,renderSelectedOption:h}),(0,c.jsx)(Tp.v,{onChange:e=>{u(e)},placeholder:Ep("controls.partitionSearch"),className:Zp("search",{partition:!0}),value:d}),(0,c.jsx)(Tp.v,{onChange:e=>{l(e)},placeholder:Ep("controls.generalSearch"),className:Zp("search",{general:!0}),value:o})]})},Np=(0,l.cn)("ydb-multiline-table-header");function Cp({title:e}){return e?(0,c.jsx)("div",{className:Np(),children:e}):null}const Pp={PARTITION_ID:"partitionId",STORE_SIZE:"storeSize",WRITE_SPEED:"writeSpeed",READ_SPEED:"readSpeed",WRITE_LAGS:"writeLags",READ_LAGS:"readLags",UNCOMMITED_MESSAGES:"uncommitedMessages",UNREAD_MESSAGES:"unreadMessages",START_OFFSET:"startOffset",END_OFFSET:"endOffset",COMMITED_OFFSET:"commitedOffset",READ_SESSION_ID:"readSessionId",READER_NAME:"readerName",PARTITION_HOST:"partitionHost",CONNECTION_HOST:"connectionHost"},Ip={[Pp.PARTITION_ID]:"Partition ID",[Pp.STORE_SIZE]:"Store size",[Pp.WRITE_SPEED]:"Write speed",[Pp.READ_SPEED]:"Read speed",[Pp.WRITE_LAGS]:"Write lags, duration",[Pp.READ_LAGS]:"Read lags, duration",[Pp.UNCOMMITED_MESSAGES]:"Uncommited messages",[Pp.UNREAD_MESSAGES]:"Unread messages",[Pp.START_OFFSET]:"Start offset",[Pp.END_OFFSET]:"End offset",[Pp.COMMITED_OFFSET]:"Commited offset",[Pp.READ_SESSION_ID]:"Read session ID",[Pp.READER_NAME]:"Reader name",[Pp.PARTITION_HOST]:"Partition host",[Pp.CONNECTION_HOST]:"Connection host"},Ap="partitionWriteLag",Dp="partitionWriteIdleTime",Rp={[Ap]:"write lag",[Dp]:"write idle time"},kp="consumerWriteLag",Op="consumerReadLag",Mp="consumerReadIdleTime",Fp={[kp]:"write lag",[Op]:"read lag",[Mp]:"read idle time"},Lp=[Pp.PARTITION_ID,Pp.STORE_SIZE,Pp.WRITE_SPEED,Pp.WRITE_LAGS,Pp.START_OFFSET,Pp.END_OFFSET,Pp.PARTITION_HOST],qp=Object.values(Pp),zp=(0,l.cn)("ydb-diagnostics-partitions-columns-header"),Up=()=>(0,c.jsx)("div",{className:zp("read-session"),children:Ip[Pp.READ_SESSION_ID]}),Qp=()=>(0,c.jsx)(On,{className:zp("lags"),text:Ip[Pp.WRITE_LAGS],popoverContent:(0,c.jsx)(Jn,{text:Ep("lagsPopover.writeLags"),type:"write"})}),Gp=()=>(0,c.jsx)(On,{className:zp("lags"),text:Ip[Pp.READ_LAGS],popoverContent:(0,c.jsx)(Jn,{text:Ep("lagsPopover.readLags"),type:"read"})}),Bp=()=>(0,c.jsx)(On,{className:zp("messages"),text:Ip[Pp.UNREAD_MESSAGES],popoverContent:(0,c.jsx)("div",{className:zp("messages-popover-content"),children:Ep("headers.unread")})}),$p=()=>(0,c.jsx)(On,{className:zp("messages"),text:Ip[Pp.UNCOMMITED_MESSAGES],popoverContent:(0,c.jsx)("div",{className:zp("messages-popover-content"),children:Ep("headers.uncommited")})}),Hp=(0,l.cn)("ydb-diagnostics-partitions-columns"),Vp=[{name:Pp.PARTITION_ID,header:(0,c.jsx)(Cp,{title:Ip[Pp.PARTITION_ID]}),sortAccessor:e=>(0,$r.kf)(e.partitionId)&&Number(e.partitionId),align:Ht.Ay.LEFT,render:({row:e})=>(0,c.jsx)(Kp,{id:String(e.partitionId)})},{name:Pp.STORE_SIZE,header:(0,c.jsx)(Cp,{title:Ip[Pp.STORE_SIZE]}),sortAccessor:e=>(0,$r.kf)(e.storeSize)&&Number(e.storeSize),align:Ht.Ay.RIGHT,render:({row:e})=>(0,U.z3)(e.storeSize)},{name:Pp.WRITE_SPEED,header:Ip[Pp.WRITE_SPEED],align:Ht.Ay.LEFT,resizeMinWidth:140,sortAccessor:e=>e.writeSpeed.perMinute,render:({row:e})=>(0,c.jsx)(_n,{data:e.writeSpeed})},{name:Pp.READ_SPEED,header:Ip[Pp.READ_SPEED],align:Ht.Ay.LEFT,resizeMinWidth:140,sortAccessor:e=>{var t;return null===(t=e.readSpeed)||void 0===t?void 0:t.perMinute},render:({row:e})=>(0,c.jsx)(_n,{data:e.readSpeed})},{name:Pp.WRITE_LAGS,header:(0,c.jsx)(Qp,{}),className:Hp("lags-header"),sub:[{name:Ap,header:Rp[Ap],align:Ht.Ay.RIGHT,render:({row:e})=>(0,U.lr)(e.partitionWriteLag)},{name:Dp,header:Rp[Dp],align:Ht.Ay.RIGHT,render:({row:e})=>(0,U.lr)(e.partitionWriteIdleTime)}]},{name:Pp.READ_LAGS,header:(0,c.jsx)(Gp,{}),className:Hp("lags-header"),sub:[{name:kp,header:Fp[kp],align:Ht.Ay.RIGHT,render:({row:e})=>(0,U.lr)(e.consumerWriteLag)},{name:Op,header:Fp[Op],align:Ht.Ay.RIGHT,render:({row:e})=>(0,U.lr)(e.consumerReadLag)},{name:Mp,header:Fp[Mp],align:Ht.Ay.RIGHT,render:({row:e})=>(0,U.lr)(e.consumerReadIdleTime)}]},{name:Pp.UNCOMMITED_MESSAGES,header:(0,c.jsx)($p,{}),align:Ht.Ay.RIGHT,render:({row:e})=>e.uncommitedMessages},{name:Pp.UNREAD_MESSAGES,header:(0,c.jsx)(Bp,{}),align:Ht.Ay.RIGHT,render:({row:e})=>e.unreadMessages},{name:Pp.START_OFFSET,header:(0,c.jsx)(Cp,{title:Ip[Pp.START_OFFSET]}),sortAccessor:e=>(0,$r.kf)(e.startOffset)&&Number(e.startOffset),align:Ht.Ay.RIGHT,render:({row:e})=>e.startOffset},{name:Pp.END_OFFSET,header:(0,c.jsx)(Cp,{title:Ip[Pp.END_OFFSET]}),sortAccessor:e=>(0,$r.kf)(e.endOffset)&&Number(e.endOffset),align:Ht.Ay.RIGHT,render:({row:e})=>e.endOffset},{name:Pp.COMMITED_OFFSET,header:(0,c.jsx)(Cp,{title:Ip[Pp.COMMITED_OFFSET]}),sortAccessor:e=>(0,$r.kf)(e.commitedOffset)&&Number(e.commitedOffset),align:Ht.Ay.RIGHT,render:({row:e})=>e.commitedOffset},{name:Pp.READ_SESSION_ID,header:(0,c.jsx)(Up,{}),align:Ht.Ay.LEFT,width:150,render:({row:e})=>e.readSessionId?(0,c.jsx)(ii.c,{name:e.readSessionId,showStatus:!1,hasClipboardButton:!0}):f.Pd},{name:Pp.READER_NAME,header:(0,c.jsx)(Cp,{title:Ip[Pp.READER_NAME]}),align:Ht.Ay.LEFT,width:150,render:({row:e})=>e.readerName?(0,c.jsx)(ii.c,{name:e.readerName,showStatus:!1,hasClipboardButton:!0}):f.Pd},{name:Pp.PARTITION_HOST,header:(0,c.jsx)(Cp,{title:Ip[Pp.PARTITION_HOST]}),align:Ht.Ay.LEFT,width:200,render:({row:e})=>e.partitionNodeId&&e.partitionHost?(0,c.jsx)(Wp,{host:e.partitionHost,id:e.partitionNodeId}):f.Pd},{name:Pp.CONNECTION_HOST,header:(0,c.jsx)(Cp,{title:Ip[Pp.CONNECTION_HOST]}),align:Ht.Ay.LEFT,width:200,render:({row:e})=>e.connectionNodeId&&e.connectionHost?(0,c.jsx)(Wp,{host:e.connectionHost,id:e.connectionNodeId}):f.Pd}];function Wp({host:e,id:t}){return(0,c.jsx)(ii.c,{name:e,path:(0,B.vI)({id:t}),showStatus:!1,hasClipboardButton:!0})}const Jp=Vp.filter((e=>Lp.includes(e.name)));function Kp({id:e}){const t=Vl(),a=(0,I._p)();return(0,c.jsx)(ii.c,{name:e,path:a?t(E.iJ.topicData,{selectedPartition:e}):void 0,showStatus:!1})}var Yp=a(43951);const Zp=(0,l.cn)("ydb-diagnostics-partitions"),Xp=({path:e,database:t,databaseFullPath:a})=>{const s=(0,j.YQ)(),[r,i]=n.useState([]),o=(0,j.N4)((n=>xn(n,e,t,a))),[l]=(0,j.Nt)(),{selectedConsumer:d}=(0,j.N4)((e=>e.partitions)),{currentData:u,isFetching:p,error:h}=mn.useGetTopicQuery({path:e,database:t,databaseFullPath:a}),m=p&&void 0===u,{currentData:g,isFetching:v,error:y}=fp.m.useGetNodesListQuery({database:t},void 0),x=v&&void 0===g,b=(0,j.N4)((e=>(0,fp.K)(e,t))),{columnsToShow:T,columnsToSelect:S,setColumns:w}=(e=>{const{columnsToShow:t,columnsToSelect:a,setColumns:s}=(0,Yp.K)(Vp,"partitionsSelectedColumns",Ip,qp,[Pp.PARTITION_ID]),{columnsToShow:r,columnsToSelect:i,setColumns:o}=(0,Yp.K)(Jp,"generalPartitionsSelectedColumns",Ip,Lp,[Pp.PARTITION_ID]);return n.useMemo((()=>e?{columnsToShow:t,columnsToSelect:a,setColumns:s}:{columnsToShow:r,columnsToSelect:i,setColumns:o}),[a,t,i,r,e,s,o])})(d),E=m?xp.hT:{path:e,database:t,consumerName:d,databaseFullPath:a},{currentData:_,isFetching:N,error:C}=jp.aD.useGetPartitionsQuery(E,{pollingInterval:l}),P=N&&void 0===_,I=_,A=n.useMemo((()=>((e=[],t)=>null===e||void 0===e?void 0:e.map((e=>{var a,n;const s=e.partitionNodeId&&t?null===(a=t.get(e.partitionNodeId))||void 0===a?void 0:a.Host:void 0,r=e.connectionNodeId&&t?null===(n=t.get(e.connectionNodeId))||void 0===n?void 0:n.Host:void 0;return{...e,partitionHost:s,connectionHost:r}})))(I,b)),[I,b]);n.useEffect((()=>{const e=!m&&!o,t=d&&o&&!o.includes(d);(e||t)&&s((0,jp.WD)(void 0))}),[s,m,d,o]);const D=e=>{s((0,jp.WD)(e))},R=m||x||P,k=y||h||C;return(0,c.jsxs)(he.L,{className:Zp(),children:[(0,c.jsx)(he.L.Controls,{renderExtraControls:()=>(0,c.jsx)(bp.O,{items:S,showStatus:!0,onUpdate:w}),children:(0,c.jsx)(_p,{consumers:o,selectedConsumer:d,onSelectedConsumerChange:D,selectDisabled:Boolean(k)||R,partitions:A,onSearchChange:i})}),(0,c.jsxs)(he.L.Table,{children:[k?(0,c.jsx)(F.o,{error:k}):null,_?(0,c.jsx)(ue.l,{columnsWidthLSKey:"partitionsColumnsWidth",wrapperClassName:Zp("table"),data:r,columns:T,isLoading:R,settings:f.N3,emptyDataMessage:Ep("table.emptyDataMessage")}):null]})]})};var eh=a(74281);const th=tt.z.enum([nd,ed,sd]).catch(nd),ah={columnId:nd,order:Ht.Ay.DESCENDING};const nh=(0,l.cn)("kv-top-queries"),sh=({database:e,renderQueryModeControl:t,handleTextSearchUpdate:a})=>{var s,r;const[i]=(0,j.Nt)(),o=(0,j.N4)((e=>e.executeTopQueries)),l=n.useMemo((()=>[Sd,Td,Ed,yd,Nd].map((e=>{return{...e,sortable:(t=e.name,Boolean(md(t)))};var t}))),[]),{columnsToShow:d,columnsToSelect:u,setColumns:p}=(0,Yp.K)(l,"runningQueriesSelectedColumns",dd,ld,cd),{tableSort:h,handleTableSort:m,backendSort:g}=function(){var e,t;const{sortParam:a,updateSortParam:s}=Pd({paramName:"runningSort",schema:th,defaultSort:ah}),[r,i]=(0,j.GY)({initialSortColumn:(null===a||void 0===a||null===(e=a[0])||void 0===e?void 0:e.columnId)||ah.columnId,initialSortOrder:(null===a||void 0===a||null===(t=a[0])||void 0===t?void 0:t.order)||ah.order,multiple:!0,onSort:s});return{tableSort:r,handleTableSort:i,backendSort:n.useMemo((()=>(0,j.JN)(r,md)),[r])}}(),{currentData:v,isFetching:y,isLoading:x,error:b}=to.Ke.useGetRunningQueriesQuery({database:e,filters:o,sortOrder:g},{pollingInterval:i}),f=null===v||void 0===v||null===(s=v.resultSets)||void 0===s||null===(r=s[0])||void 0===r?void 0:r.result,T=n.useRef(null);return(0,c.jsxs)(he.L,{children:[(0,c.jsxs)(he.L.Controls,{renderExtraControls:()=>(0,c.jsx)(bp.O,{popupWidth:200,items:u,showStatus:!0,onUpdate:p}),children:[t(),(0,c.jsx)(me.v,{value:o.text,onChange:a,placeholder:kc("filter.text.placeholder"),className:nh("search"),inputRef:T})]}),b?(0,c.jsx)(F.o,{error:(0,ht.Cb)(b)}):null,(0,c.jsx)(he.L.Table,{loading:x,children:(0,c.jsx)($c,{columns:d,data:f||[],loading:y&&void 0===v,columnsWidthLSKey:"runningQueriesColumnsWidth",emptyDataMessage:kc("no-data"),sortOrder:h,onSort:m,drawerId:"running-query-details",storageKey:"running-queries-drawer-width",tableSettings:Ac})})]})};var rh=a(42527),ih=a(44540);const oh=JSON.parse('{"date-format":"MM/DD/YYYY","date-time-format":"MM/DD/YYYY HH:mm"}'),lh=JSON.parse('{"date-format":"DD.MM.YYYY","date-time-format":"DD.MM.YYYY HH:mm"}'),ch=(0,ge.g4)("ydb-date-range",{ru:lh,en:oh});function dh(e){var t,a,n,s;return"relative"===(null===e||void 0===e||null===(t=e.start)||void 0===t?void 0:t.type)&&"relative"===(null===e||void 0===e||null===(a=e.end)||void 0===a?void 0:a.type)?"s":"relative"===(null===e||void 0===e||null===(n=e.start)||void 0===n?void 0:n.type)||"relative"===(null===e||void 0===e||null===(s=e.end)||void 0===s?void 0:s.type)?"m":"l"}const uh=(0,l.cn)("date-range"),ph=({from:e,to:t,className:a,defaultValue:s,onChange:r})=>{const i=n.useCallback((e=>null===r||void 0===r?void 0:r(function(e){var t,a,n,s,r,i;return{from:"relative"===(null===e||void 0===e||null===(t=e.start)||void 0===t?void 0:t.type)?e.start.value.toString():String(null===(a=(0,Ie.bQ)(null===e||void 0===e||null===(n=e.start)||void 0===n?void 0:n.value))||void 0===a?void 0:a.valueOf()),to:"relative"===(null===e||void 0===e||null===(s=e.end)||void 0===s?void 0:s.type)?e.end.value.toString():String(null===(r=(0,Ie.bQ)(null===e||void 0===e||null===(i=e.end)||void 0===i?void 0:i.value))||void 0===r?void 0:r.valueOf())}}(e))),[r]),o=n.useMemo((()=>{if(e||t)return function(e){var t,a;const n=(0,Ie.eP)(null!==(t=e.from)&&void 0!==t?t:""),s=(0,Ie.eP)(null!==(a=e.to)&&void 0!==a?a:"");return{start:e.from?{type:n?"relative":"absolute",value:n?e.from:(0,Ie.bQ)(Number(e.from))}:null,end:e.to?{type:s?"relative":"absolute",value:s?e.to:(0,Ie.bQ)(Number(e.to))}:null}}({from:e,to:t})}),[e,t]),l=Intl.DateTimeFormat().resolvedOptions().timeZone,d=o||s;return(0,c.jsx)("div",{className:uh(null,a),children:(0,c.jsx)(rh.k,{withPresets:!0,className:uh("range-input",{[dh(d)]:!0}),timeZone:l,value:d,allowNullableValues:!0,size:"m",format:ch("date-time-format"),onUpdate:i,placeholder:`${ch("date-time-format")} - ${ch("date-time-format")}`,withApplyButton:!0,docs:ih.p2,withHeader:!0})})},hh={hour:"hour",minute:"minute"},mh=[{value:hh.hour,content:kc("timeframe_hour")},{value:hh.minute,content:kc("timeframe_minute")}],gh={start:{value:"now-6h",type:"relative"},end:{value:"now",type:"relative"}};function vh(e){const t=Nc(String(e.QueryText));return{rank:String(e.Rank),intervalEnd:String(e.IntervalEnd),endTime:String(e.EndTime),queryHash:t}}const yh=(0,l.cn)("kv-top-queries"),xh=({database:e,timeFrame:t,renderQueryModeControl:a,handleTimeFrameChange:s,handleDateRangeChange:r,handleTextSearchUpdate:i})=>{var o,l;const[d]=(0,j.Nt)(),u=(0,j.N4)((e=>e.executeTopQueries)),[p,h]=n.useState(void 0),m=n.useRef(null),g=n.useMemo((()=>[Sd,vd,wd,jd,_d,yd,bd,fd,Td].map((e=>{return{...e,sortable:(t=e.name,Boolean(hd(t))),defaultOrder:Ht.Ay.DESCENDING};var t}))),[]),{columnsToShow:v,columnsToSelect:y,setColumns:x}=(0,Yp.K)(g,"topQueriesSelectedColumns",dd,id,od),{tableSort:b,handleTableSort:f,backendSort:T}=Dd(),{currentData:S,isFetching:w,isLoading:E,error:_}=to.Ke.useGetTopQueriesQuery({database:e,filters:u,sortOrder:T,timeFrame:t},{pollingInterval:d}),N=null===S||void 0===S||null===(o=S.resultSets)||void 0===o||null===(l=o[0])||void 0===l?void 0:l.result;!function(e,t){const[a,s]=(0,et.useQueryParams)({selectedRow:et.StringParam});n.useEffect((()=>{if(t&&a.selectedRow){const n=JSON.parse(decodeURIComponent(a.selectedRow)),r=t.find((e=>{const t=vh(e);return t.rank===n.rank&&t.intervalEnd===n.intervalEnd&&t.endTime===n.endTime&&n.queryHash===t.queryHash}));e(r||null),s({selectedRow:void 0})}}),[a.selectedRow,s,t,e])}(h,N);const C=n.useMemo((()=>({...Ac,dynamicInnerRef:m})),[]);!function({selectedRow:e,rows:t,reactListRef:a}){n.useEffect((()=>{if(e&&t&&a.current){const n=t.findIndex((t=>(0,Xe.isEqual)(t,e)));if(-1!==n){const e=a.current;try{const t=e.getVisibleRange(),[a,s]=t;n>=a&&n<=s||e.scrollTo(n-1)}catch{e.scrollAround(n)}}}}),[e,t,a])}({selectedRow:p,rows:N,reactListRef:m});const P=void 0!==p,I=n.useCallback((()=>p?function(e){const t=vh(e),a=new URL(window.location.href),n=new URLSearchParams(a.search);return n.set("selectedRow",encodeURIComponent(JSON.stringify({rank:t.rank||void 0,intervalEnd:t.intervalEnd||void 0,endTime:t.endTime||void 0,queryHash:t.queryHash||void 0}))),a.search=n.toString(),a.toString()}(p):""),[p]),A=n.useRef(null);n.useEffect((()=>{var e;P&&(null===(e=A.current)||void 0===e||e.blur())}),[P]);const D=n.useMemo((()=>[{type:"copyLink",link:I()},{type:"close"}]),[I]);return(0,c.jsxs)(he.L,{children:[(0,c.jsxs)(he.L.Controls,{renderExtraControls:()=>(0,c.jsx)(bp.O,{popupWidth:200,items:y,showStatus:!0,onUpdate:x}),children:[a(),(0,c.jsx)(O.l,{options:mh,value:[t],onUpdate:s}),(0,c.jsx)(ph,{from:u.from,to:u.to,onChange:r,defaultValue:gh}),(0,c.jsx)(me.v,{value:u.text,inputRef:A,onChange:i,placeholder:kc("filter.text.placeholder"),className:yh("search")})]}),_?(0,c.jsx)(F.o,{error:(0,ht.Cb)(_)}):null,(0,c.jsx)(he.L.Table,{loading:E,children:(0,c.jsx)($c,{columns:v,data:N||[],loading:w&&void 0===S,columnsWidthLSKey:Wc,emptyDataMessage:kc("no-data"),sortOrder:b,onSort:f,selectedRow:p,onSelectedRowChange:h,drawerControls:D,drawerId:"query-details",storageKey:"kv-top-queries-drawer-width",tableSettings:C})})]})},bh={top:"top",running:"running"},fh=tt.z.nativeEnum(bh).catch(bh.top),jh=tt.z.nativeEnum(hh).catch(hh.hour),Th=({database:e})=>{const t=(0,j.YQ)(),[a=bh.top,s]=(0,et.useQueryParam)("queryMode",et.StringParam),[r=hh.hour,i]=(0,et.useQueryParam)("timeFrame",et.StringParam),o=fh.parse(a),l=jh.parse(r),d=o===bh.top,u=e=>{t((0,to.TX)({text:e}))},p=n.useCallback((()=>(0,c.jsxs)(eh.x,{value:o,onUpdate:s,children:[(0,c.jsx)(eh.x.Option,{value:bh.top,children:kc("mode_top")}),(0,c.jsx)(eh.x.Option,{value:bh.running,children:kc("mode_running")})]})),[o,s]);return d?(0,c.jsx)(xh,{database:e,timeFrame:l,renderQueryModeControl:p,handleTimeFrameChange:e=>{i(e[0],"replaceIn")},handleDateRangeChange:e=>{t((0,to.TX)(e))},handleTextSearchUpdate:u}):(0,c.jsx)(sh,{database:e,renderQueryModeControl:p,handleTextSearchUpdate:u})};var Sh=a(46496),wh=a(87747);const Eh=JSON.parse('{"no-data":"No data","filters.mode.immediate":"Immediate","filters.mode.history":"Historical","description":"Historical data only tracks shards with CPU load over 70%"}'),_h=JSON.parse('{"no-data":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445","filters.mode.immediate":"\u041c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u044b\u0435","filters.mode.history":"\u0418\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0435","description":"\u0418\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043e \u0448\u0430\u0440\u0434\u0430\u0445 \u0441 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u043e\u0439 CPU \u0432\u044b\u0448\u0435 70%"}'),Nh=(0,ge.g4)("ydb-diagnostics-top-shards",{ru:_h,en:Eh}),Ch={start:{value:"now-1h",type:"relative"},end:{value:"now",type:"relative"}},Ph=({value:e,onChange:t})=>{const a=e.mode===wh.h.Immediate?void 0:e.from,s=e.mode===wh.h.Immediate?void 0:e.to;return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsxs)(eh.x,{value:e.mode,onUpdate:e=>{if(!((e,t)=>Object.values(e).includes(t))(wh.h,e)){const t=Object.values(wh.h).join(", ");throw new Error(`Unexpected TopShards mode "${e}". Should be one of: ${t}`)}t({mode:e})},children:[(0,c.jsx)(eh.x.Option,{value:wh.h.Immediate,children:Nh("filters.mode.immediate")}),(0,c.jsx)(eh.x.Option,{value:wh.h.History,children:Nh("filters.mode.history")})]}),(0,c.jsx)(ph,{from:a,to:s,onChange:e=>{t({mode:wh.h.History,...e})},defaultValue:Ch})]})};var Ih=a(49228);const Ah=(0,l.cn)("top-shards"),Dh={...f.N3,dynamicRender:!1,externalSort:!0,disableSortReset:!0,defaultOrder:-1};function Rh(e){return e.to="now",e.from="now-1h",e}const kh=({database:e,path:t,databaseFullPath:a})=>{var s,r;const i=(0,Od.x)("ShardsTable"),o=(0,j.YQ)(),[l]=(0,j.Nt)(),d=(0,j.N4)((e=>e.shardsWorkload)),[u,p]=n.useState((()=>{const e={...d};return e.mode||(e.mode=wh.h.Immediate),e.from||e.to||Rh(e),e})),{tableSort:h,handleTableSort:m,backendSort:g}=function(){const[e,t]=(0,j.GY)({initialSortColumn:Ih.Fk.CPUCores,fixedOrderType:-1,multiple:!0}),a=n.useMemo((()=>(0,j.JN)(e,Ih.LK)),[e]);return{tableSort:e,handleTableSort:t,backendSort:a}}(),{currentData:v,isFetching:y,error:x}=Sh.Xx.useSendShardQueryQuery({database:e,path:t,sortOrder:g,filters:u,databaseFullPath:a},{pollingInterval:l}),b=y&&void 0===v,f=(null===v||void 0===v||null===(s=v.resultSets)||void 0===s||null===(r=s[0])||void 0===r?void 0:r.result)||[],T=e=>{const t={...e};if(!d.from&&!d.to&&!e.from&&!e.to)switch(e.mode){case wh.h.Immediate:t.from=t.to=void 0;break;case wh.h.History:Rh(t)}o((0,Sh.rF)(e)),p((e=>({...e,...t})))},S=n.useMemo((()=>{let e;return e=u.mode===wh.h.History?["Path","CPUCores","DataSize","TabletId","NodeId","PeakTime","InFlightTxCount","IntervalEnd"]:["Path","CPUCores","DataSize","TabletId","NodeId","InFlightTxCount"],e}),[u.mode]);return(0,c.jsxs)(he.L,{children:[(0,c.jsx)(he.L.Controls,{children:(0,c.jsx)(Ph,{value:u,onChange:T})}),u.mode===wh.h.History&&(0,c.jsx)("div",{className:Ah("hint"),children:Nh("description")}),x?(0,c.jsx)(F.o,{error:(0,ht.Cb)(x)}):null,(0,c.jsx)(he.L.Table,{loading:b,children:x&&!f?null:(0,c.jsx)(i,{databaseFullPath:a,columnsIds:S,data:f,settings:Dh,onSort:m,sortOrder:h})})]})};var Oh=a(41012),Mh=a(61503),Fh=a(31819),Lh=a(72976);const qh=JSON.parse('{"title_fullscreen":"Fullscreen"}'),zh=(0,ge.g4)("ydb-fullscreen-button",{en:qh});function Uh({disabled:e,view:t="flat-secondary"}){const a=(0,j.YQ)();return(0,c.jsx)(Oe.m,{title:zh("title_fullscreen"),children:(0,c.jsx)(ja.$,{onClick:()=>{a((0,Lh.Jf)())},view:t,disabled:e,children:(0,c.jsx)(Me.I,{data:Fh.A})})})}var Qh,Gh=a(12874);function Bh(){return Bh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Bh.apply(null,arguments)}const $h=function(e){return n.createElement("svg",Bh({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},e),Qh||(Qh=n.createElement("path",{fill:"currentColor",d:"M13.383 6.5a.309.309 0 00.305-.305V5.18a.328.328 0 00-.305-.305H11.25V2.742a.328.328 0 00-.305-.304H9.93a.309.309 0 00-.305.304v3.149c0 .355.254.609.61.609h3.148zm-7.008-.61V2.743a.328.328 0 00-.305-.304H5.055a.309.309 0 00-.305.304v2.133H2.617a.309.309 0 00-.304.305v1.015c0 .178.126.305.304.305h3.149c.33 0 .609-.254.609-.61zm0 7.618v-3.149c0-.33-.28-.609-.61-.609H2.618a.309.309 0 00-.304.305v1.015c0 .178.126.305.304.305H4.75v2.133c0 .178.127.305.305.305H6.07a.309.309 0 00.305-.305zm4.875 0v-2.133h2.133a.309.309 0 00.305-.305v-1.015a.328.328 0 00-.305-.305h-3.149c-.355 0-.609.28-.609.61v3.148c0 .178.127.305.305.305h1.015a.309.309 0 00.305-.305z"})))},Hh=(0,l.cn)("ydb-fullscreen");function Vh({children:e,className:t}){const a=(0,j.N4)((e=>e.fullscreen)),s=(0,j.YQ)(),r=(0,Gh.g)(),i=n.useCallback((()=>{s((0,Lh.sM)())}),[s]);n.useEffect((()=>{const e=e=>{"Escape"===e.key&&i()};return document.addEventListener("keydown",e,!1),()=>{document.removeEventListener("keydown",e,!1)}}),[i]);const[o,l]=n.useState(null);n.useEffect((()=>{var e;const t=document.createElement("div");return null===(e=r.current)||void 0===e||e.appendChild(t),t.style.display="contents",l(t),()=>{l(null),t.remove()}}),[r]);const d=n.useRef(null);return n.useLayoutEffect((()=>{if(o){var e,t;if(a)null===(e=r.current)||void 0===e||e.appendChild(o);else null===(t=d.current)||void 0===t||t.appendChild(o);requestAnimationFrame((()=>{window.dispatchEvent(new Event("resize"))}))}}),[o,r,a]),o?(0,c.jsx)("div",{ref:d,style:{display:"contents"},children:(0,c.jsx)(fc,{container:o,children:(0,c.jsxs)("div",{className:Hh({fullscreen:a},t),children:[(0,c.jsx)(ja.$,{onClick:i,view:"raised",className:Hh("close-button"),children:(0,c.jsx)(Me.I,{data:$h})}),(0,c.jsx)("div",{className:Hh("content"),children:e})]})})}):null}var Wh=a(62783),Jh=a(42265),Kh=a(81101),Yh=a(8864),Zh=a(80563),Xh=a(65264),em=a(62441);const tm=({onUpdate:e,value:t=null,debounce:a=200,...n})=>{const[s,r]=(0,em.o)({value:t,onUpdate:e,debounce:a});return(0,c.jsx)(Xh.Q,{value:s,onUpdate:r,...n})},am=JSON.parse('{"label_offset":"Offset","label_partition":"Partition ID","label_timestamp-create":"Timestamp Create","label_timestamp-write":"Timestamp Write","label_ts_diff":"Write Lag","label_key":"Key","label_metadata":"Metadata","label_message":"Message","label_size":"Size","label_original-size":"Original Size","label_codec":"Codec","label_producerid":"ProducerID","label_seqno":"SeqNo","label_partition-id":"Partition ID: ","context_ts-diff":"Timestamp Write - Timestamp Create, ms","label_full-value":"Full value","label_from":"From: ","label_nothing-found":"Nothing found","description_nothing-found":"Make the filter less strict or start over","action_show-all":"Reset filter","label_by-offset":"By offset","label_by-timestamp":"By timestamp","action_scroll-down":"Scroll to the end","action_scroll-selected":"Scroll to selected offset","action_scroll-up":"Scroll to the start","description_failed-decode":"Failed to decode message","description_truncated":"[truncated]","context_message-not-found":"Message with offset {{offset}} not found","context_get-data-error":"Failed to get message","label_download":"Save message to file","label_truncated":"Truncated {{size}}","description_not-loaded-message":"Message was not fetched in table due to problems with big messages.\\nYou can view it in side panel by clicking on Offset","description_removed-message":"Message was deleted due to retention","description_last-messages":"Only last 50 000 messages from any partition are displayed"}'),nm=(0,ge.g4)("ydb-diagnostics-topic-data",{en:am}),sm="partition",rm="offset",im="timestampCreate",om="timestampWrite",lm="tsDiff",cm="metadata",dm="message",um="size",pm="originalSize",hm="codec",mm="producerID",gm="seqNo",vm={get TIMESTAMP(){return nm("label_by-timestamp")},get OFFSET(){return nm("label_by-offset")}},ym=(0,et.createEnumParam)(["TIMESTAMP","OFFSET"]),xm=(0,et.withDefault)(ym,"TIMESTAMP");function bm(){const[{selectedPartition:e,selectedOffset:t,startTimestamp:a,topicDataFilter:s,activeOffset:r},i]=(0,et.useQueryParams)({selectedPartition:et.StringParam,selectedOffset:et.NumberParam,startTimestamp:et.NumberParam,topicDataFilter:xm,activeOffset:et.StringParam}),o=n.useCallback((e=>{i({selectedPartition:e},"replaceIn")}),[i]),l=n.useCallback((e=>{i({selectedOffset:e||void 0},"replaceIn")}),[i]),c=n.useCallback((e=>{i({activeOffset:e},"replaceIn")}),[i]);return{selectedPartition:e,selectedOffset:t,startTimestamp:a,topicDataFilter:s,activeOffset:r,handleSelectedPartitionChange:o,handleSelectedOffsetChange:l,handleStartTimestampChange:n.useCallback((e=>{i({startTimestamp:e},"replaceIn")}),[i]),handleTopicDataFilterChange:n.useCallback((e=>{i({topicDataFilter:e},"replaceIn")}),[i]),handleActiveOffsetChange:c}}const fm=(0,l.cn)("ydb-diagnostics-topic-data"),jm={get offset(){return nm("label_offset")},get partition(){return nm("label_partition")},get timestampCreate(){return nm("label_timestamp-create")},get timestampWrite(){return nm("label_timestamp-write")},get tsDiff(){return nm("label_ts_diff")},get key(){return nm("label_key")},get metadata(){return nm("label_metadata")},get message(){return nm("label_message")},get size(){return nm("label_size")},get originalSize(){return nm("label_original-size")},get codec(){return nm("label_codec")},get producerID(){return nm("label_producerid")},get seqNo(){return nm("label_seqno")}},Tm={0:"RAW",1:"GZIP",2:"LZOP",3:"ZSTD"};function Sm({handlePartitionChange:e,startOffset:t,endOffset:a,partitions:s,partitionsLoading:r,partitionsError:i,scrollToOffset:o,truncatedData:l}){const{selectedPartition:d}=bm(),u=null===s||void 0===s?void 0:s.map((({partitionId:e})=>({content:String(e),value:String(e)})));return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(O.l,{className:fm("partition-select"),label:nm("label_partition-id"),options:u,value:d?[d]:void 0,onUpdate:e,filterable:s&&s.length>5,disabled:!s||!s.length,errorPlacement:"inside",errorMessage:(0,Va.$)(i),error:Boolean(i),loading:r}),(0,c.jsx)(wm,{scrollToOffset:o}),!(0,Xe.isNil)(t)&&!(0,Xe.isNil)(a)&&a>t&&(0,c.jsxs)(ke.s,{gap:1,children:[(0,c.jsxs)(Re.E,{color:"secondary",whiteSpace:"nowrap",children:[(0,U.ZV)(t),"\u2014",(0,U.ZV)(a-1)]}),l&&(0,c.jsx)(kn.H,{children:nm("description_last-messages")})]})]})}function wm({scrollToOffset:e}){const{selectedOffset:t,startTimestamp:a,topicDataFilter:s,activeOffset:r,handleSelectedOffsetChange:i,handleStartTimestampChange:o,handleTopicDataFilterChange:l}=bm(),d=n.useRef(null),u=!(0,Xe.isNil)(r);n.useEffect((()=>{var e;u&&(null===(e=d.current)||void 0===e||e.blur())}),[u]);const p=n.useCallback((e=>{"TIMESTAMP"===e?i(void 0):o(void 0),l(e)}),[l,i,o]),h=n.useCallback((e=>{i(e)}),[i]),m=n.useCallback((e=>{let t;if(e){const{value:a,type:n}=e;if("absolute"===n)t=a.valueOf();else if("relative"===n){const e=(0,Ie.bQ)(a);t=e?e.valueOf():void 0}}o(t)}),[o]),g=(0,Ie.bQ)(Number(a));return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsxs)(eh.x,{value:s,onUpdate:p,children:[(0,c.jsx)(eh.x.Option,{value:"TIMESTAMP",children:vm.TIMESTAMP}),(0,c.jsx)(eh.x.Option,{value:"OFFSET",children:vm.OFFSET})]}),"OFFSET"===s&&(0,c.jsx)(tm,{controlRef:d,className:fm("offset-input"),max:Number.MAX_SAFE_INTEGER,min:0,value:(0,Xe.isNil)(t)?null:(0,$r.y3)(t),onUpdate:h,label:nm("label_from"),placeholder:nm("label_offset"),debounce:600,endContent:(0,c.jsx)(Oe.m,{title:nm("action_scroll-selected"),children:(0,c.jsx)(ja.$,{disabled:(0,Xe.isNil)(t),className:fm("scroll-button"),view:"flat-action",size:"xs",onClick:()=>{t&&e((0,$r.y3)(t))},children:(0,c.jsx)(Me.I,{size:14,data:Zh.A})})}),autoFocus:!0}),"TIMESTAMP"===s&&(0,c.jsx)(Yh.x,{format:"YYYY-MM-DD HH:mm:ss",placeholder:"YYYY-MM-DD HH:mm:ss",hasClear:!0,isDateUnavailable:e=>e.isAfter((0,Ie.bQ)()),label:nm("label_from"),onUpdate:m,defaultValue:g?{type:"absolute",value:g}:null,className:fm("date-picker")})]})}var Em=a(92159),_m=a(49461),Nm=a(74529);function Cm(e,t){const a=document.createElement("a");a.href=e,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}const Pm=(e,t,a)=>{const n=new Blob([e],{type:a}),s=URL.createObjectURL(n);Cm(s,t),URL.revokeObjectURL(s)},Im=(e,t)=>{const a=JSON.stringify(e,null,2);Pm(a,`${t}.json`,"application/json")},Am=(0,l.cn)("ydb-diagnostics-message-details"),Dm=1e7;function Rm({children:e,title:t,className:a,renderToolbar:n}){return(0,c.jsxs)(ke.s,{direction:"column",className:Am("section",a),children:[(0,c.jsxs)(ke.s,{className:Am("section-title-wrapper"),justifyContent:"space-between",alignItems:"center",children:[t,null===n||void 0===n?void 0:n()]}),(0,c.jsx)("div",{className:Am("section-content"),children:(0,c.jsx)("div",{className:Am("section-scroll-container"),children:e})})]})}function km({offset:e,size:t,message:a}){const s=(0,j.N4)((e=>e.fullscreen)),{preparedMessage:r,decodedMessage:i,convertedMessage:o}=n.useMemo((()=>{let e,n=a,s=a;try{s=atob(a)}catch(r){console.warn(r)}try{const e=JSON.parse(s);n=e&&"object"===typeof e?e:s}catch(r){n=s,console.warn(r)}return"object"===typeof n&&(0,$r.y3)(t)<=1e6?e=(0,gs.lu)(n):n&&"object"===typeof n&&(n=JSON.stringify(n,null,2)),{preparedMessage:n,decodedMessage:s,convertedMessage:e}}),[a,t]),l=Boolean(o)?(0,c.jsx)(ms.p,{collapsedInitially:!0,value:o,maxValueWidth:50,toolbarClassName:Am("json-viewer-toolbar")},String(s)):(0,c.jsx)("div",{className:Am("string-message"),children:(0,c.jsx)(Nm.A,{value:r,limit:2e3},String(s))}),d=(0,$r.y3)(t)>Dm;return(0,c.jsx)(Rm,{title:(0,c.jsx)(Om,{truncated:d}),renderToolbar:()=>(0,c.jsxs)(ke.s,{gap:1,children:[(0,c.jsx)(Oe.m,{title:nm("label_download"),children:(0,c.jsx)(ja.$,{view:"flat-secondary",onClick:t=>{t.stopPropagation(),Pm(i,`topic-message-${null!==e&&void 0!==e?e:"unknown-offset"}`)},children:(0,c.jsx)(Me.I,{data:Em.A})})}),(0,c.jsx)(_m.b,{view:"flat-secondary",text:i})]}),className:Am("message"),children:l})}function Om({truncated:e}){return(0,c.jsxs)("span",{children:[nm("label_message"),e&&(0,c.jsxs)(n.Fragment,{children:[" ",(0,c.jsxs)(Re.E,{color:"secondary",children:["[",nm("label_truncated",{size:(0,$r.IG)(Dm)}),"]"]})]})]})}var Mm=a(94420);const Fm=(0,l.cn)("ydb-diagnostics-topic-data-columns"),Lm={name:rm,header:jm[rm],align:Ht.Ay.LEFT,render:({row:e})=>{const{Offset:t,removed:a,notLoaded:n}=e;return(0,c.jsx)(Zm,{offset:t,removed:a,notLoaded:n})},width:100},qm={name:im,header:(0,c.jsx)(Cp,{title:jm[im]}),align:Ht.Ay.LEFT,render:({row:{CreateTimestamp:e}})=>e?(0,c.jsx)(ii.c,{showStatus:!1,renderName:()=>(0,c.jsx)(Ym,{timestamp:e}),name:(0,U.Ey)(e),hasClipboardButton:!0}):f.Pd,width:220},zm={name:om,header:(0,c.jsx)(Cp,{title:jm[om]}),align:Ht.Ay.LEFT,render:({row:{WriteTimestamp:e}})=>e?(0,c.jsx)(ii.c,{showStatus:!1,renderName:()=>(0,c.jsx)(Ym,{timestamp:e}),name:(0,U.Ey)(e),hasClipboardButton:!0}):f.Pd,width:220},Um={name:lm,header:jm[lm],align:Ht.Ay.RIGHT,render:({row:{TimestampDiff:e}})=>(0,c.jsx)(Xm,{value:e}),width:110,note:nm("context_ts-diff")},Qm={name:cm,header:jm[cm],align:Ht.Ay.LEFT,render:({row:{MessageMetadata:e}})=>{if(!e)return f.Pd;return e.map((({Key:e="",Value:t=""})=>`${e}: ${t}`)).join(", ")},width:200},Gm={name:dm,header:jm[dm],align:Ht.Ay.LEFT,render:({row:{Message:e,OriginalSize:t}})=>(0,c.jsx)(eg,{message:e,size:t}),width:500},Bm={name:um,header:jm[um],align:Ht.Ay.RIGHT,render:({row:{StorageSize:e}})=>(0,c.jsx)(tg,{size:e}),width:100},$m={name:pm,header:(0,c.jsx)(Cp,{title:jm[pm]}),align:Ht.Ay.RIGHT,render:({row:e})=>(0,U.z3)(e.OriginalSize),width:100},Hm={name:hm,header:jm[hm],align:Ht.Ay.RIGHT,render:({row:{Codec:e}})=>{var t;return(0,Xe.isNil)(e)?f.Pd:null!==(t=Tm[e])&&void 0!==t?t:e},width:70},Vm={name:mm,header:jm[mm],align:Ht.Ay.LEFT,render:({row:e})=>e.ProducerId?(0,c.jsx)(ii.c,{showStatus:!1,name:e.ProducerId,hasClipboardButton:!0}):f.Pd,width:100},Wm={name:gm,header:jm[gm],align:Ht.Ay.RIGHT,render:({row:e})=>e.SeqNo?(0,c.jsx)(ii.c,{showStatus:!1,name:e.SeqNo,hasClipboardButton:!0}):f.Pd,width:100};const Jm=["offset","timestampCreate","tsDiff","message"],Km=["offset"];function Ym({timestamp:e}){if(!e)return f.Pd;const t=(0,U.Ey)(e).split("."),a=t.pop();return(0,c.jsxs)(Re.E,{variant:"body-2",children:[t.join("."),(0,c.jsxs)(Re.E,{color:"secondary",variant:"body-2",children:[".",a]})]})}function Zm({offset:e,removed:t,notLoaded:a}){const n=Vl(),{handleActiveOffsetChange:s}=bm();if((0,Xe.isNil)(e))return f.Pd;if(t)return(0,c.jsx)(Oe.m,{title:nm("description_removed-message"),placement:"right",children:(0,c.jsx)(Re.E,{className:Fm("offset",{removed:!0}),variant:"body-2",children:e})});const r=n(E.iJ.topicData,{activeOffset:String(e)});return(0,c.jsxs)(Lo.N_,{to:r,onClick:t=>{t.stopPropagation(),t.preventDefault();const a=String(e);s(a)},className:Fm("offset",{link:!0}),children:[(0,c.jsx)(Re.E,{variant:"body-2",color:"info",children:e}),a&&(0,c.jsx)(jn.A,{content:(0,c.jsx)(Re.E,{className:Fm("help"),children:nm("description_not-loaded-message")}),className:Fm("help-popover"),children:(0,c.jsx)(Re.E,{color:"secondary",className:Fm("help-popover"),children:(0,c.jsx)(Me.I,{data:Mm.A})})})]})}function Xm({value:e,baseColor:t="primary",variant:a="body-2"}){if((0,Xe.isNil)(e))return f.Pd;const n=(0,$r.y3)(e);return(0,c.jsx)(Re.E,{variant:a,color:n>=1e5?"danger":t,children:(0,He.Xo)(n)})}function eg({message:e,size:t}){if((0,Xe.isNil)(e))return f.Pd;let a,n=!1;try{a=atob(e)}catch{a=nm("description_failed-decode"),n=!0}const s=(0,$r.y3)(t)>100;return(0,c.jsxs)(Re.E,{variant:"body-2",color:n?"secondary":"primary",className:Fm("message",{invalid:n}),children:[a,s&&(0,c.jsxs)(Re.E,{color:"secondary",className:Fm("truncated"),children:[" ",nm("description_truncated")]})]})}function tg({size:e}){return(0,U.z3)(e)}function ag(e,t=f.Pd){return(0,Xe.isNil)(e)?t:e}const ng={name:sm,header:jm[sm],render:()=>(0,c.jsx)(cg,{})},sg={name:rm,header:jm[rm],render:({row:e})=>ag(e.Offset)},rg={name:im,header:jm[im],render:({row:e})=>(0,c.jsx)(Ym,{timestamp:e.CreateTimestamp})},ig={name:om,header:jm[om],render:({row:e})=>(0,c.jsx)(Ym,{timestamp:e.WriteTimestamp})},og={name:mm,header:jm[mm],render:({row:e})=>ag(e.ProducerId)},lg={name:gm,header:jm[gm],render:({row:e})=>ag(e.SeqNo)};function cg(){const{selectedPartition:e}=bm();return e}const dg=[ng,sg,rg,ig,Um,Qm,Gm,Bm,$m,Hm,og,lg],ug=[[{name:sm},{name:rm},{name:um}],[{name:im,copy:e=>(0,U.Ey)(e.CreateTimestamp)},{name:om,copy:e=>(0,U.Ey)(e.WriteTimestamp)},{name:lm}],[{name:pm},{name:hm},{name:mm,copy:e=>e.ProducerId},{name:gm,copy:e=>e.SeqNo}]];function pg({messageData:e}){return(0,c.jsx)(ke.s,{direction:"column",gap:3,className:Am("details"),children:ug.map(((t,a)=>(0,c.jsx)(Qs.u,{className:Am("list"),nameMaxWidth:200,children:t.map((t=>{var a,n;const s=dg.find((e=>e.name===t.name)),r=null===(a=t.copy)||void 0===a?void 0:a.call(t,e);return(0,c.jsx)(Qs.u.Item,{name:null===s||void 0===s?void 0:s.header,copyText:r,children:null===s||void 0===s||null===(n=s.render)||void 0===n?void 0:n.call(s,{row:e})},t.name)}))},a)))})}function hg({data:e}){return(0,c.jsx)(Rm,{title:nm("label_metadata"),children:(0,c.jsx)(Qs.u,{nameMaxWidth:200,className:Am("message-meta"),children:e.map((e=>(0,c.jsx)(Qs.u.Item,{name:e.Key,copyText:e.Value,children:e.Value},e.Key)))})})}function mg({database:e,path:t}){var a;const{selectedPartition:s,activeOffset:r}=bm(),o=n.useMemo((()=>{if((0,Xe.isNil)(s)||(0,Xe.isNil)(r))return xp.hT;const a={database:e,path:t,partition:s,limit:1,message_size_limit:Dm},n=(0,$r.y3)(r);return a.offset=n,a.last_offset=n+1,a}),[s,r,e,t]),{currentData:l,error:d,isFetching:u}=mn.useGetTopicDataQuery(o),p=null===l||void 0===l||null===(a=l.Messages)||void 0===a?void 0:a[0],h=()=>{const e=null===p||void 0===p?void 0:p.MessageMetadata;return e?(0,c.jsx)(hg,{data:e}):null},m=()=>{const e=null===p||void 0===p?void 0:p.Message;return e?(0,c.jsx)(km,{message:e,offset:p.Offset,size:p.OriginalSize}):null};return(0,c.jsx)(i.r,{loading:u,children:(0,c.jsx)("div",{className:Am(),children:(()=>{var e;const t=(0,T.cH)(d),a=t&&404===d.status,n=l&&!(null!==(e=l.Messages)&&void 0!==e&&e.length);if(Boolean(n||a))return(0,c.jsxs)(ke.s,{direction:"column",grow:"grow",alignItems:"center",justifyContent:"center",height:"100%",children:[(0,c.jsx)(Re.E,{variant:"subheader-2",children:nm("context_message-not-found",{offset:r})}),(0,c.jsx)(Me.I,{data:Fc,size:100})]});if(d){let e=nm("context_get-data-error");return t&&"string"===typeof d.data?e=d.data:t&&d.statusText&&(e=d.statusText),(0,c.jsx)(Re.E,{color:"danger",variant:"body-2",children:e})}return(0,c.jsxs)(ke.s,{direction:"column",gap:4,children:[p?(0,c.jsx)(pg,{messageData:p}):null,h(),m()]})})()})})}const gg={data:[],total:0,found:0};const vg=({setBoundOffsets:e,baseOffset:t=0})=>async({limit:a,offset:n,filters:s})=>{if(!s)return gg;const{partition:r,isEmpty:i,...o}=s;if((0,Xe.isNil)(r)||""===r||i)return gg;const l=t+n,c={...o,partition:r,limit:a,last_offset:l+a,message_size_limit:100};c.offset=l;const d=await window.api.viewer.getTopicData(c),{start:u,end:p,messages:h}=function(e,t){const{StartOffset:a,EndOffset:n,Messages:s=[]}=e,r=(0,$r.y3)(a),i=(0,$r.y3)(n),o=[],l=Math.min(20,Math.max(i-t,0));let c=0,d=0;for(;d<l;){const e=t+d,a=s[c];e<r?o.push({Offset:e,removed:!0}):(0,Xe.isNil)(null===a||void 0===a?void 0:a.Offset)||String(a.Offset)!==String(e)?o.push({Offset:e,notLoaded:!0}):(o.push(a),c++),d++}return{start:r,end:i,messages:o}}(d,l);e({startOffset:u,endOffset:p});const m=p-t;return{data:h,total:m,found:m}},yg=[Lm,qm,zm,Um,Qm,Gm,Bm,$m,Hm,Vm,Wm];function xg({scrollContainerRef:e,path:t,database:a,databaseFullPath:s}){const[i]=(0,j.Nt)(),[o,l]=n.useState(),[d,u]=n.useState(),[p,h]=n.useState(0),[m,g]=n.useState(!1),[v,y]=n.useState(),[x,b]=n.useState(!1),[f,T]=n.useState(),{selectedPartition:S,selectedOffset:w,startTimestamp:E,topicDataFilter:_,activeOffset:N,handleSelectedOffsetChange:C,handleStartTimestampChange:P,handleSelectedPartitionChange:I,handleActiveOffsetChange:A}=bm();n.useEffect((()=>()=>{I(void 0),C(void 0),P(void 0)}),[I,C,P]);const D=n.useMemo((()=>{if((0,Xe.isNil)(S))return xp.hT;const e={database:a,path:t,partition:S,limit:1};return E?e.read_timestamp=E:e.offset=(0,$r.y3)(w),e}),[S,w,E,a,t]),{currentData:R,error:k,isFetching:O}=mn.useGetTopicDataQuery(D),{data:M,isLoading:F,error:L}=jp.aD.useGetPartitionsQuery({path:t,database:a,databaseFullPath:s},{pollingInterval:i}),q=n.useRef(S);n.useEffect((()=>{const e=S!==q.current,t=null===M||void 0===M?void 0:M.find((({partitionId:e})=>e===S));if(t){let n=f;if(f&&!e||(n=(0,$r.y3)(t.endOffset),T(n)),!v||e){var a;const e=(0,$r.y3)(t.startOffset),s=Math.max((null!==(a=n)&&void 0!==a?a:0)-5e4,e);b(s!==e),y(s)}}e&&(q.current=S)}),[S,M,f,v]),n.useEffect((()=>{if(M&&M.length&&(0,Xe.isNil)(S)){const e=M[0].partitionId;I((0,Xe.isNil)(e)?void 0:String(e))}}),[M,S,I]);const{columnsToShow:z,columnsToSelect:U,setColumns:Q}=(0,Yp.K)(yg,"topicDataSelectedColumns",jm,Jm,Km),G=n.useCallback((({startOffset:e,endOffset:t})=>{l(e),u(t)}),[]);n.useEffect((()=>{var e,t;O||!R&&!k||(null!==R&&void 0!==R&&null!==(e=R.Messages)&&void 0!==e&&e.length||!R&&!k?g(!1):R&&null!==(t=R.Messages)&&void 0!==t&&t.length&&!k||g(!0),R&&G({startOffset:(0,$r.y3)(R.StartOffset),endOffset:(0,$r.y3)(R.EndOffset)}))}),[O,R,k,G]);const B=n.useMemo((()=>({path:t,database:a,partition:null!==S&&void 0!==S?S:"",isEmpty:m})),[t,a,S,m]),$=n.useCallback((()=>{C(void 0),P(void 0),"TIMESTAMP"===_&&h((e=>e+1))}),[C,P,_]),H=n.useCallback((e=>{I(e[0]),$()}),[I,$]),V=n.useCallback((t=>{const a=(t-(null!==v&&void 0!==v?v:0))*Wh.U3,n=Math.max(0,a);requestAnimationFrame((()=>{var t;null===(t=e.current)||void 0===t||t.scrollTo({top:n,behavior:"instant"})}))}),[v,e]),W=n.useRef(null!==w&&void 0!==w?w:N);n.useEffect((()=>{if(O||(0,Xe.isNil)(v))return;let e;if((0,Xe.isNil)(W.current)){const t=null===R||void 0===R?void 0:R.Messages;null!==t&&void 0!==t&&t.length&&(e=(0,$r.y3)(t[0].Offset))}else e=(0,$r.y3)(W.current),W.current=void 0;(0,Xe.isNil)(e)||V(e)}),[R,O,V,v]);const J=n.useCallback((()=>(0,c.jsx)(Sm,{handlePartitionChange:H,partitions:M,partitionsLoading:F,partitionsError:L,startOffset:o,endOffset:d,truncatedData:x,scrollToOffset:V},p)),[p,d,M,L,F,V,o,x,H]),K=n.useCallback((()=>(0,c.jsx)(bp.O,{popupWidth:242,items:U,showStatus:!0,onUpdate:Q})),[U,Q]),Y=n.useMemo((()=>vg({setBoundOffsets:G,baseOffset:v})),[v,G]),Z=n.useCallback((()=>{A(void 0)}),[A]),X=n.useCallback((()=>(0,c.jsx)(Vh,{children:(0,c.jsx)(mg,{database:a,path:t})})),[a,t]);return k?(0,c.jsx)(r.A,{error:k,position:"left"}):!(0,Xe.isNil)(v)&&!(0,Xe.isNil)(f)&&(0,c.jsx)(Sc,{isDrawerVisible:!(0,Xe.isNil)(N),onCloseDrawer:Z,renderDrawerContent:X,drawerId:"topic-data-details",storageKey:"topic-data-details-drawer-width",detectClickOutside:!0,isPercentageWidth:!0,drawerControls:[{type:"copyLink",link:window.location.href},{type:"custom",node:(0,c.jsx)(Uh,{disabled:Boolean(k),view:"flat"}),key:"fullscreen"},{type:"close"}],title:nm("label_message"),headerClassName:fm("drawer-header"),children:(0,c.jsx)(Jh.o,{controls:J(),extraControls:K(),table:(0,c.jsx)(Wh.k5,{columnsWidthLSKey:"topicDataColumnsWidth",scrollContainerRef:e,columns:z,fetchData:Y,initialEntitiesCount:f-v,limit:20,renderErrorMessage:Kh.$,renderEmptyDataMessage:()=>{const e=w||E;return(0,c.jsx)(Mh.U,{title:nm("label_nothing-found"),message:nm("description_nothing-found"),onShowAll:e?$:void 0,showAll:nm("action_show-all"),image:(0,c.jsx)(Oh.oN,{width:230,height:230})})},filters:B,tableName:"topicData",rowHeight:Wh.U3,keepCache:!1,getRowClassName:e=>fm("row",{active:Boolean((0,$r.y3)(e.Offset)===w||String(e.Offset)===N),removed:e.removed})}),tableWrapperProps:{scrollContainerRef:e,scrollDependencies:[v,f,B]},noBatching:!0})})}const bg=JSON.parse('{"no-data":"No data"}'),fg=(0,ge.g4)("ydb-diagnostics",{en:bg}),jg=(0,l.cn)("kv-tenant-diagnostics");const Tg=function({additionalTenantProps:e}){var t,a;const{path:r,database:i,type:o,subType:l,databaseFullPath:d}=ba(),u=n.useRef(null),p=(0,j.YQ)(),{diagnosticsTab:h=E.iJ.overview}=(0,j.N4)((e=>e.tenant)),m=Vl(),{controlPlane:g,databaseType:v}=(0,x.Ry)(Dt(o)?i:""),{monitoring:y}=(0,A.Zd)(),f=(0,I.RK)(),T=(0,I._p)(),S=(0,D.b)(),w=Hl(o,l,{hasTopicData:T,isTopLevel:r===i,hasBackups:"function"===typeof b.J.renderBackups&&Boolean(g),hasConfigs:S&&f,hasAccess:b.J.hasAccess,hasMonitoring:(0,R.P)(g,y),databaseType:v});let O=w.find((e=>e.id===h));return O||(O=w[0]),n.useEffect((()=>{O&&O.id!==h&&p((0,x.WO)(O.id))}),[O,h,p]),(0,j.Mq)(u,`tenant-diagnostics-${i}-${null===(t=O)||void 0===t?void 0:t.id}`,(null===(a=O)||void 0===a?void 0:a.id)===E.iJ.overview),(0,c.jsxs)("div",{className:jg(),children:[O?(0,c.jsx)(s.mg,{children:(0,c.jsx)("title",{children:O.title})}):null,(()=>{var e;return(0,c.jsx)("div",{className:jg("header-wrapper"),children:(0,c.jsxs)("div",{className:jg("tabs"),children:[(0,c.jsx)(_.f,{value:null===(e=O)||void 0===e?void 0:e.id,children:(0,c.jsx)(N.w,{size:"l",children:w.map((({id:e,title:t,badge:a})=>(0,c.jsx)(Cu,{id:e,title:t,linkPath:m(e),badge:a},e)))})}),(0,c.jsx)(C.E,{})]})})})(),(0,c.jsx)(P.e,{children:(0,c.jsx)("div",{className:jg("page-wrapper"),ref:u,children:(()=>{var t;switch(null===(t=O)||void 0===t?void 0:t.id){case E.iJ.overview:return(0,c.jsx)(Eu,{type:o,database:i,path:r,databaseFullPath:d,additionalTenantProps:e});case E.iJ.schema:return(0,c.jsx)(va,{path:r,database:i,databaseFullPath:d,type:o,extended:!0});case E.iJ.topQueries:return(0,c.jsx)(Th,{database:i});case E.iJ.topShards:return(0,c.jsx)(kh,{database:i,path:r,databaseFullPath:d});case E.iJ.nodes:return(0,c.jsx)(de.G,{path:r,databaseFullPath:d,database:i,scrollContainerRef:u});case E.iJ.access:return(0,c.jsx)(dn,{});case E.iJ.tablets:return(0,c.jsx)(rt.C,{scrollContainerRef:u,path:r,databaseFullPath:d,database:i});case E.iJ.storage:return(0,c.jsx)(st.z,{database:i,scrollContainerRef:u});case E.iJ.network:return(0,c.jsx)(yp,{path:r,databaseFullPath:d,database:i,scrollContainerRef:u});case E.iJ.describe:return(0,c.jsx)(ys,{path:r,databaseFullPath:d,database:i});case E.iJ.hotKeys:return(0,c.jsx)(Fu,{path:r,databaseFullPath:d,database:i});case E.iJ.graph:return(0,c.jsx)(ce,{path:r,databaseFullPath:d,database:i});case E.iJ.consumers:return(0,c.jsx)(hs,{path:r,databaseFullPath:d,database:i,type:o});case E.iJ.partitions:return(0,c.jsx)(Xp,{path:r,databaseFullPath:d,database:i});case E.iJ.topicData:return(0,c.jsx)(xg,{path:r,databaseFullPath:d,database:i,scrollContainerRef:u},r);case E.iJ.configs:return(0,c.jsx)(k.U,{database:i});case E.iJ.operations:return(0,c.jsx)(nt,{database:i,scrollContainerRef:u});case E.iJ.backups:var a;return null===(a=b.J.renderBackups)||void 0===a?void 0:a.call(b.J,{database:i,scrollContainerRef:u});case E.iJ.monitoring:var n;return null===(n=b.J.renderMonitoring)||void 0===n?void 0:n.call(b.J,{type:o,subType:l,database:i,path:r,databaseFullPath:d,additionalTenantProps:e,scrollContainerRef:u});default:return(0,c.jsx)("div",{children:fg("no-data")})}})()})})]})},Sg=(0,l.cn)("kv-truncated-query"),wg=({value:e="",maxQueryHeight:t=6,hasClipboardButton:a,clipboardButtonAlwaysVisible:s})=>{const r=e.split("\n");if(r.length>t){const i=r.slice(0,t).join("\n"),o="\n...\nThe request was truncated. Click on the line to show the full query on the query tab";return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(dr.YDBSyntaxHighlighter,{language:"yql",className:Sg(),text:i,withClipboardButton:a?{alwaysVisible:s,copyText:e,withLabel:!1}:void 0}),(0,c.jsx)("span",{className:Sg("message",{color:"secondary"}),children:o})]})}return(0,c.jsx)(dr.YDBSyntaxHighlighter,{language:"yql",className:Sg(),text:e,withClipboardButton:a?{alwaysVisible:s,copyText:e,withLabel:!1}:void 0})},Eg=JSON.parse('{"action_cancel":"Cancel"}'),_g=(0,ge.g4)("ydb-confirmation-dialog",{en:Eg}),Ng=(0,l.cn)("confirmation-dialog"),Cg="confirmation-dialog";function Pg({caption:e="",children:t,onConfirm:a,onClose:n,progress:s,textButtonApply:r,textButtonCancel:i,buttonApplyView:o="normal",className:l,renderButtons:d,open:u}){return(0,c.jsxs)($a.l,{className:Ng(null,l),size:"s",onClose:n,disableOutsideClick:!0,open:u,children:[(0,c.jsx)($a.l.Header,{caption:(0,c.jsx)("span",{className:Ng("caption"),children:e})}),(0,c.jsx)($a.l.Body,{children:t}),(0,c.jsx)($a.l.Footer,{onClickButtonApply:a,propsButtonApply:{view:o},textButtonApply:r,textButtonCancel:null!==i&&void 0!==i?i:_g("action_cancel"),onClickButtonCancel:n,loading:s,renderButtons:d})]})}const Ig=Ba.vt((e=>{const t=Ba.hS(),a=()=>{t.hide(),t.remove()};return(0,c.jsx)(Pg,{...e,onConfirm:async()=>{var n;await(null===(n=e.onConfirm)||void 0===n?void 0:n.call(e)),t.resolve(!0),a()},onClose:()=>{var n;null===(n=e.onClose)||void 0===n||n.call(e),t.resolve(!1),a()},open:t.visible})}));Ba.kz(Cg,Ig);var Ag=a(36894);function Dg(){const[e]=(0,j.iK)(Oo.GS.SAVED_QUERIES,[]);return e}const Rg=JSON.parse('{"action.save":"Save query","action.edit":"Edit query","action.save-as-new":"Save as new","action.edit-existing":"Edit existing","description":"The query will be saved in your browser","input-label":"Query name","input-placeholder":"Enter query name","button-apply":"Save","button-cancel":"Cancel","error.name-exists":"This name already exists","error.name-not-empty":"Name should not be empty"}'),kg=(0,ge.g4)("ydb-save-query-dialog",{en:Rg}),Og=(0,l.cn)("ydb-save-query");function Mg(e){const t=(0,j.YQ)();return n.useCallback((()=>{Ba.Ay.show(zg,e),t((0,Ag.gJ)())}),[t,e])}function Fg({dialogProps:e,...t}){const a=Mg(e);return(0,c.jsx)(ja.$,{onClick:a,...t,children:kg("action.save")})}function Lg({buttonProps:e={}}){const t=(0,j.YQ)(),a=(0,j.N4)(Ag.aW),n=Mg(),s=()=>{t((0,Ag.Wg)(a)),t((0,wc.Xb)(!1)),t((0,Ag.gJ)())};return a?(()=>{const t=[{action:s,text:kg("action.edit-existing")},{action:n,text:kg("action.save-as-new")}];return(0,c.jsx)(Ei.r,{items:t,renderSwitcher:t=>(0,c.jsx)(ja.$,{...t,...e,children:kg("action.edit")}),popupProps:{placement:"top"}})})():(0,c.jsx)(Fg,{})}function qg({onSuccess:e,onCancel:t,onClose:a,open:s}){const r=Dg(),i=(0,j.YQ)(),[o,l]=n.useState(""),[d,u]=n.useState(),p=()=>{i((0,Ag.NJ)("idle")),l(""),u(void 0),null===a||void 0===a||a()},h=()=>{null===t||void 0===t||t(),p()};return(0,c.jsxs)($a.l,{open:s,hasCloseButton:!1,size:"s",onClose:h,children:[(0,c.jsx)($a.l.Header,{caption:kg("action.save")}),(0,c.jsxs)("form",{onSubmit:t=>{t.preventDefault();const a=(n=o)?r.some((e=>e.name.toLowerCase()===n.trim().toLowerCase()))?kg("error.name-exists"):void 0:kg("error.name-not-empty");var n;u(a),a||(i((0,Ag.Wg)(o)),i((0,wc.Xb)(!1)),p(),null===e||void 0===e||e())},children:[(0,c.jsxs)($a.l.Body,{className:Og("dialog-body"),children:[(0,c.jsx)("div",{className:Og("dialog-row"),children:kg("description")}),(0,c.jsxs)("div",{className:Og("dialog-row"),children:[(0,c.jsx)("label",{htmlFor:"queryName",className:Og("field-title","required"),children:kg("input-label")}),(0,c.jsx)("div",{className:Og("control-wrapper"),children:(0,c.jsx)(Ha.k,{id:"queryName",placeholder:kg("input-placeholder"),value:o,onUpdate:e=>{l(e),u(void 0)},hasClear:!0,autoFocus:!0,autoComplete:!1,validationState:d?"invalid":void 0,errorMessage:d})})]})]}),(0,c.jsx)($a.l.Footer,{textButtonApply:kg("button-apply"),textButtonCancel:kg("button-cancel"),onClickButtonCancel:h,propsButtonApply:{type:"submit"}})]})]})}const zg="save-query-dialog",Ug=Ba.Ay.create((e=>{const t=Ba.Ay.useModal();return(0,c.jsx)(qg,{...e,onClose:()=>{var a;null===(a=e.onClose)||void 0===a||a.call(e),t.hide(),t.remove()},open:t.visible})}));Ba.Ay.register(zg,Ug);const Qg=JSON.parse('{"action_apply":"Don\'t save","context_unsaved-changes-warning":"You have unsaved changes in query editor.\\nDo you want to proceed?"}'),Gg=(0,ge.g4)("ydb-change-input-confirmation",{en:Qg});function Bg(){const e=Ba.Ay.useModal(Cg),t=n.useCallback((()=>{e.hide(),e.remove()}),[e]),a=n.useCallback((()=>{e.resolve(!0),t()}),[e,t]),s=n.useCallback((()=>{e.resolve(!1),t()}),[t,e]),r=n.useMemo((()=>({onSuccess:a,onCancel:s})),[a,s]);return(0,c.jsx)(Fg,{view:"action",size:"l",dialogProps:r})}async function $g(){return await Ba.Ay.show(Cg,{id:Cg,caption:Gg("context_unsaved-changes-warning"),textButtonApply:Gg("action_apply"),propsButtonApply:{view:"l"},renderButtons:(e,t)=>(0,c.jsxs)(n.Fragment,{children:[t,(0,c.jsx)(Bg,{}),e]})})}function Hg(e){const t=(0,j.N4)(wc.Wp),a=(0,j.N4)(wc.TY),s=n.useMemo((()=>function(e){return async t=>{await $g()&&e(t)}}(e)),[e]);return t&&a?s:e}const Vg=JSON.parse('{"controls.query-mode-selector_type":"Query type:","tabs.newQuery":"Editor","tabs.history":"History","tabs.saved":"Saved","history.empty":"History is empty","history.empty-search":"Search result is empty","saved.empty":"There are no saved queries","delete-dialog.header":"Delete query","delete-dialog.question":"Are you sure you want to delete query","delete-dialog.delete":"Delete","delete-dialog.cancel":"Cancel","preview.title":"Preview","preview.not-available":"Preview is not available","preview.close":"Close preview","preview.truncated":"truncated","method-description.script":"For YQL-scripts combining DDL and DML.\\nAPI call: schema.scripting","method-description.scan":"Read-only queries, potentially reading a lot of data.\\nAPI call: table.ExecuteScan","method-description.data":"DML queries for changing and fetching data in serialization mode.\\nAPI call: table.executeDataQuery","method-description.query":"Any query. An experimental API call supposed to replace all existing methods.\\nAPI Call: query.ExecuteScript","method-description.pg":"Queries in postgresql syntax.\\nAPI call: query.ExecuteScript","transaction-mode-description.serializable":"Provides the strictest isolation level for custom transactions","transaction-mode-description.onlinero":"Each read operation in the transaction is reading the data that is most recent at execution time","transaction-mode-description.stalero":"Read operations within a transaction may return results that are slightly out-of-date (lagging by fractions of a second)","transaction-mode-description.snapshot":"All the read operations within a transaction access the database snapshot. All the data reads are consistent","transaction-mode-description.implicit":"No transaction","tracing-level-description.basic":"Spans of main component operations","tracing-level-description.detailed":"Highest detail applicable for diagnosing problems in production","tracing-level-description.diagnostic":"Detailed debugging information for developers","tracing-level-description.off":"No tracing","tracing-level-description.toplevel":"Lowest detail, no more than two spans per request to the component","tracing-level-description.trace":"Very detailed debugging information","statistics-mode-description.none":"Don\'t collect statistics","statistics-mode-description.basic":"Collect statistics","statistics-mode-description.full":"Collect statistics and query plan","statistics-mode-description.profile":"Collect statistics for individual tasks","action.send-query":"Send query","action.send-selected-query":"Send selected query","action.previous-query":"Previous query in history","action.next-query":"Next query in history","action.save-query":"Save query","action.stop":"Stop","action.run":"Run","action.explain":"Explain","action.open-shortcuts":"Open Keyboard Shortcuts Panel","filter.text.placeholder":"Search by query text...","gear.tooltip":"Query execution settings have been changed for ","banner.query-settings.message":"Query was executed with modified settings: ","banner.query-stopped.message":"Data is not up to date because the request was not completed.","banner.query-stopped.never-show":"Never show again","toaster.stop-error":"Something went wrong. Unable to stop request processing. Please wait.","history.queryText":"Query text","history.endTime":"End time","history.duration":"Duration"}'),Wg=(0,ge.g4)("ydb-query-editor",{en:Vg}),Jg=(0,l.cn)("ydb-queries-history");const Kg=function({changeUserInput:e}){const t=(0,j.YQ)(),a=(0,j.N4)(wc.py),n=(0,j.N4)(wc.jY),s=[...a].reverse(),r=Hg((a=>{e({input:a.queryText}),t((0,wc.Xb)(!1)),t((0,x.sH)(E.tQ.newQuery))})),i=[{name:"queryText",header:Wg("history.queryText"),render:({row:e})=>(0,c.jsx)("div",{className:Jg("query"),children:(0,c.jsx)(wg,{value:e.queryText,maxQueryHeight:6})}),sortable:!1,width:600},{name:"EndTime",header:Wg("history.endTime"),render:({row:e})=>e.endTime?(0,U.r6)(e.endTime.toString()):"-",align:"right",width:200,sortable:!1},{name:"Duration",header:Wg("history.duration"),render:({row:e})=>e.durationUs?(0,He.Xo)((0,He.Jc)(e.durationUs)):"-",align:"right",width:150,sortable:!1}];return(0,c.jsxs)(he.L,{className:Jg(),children:[(0,c.jsx)(he.L.Controls,{children:(0,c.jsx)(me.v,{value:n,onChange:e=>{t((0,wc.Ni)(e))},placeholder:Wg("filter.text.placeholder"),className:Jg("search")})}),(0,c.jsx)(he.L.Table,{children:(0,c.jsx)(ue.l,{columnsWidthLSKey:"queriesHistoryTableColumnsWidth",columns:i,data:s,settings:Cc,emptyDataMessage:Wg(n?"history.empty-search":"history.empty"),onRowClick:e=>r(e),rowClassName:()=>Jg("table-row")})})]})};var Yg=a(72093);function Zg(e,t){const a=new Map(Object.entries(e)),n=new Map(Object.entries(t));return Array.from(a.keys()).filter((e=>a.has(e)&&void 0!==a.get(e)&&a.get(e)!==n.get(e)))}const Xg=JSON.parse('{"action.settings":"Query settings","form.query-mode":"Query type","form.timeout":"Timeout","form.transaction-mode":"Transaction mode","form.statistics-mode":"Statistics collection mode","form.tracing-level":"Tracing level","form.limit-rows":"Limit rows","form.pragmas":"Pragmas","button-done":"Save","tooltip_plan-to-svg-statistics":"Statistics option is set to \\"Full\\" due to the enabled \\"Execution plan\\" experiment.\\n To disable it, go to the \\"Experiments\\" section in the user settings.","button-cancel":"Cancel","form.timeout.seconds":"sec","form.limit.rows":"rows","form.timeout.disabled":"Not available to turn off in this query type","form.validation.timeout":"Must be positive","form.validation.limitRows":"Must be between 1 and 100000","description.default":" (default)","docs":"Documentation"}'),ev=JSON.parse('{"action.settings":"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430","form.query-mode":"\u0422\u0438\u043f \u0437\u0430\u043f\u0440\u043e\u0441\u0430","form.timeout":"\u0422\u0430\u0439\u043c\u0430\u0443\u0442","form.transaction-mode":"\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438","form.statistics-mode":"\u0420\u0435\u0436\u0438\u043c \u0441\u0431\u043e\u0440\u0430 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438","form.tracing-level":"Tracing level","form.limit-rows":"\u041b\u0438\u043c\u0438\u0442 \u0441\u0442\u0440\u043e\u043a","form.pragmas":"\u041f\u0440\u0430\u0433\u043c\u044b","tooltip_plan-to-svg-statistics":"\u041e\u043f\u0446\u0438\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u0432 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \\"Full\\" \u0438\u0437-\u0437\u0430 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u043e\u0433\u043e \u044d\u043a\u0441\u043f\u0435\u0440\u0438\u043c\u0435\u043d\u0442\u0430 \\"Execution plan\\".\\n \u0427\u0442\u043e\u0431\u044b \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0435\u0433\u043e, \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b \\"Experiments\\" \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f.","button-done":"\u0413\u043e\u0442\u043e\u0432\u043e","button-cancel":"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c","form.timeout.seconds":"\u0441\u0435\u043a","form.limit.rows":"\u0441\u0442\u0440\u043e\u043a","form.timeout.disabled":"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0434\u043b\u044f \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0442\u0438\u043f\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u0430","form.validation.timeout":"\u0422\u0430\u0439\u043c\u0430\u0443\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c","form.validation.limitRows":"\u041b\u0438\u043c\u0438\u0442 \u0441\u0442\u0440\u043e\u043a \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043c\u0435\u0436\u0434\u0443 1 \u0438 100000","description.default":" (default)","docs":"\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f"}'),tv=(0,ge.g4)("ydb-query-settings-dialog",{en:Xg,ru:ev}),av=[{value:ht.Wg.implicit,content:ht._d[ht.Wg.implicit],text:Wg("transaction-mode-description.implicit"),isDefault:!0},{value:ht.Wg.serializable,content:ht._d[ht.Wg.serializable],text:Wg("transaction-mode-description.serializable")},{value:ht.Wg.onlinero,content:ht._d[ht.Wg.onlinero],text:Wg("transaction-mode-description.onlinero")},{value:ht.Wg.stalero,content:ht._d[ht.Wg.stalero],text:Wg("transaction-mode-description.stalero")},{value:ht.Wg.snapshot,content:ht._d[ht.Wg.snapshot],text:Wg("transaction-mode-description.snapshot")}],nv=[{value:ht.ei.query,content:ht.om[ht.ei.query],text:Wg("method-description.query"),isDefault:!0},{value:ht.ei.script,content:ht.om[ht.ei.script],text:Wg("method-description.script")},{value:ht.ei.scan,content:ht.om[ht.ei.scan],text:Wg("method-description.scan")},{value:ht.ei.data,content:ht.om[ht.ei.data],text:Wg("method-description.data")},{value:ht.ei.pg,content:ht.om[ht.ei.pg],text:Wg("method-description.pg")}],sv=[{value:ht.pE.none,content:ht.Pn[ht.pE.none],text:Wg("statistics-mode-description.none"),isDefault:!0},{value:ht.pE.basic,content:ht.Pn[ht.pE.basic],text:Wg("statistics-mode-description.basic")},{value:ht.pE.full,content:ht.Pn[ht.pE.full],text:Wg("statistics-mode-description.full")},{value:ht.pE.profile,content:ht.Pn[ht.pE.profile],text:Wg("statistics-mode-description.profile")}],rv=[{value:ht.PB.off,content:ht.PX[ht.PB.off],text:Wg("tracing-level-description.off"),isDefault:!0},{value:ht.PB.toplevel,content:ht.PX[ht.PB.toplevel],text:Wg("tracing-level-description.toplevel")},{value:ht.PB.basic,content:ht.PX[ht.PB.basic],text:Wg("tracing-level-description.basic")},{value:ht.PB.detailed,content:ht.PX[ht.PB.detailed],text:Wg("tracing-level-description.detailed")},{value:ht.PB.diagnostic,content:ht.PX[ht.PB.diagnostic],text:Wg("tracing-level-description.diagnostic")},{value:ht.PB.trace,content:ht.PX[ht.PB.trace],text:Wg("tracing-level-description.trace")}],iv={transactionMode:{title:tv("form.transaction-mode"),options:av},queryMode:{title:tv("form.query-mode"),options:nv},statisticsMode:{title:tv("form.statistics-mode"),options:sv},tracingLevel:{title:tv("form.tracing-level"),options:rv},timeout:{title:tv("form.timeout")},limitRows:{title:tv("form.limit-rows")},pragmas:{title:tv("form.pragmas")}};function ov({currentSettings:e,defaultSettings:t}){const a=Zg(e,t),n={};return a.forEach((t=>{const a=iv[t],s=e[t];if("options"in a){var r;const e=null===(r=a.options.find((e=>e.value===s)))||void 0===r?void 0:r.content;e&&(n[a.title]=e)}else s&&(n[a.title]=String(s))})),n}var lv=a(80967);const cv=()=>{const[e,t]=(0,lv.i)(Oo.GS.LAST_QUERY_EXECUTION_SETTINGS);let a;try{a=ht.id.parse(e)}catch{a=void 0}return[a,t]};var dv=a(95312);const uv=()=>{const[e,t]=(0,lv.i)(Oo.GS.QUERY_SETTINGS_BANNER_LAST_CLOSED),[a]=cv(),[n]=(0,dv.X)(),s=a?Zg(a,ht.jU):[],r=n?Zg(n,ht.jU):[],i=s.includes("transactionMode")||s.includes("queryMode"),o=a?ov({currentSettings:a,defaultSettings:ht.jU}):{},l=n?ov({currentSettings:n,defaultSettings:ht.jU}):{},c=e&&Date.now()-e<1e3*f.Du;return{isBannerShown:i&&!c,closeBanner:()=>t(Date.now()),resetBanner:()=>t(void 0),changedCurrentSettings:r,changedCurrentSettingsDescriptions:l,changedLastExecutionSettings:s,changedLastExecutionSettingsDescriptions:o}};var pv;const hv=null===(pv=b.J.yaMetricaConfig)||void 0===pv?void 0:pv.yaMetricaMap;class mv{constructor(e){this.name=void 0,this.warnShown=!1,this.name=e}hit(){this.warnOnce()}params(){this.warnOnce()}userParams(){this.warnOnce()}reachGoal(){this.warnOnce()}warnOnce(){this.warnShown||(console.warn(`Yandex.Metrica counter "${this.name}" is not defined\n`),this.warnShown=!0)}}function gv(e,t){var a,n;const s=function(e){if(!e)return;const t=null===hv||void 0===hv?void 0:hv[e],a=t?window[`yaCounter${t}`]:void 0;return null!==a&&void 0!==a?a:new mv(e)}(null===(a=b.J.yaMetricaConfig)||void 0===a?void 0:a.getMetricaName(e));if(!s)return void console.warn("Metrica is not defined");const r=null===(n=b.J.yaMetricaConfig)||void 0===n?void 0:n.goals[e];r?s.reachGoal(r,t):console.warn("Metrica goal is not defined")}var vv=a(53472);let yv=function(e){return e.triggerCollapse="triggerCollapse",e.triggerExpand="triggerExpand",e.clear="clear",e}({});const xv=e=>{localStorage.setItem(e,"true")},bv=e=>{localStorage.removeItem(e)};function fv(e){return function(t,a){switch(a){case yv.triggerCollapse:return xv(e),{...t,triggerCollapse:!0,triggerExpand:!1,collapsed:!0};case yv.triggerExpand:return bv(e),{...t,triggerCollapse:!1,triggerExpand:!0,collapsed:!1};case yv.clear:return bv(e),{triggerCollapse:!1,triggerExpand:!1,collapsed:!1};default:return t}}}const jv=(0,l.cn)("kv-pane-visibility-button");function Tv({onCollapse:e,onExpand:t,isCollapsed:a,initialDirection:s="top",className:r}){return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(Oe.m,{title:"Collapse",children:(0,c.jsx)(ja.$,{view:"flat-secondary",onClick:e,className:jv({hidden:a,type:"collapse"},r),children:(0,c.jsx)(Me.I,{data:vv.A,className:jv({[s]:!0})})})}),(0,c.jsx)(Oe.m,{title:"Expand",children:(0,c.jsx)(ja.$,{view:"flat-secondary",onClick:t,className:jv({hidden:!a,type:"expand"},r),children:(0,c.jsx)(Me.I,{data:vv.A,className:jv({[s]:!0},"rotate")})})})]})}const Sv=(0,l.cn)("ydb-preview");function wv({path:e,quantity:t=0,truncated:a,renderResult:n,loading:s,error:r}){const o=(0,j.YQ)(),l=()=>{o((0,y.o)(!1))};return(0,c.jsx)(i.r,{loading:s,children:(0,c.jsxs)("div",{className:Sv(),children:[(0,c.jsxs)(ke.s,{justifyContent:"space-between",alignItems:"center",className:Sv("header"),children:[(0,c.jsxs)(ke.s,{gap:1,children:[Wg("preview.title"),(0,c.jsxs)(Re.E,{color:"secondary",variant:"body-2",children:[a?`${Wg("preview.truncated")} `:"","(",t,")"]}),(0,c.jsx)("div",{className:Sv("table-name"),children:e})]}),(0,c.jsxs)("div",{className:Sv("controls-left"),children:[(0,c.jsx)(Uh,{disabled:Boolean(r)}),(0,c.jsx)(ja.$,{view:"flat-secondary",onClick:l,title:Wg("preview.close"),children:(0,c.jsx)(Me.I,{data:dc.A,size:18})})]})]}),(0,c.jsx)(Vh,{children:(0,c.jsx)("div",{className:Sv("result"),children:r?(0,c.jsx)("div",{className:Sv("message-container","error"),children:(0,ht.Cb)(r)}):null===n||void 0===n?void 0:n()})})]})})}const Ev=n.memo((function(e){const{className:t,value:a}=e,n=(0,j.YQ)();return(0,c.jsx)("span",{className:Iv("cell",t),onClick:e=>n((0,z.DK)(e.target,a,"cell")),children:a})})),_v=JSON.parse('{"empty":"Table is empty"}'),Nv=JSON.parse('{"empty":"\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u043f\u0443\u0441\u0442\u0430\u044f"}'),Cv=(0,ge.g4)("ydb-query-result-table",{ru:Nv,en:_v}),Pv={...f.N3,stripedRows:!0,sortable:!1,displayIndices:!0},Iv=(0,l.cn)("ydb-query-result-table"),Av=(e,t)=>t,Dv=(e,t)=>t+1,Rv=e=>{const{columns:t,data:a,settings:s}=e,r=n.useMemo((()=>t?((e,t)=>{if(!e.length)return[];const a=null===t||void 0===t?void 0:t.slice(0,100);return e.map((({name:e,type:t})=>{const n=(0,ht.nh)(t);return{name:e,width:Vt({data:a,name:e}),align:"number"===n?Ht.Ay.RIGHT:Ht.Ay.LEFT,render:({row:t})=>(0,c.jsx)(Ev,{value:String(t[e])})}}))})(t,a):(e=>{if(null===e||void 0===e||!e.length)return[];const t=null===e||void 0===e?void 0:e.slice(0,100);return Object.keys(e[0]).map((a=>({name:a,width:Vt({data:t,name:a}),align:(0,$r.kf)(e[0][a])?Ht.Ay.RIGHT:Ht.Ay.LEFT,render:({row:e})=>(0,c.jsx)(Ev,{value:String(e[a])})})))})(a)),[a,t]),i=n.useMemo((()=>({...Pv,...s})),[s]);return Array.isArray(a)?r.length?(0,c.jsx)(ue.l,{data:a,columns:r,settings:i,rowKey:Av,visibleRowIndex:Dv,wrapperClassName:Iv("table-wrapper")}):(0,c.jsx)("div",{className:Iv("message"),children:Cv("empty")}):null},kv=g.F.injectEndpoints({endpoints:e=>({sendQuery:e.query({queryFn:async({query:e,database:t,action:a,limitRows:n},{signal:s})=>{try{const r=await window.api.viewer.sendQuery({query:e,database:t,action:a,limit_rows:n},{signal:s,withRetries:!0});return(0,ht.We)(r)?{error:r}:{data:(0,ht.fW)(r)}}catch(r){return{error:r||new Error("Unauthorized")}}},providesTags:["PreviewData"]})}),overrideExisting:"throw"});var Ov=a(80971);function Mv({database:e,path:t,type:a,databaseFullPath:n}){var s,r,i;const[o]=(0,dv.X)(),l=ut(t,n),d=`select * from \`${l}\` limit 101`,u=(0,Ov.ZS)(d,o.pragmas),{currentData:p,isFetching:h,error:m}=kv.useSendQueryQuery({database:e,query:u,action:Mt(a)?"execute-query":"execute-scan",limitRows:100},{refetchOnMountOrArgChange:!0}),g=h&&void 0===p,v=null!==(s=null===p||void 0===p||null===(r=p.resultSets)||void 0===r?void 0:r[0])&&void 0!==s?s:{};return(0,c.jsx)(wv,{path:l,renderResult:()=>(0,c.jsx)(Rv,{data:v.result,columns:v.columns}),loading:g,error:m,truncated:v.truncated,quantity:null===(i=v.result)||void 0===i?void 0:i.length})}const Fv=JSON.parse('{"label_partition-id":"Partition ID: {{id}}","label_offsets-range":"offsets: {{start}} - {{end}}"}'),Lv=(0,ge.g4)("ydb-preview",{en:Fv}),qv=[{name:rm,header:jm[rm],render:({row:{Offset:e}})=>(0,Xe.isNil)(e)?f.Pd:e,sortable:!1},{name:im,header:jm[im],render:({row:{CreateTimestamp:e,TimestampDiff:t}})=>(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(Ym,{timestamp:e}),(0,c.jsx)("br",{}),(0,c.jsx)(Xm,{value:t,baseColor:"secondary",variant:"body-1"})]}),width:200,sortable:!1},{name:dm,header:jm[dm],render:({row:{Message:e,OriginalSize:t}})=>(0,c.jsx)(eg,{message:e,size:t}),width:500,sortable:!1},{name:um,header:jm[um],render:({row:{StorageSize:e}})=>(0,c.jsx)(tg,{size:e}),align:"right",width:100,sortable:!1}];function zv({messages:e}){return(0,c.jsx)(ue.l,{data:e,columns:qv,settings:f.N3,rowKey:(e,t)=>{var a;return null!==(a=e.Offset)&&void 0!==a?a:t},wrapperClassName:Sv("table-wrapper"),emptyDataMessage:"No data"})}function Uv({database:e,path:t,databaseFullPath:a}){var s,r;const{data:i,isLoading:o,error:l}=jp.aD.useGetPartitionsQuery({path:t,database:e,databaseFullPath:a}),d=n.useMemo((()=>null===i||void 0===i?void 0:i[0]),[i]),u=n.useMemo((()=>{const a=null===d||void 0===d?void 0:d.partitionId;if(!d||(0,Xe.isNil)(a))return xp.hT;return{database:e,path:t,partition:String(a),limit:100,offset:(0,$r.y3)(d.endOffset)-100,message_size_limit:100}}),[e,t,d]),{currentData:p,error:h,isFetching:m}=mn.useGetTopicDataQuery(u),g=o||m&&void 0===p,v=n.useMemo((()=>{if(d)return{start:(0,$r.y3)(d.startOffset),end:Math.max((0,$r.y3)(d.endOffset)-1,0)}}),[d]),y=n.useCallback((()=>{var e,t;return(0,c.jsxs)(ke.s,{direction:"column",children:[(0,c.jsxs)(ke.s,{className:Sv("partition-info"),alignItems:"center",gap:2,children:[!(0,Xe.isNil)(null===d||void 0===d?void 0:d.partitionId)&&(0,c.jsx)(Re.E,{variant:"body-2",children:Lv("label_partition-id",{id:d.partitionId})}),v&&(0,c.jsxs)(Re.E,{variant:"body-2",color:"secondary",children:["(",Lv("label_offsets-range",v),")"]})]}),p&&(0,c.jsx)(zv,{messages:null!==(e=null===(t=p.Messages)||void 0===t?void 0:t.toReversed())&&void 0!==e?e:[]})]})}),[v,d,p]),x=(0,$r.y3)(null===p||void 0===p?void 0:p.EndOffset)-(0,$r.y3)(null===p||void 0===p?void 0:p.StartOffset);return(0,c.jsx)(wv,{path:t,renderResult:y,loading:g,error:l||h,truncated:x>100,quantity:null!==(s=null===p||void 0===p||null===(r=p.Messages)||void 0===r?void 0:r.length)&&void 0!==s?s:0})}function Qv(e){const{type:t,subType:a}=e,n=Ct(t),s=t===it.EPathTypePersQueueGroup,r=a===ot.EPathSubTypeStreamImpl,i=(0,I._p)();if(n)return(0,c.jsx)(Mv,{...e});if(s&&!r&&i)return(0,c.jsx)(Uv,{...e});return(0,c.jsx)(wv,{...e,renderResult:()=>(0,c.jsx)("div",{className:Sv("message-container"),children:Wg("preview.not-available")})})}const Gv=g.F.injectEndpoints({endpoints:e=>({cancelQuery:e.mutation({queryFn:async({queryId:e,database:t},{signal:a})=>{try{const n=await window.api.viewer.sendQuery({database:t,action:"cancel-query",query_id:e,internal_call:!0},{signal:a});if((0,ht.We)(n))return{error:n};return{data:(0,ht.fW)(n)}}catch(n){return{error:n}}}})}),overrideExisting:"throw"});var Bv=a(4439),$v=a(61255),Hv=a(200),Vv=a(88303),Wv=a(4401),Jv=a(22058);async function Kv(e){var t;let a=1;const n=async()=>{if(!window.ydbEditor){if(!a)return!1;await new Promise((e=>{window.setTimeout(e,100)})),a-=1,n()}return!0};await n()?null===(t=window.ydbEditor)||void 0===t||t.trigger(void 0,"insertSnippetToEditor",e):console.error("Monaco editor not found")}function Yv(e){return e.replace(/\$/g,"\\$")}function Zv(e,t="    "){return e.replace(/^/gm,t)}const Xv=e=>`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table\nCREATE TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}/my_row_table\``:"${1:my_row_table}"} (\n    category_id Uint64 NOT NULL,\n    id Uint64,\n    expire_at Datetime,\n    updated_on Datetime,\n    name Text,\n    \`binary-payload\` Bytes,\n    attributes JsonDocument,\n    -- uncomment to add a secondary index\n    -- INDEX idx_row_table_id GLOBAL SYNC ON ( id ) COVER ( name, attributes ), -- Secondary indexes docs https://ydb.tech/en/docs/yql/reference/syntax/create_table#secondary_index\n    PRIMARY KEY (category_id, id)\n) \nWITH (\n    AUTO_PARTITIONING_BY_SIZE = ENABLED,\n    AUTO_PARTITIONING_PARTITION_SIZE_MB = 2048,\n    AUTO_PARTITIONING_BY_LOAD = ENABLED,\n    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = 4,\n    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = 1024\n    -- uncomment to create a table with predefined partitions\n    -- , UNIFORM_PARTITIONS = 4 -- The number of partitions for uniform initial table partitioning.\n                            -- The primary key's first column must have type Uint64 or Uint32.\n                            -- A created table is immediately divided into the specified number of partitions\n    -- uncomment to launch read only replicas in every AZ\n    -- , READ_REPLICAS_SETTINGS = 'PER_AZ:1' -- Enable read replicas for stale read, launch one replica in every availability zone\n    -- uncomment to enable ttl\n    -- , TTL = Interval("PT1H") ON expire_at -- Enable background deletion of expired rows https://ydb.tech/en/docs/concepts/ttl\n    -- uncomment to create a table with a bloom filter\n    -- , KEY_BLOOM_FILTER = ENABLED -- With a Bloom filter, you can more efficiently determine\n                               -- if some keys are missing in a table when making multiple single queries by the primary key.\n)`,ey=e=>`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table#olap-tables\nCREATE TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}/my_column_table\``:"${1:my_column_table}"} (\n    id Int64 NOT NULL,\n    author Text,\n    title Text,\n    body Text,\n    PRIMARY KEY (id)\n)\nPARTITION BY HASH(id)\nWITH (STORE = COLUMN)`,ty=()=>'-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-async-replication\nCREATE OBJECT secret_name (TYPE SECRET) WITH value="secret_value";\n\nCREATE ASYNC REPLICATION my_replication\nFOR ${1:<original_table>} AS ${2:replica_table} --[, `/remote_database/another_table_name` AS `another_local_table_name` ...]\nWITH (\n    CONNECTION_STRING="${3:grpcs://mydb.ydb.tech:2135/?database=/remote_database}",\n    TOKEN_SECRET_NAME = "secret_name"\n    -- ENDPOINT="mydb.ydb.tech:2135",\n    -- DATABASE=`/remote_database`,\n    -- USER="user",\n    -- PASSWORD_SECRET_NAME="your_password"\n);',ay=()=>'-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-transfer\nCREATE OBJECT secret_name (TYPE SECRET) WITH value="secret_value";\n\n\\$l = (\\$x) -> {\n    return [\n        <|\n            offset:\\$x._offset,\n            message:\\$x._data\n        |>\n    ];\n};\n\nCREATE TRANSFER my_transfer\nFROM ${1:<original_topic>} TO ${2:<target_table>} USING \\$l\nWITH (\n    CONNECTION_STRING="${3:grpcs://mydb.ydb.tech:2135/?database=/remote_database}",\n    TOKEN_SECRET_NAME = "secret_name"\n    -- ENDPOINT="mydb.ydb.tech:2135",\n    -- DATABASE=`/remote_database`,\n    -- USER="user",\n    -- PASSWORD_SECRET_NAME="your_password"\n);',ny=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter_table/\n\nALTER TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_table>}"}\n    -- RENAME TO new_table_name\n    -- DROP COLUMN some_existing_column\n\${2:ADD COLUMN numeric_column Int32};`,sy=e=>`-- documentation about partitioning https://ydb.tech/docs/en/concepts/datamodel/table#partitioning\n\nALTER TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_table>}"} SET \n(\n    AUTO_PARTITIONING_BY_LOAD = ENABLED, -- If a partition consumes more than 50% of the CPU for a few dozens of seconds, it is enqueued for splitting.\n    AUTO_PARTITIONING_BY_SIZE = ENABLED, --  If a partition size exceeds the value specified by the AUTO_PARTITIONING_PARTITION_SIZE_MB  parameter, it is enqueued for splitting.\n    AUTO_PARTITIONING_PARTITION_SIZE_MB = 2048,\n    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = 10, -- Partitions are merged only if their actual number exceeds the value specified by this parameter.\n    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = 100 -- Partitions are split only if their number doesn't exceed the value specified by this parameter.\n)`,ry=e=>{var t;const a=null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${2:<my_table>}";return`SELECT ${(null===e||void 0===e||null===(t=e.schemaData)||void 0===t?void 0:t.map((e=>{var t;return"`"+Yv(null!==(t=e.name)&&void 0!==t?t:"")+"`"})).join(", "))||"${1:*}"}\nFROM ${a}\n${null!==e&&void 0!==e&&e.relativePath?"":"WHERE ${3:Key1 = 1}\nORDER BY ${4:Key1}\n"}LIMIT \${5:10};`},iy=e=>{var t;return`UPSERT INTO ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_table>}"}\n( ${(null===e||void 0===e||null===(t=e.schemaData)||void 0===t?void 0:t.map((e=>{var t;return`\`${Yv(null!==(t=e.name)&&void 0!==t?t:"")}\``})).join(", "))||"${2:id, name}"} )\nVALUES ( ${null!==e&&void 0!==e&&e.schemaData?"${3: }":'${3:1, "foo"}'} );`},oy=e=>`DROP EXTERNAL TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:my_table}"};`,ly=e=>{const t=null===e||void 0===e?void 0:e.relativePath.split("/").slice(0,-1).join("/");return`CREATE EXTERNAL TABLE ${t?`\`${Yv(t)}/my_external_table\``:"${1:<my_external_table>}"} (\n    column1 Int,\n    column2 Int\n) WITH (\n    DATA_SOURCE="${null!==e&&void 0!==e&&e.relativePath?`${Yv(e.relativePath)}`:"${2:<path_to_data_source>}"}",\n    LOCATION="",\n    FORMAT="json_as_string",\n    \`file_pattern\`=""\n);`},cy=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-topic\nCREATE TOPIC ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}/my_topic\``:"${1:my_topic}"} (\n    CONSUMER consumer1,\n    CONSUMER consumer2 WITH (read_from = Datetime('1970-01-01T00:00:00Z')) -- Sets up the message write time starting from which the consumer will receive data.\n                                                                           -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format). \n                                                                           -- Default value: now\n) WITH (\n    min_active_partitions = 1, -- Minimum number of topic partitions.\n    partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.\n    retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.\n    retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. \n                              -- When this value is exceeded, the older data is cleared, like under a retention policy. \n                              -- 0 is interpreted as unlimited.\n    partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.\n    partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. \n                                    -- When set to zero, the actual write_burst value is equalled to \n                                    -- the quota value (this allows write bursts of up to one second).\n);`,dy=e=>`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/alter_topic\nALTER TOPIC ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_topic>}"}\n    ADD CONSUMER new_consumer WITH (read_from = Datetime('1970-01-01T00:00:00Z')), -- Sets up the message write time starting from which the consumer will receive data.\n                                                                                   -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format).\n                                                                                   -- Default value: now\n    ALTER CONSUMER consumer1 SET (read_from = Datetime('1970-01-01T00:00:00Z')),\n    DROP CONSUMER consumer2,\n    SET (\n        min_active_partitions = 1, -- Minimum number of topic partitions.\n        partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.\n        retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.\n        retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. \n                                  -- When this value is exceeded, the older data is cleared, like under a retention policy. \n                                  -- 0 is interpreted as unlimited.\n        partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.\n        partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. \n                                        -- When set to zero, the actual write_burst value is equalled to\n                                        -- the quota value (this allows write bursts of up to one second).\n    );`,uy=e=>`DROP TOPIC ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_topic>}"};`,py=e=>`CREATE VIEW ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}/my_view\``:"${1:my_view}"} WITH (security_invoker = TRUE) AS SELECT 1;`,hy=e=>`DROP VIEW ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_view>}"};`,my=e=>`DROP ASYNC REPLICATION ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_replication>}"};`,gy=e=>`DROP TRANSFER ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_transfer>}"};`,vy=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter-async-replication\nALTER ASYNC REPLICATION ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_replication>}"} SET (STATE = "DONE", FAILOVER_MODE = "FORCE");`,yy=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter-transfer\n\n\\$l = (\\$x) -> {\n    return [\n        <|\n            offset:\\$x._offset,\n            message:\\$x._data\n        |>\n    ];\n};\n\nALTER TRANSFER ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_transfer>}"} \nSET USING \\$l;`,xy=e=>`CREATE STREAMING QUERY ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}/my_streaming_query\``:"${1:<my_streaming_query>}"} WITH (\n    RUN = TRUE  -- Run the query after creation\n) AS\nDO BEGIN\n    INSERT INTO \${2:<external data source>}.\${3:<sink topic>} \n    SELECT * FROM \${2:<external data source>}.\${4:<source topic>};\nEND DO;`,by=e=>`ALTER STREAMING QUERY ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_streaming_query>}"} SET (\n    RUN = FALSE, -- Stop query execution\n    RESOURCE_POOL = "default" -- Workload manager pool for query\n);`,fy=e=>{var t,a,n,s;const r=null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_streaming_query>}",i=null===e||void 0===e?void 0:e.streamingQueryData,o=(0,U.vN)(null===i||void 0===i||null===(t=i.resultSets)||void 0===t||null===(a=t[0])||void 0===a||null===(n=a.result)||void 0===n||null===(s=n[0])||void 0===s?void 0:s.Text);let l=o.replace(/\r\n?/g,"\n");l=(0,U.qe)(l),l=(0,U.YY)(l),l=Yv(l);return`ALTER STREAMING QUERY ${r} SET (\n    FORCE = TRUE, -- Allow to drop last query checkpoint if query state can't be loaded\n) AS\nDO BEGIN\n${Zv(l||"${2:<streaming_query_text>}")}\nEND DO;`},jy=e=>`DROP STREAMING QUERY ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_streaming_query>}"};`,Ty=e=>`ALTER TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_table>}"} ADD INDEX \${2:index_name} GLOBAL ON (\${3:<column_name>});`,Sy=e=>{const t=null===e||void 0===e?void 0:e.relativePath.split("/").pop(),a=null===e||void 0===e?void 0:e.relativePath.split("/").slice(0,-1).join("/");return`ALTER TABLE ${a?`\`${Yv(a)}\``:"${1:<my_table>}"} DROP INDEX ${Yv(null!==t&&void 0!==t?t:"")||"${2:<index_name>}"};`},wy=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter_table/changefeed\nALTER TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_table>}"} ADD CHANGEFEED \${2:changefeed_name} WITH (\n    MODE = \${3:'UPDATES'}, -- KEYS_ONLY, UPDATES, NEW_IMAGE, OLD_IMAGE, or NEW_AND_OLD_IMAGES\n    FORMAT = \${4:'JSON'}, -- JSON or DEBEZIUM_JSON\n    VIRTUAL_TIMESTAMPS = \${5:TRUE}, -- true or false\n    RETENTION_PERIOD = \${6:Interval('PT12H')}, -- Interval value, e.g., Interval('PT24H')\n    -- TOPIC_MIN_ACTIVE_PARTITIONS: The number of topic partitions. By default, the number of topic partitions is equal to the number of table partitions\n    INITIAL_SCAN = \${8:TRUE} -- true or false\n)\n\n-- MODE options:\n--   KEYS_ONLY: Only the primary key components and change flag are written.\n--   UPDATES: Updated column values that result from updates are written.\n--   NEW_IMAGE: Any column values resulting from updates are written.\n--   OLD_IMAGE: Any column values before updates are written.\n--   NEW_AND_OLD_IMAGES: A combination of NEW_IMAGE and OLD_IMAGE modes.`,Ey=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-group\nCREATE GROUP ${1:group_name}\n-- group_name: The name of the group. It may contain lowercase Latin letters and digits.",_y=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-user\nCREATE USER ${1:user_name} PASSWORD ${2:'password'}\n-- user_name: The name of the user. It may contain lowercase Latin letters and digits.\n-- option: The password of the user:\n    -- PASSWORD 'password' creates a user with the password password. The ENCRYPTED option is always enabled.\n    -- PASSWORD NULL creates a user with an empty password.",Ny=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/delete\nDELETE FROM ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_table>}"}\nWHERE \${2:Key1 = 1};`,Cy=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/drop-group\nDROP GROUP ${1:<group_name>}\n\n-- IF EXISTS: Suppress an error if the group doesn't exist.\n-- group_name: The name of the group to be deleted.",Py=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/drop-user\nDROP USER ${1:<user_name>}\n\n-- IF EXISTS: Suppress an error if the user doesn't exist.\n-- user_name: The name of the user to be deleted.",Iy=e=>`GRANT \${1:<permission_name>}\nON ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(null===e||void 0===e?void 0:e.relativePath)}\``:"${2:<path_to_scheme_object>}"}\nTO \${3:<role_name>}\n\n-- permission_name: The name of the access right to schema objects that needs to be assigned.\n-- path_to_scheme_object: The path to the schema object for which rights are being granted.\n-- role_name: The name of the user or group to whom rights on the schema object are being granted.\n-- WITH GRANT OPTION: Using this construct gives the user or group of users the right to manage access rights - \n--                    to assign or revoke certain rights. This construct has functionality similar to granting \n--                    the "ydb.access.grant" or GRANT right. A subject with the ydb.access.grant right cannot \n--                    grant rights broader than they possess themselves.`,Ay=e=>`REVOKE \${1:<permission_name>}\nON ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(null===e||void 0===e?void 0:e.relativePath)}\``:"${2:<path_to_scheme_object>}"}\nFROM \${3:<role_name>}\n\n-- permission_name: The name of the access right to schema objects that needs to be revoked.\n-- path_to_scheme_object: The path to the schema object from which rights are being revoked.\n-- role_name: The name of the user or group from whom rights on the schema object are being revoked.\n-- GRANT OPTION FOR: Using this construct revokes the user's or group's right to manage access rights.\n--                   All previously granted rights by this user remain in effect.\n--                   This construct has functionality similar to revoking the "ydb.access.grant" or GRANT right.`,Dy=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/update\nUPDATE ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_table>}"}\nSET \${2:Column1 = 'foo', Column2 = 'bar'}\nWHERE \${3:Key1 = 1};`,Ry=e=>`DROP TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${Yv(e.relativePath)}\``:"${1:<my_table>}"};`,ky=JSON.parse('{"button.new-sql":"New query","action.create-row-table":"Create row table","action.create-column-table":"Create column table","action.create-external-table":"Create external table","action.upsert-to-table":"Upsert into table","action.update-table":"Update table","action.alter-table":"Alter table","action.select-rows":"Select from a table","action.delete-rows":"Delete rows","action.drop-table":"Drop table","action.add-index":"Add index","action.drop-index":"Drop index","action.drop-external-table":"Drop external table","menu.tables":"Tables","menu.topics":"Topics","menu.streaming-query":"Streaming query","menu.capture":"Change data capture","menu.replication":"Async replication","menu.transfer":"Transfer","menu.users":"Users","action.create-topic":"Create Topic","action.drop-topic":"Drop Topic","action.alter-topic":"Alter Topic","action.create-cdc-stream":"Create changefeed","action.create-async-replication":"Create async replication","action.create-transfer":"Create transfer","action.create-user":"Create user","action.create-group":"Create group","action.drop-user":"Drop user","action.drop-group":"Drop group","action.grant-privilege":"Grant privilege","action.revoke-privilege":"Revoke privilege","action.alter-async-replication":"Alter async replication","action.drop-async-replication":"Drop async replication","action.alter-transfer":"Alter transfer","action.drop-transfer":"Drop transfer","action.create-streaming-query":"Create streaming query","action.alter-streaming-query-settings":"Alter query settings","action.alter-streaming-query-text":"Alter query text","action.drop-streaming-query":"Drop query"}'),Oy=(0,ge.g4)("ydb-new-sql",{en:ky});function My(){const e=(e=>{const t=t=>()=>{e(t())};return{createRowTable:t(Xv),createColumnTable:t(ey),createAsyncReplication:t(ty),createStreamingQuery:t(xy),alterAsyncReplication:t(vy),dropAsyncReplication:t(my),createTransfer:t(ay),alterTransfer:t(yy),dropTransfer:t(gy),alterTable:t(ny),selectQuery:t(ry),upsertQuery:t(iy),createExternalTable:t(ly),dropExternalTable:t(oy),createTopic:t(cy),alterTopic:t(dy),dropTopic:t(uy),createView:t(py),dropTable:t(Ry),deleteRows:t(Ny),updateTable:t(Dy),alterStreamingQueryText:t(fy),alterStreamingQuerySettings:t(by),dropStreamingQuery:t(jy),createUser:t(_y),createGroup:t(Ey),createCdcStream:t(wy),grantPrivilege:t(Iy),revokePrivilege:t(Ay),dropUser:t(Py),dropGroup:t(Cy),addTableIndex:t(Ty),dropTableIndex:t(Sy)}})(Hg(n.useCallback((e=>{Kv(e)}),[]))),t=[{text:Oy("menu.tables"),iconStart:(0,c.jsx)($v.K,{}),items:[{text:Oy("action.create-row-table"),action:e.createRowTable},{text:Oy("action.create-column-table"),action:e.createColumnTable},{text:Oy("action.create-external-table"),action:e.createExternalTable},{text:Oy("action.upsert-to-table"),action:e.upsertQuery},{text:Oy("action.update-table"),action:e.updateTable},{text:Oy("action.alter-table"),action:e.alterTable},{text:Oy("action.select-rows"),action:e.selectQuery},{text:Oy("action.delete-rows"),action:e.deleteRows},{text:Oy("action.drop-table"),action:e.dropTable},{text:Oy("action.drop-external-table"),action:e.dropExternalTable},{text:Oy("action.add-index"),action:e.addTableIndex},{text:Oy("action.drop-index"),action:e.dropTableIndex}]},{text:Oy("menu.topics"),iconStart:(0,c.jsx)(Hv.p,{}),items:[{text:Oy("action.create-topic"),action:e.createTopic},{text:Oy("action.alter-topic"),action:e.alterTopic},{text:Oy("action.drop-topic"),action:e.dropTopic}]},{text:Oy("menu.streaming-query"),iconStart:(0,c.jsx)(Vv.G,{}),items:[{text:Oy("action.create-streaming-query"),action:e.createStreamingQuery},{text:Oy("action.alter-streaming-query-settings"),action:e.alterStreamingQuerySettings},{text:Oy("action.alter-streaming-query-text"),action:e.alterStreamingQueryText},{text:Oy("action.drop-streaming-query"),action:e.dropStreamingQuery}]},{text:Oy("menu.replication"),iconStart:(0,c.jsx)(Wv.A,{}),items:[{text:Oy("action.create-async-replication"),action:e.createAsyncReplication},{text:Oy("action.alter-async-replication"),action:e.alterAsyncReplication},{text:Oy("action.drop-async-replication"),action:e.dropAsyncReplication}]},{text:Oy("menu.transfer"),iconStart:(0,c.jsx)(Jv.p,{}),items:[{text:Oy("action.create-transfer"),action:e.createTransfer},{text:Oy("action.alter-transfer"),action:e.alterTransfer},{text:Oy("action.drop-transfer"),action:e.dropTransfer}]},{text:Oy("menu.capture"),iconStart:(0,c.jsx)(Hv.p,{}),items:[{text:Oy("action.create-cdc-stream"),action:e.createCdcStream}]},{text:Oy("menu.users"),iconStart:(0,c.jsx)(Bv.A,{}),items:[{text:Oy("action.create-user"),action:e.createUser},{text:Oy("action.create-group"),action:e.createGroup},{text:Oy("action.drop-user"),action:e.dropUser},{text:Oy("action.drop-group"),action:e.dropGroup},{text:Oy("action.grant-privilege"),action:e.grantPrivilege},{text:Oy("action.revoke-privilege"),action:e.revokePrivilege}]}];return(0,c.jsx)(Ei.r,{items:t,renderSwitcher:e=>(0,c.jsxs)(ja.$,{...e,children:[Oy("button.new-sql"),(0,c.jsx)(ja.$.Icon,{children:(0,c.jsx)(wi.A,{})})]}),popupProps:{placement:"top"}})}const Fy=g.F.injectEndpoints({endpoints:e=>({getCodeAssistSuggestions:e.query({queryFn:async e=>{try{if(window.api.codeAssist){return{data:await window.api.codeAssist.getCodeAssistSuggestions(e)}}throw new Error("Method is not implemented.")}catch{return{data:{items:[]}}}}}),acceptSuggestion:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist){return{data:await window.api.codeAssist.sendCodeAssistTelemetry({Accepted:{AcceptedText:e.acceptedText,ConvertedText:e.acceptedText,Timestamp:Date.now(),RequestId:e.requestId}})}}throw new Error("Method is not implemented.")}catch(t){return{error:t}}}}),discardSuggestion:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist){return{data:await window.api.codeAssist.sendCodeAssistTelemetry({Discarded:{RequestId:e.requestId,Timestamp:Date.now(),DiscardReason:"OnCancel",DiscardedText:e.suggestionText,CacheHitCount:e.hitCount}})}}throw new Error("Method is not implemented.")}catch(t){return{error:t}}}}),ignoreSuggestion:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist){return{data:await window.api.codeAssist.sendCodeAssistTelemetry({Ignored:{RequestId:e.requestId,Timestamp:Date.now(),IgnoredText:e.suggestionText}})}}throw new Error("Method is not implemented.")}catch(t){return{error:t}}}}),sendUserQueriesData:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist){return{data:await window.api.codeAssist.sendCodeAssistOpenTabs(e)}}throw new Error("Method is not implemented.")}catch(t){return{error:t}}}})}),overrideExisting:"throw"});var Ly=a(44839);const qy={automaticLayout:!0,selectOnLineNumbers:!0,minimap:{enabled:!1},fixedOverflowWidgets:!0};const zy=new class{constructor(){this.query=void 0,this.query=null}registerQuery(e){this.query=e}abortQuery(){this.query&&(this.query.abort(),this.query=null)}};var Uy=a(90851),Qy=a(27738),Gy=a(24342);const By=(0,l.cn)("ydb-query-settings-description"),$y=({querySettings:e,prefix:t})=>(0,c.jsxs)("div",{className:By("message"),children:[t,Object.entries(e).map((([e,t],a,n)=>(0,c.jsxs)("span",{className:By("description-item"),children:[`${e}: ${t}`,a<n.length-1?", ":null]},a)))]}),Hy=(0,l.cn)("ydb-query-editor-button"),Vy={Run:e=>(0,c.jsxs)(ja.$,{...e,className:Hy("run-button"),children:[(0,c.jsx)(Me.I,{data:oi.A,size:16}),Wg("action.run")]}),Stop:e=>(0,c.jsxs)(ja.$,{...e,className:Hy("stop-button",{error:e.error}),children:[(0,c.jsx)(Me.I,{data:De.A,size:16}),Wg("action.stop")]}),Explain:e=>(0,c.jsxs)(ja.$,{...e,className:Hy("explain-button"),children:[(0,c.jsx)(Me.I,{data:Uy.A,size:16}),Wg("action.explain")]}),Settings:({onClick:e,isLoading:t})=>{const{changedCurrentSettings:a,changedCurrentSettingsDescriptions:n}=uv(),s=a.length>0?{view:"outlined-info",selected:!0}:null;return(0,c.jsx)(Gy.m,{disabled:0===a.length,content:(0,c.jsx)($y,{prefix:Wg("gear.tooltip"),querySettings:n}),openDelay:0,placement:["top-start"],children:(0,c.jsxs)(ja.$,{onClick:e,loading:t,className:Hy("gear-button"),...s,children:[(0,c.jsx)(Me.I,{data:Qy.A,size:16}),s?(0,c.jsxs)("div",{className:Hy("changed-settings"),children:["(",a.length,")"]}):null]})})}},Wy=(0,l.cn)("ydb-query-editor-controls"),Jy=({type:e,isHighlighted:t,isLoading:a,isStoppable:n,controlsDisabled:s,onActionClick:r,renderStopButton:i})=>{if(n&&a&&t)return i();const o="run"===e?Vy.Run:Vy.Explain;return(0,c.jsx)(o,{onClick:r,disabled:s,loading:a,view:t?"action":void 0})},Ky=({disabled:e,isLoading:t,highlightedAction:a,queryId:s,database:r,isStreamingEnabled:i,handleSendExecuteClick:o,onSettingsButtonClick:l,handleGetExplainQueryClick:d})=>{const u=(0,j.N4)(wc.Wp),[p,h]=Gv.useCancelQueryMutation(),[m,g]=n.useState(t),v=n.useRef(null),y=n.useRef(null),[x,b]=n.useState(!1),f=n.useCallback((async()=>{gv("stopQuery");try{i?zy.abortQuery():s&&await p({queryId:s,database:r}).unwrap()}catch{(0,$e.A)({name:"stop-error",title:"",content:Wg("toaster.stop-error"),theme:"danger",autoHiding:5e3}),b(!0),y.current&&window.clearTimeout(y.current),y.current=window.setTimeout((()=>{b(!1)}),500)}}),[i,s,p,r]),T="execute"===a,S="explain"===a,w=n.useCallback((()=>{v.current&&window.clearTimeout(v.current),g(!1),v.current=window.setTimeout((()=>{g(!0)}),400)}),[]),E=n.useCallback((()=>{o(u),w()}),[o,u,w]),_=n.useCallback((()=>{d(u),w()}),[d,u,w]);n.useEffect((()=>()=>{v.current&&window.clearTimeout(v.current),y.current&&window.clearTimeout(y.current)}),[]);const N=e||!u,C=()=>(0,c.jsx)(Vy.Stop,{loading:h.isLoading,error:x,onClick:f,view:"action"});return(0,c.jsxs)("div",{className:Wy(),children:[(0,c.jsxs)("div",{className:Wy("left"),children:[(0,c.jsx)(Jy,{type:"run",isHighlighted:T,isLoading:t,isStoppable:m,controlsDisabled:N,onActionClick:E,renderStopButton:C}),(0,c.jsx)(Jy,{type:"explain",isHighlighted:S,isLoading:t,isStoppable:m,controlsDisabled:N,onActionClick:_,renderStopButton:C}),(0,c.jsx)(Vy.Settings,{onClick:l,isLoading:t})]}),(0,c.jsxs)("div",{className:Wy("right"),children:[(0,c.jsx)(My,{}),(0,c.jsx)(Lg,{buttonProps:{disabled:e}})]})]})};var Yy=a(19548);function Zy(e){var t;if(function(e){return"object"===typeof e&&null!==e&&"name"in e&&"AbortError"===e.name}(e))return!0;if((0,T.cH)(e)&&e.isCancelled)return!0;const a=(0,ht.KH)(e);return(0,ht.We)(a)&&"Query was cancelled"===(null===(t=a.error)||void 0===t?void 0:t.message)}const Xy=10*f.KF;const ex=(0,l.cn)("kv-query-execution-status"),tx=({className:e,error:t,loading:a})=>{let s,r,i,o;const{startTime:l,endTime:d}=(0,j.N4)(wc.$u),u=function({startTime:e,endTime:t,loading:a}){const[s,r]=n.useState(e?(t||Date.now())-e:0),i=n.useCallback((()=>{if(e){const a=t||Date.now();r(a-e)}}),[t,e]),o=n.useRef(void 0),l=n.useRef(!1),c=n.useCallback((()=>{if(l.current)return;if(i(),!a||!e)return;const n=(t||Date.now())-e,s=Math.floor(20*(2*Math.random()-1)),r=n<Xy?100+s:f.KF;o.current=setTimeout(c,r)}),[i,a,e,t]);return n.useEffect((()=>(l.current=!1,c(),()=>{l.current=!0,o.current&&clearTimeout(o.current)})),[c]),s}({startTime:l,endTime:d,loading:a}),p=n.useMemo((()=>u<10*f.KF?(0,Ie.p0)(u).format("mm:ss.SSS"):u>f.Jg*f.KF?(0,Ie.p0)(u).format("hh:mm:ss"):(0,Ie.p0)(u).format("mm:ss")),[u]),h=Zy(t);if(a)i="info",o="info-heavy",s=(0,c.jsx)(Yy.t,{size:"xs"}),r="Running";else if((0,T.F0)(t)&&"ECONNABORTED"===t.code)i="danger",o="danger-heavy",s=(0,c.jsx)(Me.I,{data:So.A}),r="Connection aborted";else if(h)i="warning",o="warning-heavy",s=(0,c.jsx)(Me.I,{data:De.A,className:ex("result-status-icon",{error:!0})}),r="Stopped";else{const e=Boolean(t);i=e?"danger":"success",o=e?"danger-heavy":"positive-heavy",s=(0,c.jsx)(Me.I,{data:e?Xa.A:wo.A,className:ex("result-status-icon",{error:e})}),r=e?"Failed":"Completed"}return(0,c.jsx)(zt.J,{theme:i,size:"m",className:ex(null,e),icon:s,value:p,children:(0,c.jsx)(Re.E,{color:o,children:r})})},ax=(0,l.cn)("ydb-query-settings-banner");function nx(){const{isBannerShown:e,changedLastExecutionSettingsDescriptions:t,closeBanner:a}=uv();return e?(0,c.jsx)(lo.F,{className:ax(),theme:"info",align:"baseline",style:{paddingTop:11,paddingBottom:11},message:(0,c.jsx)($y,{prefix:Wg("banner.query-settings.message"),querySettings:t}),onClose:a}):null}const sx=(0,l.cn)("ydb-query-stopped-banner");function rx(){const[e,t]=(0,j.iK)(Oo.GS.QUERY_STOPPED_BANNER_CLOSED),a=n.useCallback((()=>{t(!0)}),[t]);return e?null:(0,c.jsx)(lo.F,{className:sx(),theme:"normal",align:"center",style:{paddingTop:11,paddingBottom:11},message:(0,c.jsx)("div",{className:sx("message"),children:Wg("banner.query-stopped.message")}),layout:"horizontal",actions:(0,c.jsx)(lo.F.Actions,{children:(0,c.jsx)(lo.F.Action,{view:"normal",onClick:a,children:Wg("banner.query-stopped.never-show")})})})}function ix(e){return e.replaceAll("\\","\\\\").replaceAll("\n","\\n").replaceAll("\r","\\r").replaceAll("\t","\\t")}var ox=a(6376);const lx=(0,l.cn)("ydb-query-ast"),cx={automaticLayout:!0,selectOnLineNumbers:!0,readOnly:!0,minimap:{enabled:!1},wrappingIndent:"indent"};function dx({ast:e,theme:t}){return(0,c.jsx)("div",{className:lx(),children:(0,c.jsx)(ox.default,{language:Ly.U,value:e,options:cx,theme:`vs-${t}`})})}var ux=a(73253);function px(e){const t=n.useRef(null),a=n.useId(),{data:s,opts:r,shapes:i}=e;return n.useEffect((()=>{const e=t.current;if(!e)return;e.innerHTML="",e.style.setProperty("width","100vw"),e.style.setProperty("height","100vh");const a=(0,ux.og)(e.id,s,r,i);return a.render(),e.style.setProperty("width","100%"),e.style.setProperty("height","100%"),()=>{a.destroy()}}),[s,r,i]),(0,c.jsx)("div",{id:a,ref:t,style:{overflow:"auto"}})}const hx={renderNodeTitle:e=>{const t=e.name.split("|");return t.length>1?t[1]:e.name},textOverflow:"normal",initialZoomFitsCanvas:!0},mx={node:ux.SO};function gx(e){return(0,c.jsx)(px,{...e,opts:hx,shapes:mx})}const vx=JSON.parse('{"description.graph-is-not-supported":"Graph can not be rendered","description.empty-result":"There is no {{activeSection}} for the request","action.result":"Result","action.stats":"Stats","action.schema":"Computation Graph","action.explain-plan":"Explain","action.json":"JSON","action.ast":"AST","action.copy":"Copy {{activeSection}}","trace":"Trace","title.truncated":"Truncated","title.result":"Result","tooltip_actions":"Actions","text_open-execution-plan":"Open Execution Plan","text_open-execution-plan_description":"New tab","text_download":"Download Execution Plan","text_download_description":"SVG","text_diagnostics":"Download Diagnostics","text_diagnostics_description":"JSON","text_error-plan-svg":"Error: {{error}}","error.title":"Query Failed","error.description":"An error occurred, please see the Result tab for details","stopped.title":"Query stopped","stopped.description":"Query was stopped"}'),yx=(0,ge.g4)("ydb-execute-result",{en:vx}),xx=(0,l.cn)("ydb-query-result-stub-message");function bx({message:e}){return(0,c.jsx)("div",{className:xx(null),children:e})}const fx=(0,l.cn)("ydb-query-explain-graph");function jx({explain:e={},theme:t}){const{links:a,nodes:s}=e,r=n.useMemo((()=>({links:a,nodes:s})),[a,s]);return function(e){return Boolean(e.links&&e.nodes&&e.nodes.length)}(r)?(0,c.jsx)("div",{className:fx("canvas-container"),children:(0,c.jsx)(gx,{data:r},t)}):(0,c.jsx)(bx,{message:yx("description.graph-is-not-supported")})}var Tx=a(7450);const Sx=(0,l.cn)("query-info-dropdown");var wx=a(112);const Ex=g.F.injectEndpoints({endpoints:e=>({planToSvgQuery:e.query({queryFn:async({plan:e,database:t},{signal:a})=>{try{return{data:await window.api.viewer.planToSvg({database:t,plan:e},{signal:a})}}catch(n){return{error:n}}}})}),overrideExisting:"throw"}),_x=JSON.parse('{"unknown-error":"An unknown error occurred"}'),Nx=(0,ge.g4)("ydb-errors",{en:_x});function Cx({title:e,description:t}){return(0,c.jsxs)("div",{className:Sx("menu-item-content"),children:[(0,c.jsx)(Re.E,{variant:"body-1",children:e}),(0,c.jsx)(Re.E,{variant:"body-1",color:"secondary",children:t})]})}function Px({queryResultsInfo:e,database:t,hasPlanToSvg:a,error:s}){const[r,i]=n.useState(null),[o,{isLoading:l}]=Ex.useLazyPlanToSvgQueryQuery();n.useEffect((()=>()=>{r&&URL.revokeObjectURL(r)}),[r]);return{isLoading:l,items:n.useMemo((()=>{const n=[],l=e.plan;if(l&&a){const e=()=>r?Promise.resolve(r):o({plan:l,database:t}).unwrap().then((e=>{const t=new Blob([e],{type:"image/svg+xml"}),a=URL.createObjectURL(t);return i(a),a})).catch((e=>{const t=function(e){if("string"===typeof e)return e;if(!e)return Nx("unknown-error");if((0,T.TX)(e))return e.message;if((0,T.cH)(e)){if(e.data&&"object"===typeof e.data&&"message"in e.data&&"string"===typeof e.data.message)return e.data.message;if("string"===typeof e.data)return e.data}return e instanceof Error?e.message:JSON.stringify(e)}(e);return(0,$e.A)({title:yx("text_error-plan-svg",{error:t}),name:"plan-svg-error",theme:"danger"}),null})),a=()=>{e().then((e=>{e&&window.open(e,"_blank")}))},s=()=>{e().then((e=>{e&&Cm(e,"query-plan.svg")}))};n.push([{text:(0,c.jsx)(Cx,{title:yx("text_open-execution-plan"),description:yx("text_open-execution-plan_description")}),iconStart:(0,c.jsx)(wx.A,{className:Sx("icon")}),action:a,className:Sx("menu-item")},{text:(0,c.jsx)(Cx,{title:yx("text_download"),description:yx("text_download_description")}),iconStart:(0,c.jsx)(Em.A,{className:Sx("icon")}),action:s,className:Sx("menu-item")}])}if(e){const a=()=>{const a=s?(0,ht.KH)(s):void 0,n={...e,database:t,...a&&{error:a}};Im(n,`query-diagnostics-${(new Date).getTime()}`)};n.push([{text:(0,c.jsx)(Cx,{title:yx("text_diagnostics"),description:yx("text_diagnostics_description")}),iconStart:(0,c.jsx)(Em.A,{className:Sx("icon")}),action:a,className:Sx("menu-item")}])}return n}),[e,a,r,o,t,s])}}function Ix({queryResultsInfo:e,database:t,hasPlanToSvg:a,error:n}){const{isLoading:s,items:r}=Px({queryResultsInfo:e,database:t,hasPlanToSvg:a,error:n});return r.length?(0,c.jsx)(Ei.r,{popupProps:{placement:["bottom-end","left"]},switcherWrapperClassName:Sx("query-info-switcher-wrapper"),renderSwitcher:e=>(0,c.jsx)(Oe.m,{title:yx("tooltip_actions"),children:(0,c.jsx)(ja.$,{view:"flat-secondary",loading:s,disabled:s,...e,children:(0,c.jsx)(ja.$.Icon,{children:(0,c.jsx)(Tx.A,{})})})}),items:r,size:"xl"}):null}const Ax=(0,l.cn)("ydb-query-json-viewer");function Dx({data:e}){const t=(0,gs.qI)(e);return(0,c.jsx)("div",{className:Ax(),children:(0,c.jsx)("div",{className:Ax("tree"),children:(0,c.jsx)(ms.p,{value:t})})})}const Rx=(0,l.cn)("ydb-query-result-error");function kx({error:e}){const t=(0,ht.KH)(e);return!t||Zy(e)?null:(0,T.TX)(e)?(0,c.jsx)("div",{className:Rx("message"),children:e.message}):"object"===typeof t?(0,c.jsx)("div",{className:Rx("message"),children:(0,c.jsx)(Rr.OI,{data:t})}):(0,c.jsx)("div",{className:Rx("message"),children:t})}const Ox=(0,l.cn)("ydb-query-result-sets-viewer");function Mx(e){const{selectedResultSet:t,setSelectedResultSet:a,resultSets:s,error:r}=e,i=n.useRef(null),o=null===s||void 0===s?void 0:s[t];return(0,c.jsxs)("div",{className:Ox("result-wrapper"),children:[e.error?(0,c.jsx)(kx,{error:r}):null,null!==s&&void 0!==s&&s.length?(null===s||void 0===s?void 0:s.length)>1?(0,c.jsx)(_.f,{value:String(t),children:(0,c.jsx)(N.w,{className:Ox("tabs"),size:"l",children:null===s||void 0===s?void 0:s.map(((e,t)=>{var n,r;const i=null===s||void 0===s?void 0:s[t];return(0,c.jsx)(_u.o,{value:String(t),onClick:()=>a(t),children:(0,c.jsxs)(ke.s,{gap:2,alignItems:"center",children:[(0,c.jsx)(Re.E,{children:`Result #${t+1}${null!==s&&void 0!==s&&null!==(n=s[t])&&void 0!==n&&n.truncated?"(T)":""}`}),(0,c.jsx)(Re.E,{color:"secondary",children:(null===(r=i.result)||void 0===r?void 0:r.length)||0})]})},t)}))})}):(()=>{var e;const t=null===s||void 0===s?void 0:s[0];return(0,c.jsxs)(ke.s,{gap:2,alignItems:"center",className:Ox("title"),children:[(0,c.jsx)(Re.E,{children:null!==t&&void 0!==t&&t.truncated?"Truncated":"Result"}),(0,c.jsx)(Re.E,{color:"secondary",children:(null===t||void 0===t||null===(e=t.result)||void 0===e?void 0:e.length)||0})]})})():null,o?(0,c.jsx)("div",{className:Ox("result"),ref:i,children:(0,c.jsx)(Rv,{settings:e.tableSettings,data:o.result,columns:o.columns})}):null]})}var Fx=a(59554),Lx=a(79737),qx=a(79685);const zx=(0,l.cn)("ydb-query-simplified-plan");function Ux({value:e,formatter:t}){if(!(0,$r.kf)(e))return;const a=t(Number(e));return(0,c.jsx)("div",{className:zx("metrics-cell"),children:a})}const Qx={Table:"var(--g-color-text-info)",Predicate:"var(--g-color-text-positive)",Condition:"var(--g-color-text-utility)"};function Gx(e){return e in Qx?Qx[e]:"var(--g-color-text-secondary)"}function Bx(e={}){const t=[],a=Object.entries(e);if(1===a.length){const e=a[0][1],n=Gx(a[0][0]);t.push((0,c.jsx)("span",{style:{color:n},children:(0,U.vN)(e)},"param"))}else{const a=function(e){const t=[],{Table:a,Predicate:n,Condition:s,...r}=e;return a&&t.push(["Table",a]),n&&t.push(["Predicate",n]),s&&t.push(["Condition",s]),t.concat(Object.entries(r))}(e);for(let e=0;e<a.length;e++){const[n,s]=a[e],r=Gx(n);e>0&&t.push(", "),t.push((0,c.jsxs)("span",{style:{color:r},children:[n,": ",(0,U.vN)(s)]},e))}}return t}function $x({params:e}){return e?(0,c.jsxs)("span",{className:zx("operation-params"),children:["(",Bx(e),")"]}):null}function Hx({modifiers:e,left:t}){return(0,c.jsx)("div",{className:zx("divider",e),style:{left:t}})}function Vx({row:e,depth:t=0,params:a}){const{name:s,operationParams:r,lines:i=""}=a,o=e.getLeafRows().length>0&&e.getIsExpanded(),l=n.useMemo((()=>function(e,t){const a=e.split(".").map(Number),n=[];for(let s=0;s<a.length;s++)s===a.length-1&&0!==s&&(a[s]?n.push((0,c.jsx)(Hx,{modifiers:{horizontal:!0},left:10+25*(s-1)},"last")):n.push((0,c.jsx)(Hx,{modifiers:{last:!0},left:9+25*(s-1)},"last"))),s===a.length-1&&t&&n.push((0,c.jsx)(Hx,{modifiers:{first:!0},left:9+25*s},"first")),a[s]&&n.push((0,c.jsx)(Hx,{left:9+25*(s-1)},s));return n}(i,o)),[i,o]);return(0,c.jsxs)("div",{style:{paddingLeft:25*t},className:zx("operation-name"),children:[l,(0,c.jsxs)(ke.s,{gap:1,className:zx("operation-content"),children:[e.getCanExpand()&&(0,c.jsx)(ja.$,{view:"flat",size:"xs",onClick:e.getToggleExpandedHandler(),children:(0,c.jsx)(ja.$.Icon,{children:(0,c.jsx)(yi.I,{direction:e.getIsExpanded()?"bottom":"right",size:14})})}),(0,c.jsx)("div",{className:zx("operation-name-content"),children:(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{className:zx("operation-name"),children:s}),"\xa0",(0,c.jsx)($x,{params:r})]})})]})]})}function Wx(e){return(0,c.jsx)(Ux,{value:e.getValue(),formatter:e=>e<1e8?(0,qx.p)(e).format():(0,$r.z0)(e,1)})}const Jx=[{accessorKey:"name",accessorFn:function(e){return{name:e.name,operationParams:e.operationParams,lines:e.lines}},header:()=>(0,c.jsx)(Lx.A,{children:"Operation"}),size:600,cell:e=>(0,c.jsx)(Vx,{row:e.row,depth:e.row.depth,params:e.getValue()})},{accessorKey:"aCpu",header:()=>(0,c.jsx)(Lx.A,{children:"A-Cpu"}),size:90,minSize:90,cell:function(e){return(0,c.jsx)(Ux,{value:e.getValue(),formatter:e=>(0,He.Xo)(Math.round(e))})},meta:{align:"right",verticalAlign:"top"}},{accessorKey:"aRows",header:()=>(0,c.jsx)(Lx.A,{children:"A-Rows"}),size:90,minSize:90,cell:Wx,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eCost",header:()=>(0,c.jsx)(Lx.A,{children:"E-Cost"}),size:90,minSize:90,cell:Wx,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eRows",header:()=>(0,c.jsx)(Lx.A,{children:"E-Rows"}),size:90,minSize:90,cell:Wx,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eSize",header:()=>(0,c.jsx)(Lx.A,{children:"E-Size"}),size:90,minSize:90,cell:Wx,meta:{align:"right",verticalAlign:"top"}}];function Kx({plan:e}){const t=n.useMemo((()=>function(e,t=""){if(!e)return[];const a=[{items:e,prefix:t,parentIndex:-1,parentArray:[]}],n=[];for(;a.length>0;){const{items:e,prefix:t,parentIndex:s,parentArray:r}=a.pop(),i=[];for(let n=0;n<e.length;n++){const s={...e[n]},r=n<e.length-1?1:0;let o=`${t}.${r}`;t||(o=String(r)),s.lines=o,i.push(s),s.children&&a.push({items:s.children,prefix:o,parentIndex:n,parentArray:i})}-1===s?n.push(...i):r[s].children=i}return n}(e)),[e]),[a,s]=n.useState(!0),r=(0,Fx.K2)({columns:Jx,data:t,getSubRows:e=>e.children,enableExpanding:!0,onExpandedChange:s,state:{expanded:a},enableColumnResizing:!0,columnResizeMode:"onChange"});return(0,c.jsx)(Lx.X,{wrapperClassName:zx(),table:r,stickyHeader:!0,width:"max"})}function Yx({traceId:e}){const{traceView:t}=(0,A.Zd)(),a=null!==t&&void 0!==t&&t.url?(n=t.url,s={traceId:e},n.replace(/\${(\w+)}/g,((e,t)=>s[t]||e))):"";var n,s;return a?(0,c.jsxs)(ja.$,{view:"flat-info",href:a,target:"_blank",children:[yx("trace"),(0,c.jsx)(ja.$.Icon,{children:(0,c.jsx)(wx.A,{})})]}):null}const Zx=(0,l.cn)("ydb-query-result"),Xx="result",eb="schema",tb="simplified",ab="json",nb="stats",sb="ast",rb={get result(){return yx("action.result")},get schema(){return yx("action.schema")},get simplified(){return yx("action.explain-plan")},get json(){return yx("action.json")},get stats(){return yx("action.stats")},get ast(){return yx("action.ast")}},ib=["result","schema","simplified","stats"],ob=["schema","simplified","json","ast"];function lb({result:e,resultType:t="execute",isResultsCollapsed:a,theme:s,database:r,queryText:o,tableSettings:l,onCollapseResults:d,onExpandResults:u}){var p;const h=(0,j.YQ)(),m=(0,j.N4)(wc.LI),g="execute"===t,v="explain"===t,[y,x]=n.useState(0),[b]=(0,j.iK)(Oo.GS.USE_SHOW_PLAN_SVG),f=n.useMemo((()=>{const e=null===m||void 0===m?void 0:m[t];if(e){if((g?ib:ob).includes(e))return e}return g?Xx:eb}),[m,t,g]),{error:T,isLoading:S,data:w={}}=e,{preparedPlan:E,simplifiedPlan:_,stats:N,resultSets:C,ast:P}=w;n.useEffect((()=>()=>{h((0,Lh.sM)())}),[h]);const I=e=>{h((0,wc.Hp)({queryType:t,tabId:e}))},A=n.useMemo((()=>{let e=[];return g?e=ib:v&&(e=ob),e.map((e=>({value:e,content:rb[e]})))}),[g,v]),D=()=>{switch(f){case Xx:{var e;const t=null===w||void 0===w||null===(e=w.resultSets)||void 0===e?void 0:e[y],a=function(e){if(null===e||void 0===e||!e.length)return"";const t=Object.keys(e[0]),a=[t.map(ix).join("\t")];for(const n of e){const e=[];for(const a of t){const t=n[a];e.push(ix("object"===typeof t?JSON.stringify(t):`${t}`))}a.push(e.join("\t"))}return a.join("\n")}(null===t||void 0===t?void 0:t.result);return a}case ab:return null===E||void 0===E?void 0:E.pristine;case tb:return null===_||void 0===_?void 0:_.pristine;case nb:return N;case sb:return P;default:return}},R=()=>{if(S)return null;const e=D(),t=(0,U.vN)(e);return t?(0,c.jsx)(_m.b,{text:t,view:"flat-secondary",title:yx("action.copy",{activeSection:f})}):null},k=()=>(0,c.jsx)(bx,{message:yx("description.empty-result",{activeSection:rb[f]})}),O=e=>(0,c.jsxs)(ke.s,{justifyContent:"center",alignItems:"center",width:"100%",gap:8,children:[(0,c.jsx)(Qu.v,{name:"error",className:Zx("illustration")}),(0,c.jsxs)(ke.s,{direction:"column",gap:2,children:[(0,c.jsx)(Re.E,{variant:"subheader-2",children:yx(e?"stopped.title":"error.title")}),(0,c.jsx)(Re.E,{color:"complementary",children:yx(e?"stopped.description":"error.description")})]})]}),M=Zy(T);return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsxs)("div",{className:Zx("controls"),children:[(0,c.jsxs)("div",{className:Zx("controls-left"),children:[A.length&&f?(0,c.jsx)(eh.x,{options:A,value:f,onUpdate:I}):null,(0,c.jsx)(tx,{error:T,loading:S}),null!==w&&void 0!==w&&w.traceId&&g?(0,c.jsx)(Yx,{traceId:w.traceId}):null]}),(0,c.jsxs)("div",{className:Zx("controls-right"),children:[S||Zy(T)?null:(0,c.jsx)(Ix,{queryResultsInfo:{queryText:o,ast:w.ast,stats:w.stats,plan:w.plan},error:T,database:r,hasPlanToSvg:Boolean((null===w||void 0===w?void 0:w.plan)&&b&&g)}),R(),(0,c.jsx)(Uh,{}),(0,c.jsx)(Tv,{onCollapse:d,onExpand:u,isCollapsed:a,initialDirection:"bottom"})]})]}),S||M?null:(0,c.jsx)(nx,{}),M&&null!==(p=w.resultSets)&&void 0!==p&&p.length?(0,c.jsx)(rx,{}):null,(0,c.jsx)(i.r,{loading:S&&(!w.resultSets||"result"!==f),children:(0,c.jsx)(Vh,{className:Zx("result"),children:(()=>{const e=Zy(T);return f===Xx?!T||!e||null!==C&&void 0!==C&&C.length?(0,c.jsx)(Mx,{resultSets:C,error:T,selectedResultSet:y,tableSettings:l,setSelectedResultSet:x}):O(e):T?g||e?O(e):(0,c.jsx)(kx,{error:T}):f===eb?null!==E&&void 0!==E&&null!==(t=E.nodes)&&void 0!==t&&t.length?(0,c.jsx)(jx,{theme:s,explain:E}):k():f===ab?null!==E&&void 0!==E&&E.pristine?(0,c.jsx)(Dx,{data:null===E||void 0===E?void 0:E.pristine}):k():f===tb?null!==_&&void 0!==_&&null!==(a=_.plan)&&void 0!==a&&a.length?(0,c.jsx)(Kx,{plan:_.plan}):k():f===nb?N?(0,c.jsx)(Dx,{data:N}):k():f===sb?P?(0,c.jsx)(dx,{ast:P,theme:s}):k():null;var t,a})()})})]})}var cb=a(98017),db=a(16122),ub=a(23971);const pb=()=>-1,hb=(0,l.cn)("ydb-query-settings-select");function mb(e){return(0,c.jsx)("div",{className:hb("selector"),children:(0,c.jsx)(O.l,{id:e.id,disabled:e.disabled,options:e.settingOptions,value:[e.setting],onUpdate:t=>{e.onUpdateSetting(t[0])},getOptionHeight:pb,popupClassName:hb("popup"),renderOption:e=>(0,c.jsxs)("div",{className:hb("item",{type:e.value}),children:[(0,c.jsxs)("div",{className:hb("item-title"),children:[e.content,e.isDefault?tv("description.default"):""]}),e.text&&(0,c.jsx)("span",{className:hb("item-description"),children:e.text})]}),width:"max"})})}var gb=a(72373);const vb=(0,l.cn)("ydb-timeout-label");function yb({isDisabled:e,isChecked:t,onToggle:a}){const[n]=(0,j.gz)();return n?(0,c.jsxs)("div",{className:vb("switch-title"),children:[(0,c.jsx)(gb.d,{disabled:e,checked:t,onUpdate:a,className:vb("switch"),content:iv.timeout.title}),e&&(0,c.jsx)(kn.H,{className:vb("question-icon"),popoverProps:{placement:"bottom-start"},children:tv("form.timeout.disabled")})]}):(0,c.jsx)("label",{htmlFor:"timeout",className:vb("label-title"),children:iv.timeout.title})}const xb=(0,l.cn)("ydb-query-settings-timeout");function bb({id:e,value:t,onChange:a,onToggle:s,validationState:r,errorMessage:i,isDisabled:o}){const l=n.useCallback((e=>{const t=e.target.value?Number(e.target.value):void 0;a(t)}),[a]),d=null!==t;return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(yb,{isDisabled:o,isChecked:d,onToggle:s}),d&&(0,c.jsx)("div",{className:xb("control-wrapper"),children:(0,c.jsx)(Ha.k,{id:e,type:"number",value:(null===t||void 0===t?void 0:t.toString())||"",onChange:l,className:xb("input"),placeholder:"60",validationState:r,errorMessage:i,errorPlacement:"inside",endContent:(0,c.jsx)("span",{className:xb("postfix"),children:tv("form.timeout.seconds")})})})]})}const fb=(0,l.cn)("ydb-query-settings-dialog");function jb(){const e=(0,j.YQ)(),t=(0,j.N4)(Ag.xM),[a,s]=(0,j.XS)(),r=n.useCallback((()=>{e((0,Ag.NJ)("idle"))}),[e]),i=n.useCallback((e=>{s(e),r()}),[r,s]);return(0,c.jsxs)($a.l,{open:"settings"===t,size:"s",onClose:r,className:fb(),hasCloseButton:!1,children:[(0,c.jsx)($a.l.Header,{caption:tv("action.settings")}),(0,c.jsx)(Tb,{initialValues:a,onSubmit:i,onClose:r})]})}function Tb({initialValues:e,onSubmit:t,onClose:a}){const{control:n,handleSubmit:s,setValue:r,watch:i,formState:{errors:o}}=(0,ub.mN)({defaultValues:e,resolver:(0,db.u)(ht.id)}),[l]=(0,j.iK)(Oo.GS.USE_SHOW_PLAN_SVG),d=(0,I.Oi)(),u=i("timeout"),p=i("queryMode");return(0,c.jsxs)("form",{onSubmit:s(t),children:[(0,c.jsxs)($a.l.Body,{className:fb("dialog-body"),children:[(0,c.jsxs)(ke.s,{direction:"row",alignItems:"flex-start",className:fb("dialog-row"),children:[(0,c.jsx)("label",{htmlFor:"queryMode",className:fb("field-title"),children:iv.queryMode.title}),(0,c.jsx)("div",{className:fb("control-wrapper",{queryMode:!0}),children:(0,c.jsx)(ub.xI,{name:"queryMode",control:n,render:({field:e})=>(0,c.jsx)(mb,{id:"queryMode",setting:e.value,onUpdateSetting:t=>{e.onChange(t),"query"!==t&&null===u?r("timeout",""):"query"===t&&r("timeout",null)},settingOptions:iv.queryMode.options})})})]}),d&&(0,c.jsxs)(ke.s,{direction:"row",alignItems:"flex-start",className:fb("dialog-row"),children:[(0,c.jsx)("label",{htmlFor:"tracingLevel",className:fb("field-title"),children:iv.tracingLevel.title}),(0,c.jsx)("div",{className:fb("control-wrapper"),children:(0,c.jsx)(ub.xI,{name:"tracingLevel",control:n,render:({field:e})=>(0,c.jsx)(mb,{id:"tracingLevel",setting:e.value,onUpdateSetting:e.onChange,settingOptions:iv.tracingLevel.options})})})]}),(0,c.jsxs)(ke.s,{direction:"row",alignItems:"flex-start",className:fb("dialog-row"),children:[(0,c.jsx)("label",{htmlFor:"transactionMode",className:fb("field-title"),children:iv.transactionMode.title}),(0,c.jsx)("div",{className:fb("control-wrapper",{transactionMode:!0}),children:(0,c.jsx)(ub.xI,{name:"transactionMode",control:n,render:({field:e})=>(0,c.jsx)(mb,{id:"transactionMode",setting:e.value,onUpdateSetting:e.onChange,settingOptions:iv.transactionMode.options})})})]}),(0,c.jsxs)(ke.s,{direction:"row",alignItems:"flex-start",className:fb("dialog-row"),children:[(0,c.jsx)("label",{htmlFor:"statisticsMode",className:fb("field-title"),children:iv.statisticsMode.title}),(0,c.jsx)(Gy.m,{className:fb("statistics-mode-tooltip"),disabled:!l,openDelay:0,content:tv("tooltip_plan-to-svg-statistics"),children:(0,c.jsx)("div",{className:fb("control-wrapper",{statisticsMode:!0}),children:(0,c.jsx)(ub.xI,{name:"statisticsMode",control:n,render:({field:e})=>(0,c.jsx)(mb,{id:"statisticsMode",disabled:l,setting:e.value,onUpdateSetting:e.onChange,settingOptions:iv.statisticsMode.options})})})})]}),(0,c.jsxs)(ke.s,{direction:"row",alignItems:"flex-start",className:fb("dialog-row"),children:[(0,c.jsx)("label",{htmlFor:"limitRows",className:fb("field-title"),children:iv.limitRows.title}),(0,c.jsx)("div",{className:fb("control-wrapper"),children:(0,c.jsx)(ub.xI,{name:"limitRows",control:n,render:({field:e})=>{var t,a;return(0,c.jsx)(Ha.k,{id:"limitRows",type:"number",...e,value:null===(t=e.value)||void 0===t?void 0:t.toString(),className:fb("limit-rows"),placeholder:"10000",validationState:o.limitRows?"invalid":void 0,errorMessage:null===(a=o.limitRows)||void 0===a?void 0:a.message,errorPlacement:"inside",endContent:(0,c.jsx)("span",{className:fb("postfix"),children:tv("form.limit.rows")})})}})})]}),(0,c.jsxs)(ke.s,{direction:"row",alignItems:"flex-start",className:fb("dialog-row"),children:[(0,c.jsx)("label",{htmlFor:"pragmas",className:fb("field-title"),children:iv.pragmas.title}),(0,c.jsx)("div",{className:fb("control-wrapper"),children:(0,c.jsx)(ub.xI,{name:"pragmas",control:n,render:({field:e})=>{var t;return(0,c.jsx)(cb.f,{id:"pragmas",...e,className:fb("pragmas"),placeholder:"PRAGMA OrderedColumns;",rows:3,validationState:o.pragmas?"invalid":void 0,errorMessage:null===(t=o.pragmas)||void 0===t?void 0:t.message,errorPlacement:"inside"})}})})]}),(0,c.jsx)(ke.s,{direction:"row",alignItems:"flex-start",className:fb("dialog-row"),children:(0,c.jsx)(ub.xI,{name:"timeout",control:n,render:({field:e})=>{var t;return(0,c.jsx)(bb,{id:"timeout",value:"string"===typeof e.value?void 0:e.value,onChange:e.onChange,onToggle:t=>e.onChange(t?"":null),validationState:o.timeout?"invalid":void 0,errorMessage:null===(t=o.timeout)||void 0===t?void 0:t.message,isDisabled:p!==ht.ei.query})}})})]}),(0,c.jsx)($a.l.Footer,{textButtonApply:tv("button-done"),textButtonCancel:tv("button-cancel"),onClickButtonCancel:a,propsButtonApply:{type:"submit"},renderButtons:(e,t)=>(0,c.jsxs)("div",{className:fb("buttons-container"),children:[(0,c.jsx)(ja.$,{href:"https://ydb.tech/docs",target:"_blank",view:"outlined",size:"l",children:tv("docs")}),(0,c.jsxs)("div",{className:fb("main-buttons"),children:[t,e]})]})})]})}var Sb=a(52400);const wb=(0,a(99006)._)((async()=>({Editor:(await Promise.resolve().then(a.bind(a,6376))).default})),"Editor");var Eb=a(65603),_b=a(77419);const Nb=JSON.parse('{"context_syntax-error":"Syntax error"}'),Cb=(0,ge.g4)("ydb-monaco",{en:Nb}),Pb=(0,Xe.debounce)((function(){var e;const t=null===(e=window.ydbEditor)||void 0===e?void 0:e.getModel();if(!t)return void console.error("unable to retrieve model when highlighting errors");const a=(0,Eb.kh)(t.getValue()).errors;if(!a.length)return void Ab();const n=a.map((e=>({message:Cb("context_syntax-error"),source:e.message,severity:_b.MarkerSeverity.Error,startLineNumber:e.startLine,startColumn:e.startColumn+1,endLineNumber:e.endLine,endColumn:e.endColumn+1})));_b.editor.setModelMarkers(t,"ydb",n)}),500);function Ib(){const e=(t=Pb,n.useEffect((()=>()=>{t.cancel()}),[t]),t);var t;return n.useCallback((()=>{Ab(),e()}),[e])}function Ab(){_b.editor.removeAllMarkers("ydb")}const Db="navigation";function Rb({changeUserInput:e,theme:t,handleSendExecuteClick:a,handleGetExplainQueryClick:s}){const r=(0,j.N4)(wc.Wp),i=(0,j.YQ)(),[o,l]=n.useState(),d=(0,j.N4)(wc.py),[u]=(0,j.iK)(Oo.GS.ENABLE_CODE_ASSISTANT),p=function(){const[e]=(0,j.iK)(Oo.GS.ENABLE_AUTOCOMPLETE),[t]=(0,j.iK)(Oo.GS.AUTOCOMPLETE_ON_ENTER);return n.useMemo((()=>{const a=Boolean(e);return{quickSuggestions:a,suggestOnTriggerCharacters:a,acceptSuggestionOnEnter:t?"on":"off",...qy}}),[e,t])}(),h=Ib(),[m]=(0,j.iK)(Oo.GS.LAST_USED_QUERY_ACTION),g=(0,j.A5)((()=>d&&0!==d.length?d[d.length-1].queryText:"")),v=(0,j.A5)((()=>{m===ht.x5.explain?s(r):a(r)})),{monacoGhostConfig:y,prepareUserQueriesCache:x}=function(){const[e]=Fy.useLazyGetCodeAssistSuggestionsQuery(),[t]=Fy.useAcceptSuggestionMutation(),[a]=Fy.useDiscardSuggestionMutation(),[s]=Fy.useIgnoreSuggestionMutation(),[r]=Fy.useSendUserQueriesDataMutation(),i=(0,j.N4)(wc.py),o=Dg(),l=n.useCallback((async t=>e(t).unwrap()),[e]),c=n.useCallback((async e=>t(e).unwrap()),[t]),d=n.useCallback((async e=>a(e).unwrap()),[a]),u=n.useCallback((async e=>s(e).unwrap()),[s]),p=n.useMemo((()=>[...i.map(((e,t)=>({name:`query${t}.yql`,text:e.queryText}))),...o.map((e=>({name:e.name,text:e.body})))]),[i,o]);return{prepareUserQueriesCache:n.useCallback((async()=>{const e=p.map(((e,t)=>({FileName:e.name||`query${t}.yql`,Text:e.text})));try{return await r(e).unwrap()}catch{return{items:[]}}}),[r,p]),monacoGhostConfig:n.useMemo((()=>({api:{getCodeAssistSuggestions:l},eventHandlers:{onCompletionAccept:c,onCompletionDecline:d,onCompletionIgnore:u},config:{language:Ly.K}})),[l,c,d,u])}}();n.useEffect((()=>(o&&u&&(o.register(y),x()),()=>{null===o||void 0===o||o.unregister()})),[u,y,o,x]);return(0,c.jsx)(wb,{language:Ly.K,value:r,options:p,onChange:t=>{h(),e({input:t}),i((0,wc.Xb)(!0))},editorDidMount:(e,t)=>{window.ydbEditor=e;const n=function(e){const{KeyMod:t,KeyCode:a}=e,n=t.CtrlCmd;return{sendQuery:n|a.Enter,sendSelectedQuery:n|t.Shift|e.KeyCode.Enter,saveQuery:n|a.KeyS,saveSelectedQuery:n|t.Shift|a.KeyS,shortcutsHotkey:n|a.KeyK}}(t);t.editor.registerCommand("insertSnippetToEditor",((t,a)=>{const n=e.getContribution("snippetController2");n&&(e.focus(),e.setValue(""),n.insert(a),i((0,wc.Xb)(!1)))})),window.api.codeAssist&&l((0,Sb._z)(e)),function(e){const t=G()((()=>{e.layout()}),100);e.layout(),window.addEventListener("resize",t),e.onDidDispose((()=>{window.removeEventListener("resize",t)}))}(e),function(e,t){kb(e.getValue(),t()),e.onDidChangeModelContent((()=>{kb(e.getValue(),t())})),e.onDidDispose((()=>{window.onbeforeunload=null}))}(e,g),e.focus(),e.addAction({id:"sendQuery",label:Wg("action.send-query"),keybindings:[n.sendQuery],precondition:void 0,keybindingContext:void 0,contextMenuGroupId:Db,contextMenuOrder:1,run:()=>v()});const s=e.createContextKey("canSendSelectedText",!1);e.onDidChangeCursorSelection((({selection:e,secondarySelections:t})=>{const a=e.selectionStartLineNumber!==e.positionLineNumber||e.selectionStartColumn!==e.positionColumn,n=t.length>0;s.set(a&&!n)})),e.addAction({id:"sendSelectedQuery",label:Wg("action.send-selected-query"),keybindings:[n.sendSelectedQuery],precondition:"canSendSelectedText",contextMenuGroupId:Db,contextMenuOrder:1,run:e=>{const t=e.getSelection(),n=e.getModel();if(t&&n){const e=n.getValueInRange({startLineNumber:t.getSelectionStart().lineNumber,startColumn:t.getSelectionStart().column,endLineNumber:t.getPosition().lineNumber,endColumn:t.getPosition().column});a(e,!0)}}}),e.addAction({id:"previous-query",label:Wg("action.previous-query"),contextMenuGroupId:Db,contextMenuOrder:2,run:()=>{i((0,wc.JK)())}}),e.addAction({id:"next-query",label:Wg("action.next-query"),contextMenuGroupId:Db,contextMenuOrder:3,run:()=>{i((0,wc.tS)())}}),e.addAction({id:"save-query",label:Wg("action.save-query"),keybindings:[n.saveQuery],run:()=>{Ba.Ay.show(zg)}}),e.addAction({id:"openKeyboardShortcutsPanel",label:Wg("action.open-shortcuts"),keybindings:[n.shortcutsHotkey],contextMenuGroupId:Db,contextMenuOrder:4,run:()=>{const e=new CustomEvent("openKeyboardShortcutsPanel");window.dispatchEvent(e)}})},theme:`vs-${t}`,editorWillUnmount:()=>{window.ydbEditor=void 0}})}function kb(e,t){const a=!!e&&e!==t;window.onbeforeunload=a?e=>{e.preventDefault(),e.returnValue=""}:null}const Ob=(0,l.cn)("query-editor"),Mb={triggerExpand:!1,triggerCollapse:!1,collapsed:!0};function Fb(e){const t=(0,j.YQ)(),{database:a,path:s,type:r,subType:i,databaseFullPath:o}=ba(),{theme:l,changeUserInput:d}=e,u=(0,j.N4)(wc.yJ),p=(0,j.N4)(wc.wf),m=(0,j.N4)(wc.py),g=(0,j.N4)(wc.Kz),v=(0,j.N4)(y.Ab),x=Boolean(p),[b]=(0,j.XS)(),T=(0,I.Oi)(),[S,w]=cv(),{resetBanner:E}=uv(),[_,N]=(0,j.iK)(Oo.GS.LAST_USED_QUERY_ACTION),[C,P]=n.useState(""),[A]=(0,j.gz)(),[D]=(0,j.iK)(Oo.GS.BINARY_DATA_IN_PLAIN_TEXT_DISPLAY),R=!D,k=(0,I.j2)()&&A&&b.queryMode===ht.ei.query,[O]=wc.JO.useUseSendQueryMutation(),[M]=wc.JO.useUseStreamQueryMutation(),F=n.useMemo((()=>k?{displayIndices:{maxIndex:(b.limitRows||ht.jU.limitRows)+1}}:void 0),[k,b.limitRows]);n.useEffect((()=>{u!==a&&t((0,wc.Id)(a))}),[t,a,u]);const[L,q]=n.useReducer(fv(f.GV),Mb);n.useEffect((()=>{q(yv.triggerCollapse)}),[]),n.useEffect((()=>{q(v||x?yv.triggerExpand:yv.triggerCollapse)}),[v,x]);const z=(0,j.A5)(((e,n)=>{N(ht.x5.execute),P(e),(0,Xe.isEqual)(S,b)||(E(),w(b));const s=(0,Yg.A)();if(zy.abortQuery(),k){gv("runQuery",{actionType:"execute",isStreaming:!0,...b});const t=M({actionType:"execute",query:e,database:a,querySettings:b,enableTracingLevel:T,base64:R});zy.registerQuery(t)}else{gv("runQuery",{actionType:"execute",...b});const t=O({actionType:"execute",query:e,database:a,querySettings:b,enableTracingLevel:T,queryId:s,base64:R});zy.registerQuery(t)}var r;(t((0,y.o)(!1)),n)||(e!==(null===(r=m[g])||void 0===r?void 0:r.queryText)&&t((0,wc.nO)({queryText:e,queryId:s})),t((0,wc.Xb)(!1)));q(yv.triggerExpand)})),U=()=>{t((0,Ag.NJ)("settings"))},Q=(0,j.A5)((e=>{N(ht.x5.explain),P(e),(0,Xe.isEqual)(S,b)||(E(),w(b));const n=(0,Yg.A)();gv("runQuery",{actionType:"explain",...b});const s=O({actionType:"explain",query:e,database:a,querySettings:b,enableTracingLevel:T,queryId:n,base64:R});zy.registerQuery(s),t((0,y.o)(!1)),q(yv.triggerExpand)}));return(0,c.jsxs)("div",{className:Ob(),children:[(0,c.jsxs)(h,{direction:"vertical",defaultSizePaneKey:f.l_,triggerCollapse:L.triggerCollapse,triggerExpand:L.triggerExpand,minSize:[0,52],collapsedSizes:[100,0],onSplitStartDragAdditional:()=>{q(yv.clear)},children:[(0,c.jsxs)("div",{className:Ob("pane-wrapper",{top:!0}),children:[(0,c.jsx)("div",{className:Ob("monaco-wrapper"),children:(0,c.jsx)("div",{className:Ob("monaco"),children:(0,c.jsx)(Rb,{changeUserInput:d,theme:l,handleSendExecuteClick:z,handleGetExplainQueryClick:Q})})}),(0,c.jsx)(Ky,{handleSendExecuteClick:z,onSettingsButtonClick:U,isLoading:Boolean(null===p||void 0===p?void 0:p.isLoading),handleGetExplainQueryClick:Q,highlightedAction:_,database:a,queryId:null===p||void 0===p?void 0:p.queryId,isStreamingEnabled:k})]}),(0,c.jsx)("div",{className:Ob("pane-wrapper"),children:(0,c.jsx)(Lb,{resultVisibilityState:L,onExpandResultHandler:()=>{q(yv.triggerExpand)},onCollapseResultHandler:()=>{q(yv.triggerCollapse)},type:r,subType:i,theme:l,result:p,database:a,databaseFullPath:o,path:s,showPreview:v,queryText:C,tableSettings:F},null===p||void 0===p?void 0:p.queryId)})]}),(0,c.jsx)(jb,{})]})}function Lb({resultVisibilityState:e,onExpandResultHandler:t,onCollapseResultHandler:a,type:n,subType:s,theme:r,result:i,database:o,databaseFullPath:l,path:d,showPreview:u,queryText:p,tableSettings:h}){return u?(0,c.jsx)(Qv,{database:o,path:d,type:n,subType:s,databaseFullPath:l}):i?(0,c.jsx)(lb,{result:i,resultType:null===i||void 0===i?void 0:i.type,theme:r,database:o,isResultsCollapsed:e.collapsed,tableSettings:h,onExpandResults:t,onCollapseResults:a,queryText:p}):null}var qb=a(69832);const zb=[{id:E.tQ.newQuery,title:Wg("tabs.newQuery")},{id:E.tQ.history,title:Wg("tabs.history")},{id:E.tQ.saved,title:Wg("tabs.saved")}],Ub=({className:e,activeTab:t})=>{const a=(0,ar.zy)(),n=(0,B.mA)(a);return(0,c.jsx)("div",{className:e,children:(0,c.jsx)(_.f,{value:t,children:(0,c.jsx)(N.w,{size:"l",children:zb.map((({id:e,title:t})=>{const a=(0,B.YL)({...n,[Rn.vh.queryTab]:e});return(0,c.jsx)(_u.o,{value:e,children:(0,c.jsx)(qb.E,{to:a,as:"tab",children:t})},e)}))})})})};var Qb=a(64470);const Gb=(0,l.cn)("ydb-saved-queries"),Bb=({visible:e,queryName:t,onCancelClick:a,onConfirmClick:n})=>(0,c.jsxs)($a.l,{open:e,hasCloseButton:!1,size:"s",onClose:a,onEnterKeyDown:n,children:[(0,c.jsx)($a.l.Header,{caption:Wg("delete-dialog.header")}),(0,c.jsxs)($a.l.Body,{className:Gb("dialog-body"),children:[Wg("delete-dialog.question"),(0,c.jsx)("span",{className:Gb("dialog-query-name"),children:` ${t}?`})]}),(0,c.jsx)($a.l.Footer,{textButtonApply:Wg("delete-dialog.delete"),textButtonCancel:Wg("delete-dialog.cancel"),onClickButtonCancel:a,onClickButtonApply:n})]}),$b=({changeUserInput:e})=>{const t=function(){const e=Dg(),t=(0,j.N4)(Ag.cu).trim().toLowerCase();return n.useMemo((()=>0===t.length?e:e.filter((e=>e.body.toLowerCase().includes(t)))),[e,t])}(),a=(0,j.YQ)(),s=(0,j.N4)(Ag.cu),[r,i]=n.useState(!1),[o,l]=n.useState(""),d=()=>{i(!1),l("")},u=Hg(n.useCallback((({queryText:t,queryName:n})=>{e({input:t}),a((0,wc.Xb)(!1)),a((0,Ag.JP)(n)),a((0,x.sH)(E.tQ.newQuery))}),[e,a])),p=[{name:"name",header:"Name",render:({row:e})=>(0,c.jsx)("div",{className:Gb("query-name"),children:e.name}),width:200},{name:"body",header:"Query Text",render:({row:e})=>{return(0,c.jsxs)("div",{className:Gb("query"),children:[(0,c.jsx)("div",{className:Gb("query-body"),children:(0,c.jsx)(wg,{value:e.body,maxQueryHeight:6})}),(0,c.jsxs)("span",{className:Gb("controls"),children:[(0,c.jsx)(ja.$,{view:"flat-secondary",children:(0,c.jsx)(Me.I,{data:Oa.A})}),(0,c.jsx)(ja.$,{view:"flat-secondary",onClick:(t=e.name,e=>{e.stopPropagation(),i(!0),l(t)}),children:(0,c.jsx)(Me.I,{data:Qb.A})})]})]});var t},sortable:!1,resizeMinWidth:650}];return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsxs)(he.L,{className:Gb(),children:[(0,c.jsx)(he.L.Controls,{children:(0,c.jsx)(me.v,{onChange:e=>{a((0,Ag.ys)(e))},placeholder:Wg("filter.text.placeholder"),className:Gb("search")})}),(0,c.jsx)(he.L.Table,{children:(0,c.jsx)(ue.l,{columnsWidthLSKey:"savedQueriesTableColumnsWidth",columns:p,data:t,settings:Cc,emptyDataMessage:Wg(s?"history.empty-search":"saved.empty"),rowClassName:()=>Gb("row"),onRowClick:e=>u({queryText:e.body,queryName:e.name}),initialSortOrder:{columnId:"name",order:Ht.Ay.ASCENDING}})})]}),(0,c.jsx)(Bb,{visible:r,queryName:o,onCancelClick:()=>{d()},onConfirmClick:()=>{d(),a((0,Ag.fu)(o)),l("")}})]})},Hb=(0,l.cn)("ydb-query"),Vb=e=>{const t=(0,j.YQ)(),{queryTab:a=E.tQ.newQuery}=(0,j.N4)((e=>e.tenant)),r=e=>{t((0,wc.iZ)(e))},i=n.useMemo((()=>zb.find((({id:e})=>e===a))),[a]);return(0,c.jsxs)("div",{className:Hb(),children:[i?(0,c.jsx)(s.mg,{children:(0,c.jsx)("title",{children:i.title})}):null,(0,c.jsx)(Ub,{className:Hb("tabs"),activeTab:a}),(0,c.jsx)("div",{className:Hb("content"),children:(()=>{switch(a){case E.tQ.newQuery:return(0,c.jsx)(Fb,{changeUserInput:r,...e});case E.tQ.history:return(0,c.jsx)(Kg,{changeUserInput:r});case E.tQ.saved:return(0,c.jsx)($b,{changeUserInput:r});default:return null}})()})]})};var Wb=a(46649),Jb=a(93844);const Kb=["query","diagnostics"],Yb={query:Wb.A,diagnostics:Jb.A};const Zb=(0,l.cn)("ydb-tenant-navigation"),Xb=({id:e,title:t,icon:a})=>({value:e,content:(0,c.jsxs)("span",{className:Zb("item"),children:[(0,c.jsx)(Me.I,{data:a,size:16,className:Zb("icon")}),(0,c.jsx)("span",{className:Zb("text"),children:t})]})}),ef=()=>{const e=function(){const e=(0,ar.W6)(),t=(0,ar.zy)(),a=(0,B.mA)(t),s=(0,ar.W5)(B.Ay.tenant),[,r]=(0,j.iK)(Oo.GS.TENANT_INITIAL_PAGE),{tenantPage:i}=(0,j.N4)((e=>e.tenant)),o=n.useMemo((()=>{if(!s)return[];const t=Kb.map((t=>{const n=E.Dg[t],s=(0,B.YL)({...a,[E.Dt]:n});return{id:n,title:yt(`pages.${t}`),icon:Yb[t],path:s,current:i===n,onForward:()=>{r(n),e.push(s)}}}));return t}),[i,r,s,e,a]);return o}();return(0,c.jsx)("div",{className:Zb(),children:(0,c.jsx)(eh.x,{width:"auto",onUpdate:t=>{const a=e.find((e=>e.id===t));null===a||void 0===a||a.onForward()},size:"l",className:Zb("body"),value:(e.find((e=>e.current))||e[0]).id,options:e.map(Xb)})})},tf=(0,l.cn)("object-general");const af=function({additionalTenantProps:e}){const t=(0,w.i)(),{tenantPage:a}=(0,j.N4)((e=>e.tenant));return(0,c.jsxs)("div",{className:tf(),children:[(0,c.jsx)(ef,{}),a===E.Dg.query?(0,c.jsx)(Vb,{theme:t}):(0,c.jsx)(Tg,{additionalTenantProps:e})]})};var nf=a(87285);const sf=(e,t,a)=>{const{setActivePath:n}=a;return{openPreview:()=>{t(g.F.util.invalidateTags(["PreviewData"])),t((0,y.o)(!0)),t((0,x.es)(E.Dg.query)),t((0,x.sH)(E.tQ.newQuery)),n(e)}}},rf=(e,t)=>(0,c.jsx)(ja.$,{view:"flat-secondary",onClick:e.openPreview,title:yt("actions.openPreview"),size:t||"s",children:(0,c.jsx)(Me.I,{data:nf.A})}),of=(e,t,a,n)=>(s,r,i)=>{const o=sf(s,e,t),l=rf(o,a),c=(null===i||void 0===i?void 0:i.subType)===ot.EPathSubTypeStreamImpl;return{async_replication:void 0,transfer:void 0,database:void 0,directory:void 0,resource_pool:void 0,table:l,column_table:l,system_table:l,index_table:l,topic:n&&!c?l:void 0,stream:void 0,index:void 0,external_table:l,external_data_source:void 0,view:l,streaming_query:void 0}[r]},lf=(e,t,a)=>(n,s)=>{const r=sf(n,e,t);return{preview:rf(r,a)}[s]};var cf=a(88563),df=a(3228);const uf=5*f.KF,pf=g.F.injectEndpoints({endpoints:e=>({getTableSchemaData:e.query({queryFn:async({path:e,database:t,type:a,databaseFullPath:n},{dispatch:s})=>{try{if(Lt(a)){const a=await s(gt.endpoints.getViewSchema.initiate({database:t,path:e,databaseFullPath:n,timeout:uf}));if((0,ht.We)(a))return{error:a};return{data:ga(a.data)}}const r=await s(v.endpoints.getOverview.initiate({path:e,database:t,timeout:uf,databaseFullPath:n}));return{data:ma(a,r.data)}}catch(r){return{error:r}}}})})});var hf=a(51016),mf=a(49917),gf=a(93381),vf=a(32133),yf=a.n(vf);const xf=({text:e,action:t,isLoading:a})=>({text:(0,c.jsxs)(ke.s,{justifyContent:"space-between",alignItems:"center",children:[e,a&&(0,c.jsx)(Yy.t,{size:"xs"})]}),action:t,disabled:a}),bf=(e,t,a="",n)=>(s,r)=>{const i=((e,t,a)=>{const{setActivePath:n,showCreateDirectoryDialog:s,getConfirmation:r,getConnectToDBDialog:i,schemaData:o,streamingQueryData:l}=a,c=a=>()=>{const s=()=>{t((0,x.es)(E.Dg.query)),t((0,x.sH)(E.tQ.newQuery)),n(e.path),Kv(a({...e,schemaData:o,streamingQueryData:l}))};r?r().then((e=>{e&&s()})):s()};return{createDirectory:s?()=>{s(e.path)}:void 0,getConnectToDBDialog:()=>null===i||void 0===i?void 0:i({database:e.database}),openMonitoring:()=>{t((0,x.es)(E.Dg.diagnostics)),t((0,x.WO)(E.iJ.monitoring)),n(e.path)},createTable:c(Xv),createColumnTable:c(ey),createAsyncReplication:c(ty),alterAsyncReplication:c(vy),dropAsyncReplication:c(my),createTransfer:c(ay),alterTransfer:c(yy),dropTransfer:c(gy),alterTable:c(ny),dropTable:c(Ry),manageAutoPartitioning:c(sy),selectQuery:c(ry),upsertQuery:c(iy),createExternalTable:c(ly),dropExternalTable:c(oy),selectQueryFromExternalTable:c(ry),createTopic:c(cy),alterTopic:c(dy),dropTopic:c(uy),createView:c(py),dropView:c(hy),createStreamingQuery:c(xy),alterStreamingQuerySettings:c(by),alterStreamingQueryText:c(fy),dropStreamingQuery:c(jy),dropIndex:c(Sy),addTableIndex:c(Ty),createCdcStream:c(wy),copyPath:()=>{try{yf()(e.relativePath),(0,$e.A)({name:"Copied",title:yt("actions.copied"),theme:"success"})}catch{(0,$e.A)({name:"Not copied",title:yt("actions.notCopied"),theme:"danger"})}}}})({path:s,relativePath:ut(s,a),database:n,type:r,databaseFullPath:a},e,t),o={text:yt("actions.copyPath"),action:i.copyPath,iconStart:(0,c.jsx)(hf.A,{})},l={text:yt("actions.connectToDB"),action:i.getConnectToDBDialog,iconStart:(0,c.jsx)(mf.A,{})},d={text:yt("actions.openMonitoring"),action:i.openMonitoring,iconStart:(0,c.jsx)(ri.A,{})},u=[{text:yt("actions.createTable"),action:i.createTable},{text:yt("actions.createColumnTable"),action:i.createColumnTable},{text:yt("actions.createAsyncReplication"),action:i.createAsyncReplication},{text:yt("actions.createTransfer"),action:i.createTransfer},{text:yt("actions.createTopic"),action:i.createTopic},{text:yt("actions.createView"),action:i.createView},{text:yt("actions.createStreamingQuery"),action:i.createStreamingQuery}],p={text:yt("actions.alterTable"),items:[{text:yt("actions.manageColumns"),action:i.alterTable},{text:yt("actions.manageAutoPartitioning"),action:i.manageAutoPartitioning}]};let h=[[o,l],u];const m=[[o],u];if(t.hasMonitoring&&(h=[[o,l,d],u]),i.createDirectory){const e={text:yt("actions.createDirectory"),action:i.createDirectory,iconStart:(0,c.jsx)(gf.A,{})};h.splice(1,0,[e]),m.splice(1,0,[e])}const g=[[o],[p,{text:yt("actions.dropTable"),action:i.dropTable},xf({text:yt("actions.selectQuery"),action:i.selectQuery,isLoading:t.isSchemaDataLoading}),xf({text:yt("actions.upsertQuery"),action:i.upsertQuery,isLoading:t.isSchemaDataLoading}),{text:yt("actions.addTableIndex"),action:i.addTableIndex},{text:yt("actions.createCdcStream"),action:i.createCdcStream}]],v=[[o],[p,{text:yt("actions.dropTable"),action:i.dropTable},{text:yt("actions.selectQuery"),action:i.selectQuery},{text:yt("actions.upsertQuery"),action:i.upsertQuery}]],y=[[o],[{text:yt("actions.alterTopic"),action:i.alterTopic},{text:yt("actions.dropTopic"),action:i.dropTopic}]],b=[[o],[{text:yt("actions.selectQuery"),action:i.selectQueryFromExternalTable}],[{text:yt("actions.dropTable"),action:i.dropExternalTable}]],f=[[o],[{text:yt("actions.createExternalTable"),action:i.createExternalTable}]],j=[[o],[{text:yt("actions.selectQuery"),action:i.selectQuery}],[{text:yt("actions.dropView"),action:i.dropView}]],T=[[o],[{text:yt("actions.selectQuery"),action:i.selectQuery}]],S=[o];return{async_replication:[[o],[{text:yt("actions.alterReplication"),action:i.alterAsyncReplication},{text:yt("actions.dropReplication"),action:i.dropAsyncReplication}]],transfer:[[o],[{text:yt("actions.alterTransfer"),action:i.alterTransfer},{text:yt("actions.dropTransfer"),action:i.dropTransfer}]],database:h,directory:m,resource_pool:S,table:g,column_table:v,system_table:T,index_table:S,topic:y,stream:S,index:[[o,{text:yt("actions.dropIndex"),action:i.dropIndex}]],external_table:b,external_data_source:f,view:j,streaming_query:[[o],[{text:yt("actions.alterStreamingQuerySettings"),action:i.alterStreamingQuerySettings},xf({text:yt("actions.alterStreamingQueryText"),action:i.alterStreamingQueryText,isLoading:t.isStreamingQueryTextLoading}),{text:yt("actions.dropStreamingQuery"),action:i.dropStreamingQuery}]]}[r]},ff=(0,l.cn)("ydb-schema-create-directory-dialog"),jf="relativePath";function Tf({open:e,onClose:t,database:a,databaseFullPath:s,parentPath:r,onSuccess:i}){const[o,l]=n.useState(""),[d,u]=n.useState(""),[p,h]=y.sM.useCreateDirectoryMutation(),m=n.useRef(null),g=()=>{l(""),h.reset()},v=()=>{t(),u(""),g()},x=ut(r,s);return(0,c.jsxs)($a.l,{open:e,onClose:v,size:"s",initialFocus:m,children:[(0,c.jsx)($a.l.Header,{caption:yt("schema.tree.dialog.header")}),(0,c.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=(n=d)?/\s/.test(n)?yt("schema.tree.dialog.whitespace"):"":yt("schema.tree.dialog.empty");var n;l(t),t||p({database:a,databaseFullPath:s,path:`${r}/${d}`}).unwrap().then((()=>{v(),i(d)}))},children:[(0,c.jsxs)($a.l.Body,{children:[(0,c.jsxs)("label",{htmlFor:jf,className:ff("label"),children:[(0,c.jsx)("span",{className:ff("description"),children:yt("schema.tree.dialog.description")}),`${x}/`]}),(0,c.jsx)("div",{className:ff("input-wrapper"),children:(0,c.jsx)(Ha.k,{controlRef:m,placeholder:yt("schema.tree.dialog.placeholder"),value:d,onUpdate:e=>{u(e),g()},autoFocus:!0,hasClear:!0,autoComplete:!1,disabled:h.isLoading,validationState:o?"invalid":void 0,id:jf,errorMessage:o})}),h.isError&&(0,c.jsx)(F.o,{error:h.error,defaultMessage:yt("schema.tree.dialog.invalid")})]}),(0,c.jsx)($a.l.Footer,{loading:h.isLoading,textButtonApply:yt("schema.tree.dialog.buttonApply"),textButtonCancel:yt("schema.tree.dialog.buttonCancel"),onClickButtonCancel:v,propsButtonApply:{type:"submit"}})]})]})}const Sf=n.createContext(void 0),wf=n.createContext(void 0);function Ef({children:e}){const[t,a]=n.useState("");return(0,c.jsx)(Sf.Provider,{value:t,children:(0,c.jsx)(wf.Provider,{value:a,children:e})})}function _f(){const e=n.useContext(wf);if(void 0===e)throw new Error("useDispatchTreeKey must be used within a TreeKeyProvider");return e}function Nf(e){const t=(0,I.Ii)(),{rootName:a,rootType:s,currentPath:r,onActivePathUpdate:i,databaseFullPath:o,database:l}=e,d=(0,j.YQ)(),u=(0,j.N4)(wc.Wp),p=(0,j.N4)(wc.TY),[h,{currentData:m,isFetching:g}]=pf.useLazyGetTableSchemaDataQuery(),[v,{currentData:b,isFetching:f}]=Dr.useLazyGetStreamingQueryInfoQuery(),T=(0,I._p)(),[S,w]=n.useState(!1),[E,_]=n.useState(""),N=_f(),C=function(){const e=n.useContext(Sf);if(void 0===e)throw new Error("useTreeKey must be used within a TreeKeyProvider");return e}(),P=pt(o,s)?"database":Tt(s),D=n.useCallback((async e=>{let t;for(;;){const a=d(y.sM.endpoints.getSchema.initiate({path:e,database:l,databaseFullPath:o},{forceRefetch:!0})),{data:n,originalArgs:s}=await a;if(a.unsubscribe(),(null===s||void 0===s?void 0:s.path)===e){t=null===n||void 0===n?void 0:n[e];break}}if(!t)throw new Error(`No describe data about path ${e}`);const{PathDescription:{Children:a=[]}={}}=t;return a.map((e=>{const{Name:t="",PathType:a,PathSubType:n,ChildrenExist:s}=e,r=Ot(a,n)||(0,Br.f8)(s)&&!s;return{name:t,type:Tt(a,n),expandable:!r,meta:{subType:n}}}))}),[d,l,o]);n.useEffect((()=>{null!==r&&void 0!==r&&r.startsWith(o)||i(o)}),[r,i,o]);const k=e=>{_(e),w(!0)},{monitoring:O}=(0,A.Zd)(),{controlPlane:M}=(0,x.Ry)(l),F=n.useMemo((()=>{const e=(0,R.P)(M,O);return bf(d,{setActivePath:i,showCreateDirectoryDialog:t?k:void 0,getConfirmation:u&&p?$g:void 0,getConnectToDBDialog:df.S,schemaData:m,isSchemaDataLoading:g,hasMonitoring:e,streamingQueryData:b,isStreamingQueryTextLoading:f},o,l)}),[m,t,d,u,g,p,f,i,b,l,o,M,O]);return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(Tf,{onClose:()=>{w(!1)},open:S,database:l,databaseFullPath:o,parentPath:E,onSuccess:e=>{const t=`${E}/${e}`;i(t),N(t)}}),(0,c.jsx)(cf.F,{rootState:{path:o,name:a,type:P,collapsed:!1},fetchPath:D,getActions:F,onActionsOpenToggle:({path:e,type:t,isOpen:a})=>{const n=ft[t];a&&n&&h({path:e,database:l,type:n,databaseFullPath:o});const s=jt[t];return a&&s&&v({database:l,path:e},!0),[]},renderAdditionalNodeElements:of(d,{setActivePath:i},void 0,T),activePath:r,onActivePathUpdate:i,cache:!1,virtualize:!0},C)]})}const Cf=JSON.parse('{"title_navigation":"Navigation","field_source-type":"Source Type","field_data-source":"Data Source","action_copySchemaPath":"Copy schema path","action_openInDiagnostics":"Open in Diagnostics","field_type":"Type","field_subtype":"SubType","field_id":"Id","field_version":"Version","field_created":"Created","field_data-size":"Data size","field_row-count":"Row count","field_partitions":"Partitions count","field_system-view-type":"System view type","field_paths":"Paths","field_shards":"Shards","field_state":"State","field_mode":"Mode","field_format":"Format","field_retention":"Retention"}'),Pf=(0,ge.g4)("ydb-object-summary",{en:Cf}),If=(0,l.cn)("ydb-object-summary");function Af({database:e,path:t,databaseFullPath:a}){var n;const{data:s={},isLoading:r}=(0,y.Tn)({path:a,databaseFullPath:a,database:e}),i=null===s||void 0===s||null===(n=s.PathDescription)||void 0===n?void 0:n.Self,{handleSchemaChange:o}=Ra();return!i&&r?(0,c.jsx)("div",{children:(0,c.jsx)(L.a,{})}):(0,c.jsxs)("div",{className:If("tree-wrapper"),children:[(0,c.jsx)("div",{className:If("tree-header"),children:Pf("title_navigation")}),(0,c.jsx)("div",{className:If("tree"),children:i?(0,c.jsx)(Nf,{database:e,databaseFullPath:a,rootName:(l=i.Name,d=a,l?l.startsWith("/")?l:`/${l}`:d.startsWith("/")?d:`/${d}`),rootType:i.PathType,currentPath:t,onActivePathUpdate:o}):null})]});var l,d}var Df=a(16963);function Rf(){const e=(0,j.YQ)(),{diagnosticsTab:t,tenantPage:a}=(0,j.N4)((e=>e.tenant)),n=a===E.Dg.diagnostics&&t===E.iJ.schema;return(0,c.jsx)("div",{children:!n&&(0,c.jsx)(ja.$,{title:Pf("action_openInDiagnostics"),onClick:()=>{e((0,x.es)(E.Dg.diagnostics)),e((0,x.WO)(E.iJ.schema))},size:"s",children:(0,c.jsx)(Me.I,{data:Df.A,size:14})})})}var kf=a(8873),Of=a(97091);function Mf(){const e=_f(),t=(0,j.YQ)();return(0,c.jsx)(Oe.m,{title:"Refresh",children:(0,c.jsx)(ja.$,{className:If("refresh-button"),view:"flat-secondary",onClick:()=>{e((0,Of.Ak)()),t(g.F.util.invalidateTags(["SchemaTree"]))},children:(0,c.jsx)(Me.I,{data:kf.A})})})}const Ff=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:Boolean(localStorage.getItem(f.hh))});function Lf({onCollapseSummary:e,onExpandSummary:t,isCollapsed:a}){var s;const{path:r,database:i,type:o,databaseFullPath:l}=ba(),d=(0,j.YQ)(),{handleSchemaChange:u}=Ra(),[p,m]=n.useReducer(fv(f.hh),void 0,Ff),{summaryTab:g=E.ml.overview}=(0,j.N4)((e=>e.tenant)),y=(0,ar.zy)(),b=In().parse(y.search,{ignoreQueryPrefix:!0}),{currentData:T}=v.useGetOverviewQuery({path:r,database:i,databaseFullPath:l}),S=null===T||void 0===T||null===(s=T.PathDescription)||void 0===s?void 0:s.Self;n.useEffect((()=>{const e=Ct(o);!o||e||Rn.x$.find((e=>e.id===g))||d((0,x.Mj)(E.ml.overview))}),[d,o,g]);const w=()=>{const e=Ct(o)?[...Rn.x$,...Rn.nb]:Rn.x$;return(0,c.jsx)("div",{className:If("tabs"),children:(0,c.jsxs)(ke.s,{className:If("tabs-inner"),justifyContent:"space-between",alignItems:"center",children:[(0,c.jsx)(_.f,{value:g,children:(0,c.jsx)(N.w,{size:"l",children:e.map((({id:e,title:t})=>{const a=(0,B.YL)({...b,[Rn.vh.summaryTab]:e});return(0,c.jsx)(_u.o,{value:e,children:(0,c.jsx)(An.E,{to:a,as:"tab",children:t})},e)}))})}),g===E.ml.schema&&(0,c.jsx)(Rf,{})]})})},C=()=>g===E.ml.schema?(0,c.jsx)(va,{type:o,path:r,database:i,databaseFullPath:l}):(()=>{var e;if(!S)return;const{CreateStep:t,PathType:a,PathSubType:s,PathId:i,PathVersion:o}=S,l=[],d=pt(r,a)?"Domain":null===a||void 0===a?void 0:a.replace(/^EPathType/,"");l.push({name:Pf("field_type"),content:d}),s!==ot.EPathSubTypeEmpty&&l.push({name:Pf("field_subtype"),content:null===s||void 0===s?void 0:s.replace(/^EPathSubType/,"")}),l.push({name:Pf("field_id"),content:i}),l.push({name:Pf("field_version"),content:o}),Number(t)&&l.push({name:Pf("field_created"),content:(0,U.r6)(t)});const{PathDescription:u}=T;if(null!==u&&void 0!==u&&u.TableStats){const{DataSize:e,RowCount:t}=u.TableStats;l.push({name:Pf("field_data-size"),content:Ns(e)},{name:Pf("field_row-count"),content:(0,U.ZV)(t)})}const p=()=>{var e;const{PathsInside:t,ShardsInside:a,PathsLimit:n,ShardsLimit:s}=null!==(e=null===u||void 0===u?void 0:u.DomainDescription)&&void 0!==e?e:{};let r=(0,U.ZV)(t),i=(0,U.ZV)(a);return r&&n&&(r=`${r} / ${(0,U.ZV)(n)}`),i&&s&&(i=`${i} / ${(0,U.ZV)(s)}`),[{name:Pf("field_paths"),content:r},{name:Pf("field_shards"),content:i}]},h={[it.EPathTypeInvalid]:void 0,[it.EPathTypeDir]:void 0,[it.EPathTypeResourcePool]:void 0,[it.EPathTypeTable]:()=>{var e;return[{name:Pf("field_partitions"),content:null===u||void 0===u||null===(e=u.TablePartitions)||void 0===e?void 0:e.length}]},[it.EPathTypeSysView]:()=>{var e;return[{name:Pf("field_system-view-type"),content:lr(null===u||void 0===u||null===(e=u.SysViewDescription)||void 0===e?void 0:e.Type)}]},[it.EPathTypeSubDomain]:p,[it.EPathTypeTableIndex]:void 0,[it.EPathTypeExtSubDomain]:p,[it.EPathTypeColumnStore]:()=>{var e,t;return[{name:Pf("field_partitions"),content:null===u||void 0===u||null===(e=u.ColumnStoreDescription)||void 0===e||null===(t=e.ColumnShards)||void 0===t?void 0:t.length}]},[it.EPathTypeColumnTable]:()=>{var e,t,a;return[{name:Pf("field_partitions"),content:null===u||void 0===u||null===(e=u.ColumnTableDescription)||void 0===e||null===(t=e.Sharding)||void 0===t||null===(a=t.ColumnShards)||void 0===a?void 0:a.length}]},[it.EPathTypeCdcStream]:()=>{const{Mode:e,Format:t}=(null===u||void 0===u?void 0:u.CdcStreamDescription)||{};return[{name:Pf("field_mode"),content:null===e||void 0===e?void 0:e.replace(/^ECdcStreamMode/,"")},{name:Pf("field_format"),content:null===t||void 0===t?void 0:t.replace(/^ECdcStreamFormat/,"")}]},[it.EPathTypePersQueueGroup]:()=>{var e,t,a;const n=null===u||void 0===u?void 0:u.PersQueueGroup,s=null===n||void 0===n||null===(e=n.PQTabletConfig)||void 0===e||null===(t=e.PartitionConfig)||void 0===t?void 0:t.LifetimeSeconds;return[{name:Pf("field_partitions"),content:null===n||void 0===n||null===(a=n.Partitions)||void 0===a?void 0:a.length},{name:Pf("field_retention"),content:s&&(0,U.Pt)(s)}]},[it.EPathTypeExternalTable]:()=>{var e,t;const a=(0,B.Ow)({...b,schema:null===u||void 0===u||null===(e=u.ExternalTableDescription)||void 0===e?void 0:e.DataSourcePath}),{SourceType:n,DataSourcePath:s}=(null===u||void 0===u?void 0:u.ExternalTableDescription)||{},r=(null===s||void 0===s||null===(t=s.match(/([^/]*)\/*$/))||void 0===t?void 0:t[1])||"";return[{name:Pf("field_source-type"),content:n},{name:Pf("field_data-source"),content:s&&(0,c.jsx)("span",{title:s,children:(0,c.jsx)(nr.K,{title:r||"",url:a})})}]},[it.EPathTypeExternalDataSource]:()=>{var e;return[{name:Pf("field_source-type"),content:null===u||void 0===u||null===(e=u.ExternalDataSourceDescription)||void 0===e?void 0:e.SourceType}]},[it.EPathTypeView]:void 0,[it.EPathTypeReplication]:()=>{var e;const t=null===u||void 0===u||null===(e=u.ReplicationDescription)||void 0===e?void 0:e.State;return t?[{name:Pf("field_state"),content:(0,c.jsx)(pr,{state:t})}]:[]},[it.EPathTypeTransfer]:()=>{var e;const t=null===u||void 0===u||null===(e=u.ReplicationDescription)||void 0===e?void 0:e.State;return t?[{name:Pf("field_state"),content:(0,c.jsx)(pr,{state:t})}]:[]},[it.EPathTypeStreamingQuery]:void 0},m=a&&(null===(e=h[a])||void 0===e?void 0:e.call(h))||[];l.push(...m);const g=l.filter((e=>e.content)).map((e=>({...e,content:(0,c.jsx)("div",{className:If("overview-item-content"),children:e.content})})));return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)("div",{className:If("overview-title"),children:(0,c.jsx)(qr,{data:u})}),(0,c.jsx)(Qs.u,{responsive:!0,children:g.map((e=>(0,c.jsx)(Qs.u.Item,{name:e.name,children:e.content},e.name)))})]})})(),P=()=>{m(yv.triggerCollapse)},I=()=>{m(yv.triggerExpand)},A=()=>{m(yv.clear)},D=ut(r,l),R=()=>{const e=Ct(o);return(0,c.jsxs)(n.Fragment,{children:[e&&lf(d,{setActivePath:u},"m")(r,"preview"),(0,c.jsx)(_m.b,{text:D,view:"flat-secondary",title:Pf("action_copySchemaPath")}),(0,c.jsx)(Tv,{onCollapse:P,onExpand:I,isCollapsed:p.collapsed,initialDirection:"bottom"})]})},k=()=>{const{Status:e,Reason:t}=null!==T&&void 0!==T?T:{};if(o){let e=o.replace("EPathType","");return pt(r,o)&&(e="domain"),(0,c.jsx)("div",{className:If("entity-type"),children:e})}let a;return e&&t&&(a=`${e}: ${t}`),(0,c.jsx)("div",{className:If("entity-type",{error:!0}),children:(0,c.jsx)(kn.H,{content:a})})};return(0,c.jsx)(Ef,{children:(0,c.jsxs)("div",{className:If(),children:[(0,c.jsx)("div",{className:If({hidden:a}),children:(0,c.jsxs)(h,{direction:"vertical",defaultSizePaneKey:f.ED,onSplitStartDragAdditional:A,triggerCollapse:p.triggerCollapse,triggerExpand:p.triggerExpand,minSize:[200,52],collapsedSizes:[100,0],children:[(0,c.jsx)(Af,{database:i,path:r,databaseFullPath:l}),(0,c.jsxs)("div",{className:If("info"),children:[(0,c.jsxs)("div",{className:If("sticky-top"),children:[(0,c.jsxs)("div",{className:If("info-header"),children:[(0,c.jsxs)("div",{className:If("info-title"),children:[k(),(0,c.jsx)("div",{className:If("path-name"),children:D})]}),(0,c.jsx)("div",{className:If("info-controls"),children:R()})]}),w()]}),(0,c.jsx)("div",{className:If("overview-wrapper"),children:C()})]})]})}),(0,c.jsxs)(ke.s,{className:If("actions"),gap:.5,children:[!a&&(0,c.jsx)(Mf,{}),(0,c.jsx)(Tv,{onCollapse:e,onExpand:t,isCollapsed:a,initialDirection:"left"})]})]})})}var qf=a(70825),zf=a(43937),Uf=a(36388);const Qf=JSON.parse('{"title_degraded":"Degraded","title_emergency":"Emergency","title_maintenance":"Maintenance required","title_good":"Good","title_unspecified":"Unspecified"}'),Gf=(0,ge.g4)("ydb-healthcheck-status",{en:Qf}),Bf={[uo.GOOD]:"success",[uo.DEGRADED]:"info",[uo.MAINTENANCE_REQUIRED]:"warning",[uo.EMERGENCY]:"danger",[uo.UNSPECIFIED]:"normal"},$f={[uo.GOOD]:qf.A,[uo.DEGRADED]:zf.A,[uo.MAINTENANCE_REQUIRED]:Mm.A,[uo.EMERGENCY]:Uf.A,[uo.UNSPECIFIED]:mf.A},Hf={get[uo.GOOD](){return Gf("title_good")},get[uo.DEGRADED](){return Gf("title_degraded")},get[uo.MAINTENANCE_REQUIRED](){return Gf("title_maintenance")},get[uo.EMERGENCY](){return Gf("title_emergency")},get[uo.UNSPECIFIED](){return Gf("title_unspecified")}};function Vf({status:e,size:t="m"}){const a=Bf[e];return(0,c.jsx)(zt.J,{theme:a,icon:(0,c.jsx)(Me.I,{size:14,data:$f[e]}),size:t,children:Hf[e]})}var Wf=a(27916);function Jf(){const{issuesFilter:e,handleIssuesFilterChange:t}=Ra();return(0,c.jsx)(me.v,{value:null!==e&&void 0!==e?e:"",onChange:t,placeholder:(0,Wf.A)("description_search-issue"),width:"250px"})}var Kf=a(7889),Yf=a(44520),Zf=a(37477),Xf=a(44253);function ej({title:e,children:t,titleVariant:a="body-2",gap:n=3}){return(0,c.jsxs)(ke.s,{direction:"column",gap:n,children:[e&&(0,c.jsx)(Re.E,{variant:a,children:e}),t]})}function tj({title:e,fields:t,titleVariant:a}){const n=t.filter((e=>e.value));return 0===n.length?null:(0,c.jsx)(ej,{title:e,titleVariant:a,children:(0,c.jsx)(Qs.u,{nameMaxWidth:200,children:n.map((e=>(0,c.jsx)(Qs.u.Item,{name:e.title,copyText:e.copy,children:e.value},e.title)))})})}function aj({ids:e,renderItem:t}){return(0,c.jsx)(ke.s,{direction:"column",gap:1,children:e.map((e=>(0,c.jsx)("div",{children:t?t(e):e},e)))})}function nj({node:e,title:t}){const{database:a}=Ra();if(!e)return null;const n=e.id?(0,c.jsx)(An.E,{to:(0,B.vI)({id:e.id},{database:a}),children:e.id}):void 0;return(0,c.jsx)(tj,{title:t,fields:[{value:n,title:(0,Wf.A)("label_node-id")},{value:e.host,title:(0,Wf.A)("label_node-host"),copy:e.host},{value:e.port,title:(0,Wf.A)("label_node-port")}]})}function sj({location:e}){const{pool:t}=null!==e&&void 0!==e?e:{},{name:a}=null!==t&&void 0!==t?t:{};return a?(0,c.jsx)(tj,{fields:[{value:a,title:(0,Wf.A)("label_pool-name")}]}):null}const rj={node:e=>(0,c.jsx)(nj,{node:null===e||void 0===e?void 0:e.node},"node"),pool:e=>(0,c.jsx)(sj,{location:e},"pool"),tablet:e=>(0,c.jsx)(oj,{location:e},"tablet"),schema:e=>(0,c.jsx)(lj,{location:e},"schema")};function ij({location:e,hiddenFields:t=[]}){const{node:a,tablet:s,schema:r,pool:i}=null!==e&&void 0!==e?e:{},o=n.useMemo((()=>{const e=[];return a&&e.push("node"),i&&e.push("pool"),s&&e.push("tablet"),r&&e.push("schema"),e.filter((e=>!t.includes(e)))}),[a,i,s,r,t]);return!e||(0,Xe.isEmpty)(e)||0===o.length?null:(0,c.jsx)(ej,{title:(0,Wf.A)("label_compute_location"),titleVariant:"subheader-2",children:(0,c.jsx)(ke.s,{direction:"column",gap:3,children:o.map((t=>rj[t](e)))})})}function oj({location:e}){var t;const a=(0,B.Cs)(),{tablet:n}=null!==e&&void 0!==e?e:{};return n?(0,c.jsx)(tj,{fields:[{value:null!==(t=n.id)&&void 0!==t&&t.length?(0,c.jsx)(aj,{ids:n.id,renderItem:e=>(0,c.jsx)(An.E,{to:a(e),children:e})}):void 0,title:(0,Wf.A)("label_tablet-id")},{value:n.type,title:(0,Wf.A)("label_tablet-type")},{value:n.count,title:(0,Wf.A)("label_tablet-count")}]}):null}function lj({location:e}){const{schema:t}=null!==e&&void 0!==e?e:{};return t?(0,c.jsx)(tj,{fields:[{value:t.type,title:(0,Wf.A)("label_schema-type")},{value:t.path,title:(0,Wf.A)("label_schema-path")}]}):null}const cj={node:e=>(0,c.jsx)(nj,{node:null===e||void 0===e?void 0:e.node},"node"),pool:e=>(0,c.jsx)(sj,{location:e},"pool"),group:e=>(0,c.jsx)(uj,{location:e},"group"),vdisk:e=>(0,c.jsx)(pj,{location:e},"vdisk"),pdisk:e=>(0,c.jsx)(hj,{location:e},"pdisk")};function dj({location:e,hiddenFields:t=[]}){const{node:a,pool:s}=null!==e&&void 0!==e?e:{},{group:r}=null!==s&&void 0!==s?s:{},{vdisk:i}=null!==r&&void 0!==r?r:{},{pdisk:o}=null!==i&&void 0!==i?i:{},l=n.useMemo((()=>{const e=[];return a&&e.push("node"),s&&e.push("pool"),r&&e.push("group"),i&&e.push("vdisk"),o&&e.push("pdisk"),e.filter((e=>!t.includes(e)))}),[a,s,r,i,o,t]);return!e||(0,Xe.isEmpty)(e)||0===l.length?null:(0,c.jsx)(ej,{title:(0,Wf.A)("label_storage_location"),titleVariant:"subheader-2",children:(0,c.jsx)(ke.s,{direction:"column",gap:3,children:l.map((t=>cj[t](e)))})})}function uj({location:e}){const{pool:t}=null!==e&&void 0!==e?e:{},{group:a}=null!==t&&void 0!==t?t:{},n=null===a||void 0===a?void 0:a.id;return null!==n&&void 0!==n&&n.length?(0,c.jsx)(tj,{fields:[{value:null!==n&&void 0!==n&&n.length?(0,c.jsx)(aj,{ids:n}):void 0,title:(0,Wf.A)("label_group-id")}]}):null}function pj({location:e}){const t=(0,B.Z$)(),{node:a,pool:n}=null!==e&&void 0!==e?e:{},{group:s}=null!==n&&void 0!==n?n:{},{vdisk:r}=null!==s&&void 0!==s?s:{},i=null===r||void 0===r?void 0:r.id;return null!==i&&void 0!==i&&i.length?(0,c.jsx)(tj,{fields:[{value:null!==i&&void 0!==i&&i.length?(0,c.jsx)(aj,{ids:i,renderItem:e=>(0,c.jsx)(An.E,{to:t({vDiskId:e,nodeId:null===a||void 0===a?void 0:a.id}),children:e})}):void 0,title:(0,Wf.A)("label_vdisk-id")}]}):null}function hj({location:e}){const{pool:t}=null!==e&&void 0!==e?e:{},{group:a}=null!==t&&void 0!==t?t:{},{vdisk:n}=null!==a&&void 0!==a?a:{},{pdisk:s}=null!==n&&void 0!==n?n:{};return null!==s&&void 0!==s&&s.length?s.map((e=>{let t,a;if(e.id){const n=e.id.split("-");t=n[0],a=n.slice(1).join("-")}return(0,c.jsx)(tj,{fields:[{value:t&&a?(0,c.jsx)(An.E,{to:(0,B.Ck)(a,t),children:e.id}):e.id,title:(0,Wf.A)("label_pdisk-id")},{value:e.path,title:(0,Wf.A)("label_pdisk-path")}]},e.id||e.path)})):null}function mj({location:e,hiddenStorageFields:t,hiddenComputeFields:a}){return(0,c.jsxs)(n.Fragment,{children:[(0,c.jsx)(dj,{location:null===e||void 0===e?void 0:e.storage,hiddenFields:t}),(0,c.jsx)(ij,{location:null===e||void 0===e?void 0:e.compute,hiddenFields:a}),(0,c.jsx)(gj,{location:null===e||void 0===e?void 0:e.node}),(0,c.jsx)(vj,{location:null===e||void 0===e?void 0:e.peer})]})}function gj({location:e}){return!e||(0,Xe.isEmpty)(e)?null:(0,c.jsx)(ej,{title:(0,Wf.A)("label_node_location"),children:(0,c.jsx)(nj,{node:e})})}function vj({location:e}){return!e||(0,Xe.isEmpty)(e)?null:(0,c.jsx)(ej,{title:(0,Wf.A)("label_peer_location"),children:(0,c.jsx)(nj,{node:e})})}function yj({issue:e}){const t=(0,B.Cs)(),{detailsFields:a,hiddenStorageFields:s,hiddenComputeFields:r}=n.useMemo((()=>{const a=[],n=[],s=[{value:e.message,title:(0,Wf.A)("label_description")}];var r,i,o,l,d,u;"STORAGE_POOL"===e.type&&(s.push({value:null===(r=e.location)||void 0===r||null===(i=r.storage)||void 0===i||null===(o=i.pool)||void 0===o?void 0:o.name,title:(0,Wf.A)("label_pool-name")}),a.push("pool"));"COMPUTE_POOL"===e.type&&(s.push({value:null===(l=e.location)||void 0===l||null===(d=l.compute)||void 0===d||null===(u=d.pool)||void 0===u?void 0:u.name,title:(0,Wf.A)("label_pool-name")}),n.push("pool"));if("TABLET"===e.type){var p,h,m;const a=null===(p=e.location)||void 0===p||null===(h=p.compute)||void 0===h?void 0:h.tablet;s.push({value:null!==a&&void 0!==a&&null!==(m=a.id)&&void 0!==m&&m.length?(0,c.jsx)(aj,{ids:a.id,renderItem:e=>(0,c.jsx)(An.E,{to:t(e),children:e})}):void 0,title:(0,Wf.A)("label_tablet-id")},{value:null===a||void 0===a?void 0:a.type,title:(0,Wf.A)("label_tablet-type")},{value:null===a||void 0===a?void 0:a.count,title:(0,Wf.A)("label_tablet-count")}),n.push("tablet")}return{detailsFields:s,hiddenComputeFields:n,hiddenStorageFields:a}}),[e,t]),{location:i}=e;return(0,c.jsxs)(ke.s,{direction:"column",gap:4,children:[(0,c.jsx)(tj,{title:(0,Wf.A)("label_details"),fields:a,titleVariant:"subheader-2"}),(0,c.jsx)(mj,{location:i,hiddenStorageFields:s,hiddenComputeFields:r})]})}function xj(e){const t=e.split("_").join(" ");let a=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();return a=a.replace(/\bvdisk\b/gi,"VDisk").replace(/\bpdisk\b/gi,"PDisk"),a}function bj({parents:e,selectedTab:t,setSelectedTab:a}){return e.length<=1?null:(0,c.jsx)(ke.s,{gap:2,wrap:"nowrap",children:e.map(((n,s)=>(0,c.jsxs)(ke.s,{gap:2,wrap:"nowrap",children:[(0,c.jsx)(fj,{active:n.id===t,onClick:()=>a(n.id),children:(0,c.jsxs)(ke.s,{gap:2,wrap:"nowrap",alignItems:"center",children:[n.status&&(0,c.jsx)(jj,{status:n.status}),n.type&&xj(n.type)]})}),s!==e.length-1&&(0,c.jsx)(Re.E,{color:"secondary",children:"/"})]},n.id)))})}function fj({children:e,active:t,onClick:a}){return(0,c.jsx)(Re.E,{variant:"body-2",color:t?"primary":"secondary",className:(0,Xf.b)("issue-tab",{active:t}),onClick:a,children:e})}function jj({status:e}){return(0,c.jsx)("div",{className:(0,Xf.b)("tab-status",{[e.toLowerCase()]:!0})})}function Tj({issue:e,expanded:t}){const[a,s]=n.useState(e.id),r=n.useMemo((()=>{const t=[];let a=e;for(;a;)t.push(a),a=a.parent;return t.reverse()}),[e]),i=n.useMemo((()=>r.find((e=>e.id===a))),[r,a]);return(0,c.jsx)(ke.s,{className:(0,Xf.b)("issue-wrapper"),children:(0,c.jsxs)(Yf.E,{className:(0,Xf.b)("issue-content"),defaultExpanded:t,children:[(0,c.jsx)(Yf.E.Summary,{children:t=>(0,c.jsx)("button",{...t,className:(0,Xf.b)("disclosure-trigger"),children:(0,c.jsxs)(ke.s,{wrap:"nowrap",gap:2,justifyContent:"space-between",className:(0,Xf.b)("issue-summary"),children:[(0,c.jsxs)(ke.s,{direction:"column",gap:1,alignSelf:"center",children:[(0,c.jsx)(Re.E,{variant:"subheader-2",children:e.message}),e.status&&(0,c.jsx)("div",{className:(0,Xf.b)("issue-status"),children:(0,c.jsx)(Zf.c.Label,{size:"s",status:ho[e.status]})})]}),(0,c.jsxs)(ke.s,{wrap:"nowrap",gap:2,alignItems:"center",height:"max-content",children:[(0,c.jsx)(Fa.c,{className:(0,Xf.b)("issue-divider"),orientation:"vertical"}),(0,c.jsx)(yi.I,{direction:t.expanded?"top":"bottom"})]})]})})}),(0,c.jsx)("div",{className:(0,Xf.b)("animation-container"),children:(0,c.jsxs)(ke.s,{className:(0,Xf.b)("issue-details"),direction:"column",gap:3,grow:1,children:[(0,c.jsx)(bj,{parents:r,selectedTab:a,setSelectedTab:s}),i&&(0,c.jsx)(yj,{issue:i})]})})]})})}function Sj({issues:e}){const{view:t,issuesFilter:a}=Ra(),s=n.useMemo((()=>{const t=null===a||void 0===a?void 0:a.toLowerCase().trim();return t?e.filter((e=>{const a=Object.values(e);for(;a.length;){const e=a.pop();if("object"===typeof e)a.push(...Object.values(e));else if(String(e).toLowerCase().includes(t))return!0}return!1})):e}),[e,a]),r=n.useMemo((()=>t?s.filter((e=>{const a=e.firstParentType||e.type;return null===a||void 0===a?void 0:a.toLowerCase().startsWith(t)})):[]),[s,t]);return 0===r.length?(0,c.jsx)(ke.s,{grow:1,justifyContent:"center",alignItems:"center",children:(0,c.jsx)(Kf.pp,{image:(0,c.jsx)(Oh.oN,{width:100,height:100}),position:"center",size:"xs",title:(0,Wf.A)("label_no-issues"),description:(0,Wf.A)("description_no-issues")})}):r.map((e=>(0,c.jsx)(Tj,{issue:e,expanded:Boolean(a)},e.id+Boolean(a))))}function wj(e=0){return Date.now()-e}function Ej({lastFullfiled:e,refresh:t}){const[a,s]=n.useState(wj(e));n.useEffect((()=>{s(wj(e));const t=setInterval((()=>{s(wj(e))}),60*f.KF);return()=>clearInterval(t)}),[e]);return(0,c.jsxs)(ke.s,{gap:2,alignItems:"center",children:[(()=>{if((0,Xe.isNil)(e))return null;const t=a>f.Jg*f.KF,n=a>f.tt*f.KF,s=(0,Ie.p0)(a);let r="";if(n){const e=s.asDays();r=(0,Wf.A)("description_days",{count:Math.round(e)})}else if(t){const e=s.asHours();r=(0,Wf.A)("description_hours",{count:Math.round(e)})}else{const e=s.asMinutes();r=(0,Wf.A)("description_minutes",{count:Math.round(e)})}return(0,c.jsx)(Re.E,{color:"secondary",children:r})})(),(0,c.jsx)(Oe.m,{title:(0,Wf.A)("action_refresh"),children:(0,c.jsx)(ja.$,{view:"outlined",onClick:()=>{t()},children:(0,c.jsx)(ja.$.Icon,{children:(0,c.jsx)(kf.A,{})})})})]})}const _j={storage:"storage",compute:"compute"};function Nj({issuesCount:e,viewTitles:t=b.J.healthcheck.getHealthckechViewTitles(),sortOrder:a=b.J.healthcheck.getHealthcheckViewsOrder()}){const{view:s,handleHealthcheckViewChange:r,handleIssuesFilterChange:i}=Ra(),o=n.useMemo((()=>Object.keys(e)),[e]);n.useEffect((()=>{if(!s)if(e[_j.storage])r(_j.storage);else if(e[_j.compute])r(_j.compute);else{const t=a.find((t=>e[t]>0));r(t)}}),[s,r,e,o,a]);const l=t=>{var a;return(0,c.jsx)(Re.E,{color:"secondary",children:null!==(a=e[t])&&void 0!==a?a:0})};return(0,c.jsx)(eh.x,{value:s,onUpdate:e=>{r(e),i("")},className:(0,Xf.b)("control-wrapper"),children:a.map((e=>(e=>{var a;return(0,c.jsxs)(eh.x.Option,{value:e,children:[null!==(a=t[e])&&void 0!==a?a:e,"\xa0",l(e)]},e)})(e)))})}const Cj=(e,{autorefresh:t}={})=>{const{databaseType:a}=(0,x.Ry)(e),{currentData:n,isFetching:s,error:r,refetch:i,fulfilledTimeStamp:o}=mo.useGetHealthcheckInfoQuery({database:e},{pollingInterval:t,skip:"Serverless"===a});return{loading:void 0===n&&s,error:r,refetch:i,selfCheckResult:(null===n||void 0===n?void 0:n.self_check_result)||uo.UNSPECIFIED,fulfilledTimeStamp:o,leavesIssues:(0,j.N4)((t=>jo(t,e)))}};function Pj({database:e,countIssueTypes:t=b.J.healthcheck.countHealthcheckIssuesByType}){const a=(0,j.N4)((e=>e.fullscreen)),{loading:s,error:r,selfCheckResult:i,fulfilledTimeStamp:o,leavesIssues:l,refetch:d}=Cj(e),u=n.useMemo((()=>t(l)),[l,t]);return(0,c.jsx)(Vh,{children:(0,c.jsx)(ke.s,{className:(0,Xf.b)(),grow:1,children:r?(0,c.jsxs)(ke.s,{direction:"column",gap:1,className:(0,Xf.b)("stub-wrapper"),children:[(0,c.jsx)(F.o,{error:r,defaultMessage:(0,Wf.A)("description_no-data")}),(0,c.jsx)(Me.I,{data:Fc,size:100})]}):s?(0,c.jsx)(L.a,{size:"m"}):i!==uo.GOOD||l&&l.length?(0,c.jsxs)(ke.s,{direction:"column",grow:1,children:[(0,c.jsxs)(ke.s,{direction:"column",gap:3,className:(0,Xf.b)("controls",{fullscreen:a}),children:[(0,c.jsxs)(ke.s,{justifyContent:"space-between",gap:2,children:[(0,c.jsx)(Vf,{status:i}),(0,c.jsx)(Ej,{lastFullfiled:o,refresh:d})]}),(0,c.jsx)(Nj,{issuesCount:u}),(0,c.jsx)(Jf,{})]}),(0,c.jsx)(ke.s,{direction:"column",gap:4,grow:1,className:(0,Xf.b)("issues"),children:(0,c.jsx)(Sj,{issues:l})})]}):(0,c.jsxs)(ke.s,{direction:"column",gap:1,className:(0,Xf.b)("stub-wrapper"),children:[(0,c.jsx)(Qu.v,{name:"thumbsUp",width:200}),Co[i]]})})})}function Ij({children:e}){const{database:t}=ba(),{handleShowHealthcheckChange:a,showHealthcheck:s,handleIssuesFilterChange:r,handleHealthcheckViewChange:i}=Ra(),o=(0,j.N4)((e=>xo(e,t||""))),l=(0,j.N4)((e=>To(e,t||""))),d=n.useCallback((()=>{a(!1),r(void 0),i(void 0)}),[a,r,i]),u=n.useCallback((()=>(0,c.jsx)(Pj,{database:t})),[t]);return(0,c.jsx)(Sc,{isDrawerVisible:Boolean(s),onCloseDrawer:d,renderDrawerContent:u,drawerId:"tenant-healthcheck-details",storageKey:"tenant-healthcheck-details-drawer-width",detectClickOutside:!0,hideVeil:!1,isPercentageWidth:!0,drawerControls:[{type:"custom",key:"download",node:(0,c.jsx)(Oe.m,{title:yt("label_download"),children:(0,c.jsx)(ja.$,{view:"flat",onClick:e=>{e.stopPropagation(),Im(l,`${t}-healthcheck-${(new Date).getTime()}`)},children:(0,c.jsx)(Me.I,{data:Em.A})})})},{type:"custom",node:(0,c.jsx)(Uh,{view:"flat"}),key:"fullscreen"},{type:"close"}],title:(0,c.jsx)(Aj,{status:o}),children:e})}function Aj({status:e}){return(0,c.jsxs)(ke.s,{direction:"column",children:[(0,c.jsx)(Re.E,{variant:"subheader-2",children:yt("label_healthcheck-dashboard")}),(0,c.jsx)(Re.E,{color:"secondary",children:e&&Co[e]})]})}const Dj=JSON.parse('{"description_select-row":"Retrieve data rows from tables using SELECT queries.","description_update-row":"Modify existing data rows with UPDATE operations.","description_erase-row":"Modify existing data rows with UPDATE operations.","description_write-attributes":"Modify object metadata and manage access permissions.","description_create-directory":"Create new subdirectories in the database namespace.","description_create-table":"Define new tables with specified schemas.","description_create-queue":"Set up new message queue instances.","description_remove-schema":"Delete database objects (tables, directories, queues).","description_alter-schema":"Modify object definitions (add/remove columns, change types).","description_create-database":"Initialize new database instances.","description_drop-database":"Permanently delete databases and all contained objects.","description_read-attributes":"View object metadata and access control lists.","description_describe-schema":"Inspect object structure and properties.","description_connect-database":"Establish connections and submit requests to the database.","description_grant-access-rights":"Delegate permissions to other users (within own privilege scope).","description_generic-read":"Read data and metadata. Basic viewing permissions for tables/objects.","description_generic-write":"Modify data and schemas. Write/delete data + alter structure.","description_generic-manage":"Create/drop databases. Infrastructure-level change.","description_generic-list":"View object metadata and schemas. For inspecting structure without data access.","description_generic-use":"Complete data operations. Modern full access excluding DB management.","description_generic-use-legacy":"[Legacy] Complete data operations. Modern full access excluding DB management.","description_generic-full":"Unrestricted system access. All permissions including DB management.","description_generic-full-legacy":"[Legacy] Unrestricted system access. All permissions including DB management.","label_groups":"Groups","label_granular":"Granular","label_inherited":"Inherited","description_no-granular-permissions":"No granular permissions available.","description_no-group-permissions":"No group permissions available.","action_discard":"Discard Changes","action_cancel":"Cancel","action_save":"Apply","label_rights-updated":"Access rights has been successfully changed","description_failed":"Failed","label_grant-access-to":"Grant access to"}'),Rj=(0,ge.g4)("ydb-grant-access",{en:Dj}),kj=(0,l.cn)("ydb-grant-access"),Oj={selectRow:1,updateRow:2,eraseRow:4,writeAttributes:16,createDirectory:32,createTable:64,createQueue:128,removeSchema:256,alterSchema:1024,createDatabase:2048,dropDatabase:4096,readAttributes:8,describeSchema:512,connectDatabase:32768,grantAccessRights:8192,genericRead:521,genericWrite:17910,genericManage:6144,genericList:520,genericUse:59391,genericUseLegacy:26623,genericFull:65535,genericFullLegacy:32767},Mj={[Oj.selectRow]:Rj("description_select-row"),[Oj.updateRow]:Rj("description_update-row"),[Oj.eraseRow]:Rj("description_erase-row"),[Oj.writeAttributes]:Rj("description_write-attributes"),[Oj.createDirectory]:Rj("description_create-directory"),[Oj.createTable]:Rj("description_create-table"),[Oj.createQueue]:Rj("description_create-queue"),[Oj.removeSchema]:Rj("description_remove-schema"),[Oj.alterSchema]:Rj("description_alter-schema"),[Oj.createDatabase]:Rj("description_create-database"),[Oj.dropDatabase]:Rj("description_drop-database"),[Oj.readAttributes]:Rj("description_read-attributes"),[Oj.describeSchema]:Rj("description_describe-schema"),[Oj.connectDatabase]:Rj("description_connect-database"),[Oj.grantAccessRights]:Rj("description_grant-access-rights"),[Oj.genericRead]:Rj("description_generic-read"),[Oj.genericWrite]:Rj("description_generic-write"),[Oj.genericManage]:Rj("description_generic-manage"),[Oj.genericList]:Rj("description_generic-list"),[Oj.genericUse]:Rj("description_generic-use"),[Oj.genericUseLegacy]:Rj("description_generic-use-legacy"),[Oj.genericFull]:Rj("description_generic-full"),[Oj.genericFullLegacy]:Rj("description_generic-full-legacy")};function Fj({onCancel:e,onSave:t,onDiscard:a,loading:n,error:s,disabled:r}){return(0,c.jsxs)(ke.s,{justifyContent:"space-between",gap:2,className:kj("footer"),children:[(0,c.jsx)(ja.$,{view:"outlined",onClick:a,size:"l",className:kj("footer-button"),disabled:r,children:Rj("action_discard")}),(0,c.jsxs)(ke.s,{gap:2,alignItems:"center",children:[s&&(0,c.jsx)(Oe.m,{title:s,children:(0,c.jsx)(zt.J,{size:"m",theme:"danger",icon:(0,c.jsx)(Me.I,{data:No.A}),children:Rj("description_failed")})}),(0,c.jsx)(ja.$,{view:"flat",onClick:e,size:"l",className:kj("footer-button"),children:Rj("action_cancel")}),(0,c.jsx)(ja.$,{onClick:t,view:"action",size:"l",className:kj("footer-button"),loading:n,disabled:r,children:Rj("action_save")})]})]})}function Lj({rights:e,availablePermissions:t,handleChangeRightGetter:a,inheritedRights:n,view:s}){return"Groups"===s?(0,c.jsx)(qj,{rights:e,availablePermissions:null===t||void 0===t?void 0:t.AccessRules,handleChangeRightGetter:a,inheritedRights:n}):(0,c.jsx)(zj,{rights:e,availablePermissions:null===t||void 0===t?void 0:t.AccessRights,handleChangeRightGetter:a,inheritedRights:n})}function qj({rights:e,availablePermissions:t,handleChangeRightGetter:a,inheritedRights:n}){return null!==t&&void 0!==t&&t.length?(0,c.jsx)(ke.s,{gap:3,direction:"column",children:t.map((({Name:t,Mask:s,AccessRights:r=[],AccessRules:i=[]})=>{const o=r.concat(i),l=(d=s)===Oj.genericFullLegacy||d===Oj.genericUseLegacy;var d;const u=e.get(t),p=n.has(t);return!l||u||p?(0,c.jsx)(Uj,{active:u,right:t,onUpdate:a(t),includedRights:o,description:Mj[s],inherited:p},t):null}))}):Rj("description_no-group-permissions")}function zj({rights:e,availablePermissions:t,handleChangeRightGetter:a,inheritedRights:n}){return null!==t&&void 0!==t&&t.length?(0,c.jsx)(ke.s,{gap:3,direction:"column",children:t.map((({Name:t,Mask:s})=>(0,c.jsx)(Uj,{active:e.get(t),right:t,onUpdate:a(t),description:Mj[s],inherited:n.has(t)},t)))}):Rj("description_no-granular-permissions")}function Uj({right:e,onUpdate:t,active:a,includedRights:n,description:s,inherited:r}){const i=r&&!a;return(0,c.jsx)(Ma.Z,{className:kj("single-right"),theme:a||r?"info":"normal",children:(0,c.jsxs)(ke.s,{justifyContent:"space-between",alignItems:"flex-start",gap:4,children:[(0,c.jsxs)(ke.s,{direction:"column",gap:2,children:[(0,c.jsxs)(ke.s,{direction:"column",children:[(0,c.jsx)(Re.E,{variant:"subheader-2",children:e}),s&&(0,c.jsx)(Re.E,{color:"secondary",children:s})]}),null!==n&&void 0!==n&&n.length?(0,c.jsx)(ke.s,{wrap:"wrap",gap:1,children:n.map((e=>(0,c.jsx)(zt.J,{theme:"unknown",children:e},e)))}):null]}),(0,c.jsxs)(ke.s,{direction:"column",gap:2,children:[r&&(0,c.jsx)(zt.J,{theme:"info",children:Rj("label_inherited")}),!i&&(0,c.jsx)(gb.d,{checked:Boolean(a),onUpdate:t})]})]})})}const Qj={Groups:Rj("label_groups"),Granular:Rj("label_granular")};function Gj({value:e,onUpdate:t,availablePermissions:a,rights:s}){var r,i,o,l;const d=null===a||void 0===a||null===(r=a.AccessRules)||void 0===r||null===(i=r.filter((e=>s.get(e.Name))))||void 0===i?void 0:i.length,u=null===a||void 0===a||null===(o=a.AccessRights)||void 0===o||null===(l=o.filter((e=>s.get(e.Name))))||void 0===l?void 0:l.length;return(0,c.jsx)("div",{className:kj("view-selector"),children:(0,c.jsxs)(eh.x,{value:e,onUpdate:t,children:[(0,c.jsxs)(eh.x.Option,{value:"Groups",children:[Qj.Groups,d?(0,c.jsxs)(n.Fragment,{children:["\xa0",d]}):null]}),(0,c.jsxs)(eh.x.Option,{value:"Granular",children:[Qj.Granular,"\xa0",u?(0,c.jsxs)(n.Fragment,{children:["\xa0",u]}):null]})]})})}const Bj=10;function $j({newSubjects:e,setNewSubjects:t}){const[a,s]=n.useState(!0),[r,i]=n.useState(""),o=n.useRef(null),l=n.useRef(null),d=(e=0)=>{l.current&&o.current&&(2*(l.current.offsetWidth+e)>=o.current.offsetWidth?s(!1):s(!0))},u=()=>{r&&(t((e=>[...e,r])),i(""),d(r.length*Bj))},p=e=>()=>{t((t=>t.filter((t=>t!==e)))),d(-1*e.length*Bj)},h=(t="nowrap")=>(0,c.jsx)(ke.s,{gap:1,className:kj("input-content"),wrap:t,ref:l,maxWidth:"100%",children:e.map((e=>(0,c.jsx)(zt.J,{type:"close",onCloseClick:p(e),children:e},e)))});return(0,c.jsx)(ke.s,{direction:"column",gap:2,children:(0,c.jsxs)(ke.s,{gap:2,alignItems:"start",children:[(0,c.jsx)("label",{htmlFor:"subjectInput",children:(0,c.jsx)(Re.E,{as:"div",whiteSpace:"nowrap",color:"secondary",className:kj("subject-input-label"),children:Rj("label_grant-access-to")})}),(0,c.jsxs)(ke.s,{direction:"column",gap:1,className:kj("subject-input-wrapper"),children:[(0,c.jsx)(Ha.k,{name:"subjectInput",className:kj("subject-input"),onBlur:u,onKeyDown:e=>{"Enter"===e.key&&u()},value:r,onUpdate:i,ref:o,startContent:a?h():void 0,autoFocus:!0}),!a&&h("wrap")]})]})})}function Hj({handleCloseDrawer:e}){const{aclSubject:t}=Ra(),[a,s]=n.useState([]),[r,o]=n.useState("Groups"),{path:l,database:d,databaseFullPath:u}=ba(),p=(0,j.XC)(),{currentRightsMap:h,setExplicitRightsChanges:m,rightsToGrant:g,rightsToRevoke:v,hasChanges:y}=function({aclSubject:e,path:t,database:a,databaseFullPath:s}){const r=(0,j.XC)(),i=(0,j.N4)((n=>Pa(n,null!==e&&void 0!==e?e:void 0,t,a,s,r))),[o,l]=n.useState((()=>new Map)),c=n.useMemo((()=>Array.from(o.entries()).reduce(((e,[t,a])=>(a&&!i.includes(t)&&e.push(t),e)),[])),[o,i]),d=n.useMemo((()=>Array.from(o.entries()).reduce(((e,[t,a])=>(!a&&i.includes(t)&&e.push(t),e)),[])),[o,i]),u=n.useMemo((()=>new Map(i.map((e=>[e,!0])))),[i]),p=n.useMemo((()=>{const e=new Map(u);return o.forEach(((t,a)=>{e.set(a,t)})),e}),[u,o]),h=n.useMemo((()=>Boolean(c.length||d.length)),[c,d]);return{currentRightsMap:p,setExplicitRightsChanges:l,rightsToGrant:c,rightsToRevoke:d,hasChanges:h}}({aclSubject:null!==t&&void 0!==t?t:void 0,path:l,database:d,databaseFullPath:u}),{isFetching:x}=Sa.useGetSchemaAclQuery({path:l,database:d,databaseFullPath:u,dialect:p},{skip:!t}),{isFetching:b}=Sa.useGetAvailablePermissionsQuery({database:d,databaseFullPath:u,dialect:p}),[f,T]=Sa.useUpdateAccessMutation(),[S,w]=n.useState(""),E=(0,j.N4)((e=>Ia(e,null!==t&&void 0!==t?t:void 0,l,d,u,p))),_=n.useCallback((()=>{m(new Map)}),[m]),N=n.useCallback((()=>{const n=t?[t]:a;n.length&&f({path:l,database:d,databaseFullPath:u,dialect:p,rights:{AddAccess:n.map((e=>({AccessRights:g,Subject:e,AccessType:"Allow"}))),RemoveAccess:n.map((e=>({AccessRights:v,Subject:e,AccessType:"Allow"})))}}).unwrap().then((()=>{e(),(0,$e.A)({name:"updateAcl",content:Rj("label_rights-updated"),autoHiding:1e3,isClosable:!1})})).catch((e=>{w((0,Va.$)(e))}))}),[f,l,d,p,g,t,v,a,e,u]),C=(0,j.N4)((e=>Da(e,d,u,p))),P=n.useCallback((e=>t=>{w(""),m((a=>new Map(a).set(e,t)))}),[m]),I=Boolean(t||a.length>0);return(0,c.jsx)(i.r,{loading:x||b,children:(0,c.jsxs)("div",{className:kj(),children:[(0,c.jsxs)(ke.s,{direction:"column",children:[(0,c.jsxs)(ke.s,{gap:4,direction:"column",className:kj("navigation"),children:[t?(0,c.jsx)(za,{subject:t}):(0,c.jsx)($j,{newSubjects:a,setNewSubjects:s}),I&&(0,c.jsx)(Gj,{value:r,onUpdate:o,rights:h,availablePermissions:C})]}),I&&(0,c.jsx)("div",{className:kj("rights-wrapper"),children:(0,c.jsx)(Lj,{inheritedRights:E,rights:h,availablePermissions:C,handleChangeRightGetter:P,view:r})})]}),I&&(0,c.jsx)(Fj,{onCancel:e,onDiscard:_,onSave:N,loading:T.isLoading,error:S,disabled:!y})]})})}function Vj({children:e}){const t=(0,I.nz)(),{showGrantAccess:a,handleShowGrantAccessChange:s,handleAclSubjectChange:r}=Ra(),i=n.useCallback((()=>{s(!1),r(void 0)}),[s,r]),o=n.useCallback((()=>(0,c.jsx)(Hj,{handleCloseDrawer:i})),[i]);return t?(0,c.jsx)(Sc,{isDrawerVisible:Boolean(a),onCloseDrawer:i,renderDrawerContent:o,drawerId:"tenant-healthcheck-details",storageKey:"tenant-grant-access-drawer-width",detectClickOutside:!0,hideVeil:!1,isPercentageWidth:!0,drawerControls:[{type:"close"}],title:(0,c.jsx)(Wj,{}),children:e}):e}function Wj(){return(0,c.jsxs)(ke.s,{direction:"column",children:[(0,c.jsx)(Re.E,{variant:"subheader-2",children:yt("label_grant-access")}),(0,c.jsx)(Re.E,{color:"secondary",children:yt("context_grant-access")})]})}function Jj({children:e}){return(0,c.jsx)(P.e,{children:(0,c.jsx)(Ij,{children:(0,c.jsx)(Vj,{children:e})})})}const Kj=(0,l.cn)("tenant-page"),Yj=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:Boolean(localStorage.getItem(f.jX))});function Zj({additionalTenantProps:e}){var t,o,l,d,u,p,g,w,E,_;const[N,C]=n.useReducer(fv(f.jX),void 0,Yj),{database:P,schema:I}=Ra(),{name:A,isLoading:D}=(0,x.Ry)(null!==P&&void 0!==P?P:"");if(!P)throw new Error("Tenant name is not defined");const R=n.useRef();n.useEffect((()=>{if(R.current!==P){(async()=>{const{registerYQLCompletionItemProvider:e}=await a.e(18620).then(a.bind(a,18620));e(P)})().catch(console.error),R.current=P}}),[P]);const k=null!==A&&void 0!==A?A:"",O=null!==I&&void 0!==I?I:k,{currentData:M,error:F,isLoading:L}=v.useGetOverviewQuery({path:O,database:P,databaseFullPath:k}),q=(0,j.YQ)();n.useEffect((()=>{q((0,m.g)("tenant",{databaseName:k,database:P}))}),[k,P,q]);const z=(0,j.N4)((e=>(0,y.Tp)(e,O,P,k))),U=null!==(t=null===M||void 0===M||null===(o=M.PathDescription)||void 0===o||null===(l=o.Self)||void 0===l?void 0:l.PathType)&&void 0!==t?t:null===z||void 0===z||null===(d=z.PathDescription)||void 0===d||null===(u=d.Self)||void 0===u?void 0:u.PathType,Q=null!==(p=null===M||void 0===M||null===(g=M.PathDescription)||void 0===g||null===(w=g.Self)||void 0===w?void 0:w.PathSubType)&&void 0!==p?p:null===z||void 0===z||null===(E=z.PathDescription)||void 0===E||null===(_=E.Self)||void 0===_?void 0:_.PathSubType,G=(0,T.Pq)(F),B=G?b.J.clusterOrDatabaseAccessError:void 0,[$,H]=n.useState(!0);!$||L||D||H(!1);const V=O||yt("page.title"),{appTitle:W}=(0,S.J)();return(0,c.jsxs)("div",{className:Kj(),children:[(0,c.jsx)(s.mg,{defaultTitle:`${V} \u2014 ${W}`,titleTemplate:`%s \u2014 ${V} \u2014 ${W}`}),(0,c.jsx)(i.r,{loading:$,children:(0,c.jsx)(r.A,{error:G?F:void 0,...B,children:(0,c.jsx)(xa,{database:P,path:O,type:U,subType:Q,databaseFullPath:k,children:(0,c.jsx)(Jj,{children:(0,c.jsxs)(h,{defaultSizePaneKey:f.jQ,defaultSizes:[25,75],triggerCollapse:N.triggerCollapse,triggerExpand:N.triggerExpand,minSize:[36,200],onSplitStartDragAdditional:()=>{C(yv.clear)},children:[(0,c.jsx)(Lf,{onCollapseSummary:()=>{C(yv.triggerCollapse)},onExpandSummary:()=>{C(yv.triggerExpand)},isCollapsed:N.collapsed}),(0,c.jsx)("div",{className:Kj("main"),children:(0,c.jsx)(af,{additionalTenantProps:e})})]})})})})})]})}},44839:(e,t,a)=>{"use strict";a.d(t,{K:()=>s,U:()=>n});const n="s-expression_unstable",s="yql_unstable"},52246:()=>{},52248:(e,t,a)=>{"use strict";a.d(t,{a:()=>n.a});var n=a(47334)},66574:()=>{},71635:(e,t,a)=>{"use strict";a.d(t,{C:()=>j});var n=a(59284),s=a(4980),r=a(13847),i=a(53850),o=a(62060),l=a.n(o),c=a(21334),d=a(24600);const u=c.F.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.viewer.getTabletsInfo(e,{signal:t})}}catch(a){return{error:a}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),p=(0,i.Mz)((e=>e),(e=>u.endpoints.getTabletsInfo.select(e)),{argsMemoize:i.i5,argsMemoizeOptions:{equalityCheck:l()}}),h=(0,i.Mz)((e=>e),((e,t)=>p(t)),((e,t)=>t(e).data)),m=(0,i.Mz)(((e,t)=>h(e,t)),((e,t)=>(0,d.K)(e,t.database)),((e,t)=>null!==e&&void 0!==e&&e.TabletStateInfo?t?e.TabletStateInfo.map((e=>{var a;const n=void 0===e.NodeId||null===(a=t.get(e.NodeId))||void 0===a?void 0:a.Host;return{...e,fqdn:n}})):e.TabletStateInfo:[]));var g=a(6354),v=a(7435),y=a(47779),x=a(88616),b=a(60712);const f=[g.r.Created,g.r.ResolveStateStorage,g.r.Candidate,g.r.BlockBlobStorage,g.r.RebuildGraph,g.r.WriteZeroEntry,g.r.Restored,g.r.Discover,g.r.Lock,g.r.Active,g.r.ResolveLeader,g.r.Terminating];function j({nodeId:e,path:t,database:a,databaseFullPath:i,onlyActive:o,scrollContainerRef:l}){const[c]=(0,y.Nt)();let d={};const p=o?`(State=[${f.join(",")}])`:void 0,h=n.useMemo((()=>{if(!(0,r.isNil)(t)&&!(0,r.isNil)(i))return{path:t,databaseFullPath:i}}),[t,i]);(0,v.f8)(e)?d={nodeId:e,database:a,filter:p}:h&&(d={path:h,database:a,filter:p});const{isLoading:g,error:j}=u.useGetTabletsInfoQuery(0===Object.keys(d).length?s.hT:d,{pollingInterval:c}),T=(0,y.N4)((e=>m(e,d)));return(0,b.jsx)(x.Q,{scrollContainerRef:l,tablets:T,loading:g,error:j,nodeId:e})}},78491:(e,t,a)=>{"use strict";a.d(t,{$:()=>i});var n=a(32752),s=a(20263),r=a(60712);function i({header:e,note:t}){return(0,r.jsxs)(n.s,{gap:1,alignItems:"center",children:[e,(0,r.jsx)(s.H,{popoverProps:{placement:["right","left"]},children:t})]})}},79737:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,X:()=>l});var n=a(59554),s=a(77506),r=a(60712);const i=(0,s.cn)("ydb-table");function o({children:e,className:t}){return(0,r.jsx)("div",{className:i("table-header-content",t),children:e})}function l({className:e,width:t,wrapperClassName:a,...s}){return(0,r.jsx)("div",{className:i(null,a),children:(0,r.jsx)(n.WE,{headerCellClassName:({column:e})=>{var t;const a=null===(t=e.columnDef.meta)||void 0===t?void 0:t.align;return i("table-header-cell",{align:a})},cellClassName:e=>{var t,a;const n=null===e||void 0===e||null===(t=e.column.columnDef.meta)||void 0===t?void 0:t.align,s=null===e||void 0===e||null===(a=e.column.columnDef.meta)||void 0===a?void 0:a.verticalAlign;return i("table-cell",{align:n,"vertical-align":s})},className:i("table",{width:t},e),...s})})}}}]);