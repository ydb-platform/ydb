"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[2740],{21711:(e,t,s)=>{s.d(t,{b:()=>c});var r=s(34706),n=s(5194),l=s(99294),a=s(83658),o=s(10161);const i=(0,l.cn)("ydb-info-viewer-skeleton"),d=()=>(0,o.jsxs)("div",{className:i("label"),children:[(0,o.jsx)(n.O,{className:i("label__text")}),(0,o.jsx)("div",{className:i("label__dots")})]}),c=e=>{let{rows:t=8,className:s,delay:l=600}=e;const[c]=(0,a.$)(l);let u=(0,o.jsxs)(r.Fragment,{children:[(0,o.jsx)(d,{}),(0,o.jsx)(n.O,{className:i("value")})]});return c||(u=null),(0,o.jsx)("div",{className:i(null,s),children:[...new Array(t)].map(((e,t)=>(0,o.jsx)("div",{className:i("row"),children:u},`skeleton-row-${t}`)))})}},43464:(e,t,s)=>{s.d(t,{O:()=>a});var r=s(5194),n=s(83658),l=s(10161);const a=e=>{let{delay:t=600,className:s}=e;const[a]=(0,n.$)(t);return a?(0,l.jsx)(r.O,{className:s}):null}},13618:(e,t,s)=>{s.d(t,{$:()=>i});s(34706);var r=s(79777),n=s(99294),l=s(10161);const a=(0,n.cn)("tag"),o=e=>{let{text:t,type:s}=e;return(0,l.jsx)("div",{className:a({type:s}),children:t})},i=e=>{let{tags:t,tagsType:s,className:n="",gap:a=1}=e;return(0,l.jsx)(r.k,{className:n,gap:a,wrap:"wrap",alignItems:"center",children:t&&t.map(((e,t)=>(0,l.jsx)(o,{text:e,type:s},t)))})}},62787:(e,t,s)=>{s.r(t),s.d(t,{Cluster:()=>Pt});var r=s(34706),n=s(5194),l=s(72555),a=s(42152),o=s(55783),i=s(99495),d=s(74003),c=s(62508),u=s(67653),v=s(46878),h=s(10730),m=s(85709),p=s(99294),x=s(55842),g=s(80819),j=s(26612),N=s(92025),f=s(72427),b=s(71624),y=s(72616),w=s(34973),C=s(15327),T=s(91538),k=s(31580),S=s(52154),P=s(74116),E=s(17784),O=s(74640),D=s(83797),L=s(2194),_=s(60064),z=s(65e3),M=s(61168),A=s(90808),V=s(37711);const I=JSON.parse('{"field_links":"Links","field_monitoring-link":"Monitoring","context_unknown":"unknown database"}'),G=(0,V.wZ)("ydb-tenant-name-wrapper",{en:I});var Z=s(10161);const $=(e,t)=>{var s,r;if("function"!==typeof(null===t||void 0===t?void 0:t.prepareTenantBackend))return;let n=null!==(s=e.MonitoringEndpoint)&&void 0!==s?s:e.backend;const l=null!==(r=e.NodeIds)&&void 0!==r?r:e.sharedNodeIds;if(!n&&l&&l.length>0){n={NodeId:l[Math.floor(Math.random()*l.length)]}}return t.prepareTenantBackend(n)};function F(e){var t;let{tenant:s,additionalTenantsProps:r}=e;const n=(0,x.ix)(z.VH),l=$(s,r),a=Boolean(l),o=null===r||void 0===r||null===(t=r.getMonitoringLink)||void 0===t?void 0:t.call(r,s.Name,s.Type);return(0,Z.jsx)(M.l,{disabled:!n||!o,content:o?(0,Z.jsx)(D.w,{responsive:!0,children:(0,Z.jsx)(D.w.Item,{name:G("field_links"),children:(0,Z.jsx)(A.j,{title:G("field_monitoring-link"),url:o})})}):null,placement:["top","bottom"],behavior:L.x.Immediate,children:(0,Z.jsx)(c.A,{externalLink:a,name:s.Name||G("context_unknown"),withLeftTrim:!0,status:s.Overall,hasClipboardButton:!0,path:(0,_.Sj)({name:s.Name,backend:l})})})}var R=s(78276),B=s(32341),W=s(67386),H=s(78171),U=s.n(H),q=s(77468),Q=s(27810),Y=s(14739);const J=(0,W.P1)((e=>e),(e=>Y.Xv.endpoints.getTenantsInfo.select({clusterName:e}))),K=(0,W.P1)((e=>e),((e,t)=>J(t)),(e=>(0,B.Cx)(e,Q.Zy)),((e,t,s)=>{var r;const n=null!==(r=t(e).data)&&void 0!==r?r:[];return!s&&n.length>1?n.filter((e=>"Domain"!==e.Type)):n})),X=e=>e.tenants.searchValue,ee=(0,W.P1)([K,B.qz,X],((e,t,s)=>{let r=((e,t)=>t===B.pu.ALL?e:e.filter((e=>e.Overall&&e.Overall!==q.K.Green)))(e,t);return r=((e,t)=>e.filter((e=>{const s=new RegExp(U()(t),"i");return s.test(e.Name||"")||s.test(e.controlPlaneName)})))(r,s),r}));var te=s(14075);const se=(0,p.cn)("tenants"),re=e=>{let{additionalTenantsProps:t}=e;const s=(0,x.zL)(),[n]=(0,x.Rj)(),{currentData:l,isFetching:a,error:o}=Y.Xv.useGetTenantsInfoQuery({clusterName:R.qw},{pollingInterval:n}),i=a&&void 0===l,d=(0,x.ix)((e=>K(e,R.qw))),c=(0,x.ix)(X),u=(0,x.ix)((e=>ee(e,R.qw))),v=(0,x.ix)(B.qz),h=e=>{s((0,B.M6)(e))},m=e=>{s((0,Y.gI)(e))};return(0,Z.jsxs)(O.l,{children:[(0,Z.jsx)(O.l.Controls,{children:(0,Z.jsxs)(r.Fragment,{children:[(0,Z.jsx)(E.o,{value:c,onChange:m,placeholder:"Database name",className:se("search")}),(0,Z.jsx)(S.T,{value:v,onChange:h}),(0,Z.jsx)(w.C,{total:d.length,current:(null===u||void 0===u?void 0:u.length)||0,label:"Databases",loading:i})]})}),o?(0,Z.jsx)(C.V,{error:o}):null,(0,Z.jsx)(O.l.Table,{loading:i,children:l?(()=>{const e=[{name:"Name",header:"Database",render:e=>{let{row:s}=e;return(0,Z.jsx)(F,{tenant:s,additionalTenantsProps:t})},width:440,sortable:!0,defaultOrder:b.ZP.DESCENDING},{name:"controlPlaneName",header:"Name",render:e=>{let{row:t}=e;return t.controlPlaneName},width:200,sortable:!0,defaultOrder:b.ZP.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:e=>{let{row:t}=e;return"Serverless"!==t.Type?t.Type:(0,Z.jsxs)("div",{className:se("type"),children:[(0,Z.jsx)("span",{className:se("type-value"),children:t.Type}),(0,Z.jsx)(y.z,{className:se("type-button"),onClick:()=>m(t.sharedTenantName||""),children:"Show shared"})]})}},{name:"State",width:90,render:e=>{let{row:t}=e;return t.State?t.State.toLowerCase():"\u2014"},customStyle:()=>({textTransform:"capitalize"})},{name:"cpu",header:"CPU",width:80,render:e=>{let{row:t}=e;return t.cpu&&t.cpu>1e4?(0,te.LO)(t.cpu):"\u2014"},align:b.ZP.RIGHT,defaultOrder:b.ZP.DESCENDING},{name:"memory",header:"Memory",width:120,render:e=>{let{row:t}=e;return t.memory?(0,te.q3)(t.memory):"\u2014"},align:b.ZP.RIGHT,defaultOrder:b.ZP.DESCENDING},{name:"storage",header:"Storage",width:120,render:e=>{let{row:t}=e;return t.storage?(0,te.q3)(t.storage):"\u2014"},align:b.ZP.RIGHT,defaultOrder:b.ZP.DESCENDING},{name:"nodesCount",header:"Nodes",width:100,render:e=>{let{row:t}=e;return t.nodesCount?(0,te.uf)(t.nodesCount):"\u2014"},align:b.ZP.RIGHT,defaultOrder:b.ZP.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:e=>{let{row:t}=e;return t.groupsCount?(0,te.uf)(t.groupsCount):"\u2014"},align:b.ZP.RIGHT,defaultOrder:b.ZP.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:e=>{let{PoolStats:t=[]}=e;return t.reduce(((e,t)=>e+(t.Usage||0)),0)},defaultOrder:b.ZP.DESCENDING,align:b.ZP.LEFT,render:e=>{let{row:t}=e;return(0,Z.jsx)(k.m,{pools:t.PoolStats})}}];return 0===u.length&&v!==B.pu.ALL?(0,Z.jsx)(T.Q,{name:"thumbsUp",width:"200"}):(0,Z.jsx)(P.G,{columnsWidthLSKey:"databasesTableColumnsWidth",data:u,columns:e,settings:Q.LE,emptyDataMessage:"No such tenants"})})():null})]})};var ne=s(67661),le=s(19912),ae=s(66498),oe=s(88366),ie=s(30963);const de=(0,p.cn)("ydb-cluster-versions-bar"),ce=e=>{let{versionsValues:t=[],size:s="s",progressClassName:r}=e;return(0,Z.jsxs)("div",{className:de(),children:[(0,Z.jsx)(ie.E,{value:100,stack:t,size:s,className:r}),(0,Z.jsx)("div",{className:de("versions"),children:t.map(((e,s)=>(0,Z.jsx)("div",{className:de("version-title"),style:{color:e.color},title:e.version,children:`${e.version}${s===t.length-1?"":","}`},e.version)))})]})};var ue=s(83202),ve=s(20760),he=s(96183),me=s(75544);const pe=[{name:"NodeId",header:"#",width:80,resizeMinWidth:80,align:b.ZP.LEFT,render:e=>{let{row:t}=e;return t.NodeId}},{name:"Host",render:e=>{var t;let{row:s}=e;const r=s.Endpoints&&(null===(t=s.Endpoints.find((e=>"http-mon"===e.Name)))||void 0===t?void 0:t.Address),n=s.Host&&`${s.Host}${r||""}`||"unknown",l=!(0,he.TA)(s)&&s.NodeId?(0,me.a3)(s.NodeId):void 0;return(0,Z.jsx)(c.A,{name:n,path:l,hasClipboardButton:!0,showStatus:!1})},width:400,align:b.ZP.LEFT},{name:"Endpoints",sortable:!1,render:e=>{let{row:t}=e;return t.Endpoints?t.Endpoints.map((e=>{let{Name:t,Address:s}=e;return`${t} ${s}`})).join(", "):"-"},width:300,align:b.ZP.LEFT},{name:"Uptime",header:"Uptime",sortAccessor:e=>{let{StartTime:t}=e;return t&&-t},width:120,align:b.ZP.LEFT,render:e=>{let{row:t}=e;return t.Uptime}},{name:"MemoryUsed",header:"Memory used",sortAccessor:e=>{let{MemoryUsed:t=0}=e;return Number(t)},defaultOrder:b.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.MemoryUsed?(0,te.td)(t.MemoryUsed):"\u2014"},width:120,align:b.ZP.RIGHT},{name:"MemoryLimit",header:"Memory limit",sortAccessor:e=>{let{MemoryLimit:t=0}=e;return Number(t)},defaultOrder:b.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.MemoryLimit?(0,te.td)(t.MemoryLimit):"\u2014"},width:120,align:b.ZP.RIGHT},{name:"PoolStats",header:"Pools",sortAccessor:e=>{let{PoolStats:t=[]}=e;return t.reduce(((e,t)=>e+(t.Usage||0)),0)},defaultOrder:b.ZP.DESCENDING,width:80,resizeMinWidth:60,render:e=>{let{row:t}=e;return t.PoolStats?(0,Z.jsx)(k.m,{pools:t.PoolStats}):"\u2014"},align:b.ZP.LEFT},{name:"LoadAverage",header:"Load average",sortAccessor:e=>{let{LoadAveragePercents:t=[]}=e;return t[0]},defaultOrder:b.ZP.DESCENDING,width:170,resizeMinWidth:170,render:e=>{let{row:t}=e;return t.LoadAveragePercents&&t.LoadAveragePercents.length>0?(0,Z.jsx)(ve.y,{value:t.LoadAveragePercents[0],percents:!0,capacity:100,colorizeProgress:!0}):"\u2014"},align:b.ZP.LEFT}],xe=e=>{let{nodes:t}=e;return(0,Z.jsx)(P.G,{columnsWidthLSKey:"versionsTableColumnsWidth",data:t,columns:pe,settings:Q.LE})};var ge=s(99175);const je=(0,p.cn)("ydb-versions-nodes-tree-title"),Ne=e=>{let t,{title:s,nodes:r,items:n,versionColor:l,versionsValues:a}=e;return t=n?n.reduce(((e,t)=>t.nodes?e+t.nodes.length:e),0):r?r.length:0,(0,Z.jsxs)("div",{className:je("overview"),children:[(0,Z.jsxs)("div",{className:je("overview-container"),children:[l?(0,Z.jsx)("div",{className:je("version-color"),style:{background:l}}):null,s?(0,Z.jsxs)("span",{className:je("overview-title"),children:[s,(0,Z.jsx)(ge.m,{text:s,size:"s",className:je("clipboard-button"),view:"normal"})]}):null]}),(0,Z.jsxs)("div",{className:je("overview-info"),children:[(0,Z.jsxs)("div",{children:[(0,Z.jsx)("span",{className:je("info-value"),children:t}),(0,Z.jsx)("span",{className:je("info-label",{margin:"left"}),children:"Nodes"})]}),a?(0,Z.jsxs)("div",{className:je("version-progress"),children:[(0,Z.jsx)("span",{className:je("info-label",{margin:"right"}),children:"Versions"}),(0,Z.jsx)(ie.E,{size:"s",value:100,stack:a})]}):null]})]})},fe=(0,p.cn)("ydb-versions-grouped-node-tree"),be=e=>{let{title:t,nodes:s,items:n,expanded:l=!1,versionColor:a,versionsValues:o,level:i=0}=e;const[d,c]=r.useState(!1);r.useEffect((()=>{c(l)}),[l]);const u=(0,Z.jsx)(Ne,{title:t,nodes:s,items:n,versionColor:a,versionsValues:o}),v=()=>{c((e=>!e))};return n?(0,Z.jsx)("div",{className:fe({"first-level":0===i}),children:(0,Z.jsx)(ue.L,{name:u,collapsed:!d,hasArrow:!0,onClick:v,onArrowClick:v,children:n.map(((e,t)=>(0,Z.jsx)(be,{title:e.title,nodes:e.nodes,expanded:l,versionColor:e.versionColor,level:i+1},t)))},t)}):(0,Z.jsx)("div",{className:fe({"first-level":0===i}),children:(0,Z.jsx)(ue.L,{name:u,collapsed:!d,hasArrow:!0,onClick:v,onArrowClick:v,children:(0,Z.jsx)("div",{className:fe("dt-wrapper"),children:(0,Z.jsx)(xe,{nodes:s||[]})})},t)})};var ye=s(69144),we=s.n(ye),Ce=s(58274);const Te=.5,ke=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const s=e.reduce(((e,t)=>(t.Version&&(e[t.Version]?e[t.Version]=e[t.Version]+1:e[t.Version]=1),e)),{});return Pe(Object.keys(s).map((r=>{const n=s[r]/e.length*100;return{title:r,version:r,color:null===t||void 0===t?void 0:t.get((0,Ce.H)(r)),value:n<Te?Te:n}})))};function Se(e,t,s){const r=null!==s&&void 0!==s?s:e.reduce(((e,t)=>e+t.count),0);return Pe(e.map((e=>{const s=e.count/r*100;return{title:e.name,version:e.name,color:null===t||void 0===t?void 0:t.get(e.name),value:s<Te?Te:s}})))}function Pe(e){let t=e[0].value,s=0,r=0;e.forEach(((e,n)=>{r+=e.value,e.value>t&&(t=e.value,s=n)}));const n=[...e];return n[s]={...e[s],value:t+100-r},n}let Ee;!function(e){e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage"}(Ee||(Ee={}));const Oe=(e,t)=>{var s;return(null===(s=e.title)||void 0===s?void 0:s.localeCompare(t.title||""))||-1},De=JSON.parse('{"title_overall":"Overall","title_storage":"Storage nodes","title_database":"Database nodes","title_other":"Other nodes"}'),Le=(0,V.wZ)("ydb-versions",{en:De});var _e=s(64485),ze=s(39242);const Me=(0,p.cn)("ydb-versions"),Ae=e=>{let{versionToColor:t,cluster:s}=e;const[n]=(0,x.Rj)(),l=((e,t)=>{const{currentData:s}=oe.k.useGetNodesQuery((0,ze.j)(e)?_e.CN:{tablets:!1,fieldsRequired:["SystemState"],group:"Version"});return r.useMemo((()=>(0,ze.j)(e)&&e.MapVersions?Se(Object.entries(e.MapVersions).map((e=>{let[t,s]=e;return{name:t,count:s}})),t,e.NodesTotal):s?Array.isArray(s.NodeGroups)?Se(s.NodeGroups,t,null===e||void 0===e?void 0:e.NodesTotal):ke(s.Nodes,t):[]),[s,t,e])})(s,t),{currentData:a,isLoading:o}=oe.k.useGetNodesQuery({tablets:!1,fieldsRequired:["SystemState"]},{pollingInterval:n}),i=null===a||void 0===a?void 0:a.Nodes,[d,c]=r.useState(Ee.VERSION),[u,v]=r.useState(!1),h=e=>{c(e)};if(o)return(0,Z.jsx)(ae.a,{});const m=((e,t,s)=>{if(e&&e.length){if(s===Ee.VERSION){const s=we()(e,"Version");return Object.keys(s).map((e=>{const r=s[e].filter((e=>{let{Tenants:t}=e;return Boolean(t)})),n=we()(r,"Tenants"),l=Object.keys(n).map((e=>({title:e,nodes:n[e]}))).sort(Oe);return l.length?{title:e,items:l,versionColor:null===t||void 0===t?void 0:t.get((0,Ce.H)(e))}:null})).filter((e=>Boolean(e)))}{const s=e.filter((e=>{let{Tenants:t}=e;return Boolean(t)})),r=we()(s,"Tenants");return Object.keys(r).map((e=>{const s=ke(r[e],t),n=we()(r[e],"Version"),l=Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:null===t||void 0===t?void 0:t.get((0,Ce.H)(e))})));return l.length?{title:e,items:l,versionsValues:s}:null})).filter((e=>Boolean(e))).sort(Oe)}}})(i,t,d),p=((e,t)=>{if(!e||!e.length)return;const s=e.filter((e=>{let{Roles:t}=e;return null===t||void 0===t?void 0:t.includes("Storage")})),r=we()(s,"Version");return Object.keys(r).map((e=>({title:e,nodes:r[e],versionColor:null===t||void 0===t?void 0:t.get((0,Ce.H)(e))})))})(i,t),g=((e,t)=>{if(!e||!e.length)return;const s=e.filter((e=>{let{Roles:t}=e;return!t})),r=we()(s,"Version");return Object.keys(r).map((e=>({title:e,nodes:r[e],versionColor:null===t||void 0===t?void 0:t.get((0,Ce.H)(e))})))})(i,t),j=null!==p&&void 0!==p&&p.length?(0,Z.jsxs)(r.Fragment,{children:[(0,Z.jsx)("h4",{children:Le("title_storage")}),p.map((e=>{let{title:t,nodes:s,items:r,versionColor:n}=e;return(0,Z.jsx)(be,{title:t,nodes:s,items:r,versionColor:n},`storage-nodes-${t}`)}))]}):null,N=null!==m&&void 0!==m&&m.length?(0,Z.jsxs)(r.Fragment,{children:[(0,Z.jsx)("h4",{children:Le("title_database")}),(0,Z.jsxs)("div",{className:Me("controls"),children:[(0,Z.jsxs)("div",{className:Me("group"),children:[(0,Z.jsx)("span",{className:Me("label"),children:"Group by:"}),(0,Z.jsxs)(ne.E,{value:d,onUpdate:h,children:[(0,Z.jsx)(ne.E.Option,{value:Ee.TENANT,children:Ee.TENANT}),(0,Z.jsx)(ne.E.Option,{value:Ee.VERSION,children:Ee.VERSION})]})]}),(0,Z.jsx)(le.X,{className:Me("checkbox"),onChange:()=>v((e=>!e)),checked:u,children:"All expanded"})]}),m.map((e=>{let{title:t,nodes:s,items:r,versionColor:n,versionsValues:l}=e;return(0,Z.jsx)(be,{title:t,nodes:s,items:r,expanded:u,versionColor:n,versionsValues:l},`tenant-nodes-${t}`)}))]}):null,f=null!==g&&void 0!==g&&g.length?(0,Z.jsxs)(r.Fragment,{children:[(0,Z.jsx)("h4",{children:Le("title_other")}),g.map((e=>{let{title:t,nodes:s,items:r,versionColor:n,versionsValues:l}=e;return(0,Z.jsx)(be,{title:t,nodes:s,items:r,versionColor:n,versionsValues:l},`other-nodes-${t}`)}))]}):null,b=(0,Z.jsxs)(r.Fragment,{children:[(0,Z.jsx)("h4",{children:Le("title_overall")}),(0,Z.jsx)("div",{className:Me("overall-wrapper"),children:(0,Z.jsx)(ce,{progressClassName:Me("overall-progress"),versionsValues:l.filter((e=>"unknown"!==e.title)),size:"m"})})]});return(0,Z.jsxs)("div",{className:Me(),children:[b,j,N,f]})};var Ve=s(23795),Ie=s(79777),Ge=s(13618),Ze=s(25665);const $e=JSON.parse('{"disk-type":"Disk Type","erasure":"Erasure","allocated":"Allocated","available":"Available","usage":"Usage","label_nodes-state":"Nodes state","label_dc":"Nodes data centers","storage-size":"Storage size","storage-groups":"Storage groups, {{diskType}}","links":"Links","context_cores":"cores","title_cpu":"CPU","title_storage":"Storage","title_memory":"Memory","label_nodes":"Nodes","label_hosts":"Hosts","label_storage-groups":"Storage groups","label_databases":"Databases","label_load":"Load"}'),Fe=(0,V.wZ)("ydb-cluster",{en:$e});var Re=s(29331);const Be=(0,p.cn)("ydb-doughnut-metrics");function We(e){let{status:t,fillWidth:s,children:r,className:n}=e,l="var(--g-color-line-generic-solid)",a=3.6*s-90;s>50&&(l="var(--doughnut-color)",a=3.6*s+90);const o=a;return(0,Z.jsx)("div",{className:Be(null,n),children:(0,Z.jsx)("div",{style:{backgroundImage:`linear-gradient(${o}deg, transparent 50%, ${l} 50%), linear-gradient(-90deg, var(--g-color-line-generic-solid) 50%, transparent 50%)`},className:Be("doughnut",{status:t}),children:(0,Z.jsx)("div",{className:Be("text-wrapper"),children:r})})})}We.Legend=function(e){let{children:t,variant:s="subheader-3"}=e;return(0,Z.jsx)(Ve.x,{variant:s,color:"secondary",className:Be("legend"),children:t})},We.Value=function(e){let{children:t,variant:s="subheader-2"}=e;return(0,Z.jsx)(Ve.x,{variant:s,color:"secondary",className:Be("value"),children:t})};var He=s(43464);const Ue=(0,p.cn)("ydb-cluster-dashboard");function qe(e){let{children:t,title:s,size:r,className:n}=e;return(0,Z.jsxs)(Re.Q,{className:Ue("card",{size:r},n),size:r,interactive:!1,children:[s?(0,Z.jsx)(Ve.x,{variant:"subheader-3",className:Ue("card-title"),children:s}):null,t]})}function Qe(e){let{title:t,children:s,size:r,...n}=e;return(0,Z.jsx)(qe,{title:t,size:r,children:(0,Z.jsx)(We,{...n,className:Ue("doughnut"),children:s})})}function Ye(){return(0,Z.jsx)(qe,{className:Ue("skeleton-wrapper"),children:(0,Z.jsx)(He.O,{className:Ue("skeleton")})})}function Je(){return(0,Z.jsxs)(r.Fragment,{children:[(0,Z.jsx)(Ye,{}),(0,Z.jsx)(Ye,{}),(0,Z.jsx)(Ye,{})]})}var Ke=s(95440),Xe=s(20134),et=s(43926),tt=s(10142);const st=(0,p.cn)("ydb-disk-groups-stats"),rt=e=>{let{stats:t,children:s}=e;return(0,Z.jsx)("div",{className:st(),children:(0,Z.jsx)(et.f,{placement:["right"],pinOnClick:!0,content:(0,Z.jsx)(nt,{stats:t}),children:s})})};function nt(e){let{stats:t}=e;const{diskType:s,erasure:r,allocatedSize:n,availableSize:l}=t,a=(0,tt.dT)(Math.max(n,l),2),o=(0,tt.td)({value:n,size:a}),i=(0,tt.td)({value:l,size:a}),d=Math.round(n/(n+l)*100),c=[{name:Fe("disk-type"),content:s},{name:Fe("erasure"),content:r},{name:Fe("allocated"),content:o},{name:Fe("available"),content:i},{name:Fe("usage"),content:d+"%"}];return(0,Z.jsx)(Xe.w,{items:c,className:st("popup-content"),responsive:!0})}function lt(e){let{value:t,capacity:s,colorizeProgress:r=!0,warningThreshold:n=60,dangerThreshold:l=80,inverseColorize:a=!1,legendFormatter:o}=e;const i=parseFloat(String(t)),d=parseFloat(String(s));let c=i/d*100||0;c=c>100?100:c;const u=c<1?.5:c;return{status:(0,Ke.S)({fillWidth:c,warningThreshold:n,dangerThreshold:l,colorizeProgress:r,inverseColorize:a}),percents:(0,te.T3)(c/100),legend:o({value:i,capacity:d}),fill:u}}const at=["storage","tenant"];const ot=e=>Object.values(e).reduce(((e,t)=>(Object.values(t).forEach((t=>{e+=t.createdGroups})),e)),0);function it(e){let{value:t,capacity:s}=e;return`${(0,te.LA)(t)} / ${(0,te.LA)(s)}\n${Fe("context_cores")}`}function dt(e){let{value:t,capacity:s,...r}=e;const{status:n,percents:l,legend:a,fill:o}=lt({value:t,capacity:s,legendFormatter:it,...r});return(0,Z.jsxs)(Qe,{status:n,fillWidth:o,title:Fe("title_cpu"),children:[(0,Z.jsx)(We.Legend,{children:a}),(0,Z.jsx)(We.Value,{children:l})]})}function ct(e){let{value:t,capacity:s}=e;const r=(0,te.QO)(t,s,void 0,"\n");return`${r[0]} / ${r[1]}`}function ut(e){let{value:t,capacity:s,...r}=e;const{status:n,percents:l,legend:a,fill:o}=lt({value:t,capacity:s,legendFormatter:ct,...r});return(0,Z.jsxs)(Qe,{status:n,fillWidth:o,title:Fe("title_memory"),children:[(0,Z.jsx)(We.Legend,{children:a}),(0,Z.jsx)(We.Value,{children:l})]})}function vt(e){let{value:t,capacity:s}=e;const r=(0,te.QO)(t,s,void 0,"\n");return`${r[0]} / ${r[1]}`}function ht(e){let{value:t,capacity:s,...r}=e;const{status:n,percents:l,legend:a,fill:o}=lt({value:t,capacity:s,legendFormatter:vt,...r});return(0,Z.jsxs)(Qe,{status:n,fillWidth:o,title:Fe("title_storage"),children:[(0,Z.jsx)(We.Legend,{children:a}),(0,Z.jsx)(We.Value,{children:l})]})}function mt(e){let{value:t}=e;return(0,Ze.D)(t)?(0,Z.jsx)(Ve.x,{variant:"subheader-3",color:"secondary",children:(0,te.uf)(t)}):null}function pt(e){return e.error?(0,Z.jsx)(C.V,{error:e.error,className:Ue("error")}):(0,Z.jsx)("div",{className:Ue(),children:(0,Z.jsxs)(Ie.k,{gap:4,wrap:!0,children:[(0,Z.jsx)(Ie.k,{gap:4,wrap:"nowrap",children:(0,Z.jsx)(xt,{...e})}),(0,Z.jsx)("div",{className:Ue("cards-container"),children:(0,Z.jsx)(gt,{...e})})]})})}function xt(e){let{cluster:t,loading:s}=e;if(s)return(0,Z.jsx)(Je,{});const r=[];if((0,ze.j)(t)){const{CoresUsed:e,NumberOfCpus:s}=t;(0,Ze.D)(e)&&(0,Ze.D)(s)&&r.push((0,Z.jsx)(dt,{value:e,capacity:s},"cores"))}const{StorageTotal:n,StorageUsed:l}=t;(0,Ze.D)(n)&&(0,Ze.D)(l)&&r.push((0,Z.jsx)(ht,{value:l,capacity:n},"storage"));const{MemoryTotal:a,MemoryUsed:o}=t;return(0,Ze.D)(a)&&(0,Ze.D)(o)&&r.push((0,Z.jsx)(ut,{value:o,capacity:a},"memory")),r}function gt(e){let{cluster:t,groupStats:s={},loading:n}=e;if(n)return null;const l=[],a=function(e){const t=[];if((0,ze.j)(e)&&e.MapNodeRoles)for(const[s,n]of Object.entries(e.MapNodeRoles))at.includes(s.toLowerCase())&&t.push((0,Z.jsxs)(r.Fragment,{children:[s,": ",(0,te.uf)(n)]},s));return t}(t);if(l.push((0,Z.jsx)(qe,{size:"l",title:Fe("label_nodes"),children:(0,Z.jsxs)(Ie.k,{gap:2,direction:"column",children:[(0,Z.jsx)(mt,{value:null===t||void 0===t?void 0:t.NodesAlive}),null!==a&&void 0!==a&&a.length?(0,Z.jsx)(Ge.$,{tags:a,gap:3}):null]})},"roles")),Object.keys(s).length){const e=function(e){const t=[];return Object.entries(e).forEach((e=>{let[s,r]=e;Object.values(r).forEach((e=>{t.push((0,Z.jsxs)(rt,{stats:e,children:[s,": ",(0,te.uf)(e.createdGroups)," /"," ",(0,te.uf)(e.totalGroups)]},`${s}|${e.erasure}`))}))})),t}(s),t=ot(s);l.push((0,Z.jsx)(qe,{size:"l",title:Fe("label_storage-groups"),children:(0,Z.jsxs)(Ie.k,{gap:2,direction:"column",children:[(0,Z.jsx)(mt,{value:t}),(0,Z.jsx)(Ge.$,{tags:e,gap:3})]})},"groups"))}const o=function(e){var t;return(0,ze.j)(e)&&e.MapDataCenters?Object.keys(e.MapDataCenters):null===(t=e.DataCenters)||void 0===t?void 0:t.filter(Boolean)}(t);return null!==o&&void 0!==o&&o.length&&l.push((0,Z.jsx)(qe,{size:"l",title:Fe("label_hosts"),children:(0,Z.jsxs)(Ie.k,{gap:2,direction:"column",children:[(0,Z.jsx)(mt,{value:null===t||void 0===t?void 0:t.Hosts}),(0,Z.jsx)(Ge.$,{tags:o,gap:3})]})},"hosts")),t.Tenants&&l.push((0,Z.jsx)(qe,{size:"l",title:Fe("label_databases"),children:(0,Z.jsx)(mt,{value:null===t||void 0===t?void 0:t.Tenants})},"tenants")),l}var jt=s(43862),Nt=s(21711);const ft=(0,p.cn)("cluster-info");s(9038);const bt=(0,p.cn)("ydb-nodes-state");function yt(e){let{state:t,children:s}=e;return(0,Z.jsx)("div",{className:bt({[t.toLowerCase()]:!0}),children:s})}const wt={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},Ct=(e,t,s)=>{const n=[];if((0,ze.j)(e)&&e.MapNodeStates){const t=Object.entries(e.MapNodeStates);t.sort(((e,t)=>wt[t[0]]-wt[e[0]]));const s=t.map((e=>{let[t,s]=e;return(0,Z.jsx)(yt,{state:t,children:s},t)}));n.push({label:Fe("label_nodes-state"),value:(0,Z.jsx)(Ie.k,{gap:2,children:s})})}const l=(e=>{if((0,ze.j)(e)&&e.MapDataCenters)return Object.entries(e.MapDataCenters).map((e=>{let[t,s]=e;return(0,Z.jsxs)(r.Fragment,{children:[t,": ",(0,te.uf)(s)]},t)}))})(e);return null!==l&&void 0!==l&&l.length&&n.push({label:Fe("label_dc"),value:(0,Z.jsx)(Ge.$,{tags:l,gap:2})}),n.push({label:Fe("label_load"),value:(0,Z.jsx)(ve.y,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null===e||void 0===e?void 0:e.NumberOfCpus})}),n.push(...t),s.length&&n.push({label:Fe("links"),value:(0,Z.jsx)("div",{className:ft("links"),children:s.map((e=>{let{title:t,url:s}=e;return(0,Z.jsx)(A.j,{title:t,url:s},t)}))})}),n},Tt=e=>{let{cluster:t,loading:s,error:r,additionalClusterProps:n={}}=e;const{info:l=[],links:a=[]}=n,o=Ct(null!==t&&void 0!==t?t:{},l,a);return(0,Z.jsxs)("div",{className:ft(),children:[r?(0,Z.jsx)(C.V,{error:r,className:ft("error")}):null,(0,Z.jsx)("div",{className:ft("info"),children:s?(0,Z.jsx)(Nt.b,{className:ft("skeleton"),rows:9}):r&&!t?null:(0,Z.jsx)(jt._,{dots:!0,info:o})})]})};var kt=s(4128);const St=(0,p.cn)("ydb-cluster");function Pt(e){let{additionalClusterProps:t,additionalTenantsProps:s,additionalNodesProps:p,additionalVersionsProps:b}=e;const y=r.useRef(null),w=(0,x.zL)(),C=function(){const e=(0,x.zL)(),t=(0,x.ix)((e=>e.cluster.defaultClusterTab)),s=(0,o.$B)(v.ZP.cluster),{activeTab:n}=(null===s||void 0===s?void 0:s.params)||{};let l;l=(0,kt.V2)(n)?n:t;return r.useEffect((()=>{l!==t&&e((0,h.LQ)(l))}),[l,t,e]),l}(),[{clusterName:T,backend:k}]=(0,i.useQueryParams)({clusterName:i.StringParam,backend:i.StringParam}),S=(0,x.ix)((e=>(0,h.le)(e,null!==T&&void 0!==T?T:void 0))),{data:{clusterData:P={},groupsStats:E}={},isLoading:O,error:D}=h.UM.useGetClusterInfoQuery(null!==T&&void 0!==T?T:void 0),L=D&&"object"===typeof D?D:void 0,_=(0,x.ix)((e=>(0,h.DS)(e,null!==T&&void 0!==T?T:void 0)));r.useEffect((()=>{w((0,m.J)("cluster",{}))}),[w]);const z=r.useMemo((()=>null!==b&&void 0!==b&&b.getVersionToColorMap?null===b||void 0===b?void 0:b.getVersionToColorMap():(0,g.ZP)(null===P||void 0===P?void 0:P.Versions)),[b,P]),M=r.useMemo((()=>kt._Y.find((e=>{let{id:t}=e;return t===C}))),[C]);return(0,Z.jsxs)("div",{className:St(),ref:y,children:[(0,Z.jsx)(a.ql,{defaultTitle:`${S} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${S} \u2014 YDB Monitoring`,children:M?(0,Z.jsx)("title",{children:M.title}):null}),(0,Z.jsx)("div",{className:St("header"),children:O?(0,Z.jsx)(n.O,{className:St("title-skeleton")}):(0,Z.jsx)(c.A,{size:"m",status:null===P||void 0===P?void 0:P.Overall,name:S,className:St("title")})}),(0,Z.jsx)("div",{className:St("sticky-wrapper"),children:(0,Z.jsx)(d.q,{className:St("auto-refresh-control")})}),(0,Z.jsx)(pt,{cluster:P,groupStats:E,loading:O,error:L||(null===P||void 0===P?void 0:P.error)}),(0,Z.jsx)("div",{className:St("tabs-sticky-wrapper"),children:(0,Z.jsx)(l.m,{size:"l",allowNotSelected:!0,activeTab:C,items:kt._Y,wrapTo:(e,t)=>{let{id:s}=e;const r=(0,kt.B7)(s,{clusterName:T,backend:k});return(0,Z.jsx)(u.h,{to:r,onClick:()=>{w((0,h.LQ)(s))},children:t},s)}})}),(0,Z.jsxs)(o.rs,{children:[(0,Z.jsx)(o.AW,{path:(0,v.Fz)((0,kt.B7)(kt.xu.overview)).pathname,children:(0,Z.jsx)(Tt,{cluster:P,versionToColor:z,loading:O,error:L,additionalClusterProps:t})}),(0,Z.jsx)(o.AW,{path:(0,v.Fz)((0,kt.B7)(kt.xu.tablets)).pathname,children:(0,Z.jsx)("div",{className:St("tablets"),children:(0,Z.jsx)(f.O,{loading:O,tablets:_,className:St("tablets-table")})})}),(0,Z.jsx)(o.AW,{path:(0,v.Fz)((0,kt.B7)(kt.xu.tenants)).pathname,children:(0,Z.jsx)(re,{additionalTenantsProps:s})}),(0,Z.jsx)(o.AW,{path:(0,v.Fz)((0,kt.B7)(kt.xu.nodes)).pathname,children:(0,Z.jsx)(j.G,{parentRef:y,additionalNodesProps:p})}),(0,Z.jsx)(o.AW,{path:(0,v.Fz)((0,kt.B7)(kt.xu.storage)).pathname,children:(0,Z.jsx)(N.V,{parentRef:y})}),(0,Z.jsx)(o.AW,{path:(0,v.Fz)((0,kt.B7)(kt.xu.versions)).pathname,children:(0,Z.jsx)(Ae,{versionToColor:z,cluster:P})}),(0,Z.jsx)(o.AW,{render:()=>(0,Z.jsx)(o.l_,{to:(0,v.Fz)((0,kt.B7)(C))})})]})]})}}}]);