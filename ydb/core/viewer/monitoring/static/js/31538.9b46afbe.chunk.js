"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[31538],{21545:(e,t,a)=>{a.d(t,{X:()=>n});var s=a(78034);const n=a(21334).F.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async({id:e,database:t,followerId:a},{signal:n})=>{try{const[r,l,i]=await Promise.all([window.api.viewer.getTablet({id:e,database:t,followerId:a},{signal:n}),window.api.viewer.getTabletHistory({id:e,database:t},{signal:n}),window.api.viewer.getNodesList({signal:n})]),o=(0,s.nN)(i),d=Object.keys(l).reduce(((e,t)=>{var a;const s=null===(a=l[t])||void 0===a?void 0:a.TabletStateInfo;return null===s||void 0===s||s.forEach((a=>{var s;const{ChangeTime:n,Generation:r,State:l,Leader:i,FollowerId:d}=a,c=o&&t?null===(s=o.get(Number(t)))||void 0===s?void 0:s.Host:void 0;e.push({nodeId:t,generation:r,changeTime:n,state:l,leader:i,followerId:d,fqdn:c})})),e}),[]),{TabletStateInfo:c=[]}=r,u=void 0===a?c.find((e=>e.Leader)):c.find((e=>{var t;return(null===(t=e.FollowerId)||void 0===t?void 0:t.toString())===a})),{TabletId:v}=u||{};return{data:{id:v,data:u,history:d}}}catch(r){return{error:r}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async({tenantId:e},{signal:t})=>{try{const a=await window.api.viewer.getTabletDescribe(e,{signal:t}),{SchemeShard:s,PathId:n}=e;return{data:(null===a||void 0===a?void 0:a.Path)||`${s}:${n}`}}catch(a){return{error:a}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async({id:e,hiveId:t},{signal:a})=>{try{return{data:await window.api.tablets.getTabletFromHive({id:e,hiveId:t},{signal:a})}}catch(s){return{error:s}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async({id:e})=>{try{return{data:await window.api.tablets.killTablet(e)}}catch(t){return{error:t}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.stopTablet(e,t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.resumeTablet(e,t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})},27775:(e,t,a)=>{a.d(t,{i:()=>l});var s=a(52443),n=a(58267),r=a(60712);function l({state:e}){return(0,r.jsx)(s.J,{theme:(0,n._)(e),children:e})}},28539:(e,t,a)=>{a.d(t,{T:()=>s.T});var s=a(53755)},45659:(e,t,a)=>{a.d(t,{Q:()=>g});var s=a(32752),n=a(92459),r=a(7435),l=a(46549),i=a(56839),o=a(31684),d=a(12888),c=a(18863),u=a(25196),v=a(15132),h=a(33775),m=a(50672),p=a(60712);function g({pDisk:e,nodeId:t,withPDiskPageLink:a,className:g}){const f=(0,d.X)(),[b,x,j,I]=function({pDisk:e,nodeId:t,withPDiskPageLink:a,isUserAllowedToMakeChanges:d}){const{PDiskId:c,Path:g,Guid:f,Category:b,Type:x,Device:j,Realtime:I,State:N,SerialNumber:w,TotalSize:y,AllocatedSize:k,StatusV2:T,NumActiveSlots:S,ExpectedSlotCount:D,LogUsedSize:z,LogTotalSize:P,SystemSize:C,SharedWithOs:A}=e||{},R=[];(0,r.f8)(b)&&R.push({label:(0,m.D)("type"),value:x}),(0,r.f8)(g)&&R.push({label:(0,m.D)("path"),value:g}),(0,r.f8)(f)&&R.push({label:(0,m.D)("guid"),value:f}),w&&R.push({label:(0,m.D)("serial-number"),value:w}),A&&R.push({label:(0,m.D)("shared-with-os"),value:(0,m.D)("yes")});const U=[];(0,r.f8)(T)&&U.push({label:(0,m.D)("drive-status"),value:T}),(0,r.f8)(N)&&U.push({label:(0,m.D)("state"),value:N}),(0,r.f8)(j)&&U.push({label:(0,m.D)("device"),value:(0,p.jsx)(h.k,{status:j})}),(0,r.f8)(I)&&U.push({label:(0,m.D)("realtime"),value:(0,p.jsx)(h.k,{status:I})});const E=[];E.push({label:(0,m.D)("space"),value:(0,p.jsx)(v.O,{value:k,capacity:y,formatValues:i.vX,colorizeProgress:!0})}),(0,r.f8)(S)&&(0,r.f8)(D)&&E.push({label:(0,m.D)("slots"),value:(0,p.jsx)(v.O,{value:S,capacity:D})}),(0,r.f8)(z)&&(0,r.f8)(P)&&E.push({label:(0,m.D)("log-size"),value:(0,p.jsx)(v.O,{value:z,capacity:P,formatValues:i.vX})}),(0,r.f8)(C)&&E.push({label:(0,m.D)("system-size"),value:(0,l.z3)({value:C})});const V=[];if((a||d)&&(0,r.f8)(c)&&(0,r.f8)(t)){const e=(0,n.Ck)(c,t),r=(0,o.ar)({nodeId:t,pDiskId:c});V.push({label:(0,m.D)("links"),value:(0,p.jsxs)(s.s,{wrap:"wrap",gap:2,children:[a&&(0,p.jsx)(u.K,{title:(0,m.D)("pdisk-page"),url:e,external:!1}),d&&(0,p.jsx)(u.K,{title:(0,m.D)("developer-ui"),url:r})]})})}return[R,U,E,V]}({pDisk:e,nodeId:t,withPDiskPageLink:a,isUserAllowedToMakeChanges:f});return(0,p.jsxs)(s.s,{className:g,gap:2,direction:"row",wrap:!0,children:[(0,p.jsxs)(s.s,{direction:"column",gap:2,width:500,children:[(0,p.jsx)(c.z,{info:b,renderEmptyState:()=>null}),(0,p.jsx)(c.z,{info:j,renderEmptyState:()=>null})]}),(0,p.jsxs)(s.s,{direction:"column",gap:2,width:500,children:[(0,p.jsx)(c.z,{info:x,renderEmptyState:()=>null}),(0,p.jsx)(c.z,{info:I,renderEmptyState:()=>null})]})]})}},52248:(e,t,a)=>{a.d(t,{a:()=>s.a});var s=a(47334)},71635:(e,t,a)=>{a.d(t,{C:()=>f});var s=a(4980),n=a(53850),r=a(62060),l=a.n(r),i=a(21334),o=a(24600);const d=i.F.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.viewer.getTabletsInfo(e,{signal:t})}}catch(a){return{error:a}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),c=(0,n.Mz)((e=>e),(e=>d.endpoints.getTabletsInfo.select(e)),{argsMemoize:n.i5,argsMemoizeOptions:{equalityCheck:l()}}),u=(0,n.Mz)((e=>e),((e,t)=>c(t)),((e,t)=>t(e).data)),v=(0,n.Mz)(((e,t)=>u(e,t)),(e=>(0,o.K)(e)),((e,t)=>null!==e&&void 0!==e&&e.TabletStateInfo?t?e.TabletStateInfo.map((e=>{var a;const s=void 0===e.NodeId||null===(a=t.get(e.NodeId))||void 0===a?void 0:a.Host;return{...e,fqdn:s}})):e.TabletStateInfo:[]));var h=a(7435),m=a(53627),p=a(88616),g=a(60712);function f({nodeId:e,path:t,database:a,onlyActive:n,scrollContainerRef:r}){const[l]=(0,m.Nt)();let i={};const o=n?"(State!=Dead)":void 0;(0,h.f8)(e)?i={nodeId:e,database:a,filter:o}:t&&(i={path:t,database:a,filter:o});const{isLoading:c,error:u}=d.useGetTabletsInfoQuery(0===Object.keys(i).length?s.hT:i,{pollingInterval:l}),f=(0,m.N4)((e=>v(e,i)));return(0,g.jsx)(p.Q,{scrollContainerRef:r,tablets:f,database:a,loading:c,error:u,nodeId:e})}},76938:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(59284);const n=e=>s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),s.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 1.5a6.5 6.5 0 1 1-6.445 7.348.75.75 0 1 1 1.487-.194A5.001 5.001 0 1 0 4.43 4.5h1.32a.75.75 0 0 1 0 1.5h-3A.75.75 0 0 1 2 5.25v-3a.75.75 0 0 1 1.5 0v1.06A6.48 6.48 0 0 1 8 1.5",clipRule:"evenodd"}))},78491:(e,t,a)=>{a.d(t,{$:()=>l});var s=a(32752),n=a(20263),r=a(60712);function l({header:e,note:t}){return(0,r.jsxs)(s.s,{gap:1,alignItems:"center",children:[e,(0,r.jsx)(n.H,{popoverProps:{placement:["right","left"]},children:t})]})}},82651:(e,t,a)=>{a.r(t),a.d(t,{Node:()=>Qe});var s=a(59284),n=a(96727),r=a(29859),l=a(66212),i=a(4980),o=a(61750),d=a(10755),c=a(80987),u=a(3685),v=a(44508),h=a(32752),m=a(77506),p=a(31684),g=a(52075),f=a(12888);var b=a(18863),x=a(25196),j=a(60712);const I=(0,m.cn)("ydb-pool-usage"),N=e=>{let t="green";return e>60&&e<=80?t="yellow":e>80&&(t="red"),t},w=({data:e={}})=>{const{Threads:t,Name:a="Unknown",Usage:s=0}=e,n=s&&t,r=Math.floor(100*s),l=r>100?100:r;return(0,j.jsxs)("div",{className:I(),children:[(0,j.jsxs)("div",{className:I("info"),children:[(0,j.jsx)("div",{className:I("pool-name"),children:a}),n&&(0,j.jsxs)("div",{className:I("value"),children:[(0,j.jsxs)("div",{className:I("percents"),children:[r<1?"<1":r,"%"]}),(0,j.jsxs)("div",{className:I("threads"),children:["(\xd7",t,")"]})]})]}),(0,j.jsx)("div",{className:I("visual"),children:(0,j.jsx)("div",{className:I("usage-line",{type:N(l)}),style:{width:`${l}%`}})})]})};var y=a(15132),k=a(41826),T=a(48372);const S=JSON.parse('{"database":"Database","uptime":"Uptime","version":"Version","dc":"DC","rack":"Rack","links":"Links","la-interval-1m":"1 min","la-interval-5m":"5 min","la-interval-15m":"15 min","developer-ui":"Developer UI","no-data":"No data","title.common-info":"Common info","title.endpoints":"Endpoints","title.roles":"Roles","title.pools":"Pools","title.load-average":"Load average"}'),D=(0,T.g4)("ydb-node-info",{en:S}),z=(0,m.cn)("full-node-viewer"),P=({node:e,className:t})=>{var a,s,n,r,l;const i=function(e){const t=(0,g.E)();if((0,f.X)()){if(null!==t&&void 0!==t&&t.getNodeRef){const a=t.getNodeRef(e);return a?(0,p.Un)(a):void 0}if(null!==e&&void 0!==e&&e.NodeId){const t=(0,p.Kx)(e.NodeId);return(0,p.Un)(t)}}}(e),o=[];null!==e&&void 0!==e&&null!==(a=e.Tenants)&&void 0!==a&&a.length&&o.push({label:D("database"),value:e.Tenants[0]}),o.push({label:D("version"),value:null===e||void 0===e?void 0:e.Version},{label:D("uptime"),value:(0,j.jsx)(k.p,{StartTime:null===e||void 0===e?void 0:e.StartTime,DisconnectTime:null===e||void 0===e?void 0:e.DisconnectTime})},{label:D("dc"),value:(null===e||void 0===e?void 0:e.DataCenterDescription)||(null===e||void 0===e?void 0:e.DC)}),null!==e&&void 0!==e&&e.Rack&&o.push({label:D("rack"),value:null===e||void 0===e?void 0:e.Rack}),i&&o.push({label:D("links"),value:(0,j.jsx)(x.K,{url:i,title:D("developer-ui")})});const d=null===e||void 0===e||null===(s=e.Endpoints)||void 0===s?void 0:s.map((({Name:e,Address:t})=>({label:e,value:t}))),c=null===e||void 0===e||null===(n=e.LoadAveragePercents)||void 0===n?void 0:n.map(((e,t)=>{return{label:(a=t,[D("la-interval-1m"),D("la-interval-5m"),D("la-interval-15m")][a]),value:(0,j.jsx)(y.O,{value:e,percents:!0,colorizeProgress:!0,capacity:100})};var a}));return e?(0,j.jsx)("div",{className:z(null,t),children:(0,j.jsxs)(h.s,{wrap:!0,gap:4,children:[(0,j.jsxs)(h.s,{direction:"column",gap:2,children:[(0,j.jsx)(b.z,{title:D("title.common-info"),className:z("section"),info:o}),d&&d.length?(0,j.jsx)(b.z,{title:D("title.endpoints"),className:z("section"),info:d}):null]}),(0,j.jsxs)(h.s,{direction:"column",gap:2,children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{className:z("section-title"),children:D("title.pools")}),(0,j.jsx)("div",{className:z("section",{pools:!0}),children:null===e||void 0===e||null===(r=e.PoolStats)||void 0===r?void 0:r.map(((e,t)=>(0,j.jsx)(w,{data:e},t)))})]}),(0,j.jsx)(b.z,{title:D("title.load-average"),className:z("section",{average:!0}),info:c})]}),e.Roles&&e.Roles.length?(0,j.jsx)(h.s,{direction:"column",gap:2,children:(0,j.jsxs)("div",{className:z("section"),children:[(0,j.jsx)("div",{className:z("section-title"),children:D("title.roles")}),null===e||void 0===e||null===(l=e.Roles)||void 0===l?void 0:l.map((e=>(0,j.jsx)("div",{className:z("role"),children:e},e)))]})}):null]})}):(0,j.jsx)("div",{className:"error",children:D("no-data")})};var C=a(42655),A=a(44294),R=a(58389),U=a(92459),E=a(67028),V=a(40174),F=a(21334),L=a(78034);const M=e=>{var t;if(null===(t=e.SystemStateInfo)||void 0===t||!t.length)return{};const a=e.SystemStateInfo[0];return(0,L.q1)(a)},q=F.F.injectEndpoints({endpoints:e=>({getNodeInfo:e.query({queryFn:async({nodeId:e},{signal:t})=>{try{const a=await window.api.viewer.getNodeInfo(e,{signal:t});return{data:M(a)}}catch(a){return{error:a}}},providesTags:["All"]}),getNodeStructure:e.query({queryFn:async({nodeId:e},{signal:t})=>{try{return{data:await window.api.viewer.getStorageInfo({nodeId:e},{signal:t})}}catch(a){return{error:a}}},providesTags:["All"]})}),overrideExisting:"throw"});var $=a(53627),_=a(81188),O=a(47199),G=a(71635),X=a(29819),H=a(905),Q=a.n(H),K=a(52248),W=a(53850),Z=a(56839),B=a(27295);const J=(0,W.Mz)((e=>e),(e=>q.endpoints.getNodeStructure.select({nodeId:e}))),Y=(0,W.Mz)((e=>e),((e,t)=>J(t)),((e,t)=>t(e).data)),ee=(0,W.Mz)(((e,t)=>Number(t)),((e,t)=>Y(e,t)),((e,t)=>{const a=null===t||void 0===t?void 0:t.StoragePools,s={};null===a||void 0===a||a.forEach((t=>{const a=t.Groups;null===a||void 0===a||a.forEach((a=>{var n;const r=null===(n=a.VDisks)||void 0===n?void 0:n.filter((t=>t.NodeId===e)).map(B.WT);null===r||void 0===r||r.forEach((a=>{var n;const r=(0,Z.U9)(a.VDiskId),l=null===(n=a.PDisk)||void 0===n?void 0:n.PDiskId;s[String(l)]||(s[String(l)]={vDisks:{},...a.PDisk}),s[String(l)].vDisks[r]={...a,PDiskId:l,NodeId:e,StoragePoolName:t.Name}}))}))}));return Object.keys(s).reduce(((e,t)=>{const a=s[t].vDisks,n=Object.keys(a).reduce(((e,t,s)=>(e.push({...a[t],id:t,order:s}),e)),[]);return e[t]={...s[t],vDisks:n},e}),{})}));var te=a(112),ae=a(45720),se=a(4557),ne=a(80136),re=a(47653),le=a(58611),ie=a(60461),oe=a(45659),de=a(33775),ce=a(67808),ue=a(54090),ve=a(67375),he=a(7435),me=a(76086),pe=a(29971);const ge=(0,m.cn)("kv-node-structure");function fe({label:e,value:t,className:a}){return(0,j.jsxs)("span",{className:ge("pdisk-title-item",a),children:[e&&(0,j.jsxs)("span",{className:ge("pdisk-title-item-label"),children:[e,":"]}),(0,j.jsx)("span",{className:ge("pdisk-title-item-value"),children:t})]})}const be=(0,m.cn)("kv-node-structure");var xe=function(e){return e.slotId="VDiskSlotId",e.VDiskState="VDiskState",e.Size="Size",e.Info="Info",e}(xe||{});const je={VDiskSlotId:"Slot id",VDiskState:"Status",Size:"Size",Info:""};function Ie({pDiskId:e,selectedVdiskId:t,nodeId:a,withDeveloperUILink:s}){return[{name:xe.slotId,header:je[xe.slotId],width:100,render:({row:n})=>{const r=n.VDiskSlotId;let l=null;return(0,he.f8)(a)&&(0,he.f8)(e)&&(0,he.f8)(r)&&(l=(0,p.Wg)({nodeId:a,pDiskId:e,vDiskSlotId:r})),(0,j.jsxs)("div",{className:be("vdisk-id",{selected:n.id===t}),children:[(0,j.jsx)("span",{children:r}),l&&s?(0,j.jsx)(ne.$,{size:"s",className:be("external-button",{hidden:!0}),href:l,target:"_blank",title:(0,pe.A)("vdisk.developer-ui-button-title"),children:(0,j.jsx)(re.I,{data:te.A})}):null]})},align:se.Ay.LEFT},{name:xe.VDiskState,header:je[xe.VDiskState],width:70,render:({row:e})=>(0,j.jsx)(de.k,{status:e.VDiskState===ve.W.OK?ue.m.Green:ue.m.Red}),sortAccessor:e=>e.VDiskState===ve.W.OK?1:0,align:se.Ay.CENTER},{name:xe.Size,header:je[xe.Size],width:170,render:({row:e})=>(0,j.jsx)(y.O,{value:e.AllocatedSize,capacity:Number(e.AllocatedSize)+Number(e.AvailableSize),formatValues:Z.vX,colorizeProgress:!0}),sortAccessor:e=>Number(e.AllocatedSize),align:se.Ay.CENTER},{name:xe.Info,header:je[xe.Info],width:70,render:({row:e})=>(0,j.jsx)(le.A,{placement:["right"],content:(0,j.jsx)(ce.E,{data:e,withTitle:!0,withVDiskPageLink:!0,className:be("vdisk-details")}),children:(0,j.jsx)(ne.$,{view:"flat-secondary",className:be("vdisk-details-button",{selected:e.id===t}),children:(0,j.jsx)(re.I,{data:ae.A,size:18})})}),sortable:!1}]}function Ne({id:e,data:t,selectedVdiskId:a,nodeId:n,unfolded:r}){const l=(0,f.X)(),[i,o]=s.useState(null!==r&&void 0!==r&&r),{TotalSize:d=0,AvailableSize:c=0,Device:u,PDiskId:v,Type:h,vDisks:m}=t,p=Number(d),g=Number(c);return(0,j.jsxs)("div",{className:be("pdisk"),id:e,children:[(0,j.jsxs)("div",{className:be("pdisk-header"),children:[(0,j.jsxs)("div",{className:be("pdisk-title-wrapper"),children:[(0,j.jsx)(de.k,{status:u}),(0,j.jsx)(fe,{label:"PDiskID",value:v,className:be("pdisk-title-id")}),(0,j.jsx)(fe,{value:h,className:be("pdisk-title-type")}),(0,j.jsx)(y.O,{value:p-g,capacity:p,formatValues:Z.vX,colorizeProgress:!0,className:be("pdisk-title-size")}),(0,j.jsx)(fe,{label:"VDisks",value:m.length})]}),(0,j.jsx)(ne.$,{onClick:i?()=>{o(!1)}:()=>{o(!0)},view:"flat-secondary",children:(0,j.jsx)(ie.I,{direction:i?"top":"bottom"})})]}),i&&(Q()(t)?(0,j.jsx)("div",{children:"No information about PDisk"}):(0,j.jsxs)("div",{children:[(0,j.jsx)(oe.Q,{pDisk:t,nodeId:n,className:be("pdisk-details"),withPDiskPageLink:!0}),(0,j.jsxs)("div",{className:be("vdisks-container"),children:[(0,j.jsx)("div",{className:be("vdisks-header"),children:"VDisks"}),(0,j.jsx)(se.Ay,{theme:"yandex-cloud",data:m,columns:Ie({nodeId:n,pDiskId:v,selectedVdiskId:a,withDeveloperUILink:l}),settings:{...me.N3,dynamicRender:!1},rowClassName:e=>e.id===a?be("selected-vdisk"):""})]})]}))]})}const we=(0,m.cn)("kv-node-structure");function ye({type:e,id:t}){return`${e}-${t}`}const ke=function({nodeId:e,className:t}){const a=(0,$.N4)((t=>ee(t,e))),[n]=(0,$.Nt)(),{currentData:r,isFetching:l,error:i}=q.useGetNodeStructureQuery({nodeId:e},{pollingInterval:n}),o=l&&void 0===r,[{pdiskId:d,vdiskId:u}]=(0,c.useQueryParams)({pdiskId:c.StringParam,vdiskId:c.StringParam}),h=s.useRef(null),m=s.useRef(!1);return s.useEffect((()=>{if(!Q()(a)&&!m.current&&h.current&&d){const t=document.getElementById(ye({type:"pdisk",id:d}));let s=0;if(u){var e;const t=null===(e=a[d])||void 0===e?void 0:e.vDisks,n=null===t||void 0===t?void 0:t.find((e=>e.id===u)),r=n?document.querySelector(".data-table"):void 0,l=(null===n||void 0===n?void 0:n.order)||0;r&&(s+=r.offsetTop+40*l)}t&&(h.current.scrollTo({behavior:"smooth",top:s||t.offsetTop}),m.current=!0)}}),[a,d,u]),(0,j.jsxs)("div",{className:we(),ref:h,children:[i?(0,j.jsx)(v.o,{error:i,className:we("error")}):null,(0,j.jsx)("div",{className:t,children:o?(0,j.jsx)(K.a,{size:"m"}):i&&!r?null:(()=>{const t=Object.keys(a);return t.length>0?t.map((t=>(0,j.jsx)(Ne,{data:a[t],id:ye({type:"pdisk",id:t}),unfolded:d===t,selectedVdiskId:u,nodeId:e},t))):"There is no information about node structure."})()})]})};var Te=a(98167),Se=a(17594),De=a(78491),ze=a(41650),Pe=a(88908);const Ce=(0,m.cn)("cpu-usage-bar");function Ae({systemUsage:e=0,userUsage:t=0,className:a}){const s=e+t,n=Math.round(100*e),r=Math.round(100*t),l=Math.round(100*s);return(0,j.jsxs)(h.s,{gap:2,className:Ce(null,a),children:[(0,j.jsx)("div",{className:Ce("progress"),children:(0,j.jsx)(y.O,{value:l,percents:!0,colorizeProgress:!0,capacity:100,className:Ce("progress")})}),(0,j.jsxs)(Pe.E,{color:"secondary",children:["(Sys: ",n,"%, U: ",r,"%)"]})]})}var Re=a(96344),Ue=a(8979);const Ee=(0,m.cn)("ydb-thread-states-bar"),Ve=e=>{switch(e.toUpperCase()){case"R":return"var(--g-color-base-positive-medium)";case"S":return"var(--g-color-base-info-medium)";case"D":return"var(--g-color-base-warning-medium)";case"Z":case"T":case"X":return"var(--g-color-base-danger-medium)";default:return"var(--g-color-base-misc-medium)"}},Fe=e=>{switch(e.toUpperCase()){case"R":return"success";case"S":return"info";case"D":return"warning";case"Z":case"T":case"X":return"danger";default:return"misc"}},Le=e=>{switch(e.toUpperCase()){case"R":return"Running";case"S":return"Sleeping";case"D":return"Uninterruptible sleep";case"Z":return"Zombie";case"T":return"Stopped";case"X":return"Dead";default:return"Unknown"}};function Me({states:e={},totalThreads:t,className:a}){const s=t||Object.values(e).reduce(((e,t)=>e+t),0);if(0===s)return me.Pd;const n=Object.entries(e).filter((([,e])=>e>0)),r=Object.entries(e).map((([e,t])=>({theme:Fe(e),value:t/s*100})));return(0,j.jsxs)("div",{className:Ee(null,a),children:[(0,j.jsx)(Re.k,{stack:r,size:"s"}),(0,j.jsx)(h.s,{gap:2,children:n.map((([e,t])=>(0,j.jsx)(Ue.m,{title:Le(e),children:(0,j.jsxs)(h.s,{gap:1,alignItems:"center",children:[(0,j.jsx)("div",{className:Ee("legend-color"),style:{backgroundColor:Ve(e)}}),(0,j.jsxs)(Pe.E,{color:"secondary",variant:"caption-2",children:[e,": ",t]})]})},e)))})]})}const qe=JSON.parse('{"field_pool-name":"Pool Name","field_thread-count":"Threads","field_cpu-usage":"CPU Usage","field_minor-page-faults":"Minor Page Faults","field_major-page-faults":"Major Page Faults","field_thread-states":"Thread States","value_unknown":"Unknown","alert_no-thread-data":"No thread pool information available","description_cpu-usage":"System usage + user usage"}'),$e=(0,T.g4)("ydb-threads",{en:qe}),_e=[{name:"Name",header:$e("field_pool-name"),render:({row:e})=>e.Name||$e("value_unknown"),width:200},{name:"Threads",header:$e("field_thread-count"),render:({row:e})=>(0,Z.ZV)(e.Threads),align:se.Ay.RIGHT,width:100},{name:"CpuUsage",header:(0,j.jsx)(De.$,{header:$e("field_cpu-usage"),note:$e("description_cpu-usage")}),render:({row:e})=>(0,j.jsx)(Ae,{systemUsage:e.SystemUsage,userUsage:e.UserUsage}),sortAccessor:e=>(0,ze.y3)(e.SystemUsage)+(0,ze.y3)(e.UserUsage),width:200},{name:"MinorPageFaults",header:$e("field_minor-page-faults"),render:({row:e})=>(0,Z.ZV)(e.MinorPageFaults),align:se.Ay.RIGHT,width:145},{name:"MajorPageFaults",header:$e("field_major-page-faults"),render:({row:e})=>(0,Z.ZV)(e.MajorPageFaults),align:se.Ay.RIGHT,width:145},{name:"States",header:$e("field_thread-states"),render:({row:e})=>(0,j.jsx)(Me,{states:e.States,totalThreads:e.Threads}),sortable:!1,width:250}],Oe="threadsTableColumnsWidth";function Ge({nodeId:e,className:t}){const[a]=(0,$.Nt)(),{currentData:s,isLoading:n,error:r}=q.useGetNodeInfoQuery({nodeId:e},{pollingInterval:a}),l=(null===s||void 0===s?void 0:s.Threads)||[];return(0,j.jsxs)(Te.r,{loading:n,className:t,children:[r?(0,j.jsx)(v.o,{error:r}):null,(0,j.jsx)(Se.l,{columnsWidthLSKey:Oe,data:l,columns:_e,settings:me.N3,emptyDataMessage:$e("alert_no-thread-data")})]})}const Xe=(0,m.cn)("node"),He="Storage";function Qe(){var e,t;const a=s.useRef(null),n=(0,$.YQ)(),r=(0,d.W5)(U.Ay.node),l=null===r||void 0===r?void 0:r.params.id,o=null===r||void 0===r?void 0:r.params.activeTab,[{database:u}]=(0,c.useQueryParams)(X.Gi),h=X.IK.parse(o),[m]=(0,$.Nt)(),p=l?{nodeId:l}:i.hT,{currentData:g,isLoading:f,error:b}=q.useGetNodeInfoQuery(p,{pollingInterval:m}),x=(0,E.Pm)(),I=(0,E.c2)(),N=f||!x,w=null===g||void 0===g||null===(e=g.Roles)||void 0===e?void 0:e.find((e=>e===He)),{activeTab:y,nodeTabs:k}=s.useMemo((()=>{var e;let t=w?X.GX:X.GX.filter((e=>"storage"!==e.id));I&&(t=t.filter((e=>"structure"!==e.id)));return{activeTab:null!==(e=t.find((({id:e})=>e===h)))&&void 0!==e?e:t[0],nodeTabs:t}}),[w,I,h]),T=(null===g||void 0===g||null===(t=g.Tenants)||void 0===t?void 0:t[0])||(null===u||void 0===u?void 0:u.toString());return s.useEffect((()=>{f||n((0,V.g)("node",{tenantName:T,nodeRole:w?"Storage":"Compute",nodeId:l}))}),[n,T,l,f,w]),(0,j.jsxs)("div",{className:Xe(null),ref:a,children:[(0,j.jsx)(Ke,{node:g,activeTabTitle:y.title}),(0,j.jsx)(We,{node:g,loading:N}),(0,j.jsx)(Ze,{node:g}),b?(0,j.jsx)(v.o,{error:b,className:Xe("error")}):null,(0,j.jsx)(Be,{node:g,loading:N}),l?(0,j.jsx)(Je,{nodeId:l,tenantName:T,activeTabId:y.id,tabs:k,parentContainer:a}):null]})}function Ke({node:e,activeTabTitle:t}){const{appTitle:a}=(0,_.J)(),s=null!==e&&void 0!==e&&e.Host?e.Host:(0,pe.A)("node");return(0,j.jsx)(o.mg,{titleTemplate:`%s \u2014 ${s} \u2014 ${a}`,defaultTitle:`${s} \u2014 ${a}`,children:(0,j.jsx)("title",{children:t})})}function We({node:e,loading:t}){const a=null!==e&&void 0!==e&&e.Host?`${(0,pe.A)("fqdn")}: ${e.Host}`:void 0,s=null!==e&&void 0!==e&&e.DC?`${(0,pe.A)("dc")}: ${e.DC}`:void 0;return(0,j.jsx)(R.B,{loading:t,items:[a,s],className:Xe("meta")})}function Ze({node:e}){return(0,j.jsx)(u.$,{entityName:(0,pe.A)("node"),status:null===e||void 0===e?void 0:e.SystemState,id:null===e||void 0===e?void 0:e.NodeId,className:Xe("title")})}function Be({node:e,loading:t}){return t?(0,j.jsx)(C.y,{className:Xe("info"),rows:10}):(0,j.jsx)(P,{node:e,className:Xe("info")})}function Je({nodeId:e,tenantName:t,activeTabId:a,tabs:i,parentContainer:o}){return(0,j.jsxs)(s.Fragment,{children:[(0,j.jsx)("div",{className:Xe("tabs"),children:(0,j.jsx)(n.f,{value:a,children:(0,j.jsx)(r.w,{className:Xe("tab-list"),size:"l",children:i.map((({id:a,title:s})=>{const n=(0,X.vI)(e,{database:t},a);return(0,j.jsx)(l.o,{value:a,children:(0,j.jsx)(A.E,{to:n,as:"tab",children:s})},a)}))})})}),(()=>{switch(a){case"storage":return(0,j.jsx)(O.z,{nodeId:e,scrollContainerRef:o,viewContext:{nodeId:e}});case"tablets":return(0,j.jsx)(G.C,{scrollContainerRef:o,nodeId:e,database:t,onlyActive:!0});case"structure":return(0,j.jsx)(ke,{nodeId:e});case"threads":return(0,j.jsx)(Ge,{nodeId:e});default:return!1}})()]})}},88616:(e,t,a)=>{a.d(t,{Q:()=>z});var s=a(59284),n=a(76938),r=a(88908),l=a(47653),i=a(80987),o=a(22983),d=a(28539),c=a(10508),u=a(44508),v=a(44294),h=a(17594),m=a(41775),p=a(69326),g=a(80420),f=a(27775),b=a(41826),x=a(21545),j=a(6354),I=a(76086),N=a(12888),w=a(29819),y=a(48372);const k=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill-header":"Restart tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet","controls.search-placeholder":"Tablet ID","controls.entities-count-label":"Tablets"}'),T=(0,y.g4)("ydb-tablets",{en:k});var S=a(60712);function D(e){const t=e.State===j.r.Stopped,a=(0,N.X)(),[s]=x.X.useKillTabletMutation(),r=e.TabletId;return r?(0,S.jsx)(o.B,{buttonView:"outlined",buttonTitle:T("dialog.kill-header"),dialogHeader:T("dialog.kill-header"),dialogText:T("dialog.kill-text"),onConfirmAction:()=>s({id:r}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:T(a?"dialog.kill-header":"controls.kill-not-allowed"),popoverPlacement:["right","bottom"],popoverDisabled:!1,children:(0,S.jsx)(l.I,{data:n.A})}):null}function z({database:e,tablets:t,loading:a,error:n,scrollContainerRef:l,nodeId:o}){const[{tabletsSearch:x},j]=(0,i.useQueryParams)({tabletsSearch:i.StringParam}),[N,y]=s.useState(),k=s.useMemo((()=>function({database:e,nodeId:t}){const a=[{name:"Type",width:150,get header(){return T("Type")},render:({row:e})=>{const t=!1===e.Leader;return(0,S.jsxs)("span",{children:[e.Type," ",t?(0,S.jsx)(r.E,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return T("Tablet")},render:({row:t})=>t.TabletId?(0,S.jsx)(g.$,{tabletId:t.TabletId,database:e,followerId:t.FollowerId||void 0}):I.Pd},{name:"State",get header(){return T("State")},render:({row:e})=>(0,S.jsx)(f.i,{state:e.State})}];return void 0===t&&a.push({name:"NodeId",get header(){return T("Node ID")},render:({row:e})=>{const t=void 0===e.NodeId?void 0:(0,w.vI)(e.NodeId);return(0,S.jsx)(v.E,{to:t,children:e.NodeId})},align:"right"},{name:"fqdn",get header(){return T("Node FQDN")},render:({row:e})=>e.fqdn?(0,S.jsx)(c.c,{name:e.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,S.jsx)("span",{children:"\u2014"})}),a.push({name:"Generation",get header(){return T("Generation")},align:"right"},{name:"Uptime",get header(){return T("Uptime")},render:({row:e})=>(0,S.jsx)(b.H,{ChangeTime:e.ChangeTime}),sortAccessor:e=>-Number(e.ChangeTime),align:"right",width:120},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:({row:e})=>(0,S.jsx)(D,{...e})}),a}({database:e,nodeId:o})),[e,o]),z=s.useMemo((()=>t.filter((e=>String(e.TabletId).includes(null!==x&&void 0!==x?x:"")))),[t,x]);return(0,S.jsxs)(p.L,{fullHeight:!0,children:[(0,S.jsxs)(p.L.Controls,{children:[(0,S.jsx)(m.v,{placeholder:T("controls.search-placeholder"),onChange:e=>{j({tabletsSearch:e||void 0},"replaceIn")},value:null!==x&&void 0!==x?x:"",width:238}),(0,S.jsx)(d.T,{label:T("controls.entities-count-label"),loading:a,total:t.length,current:z.length})]}),n?(0,S.jsx)(u.o,{error:n}):null,(0,S.jsx)(p.L.Table,{scrollContainerRef:l,scrollDependencies:[x,N],loading:a,children:(0,S.jsx)(h.l,{columns:k,data:z,settings:I.N3,emptyDataMessage:T("noTabletsData"),onSortChange:y})})]})}},96344:(e,t,a)=>{a.d(t,{k:()=>h});var s=a(60712),n=a(59284);const r=(0,a(10417).om)("progress");function l(e){const{text:t,offset:a=0}=e;return t?(0,s.jsx)("div",{className:r("text-inner"),style:{transform:`translateX(calc(var(--g-flow-direction) * ${-a}%))`},children:t}):null}function i({item:e}){const{value:t,color:a,className:n,theme:l,title:i,content:o,loading:d}=e,c={loading:d};return"undefined"===typeof a&&(c.theme=l||"default"),Number.isFinite(t)?(0,s.jsx)("div",{className:r("item",c,n),style:{width:`${t}%`,backgroundColor:a},title:i,children:o}):null}function o(e){return e<100?e-100:0}function d(e){const{theme:t,colorStops:a,colorStopsValue:s,value:n}=e;if(a){const e=a.find(((e,t)=>{const r="number"===typeof s?s:n,l=t>1?a[t-1].stop:0,i=t<a.length-1?e.stop:100;return r>=l&&r<=i}));return e?e.theme:t}return t}function c(e){const{stack:t,stackClassName:a,value:n,text:d}=e,c=o(n||function(e){return e.reduce(((e,{value:t})=>e+t),0)}(t));return(0,s.jsxs)("div",{className:r("stack",a),style:{transform:`translateX(calc(var(--g-flow-direction) * ${c}%))`},children:[(0,s.jsx)("div",{className:r("item"),style:{width:-c+"%"}}),t.map(((e,t)=>(0,s.jsx)(i,{item:e},t))),(0,s.jsx)(l,{offset:c,text:d})]})}function u(e){const{value:t,loading:a,text:n}=e,i=o(t);return Number.isFinite(t)?(0,s.jsx)("div",{className:r("item",{theme:d(e),loading:a}),style:{transform:`translateX(calc(var(--g-flow-direction) * ${i}%))`},children:(0,s.jsx)(l,{offset:i,text:n})}):null}function v(e){return void 0!==e.stack}const h=n.forwardRef((function(e,t){const{text:a="",theme:n="default",size:l="m",loading:i=!1,className:o,qa:d}=e,h={...e,text:a,theme:n,size:l,loading:i};return(0,s.jsxs)("div",{ref:t,className:r({size:l},o),"data-qa":d,children:[(0,s.jsx)("div",{className:r("text"),children:a}),v(h)?(0,s.jsx)(c,{...h}):(0,s.jsx)(u,{...h})]})}))}}]);