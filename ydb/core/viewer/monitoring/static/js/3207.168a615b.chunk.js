"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[3207],{42655:(e,s,n)=>{n.d(s,{y:()=>c});var t=n(59284),a=n(89169),r=n(77506),l=n(66781),o=n(60712);const i=(0,r.cn)("ydb-info-viewer-skeleton"),d=()=>(0,o.jsxs)("div",{className:i("label"),children:[(0,o.jsx)(a.E,{className:i("label__text")}),(0,o.jsx)("div",{className:i("label__dots")})]}),c=({rows:e=8,className:s,delay:n=600})=>{const[r]=(0,l.y)(n);let c=(0,o.jsxs)(t.Fragment,{children:[(0,o.jsx)(d,{}),(0,o.jsx)(a.E,{className:i("value")})]});return r||(c=null),(0,o.jsx)("div",{className:i(null,s),children:[...new Array(e)].map(((e,s)=>(0,o.jsx)("div",{className:i("row"),children:c},`skeleton-row-${s}`)))})}},70043:(e,s,n)=>{n.d(s,{E:()=>l});var t=n(89169),a=n(66781),r=n(60712);const l=({delay:e=600,className:s})=>{const[n]=(0,a.y)(e);return n?(0,r.jsx)(t.E,{className:s}):null}},59984:(e,s,n)=>{n.d(s,{Y:()=>i});n(59284);var t=n(87184),a=n(77506),r=n(60712);const l=(0,a.cn)("tag"),o=({text:e,type:s})=>(0,r.jsx)("div",{className:l({type:s}),children:e}),i=({tags:e,tagsType:s,className:n="",gap:a=1})=>(0,r.jsx)(t.s,{className:n,gap:a,wrap:"wrap",alignItems:"center",children:e&&e.map(((e,n)=>(0,r.jsx)(o,{text:e,type:s},n)))})},51663:(e,s,n)=>{n.r(s),n.d(s,{Cluster:()=>Es});var t=n(59284),a=n(89169),r=n(23871),l=n(61750),o=n(10755),i=n(67087),d=n(90053),c=n(10508),u=n(44294),v=n(92459),h=n(67028),p=n(67298),m=n(40174),g=n(77506),j=n(90182),x=n(66592),N=n(7117),f=n(41122),b=n(88616),y=n(4557),C=n(84476),k=n(28539),T=n(44508),w=n(78524),S=n(48295),_=n(9252),V=n(17594),E=n(95963),O=n(89073),L=n(40336),M=n(63291),D=n(54309),z=n(78668),A=n(71661),G=n(25196),I=n(48372);const P=JSON.parse('{"field_links":"Links","field_monitoring-link":"Monitoring","context_unknown":"unknown database"}'),R=(0,I.g4)("ydb-tenant-name-wrapper",{en:P});var $=n(60712);function B({tenant:e,additionalTenantsProps:s}){var n;const t=(0,j.N4)(z._5),a=((e,s)=>{var n,t;if("function"!==typeof(null===s||void 0===s?void 0:s.prepareTenantBackend))return;let a=null!==(n=e.MonitoringEndpoint)&&void 0!==n?n:e.backend;const r=null!==(t=e.NodeIds)&&void 0!==t?t:e.sharedNodeIds;!a&&r&&r.length>0&&(a={NodeId:r[Math.floor(Math.random()*r.length)]});return s.prepareTenantBackend(a)})(e,s),r=Boolean(a),l=null===s||void 0===s||null===(n=s.getMonitoringLink)||void 0===n?void 0:n.call(s,e.Name,e.Type);return(0,$.jsx)(A.s,{disabled:!t||!l,delayClosing:200,content:l?(0,$.jsx)(L.u,{responsive:!0,children:(0,$.jsx)(L.u.Item,{name:R("field_links"),children:(0,$.jsx)(G.K,{title:R("field_monitoring-link"),url:l})})}):null,placement:["top","bottom"],behavior:M.m.Immediate,children:(0,$.jsx)(c.c,{externalLink:r,name:e.Name||R("context_unknown"),withLeftTrim:!0,status:e.Overall,hasClipboardButton:!0,path:(0,D.YL)({database:e.Name,backend:a})})})}var F=n(58351),U=n(88610),Y=n(53850),Z=n(23536),W=n.n(Z),q=n(54090),Q=n(76086),H=n(56674);const J=(0,Y.Mz)((e=>e),(e=>H.GJ.endpoints.getTenantsInfo.select({clusterName:e}))),K=(0,Y.Mz)((e=>e),((e,s)=>J(s)),(e=>(0,U.CN)(e,Q.Xm)),((e,s,n)=>{var t;const a=null!==(t=s(e).data)&&void 0!==t?t:[];return!n&&a.length>1?a.filter((e=>"Domain"!==e.Type)):a})),X=e=>e.tenants.searchValue,ee=(0,Y.Mz)([K,U.yV,X],((e,s,n)=>{let t=((e,s)=>s===U.s$.ALL?e:e.filter((e=>e.Overall&&e.Overall!==q.m.Green)))(e,s);return t=((e,s)=>e.filter((e=>{const n=new RegExp(W()(s),"i");return n.test(e.Name||"")||n.test(e.controlPlaneName)})))(t,n),t}));var se=n(86200);const ne=(0,g.cn)("tenants"),te=({additionalTenantsProps:e})=>{const s=(0,j.YQ)(),[n]=(0,j.Nt)(),{currentData:a,isFetching:r,error:l}=H.GJ.useGetTenantsInfoQuery({clusterName:F.SL},{pollingInterval:n}),o=r&&void 0===a,i=(0,j.N4)((e=>K(e,F.SL))),d=(0,j.N4)(X),c=(0,j.N4)((e=>ee(e,F.SL))),u=(0,j.N4)(U.yV),v=e=>{s((0,U.$u)(e))},h=e=>{s((0,H.gB)(e))};return(0,$.jsxs)(O.L,{children:[(0,$.jsx)(O.L.Controls,{children:(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)(E.v,{value:d,onChange:h,placeholder:"Database name",className:ne("search")}),(0,$.jsx)(_.k,{value:u,onChange:v}),(0,$.jsx)(k.T,{total:i.length,current:(null===c||void 0===c?void 0:c.length)||0,label:"Databases",loading:o})]})}),l?(0,$.jsx)(T.o,{error:l}):null,(0,$.jsx)(O.L.Table,{loading:o,children:a?(()=>{const s=[{name:"Name",header:"Database",render:({row:s})=>(0,$.jsx)(B,{tenant:s,additionalTenantsProps:e}),width:440,sortable:!0,defaultOrder:y.Ay.DESCENDING},{name:"controlPlaneName",header:"Name",render:({row:e})=>e.controlPlaneName,width:200,sortable:!0,defaultOrder:y.Ay.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:({row:e})=>"Serverless"!==e.Type?e.Type:(0,$.jsxs)("div",{className:ne("type"),children:[(0,$.jsx)("span",{className:ne("type-value"),children:e.Type}),(0,$.jsx)(C.$,{className:ne("type-button"),onClick:()=>h(e.sharedTenantName||""),children:"Show shared"})]})},{name:"State",width:90,render:({row:e})=>e.State?e.State.toLowerCase():"\u2014",customStyle:()=>({textTransform:"capitalize"})},{name:"cpu",header:"CPU",width:80,render:({row:e})=>e.cpu&&e.cpu>1e4?(0,se.iM)(e.cpu):"\u2014",align:y.Ay.RIGHT,defaultOrder:y.Ay.DESCENDING},{name:"memory",header:"Memory",width:120,render:({row:e})=>e.memory?(0,se.vX)(e.memory):"\u2014",align:y.Ay.RIGHT,defaultOrder:y.Ay.DESCENDING},{name:"storage",header:"Storage",width:120,render:({row:e})=>e.storage?(0,se.vX)(e.storage):"\u2014",align:y.Ay.RIGHT,defaultOrder:y.Ay.DESCENDING},{name:"nodesCount",header:"Nodes",width:100,render:({row:e})=>e.nodesCount?(0,se.ZV)(e.nodesCount):"\u2014",align:y.Ay.RIGHT,defaultOrder:y.Ay.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:({row:e})=>e.groupsCount?(0,se.ZV)(e.groupsCount):"\u2014",align:y.Ay.RIGHT,defaultOrder:y.Ay.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:({PoolStats:e=[]})=>e.reduce(((e,s)=>e+(s.Usage||0)),0),defaultOrder:y.Ay.DESCENDING,align:y.Ay.LEFT,render:({row:e})=>(0,$.jsx)(S._,{pools:e.PoolStats})}];return 0===c.length&&u!==U.s$.ALL?(0,$.jsx)(w.v,{name:"thumbsUp",width:"200"}):(0,$.jsx)(V.l,{columnsWidthLSKey:"databasesTableColumnsWidth",data:c,columns:s,settings:Q.N3,emptyDataMessage:"No such tenants"})})():null})]})};var ae=n(44433),re=n(74321),le=n(52248),oe=n(15298),ie=n(18143);const de=(0,g.cn)("ydb-cluster-versions-bar"),ce=({versionsValues:e=[],size:s="s",progressClassName:n})=>(0,$.jsxs)("div",{className:de(),children:[(0,$.jsx)(ie.k,{value:100,stack:e,size:s,className:n}),(0,$.jsx)("div",{className:de("versions"),children:e.map(((s,n)=>(0,$.jsx)("div",{className:de("version-title"),style:{color:s.color},title:s.version,children:`${s.version}${n===e.length-1?"":","}`},s.version)))})]});var ue=n(63126),ve=n(78762),he=n(71294);function pe(e){return[(0,ve._E)(),(0,ve.Nh)(e),(0,ve.jl)(),(0,ve.pH)(),(0,ve.fr)(),(0,ve.ID)()]}const me=({nodes:e})=>{const{balancer:s}=(0,p.Zd)(),{additionalNodesProps:n}=(0,he.B)({balancer:s}),t=pe({getNodeRef:n.getNodeRef});return(0,$.jsx)(V.l,{columnsWidthLSKey:"versionsTableColumnsWidth",data:e,columns:t,settings:Q.N3})};var ge=n(96873);const je=(0,g.cn)("ydb-versions-nodes-tree-title"),xe=({title:e,nodes:s,items:n,versionColor:t,versionsValues:a})=>{let r;return r=n?n.reduce(((e,s)=>s.nodes?e+s.nodes.length:e),0):s?s.length:0,(0,$.jsxs)("div",{className:je("overview"),children:[(0,$.jsxs)("div",{className:je("overview-container"),children:[t?(0,$.jsx)("div",{className:je("version-color"),style:{background:t}}):null,e?(0,$.jsxs)("span",{className:je("overview-title"),children:[e,(0,$.jsx)(ge.b,{text:e,size:"s",className:je("clipboard-button"),view:"normal"})]}):null]}),(0,$.jsxs)("div",{className:je("overview-info"),children:[(0,$.jsxs)("div",{children:[(0,$.jsx)("span",{className:je("info-value"),children:r}),(0,$.jsx)("span",{className:je("info-label",{margin:"left"}),children:"Nodes"})]}),a?(0,$.jsxs)("div",{className:je("version-progress"),children:[(0,$.jsx)("span",{className:je("info-label",{margin:"right"}),children:"Versions"}),(0,$.jsx)(ie.k,{size:"s",value:100,stack:a})]}):null]})]})},Ne=(0,g.cn)("ydb-versions-grouped-node-tree"),fe=({title:e,nodes:s,items:n,expanded:a=!1,versionColor:r,versionsValues:l,level:o=0})=>{const[i,d]=t.useState(!1);t.useEffect((()=>{d(a)}),[a]);const c=(0,$.jsx)(xe,{title:e,nodes:s,items:n,versionColor:r,versionsValues:l}),u=()=>{d((e=>!e))};return n?(0,$.jsx)("div",{className:Ne({"first-level":0===o}),children:(0,$.jsx)(ue.G,{name:c,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:n.map(((e,s)=>(0,$.jsx)(fe,{title:e.title,nodes:e.nodes,expanded:a,versionColor:e.versionColor,level:o+1},s)))},e)}):(0,$.jsx)("div",{className:Ne({"first-level":0===o}),children:(0,$.jsx)(ue.G,{name:c,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:(0,$.jsx)("div",{className:Ne("dt-wrapper"),children:(0,$.jsx)(me,{nodes:s||[]})})},e)})};var be=n(78018),ye=n.n(be),Ce=n(38596);const ke=.5,Te=(e=[],s)=>{const n=e.reduce(((e,s)=>(s.Version&&(e[s.Version]?e[s.Version]=e[s.Version]+1:e[s.Version]=1),e)),{});return Se(Object.keys(n).map((t=>{const a=n[t]/e.length*100;return{title:t,version:t,color:null===s||void 0===s?void 0:s.get((0,Ce.U)(t)),value:a<ke?ke:a}})))};function we(e,s,n){const t=null!==n&&void 0!==n?n:e.reduce(((e,s)=>e+s.count),0);return Se(e.map((e=>{const n=e.count/t*100;return{title:e.name,version:e.name,color:null===s||void 0===s?void 0:s.get(e.name),value:n<ke?ke:n}})))}function Se(e){let s=e[0].value,n=0,t=0;e.forEach(((e,a)=>{t+=e.value,e.value>s&&(s=e.value,n=a)}));const a=[...e];return a[n]={...e[n],value:s+100-t},a}let _e;!function(e){e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage"}(_e||(_e={}));const Ve=(e,s)=>{var n;return(null===(n=e.title)||void 0===n?void 0:n.localeCompare(s.title||""))||-1},Ee=JSON.parse('{"title_overall":"Overall","title_storage":"Storage nodes","title_database":"Database nodes","title_other":"Other nodes"}'),Oe=(0,I.g4)("ydb-versions",{en:Ee});var Le=n(44992),Me=n(98730);const De=(0,g.cn)("ydb-versions"),ze=({versionToColor:e,cluster:s})=>{const[n]=(0,j.Nt)(),a=((e,s)=>{const{currentData:n}=oe.s.useGetNodesQuery((0,Me.L)(e)?Le.hT:{tablets:!1,fieldsRequired:["SystemState"],group:"Version"});return t.useMemo((()=>(0,Me.L)(e)&&e.MapVersions?we(Object.entries(e.MapVersions).map((([e,s])=>({name:e,count:s}))),s,e.NodesTotal):n?Array.isArray(n.NodeGroups)?we(n.NodeGroups,s,null===e||void 0===e?void 0:e.NodesTotal):Te(n.Nodes,s):[]),[n,s,e])})(s,e),{currentData:r,isLoading:l}=oe.s.useGetNodesQuery({tablets:!1,fieldsRequired:["SystemState"]},{pollingInterval:n}),o=null===r||void 0===r?void 0:r.Nodes,[i,d]=t.useState(_e.VERSION),[c,u]=t.useState(!1),v=e=>{d(e)};if(l)return(0,$.jsx)(le.a,{});const h=((e,s,n)=>{if(e&&e.length){if(n===_e.VERSION){const n=ye()(e,"Version");return Object.keys(n).map((e=>{const t=n[e].filter((({Tenants:e})=>Boolean(e))),a=ye()(t,"Tenants"),r=Object.keys(a).map((e=>({title:e,nodes:a[e]}))).sort(Ve);return r.length?{title:e,items:r,versionColor:null===s||void 0===s?void 0:s.get((0,Ce.U)(e))}:null})).filter((e=>Boolean(e)))}{const n=e.filter((({Tenants:e})=>Boolean(e))),t=ye()(n,"Tenants");return Object.keys(t).map((e=>{const n=Te(t[e],s),a=ye()(t[e],"Version"),r=Object.keys(a).map((e=>({title:e,nodes:a[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ce.U)(e))})));return r.length?{title:e,items:r,versionsValues:n}:null})).filter((e=>Boolean(e))).sort(Ve)}}})(o,e,i),p=((e,s)=>{if(!e||!e.length)return;const n=e.filter((({Roles:e})=>null===e||void 0===e?void 0:e.includes("Storage"))),t=ye()(n,"Version");return Object.keys(t).map((e=>({title:e,nodes:t[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ce.U)(e))})))})(o,e),m=((e,s)=>{if(!e||!e.length)return;const n=e.filter((({Roles:e,Version:s})=>!e&&s)),t=ye()(n,"Version");return Object.keys(t).map((e=>({title:e,nodes:t[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ce.U)(e))})))})(o,e),g=null!==p&&void 0!==p&&p.length?(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)("h4",{children:Oe("title_storage")}),p.map((({title:e,nodes:s,items:n,versionColor:t})=>(0,$.jsx)(fe,{title:e,nodes:s,items:n,versionColor:t},`storage-nodes-${e}`)))]}):null,x=null!==h&&void 0!==h&&h.length?(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)("h4",{children:Oe("title_database")}),(0,$.jsxs)("div",{className:De("controls"),children:[(0,$.jsxs)("div",{className:De("group"),children:[(0,$.jsx)("span",{className:De("label"),children:"Group by:"}),(0,$.jsxs)(ae.a,{value:i,onUpdate:v,children:[(0,$.jsx)(ae.a.Option,{value:_e.TENANT,children:_e.TENANT}),(0,$.jsx)(ae.a.Option,{value:_e.VERSION,children:_e.VERSION})]})]}),(0,$.jsx)(re.S,{className:De("checkbox"),onChange:()=>u((e=>!e)),checked:c,children:"All expanded"})]}),h.map((({title:e,nodes:s,items:n,versionColor:t,versionsValues:a})=>(0,$.jsx)(fe,{title:e,nodes:s,items:n,expanded:c,versionColor:t,versionsValues:a},`tenant-nodes-${e}`)))]}):null,N=null!==m&&void 0!==m&&m.length?(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)("h4",{children:Oe("title_other")}),m.map((({title:e,nodes:s,items:n,versionColor:t,versionsValues:a})=>(0,$.jsx)(fe,{title:e,nodes:s,items:n,versionColor:t,versionsValues:a},`other-nodes-${e}`)))]}):null,f=(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)("h4",{children:Oe("title_overall")}),(0,$.jsx)("div",{className:De("overall-wrapper"),children:(0,$.jsx)(ce,{progressClassName:De("overall-progress"),versionsValues:a.filter((e=>"unknown"!==e.title)),size:"m"})})]});return(0,$.jsxs)("div",{className:De(),children:[f,g,x,N]})};var Ae=n(98089),Ge=n(87184),Ie=n(59984),Pe=n(7435);const Re=JSON.parse('{"disk-type":"Disk Type","erasure":"Erasure","allocated":"Allocated","available":"Available","usage":"Usage","label_nodes-state":"Nodes state","label_dc":"Nodes data centers","storage-size":"Storage size","storage-groups":"Storage groups, {{diskType}}","links":"Links","link_cores":"Cores","link_logging":"Logging","context_cores":"cores","title_cpu":"CPU","title_storage":"Storage","title_memory":"Memory","label_nodes":"Nodes","label_hosts":"Hosts","label_storage-groups":"Storage groups","label_databases":"Databases","label_load":"Load"}'),$e=(0,I.g4)("ydb-cluster",{en:Re});var Be=n(2102);const Fe=(0,g.cn)("ydb-doughnut-metrics");function Ue({status:e,fillWidth:s,children:n,className:t}){let a="var(--g-color-line-generic-solid)",r=3.6*s-90;s>50&&(a="var(--doughnut-color)",r=3.6*s+90);const l=r;return(0,$.jsx)("div",{className:Fe(null,t),children:(0,$.jsx)("div",{style:{backgroundImage:`linear-gradient(${l}deg, transparent 50%, ${a} 50%), linear-gradient(-90deg, var(--g-color-line-generic-solid) 50%, transparent 50%)`},className:Fe("doughnut",{status:e}),children:(0,$.jsx)("div",{className:Fe("text-wrapper"),children:n})})})}Ue.Legend=function({children:e,variant:s="subheader-3"}){return(0,$.jsx)(Ae.E,{variant:s,color:"secondary",className:Fe("legend"),children:e})},Ue.Value=function({children:e,variant:s="subheader-2"}){return(0,$.jsx)(Ae.E,{variant:s,color:"secondary",className:Fe("value"),children:e})};var Ye=n(70043);const Ze=(0,g.cn)("ydb-cluster-dashboard");function We({children:e,title:s,size:n,className:t}){return(0,$.jsxs)(Be.A,{className:Ze("card",{size:n},t),size:n,interactive:!1,children:[s?(0,$.jsx)(Ae.E,{variant:"subheader-3",className:Ze("card-title"),children:s}):null,e]})}function qe({title:e,children:s,size:n,...t}){return(0,$.jsx)(We,{title:e,size:n,children:(0,$.jsx)(Ue,{...t,className:Ze("doughnut"),children:s})})}function Qe(){return(0,$.jsx)(We,{className:Ze("skeleton-wrapper"),children:(0,$.jsx)(Ye.E,{className:Ze("skeleton")})})}function He(){return(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)(Qe,{}),(0,$.jsx)(Qe,{}),(0,$.jsx)(Qe,{})]})}var Je=n(35736),Ke=n(49001),Xe=n(24543),es=n(46549);const ss=(0,g.cn)("ydb-disk-groups-stats"),ns=({stats:e,children:s})=>(0,$.jsx)("div",{className:ss(),children:(0,$.jsx)(Xe.u,{placement:["right"],pinOnClick:!0,content:(0,$.jsx)(ts,{stats:e}),children:s})});function ts({stats:e}){const{diskType:s,erasure:n,allocatedSize:t,availableSize:a}=e,r=(0,es.dd)(Math.max(t,a),2),l=(0,es.z3)({value:t,size:r}),o=(0,es.z3)({value:a,size:r}),i=Math.round(t/(t+a)*100),d=[{name:$e("disk-type"),content:s},{name:$e("erasure"),content:n},{name:$e("allocated"),content:l},{name:$e("available"),content:o},{name:$e("usage"),content:i+"%"}];return(0,$.jsx)(Ke.u,{items:d,className:ss("popup-content"),responsive:!0})}function as({value:e,capacity:s,colorizeProgress:n=!0,warningThreshold:t=60,dangerThreshold:a=80,inverseColorize:r=!1,legendFormatter:l}){const o=parseFloat(String(e)),i=parseFloat(String(s));let d=o/i*100||0;d=d>100?100:d;const c=d<1?.5:d;return{status:(0,Je.w)({fillWidth:d,warningThreshold:t,dangerThreshold:a,colorizeProgress:n,inverseColorize:r}),percents:(0,se.l9)(d/100),legend:l({value:o,capacity:i}),fill:c}}const rs=["storage","tenant"];const ls=e=>Object.values(e).reduce(((e,s)=>(Object.values(s).forEach((s=>{e+=s.createdGroups})),e)),0);function os({value:e,capacity:s}){let n=[];return n=s<1e4?[(0,se.ZV)(Math.round(e)),(0,se.ZV)(Math.round(s))]:(0,se.Nd)(e,s,void 0,"",!0),`${n[0]} / ${n[1]}\n${$e("context_cores")}`}function is({value:e,capacity:s,...n}){const{status:t,percents:a,legend:r,fill:l}=as({value:e,capacity:s,legendFormatter:os,...n});return(0,$.jsxs)(qe,{status:t,fillWidth:l,title:$e("title_cpu"),children:[(0,$.jsx)(Ue.Legend,{children:r}),(0,$.jsx)(Ue.Value,{children:a})]})}function ds({value:e,capacity:s}){const n=(0,se.j9)(e,s,void 0,"\n");return`${n[0]} / ${n[1]}`}function cs({value:e,capacity:s,...n}){const{status:t,percents:a,legend:r,fill:l}=as({value:e,capacity:s,legendFormatter:ds,...n});return(0,$.jsxs)(qe,{status:t,fillWidth:l,title:$e("title_memory"),children:[(0,$.jsx)(Ue.Legend,{children:r}),(0,$.jsx)(Ue.Value,{children:a})]})}function us({value:e,capacity:s}){const n=(0,se.j9)(e,s,void 0,"\n");return`${n[0]} / ${n[1]}`}function vs({value:e,capacity:s,...n}){const{status:t,percents:a,legend:r,fill:l}=as({value:e,capacity:s,legendFormatter:us,...n});return(0,$.jsxs)(qe,{status:t,fillWidth:l,title:$e("title_storage"),children:[(0,$.jsx)(Ue.Legend,{children:r}),(0,$.jsx)(Ue.Value,{children:a})]})}function hs({value:e}){return(0,Pe.f8)(e)?(0,$.jsx)(Ae.E,{variant:"subheader-3",color:"secondary",children:(0,se.ZV)(e)}):null}function ps({cluster:e,...s}){return s.error?(0,$.jsx)(T.o,{error:s.error,className:Ze("error")}):(0,$.jsx)("div",{className:Ze(),children:(0,$.jsxs)(Ge.s,{gap:4,wrap:!0,children:[(0,$.jsx)(Ge.s,{gap:4,wrap:"nowrap",children:(0,$.jsx)(ms,{...s,cluster:e})}),(0,$.jsx)("div",{className:Ze("cards-container"),children:(0,$.jsx)(gs,{...s,cluster:e})})]})})}function ms({cluster:e,loading:s}){if(s)return(0,$.jsx)(He,{});const n=[];if((0,Me.L)(e)){const{CoresUsed:s,NumberOfCpus:t,CoresTotal:a}=e,r=null!==a&&void 0!==a?a:t;(0,Pe.f8)(s)&&(0,Pe.f8)(r)&&n.push((0,$.jsx)(is,{value:s,capacity:r},"cores"))}const{StorageTotal:t,StorageUsed:a}=e;(0,Pe.f8)(t)&&(0,Pe.f8)(a)&&n.push((0,$.jsx)(vs,{value:a,capacity:t},"storage"));const{MemoryTotal:r,MemoryUsed:l}=e;return(0,Pe.f8)(r)&&(0,Pe.f8)(l)&&n.push((0,$.jsx)(cs,{value:l,capacity:r},"memory")),n}function gs({cluster:e,groupStats:s={},loading:n}){if(n)return null;const a=[],r=function(e){const s=[];if((0,Me.L)(e)&&e.MapNodeRoles)for(const[n,a]of Object.entries(e.MapNodeRoles))rs.includes(n.toLowerCase())&&s.push((0,$.jsxs)(t.Fragment,{children:[n,": ",(0,se.ZV)(a)]},n));return s}(e);if(a.push((0,$.jsx)(We,{size:"l",title:$e("label_nodes"),children:(0,$.jsxs)(Ge.s,{gap:2,direction:"column",children:[(0,$.jsx)(hs,{value:null===e||void 0===e?void 0:e.NodesAlive}),null!==r&&void 0!==r&&r.length?(0,$.jsx)(Ie.Y,{tags:r,gap:3}):null]})},"roles")),Object.keys(s).length){const e=function(e){const s=[];return Object.entries(e).forEach((([e,n])=>{Object.values(n).forEach((n=>{s.push((0,$.jsxs)(ns,{stats:n,children:[e,": ",(0,se.ZV)(n.createdGroups)," /"," ",(0,se.ZV)(n.totalGroups)]},`${e}|${n.erasure}`))}))})),s}(s),n=ls(s);a.push((0,$.jsx)(We,{size:"l",title:$e("label_storage-groups"),children:(0,$.jsxs)(Ge.s,{gap:2,direction:"column",children:[(0,$.jsx)(hs,{value:n}),(0,$.jsx)(Ie.Y,{tags:e,gap:3})]})},"groups"))}const l=function(e){var s;return(0,Me.L)(e)&&e.MapDataCenters?Object.keys(e.MapDataCenters):null===(s=e.DataCenters)||void 0===s?void 0:s.filter(Boolean)}(e);return null!==l&&void 0!==l&&l.length&&a.push((0,$.jsx)(We,{size:"l",title:$e("label_hosts"),children:(0,$.jsxs)(Ge.s,{gap:2,direction:"column",children:[(0,$.jsx)(hs,{value:null===e||void 0===e?void 0:e.Hosts}),(0,$.jsx)(Ie.Y,{tags:l,gap:3})]})},"hosts")),e.Tenants&&a.push((0,$.jsx)(We,{size:"l",title:$e("label_databases"),children:(0,$.jsx)(hs,{value:null===e||void 0===e?void 0:e.Tenants})},"tenants")),a}var js=n(18863),xs=n(42655);const Ns=(0,g.cn)("cluster-info");var fs=n(15132),bs=(n(6354),n(41650));const ys=(0,g.cn)("ydb-nodes-state");function Cs({state:e,children:s}){return(0,$.jsx)("div",{className:ys({[e.toLowerCase()]:!0}),children:s})}const ks={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},Ts=(e,s,n)=>{const a=[];if((0,Me.L)(e)&&e.MapNodeStates){const s=Object.entries(e.MapNodeStates);s.sort(((e,s)=>ks[s[0]]-ks[e[0]]));const n=s.map((([e,s])=>(0,$.jsx)(Cs,{state:e,children:(0,se.ZV)(s)},e)));a.push({label:$e("label_nodes-state"),value:(0,$.jsx)(Ge.s,{gap:2,children:n})})}const r=(e=>{if((0,Me.L)(e)&&e.MapDataCenters)return Object.entries(e.MapDataCenters).map((([e,s])=>(0,$.jsxs)(t.Fragment,{children:[e,": ",(0,se.ZV)(s)]},e)))})(e);return null!==r&&void 0!==r&&r.length&&a.push({label:$e("label_dc"),value:(0,$.jsx)(Ie.Y,{tags:r,gap:2})}),a.push({label:$e("label_load"),value:(0,$.jsx)(fs.O,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null===e||void 0===e?void 0:e.NumberOfCpus})}),a.push(...s),n.length&&a.push({label:$e("links"),value:(0,$.jsx)("div",{className:Ns("links"),children:n.map((({title:e,url:s})=>(0,$.jsx)(G.K,{title:e,url:s},e)))})}),a};function ws(e){try{const s=(0,bs.qF)(e);if(s&&"object"===typeof s&&"url"in s&&"string"===typeof s.url)return s.url}catch{}}const Ss=({cluster:e,loading:s,error:n,additionalClusterProps:a={}})=>{const{info:r=[],links:l=[]}=a,o=function(){const{cores:e,logging:s}=(0,p.Zd)();return t.useMemo((()=>{const n=[],t=ws(e),a=ws(s);return t&&n.push({title:$e("link_cores"),url:t}),a&&n.push({title:$e("link_logging"),url:a}),n}),[e,s])}(),i=Ts(null!==e&&void 0!==e?e:{},r,[...l,...o]);return(0,$.jsxs)("div",{className:Ns(),children:[n?(0,$.jsx)(T.o,{error:n,className:Ns("error")}):null,(0,$.jsx)("div",{className:Ns("info"),children:s?(0,$.jsx)(xs.y,{className:Ns("skeleton"),rows:9}):n&&!e?null:(0,$.jsx)(js.z,{dots:!0,info:i})})]})};var _s=n(87842);const Vs=(0,g.cn)("ydb-cluster");function Es({additionalClusterProps:e,additionalTenantsProps:s,additionalNodesProps:n,additionalVersionsProps:g}){const y=t.useRef(null),C=(0,h.fp)(),k=(0,j.YQ)(),T=function(){const e=(0,j.YQ)(),s=(0,j.N4)((e=>e.cluster.defaultClusterTab)),n=(0,o.W5)(v.Ay.cluster),{activeTab:a}=(null===n||void 0===n?void 0:n.params)||{};let r;r=(0,_s.eC)(a)?a:s;return t.useEffect((()=>{r!==s&&e((0,p.Yv)(r))}),[r,s,e]),r}(),[{clusterName:w,backend:S}]=(0,i.useQueryParams)({clusterName:i.StringParam,backend:i.StringParam}),_=(0,j.N4)((e=>(0,p.zR)(e,null!==w&&void 0!==w?w:void 0))),{data:{clusterData:V={},groupsStats:E}={},isLoading:O,error:L}=p.Zh.useGetClusterInfoQuery(null!==w&&void 0!==w?w:void 0),M=L&&"object"===typeof L?L:void 0,D=(0,j.N4)((e=>(0,p.ds)(e,null!==w&&void 0!==w?w:void 0)));t.useEffect((()=>{k((0,m.g)("cluster",{}))}),[k]);const z=t.useMemo((()=>null!==g&&void 0!==g&&g.getVersionToColorMap?null===g||void 0===g?void 0:g.getVersionToColorMap():(0,x._n)(null===V||void 0===V?void 0:V.Versions)),[g,V]),A=t.useMemo((()=>_s.bn.find((({id:e})=>e===T))),[T]);return(0,$.jsxs)("div",{className:Vs(),ref:y,children:[(0,$.jsx)(l.mg,{defaultTitle:`${_} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${_} \u2014 YDB Monitoring`,children:A?(0,$.jsx)("title",{children:A.title}):null}),(0,$.jsx)("div",{className:Vs("header"),children:O?(0,$.jsx)(a.E,{className:Vs("title-skeleton")}):(0,$.jsx)(c.c,{size:"m",status:null===V||void 0===V?void 0:V.Overall,name:_,className:Vs("title")})}),(0,$.jsx)("div",{className:Vs("sticky-wrapper"),children:(0,$.jsx)(d.E,{className:Vs("auto-refresh-control")})}),C&&(0,$.jsx)(ps,{cluster:V,groupStats:E,loading:O,error:M||(null===V||void 0===V?void 0:V.error)}),(0,$.jsx)("div",{className:Vs("tabs-sticky-wrapper"),children:(0,$.jsx)(r.t,{size:"l",allowNotSelected:!0,activeTab:T,items:_s.bn,wrapTo:({id:e},s)=>{const n=(0,_s.a)(e,{clusterName:w,backend:S});return(0,$.jsx)(u.E,{to:n,onClick:()=>{k((0,p.Yv)(e))},children:s},e)}})}),(0,$.jsxs)(o.dO,{children:[(0,$.jsx)(o.qh,{path:(0,v.a3)((0,_s.a)(_s.Bi.overview)).pathname,children:(0,$.jsx)(Ss,{cluster:V,versionToColor:z,loading:O,error:M,additionalClusterProps:e})}),(0,$.jsx)(o.qh,{path:(0,v.a3)((0,_s.a)(_s.Bi.tablets)).pathname,children:(0,$.jsx)("div",{className:Vs("tablets"),children:(0,$.jsx)(b.Q,{loading:O,tablets:D,className:Vs("tablets-table")})})}),(0,$.jsx)(o.qh,{path:(0,v.a3)((0,_s.a)(_s.Bi.tenants)).pathname,children:(0,$.jsx)(te,{additionalTenantsProps:s})}),(0,$.jsx)(o.qh,{path:(0,v.a3)((0,_s.a)(_s.Bi.nodes)).pathname,children:(0,$.jsx)(N.G,{parentRef:y,additionalNodesProps:n})}),(0,$.jsx)(o.qh,{path:(0,v.a3)((0,_s.a)(_s.Bi.storage)).pathname,children:(0,$.jsx)(f.p,{parentRef:y})}),(0,$.jsx)(o.qh,{path:(0,v.a3)((0,_s.a)(_s.Bi.versions)).pathname,children:(0,$.jsx)(ze,{versionToColor:z,cluster:V})}),(0,$.jsx)(o.qh,{render:()=>(0,$.jsx)(o.rd,{to:(0,v.a3)((0,_s.a)(T))})})]})]})}}}]);