"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[35742],{7701:(e,t,s)=>{s.r(t),s.d(t,{Cluster:()=>os});var n=s(59284),r=s(89169),a=s(23871),l=s(61750),o=s(10755),i=s(80987),c=s(90053),d=s(60865),u=s(47665),m=s(87184),h=s(98934),v=s(54090),g=s(77506),p=s(43937),x=s(36388),j=s(94420),N=s(70825),f=s(49917),y=s(99991),b=s(60712);const w={[v.m.Blue]:p.A,[v.m.Yellow]:x.A,[v.m.Orange]:j.A,[v.m.Red]:x.A,[v.m.Green]:N.A,[v.m.Grey]:f.A};function _({status:e,...t}){return e?(0,b.jsx)(y.I,{...t,data:w[e]}):null}var k=s(48372);const C=JSON.parse('{"title_red":"Critical","title_blue":"Normal","title_green":"Good","title_grey":"Unknown","title_orange":"Caution","title_yellow":"Warning","context_red":"Some systems are failed and not available","context_yellow":"There are minor issues","context_orange":"Critical state, requires immediate attention","context_green":"Everything is working as expected","context_grey":"The condition cannot be determined","context_blue":"All good, some parts of the system are restoring"}'),S=(0,k.g4)("ydb-entity-status",{en:C}),T={get[v.m.Red](){return S("context_red")},get[v.m.Yellow](){return S("context_yellow")},get[v.m.Orange](){return S("context_orange")},get[v.m.Green](){return S("context_green")},get[v.m.Grey](){return S("context_grey")},get[v.m.Blue](){return S("context_blue")}},E=(0,g.cn)("ydb-entity-status-new"),V={[v.m.Red]:"danger",[v.m.Blue]:"info",[v.m.Green]:"success",[v.m.Grey]:"unknown",[v.m.Orange]:"orange",[v.m.Yellow]:"warning"},O={get[v.m.Red](){return S("title_red")},get[v.m.Yellow](){return S("title_yellow")},get[v.m.Orange](){return S("title_orange")},get[v.m.Green](){return S("title_green")},get[v.m.Grey](){return S("title_grey")},get[v.m.Blue](){return S("title_blue")}};function L({className:e,children:t}){return(0,b.jsx)(m.s,{gap:"2",wrap:"nowrap",alignItems:"center",className:E(null,e),children:t})}L.Label=function({children:e,status:t,withStatusName:s=!0,note:n,size:r="m",iconSize:a=14}){const l=V[t];return(0,b.jsx)(d.m,{title:T[t],disabled:Boolean(n),children:(0,b.jsx)(u.J,{theme:"orange"===l?void 0:l,icon:(0,b.jsx)(_,{size:a,status:t}),size:r,className:E({orange:"orange"===l}),children:(0,b.jsxs)(m.s,{gap:"2",wrap:"nowrap",children:[e,s?O[t]:null,n&&(0,b.jsx)(h.H,{children:n})]})})})},L.displayName="EntityStatus";var A=s(44294),G=s(92459),z=s(67028),D=s(67157),I=s(40174),M=s(90182),$=s(7117),R=s(67079),P=s(88616),B=s(93381),U=s(64470),W=s(4557),F=s(84476),J=s(40569),Y=s(28539),q=s(44508),H=s(78524),Z=s(48295),Q=s(9252),K=s(17594),X=s(95963),ee=s(89073),te=s(23900),se=s(54309),ne=s(12888),re=s(10508),ae=s(25196);const le=JSON.parse('{"field_links":"Links","field_monitoring-link":"Monitoring","field_logs-link":"Logs","context_unknown":"unknown database"}'),oe=(0,k.g4)("ydb-tenant-name-wrapper",{en:le});function ie({tenant:e,additionalTenantsProps:t}){var s,n;const r=(0,ne.X)(),a=((e,t)=>{var s;if("function"!==typeof(null===t||void 0===t?void 0:t.prepareTenantBackend))return;let n;const r=null!==(s=e.NodeIds)&&void 0!==s?s:e.sharedNodeIds;r&&r.length>0&&(n=r[Math.floor(Math.random()*r.length)].toString());return t.prepareTenantBackend(n)})(e,t),l=Boolean(a),o=null===t||void 0===t||null===(s=t.getMonitoringLink)||void 0===s?void 0:s.call(t,e.Name,e.Type),i=null===t||void 0===t||null===(n=t.getLogsLink)||void 0===n?void 0:n.call(t,e.Name),c=(o||i)&&r?(0,b.jsx)(te.u,{responsive:!0,children:(0,b.jsx)(te.u.Item,{name:oe("field_links"),children:(0,b.jsxs)(m.s,{gap:2,wrap:"wrap",children:[o&&(0,b.jsx)(ae.K,{title:oe("field_monitoring-link"),url:o}),i&&(0,b.jsx)(ae.K,{title:oe("field_logs-link"),url:i})]})})}):null;return(0,b.jsx)(re.c,{externalLink:l,name:e.Name||oe("context_unknown"),withLeftTrim:!0,status:e.Overall,infoPopoverContent:c,hasClipboardButton:!0,path:(0,se.YL)({database:e.Name,backend:a},{withBasename:l})})}var ce=s(88610),de=s(53850),ue=s(23536),me=s.n(ue),he=s(76086),ve=s(56674);const ge=(0,de.Mz)((e=>e),(e=>ve.GJ.endpoints.getTenantsInfo.select({clusterName:e}))),pe=(0,de.Mz)((e=>e),((e,t)=>ge(t)),(e=>(0,ce.CN)(e,he.Xm)),((e,t,s)=>{var n;const r=null!==(n=t(e).data)&&void 0!==n?n:[];return!s&&r.length>1?r.filter((e=>"Domain"!==e.Type)):r})),xe=e=>e.tenants.searchValue,je=(0,de.Mz)([pe,ce.yV,xe],((e,t,s)=>{let n=((e,t)=>t===ce.s$.ALL?e:e.filter((e=>e.Overall&&e.Overall!==v.m.Green)))(e,t);return n=((e,t)=>e.filter((e=>{const s=new RegExp(me()(t),"i");return s.test(e.Name||"")||s.test(e.controlPlaneName)})))(n,s),n}));var Ne=s(51114),fe=s(56839),ye=s(28232);const be=JSON.parse('{"create-database":"Create database","remove":"Remove"}'),we=(0,k.g4)("ydb-tenants-table",{en:be}),_e=(0,g.cn)("tenants"),ke=({additionalTenantsProps:e})=>{const t=(0,M.YQ)(),s=(0,ye.H)(),[r]=(0,M.Nt)(),{currentData:a,isFetching:l,error:o}=ve.GJ.useGetTenantsInfoQuery({clusterName:s},{pollingInterval:r}),i=l&&void 0===a,c=(0,z.sH)()&&void 0!==Ne.J.onCreateDB,d=(0,z.TW)()&&void 0!==Ne.J.onDeleteDB,u=(0,M.N4)((e=>pe(e,s))),m=(0,M.N4)(xe),h=(0,M.N4)((e=>je(e,s))),v=(0,M.N4)(ce.yV),g=e=>{t((0,ce.$u)(e))},p=e=>{t((0,ve.gB)(e))};return(0,b.jsx)("div",{className:_e("table-wrapper"),children:(0,b.jsxs)(ee.L,{children:[(0,b.jsx)(ee.L.Controls,{children:(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)(X.v,{value:m,onChange:p,placeholder:"Database name",className:_e("search")}),(0,b.jsx)(Q.k,{value:v,onChange:g}),(0,b.jsx)(Y.T,{total:u.length,current:(null===h||void 0===h?void 0:h.length)||0,label:"Databases",loading:i}),c&&s&&!i?(0,b.jsxs)(F.$,{view:"action",onClick:()=>{var e;return null===(e=Ne.J.onCreateDB)||void 0===e?void 0:e.call(Ne.J,{clusterName:s})},className:_e("create-database"),children:[(0,b.jsx)(y.I,{data:B.A}),we("create-database")]}):null]})}),o?(0,b.jsx)(q.o,{error:o}):null,(0,b.jsx)(ee.L.Table,{loading:i,children:a?(()=>{const t=[{name:"Name",header:"Database",render:({row:t})=>(0,b.jsx)(ie,{tenant:t,additionalTenantsProps:e}),width:440,sortable:!0,defaultOrder:W.Ay.DESCENDING},{name:"controlPlaneName",header:"Name",render:({row:e})=>e.controlPlaneName,width:200,sortable:!0,defaultOrder:W.Ay.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:({row:e})=>"Serverless"!==e.Type?e.Type:(0,b.jsxs)("div",{className:_e("type"),children:[(0,b.jsx)("span",{className:_e("type-value"),children:e.Type}),(0,b.jsx)(F.$,{className:_e("type-button"),onClick:()=>p(e.sharedTenantName||""),children:"Show shared"})]})},{name:"State",width:150,render:({row:e})=>e.State?e.State.toLowerCase():"\u2014",customStyle:()=>({textTransform:"capitalize"})},{name:"cpu",header:"CPU",width:80,render:({row:e})=>e.cpu&&e.cpu>1e4?(0,fe.iM)(e.cpu):"\u2014",align:W.Ay.RIGHT,defaultOrder:W.Ay.DESCENDING},{name:"memory",header:"Memory",width:120,render:({row:e})=>e.memory?(0,fe.vX)(e.memory):"\u2014",align:W.Ay.RIGHT,defaultOrder:W.Ay.DESCENDING},{name:"storage",header:"Storage",width:120,render:({row:e})=>e.storage?(0,fe.vX)(e.storage):"\u2014",align:W.Ay.RIGHT,defaultOrder:W.Ay.DESCENDING},{name:"nodesCount",header:"Nodes",width:100,render:({row:e})=>e.nodesCount?(0,fe.ZV)(e.nodesCount):"\u2014",align:W.Ay.RIGHT,defaultOrder:W.Ay.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:({row:e})=>e.groupsCount?(0,fe.ZV)(e.groupsCount):"\u2014",align:W.Ay.RIGHT,defaultOrder:W.Ay.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:({PoolStats:e=[]})=>e.reduce(((e,t)=>e+(t.Usage||0)),0),defaultOrder:W.Ay.DESCENDING,align:W.Ay.LEFT,render:({row:e})=>(0,b.jsx)(Z._,{pools:e.PoolStats})}];return d&&t.push({name:"actions",header:"",width:40,resizeable:!1,align:W.Ay.CENTER,render:({row:e})=>{var t;const n=null===(t=e.UserAttributes)||void 0===t?void 0:t.database_id,r=e.Name;let a=[];return s&&r&&n&&(a=[{text:we("remove"),iconStart:(0,b.jsx)(U.A,{}),action:()=>{var e;null===(e=Ne.J.onDeleteDB)||void 0===e||e.call(Ne.J,{clusterName:s,databaseId:n,databaseName:r})},className:_e("remove-db")}]),a.length?(0,b.jsx)(J.r,{defaultSwitcherProps:{view:"flat",size:"s",pin:"brick-brick"},items:a}):null}}),0===h.length&&v!==ce.s$.ALL?(0,b.jsx)(H.v,{name:"thumbsUp",width:"200"}):(0,b.jsx)(K.l,{columnsWidthLSKey:"databasesTableColumnsWidth",data:h,columns:t,settings:he.N3,emptyDataMessage:"No such tenants"})})():null})]})})};var Ce=s(44433),Se=s(74321),Te=s(98167),Ee=s(15298),Ve=s(18143);const Oe=(0,g.cn)("ydb-cluster-versions-bar"),Le=({versionsValues:e=[],size:t="s",progressClassName:s})=>(0,b.jsxs)("div",{className:Oe(),children:[(0,b.jsx)(Ve.k,{value:100,stack:e,size:t,className:s}),(0,b.jsx)("div",{className:Oe("versions"),children:e.map(((t,s)=>(0,b.jsx)("div",{className:Oe("version-title"),style:{color:t.color},title:t.version,children:`${t.version}${s===e.length-1?"":","}`},t.version)))})]});var Ae=s(63126),Ge=s(78762),ze=s(88655);function De(e){return[(0,Ge._E)(),(0,Ge.Nh)(e),(0,Ge.jl)(),(0,Ge.pH)(),(0,Ge.fr)(),(0,Ge.ID)()]}const Ie=({nodes:e})=>{const t=(0,ze.E)(),s=De({getNodeRef:null===t||void 0===t?void 0:t.getNodeRef});return(0,b.jsx)(K.l,{columnsWidthLSKey:"versionsTableColumnsWidth",data:e,columns:s,settings:he.N3})};var Me=s(96873);const $e=(0,g.cn)("ydb-versions-nodes-tree-title"),Re=({title:e,nodes:t,items:s,versionColor:n,versionsValues:r})=>{let a;return a=s?s.reduce(((e,t)=>t.nodes?e+t.nodes.length:e),0):t?t.length:0,(0,b.jsxs)("div",{className:$e("overview"),children:[(0,b.jsxs)("div",{className:$e("overview-container"),children:[n?(0,b.jsx)("div",{className:$e("version-color"),style:{background:n}}):null,e?(0,b.jsxs)("span",{className:$e("overview-title"),children:[e,(0,b.jsx)(Me.b,{text:e,size:"s",className:$e("clipboard-button"),view:"normal"})]}):null]}),(0,b.jsxs)("div",{className:$e("overview-info"),children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:$e("info-value"),children:a}),(0,b.jsx)("span",{className:$e("info-label",{margin:"left"}),children:"Nodes"})]}),r?(0,b.jsxs)("div",{className:$e("version-progress"),children:[(0,b.jsx)("span",{className:$e("info-label",{margin:"right"}),children:"Versions"}),(0,b.jsx)(Ve.k,{size:"s",value:100,stack:r})]}):null]})]})},Pe=(0,g.cn)("ydb-versions-grouped-node-tree"),Be=({title:e,nodes:t,items:s,expanded:r=!1,versionColor:a,versionsValues:l,level:o=0})=>{const[i,c]=n.useState(!1);n.useEffect((()=>{c(r)}),[r]);const d=(0,b.jsx)(Re,{title:e,nodes:t,items:s,versionColor:a,versionsValues:l}),u=()=>{c((e=>!e))};return s?(0,b.jsx)("div",{className:Pe({"first-level":0===o}),children:(0,b.jsx)(Ae.G,{name:d,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:s.map(((e,t)=>(0,b.jsx)(Be,{title:e.title,nodes:e.nodes,expanded:r,versionColor:e.versionColor,level:o+1},t)))},e)}):(0,b.jsx)("div",{className:Pe({"first-level":0===o}),children:(0,b.jsx)(Ae.G,{name:d,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:(0,b.jsx)("div",{className:Pe("dt-wrapper"),children:(0,b.jsx)(Ie,{nodes:t||[]})})},e)})};var Ue=s(78018),We=s.n(Ue),Fe=s(38596);const Je=.5,Ye=(e=[],t)=>{const s=e.reduce(((e,t)=>(t.Version&&(e[t.Version]?e[t.Version]=e[t.Version]+1:e[t.Version]=1),e)),{});return He(Object.keys(s).map((n=>{const r=s[n]/e.length*100;return{title:n,version:n,color:null===t||void 0===t?void 0:t.get((0,Fe.U)(n)),value:r<Je?Je:r}})))};function qe(e,t,s){const n=null!==s&&void 0!==s?s:e.reduce(((e,t)=>e+t.count),0);return He(e.map((e=>{const s=e.count/n*100;return{title:e.name,version:e.name,color:null===t||void 0===t?void 0:t.get((0,Fe.U)(e.name)),value:s<Je?Je:s}})))}function He(e){let t=e[0].value,s=0,n=0;e.forEach(((e,r)=>{n+=e.value,e.value>t&&(t=e.value,s=r)}));const r=[...e];return r[s]={...e[s],value:t+100-n},r}let Ze=function(e){return e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage",e}({});const Qe=(e,t)=>{var s;return(null===(s=e.title)||void 0===s?void 0:s.localeCompare(t.title||""))||-1},Ke=(e,t,s)=>{if(e&&e.length){if(s===Ze.VERSION){const s=We()(e,"Version");return Object.keys(s).map((e=>{const n=s[e].filter((({Tenants:e})=>Boolean(e))),r=We()(n,"Tenants"),a=Object.keys(r).map((e=>({title:e,nodes:r[e]}))).sort(Qe);return a.length?{title:e,items:a,versionColor:null===t||void 0===t?void 0:t.get((0,Fe.U)(e))}:null})).filter((e=>Boolean(e)))}{const s=e.filter((({Tenants:e})=>Boolean(e))),n=We()(s,"Tenants");return Object.keys(n).map((e=>{const s=Ye(n[e],t),r=We()(n[e],"Version"),a=Object.keys(r).map((e=>({title:e,nodes:r[e],versionColor:null===t||void 0===t?void 0:t.get((0,Fe.U)(e))})));return a.length?{title:e,items:a,versionsValues:s}:null})).filter((e=>Boolean(e))).sort(Qe)}}},Xe=(e,t)=>{if(!e||!e.length)return;const s=e.filter((({Roles:e})=>null===e||void 0===e?void 0:e.includes("Storage"))),n=We()(s,"Version");return Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:null===t||void 0===t?void 0:t.get((0,Fe.U)(e))})))},et=(e,t)=>{if(!e||!e.length)return;const s=e.filter((({Roles:e,Version:t})=>!e&&t)),n=We()(s,"Version");return Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:null===t||void 0===t?void 0:t.get((0,Fe.U)(e))})))},tt=JSON.parse('{"title_overall":"Overall","title_storage":"Storage nodes","title_database":"Database nodes","title_other":"Other nodes"}'),st=(0,k.g4)("ydb-versions",{en:tt});var nt=s(44992),rt=s(39567),at=s(98730),lt=s(40537),ot=s(66592);const it=({cluster:e,versionToColor:t,clusterLoading:s})=>{const{currentData:r}=Ee.s.useGetNodesQuery((0,at.L)(e)||s?nt.hT:{tablets:!1,fieldsRequired:["SystemState","SubDomainKey"],group:"Version"});return n.useMemo((()=>{if((0,at.L)(e)&&e.MapVersions){return qe(Object.entries(e.MapVersions).map((([e,t])=>({name:e,count:t}))),t,e.NodesTotal)}return r?Array.isArray(r.NodeGroups)?qe(r.NodeGroups,t,null===e||void 0===e?void 0:e.NodesTotal):Ye(r.Nodes,t):[]}),[r,t,e])};function ct(e){const t=function(){const[e]=(0,i.useQueryParam)("clusterName",i.StringParam),t=(0,M.N4)((e=>e.singleClusterMode)),{data:s}=rt.ub.useGetClustersListQuery(void 0,{skip:t});return n.useMemo((()=>{if(t)return;const n=(s||[]).find((t=>t.name===e)),r=(null===n||void 0===n?void 0:n.versions)||[];return()=>(0,lt.Vm)((0,lt.HD)(r))}),[t,s,e])}();return n.useMemo((()=>t?t():(0,ot._n)(null===e||void 0===e?void 0:e.Versions)),[null===e||void 0===e?void 0:e.Versions,t])}const dt=(0,g.cn)("ydb-versions");function ut({cluster:e,loading:t}){const[s]=(0,M.Nt)(),{currentData:n,isLoading:r}=Ee.s.useGetNodesQuery({tablets:!1,fieldsRequired:["SystemState","SubDomainKey"]},{pollingInterval:s}),a=ct(),l=it({cluster:e,versionToColor:a,clusterLoading:t});return(0,b.jsx)(Te.r,{loading:t||r,children:(0,b.jsx)(mt,{versionsValues:l,nodes:null===n||void 0===n?void 0:n.Nodes,versionToColor:a})})}function mt({versionsValues:e,nodes:t,versionToColor:s}){const[r,a]=n.useState(Ze.VERSION),[l,o]=n.useState(!1),i=e=>{a(e)},c=Ke(t,s,r),d=Xe(t,s),u=et(t,s),m=null!==d&&void 0!==d&&d.length?(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)("h4",{children:st("title_storage")}),d.map((({title:e,nodes:t,items:s,versionColor:n})=>(0,b.jsx)(Be,{title:e,nodes:t,items:s,versionColor:n},`storage-nodes-${e}`)))]}):null,h=null!==c&&void 0!==c&&c.length?(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)("h4",{children:st("title_database")}),(0,b.jsxs)("div",{className:dt("controls"),children:[(0,b.jsxs)("div",{className:dt("group"),children:[(0,b.jsx)("span",{className:dt("label"),children:"Group by:"}),(0,b.jsxs)(Ce.a,{value:r,onUpdate:i,children:[(0,b.jsx)(Ce.a.Option,{value:Ze.TENANT,children:Ze.TENANT}),(0,b.jsx)(Ce.a.Option,{value:Ze.VERSION,children:Ze.VERSION})]})]}),(0,b.jsx)(Se.S,{className:dt("checkbox"),onChange:()=>o((e=>!e)),checked:l,children:"All expanded"})]}),c.map((({title:e,nodes:t,items:s,versionColor:n,versionsValues:r})=>(0,b.jsx)(Be,{title:e,nodes:t,items:s,expanded:l,versionColor:n,versionsValues:r},`tenant-nodes-${e}`)))]}):null,v=null!==u&&void 0!==u&&u.length?(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)("h4",{children:st("title_other")}),u.map((({title:e,nodes:t,items:s,versionColor:n,versionsValues:r})=>(0,b.jsx)(Be,{title:e,nodes:t,items:s,versionColor:n,versionsValues:r},`other-nodes-${e}`)))]}):null,g=(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)("h4",{children:st("title_overall")}),(0,b.jsx)("div",{className:dt("overall-wrapper"),children:(0,b.jsx)(Le,{progressClassName:dt("overall-progress"),versionsValues:e.filter((e=>"unknown"!==e.title)),size:"m"})})]});return(0,b.jsxs)("div",{className:dt(),children:[g,m,h,v]})}var ht=s(79522),vt=s(98089),gt=s(33705),pt=s(7435),xt=s(80967),jt=s(42655);const Nt=JSON.parse('{"erasure":"Erasure","allocated":"Allocated","available":"Available","usage":"Usage","label_nodes-state":"Nodes state","label_dc":"Nodes data centers","links":"Links","link_cores":"Coredumps","link_logging":"Logging","link_slo-logs":"SLO Logs","context_cores":"cores","title_cpu":"CPU","title_storage":"Storage","title_storage-groups":"Storage Groups","title_memory":"Memory","title_network":"Network","title_links":"Links","title_details":"Details","label_overview":"Overview","label_load":"Load","context_of":"of","context_cpu":"CPU load","context_memory":"Memory used","context_storage":["Storage: {{count}} group","Storage: {{count}} groups","Storage: {{count}} groups","Storage: {{count}} groups"],"context_network":"Network Evaluation","context_cpu-description":"CPU load is calculated as the cumulative usage across all actor system pools on all nodes in the cluster","context_memory-description":"Memory usage is the total memory consumed by all nodes in the cluster","context_storage-description":"Storage usage is a cumulative usage of raw disk space of all media types","context_network-description":"Network usage is the average outgoing bandwidth usage across all nodes in the cluster"}'),ft=(0,k.g4)("ydb-cluster",{en:Nt});var yt=s(87842);const bt=(0,g.cn)("cluster-info");var wt=s(41650);function _t(){const{cores:e,logging:t}=(0,D.Zd)();return n.useMemo((()=>{const s=[],n=function(e){try{const t=(0,wt.qF)(e);if(t&&"object"===typeof t&&"url"in t&&"string"===typeof t.url)return t.url}catch{}}(e),{logsUrl:r,sloLogsUrl:a}=function(e){try{const t=(0,wt.qF)(e);if(t&&"object"===typeof t){return{logsUrl:"url"in t&&"string"===typeof t.url?t.url:void 0,sloLogsUrl:"slo_logs_url"in t&&"string"===typeof t.slo_logs_url?t.slo_logs_url:void 0}}}catch{}return{}}(t);return n&&s.push({title:ft("link_cores"),url:n}),r&&s.push({title:ft("link_logging"),url:r}),a&&s.push({title:ft("link_slo-logs"),url:a}),s}),[e,t])}var kt=s(15132);const Ct=({tags:e,className:t="",gap:s=1})=>(0,b.jsx)(m.s,{className:t,gap:s,wrap:"wrap",alignItems:"center",children:e&&e.map(((e,t)=>(0,b.jsx)(u.J,{size:"s",children:e},t)))});var St=s(46549),Tt=s(35736);const Et=(0,g.cn)("ydb-disk-groups-stats"),Vt={good:"success",warning:"warning",danger:"danger"};function Ot({stats:e,storageType:t}){const{erasure:s,allocatedSize:n,availableSize:r}=e,a=(0,St.fn)(Math.max(n,r)),l=(0,St.z3)({value:n,size:a}),o=(0,St.z3)({value:r,size:a}),i=Math.floor(n/(n+r)*100),c=[{name:ft("erasure"),content:s},{name:ft("allocated"),content:l},{name:ft("available"),content:o},{name:ft("usage"),content:(0,b.jsxs)(m.s,{gap:2,alignItems:"center",children:[(0,b.jsx)(Ve.k,{theme:Vt[(0,Tt.w)({fillWidth:i})],className:Et("progress"),value:i,size:"s"}),(0,b.jsxs)(vt.E,{color:"secondary",children:[i,"%"]})]})}];return(0,b.jsxs)(m.s,{direction:"column",gap:3,className:Et(),children:[(0,b.jsxs)(vt.E,{variant:"body-2",children:[t," ",(0,b.jsx)(vt.E,{color:"secondary",variant:"body-2",children:`${(0,fe.ZV)(e.createdGroups)} ${ft("context_of")} ${(0,fe.ZV)(e.totalGroups)}`})]}),(0,b.jsx)(te.u,{nameMaxWidth:160,children:c.map((({name:e,content:t})=>(0,b.jsx)(te.u.Item,{name:e,children:t},e)))})]})}const Lt={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},At=(e,t)=>{var s;const r=[],a=(e=>{if((0,at.L)(e)&&e.MapDataCenters)return Object.entries(e.MapDataCenters).map((([e,t])=>(0,b.jsxs)(n.Fragment,{children:[e," : ",(0,fe.ZV)(t)]},e)))})(e);if(null!==a&&void 0!==a&&a.length&&r.push({label:ft("label_dc"),value:(0,b.jsx)(Ct,{tags:a,gap:2,className:bt("dc")})}),(0,at.L)(e)&&e.MapNodeStates){const t=Object.entries(e.MapNodeStates);t.sort(((e,t)=>Lt[t[0]]-Lt[e[0]]));const s=t.map((([e,t])=>(0,b.jsx)(L.Label,{withStatusName:!1,status:e,size:"s",iconSize:12,children:(0,fe.ZV)(t)},e)));r.push({label:ft("label_nodes-state"),value:(0,b.jsx)(m.s,{gap:2,children:s})})}return r.push({label:ft("label_load"),value:(0,b.jsx)(kt.O,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null!==(s=null===e||void 0===e?void 0:e.RealNumberOfCpus)&&void 0!==s?s:null===e||void 0===e?void 0:e.NumberOfCpus})}),r.push(...t),r};const Gt=({cluster:e,loading:t,error:s,additionalClusterProps:n={},groupStats:r={}})=>{const{info:a=[],links:l=[]}=n,o=_t(),i=l.concat(o),c=At(null!==e&&void 0!==e?e:{},a),d=()=>t?(0,b.jsx)(jt.y,{className:bt("skeleton"),rows:4}):s&&!e?null:(0,b.jsxs)(te.u,{nameMaxWidth:200,children:[c.map((({label:e,value:t})=>(0,b.jsx)(te.u.Item,{name:e,children:t},e))),i.length>0&&(0,b.jsx)(te.u.Item,{name:ft("title_links"),children:(0,b.jsx)(m.s,{direction:"column",gap:2,children:i.map((({title:e,url:t})=>(0,b.jsx)(ae.K,{title:e,url:t},e)))})})]}),u=(0,yt.lq)(r);return(0,b.jsxs)(m.s,{gap:4,direction:"column",className:bt(),children:[s?(0,b.jsx)(q.o,{error:s,className:bt("error")}):null,(0,b.jsxs)(zt,{children:[(0,b.jsx)(vt.E,{as:"div",variant:"subheader-2",className:bt("section-title"),children:ft("title_details")}),d()]}),(()=>{const e=function(e){const t=[];return Object.entries(e).forEach((([e,s])=>{Object.values(s).forEach((s=>{t.push((0,b.jsx)(Ot,{stats:s,storageType:e},`${e}|${s.erasure}`))}))})),t}(r);return t?null:(0,b.jsxs)(zt,{children:[(0,b.jsxs)(vt.E,{as:"div",variant:"subheader-2",className:bt("section-title"),children:[ft("title_storage-groups")," ",(0,b.jsx)(vt.E,{variant:"subheader-2",color:"secondary",children:(0,fe.ZV)(u)})]}),(0,b.jsx)(m.s,{gap:2,children:e})]})})()]})};function zt({children:e}){return(0,b.jsx)(m.s,{direction:"column",gap:3,children:e})}const Dt=(0,g.cn)("ydb-doughnut-metrics");function It({status:e,fillWidth:t,children:s,className:n}){let r=3.6*t,a="var(--doughnut-color)",l="var(--doughnut-backdrop-color)";return r>360&&(r-=360,l="var(--doughnut-color)",a="var(--doughnut-overlap-color)"),(0,b.jsx)("div",{className:Dt(null,n),children:(0,b.jsx)("div",{style:{background:`conic-gradient(${a} 0deg ${r}deg, ${l} ${r}deg 360deg)`},className:Dt("doughnut",{status:e}),children:(0,b.jsx)("div",{className:Dt("text-wrapper"),children:s})})})}It.Legend=function({children:e,variant:t="subheader-3",color:s="primary",note:n}){return(0,b.jsxs)(m.s,{gap:1,alignItems:"center",children:[(0,b.jsx)(vt.E,{variant:t,color:s,className:Dt("legend"),as:"div",children:e}),n&&(0,b.jsx)(h.H,{className:Dt("legend-note"),children:n})]})},It.Value=function({children:e,variant:t="subheader-2"}){return(0,b.jsx)(vt.E,{variant:t,className:Dt("value"),children:e})};var Mt=s(70043);const $t=(0,g.cn)("ydb-cluster-dashboard"),Rt={good:v.m.Green,warning:v.m.Yellow,danger:v.m.Red};function Pt({children:e,className:t,collapsed:s}){return(0,b.jsx)(m.s,{gap:"6",alignItems:"center",className:$t("card",{collapsed:s},t),children:e})}function Bt({title:e,children:t,legend:s,collapsed:n,...r}){const{main:a,secondary:l,note:o}=s;if(n){const{status:t,fillWidth:s}=r,n=s.toFixed(s>0?0:1);return(0,b.jsx)(L.Label,{withStatusName:!1,status:Rt[t],children:`${e} : ${n}%`})}return(0,b.jsxs)(Pt,{children:[(0,b.jsx)(It,{...r,children:t}),(0,b.jsxs)("div",{className:$t("legend-wrapper"),children:[a&&(0,b.jsx)(It.Legend,{children:a}),l&&(0,b.jsx)(It.Legend,{color:"secondary",note:o,variant:"body-1",children:l})]})]})}function Ut({collapsed:e}){return(0,b.jsx)(Pt,{className:$t("skeleton-wrapper"),collapsed:e,children:(0,b.jsx)(Mt.E,{className:$t("skeleton")})})}function Wt({collapsed:e}){return(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)(Ut,{collapsed:e}),(0,b.jsx)(Ut,{collapsed:e}),(0,b.jsx)(Ut,{collapsed:e})]})}function Ft({colorizeProgress:e=!0,warningThreshold:t,dangerThreshold:s,inverseColorize:n=!1,fillWidth:r}){const a=Math.max(r,.5);return{status:(0,Tt.w)({fillWidth:r,warningThreshold:t,dangerThreshold:s,colorizeProgress:e,inverseColorize:n}),percents:(0,fe.l9)(r/100),fill:a}}function Jt({value:e,capacity:t,legendFormatter:s,...n}){const r=parseFloat(String(e)),a=parseFloat(String(t));let l=r/a*100||0;l=l>100?100:l;const o=s({value:r,capacity:a});return{...Ft({fillWidth:l,...n}),legend:o}}function Yt({value:e,capacity:t}){let s=[];return s=t<1e4?[(0,fe.ZV)(Math.round(e)),(0,fe.ZV)(Math.round(t))]:(0,fe.Nd)(e,t,void 0,"",!0),`${s[0]} ${ft("context_of")} ${s[1]} ${ft("context_cores")}`}function qt({collapsed:e,value:t,capacity:s,...n}){const{status:r,percents:a,legend:l,fill:o}=Jt({value:t,capacity:s,legendFormatter:Yt,...n});return(0,b.jsx)(Bt,{collapsed:e,status:r,fillWidth:o,title:ft("title_cpu"),legend:{main:l,secondary:ft("context_cpu"),note:ft("context_cpu-description")},children:(0,b.jsx)(It.Value,{children:a})})}function Ht({value:e,capacity:t}){const s=(0,fe.j9)(e,t,void 0,"\n");return`${s[0]} ${ft("context_of")} ${s[1]}`}function Zt({value:e,capacity:t,collapsed:s,...n}){const{status:r,percents:a,legend:l,fill:o}=Jt({value:e,capacity:t,legendFormatter:Ht,...n});return(0,b.jsx)(Bt,{status:r,fillWidth:o,title:ft("title_memory"),collapsed:s,legend:{main:l,secondary:ft("context_memory"),note:ft("context_memory-description")},children:(0,b.jsx)(It.Value,{children:a})})}function Qt({percentsValue:e,throughput:t,collapsed:s,...n}){const[r]=(0,xt.i)(he._X);if(!r)return null;const{status:a,percents:l,fill:o}=Ft({fillWidth:100*e,...n}),i=(c=t,(0,St.z3)({value:c,withSpeedLabel:!0}));var c;return(0,b.jsx)(Bt,{status:a,fillWidth:o,title:ft("title_network"),collapsed:s,legend:{main:i,secondary:ft("context_network"),note:ft("context_network-description")},children:(0,b.jsx)(It.Value,{children:l})})}function Kt({value:e,capacity:t}){const s=(0,fe.j9)(e,t,void 0,"\n");return`${s[0]} ${ft("context_of")} ${s[1]}`}function Xt({value:e,capacity:t,groups:s,collapsed:n,...r}){const{status:a,percents:l,legend:o,fill:i}=Jt({value:e,capacity:t,legendFormatter:Kt,...r});return(0,b.jsx)(Bt,{status:a,fillWidth:i,title:ft("title_storage"),collapsed:n,legend:{main:o,secondary:ft("context_storage",{count:s}),note:ft("context_storage-description")},children:(0,b.jsx)(It.Value,{children:l})})}var es;function ts(){return ts=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)({}).hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},ts.apply(null,arguments)}const ss=function(e){return n.createElement("svg",ts({viewBox:"0 0 16 15"},e),es||(es=n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.98 1.826a.75.75 0 00-.96-1.152L10.376 3.71a1.25 1.25 0 01-1.196.225l-2.155-.718a2.75 2.75 0 00-2.973.837L.926 7.767a.75.75 0 101.148.966l3.125-3.712a1.25 1.25 0 011.352-.38l2.155.718a2.75 2.75 0 002.63-.496l3.644-3.037zM13.5 8h-2a.5.5 0 00-.5.5V13a.5.5 0 00.5.5h2a.5.5 0 00.5-.5V8.5a.5.5 0 00-.5-.5zm-4 5a.5.5 0 01-.5.5H7a.5.5 0 01-.5-.5v-2.5A.5.5 0 017 10h2a.5.5 0 01.5.5V13zM5 13a.5.5 0 01-.5.5h-2A.5.5 0 012 13v-.5a.5.5 0 01.5-.5h2a.5.5 0 01.5.5v.5zm-2.5 2h11a2 2 0 002-2V8.5a2 2 0 00-2-2h-2a2 2 0 00-2 2v.063A2.004 2.004 0 009 8.5H7a2 2 0 00-2 2v.063a2.005 2.005 0 00-.5-.063h-2a2 2 0 00-2 2v.5a2 2 0 002 2z",fill:"currentColor"})))};function ns(e){const[t,s]=(0,xt.i)(he.zU);return e.error?(0,b.jsx)(q.o,{error:e.error,className:$t("error")}):(0,b.jsx)(m.s,{direction:"column",className:$t("overview-wrapper",{collapsed:!t}),children:(0,b.jsxs)(ht.E,{arrowPosition:"end",expanded:t,onUpdate:()=>s(!t),children:[(0,b.jsx)(ht.E.Summary,{children:s=>(0,b.jsxs)("div",{...s,className:$t("disclosure-summary"),children:[(0,b.jsxs)(m.s,{alignItems:"center",justifyContent:"space-between",width:"100%",children:[(0,b.jsxs)(m.s,{gap:2,alignItems:"center",children:[(0,b.jsx)(y.I,{data:ss,size:16}),(0,b.jsx)(vt.E,{variant:"body-2",color:"primary",className:$t("title"),children:ft("label_overview")})]}),!t&&(0,b.jsx)(rs,{...e,collapsed:!0})]}),(0,b.jsx)(gt.I,{size:16,direction:s.expanded?"top":"bottom"})]})}),(0,b.jsx)(rs,{...e}),(0,b.jsx)(Gt,{...e})]})})}function rs({collapsed:e,...t}){return(0,z.fp)()?(0,b.jsx)(m.s,{wrap:!0,className:$t("dashboard-wrapper",{collapsed:e}),children:(0,b.jsx)(as,{...t,collapsed:e})}):null}function as({cluster:e,groupStats:t={},loading:s,collapsed:n}){if(s)return(0,b.jsx)(Wt,{collapsed:n});const r=[];if((0,at.L)(e)){const{CoresUsed:t,NumberOfCpus:s,CoresTotal:a}=e,l=null!==a&&void 0!==a?a:s;(0,pt.f8)(t)&&(0,pt.f8)(l)&&r.push((0,b.jsx)(qt,{value:t,capacity:l,collapsed:n},"cores"))}const{StorageTotal:a,StorageUsed:l}=e;if((0,pt.f8)(a)&&(0,pt.f8)(l)){const e=(0,yt.lq)(t);r.push((0,b.jsx)(Xt,{value:l,capacity:a,groups:e,collapsed:n},"storage"))}const{MemoryTotal:o,MemoryUsed:i}=e;if((0,pt.f8)(o)&&(0,pt.f8)(i)&&r.push((0,b.jsx)(Zt,{value:i,capacity:o,collapsed:n},"memory")),(0,at.E)(e)){const{NetworkUtilization:t,NetworkWriteThroughput:s}=e;(0,pt.f8)(t)&&r.push((0,b.jsx)(Qt,{percentsValue:t,throughput:s,collapsed:n},"network"))}return r}const ls=(0,g.cn)("ydb-cluster");function os({additionalClusterProps:e,additionalTenantsProps:t,additionalNodesProps:s}){const d=n.useRef(null),u=(0,z.fp)(),m=(0,M.YQ)(),h=function(){const e=(0,M.YQ)(),t=(0,M.N4)((e=>e.cluster.defaultClusterTab)),s=(0,o.W5)(G.Ay.cluster),{activeTab:r}=(null===s||void 0===s?void 0:s.params)||{};let a;a=(0,yt.eC)(r)?r:t;return n.useEffect((()=>{a!==t&&e((0,D.Yv)(a))}),[a,t,e]),a}(),[{clusterName:g,backend:p}]=(0,i.useQueryParams)({clusterName:i.StringParam,backend:i.StringParam}),x=(0,M.N4)((e=>(0,D.zR)(e,null!==g&&void 0!==g?g:void 0))),{title:j}=(0,D.Zd)(),N=null!==j&&void 0!==j?j:x,{data:{clusterData:f,groupsStats:y}={},isLoading:w,error:_}=D.Zh.useGetClusterInfoQuery(null!==g&&void 0!==g?g:void 0),k=_&&"object"===typeof _?_:void 0,C=(0,M.N4)((e=>(0,D.ds)(e,null!==g&&void 0!==g?g:void 0)));n.useEffect((()=>{m((0,I.g)("cluster",{}))}),[m]);const S=n.useMemo((()=>yt.bn.find((({id:e})=>e===h))),[h]);return(0,b.jsxs)("div",{className:ls(),ref:d,children:[(0,b.jsx)(l.mg,{defaultTitle:`${N} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${N} \u2014 YDB Monitoring`,children:S?(0,b.jsx)("title",{children:S.title}):null}),(0,b.jsx)("div",{className:ls("header"),children:(()=>{if(w)return(0,b.jsx)(r.E,{className:ls("title-skeleton")});const e=(null===f||void 0===f?void 0:f.Overall)||v.m.Grey;return(0,b.jsxs)(L,{className:ls("title"),children:[N,(0,b.jsx)(L.Label,{status:e,note:T[e]})]})})()}),(0,b.jsx)("div",{className:ls("sticky-wrapper"),children:(0,b.jsx)(c.E,{className:ls("auto-refresh-control")})}),u&&(0,b.jsx)(ns,{cluster:null!==f&&void 0!==f?f:{},groupStats:y,loading:w,error:k||(null===f||void 0===f?void 0:f.error),additionalClusterProps:e}),(0,b.jsx)("div",{className:ls("tabs-sticky-wrapper"),children:(0,b.jsx)(a.t,{size:"l",allowNotSelected:!0,activeTab:h,items:yt.bn,wrapTo:({id:e},t)=>{const s=(0,yt.a)(e,{clusterName:g,backend:p});return(0,b.jsx)(A.E,{to:s,onClick:()=>{m((0,D.Yv)(e))},children:t},e)}})}),(0,b.jsxs)(o.dO,{children:[(0,b.jsx)(o.qh,{path:(0,G.a3)((0,yt.a)(yt.Bi.tablets)).pathname,children:(0,b.jsx)(P.Q,{loading:w,tablets:C})}),(0,b.jsx)(o.qh,{path:(0,G.a3)((0,yt.a)(yt.Bi.tenants)).pathname,children:(0,b.jsx)(ke,{additionalTenantsProps:t})}),(0,b.jsx)(o.qh,{path:(0,G.a3)((0,yt.a)(yt.Bi.nodes)).pathname,children:(0,b.jsx)($.G,{parentRef:d,additionalNodesProps:s})}),(0,b.jsx)(o.qh,{path:(0,G.a3)((0,yt.a)(yt.Bi.storage)).pathname,children:(0,b.jsx)(R.z,{parentRef:d})}),(0,b.jsx)(o.qh,{path:(0,G.a3)((0,yt.a)(yt.Bi.versions)).pathname,children:(0,b.jsx)(ut,{cluster:f,loading:w})}),(0,b.jsx)(o.qh,{render:()=>(0,b.jsx)(o.rd,{to:(0,G.a3)((0,yt.a)(h))})})]})]})}},42655:(e,t,s)=>{s.d(t,{y:()=>d});var n=s(59284),r=s(89169),a=s(77506),l=s(66781),o=s(60712);const i=(0,a.cn)("ydb-info-viewer-skeleton"),c=()=>(0,o.jsxs)("div",{className:i("label"),children:[(0,o.jsx)(r.E,{className:i("label__text")}),(0,o.jsx)("div",{className:i("label__dots")})]}),d=({rows:e=8,className:t,delay:s=600})=>{const[a]=(0,l.y)(s);let d=(0,o.jsxs)(n.Fragment,{children:[(0,o.jsx)(c,{}),(0,o.jsx)(r.E,{className:i("value")})]});return a||(d=null),(0,o.jsx)("div",{className:i(null,t),children:[...new Array(e)].map(((e,t)=>(0,o.jsx)("div",{className:i("row"),children:d},`skeleton-row-${t}`)))})}},70043:(e,t,s)=>{s.d(t,{E:()=>l});var n=s(89169),r=s(66781),a=s(60712);const l=({delay:e=600,className:t})=>{const[s]=(0,r.y)(e);return s?(0,a.jsx)(n.E,{className:t}):null}}}]);