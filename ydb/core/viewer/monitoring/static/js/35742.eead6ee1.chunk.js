"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[35742],{7701:(e,t,s)=>{s.r(t),s.d(t,{Cluster:()=>ds});var n=s(59284),r=s(89169),l=s(23871),a=s(61750),o=s(10755),i=s(80987),c=s(90053),d=s(60865),u=s(47665),m=s(87184),h=s(98934),v=s(54090),g=s(77506),p=s(43937),x=s(36388),j=s(94420),f=s(70825),N=s(49917),y=s(99991),b=s(60712);const w={[v.m.Blue]:p.A,[v.m.Yellow]:x.A,[v.m.Orange]:j.A,[v.m.Red]:x.A,[v.m.Green]:f.A,[v.m.Grey]:N.A};function _({status:e,...t}){return e?(0,b.jsx)(y.I,{...t,data:w[e]}):null}var C=s(48372);const k=JSON.parse('{"title_red":"Critical","title_blue":"Normal","title_green":"Good","title_grey":"Unknown","title_orange":"Caution","title_yellow":"Warning","context_red":"Some systems are failed and not available","context_yellow":"There are minor issues","context_orange":"Critical state, requires immediate attention","context_green":"Everything is working as expected","context_grey":"The condition cannot be determined","context_blue":"All good, some parts of the system are restoring"}'),S=(0,C.g4)("ydb-entity-status",{en:k}),E={get[v.m.Red](){return S("context_red")},get[v.m.Yellow](){return S("context_yellow")},get[v.m.Orange](){return S("context_orange")},get[v.m.Green](){return S("context_green")},get[v.m.Grey](){return S("context_grey")},get[v.m.Blue](){return S("context_blue")}},T=(0,g.cn)("ydb-entity-status-new"),V={[v.m.Red]:"danger",[v.m.Blue]:"info",[v.m.Green]:"success",[v.m.Grey]:"unknown",[v.m.Orange]:"orange",[v.m.Yellow]:"warning"},D={get[v.m.Red](){return S("title_red")},get[v.m.Yellow](){return S("title_yellow")},get[v.m.Orange](){return S("title_orange")},get[v.m.Green](){return S("title_green")},get[v.m.Grey](){return S("title_grey")},get[v.m.Blue](){return S("title_blue")}};function O({className:e,children:t}){return(0,b.jsx)(m.s,{gap:"2",wrap:"nowrap",alignItems:"center",className:T(null,e),children:t})}O.Label=function({children:e,status:t,withStatusName:s=!0,note:n,size:r="m",iconSize:l=14}){const a=V[t];return(0,b.jsx)(d.m,{title:E[t],disabled:Boolean(n),children:(0,b.jsx)(u.J,{theme:"orange"===a?void 0:a,icon:(0,b.jsx)(_,{size:l,status:t}),size:r,className:T({orange:"orange"===a}),children:(0,b.jsxs)(m.s,{gap:"2",wrap:"nowrap",children:[e,s?D[t]:null,n&&(0,b.jsx)(h.H,{children:n})]})})})},O.displayName="EntityStatus";var A=s(44294),L=s(92459),G=s(67028),z=s(67157),I=s(40174),M=s(90182),R=s(11363),B=s(47199),$=s(88616),P=s(93381),U=s(65872),W=s(64470),F=s(4557),J=s(84476),H=s(40569),Y=s(28539),q=s(44508),Z=s(78524),Q=s(48295),K=s(9252),X=s(17594),ee=s(95963),te=s(69326),se=s(23900),ne=s(54309),re=s(12888),le=s(10508),ae=s(25196);const oe=JSON.parse('{"field_links":"Links","field_monitoring-link":"Monitoring","field_logs-link":"Logs","context_unknown":"unknown database"}'),ie=(0,C.g4)("ydb-tenant-name-wrapper",{en:oe});function ce({tenant:e,additionalTenantsProps:t}){var s,n;const r=(0,re.X)(),l=((e,t)=>{var s;if("function"!==typeof(null===t||void 0===t?void 0:t.prepareTenantBackend))return;let n;const r=null!==(s=e.NodeIds)&&void 0!==s?s:e.sharedNodeIds;r&&r.length>0&&(n=r[Math.floor(Math.random()*r.length)].toString());return t.prepareTenantBackend(n)})(e,t),a=Boolean(l),o=null===t||void 0===t||null===(s=t.getMonitoringLink)||void 0===s?void 0:s.call(t,e.Name,e.Type),i=null===t||void 0===t||null===(n=t.getLogsLink)||void 0===n?void 0:n.call(t,e.Name),c=(o||i)&&r?(0,b.jsx)(se.u,{responsive:!0,children:(0,b.jsx)(se.u.Item,{name:ie("field_links"),children:(0,b.jsxs)(m.s,{gap:2,wrap:"wrap",children:[o&&(0,b.jsx)(ae.K,{title:ie("field_monitoring-link"),url:o}),i&&(0,b.jsx)(ae.K,{title:ie("field_logs-link"),url:i})]})})}):null;return(0,b.jsx)(le.c,{externalLink:a,name:e.Name||ie("context_unknown"),withLeftTrim:!0,status:e.Overall,infoPopoverContent:c,hasClipboardButton:!0,path:(0,ne.YL)({database:e.Name,backend:l},{withBasename:a})})}var de=s(88610),ue=s(53850),me=s(23536),he=s.n(me),ve=s(76086),ge=s(56674);const pe=(0,ue.Mz)((e=>e),(e=>ge.GJ.endpoints.getTenantsInfo.select({clusterName:e}))),xe=(0,ue.Mz)((e=>e),((e,t)=>pe(t)),(e=>(0,de.CN)(e,ve.Xm)),((e,t,s)=>{var n;const r=null!==(n=t(e).data)&&void 0!==n?n:[];return!s&&r.length>1?r.filter((e=>"Domain"!==e.Type)):r})),je=e=>e.tenants.searchValue,fe=(0,ue.Mz)([xe,de.yV,je],((e,t,s)=>{let n=((e,t)=>t===de.s$.ALL?e:e.filter((e=>e.Overall&&e.Overall!==v.m.Green)))(e,t);return n=((e,t)=>e.filter((e=>{const s=new RegExp(he()(t),"i");return s.test(e.Name||"")||s.test(e.controlPlaneName)})))(n,s),n}));var Ne=s(51114),ye=s(56839),be=s(28232);const we=JSON.parse('{"create-database":"Create database","remove":"Remove","edit":"Edit"}'),_e=(0,C.g4)("ydb-tenants-table",{en:we}),Ce=(0,g.cn)("tenants"),ke=({additionalTenantsProps:e,scrollContainerRef:t})=>{const s=(0,M.YQ)(),r=(0,be.H)(),[l]=(0,M.Nt)(),{currentData:a,isFetching:o,error:i}=ge.GJ.useGetTenantsInfoQuery({clusterName:r},{pollingInterval:l}),c=o&&void 0===a,[d,u]=n.useState(),m=(0,G.sH)()&&void 0!==Ne.J.onCreateDB,h=(0,G.g7)()&&void 0!==Ne.J.onEditDB,v=(0,G.TW)()&&void 0!==Ne.J.onDeleteDB,g=(0,M.N4)((e=>xe(e,r))),p=(0,M.N4)(je),x=(0,M.N4)((e=>fe(e,r))),j=(0,M.N4)(de.yV),f=e=>{s((0,de.$u)(e))},N=e=>{s((0,ge.gB)(e))};return(0,b.jsx)("div",{className:Ce("table-wrapper"),children:(0,b.jsxs)(te.L,{fullHeight:!0,children:[(0,b.jsx)(te.L.Controls,{renderExtraControls:()=>m&&r&&!c?(0,b.jsxs)(J.$,{view:"action",onClick:()=>{var e;return null===(e=Ne.J.onCreateDB)||void 0===e?void 0:e.call(Ne.J,{clusterName:r})},className:Ce("create-database"),children:[(0,b.jsx)(y.I,{data:P.A}),_e("create-database")]}):null,children:(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)(ee.v,{value:p,onChange:N,placeholder:"Database name",className:Ce("search")}),(0,b.jsx)(K.k,{value:j,onChange:f}),(0,b.jsx)(Y.T,{total:g.length,current:(null===x||void 0===x?void 0:x.length)||0,label:"Databases",loading:c})]})}),i?(0,b.jsx)(q.o,{error:i}):null,(0,b.jsx)(te.L.Table,{scrollContainerRef:t,loading:c,scrollDependencies:[p,j,d],children:a?(()=>{const t=[{name:"Name",header:"Database",render:({row:t})=>(0,b.jsx)(ce,{tenant:t,additionalTenantsProps:e}),width:440,sortable:!0,defaultOrder:F.Ay.DESCENDING},{name:"controlPlaneName",header:"Name",render:({row:e})=>e.controlPlaneName,width:200,sortable:!0,defaultOrder:F.Ay.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:({row:e})=>"Serverless"!==e.Type?e.Type:(0,b.jsxs)("div",{className:Ce("type"),children:[(0,b.jsx)("span",{className:Ce("type-value"),children:e.Type}),(0,b.jsx)(J.$,{className:Ce("type-button"),onClick:()=>N(e.sharedTenantName||""),children:"Show shared"})]})},{name:"State",width:150,render:({row:e})=>e.State?e.State.toLowerCase():"\u2014",customStyle:()=>({textTransform:"capitalize"})},{name:"cpu",header:"CPU",width:80,render:({row:e})=>e.cpu&&e.cpu>1e4?(0,ye.iM)(e.cpu):"\u2014",align:F.Ay.RIGHT,defaultOrder:F.Ay.DESCENDING},{name:"memory",header:"Memory",width:120,render:({row:e})=>e.memory?(0,ye.vX)(e.memory):"\u2014",align:F.Ay.RIGHT,defaultOrder:F.Ay.DESCENDING},{name:"storage",header:"Storage",width:120,render:({row:e})=>e.storage?(0,ye.vX)(e.storage):"\u2014",align:F.Ay.RIGHT,defaultOrder:F.Ay.DESCENDING},{name:"nodesCount",header:"Nodes",width:100,render:({row:e})=>e.nodesCount?(0,ye.ZV)(e.nodesCount):"\u2014",align:F.Ay.RIGHT,defaultOrder:F.Ay.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:({row:e})=>e.groupsCount?(0,ye.ZV)(e.groupsCount):"\u2014",align:F.Ay.RIGHT,defaultOrder:F.Ay.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:({PoolStats:e=[]})=>e.reduce(((e,t)=>e+(t.Usage||0)),0),defaultOrder:F.Ay.DESCENDING,align:F.Ay.LEFT,render:({row:e})=>(0,b.jsx)(Q._,{pools:e.PoolStats})}];if(r&&(v||h)){const e=function({clusterName:e,isEditDBAvailable:t,isDeleteDBAvailable:s}){return{name:"actions",header:"",width:40,resizeable:!1,align:F.Ay.CENTER,render:({row:n})=>{const r=[];return"Domain"===n.Type?null:(t&&r.push({text:_e("edit"),iconStart:(0,b.jsx)(U.A,{}),action:()=>{var t;null===(t=Ne.J.onEditDB)||void 0===t||t.call(Ne.J,{clusterName:e,databaseData:n})}}),s&&r.push({text:_e("remove"),iconStart:(0,b.jsx)(W.A,{}),action:()=>{var t;null===(t=Ne.J.onDeleteDB)||void 0===t||t.call(Ne.J,{clusterName:e,databaseData:n})},className:Ce("remove-db")}),r.length?(0,b.jsx)(H.r,{items:r}):null)}}}({clusterName:r,isDeleteDBAvailable:v,isEditDBAvailable:h});t.push(e)}return 0===x.length&&j!==de.s$.ALL?(0,b.jsx)(Z.v,{name:"thumbsUp",width:"200"}):(0,b.jsx)(X.l,{columnsWidthLSKey:"databasesTableColumnsWidth",data:x,columns:t,settings:ve.N3,emptyDataMessage:"No such tenants",onSortChange:u})})():null})]})})};var Se=s(44433),Ee=s(74321),Te=s(98167),Ve=s(15298),De=s(18143);const Oe=(0,g.cn)("ydb-cluster-versions-bar"),Ae=({versionsValues:e=[],size:t="s",progressClassName:s})=>(0,b.jsxs)("div",{className:Oe(),children:[(0,b.jsx)(De.k,{value:100,stack:e,size:t,className:s}),(0,b.jsx)("div",{className:Oe("versions"),children:e.map(((t,s)=>(0,b.jsx)("div",{className:Oe("version-title"),style:{color:t.color},title:t.version,children:`${t.version}${s===e.length-1?"":","}`},t.version)))})]});var Le=s(63126),Ge=s(78762),ze=s(88655);function Ie(e){return[(0,Ge._E)(),(0,Ge.Nh)(e),(0,Ge.jl)(),(0,Ge.pH)(),(0,Ge.fr)(),(0,Ge.ID)()]}const Me=({nodes:e})=>{const t=(0,ze.E)(),s=Ie({getNodeRef:null===t||void 0===t?void 0:t.getNodeRef});return(0,b.jsx)(X.l,{columnsWidthLSKey:"versionsTableColumnsWidth",data:e,columns:s,settings:ve.N3})};var Re=s(96873);const Be=(0,g.cn)("ydb-versions-nodes-tree-title"),$e=({title:e,nodes:t,items:s,versionColor:n,versionsValues:r})=>{let l;return l=s?s.reduce(((e,t)=>t.nodes?e+t.nodes.length:e),0):t?t.length:0,(0,b.jsxs)("div",{className:Be("overview"),children:[(0,b.jsxs)("div",{className:Be("overview-container"),children:[n?(0,b.jsx)("div",{className:Be("version-color"),style:{background:n}}):null,e?(0,b.jsxs)("span",{className:Be("overview-title"),children:[e,(0,b.jsx)(Re.b,{text:e,size:"s",className:Be("clipboard-button"),view:"normal"})]}):null]}),(0,b.jsxs)("div",{className:Be("overview-info"),children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:Be("info-value"),children:l}),(0,b.jsx)("span",{className:Be("info-label",{margin:"left"}),children:"Nodes"})]}),r?(0,b.jsxs)("div",{className:Be("version-progress"),children:[(0,b.jsx)("span",{className:Be("info-label",{margin:"right"}),children:"Versions"}),(0,b.jsx)(De.k,{size:"s",value:100,stack:r})]}):null]})]})},Pe=(0,g.cn)("ydb-versions-grouped-node-tree"),Ue=({title:e,nodes:t,items:s,expanded:r=!1,versionColor:l,versionsValues:a,level:o=0})=>{const[i,c]=n.useState(!1);n.useEffect((()=>{c(r)}),[r]);const d=(0,b.jsx)($e,{title:e,nodes:t,items:s,versionColor:l,versionsValues:a}),u=()=>{c((e=>!e))};return s?(0,b.jsx)("div",{className:Pe({"first-level":0===o}),children:(0,b.jsx)(Le.G,{name:d,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:s.map(((e,t)=>(0,b.jsx)(Ue,{title:e.title,nodes:e.nodes,expanded:r,versionColor:e.versionColor,level:o+1},t)))},e)}):(0,b.jsx)("div",{className:Pe({"first-level":0===o}),children:(0,b.jsx)(Le.G,{name:d,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:(0,b.jsx)("div",{className:Pe("dt-wrapper"),children:(0,b.jsx)(Me,{nodes:t||[]})})},e)})};var We=s(78018),Fe=s.n(We),Je=s(38596);const He=.5,Ye=(e=[],t)=>{const s=e.reduce(((e,t)=>(t.Version&&(e[t.Version]?e[t.Version]=e[t.Version]+1:e[t.Version]=1),e)),{});return Ze(Object.keys(s).map((n=>{const r=s[n]/e.length*100;return{title:n,version:n,color:null===t||void 0===t?void 0:t.get((0,Je.U)(n)),value:r<He?He:r}})))};function qe(e,t,s){const n=null!==s&&void 0!==s?s:e.reduce(((e,t)=>e+t.count),0);return Ze(e.map((e=>{const s=e.count/n*100;return{title:e.name,version:e.name,color:null===t||void 0===t?void 0:t.get((0,Je.U)(e.name)),value:s<He?He:s}})))}function Ze(e){let t=e[0].value,s=0,n=0;e.forEach(((e,r)=>{n+=e.value,e.value>t&&(t=e.value,s=r)}));const r=[...e];return r[s]={...e[s],value:t+100-n},r}let Qe=function(e){return e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage",e}({});const Ke=(e,t)=>{var s;return(null===(s=e.title)||void 0===s?void 0:s.localeCompare(t.title||""))||-1},Xe=(e,t,s)=>{if(e&&e.length){if(s===Qe.VERSION){const s=Fe()(e,"Version");return Object.keys(s).map((e=>{const n=s[e].filter(nt),r=Fe()(n,"Tenants"),l=Object.keys(r).map((e=>({title:e,nodes:r[e]}))).sort(Ke);return l.length?{title:e,items:l,versionColor:null===t||void 0===t?void 0:t.get((0,Je.U)(e))}:null})).filter((e=>Boolean(e)))}{const s=e.filter(nt),n=Fe()(s,"Tenants");return Object.keys(n).map((e=>{const s=Ye(n[e],t),r=Fe()(n[e],"Version"),l=Object.keys(r).map((e=>({title:e,nodes:r[e],versionColor:null===t||void 0===t?void 0:t.get((0,Je.U)(e))})));return l.length?{title:e,items:l,versionsValues:s}:null})).filter((e=>Boolean(e))).sort(Ke)}}},et=(e,t)=>{if(!e||!e.length)return;const s=e.filter(st),n=Fe()(s,"Version");return Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:null===t||void 0===t?void 0:t.get((0,Je.U)(e))})))},tt=(e,t)=>{if(!e||!e.length)return;const s=e.filter((e=>!st(e)&&!nt(e)&&e.Version)),n=Fe()(s,"Version");return Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:null===t||void 0===t?void 0:t.get((0,Je.U)(e))})))};function st(e){var t;return Boolean(null===(t=e.Roles)||void 0===t?void 0:t.includes("Storage"))}function nt(e){return Boolean(e.Tenants)}const rt=JSON.parse('{"title_overall":"Overall","title_storage":"Storage nodes","title_database":"Database nodes","title_other":"Other nodes"}'),lt=(0,C.g4)("ydb-versions",{en:rt});var at=s(44992),ot=s(39567),it=s(98730),ct=s(40537),dt=s(66592);const ut=({cluster:e,versionToColor:t,clusterLoading:s})=>{const{currentData:r}=Ve.s.useGetNodesQuery((0,it.L)(e)||s?at.hT:{tablets:!1,fieldsRequired:["SystemState","SubDomainKey"],group:"Version"});return n.useMemo((()=>{if((0,it.L)(e)&&e.MapVersions){return qe(Object.entries(e.MapVersions).map((([e,t])=>({name:e,count:t}))),t,e.NodesTotal)}return r?Array.isArray(r.NodeGroups)?qe(r.NodeGroups,t,null===e||void 0===e?void 0:e.NodesTotal):Ye(r.Nodes,t):[]}),[r,t,e])};function mt(e){const t=function(){const[e]=(0,i.useQueryParam)("clusterName",i.StringParam),t=(0,M.N4)((e=>e.singleClusterMode)),{data:s}=ot.ub.useGetClustersListQuery(void 0,{skip:t});return n.useMemo((()=>{if(t)return;const n=(s||[]).find((t=>t.name===e)),r=(null===n||void 0===n?void 0:n.versions)||[];return()=>(0,ct.Vm)((0,ct.HD)(r))}),[t,s,e])}();return n.useMemo((()=>t?t():(0,dt._n)(null===e||void 0===e?void 0:e.Versions)),[null===e||void 0===e?void 0:e.Versions,t])}const ht=(0,g.cn)("ydb-versions");function vt({cluster:e,loading:t}){const[s]=(0,M.Nt)(),{currentData:n,isLoading:r}=Ve.s.useGetNodesQuery({tablets:!1,fieldsRequired:["SystemState","SubDomainKey"]},{pollingInterval:s}),l=mt(),a=ut({cluster:e,versionToColor:l,clusterLoading:t});return(0,b.jsx)(Te.r,{loading:t||r,children:(0,b.jsx)(gt,{versionsValues:a,nodes:null===n||void 0===n?void 0:n.Nodes,versionToColor:l})})}function gt({versionsValues:e,nodes:t,versionToColor:s}){const[r,l]=n.useState(Qe.VERSION),[a,o]=n.useState(!1),i=e=>{l(e)},c=Xe(t,s,r),d=et(t,s),u=tt(t,s),m=null!==d&&void 0!==d&&d.length?(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)("h4",{children:lt("title_storage")}),d.map((({title:e,nodes:t,items:s,versionColor:n})=>(0,b.jsx)(Ue,{title:e,nodes:t,items:s,versionColor:n},`storage-nodes-${e}`)))]}):null,h=null!==c&&void 0!==c&&c.length?(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)("h4",{children:lt("title_database")}),(0,b.jsxs)("div",{className:ht("controls"),children:[(0,b.jsxs)("div",{className:ht("group"),children:[(0,b.jsx)("span",{className:ht("label"),children:"Group by:"}),(0,b.jsxs)(Se.a,{value:r,onUpdate:i,children:[(0,b.jsx)(Se.a.Option,{value:Qe.TENANT,children:Qe.TENANT}),(0,b.jsx)(Se.a.Option,{value:Qe.VERSION,children:Qe.VERSION})]})]}),(0,b.jsx)(Ee.S,{className:ht("checkbox"),onChange:()=>o((e=>!e)),checked:a,children:"All expanded"})]}),c.map((({title:e,nodes:t,items:s,versionColor:n,versionsValues:r})=>(0,b.jsx)(Ue,{title:e,nodes:t,items:s,expanded:a,versionColor:n,versionsValues:r},`tenant-nodes-${e}`)))]}):null,v=null!==u&&void 0!==u&&u.length?(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)("h4",{children:lt("title_other")}),u.map((({title:e,nodes:t,items:s,versionColor:n,versionsValues:r})=>(0,b.jsx)(Ue,{title:e,nodes:t,items:s,versionColor:n,versionsValues:r},`other-nodes-${e}`)))]}):null,g=(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)("h4",{children:lt("title_overall")}),(0,b.jsx)("div",{className:ht("overall-wrapper"),children:(0,b.jsx)(Ae,{progressClassName:ht("overall-progress"),versionsValues:e.filter((e=>"unknown"!==e.title)),size:"m"})})]});return(0,b.jsxs)("div",{className:ht(),children:[g,m,h,v]})}var pt=s(79522),xt=s(98089),jt=s(33705),ft=s(7435),Nt=s(80967),yt=s(42655);const bt=JSON.parse('{"erasure":"Erasure","allocated":"Allocated","available":"Available","usage":"Usage","label_nodes-state":"Nodes state","label_dc":"Nodes data centers","links":"Links","link_cores":"Coredumps","link_logging":"Logging","link_slo-logs":"SLO Logs","context_cores":"cores","title_cpu":"CPU","title_storage":"Storage","title_storage-groups":"Storage Groups","title_memory":"Memory","title_network":"Network","title_links":"Links","title_details":"Details","label_overview":"Overview","label_load":"Load","context_of":"of","context_cpu":"CPU load","context_memory":"Memory used","context_storage":["Storage: {{count}} group","Storage: {{count}} groups","Storage: {{count}} groups","Storage: {{count}} groups"],"context_network":"Network Evaluation","context_cpu-description":"CPU load is calculated as the cumulative usage across all actor system pools on all nodes in the cluster","context_memory-description":"Memory usage is the total memory consumed by all nodes in the cluster","context_storage-description":"Storage usage is a cumulative usage of raw disk space of all media types","context_network-description":"Network usage is the average outgoing bandwidth usage across all nodes in the cluster"}'),wt=(0,C.g4)("ydb-cluster",{en:bt});var _t=s(87842);const Ct=(0,g.cn)("cluster-info");var kt=s(41650);function St(){const{cores:e,logging:t}=(0,z.Zd)();return n.useMemo((()=>{const s=[],n=function(e){try{const t=(0,kt.qF)(e);if(t&&"object"===typeof t&&"url"in t&&"string"===typeof t.url)return t.url}catch{}}(e),{logsUrl:r,sloLogsUrl:l}=function(e){try{const t=(0,kt.qF)(e);if(t&&"object"===typeof t){return{logsUrl:"url"in t&&"string"===typeof t.url?t.url:void 0,sloLogsUrl:"slo_logs_url"in t&&"string"===typeof t.slo_logs_url?t.slo_logs_url:void 0}}}catch{}return{}}(t);return n&&s.push({title:wt("link_cores"),url:n}),r&&s.push({title:wt("link_logging"),url:r}),l&&s.push({title:wt("link_slo-logs"),url:l}),s}),[e,t])}var Et=s(15132);const Tt=({tags:e,className:t="",gap:s=1})=>(0,b.jsx)(m.s,{className:t,gap:s,wrap:"wrap",alignItems:"center",children:e&&e.map(((e,t)=>(0,b.jsx)(u.J,{size:"s",children:e},t)))});var Vt=s(46549),Dt=s(35736);const Ot=(0,g.cn)("ydb-disk-groups-stats"),At={good:"success",warning:"warning",danger:"danger"};function Lt({stats:e,storageType:t}){const{erasure:s,allocatedSize:n,availableSize:r}=e,l=(0,Vt.fn)(Math.max(n,r)),a=(0,Vt.z3)({value:n,size:l}),o=(0,Vt.z3)({value:r,size:l}),i=Math.floor(n/(n+r)*100),c=[{name:wt("erasure"),content:s},{name:wt("allocated"),content:a},{name:wt("available"),content:o},{name:wt("usage"),content:(0,b.jsxs)(m.s,{gap:2,alignItems:"center",children:[(0,b.jsx)(De.k,{theme:At[(0,Dt.w)({fillWidth:i})],className:Ot("progress"),value:i,size:"s"}),(0,b.jsxs)(xt.E,{color:"secondary",children:[i,"%"]})]})}];return(0,b.jsxs)(m.s,{direction:"column",gap:3,className:Ot(),children:[(0,b.jsxs)(xt.E,{variant:"body-2",children:[t," ",(0,b.jsx)(xt.E,{color:"secondary",variant:"body-2",children:`${(0,ye.ZV)(e.createdGroups)} ${wt("context_of")} ${(0,ye.ZV)(e.totalGroups)}`})]}),(0,b.jsx)(se.u,{nameMaxWidth:160,children:c.map((({name:e,content:t})=>(0,b.jsx)(se.u.Item,{name:e,children:t},e)))})]})}const Gt={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},zt=(e,t)=>{var s;const r=[],l=(e=>{if((0,it.L)(e)&&e.MapDataCenters)return Object.entries(e.MapDataCenters).map((([e,t])=>(0,b.jsxs)(n.Fragment,{children:[e," : ",(0,ye.ZV)(t)]},e)))})(e);if(null!==l&&void 0!==l&&l.length&&r.push({label:wt("label_dc"),value:(0,b.jsx)(Tt,{tags:l,gap:2,className:Ct("dc")})}),(0,it.L)(e)&&e.MapNodeStates){const t=Object.entries(e.MapNodeStates);t.sort(((e,t)=>Gt[t[0]]-Gt[e[0]]));const s=t.map((([e,t])=>(0,b.jsx)(O.Label,{withStatusName:!1,status:e,size:"s",iconSize:12,children:(0,ye.ZV)(t)},e)));r.push({label:wt("label_nodes-state"),value:(0,b.jsx)(m.s,{gap:2,children:s})})}return r.push({label:wt("label_load"),value:(0,b.jsx)(Et.O,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null!==(s=null===e||void 0===e?void 0:e.RealNumberOfCpus)&&void 0!==s?s:null===e||void 0===e?void 0:e.NumberOfCpus})}),r.push(...t),r};const It=({cluster:e,loading:t,error:s,additionalClusterProps:n={},groupStats:r={}})=>{const{info:l=[],links:a=[]}=n,o=St(),i=a.concat(o),c=zt(null!==e&&void 0!==e?e:{},l),d=()=>t?(0,b.jsx)(yt.y,{className:Ct("skeleton"),rows:4}):s&&!e?null:(0,b.jsxs)(se.u,{nameMaxWidth:200,children:[c.map((({label:e,value:t})=>(0,b.jsx)(se.u.Item,{name:e,children:t},e))),i.length>0&&(0,b.jsx)(se.u.Item,{name:wt("title_links"),children:(0,b.jsx)(m.s,{direction:"column",gap:2,children:i.map((({title:e,url:t})=>(0,b.jsx)(ae.K,{title:e,url:t},e)))})})]}),u=(0,_t.lq)(r);return(0,b.jsxs)(m.s,{gap:4,direction:"column",className:Ct(),children:[s?(0,b.jsx)(q.o,{error:s,className:Ct("error")}):null,(0,b.jsxs)(Mt,{children:[(0,b.jsx)(xt.E,{as:"div",variant:"subheader-2",className:Ct("section-title"),children:wt("title_details")}),d()]}),(()=>{const e=function(e){const t=[];return Object.entries(e).forEach((([e,s])=>{Object.values(s).forEach((s=>{t.push((0,b.jsx)(Lt,{stats:s,storageType:e},`${e}|${s.erasure}`))}))})),t}(r);return t?null:(0,b.jsxs)(Mt,{children:[(0,b.jsxs)(xt.E,{as:"div",variant:"subheader-2",className:Ct("section-title"),children:[wt("title_storage-groups")," ",(0,b.jsx)(xt.E,{variant:"subheader-2",color:"secondary",children:(0,ye.ZV)(u)})]}),(0,b.jsx)(m.s,{gap:2,children:e})]})})()]})};function Mt({children:e}){return(0,b.jsx)(m.s,{direction:"column",gap:3,children:e})}const Rt=(0,g.cn)("ydb-doughnut-metrics");function Bt({status:e,fillWidth:t,children:s,className:n}){let r=3.6*t,l="var(--doughnut-color)",a="var(--doughnut-backdrop-color)";return r>360&&(r-=360,a="var(--doughnut-color)",l="var(--doughnut-overlap-color)"),(0,b.jsx)("div",{className:Rt(null,n),children:(0,b.jsx)("div",{style:{background:`conic-gradient(${l} 0deg ${r}deg, ${a} ${r}deg 360deg)`},className:Rt("doughnut",{status:e}),children:(0,b.jsx)("div",{className:Rt("text-wrapper"),children:s})})})}Bt.Legend=function({children:e,variant:t="subheader-3",color:s="primary",note:n}){return(0,b.jsxs)(m.s,{gap:1,alignItems:"center",children:[(0,b.jsx)(xt.E,{variant:t,color:s,className:Rt("legend"),as:"div",children:e}),n&&(0,b.jsx)(h.H,{className:Rt("legend-note"),children:n})]})},Bt.Value=function({children:e,variant:t="subheader-2"}){return(0,b.jsx)(xt.E,{variant:t,className:Rt("value"),children:e})};var $t=s(70043);const Pt=(0,g.cn)("ydb-cluster-dashboard"),Ut={good:v.m.Green,warning:v.m.Yellow,danger:v.m.Red};function Wt({children:e,className:t,collapsed:s}){return(0,b.jsx)(m.s,{gap:"6",alignItems:"center",className:Pt("card",{collapsed:s},t),children:e})}function Ft({title:e,children:t,legend:s,collapsed:n,...r}){const{main:l,secondary:a,note:o}=s;if(n){const{status:t,fillWidth:s}=r,n=s.toFixed(s>0?0:1);return(0,b.jsx)(O.Label,{withStatusName:!1,status:Ut[t],children:`${e} : ${n}%`})}return(0,b.jsxs)(Wt,{children:[(0,b.jsx)(Bt,{...r,children:t}),(0,b.jsxs)("div",{className:Pt("legend-wrapper"),children:[l&&(0,b.jsx)(Bt.Legend,{children:l}),a&&(0,b.jsx)(Bt.Legend,{color:"secondary",note:o,variant:"body-1",children:a})]})]})}function Jt({collapsed:e}){return(0,b.jsx)(Wt,{className:Pt("skeleton-wrapper"),collapsed:e,children:(0,b.jsx)($t.E,{className:Pt("skeleton")})})}function Ht({collapsed:e}){return(0,b.jsxs)(n.Fragment,{children:[(0,b.jsx)(Jt,{collapsed:e}),(0,b.jsx)(Jt,{collapsed:e}),(0,b.jsx)(Jt,{collapsed:e})]})}function Yt({colorizeProgress:e=!0,warningThreshold:t,dangerThreshold:s,inverseColorize:n=!1,fillWidth:r}){const l=Math.max(r,.5);return{status:(0,Dt.w)({fillWidth:r,warningThreshold:t,dangerThreshold:s,colorizeProgress:e,inverseColorize:n}),percents:(0,ye.l9)(r/100),fill:l}}function qt({value:e,capacity:t,legendFormatter:s,...n}){const r=parseFloat(String(e)),l=parseFloat(String(t));let a=r/l*100||0;a=a>100?100:a;const o=s({value:r,capacity:l});return{...Yt({fillWidth:a,...n}),legend:o}}function Zt({value:e,capacity:t}){let s=[];return s=t<1e4?[(0,ye.ZV)(Math.round(e)),(0,ye.ZV)(Math.round(t))]:(0,ye.Nd)(e,t,void 0,"",!0),`${s[0]} ${wt("context_of")} ${s[1]} ${wt("context_cores")}`}function Qt({collapsed:e,value:t,capacity:s,...n}){const{status:r,percents:l,legend:a,fill:o}=qt({value:t,capacity:s,legendFormatter:Zt,...n});return(0,b.jsx)(Ft,{collapsed:e,status:r,fillWidth:o,title:wt("title_cpu"),legend:{main:a,secondary:wt("context_cpu"),note:wt("context_cpu-description")},children:(0,b.jsx)(Bt.Value,{children:l})})}function Kt({value:e,capacity:t}){const s=(0,ye.j9)(e,t,void 0,"\n");return`${s[0]} ${wt("context_of")} ${s[1]}`}function Xt({value:e,capacity:t,collapsed:s,...n}){const{status:r,percents:l,legend:a,fill:o}=qt({value:e,capacity:t,legendFormatter:Kt,...n});return(0,b.jsx)(Ft,{status:r,fillWidth:o,title:wt("title_memory"),collapsed:s,legend:{main:a,secondary:wt("context_memory"),note:wt("context_memory-description")},children:(0,b.jsx)(Bt.Value,{children:l})})}function es({percentsValue:e,throughput:t,collapsed:s,...n}){const[r]=(0,Nt.i)(ve._X);if(!r)return null;const{status:l,percents:a,fill:o}=Yt({fillWidth:100*e,...n}),i=(c=t,(0,Vt.z3)({value:c,withSpeedLabel:!0}));var c;return(0,b.jsx)(Ft,{status:l,fillWidth:o,title:wt("title_network"),collapsed:s,legend:{main:i,secondary:wt("context_network"),note:wt("context_network-description")},children:(0,b.jsx)(Bt.Value,{children:a})})}function ts({value:e,capacity:t}){const s=(0,ye.j9)(e,t,void 0,"\n");return`${s[0]} ${wt("context_of")} ${s[1]}`}function ss({value:e,capacity:t,groups:s,collapsed:n,...r}){const{status:l,percents:a,legend:o,fill:i}=qt({value:e,capacity:t,legendFormatter:ts,...r});return(0,b.jsx)(Ft,{status:l,fillWidth:i,title:wt("title_storage"),collapsed:n,legend:{main:o,secondary:wt("context_storage",{count:s}),note:wt("context_storage-description")},children:(0,b.jsx)(Bt.Value,{children:a})})}var ns;function rs(){return rs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)({}).hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},rs.apply(null,arguments)}const ls=function(e){return n.createElement("svg",rs({viewBox:"0 0 16 15"},e),ns||(ns=n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.98 1.826a.75.75 0 00-.96-1.152L10.376 3.71a1.25 1.25 0 01-1.196.225l-2.155-.718a2.75 2.75 0 00-2.973.837L.926 7.767a.75.75 0 101.148.966l3.125-3.712a1.25 1.25 0 011.352-.38l2.155.718a2.75 2.75 0 002.63-.496l3.644-3.037zM13.5 8h-2a.5.5 0 00-.5.5V13a.5.5 0 00.5.5h2a.5.5 0 00.5-.5V8.5a.5.5 0 00-.5-.5zm-4 5a.5.5 0 01-.5.5H7a.5.5 0 01-.5-.5v-2.5A.5.5 0 017 10h2a.5.5 0 01.5.5V13zM5 13a.5.5 0 01-.5.5h-2A.5.5 0 012 13v-.5a.5.5 0 01.5-.5h2a.5.5 0 01.5.5v.5zm-2.5 2h11a2 2 0 002-2V8.5a2 2 0 00-2-2h-2a2 2 0 00-2 2v.063A2.004 2.004 0 009 8.5H7a2 2 0 00-2 2v.063a2.005 2.005 0 00-.5-.063h-2a2 2 0 00-2 2v.5a2 2 0 002 2z",fill:"currentColor"})))};function as(e){const[t,s]=(0,Nt.i)(ve.zU);return e.error?(0,b.jsx)(q.o,{error:e.error,className:Pt("error")}):(0,b.jsx)(m.s,{direction:"column",className:Pt("overview-wrapper",{collapsed:!t}),children:(0,b.jsxs)(pt.E,{arrowPosition:"end",expanded:t,onUpdate:()=>s(!t),children:[(0,b.jsx)(pt.E.Summary,{children:s=>(0,b.jsxs)("div",{...s,className:Pt("disclosure-summary"),children:[(0,b.jsxs)(m.s,{alignItems:"center",justifyContent:"space-between",width:"100%",children:[(0,b.jsxs)(m.s,{gap:2,alignItems:"center",children:[(0,b.jsx)(y.I,{data:ls,size:16}),(0,b.jsx)(xt.E,{variant:"body-2",color:"primary",className:Pt("title"),children:wt("label_overview")})]}),!t&&(0,b.jsx)(os,{...e,collapsed:!0})]}),(0,b.jsx)(jt.I,{size:16,direction:s.expanded?"top":"bottom"})]})}),(0,b.jsx)(os,{...e}),(0,b.jsx)(It,{...e})]})})}function os({collapsed:e,...t}){return(0,G.fp)()?(0,b.jsx)(m.s,{wrap:!0,className:Pt("dashboard-wrapper",{collapsed:e}),children:(0,b.jsx)(is,{...t,collapsed:e})}):null}function is({cluster:e,groupStats:t={},loading:s,collapsed:n}){if(s)return(0,b.jsx)(Ht,{collapsed:n});const r=[];if((0,it.L)(e)){const{CoresUsed:t,NumberOfCpus:s,CoresTotal:l}=e,a=null!==l&&void 0!==l?l:s;(0,ft.f8)(t)&&(0,ft.f8)(a)&&r.push((0,b.jsx)(Qt,{value:t,capacity:a,collapsed:n},"cores"))}const{StorageTotal:l,StorageUsed:a}=e;if((0,ft.f8)(l)&&(0,ft.f8)(a)){const e=(0,_t.lq)(t);r.push((0,b.jsx)(ss,{value:a,capacity:l,groups:e,collapsed:n},"storage"))}const{MemoryTotal:o,MemoryUsed:i}=e;if((0,ft.f8)(o)&&(0,ft.f8)(i)&&r.push((0,b.jsx)(Xt,{value:i,capacity:o,collapsed:n},"memory")),(0,it.E)(e)){const{NetworkUtilization:t,NetworkWriteThroughput:s}=e;(0,ft.f8)(t)&&r.push((0,b.jsx)(es,{percentsValue:t,throughput:s,collapsed:n},"network"))}return r}const cs=(0,g.cn)("ydb-cluster");function ds({additionalClusterProps:e,additionalTenantsProps:t,additionalNodesProps:s}){const d=n.useRef(null),u=(0,G.fp)(),[m]=(0,M.Nt)(),h=(0,M.YQ)(),g=function(){const e=(0,M.YQ)(),t=(0,M.N4)((e=>e.cluster.defaultClusterTab)),s=(0,o.W5)(L.Ay.cluster),{activeTab:r}=(null===s||void 0===s?void 0:s.params)||{};let l;l=(0,_t.eC)(r)?r:t;return n.useEffect((()=>{l!==t&&e((0,z.Yv)(l))}),[l,t,e]),l}(),[{clusterName:p,backend:x}]=(0,i.useQueryParams)({clusterName:i.StringParam,backend:i.StringParam}),j=(0,M.N4)((e=>(0,z.zR)(e,null!==p&&void 0!==p?p:void 0))),{title:f}=(0,z.Zd)(),N=null!==f&&void 0!==f?f:j,{data:{clusterData:y,groupsStats:w}={},isLoading:_,error:C}=z.Zh.useGetClusterInfoQuery(null!==p&&void 0!==p?p:void 0,{pollingInterval:m}),k=C&&"object"===typeof C?C:void 0,S=(0,M.N4)((e=>(0,z.ds)(e,null!==p&&void 0!==p?p:void 0)));n.useEffect((()=>{h((0,I.g)("cluster",{}))}),[h]);const T=n.useMemo((()=>_t.bn.find((({id:e})=>e===g))),[g]);return(0,b.jsxs)("div",{className:cs(),ref:d,children:[(0,b.jsx)(a.mg,{defaultTitle:`${N} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${N} \u2014 YDB Monitoring`,children:T?(0,b.jsx)("title",{children:T.title}):null}),(0,b.jsx)("div",{className:cs("header"),children:(()=>{if(_)return(0,b.jsx)(r.E,{className:cs("title-skeleton")});const e=(null===y||void 0===y?void 0:y.Overall)||v.m.Grey;return(0,b.jsxs)(O,{className:cs("title"),children:[N,(0,b.jsx)(O.Label,{status:e,note:E[e]})]})})()}),(0,b.jsx)("div",{className:cs("sticky-wrapper"),children:(0,b.jsx)(c.E,{className:cs("auto-refresh-control")})}),u&&(0,b.jsx)("div",{className:cs("dashboard"),children:(0,b.jsx)(as,{cluster:null!==y&&void 0!==y?y:{},groupStats:w,loading:_,error:k||(null===y||void 0===y?void 0:y.error),additionalClusterProps:e})}),(0,b.jsx)("div",{className:cs("tabs-sticky-wrapper"),children:(0,b.jsx)(l.t,{size:"l",allowNotSelected:!0,activeTab:g,items:_t.bn,wrapTo:({id:e},t)=>{const s=(0,_t.a)(e,{clusterName:p,backend:x});return(0,b.jsx)(A.E,{to:s,onClick:()=>{h((0,z.Yv)(e))},children:t},e)}})}),(0,b.jsx)("div",{className:cs("content"),children:(0,b.jsxs)(o.dO,{children:[(0,b.jsx)(o.qh,{path:(0,L.a3)((0,_t.a)(_t.Bi.tablets)).pathname,children:(0,b.jsx)($.Q,{loading:_,tablets:S,scrollContainerRef:d})}),(0,b.jsx)(o.qh,{path:(0,L.a3)((0,_t.a)(_t.Bi.tenants)).pathname,children:(0,b.jsx)(ke,{additionalTenantsProps:t,scrollContainerRef:d})}),(0,b.jsx)(o.qh,{path:(0,L.a3)((0,_t.a)(_t.Bi.nodes)).pathname,children:(0,b.jsx)(R.G,{scrollContainerRef:d,additionalNodesProps:s})}),(0,b.jsx)(o.qh,{path:(0,L.a3)((0,_t.a)(_t.Bi.storage)).pathname,children:(0,b.jsx)(B.z,{scrollContainerRef:d})}),(0,b.jsx)(o.qh,{path:(0,L.a3)((0,_t.a)(_t.Bi.versions)).pathname,children:(0,b.jsx)(vt,{cluster:y,loading:_})}),(0,b.jsx)(o.qh,{render:()=>(0,b.jsx)(o.rd,{to:(0,L.a3)((0,_t.a)(g))})})]})})]})}},42655:(e,t,s)=>{s.d(t,{y:()=>d});var n=s(59284),r=s(89169),l=s(77506),a=s(66781),o=s(60712);const i=(0,l.cn)("ydb-info-viewer-skeleton"),c=()=>(0,o.jsxs)("div",{className:i("label"),children:[(0,o.jsx)(r.E,{className:i("label__text")}),(0,o.jsx)("div",{className:i("label__dots")})]}),d=({rows:e=8,className:t,delay:s=600})=>{const[l]=(0,a.y)(s);let d=(0,o.jsxs)(n.Fragment,{children:[(0,o.jsx)(c,{}),(0,o.jsx)(r.E,{className:i("value")})]});return l||(d=null),(0,o.jsx)("div",{className:i(null,t),children:[...new Array(e)].map(((e,t)=>(0,o.jsx)("div",{className:i("row"),children:d},`skeleton-row-${t}`)))})}},70043:(e,t,s)=>{s.d(t,{E:()=>a});var n=s(89169),r=s(66781),l=s(60712);const a=({delay:e=600,className:t})=>{const[s]=(0,r.y)(e);return s?(0,l.jsx)(n.E,{className:t}):null}}}]);