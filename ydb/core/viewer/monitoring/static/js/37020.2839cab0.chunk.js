"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[37020],{23081:(e,s,t)=>{t.r(s),t.d(s,{Cluster:()=>Zs});var n=t(59284),a=t(1608),r=t(96727),l=t(29859),o=t(66212),i=t(61750),c=t(10755),d=t(80987),u=t(90053),h=t(37477),m=t(97677),p=t(44294),v=t(55340),x=t(78321),g=t(92459),j=t(67028),N=t(67157),f=t(40174),y=t(54090),b=t(77506),w=t(53627),C=t(81188),k=t(11363),S=t(47199),_=t(88616),E=t(93381),T=t(65872),D=t(64470),V=t(4557),O=t(80136),A=t(47653),L=t(15151),I=t(28539),G=t(44508),M=t(78524),z=t(48295),R=t(9252),P=t(17594),B=t(95963),$=t(69326),W=t(90101),H=t(32752),U=t(54309),F=t(581),J=t(12888),q=t(10508),Q=t(25196),Z=t(63719),Y=t(60712);function K({tenant:e,additionalTenantsProps:s}){const t=(0,J.X)(),n=((e,s)=>{var t;if("function"!==typeof(null===s||void 0===s?void 0:s.prepareTenantBackend))return;let n;const a=null!==(t=e.NodeIds)&&void 0!==t?t:e.sharedNodeIds;a&&a.length>0&&(n=a[Math.floor(Math.random()*a.length)].toString());return s.prepareTenantBackend(n)})(e,s),a=Boolean(n),r=(0,F.f)(s,null===e||void 0===e?void 0:e.Name,null===e||void 0===e?void 0:e.Type),l=r.length>0&&t?(0,Y.jsx)(W.u,{responsive:!0,children:(0,Y.jsx)(W.u.Item,{name:(0,Z.A)("field_links"),children:(0,Y.jsx)(H.s,{gap:2,wrap:"wrap",children:r.map((({title:e,url:s})=>(0,Y.jsx)(Q.K,{title:e,url:s},e)))})})}):null;return(0,Y.jsx)(q.c,{externalLink:a,name:e.Name||(0,Z.A)("context_unknown"),withLeftTrim:!0,status:e.Overall,infoPopoverContent:l,hasClipboardButton:!0,path:(0,U.YL)({database:e.Name,backend:n},{withBasename:a})})}var X=t(88610),ee=t(53850),se=t(23536),te=t.n(se),ne=t(76086),ae=t(56674);const re=(0,ee.Mz)((e=>e),(e=>ae.GJ.endpoints.getTenantsInfo.select({clusterName:e}))),le=(0,ee.Mz)((e=>e),((e,s)=>re(s)),(e=>(0,X.CN)(e,ne.Xm)),((e,s,t)=>{var n;const a=null!==(n=s(e).data)&&void 0!==n?n:[];return!t&&a.length>1?a.filter((e=>"Domain"!==e.Type)):a})),oe=e=>e.tenants.searchValue,ie=(0,ee.Mz)([le,X.yV,oe],((e,s,t)=>{let n=((e,s)=>s===X.s$.ALL?e:e.filter((e=>e.Overall&&e.Overall!==y.m.Green)))(e,s);return n=((e,s)=>e.filter((e=>{const t=new RegExp(te()(s),"i");return t.test(e.Name||"")||t.test(e.controlPlaneName)})))(n,t),n}));var ce=t(51114),de=t(46549),ue=t(56839),he=t(28232),me=t(41650),pe=t(48372);const ve=JSON.parse('{"create-database":"Create database","remove":"Remove","edit":"Edit"}'),xe=(0,pe.g4)("ydb-tenants-table",{en:ve}),ge=(0,b.cn)("tenants"),je=({additionalTenantsProps:e,scrollContainerRef:s})=>{const t=(0,w.YQ)(),a=(0,he.H)(),[r]=(0,w.Nt)(),{currentData:l,isFetching:o,error:i}=ae.GJ.useGetTenantsInfoQuery({clusterName:a},{pollingInterval:r}),c=o&&void 0===l,[d,u]=n.useState(),h=(0,j.sH)()&&void 0!==ce.J.onCreateDB,m=(0,j.g7)()&&void 0!==ce.J.onEditDB,p=(0,j.TW)()&&void 0!==ce.J.onDeleteDB,v=(0,w.N4)((e=>le(e,a))),x=(0,w.N4)(oe),g=(0,w.N4)((e=>ie(e,a))),N=(0,w.N4)(X.yV),[f]=(0,w.iK)(ne._X),y=e=>{t((0,X.$u)(e))},b=e=>{t((0,ae.gB)(e))};return(0,Y.jsx)("div",{className:ge("table-wrapper"),children:(0,Y.jsxs)($.L,{fullHeight:!0,children:[(0,Y.jsx)($.L.Controls,{renderExtraControls:()=>h&&a&&!c?(0,Y.jsxs)(O.$,{view:"action",onClick:()=>{var e;return null===(e=ce.J.onCreateDB)||void 0===e?void 0:e.call(ce.J,{clusterName:a})},className:ge("create-database"),children:[(0,Y.jsx)(A.I,{data:E.A}),xe("create-database")]}):null,children:(0,Y.jsxs)(n.Fragment,{children:[(0,Y.jsx)(B.v,{value:x,onChange:b,placeholder:"Database name",className:ge("search")}),(0,Y.jsx)(R.k,{value:N,onChange:y}),(0,Y.jsx)(I.T,{total:v.length,current:(null===g||void 0===g?void 0:g.length)||0,label:"Databases",loading:c})]})}),i?(0,Y.jsx)(G.o,{error:i}):null,(0,Y.jsx)($.L.Table,{scrollContainerRef:s,loading:c,scrollDependencies:[x,N,d],children:l?(()=>{const s=[{name:"Name",header:"Database",render:({row:s})=>(0,Y.jsx)(K,{tenant:s,additionalTenantsProps:e}),width:440,sortable:!0,defaultOrder:V.Ay.DESCENDING},{name:"controlPlaneName",header:"Name",render:({row:e})=>e.controlPlaneName,width:200,sortable:!0,defaultOrder:V.Ay.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:({row:e})=>"Serverless"!==e.Type?e.Type:(0,Y.jsxs)("div",{className:ge("type"),children:[(0,Y.jsx)("span",{className:ge("type-value"),children:e.Type}),(0,Y.jsx)(O.$,{className:ge("type-button"),onClick:()=>b(e.sharedTenantName||""),children:"Show shared"})]})},{name:"State",width:150,render:({row:e})=>e.State?e.State.toLowerCase():"\u2014",customStyle:()=>({textTransform:"capitalize"})},{name:"cpu",header:"CPU",width:80,render:({row:e})=>e.cpu&&e.cpu>1e4?(0,ue.iM)(e.cpu):"\u2014",align:V.Ay.RIGHT,defaultOrder:V.Ay.DESCENDING},{name:"memory",header:"Memory",width:120,render:({row:e})=>e.memory?(0,ue.vX)(e.memory):"\u2014",align:V.Ay.RIGHT,defaultOrder:V.Ay.DESCENDING},{name:"storage",header:"Storage",width:120,render:({row:e})=>e.storage?(0,ue.vX)(e.storage):"\u2014",align:V.Ay.RIGHT,defaultOrder:V.Ay.DESCENDING}];if(f&&s.push({name:"Network",header:"Network",width:120,align:V.Ay.RIGHT,defaultOrder:V.Ay.DESCENDING,sortAccessor:({NetworkWriteThroughput:e=0})=>Number(e),render:({row:e})=>{const{NetworkWriteThroughput:s}=e;return(0,me.kf)(s)?(0,de.z3)({value:s,size:"mb",withSpeedLabel:!0,precision:2}):ne.Pd}}),s.push({name:"nodesCount",header:"Nodes",width:100,render:({row:e})=>e.nodesCount?(0,ue.ZV)(e.nodesCount):"\u2014",align:V.Ay.RIGHT,defaultOrder:V.Ay.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:({row:e})=>e.groupsCount?(0,ue.ZV)(e.groupsCount):"\u2014",align:V.Ay.RIGHT,defaultOrder:V.Ay.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:({PoolStats:e=[]})=>e.reduce(((e,s)=>e+(s.Usage||0)),0),defaultOrder:V.Ay.DESCENDING,align:V.Ay.LEFT,render:({row:e})=>(0,Y.jsx)(z._,{pools:e.PoolStats})}),a&&(p||m)){const e=function({clusterName:e,isEditDBAvailable:s,isDeleteDBAvailable:t}){return{name:"actions",header:"",width:40,resizeable:!1,align:V.Ay.CENTER,render:({row:n})=>{const a=[];return"Domain"===n.Type?null:(s&&a.push({text:xe("edit"),iconStart:(0,Y.jsx)(T.A,{}),action:()=>{var s;null===(s=ce.J.onEditDB)||void 0===s||s.call(ce.J,{clusterName:e,databaseData:n})}}),t&&a.push({text:xe("remove"),iconStart:(0,Y.jsx)(D.A,{}),action:()=>{var s;null===(s=ce.J.onDeleteDB)||void 0===s||s.call(ce.J,{clusterName:e,databaseData:n})},theme:"danger"}),a.length?(0,Y.jsx)(L.r,{items:a}):null)}}}({clusterName:a,isDeleteDBAvailable:p,isEditDBAvailable:m});s.push(e)}return 0===g.length&&N!==X.s$.ALL?(0,Y.jsx)(M.v,{name:"thumbsUp",width:"200"}):(0,Y.jsx)(P.l,{columnsWidthLSKey:"databasesTableColumnsWidth",data:g,columns:s,settings:ne.N3,emptyDataMessage:"No such tenants",onSortChange:u})})():null})]})})};var Ne=t(74281),fe=t(48139),ye=t(98167),be=t(15298),we=t(96344);const Ce=(0,b.cn)("ydb-cluster-versions-bar"),ke=({versionsValues:e=[],size:s="s",progressClassName:t})=>(0,Y.jsxs)("div",{className:Ce(),children:[(0,Y.jsx)(we.k,{value:100,stack:e,size:s,className:t}),(0,Y.jsx)("div",{className:Ce("versions"),children:e.map(((s,t)=>(0,Y.jsx)("div",{className:Ce("version-title"),style:{color:s.color},title:s.version,children:`${s.version}${t===e.length-1?"":","}`},s.version)))})]});var Se=t(63126),_e=t(95109),Ee=t(52075);function Te(e){return[(0,_e._E)(),(0,_e.Nh)(e),(0,_e.jl)(),(0,_e.pH)(),(0,_e.fr)(),(0,_e.ID)()]}const De=({nodes:e})=>{const s=(0,Ee.E)(),t=Te({getNodeRef:null===s||void 0===s?void 0:s.getNodeRef});return(0,Y.jsx)(P.l,{columnsWidthLSKey:"versionsTableColumnsWidth",data:e,columns:t,settings:ne.N3})};var Ve=t(49461);const Oe=(0,b.cn)("ydb-versions-nodes-tree-title"),Ae=({title:e,nodes:s,items:t,versionColor:n,versionsValues:a})=>{let r;return r=t?t.reduce(((e,s)=>s.nodes?e+s.nodes.length:e),0):s?s.length:0,(0,Y.jsxs)("div",{className:Oe("overview"),children:[(0,Y.jsxs)("div",{className:Oe("overview-container"),children:[n?(0,Y.jsx)("div",{className:Oe("version-color"),style:{background:n}}):null,e?(0,Y.jsxs)("span",{className:Oe("overview-title"),children:[e,(0,Y.jsx)(Ve.b,{text:e,size:"s",className:Oe("clipboard-button"),view:"normal"})]}):null]}),(0,Y.jsxs)("div",{className:Oe("overview-info"),children:[(0,Y.jsxs)("div",{children:[(0,Y.jsx)("span",{className:Oe("info-value"),children:r}),(0,Y.jsx)("span",{className:Oe("info-label",{margin:"left"}),children:"Nodes"})]}),a?(0,Y.jsxs)("div",{className:Oe("version-progress"),children:[(0,Y.jsx)("span",{className:Oe("info-label",{margin:"right"}),children:"Versions"}),(0,Y.jsx)(we.k,{size:"s",value:100,stack:a})]}):null]})]})},Le=(0,b.cn)("ydb-versions-grouped-node-tree"),Ie=({title:e,nodes:s,items:t,expanded:a=!1,versionColor:r,versionsValues:l,level:o=0})=>{const[i,c]=n.useState(!1);n.useEffect((()=>{c(a)}),[a]);const d=(0,Y.jsx)(Ae,{title:e,nodes:s,items:t,versionColor:r,versionsValues:l}),u=()=>{c((e=>!e))};return t?(0,Y.jsx)("div",{className:Le({"first-level":0===o}),children:(0,Y.jsx)(Se.G,{name:d,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:t.map(((e,s)=>(0,Y.jsx)(Ie,{title:e.title,nodes:e.nodes,expanded:a,versionColor:e.versionColor,level:o+1},s)))},e)}):(0,Y.jsx)("div",{className:Le({"first-level":0===o}),children:(0,Y.jsx)(Se.G,{name:d,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:(0,Y.jsx)("div",{className:Le("dt-wrapper"),children:(0,Y.jsx)(De,{nodes:s||[]})})},e)})};var Ge=t(78018),Me=t.n(Ge),ze=t(66592);const Re=.5,Pe=(e=[],s)=>{const t=e.reduce(((e,s)=>(s.Version&&(e[s.Version]?e[s.Version]=e[s.Version]+1:e[s.Version]=1),e)),{});return $e(Object.keys(t).map((n=>{const a=t[n]/e.length*100;return{title:n,version:n,value:a<Re?Re:a,color:(0,ze.xH)(n,s)}})))};function Be(e,s,t){const n=null!==t&&void 0!==t?t:e.reduce(((e,s)=>e+s.count),0);return $e(e.map((e=>{const t=e.count/n*100;return{title:e.name,version:e.name,value:t<Re?Re:t,color:(0,ze.xH)(e.name,s)}})))}function $e(e){let s=e[0].value,t=0,n=0;e.forEach(((e,a)=>{n+=e.value,e.value>s&&(s=e.value,t=a)}));const a=[...e];return a[t]={...e[t],value:s+100-n},a}let We=function(e){return e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage",e}({});const He=(e,s)=>{var t;return(null===(t=e.title)||void 0===t?void 0:t.localeCompare(s.title||""))||-1},Ue=(e,s,t)=>{if(e&&e.length){if(t===We.VERSION){const t=Me()(e,"Version");return Object.keys(t).map((e=>{const n=t[e].filter(Qe),a=Me()(n,"Tenants"),r=Object.keys(a).map((e=>({title:e,nodes:a[e]}))).sort(He);return r.length?{title:e,items:r,versionColor:(0,ze.xH)(e,s)}:null})).filter((e=>Boolean(e)))}{const t=e.filter(Qe),n=Me()(t,"Tenants");return Object.keys(n).map((e=>{const t=Pe(n[e],s),a=Me()(n[e],"Version"),r=Object.keys(a).map((e=>({title:e,nodes:a[e],versionColor:(0,ze.xH)(e,s)})));return r.length?{title:e,items:r,versionsValues:t}:null})).filter((e=>Boolean(e))).sort(He)}}},Fe=(e,s)=>{if(!e||!e.length)return;const t=e.filter(qe),n=Me()(t,"Version");return Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:(0,ze.xH)(e,s)})))},Je=(e,s)=>{if(!e||!e.length)return;const t=e.filter((e=>!qe(e)&&!Qe(e)&&e.Version)),n=Me()(t,"Version");return Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:(0,ze.xH)(e,s)})))};function qe(e){var s;return Boolean(null===(s=e.Roles)||void 0===s?void 0:s.includes("Storage"))}function Qe(e){return Boolean(e.Tenants)}const Ze=JSON.parse('{"title_overall":"Overall","title_storage":"Storage nodes","title_database":"Database nodes","title_other":"Other nodes"}'),Ye=(0,pe.g4)("ydb-versions",{en:Ze});var Ke=t(4980),Xe=t(39567),es=t(98730),ss=t(66270);const ts=({cluster:e,versionsDataMap:s,clusterLoading:t})=>{const{currentData:a}=be.s.useGetNodesQuery((0,es.L)(e)||t?Ke.hT:{tablets:!1,fieldsRequired:["SystemState","SubDomainKey"],group:"Version"});return n.useMemo((()=>{if((0,es.L)(e)&&e.MapVersions){return Be(Object.entries(e.MapVersions).map((([e,s])=>({name:e,count:s}))),s,e.NodesTotal)}return a?Array.isArray(a.NodeGroups)?Be(a.NodeGroups,s,null===e||void 0===e?void 0:e.NodesTotal):Pe(a.Nodes,s):[]}),[a,s,e])};function ns(e){const s=function(){const[e]=(0,d.useQueryParam)("clusterName",d.StringParam),s=(0,w.N4)((e=>e.singleClusterMode)),{data:t}=Xe.ub.useGetClustersListQuery(void 0,{skip:s});return n.useMemo((()=>{if(s)return;const n=(t||[]).find((s=>s.name===e)),a=(null===n||void 0===n?void 0:n.versions)||[];return()=>(0,ss.kG)((0,ss.HD)(a))}),[s,t,e])}();return n.useMemo((()=>s?s():(0,ze.jh)(null===e||void 0===e?void 0:e.Versions)),[null===e||void 0===e?void 0:e.Versions,s])}const as=(0,b.cn)("ydb-versions");function rs({cluster:e,loading:s}){const[t]=(0,w.Nt)(),{currentData:n,isLoading:a}=be.s.useGetNodesQuery({tablets:!1,fieldsRequired:["SystemState","SubDomainKey"]},{pollingInterval:t}),r=ns(e),l=ts({cluster:e,versionsDataMap:r,clusterLoading:s});return(0,Y.jsx)(ye.r,{loading:s||a,children:(0,Y.jsx)(ls,{versionsValues:l,nodes:null===n||void 0===n?void 0:n.Nodes,versionsDataMap:r})})}function ls({versionsValues:e,nodes:s,versionsDataMap:t}){const[a,r]=n.useState(We.VERSION),[l,o]=n.useState(!1),i=e=>{r(e)},c=Ue(s,t,a),d=Fe(s,t),u=Je(s,t),h=null!==d&&void 0!==d&&d.length?(0,Y.jsxs)(n.Fragment,{children:[(0,Y.jsx)("h4",{children:Ye("title_storage")}),d.map((({title:e,nodes:s,items:t,versionColor:n})=>(0,Y.jsx)(Ie,{title:e,nodes:s,items:t,versionColor:n},`storage-nodes-${e}`)))]}):null,m=null!==c&&void 0!==c&&c.length?(0,Y.jsxs)(n.Fragment,{children:[(0,Y.jsx)("h4",{children:Ye("title_database")}),(0,Y.jsxs)("div",{className:as("controls"),children:[(0,Y.jsxs)("div",{className:as("group"),children:[(0,Y.jsx)("span",{className:as("label"),children:"Group by:"}),(0,Y.jsxs)(Ne.x,{value:a,onUpdate:i,children:[(0,Y.jsx)(Ne.x.Option,{value:We.TENANT,children:We.TENANT}),(0,Y.jsx)(Ne.x.Option,{value:We.VERSION,children:We.VERSION})]})]}),(0,Y.jsx)(fe.S,{className:as("checkbox"),onChange:()=>o((e=>!e)),checked:l,children:"All expanded"})]}),c.map((({title:e,nodes:s,items:t,versionColor:n,versionsValues:a})=>(0,Y.jsx)(Ie,{title:e,nodes:s,items:t,expanded:l,versionColor:n,versionsValues:a},`tenant-nodes-${e}`)))]}):null,p=null!==u&&void 0!==u&&u.length?(0,Y.jsxs)(n.Fragment,{children:[(0,Y.jsx)("h4",{children:Ye("title_other")}),u.map((({title:e,nodes:s,items:t,versionColor:n,versionsValues:a})=>(0,Y.jsx)(Ie,{title:e,nodes:s,items:t,versionColor:n,versionsValues:a},`other-nodes-${e}`)))]}):null,v=(0,Y.jsxs)(n.Fragment,{children:[(0,Y.jsx)("h4",{children:Ye("title_overall")}),(0,Y.jsx)("div",{className:as("overall-wrapper"),children:(0,Y.jsx)(ke,{progressClassName:as("overall-progress"),versionsValues:e.filter((e=>"unknown"!==e.title)),size:"m"})})]});return(0,Y.jsxs)("div",{className:as(),children:[v,h,m,p]})}var os=t(44520),is=t(88908),cs=t(60461),ds=t(7435),us=t(80967),hs=t(42655);const ms=JSON.parse('{"erasure":"Erasure","allocated":"Allocated","available":"Available","usage":"Usage","label_nodes-state":"Nodes state","label_dc":"Nodes data centers","links":"Links","link_cores":"Coredumps","link_logging":"Logging","link_slo-logs":"SLO Logs","context_cores":"cores","title_cpu":"CPU","title_storage":"Storage","title_storage-groups":"Storage Groups","title_memory":"Memory","title_network":"Network","title_links":"Links","title_details":"Details","label_overview":"Overview","label_load":"Load","context_of":"of","context_cpu":"CPU load","context_memory":"Memory used","context_storage":["Storage: {{count}} group","Storage: {{count}} groups","Storage: {{count}} groups","Storage: {{count}} groups"],"context_network":"Network Evaluation","context_cpu-description":"CPU load is calculated as the cumulative usage across all actor system pools on all nodes in the cluster","context_memory-description":"Memory usage is the total memory consumed by all nodes in the cluster","context_storage-description":"Storage usage is a cumulative usage of raw disk space of all media types","context_network-description":"Network usage is the average outgoing bandwidth usage across all nodes in the cluster"}'),ps=(0,pe.g4)("ydb-cluster",{en:ms});var vs=t(87842);const xs=(0,b.cn)("cluster-info");function gs(){const{cores:e,logging:s}=(0,N.Zd)();return n.useMemo((()=>{const t=[],n=function(e){try{const s=(0,me.qF)(e);if(s&&"object"===typeof s&&"url"in s&&"string"===typeof s.url)return s.url}catch{}}(e),{logsUrl:a,sloLogsUrl:r}=function(e){try{const s=(0,me.qF)(e);if(s&&"object"===typeof s){return{logsUrl:"url"in s&&"string"===typeof s.url?s.url:void 0,sloLogsUrl:"slo_logs_url"in s&&"string"===typeof s.slo_logs_url?s.slo_logs_url:void 0}}}catch{}return{}}(s);return n&&t.push({title:ps("link_cores"),url:n}),a&&t.push({title:ps("link_logging"),url:a}),r&&t.push({title:ps("link_slo-logs"),url:r}),t}),[e,s])}var js=t(15132),Ns=t(52443);const fs=({tags:e,className:s="",gap:t=1})=>(0,Y.jsx)(H.s,{className:s,gap:t,wrap:"wrap",alignItems:"center",children:e&&e.map(((e,s)=>(0,Y.jsx)(Ns.J,{size:"s",children:e},s)))});var ys=t(35736);const bs=(0,b.cn)("ydb-disk-groups-stats"),ws={good:"success",warning:"warning",danger:"danger"};function Cs({stats:e,storageType:s}){const{erasure:t,allocatedSize:n,availableSize:a}=e,r=(0,de.fn)(Math.max(n,a)),l=(0,de.z3)({value:n,size:r}),o=(0,de.z3)({value:a,size:r}),i=Math.floor(n/(n+a)*100),c=[{name:ps("erasure"),content:t},{name:ps("allocated"),content:l},{name:ps("available"),content:o},{name:ps("usage"),content:(0,Y.jsxs)(H.s,{gap:2,alignItems:"center",children:[(0,Y.jsx)(we.k,{theme:ws[(0,ys.w)({fillWidth:i})],className:bs("progress"),value:i,size:"s"}),(0,Y.jsxs)(is.E,{color:"secondary",children:[i,"%"]})]})}];return(0,Y.jsxs)(H.s,{direction:"column",gap:3,className:bs(),children:[(0,Y.jsxs)(is.E,{variant:"body-2",children:[s," ",(0,Y.jsx)(is.E,{color:"secondary",variant:"body-2",children:`${(0,ue.ZV)(e.createdGroups)} ${ps("context_of")} ${(0,ue.ZV)(e.totalGroups)}`})]}),(0,Y.jsx)(W.u,{nameMaxWidth:160,children:c.map((({name:e,content:s})=>(0,Y.jsx)(W.u.Item,{name:e,children:s},e)))})]})}const ks={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},Ss=(e,s)=>{var t;const a=[],r=(e=>{if((0,es.L)(e)&&e.MapDataCenters)return Object.entries(e.MapDataCenters).map((([e,s])=>(0,Y.jsxs)(n.Fragment,{children:[e," : ",(0,ue.ZV)(s)]},e)))})(e);if(null!==r&&void 0!==r&&r.length&&a.push({label:ps("label_dc"),value:(0,Y.jsx)(fs,{tags:r,gap:2,className:xs("dc")})}),(0,es.L)(e)&&e.MapNodeStates){const s=Object.entries(e.MapNodeStates);s.sort(((e,s)=>ks[s[0]]-ks[e[0]]));const t=s.map((([e,s])=>(0,Y.jsx)(h.c.Label,{withStatusName:!1,status:e,size:"s",iconSize:12,children:(0,ue.ZV)(s)},e)));a.push({label:ps("label_nodes-state"),value:(0,Y.jsx)(H.s,{gap:2,children:t})})}return a.push({label:ps("label_load"),value:(0,Y.jsx)(js.O,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null!==(t=null===e||void 0===e?void 0:e.RealNumberOfCpus)&&void 0!==t?t:null===e||void 0===e?void 0:e.NumberOfCpus})}),a.push(...s),a};const _s=({cluster:e,loading:s,error:t,additionalClusterProps:n={},groupStats:a={}})=>{const{info:r=[],links:l=[]}=n,o=gs(),i=l.concat(o),c=Ss(null!==e&&void 0!==e?e:{},r),d=()=>s?(0,Y.jsx)(hs.y,{className:xs("skeleton"),rows:4}):t&&!e?null:(0,Y.jsxs)(W.u,{nameMaxWidth:200,children:[c.map((({label:e,value:s})=>(0,Y.jsx)(W.u.Item,{name:e,children:s},e))),i.length>0&&(0,Y.jsx)(W.u.Item,{name:ps("title_links"),children:(0,Y.jsx)(H.s,{direction:"column",gap:2,children:i.map((({title:e,url:s})=>(0,Y.jsx)(Q.K,{title:e,url:s},e)))})})]}),u=(0,vs.lq)(a);return(0,Y.jsxs)(H.s,{gap:4,direction:"column",className:xs(),children:[t?(0,Y.jsx)(G.o,{error:t,className:xs("error")}):null,(0,Y.jsxs)(Es,{children:[(0,Y.jsx)(is.E,{as:"div",variant:"subheader-2",className:xs("section-title"),children:ps("title_details")}),d()]}),(()=>{const e=function(e){const s=[];return Object.entries(e).forEach((([e,t])=>{Object.values(t).forEach((t=>{s.push((0,Y.jsx)(Cs,{stats:t,storageType:e},`${e}|${t.erasure}`))}))})),s}(a);return s?null:(0,Y.jsxs)(Es,{children:[(0,Y.jsxs)(is.E,{as:"div",variant:"subheader-2",className:xs("section-title"),children:[ps("title_storage-groups")," ",(0,Y.jsx)(is.E,{variant:"subheader-2",color:"secondary",children:(0,ue.ZV)(u)})]}),(0,Y.jsx)(H.s,{gap:2,children:e})]})})()]})};function Es({children:e}){return(0,Y.jsx)(H.s,{direction:"column",gap:3,children:e})}var Ts=t(21049),Ds=t(70043);const Vs=(0,b.cn)("ydb-cluster-dashboard"),Os={good:y.m.Green,warning:y.m.Yellow,danger:y.m.Red};function As({children:e,className:s,collapsed:t}){return(0,Y.jsx)(H.s,{gap:"6",alignItems:"center",className:Vs("card",{collapsed:t},s),children:e})}function Ls({title:e,children:s,legend:t,collapsed:n,...a}){const{main:r,secondary:l,note:o}=t;if(n){const{status:s,fillWidth:t}=a,n=t.toFixed(t>0?0:1);return(0,Y.jsx)(h.c.Label,{withStatusName:!1,status:Os[s],children:`${e} : ${n}%`})}return(0,Y.jsxs)(As,{children:[(0,Y.jsx)(Ts.e,{...a,children:s}),(0,Y.jsxs)("div",{className:Vs("legend-wrapper"),children:[r&&(0,Y.jsx)(Ts.e.Legend,{children:r}),l&&(0,Y.jsx)(Ts.e.Legend,{color:"secondary",note:o,variant:"body-1",children:l})]})]})}function Is({collapsed:e}){return(0,Y.jsx)(As,{className:Vs("skeleton-wrapper"),collapsed:e,children:(0,Y.jsx)(Ds.E,{className:Vs("skeleton")})})}function Gs({collapsed:e}){return(0,Y.jsxs)(n.Fragment,{children:[(0,Y.jsx)(Is,{collapsed:e}),(0,Y.jsx)(Is,{collapsed:e}),(0,Y.jsx)(Is,{collapsed:e})]})}var Ms,zs=t(57428),Rs=t(18836);function Ps({collapsed:e,value:s,capacity:t,...n}){const{status:a,percents:r,legend:l,fill:o}=(0,Rs.s)({value:s,capacity:t,legendFormatter:zs.vs,...n});return(0,Y.jsx)(Ls,{collapsed:e,status:a,fillWidth:o,title:ps("title_cpu"),legend:{main:l,secondary:ps("context_cpu"),note:ps("context_cpu-description")},children:(0,Y.jsx)(Ts.e.Value,{children:r})})}function Bs({value:e,capacity:s,collapsed:t,...n}){const{status:a,percents:r,legend:l,fill:o}=(0,Rs.s)({value:e,capacity:s,legendFormatter:zs.cO,...n});return(0,Y.jsx)(Ls,{status:a,fillWidth:o,title:ps("title_memory"),collapsed:t,legend:{main:l,secondary:ps("context_memory"),note:ps("context_memory-description")},children:(0,Y.jsx)(Ts.e.Value,{children:r})})}function $s({percentsValue:e,throughput:s,collapsed:t,...n}){const[a]=(0,us.i)(ne._X);if(!a)return null;const{status:r,percents:l,fill:o}=(0,Rs.v)({fillWidth:100*e,...n}),i=(c=s,(0,de.z3)({value:c,withSpeedLabel:!0}));var c;return(0,Y.jsx)(Ls,{status:r,fillWidth:o,title:ps("title_network"),collapsed:t,legend:{main:i,secondary:ps("context_network"),note:ps("context_network-description")},children:(0,Y.jsx)(Ts.e.Value,{children:l})})}function Ws({value:e,capacity:s,groups:t,collapsed:n,...a}){const{status:r,percents:l,legend:o,fill:i}=(0,Rs.s)({value:e,capacity:s,legendFormatter:zs.cO,...a});return(0,Y.jsx)(Ls,{status:r,fillWidth:i,title:ps("title_storage"),collapsed:n,legend:{main:o,secondary:ps("context_storage",{count:t}),note:ps("context_storage-description")},children:(0,Y.jsx)(Ts.e.Value,{children:l})})}function Hs(){return Hs=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Hs.apply(null,arguments)}const Us=function(e){return n.createElement("svg",Hs({viewBox:"0 0 16 15"},e),Ms||(Ms=n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.98 1.826a.75.75 0 00-.96-1.152L10.376 3.71a1.25 1.25 0 01-1.196.225l-2.155-.718a2.75 2.75 0 00-2.973.837L.926 7.767a.75.75 0 101.148.966l3.125-3.712a1.25 1.25 0 011.352-.38l2.155.718a2.75 2.75 0 002.63-.496l3.644-3.037zM13.5 8h-2a.5.5 0 00-.5.5V13a.5.5 0 00.5.5h2a.5.5 0 00.5-.5V8.5a.5.5 0 00-.5-.5zm-4 5a.5.5 0 01-.5.5H7a.5.5 0 01-.5-.5v-2.5A.5.5 0 017 10h2a.5.5 0 01.5.5V13zM5 13a.5.5 0 01-.5.5h-2A.5.5 0 012 13v-.5a.5.5 0 01.5-.5h2a.5.5 0 01.5.5v.5zm-2.5 2h11a2 2 0 002-2V8.5a2 2 0 00-2-2h-2a2 2 0 00-2 2v.063A2.004 2.004 0 009 8.5H7a2 2 0 00-2 2v.063a2.005 2.005 0 00-.5-.063h-2a2 2 0 00-2 2v.5a2 2 0 002 2z",fill:"currentColor"})))};function Fs(e){const[s,t]=(0,us.i)(ne.zU);return e.error?(0,Y.jsx)(G.o,{error:e.error,className:Vs("error")}):(0,Y.jsx)(H.s,{direction:"column",className:Vs("overview-wrapper",{collapsed:!s}),children:(0,Y.jsxs)(os.E,{arrowPosition:"end",expanded:s,onUpdate:()=>t(!s),children:[(0,Y.jsx)(os.E.Summary,{children:t=>(0,Y.jsxs)("div",{...t,className:Vs("disclosure-summary"),children:[(0,Y.jsxs)(H.s,{alignItems:"center",justifyContent:"space-between",width:"100%",children:[(0,Y.jsxs)(H.s,{gap:2,alignItems:"center",children:[(0,Y.jsx)(A.I,{data:Us,size:16}),(0,Y.jsx)(is.E,{variant:"body-2",color:"primary",className:Vs("title"),children:ps("label_overview")})]}),!s&&(0,Y.jsx)(Js,{...e,collapsed:!0})]}),(0,Y.jsx)(cs.I,{size:16,direction:t.expanded?"top":"bottom"})]})}),(0,Y.jsx)(Js,{...e}),(0,Y.jsx)(_s,{...e})]})})}function Js({collapsed:e,...s}){return(0,j.fp)()?(0,Y.jsx)(H.s,{wrap:!0,className:Vs("dashboard-wrapper",{collapsed:e}),children:(0,Y.jsx)(qs,{...s,collapsed:e})}):null}function qs({cluster:e,groupStats:s={},loading:t,collapsed:n}){if(t)return(0,Y.jsx)(Gs,{collapsed:n});const a=[];if((0,es.L)(e)){const{CoresUsed:s,NumberOfCpus:t,CoresTotal:r}=e,l=null!==r&&void 0!==r?r:t;(0,ds.f8)(s)&&(0,ds.f8)(l)&&a.push((0,Y.jsx)(Ps,{value:s,capacity:l,collapsed:n},"cores"))}const{StorageTotal:r,StorageUsed:l}=e;if((0,ds.f8)(r)&&(0,ds.f8)(l)){const e=(0,vs.lq)(s);a.push((0,Y.jsx)(Ws,{value:l,capacity:r,groups:e,collapsed:n},"storage"))}const{MemoryTotal:o,MemoryUsed:i}=e;if((0,ds.f8)(o)&&(0,ds.f8)(i)&&a.push((0,Y.jsx)(Bs,{value:i,capacity:o,collapsed:n},"memory")),(0,es.E)(e)){const{NetworkUtilization:s,NetworkWriteThroughput:t}=e;(0,ds.f8)(s)&&a.push((0,Y.jsx)($s,{percentsValue:s,throughput:t,collapsed:n},"network"))}return a}const Qs=(0,b.cn)("ydb-cluster");function Zs({additionalClusterProps:e,additionalTenantsProps:s,additionalNodesProps:t}){const b=n.useRef(null),E=(0,j.fp)(),T=(0,x.s)(),[D]=(0,w.Nt)(),V=(0,w.YQ)(),O=function(){const e=(0,w.YQ)(),s=(0,w.N4)((e=>e.cluster.defaultClusterTab)),t=(0,x.s)(),a=(0,c.W5)(g.Ay.cluster),{activeTab:r}=(null===a||void 0===a?void 0:a.params)||{};let l;l=t||r!==vs.Bi.network?(0,vs.eC)(r)?r:s:N.Oy;return n.useEffect((()=>{l!==s&&e((0,N.Yv)(l))}),[l,s,e]),l}(),[{clusterName:A,backend:L}]=(0,d.useQueryParams)({clusterName:d.StringParam,backend:d.StringParam}),I=(0,w.N4)((e=>(0,N.zR)(e,null!==A&&void 0!==A?A:void 0))),{title:G}=(0,N.Zd)(),M=null!==G&&void 0!==G?G:I,{data:{clusterData:z,groupsStats:R}={},isLoading:P,error:B}=N.Zh.useGetClusterInfoQuery(null!==A&&void 0!==A?A:void 0,{pollingInterval:D}),$=B&&"object"===typeof B?B:void 0,W=(0,w.N4)((e=>(0,N.ds)(e,null!==A&&void 0!==A?A:void 0)));n.useEffect((()=>{V((0,f.g)("cluster",{}))}),[V]);const H=n.useMemo((()=>T?vs.bn:vs.bn.filter((e=>e.id!==vs.Bi.network))),[T]),U=n.useMemo((()=>H.find((({id:e})=>e===O))),[O,H]),{appTitle:F}=(0,C.J)();return(0,Y.jsxs)("div",{className:Qs(),ref:b,children:[(0,Y.jsx)(i.mg,{defaultTitle:`${M} \u2014 ${F}`,titleTemplate:`%s \u2014 ${M} \u2014 ${F}`,children:U?(0,Y.jsx)("title",{children:U.title}):null}),(0,Y.jsx)("div",{className:Qs("header"),children:(()=>{if(P)return(0,Y.jsx)(a.E,{className:Qs("title-skeleton")});const e=(null===z||void 0===z?void 0:z.Overall)||y.m.Grey;return(0,Y.jsxs)(h.c,{className:Qs("title"),children:[M,(0,Y.jsx)(h.c.Label,{status:e,note:m.D[e]})]})})()}),(0,Y.jsx)("div",{className:Qs("sticky-wrapper"),children:(0,Y.jsx)(u.E,{className:Qs("auto-refresh-control")})}),E&&(0,Y.jsx)("div",{className:Qs("dashboard"),children:(0,Y.jsx)(Fs,{cluster:null!==z&&void 0!==z?z:{},groupStats:R,loading:P,error:$||(null===z||void 0===z?void 0:z.error),additionalClusterProps:e})}),(0,Y.jsx)("div",{className:Qs("tabs-sticky-wrapper"),children:(0,Y.jsx)(r.f,{value:O,children:(0,Y.jsx)(l.w,{size:"l",children:H.map((({id:e,title:s})=>{const t=(0,vs.a)(e,{clusterName:A,backend:L});return(0,Y.jsx)(o.o,{value:e,children:(0,Y.jsx)(p.E,{view:"primary",as:"tab",to:t,onClick:()=>{V((0,N.Yv)(e))},children:s})},e)}))})})}),(0,Y.jsx)("div",{className:Qs("content"),children:(0,Y.jsxs)(c.dO,{children:[(0,Y.jsx)(c.qh,{path:(0,g.a3)((0,vs.a)(vs.Bi.tablets)).pathname,children:(0,Y.jsx)(_.Q,{loading:P,tablets:W,scrollContainerRef:b})}),(0,Y.jsx)(c.qh,{path:(0,g.a3)((0,vs.a)(vs.Bi.tenants)).pathname,children:(0,Y.jsx)(je,{additionalTenantsProps:s,scrollContainerRef:b})}),(0,Y.jsx)(c.qh,{path:(0,g.a3)((0,vs.a)(vs.Bi.nodes)).pathname,children:(0,Y.jsx)(k.G,{scrollContainerRef:b,additionalNodesProps:t})}),(0,Y.jsx)(c.qh,{path:(0,g.a3)((0,vs.a)(vs.Bi.storage)).pathname,children:(0,Y.jsx)(S.z,{scrollContainerRef:b})}),T&&(0,Y.jsx)(c.qh,{path:(0,g.a3)((0,vs.a)(vs.Bi.network)).pathname,children:(0,Y.jsx)(v.x,{scrollContainerRef:b,additionalNodesProps:t})}),(0,Y.jsx)(c.qh,{path:(0,g.a3)((0,vs.a)(vs.Bi.versions)).pathname,children:(0,Y.jsx)(rs,{cluster:z,loading:P})}),(0,Y.jsx)(c.qh,{render:()=>(0,Y.jsx)(c.rd,{to:(0,g.a3)((0,vs.a)(O))})})]})})]})}},42655:(e,s,t)=>{t.d(s,{y:()=>d});var n=t(59284),a=t(1608),r=t(77506),l=t(66781),o=t(60712);const i=(0,r.cn)("ydb-info-viewer-skeleton"),c=()=>(0,o.jsxs)("div",{className:i("label"),children:[(0,o.jsx)(a.E,{className:i("label__text")}),(0,o.jsx)("div",{className:i("label__dots")})]}),d=({rows:e=8,className:s,delay:t=600})=>{const[r]=(0,l.y)(t);let d=(0,o.jsxs)(n.Fragment,{children:[(0,o.jsx)(c,{}),(0,o.jsx)(a.E,{className:i("value")})]});return r||(d=null),(0,o.jsx)("div",{className:i(null,s),children:[...new Array(e)].map(((e,s)=>(0,o.jsx)("div",{className:i("row"),children:d},`skeleton-row-${s}`)))})}},70043:(e,s,t)=>{t.d(s,{E:()=>l});var n=t(1608),a=t(66781),r=t(60712);const l=({delay:e=600,className:s})=>{const[t]=(0,a.y)(e);return t?(0,r.jsx)(n.E,{className:s}):null}}}]);