"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[38527],{45659:(e,t,i)=>{i.d(t,{Q:()=>v});var s=i(32752),o=i(92459),n=i(7435),a=i(46549),l=i(56839),d=i(31684),r=i(12888),c=i(18863),u=i(25196),m=i(15132),p=i(33775),g=i(50672),h=i(60712);function v({pDisk:e,nodeId:t,withPDiskPageLink:i,className:v}){const D=(0,r.X)(),[f,k,b,I]=function({pDisk:e,nodeId:t,withPDiskPageLink:i,isUserAllowedToMakeChanges:r}){const{PDiskId:c,Path:v,Guid:D,Category:f,Type:k,Device:b,Realtime:I,State:S,SerialNumber:x,TotalSize:y,AllocatedSize:w,StatusV2:N,NumActiveSlots:j,ExpectedSlotCount:T,LogUsedSize:P,LogTotalSize:E,SystemSize:C,SharedWithOs:z}=e||{},M=[];(0,n.f8)(f)&&M.push({label:(0,g.D)("type"),value:k}),(0,n.f8)(v)&&M.push({label:(0,g.D)("path"),value:v}),(0,n.f8)(D)&&M.push({label:(0,g.D)("guid"),value:D}),x&&M.push({label:(0,g.D)("serial-number"),value:x}),z&&M.push({label:(0,g.D)("shared-with-os"),value:(0,g.D)("yes")});const O=[];(0,n.f8)(N)&&O.push({label:(0,g.D)("drive-status"),value:N}),(0,n.f8)(S)&&O.push({label:(0,g.D)("state"),value:S}),(0,n.f8)(b)&&O.push({label:(0,g.D)("device"),value:(0,h.jsx)(p.k,{status:b})}),(0,n.f8)(I)&&O.push({label:(0,g.D)("realtime"),value:(0,h.jsx)(p.k,{status:I})});const A=[];A.push({label:(0,g.D)("space"),value:(0,h.jsx)(m.O,{value:w,capacity:y,formatValues:l.vX,colorizeProgress:!0})}),(0,n.f8)(j)&&(0,n.f8)(T)&&A.push({label:(0,g.D)("slots"),value:(0,h.jsx)(m.O,{value:j,capacity:T})}),(0,n.f8)(P)&&(0,n.f8)(E)&&A.push({label:(0,g.D)("log-size"),value:(0,h.jsx)(m.O,{value:P,capacity:E,formatValues:l.vX})}),(0,n.f8)(C)&&A.push({label:(0,g.D)("system-size"),value:(0,a.z3)({value:C})});const _=[];if((i||r)&&(0,n.f8)(c)&&(0,n.f8)(t)){const e=(0,o.Ck)(c,t),n=(0,d.ar)({nodeId:t,pDiskId:c});_.push({label:(0,g.D)("links"),value:(0,h.jsxs)(s.s,{wrap:"wrap",gap:2,children:[i&&(0,h.jsx)(u.K,{title:(0,g.D)("pdisk-page"),url:e,external:!1}),r&&(0,h.jsx)(u.K,{title:(0,g.D)("developer-ui"),url:n})]})})}return[M,O,A,_]}({pDisk:e,nodeId:t,withPDiskPageLink:i,isUserAllowedToMakeChanges:D});return(0,h.jsxs)(s.s,{className:v,gap:2,direction:"row",wrap:!0,children:[(0,h.jsxs)(s.s,{direction:"column",gap:2,width:500,children:[(0,h.jsx)(c.z,{info:f,renderEmptyState:()=>null}),(0,h.jsx)(c.z,{info:b,renderEmptyState:()=>null})]}),(0,h.jsxs)(s.s,{direction:"column",gap:2,width:500,children:[(0,h.jsx)(c.z,{info:k,renderEmptyState:()=>null}),(0,h.jsx)(c.z,{info:I,renderEmptyState:()=>null})]})]})}},69134:(e,t,i)=>{i.r(t),i.d(t,{PDiskPage:()=>xe});var s=i(59284),o=i(76938),n=i(47653),a=i(96727),l=i(29859),d=i(66212),r=i(4980),c=i(61750),u=i(80987),m=i(370),p=i(22983),g=i(3685),h=i(44508),v=i(42655),D=i(69832),f=i(45659),k=i(58389),b=i(92459),I=i(21334),S=i(67028),x=i(40174),y=i(7187),w=i(68712),N=i(7435),j=i(27295),T=i(78034);const P=I.F.injectEndpoints({endpoints:e=>({getPdiskInfo:e.query({queryFn:async({nodeId:e,pDiskId:t},{signal:i,getState:s,dispatch:o})=>{let n;n=await(0,w.FC)("/pdisk/info",void 0,{getState:s,dispatch:o})>0?window.api.pdisk.getPDiskInfo({nodeId:e,pDiskId:t},{signal:i}):window.api.viewer.getNodeWhiteboardPDiskInfo({nodeId:e,pDiskId:t},{signal:i}).then((e=>e.PDiskStateInfo?{Whiteboard:{PDisk:{...e.PDiskStateInfo[0],ExpectedSlotCount:void 0}}}:{}));try{const t=await Promise.all([n,window.api.viewer.getNodeInfo({nodeId:e},{signal:i})]);return{data:function([e={},t]){var i,s,o;const n=null===(i=t.SystemStateInfo)||void 0===i?void 0:i[0],a=(0,T.q1)(n),{BSC:l={},Whiteboard:d={}}=e||{},{PDisk:r={},VDisks:c=[]}=d,{PDisk:u={}}=l,m=(0,j.or)({...u,...r}),p=null!==(s=m.NodeId)&&void 0!==s?s:a.NodeId,{LogUsedSize:g,LogTotalSize:h,TotalSize:v,SystemSize:D,ExpectedSlotCount:f,SlotSize:k}=m;let b;if((0,N.f8)(h)){const e=100*Number(g)/Number(h);b={SlotType:"log",Used:Number(g),Total:Number(h),UsagePercent:e,Severity:(0,y.SW)(e),SlotData:{LogUsedSize:g,LogTotalSize:h,SystemSize:D}}}const I=c.map((e=>(0,j.WT)({...e,NodeId:p})));I.sort(((e,t)=>Number(t.VDiskSlotId)-Number(e.VDiskSlotId)));const S=I.map((e=>{var t;const i=(0,y.SW)(e.AllocatedPercent);return{SlotType:"vDisk",Id:null===(t=e.VDiskId)||void 0===t?void 0:t.GroupID,Title:e.StoragePoolName,Severity:i,Used:Number(e.AllocatedSize),Total:Number(e.TotalSize),UsagePercent:e.AllocatedPercent,SlotData:e}}));let x=[];if(f&&f>S.length){const e=f-S.length;let t=Number(k);if(isNaN(t)){const i=S.reduce(((e,t)=>t.Total?e+t.Total:e),0);t=(Number(v)-i-Number(h))/e}x=(0,N._e)(e).map((()=>({SlotType:"empty",Total:t,Severity:1,SlotData:{Size:t}})))}const w=[...S,...x];return b&&w.length>0&&w.unshift(b),{...m,NodeId:p,NodeHost:a.Host,NodeType:null===(o=a.Roles)||void 0===o?void 0:o[0],NodeDC:a.DC,SlotItems:w}}(t)}}catch(a){return{error:a}}},providesTags:(e,t,i)=>["All",{type:"PDiskData",id:(0,y.r$)({nodeId:i.nodeId,pDiskId:i.pDiskId})}]})}),overrideExisting:"throw"});var E=i(77506),C=i(53627),z=i(12888),M=i(81188),O=i(47199),A=i(13066),_=i(15151),R=i(58611),$=i(80136),L=i(55974),U=i(42829),V=i(48372);const B=JSON.parse('{"fqdn":"FQDN","pdisk":"PDisk","node":"Node","storage":"Storage","space-distribution":"Space distribution","empty-slot":"Empty slot","log":"Log","label.log-size":"Log Size","label.system-size":"System Size","label.slot-size":"Slot Size","no-slots-data":"No slots data","restart-pdisk-button":"Restart PDisk","force-restart-pdisk-button":"Restart anyway","restart-pdisk-not-allowed":"You don\'t have enough rights to restart PDisk","restart-pdisk-dialog-header":"Restart PDisk","restart-pdisk-dialog-text":"PDisk will be restarted. Do you want to proceed?","decommission-none":"None","decommission-imminent":"Imminent","decommission-pending":"Pending","decommission-rejected":"Rejected","decommission-label":"{{decommission}} decommission","decommission-button":"Decommission","decommission-change-not-allowed":"You don\'t have enough rights to change PDisk decommission","decommission-dialog-title":"Change decommission status","decommission-dialog-force-change":"Change anyway","decommission-dialog-imminent-warning":"This will start imminent decommission. Existing slots will be moved from the disk","decommission-dialog-pending-warning":"This will start pending decommission. Decommission will be planned for this disk, but will not start immediatelly. Existing slots will not be moved from the disk, but no new slots will be allocated on it","decommission-dialog-rejected-warning":"This will start rejected decommission. No slots from other disks are placed on this disk in the process of decommission","decommission-dialog-none-warning":"This will reset decommission mode, allowing the disk to  be used by the storage"}'),H=(0,V.g4)("ydb-pDisk-page",{en:B});var J,W,G,X;function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)({}).hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},F.apply(null,arguments)}const Q=function(e){return s.createElement("svg",F({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 17 17",fill:"none"},e),J||(J=s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.378 7.771c.717 0 1.298.614 1.298 1.372v.914c0 .758-.581 1.372-1.298 1.372H3.46c-.716 0-1.297-.614-1.297-1.372v-.914c0-.758.58-1.372 1.297-1.372h6.92zm.77-1.248L9.935 3.958a1.292 1.292 0 00-1.16-.758H5.063c-.491 0-.94.294-1.16.758L2.69 6.523c.243-.08.501-.123.77-.123h6.918c.268 0 .527.043.77.123zm1.825 1.87V10.057c0 1.515-1.162 2.743-2.595 2.743H3.46c-1.433 0-2.594-1.228-2.594-2.743V8.393c0-.71.156-1.41.456-2.044l1.421-3.004c.44-.93 1.338-1.516 2.32-1.516h3.713c.982 0 1.88.587 2.32 1.516l1.421 3.004c.3.635.457 1.335.457 2.044zm-5.19.521c-.358 0-.648.307-.648.686 0 .379.29.686.649.686h2.162c.358 0 .649-.307.649-.686 0-.379-.29-.686-.65-.686H7.785z",fill:"currentColor",fillOpacity:.85})),W||(W=s.createElement("path",{d:"M15.25 11.428c0 2.15-1.639 3.822-3.574 3.822-1.935 0-3.574-1.671-3.574-3.822 0-2.15 1.639-3.821 3.574-3.821 1.935 0 3.574 1.671 3.574 3.821z",fill:"var(--g-color-base-background)",stroke:"currentColor",strokeWidth:1.5})),G||(G=s.createElement("path",{d:"M11.676 16.5c2.69 0 4.824-2.297 4.824-5.072 0-2.774-2.134-5.071-4.824-5.071s-4.824 2.297-4.824 5.071c0 2.775 2.134 5.072 4.824 5.072z",stroke:"var(--g-color-base-background)"})),X||(X=s.createElement("path",{d:"M12.973 10.057L10.378 12.8m0-2.743l2.595 2.743",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var q=i(60712);const Y=(0,E.cn)("ydb-pdisk-decommission-button");function K(e){return"DECOMMIT_IMMINENT"===e?H("decommission-dialog-imminent-warning"):"DECOMMIT_PENDING"===e?H("decommission-dialog-pending-warning"):"DECOMMIT_REJECTED"===e?H("decommission-dialog-rejected-warning"):"DECOMMIT_NONE"===e?H("decommission-dialog-none-warning"):void 0}function Z({decommission:e,onConfirmAction:t,onConfirmActionSuccess:i,buttonDisabled:o,popoverDisabled:n}){const[a,l]=s.useState(),[d,r]=s.useState(!1),[c,u]=s.useState(!1),m=function(e,t){return[{text:H("decommission-none"),action:()=>t("DECOMMIT_NONE"),hidden:!e||"DECOMMIT_NONE"===e||"DECOMMIT_UNSET"===e},{text:H("decommission-pending"),action:()=>t("DECOMMIT_PENDING"),hidden:"DECOMMIT_PENDING"===e},{text:H("decommission-rejected"),action:()=>t("DECOMMIT_REJECTED"),hidden:"DECOMMIT_REJECTED"===e},{text:H("decommission-imminent"),theme:"danger",action:()=>t("DECOMMIT_IMMINENT"),hidden:"DECOMMIT_IMMINENT"===e}]}(e,l);return(0,q.jsxs)(s.Fragment,{children:[(0,q.jsx)(_.r,{renderSwitcher:e=>(0,q.jsx)(ee,{popoverDisabled:n,loading:d,disabled:o,...e}),items:m,popupProps:{className:Y("popup")}}),(0,q.jsx)(L.g,{visible:Boolean(a),header:H("decommission-dialog-title"),text:K(a),withRetry:c,withCheckBox:!0,retryButtonText:H("decommission-dialog-force-change"),onConfirm:async e=>{r(!0),await t(a,e)},onConfirmActionSuccess:async()=>{u(!1),await(0,N.uk)(5e3);try{await i()}finally{r(!1)}},onConfirmActionError:e=>{u((0,U.D)(e)),r(!1)},onClose:()=>{l(void 0)}})]})}function ee({popoverDisabled:e,...t}){return(0,q.jsx)(R.A,{content:H("decommission-change-not-allowed"),placement:"right",disabled:e,children:(0,q.jsxs)($.$,{view:"normal",className:Y("button"),...t,children:[(0,q.jsx)(n.I,{data:Q}),H("decommission-button"),(0,q.jsx)(n.I,{data:A.A})]})})}var te=i(52443);function ie(e){return H("decommission-label",{decommission:e})}function se({decommission:e}){return"DECOMMIT_IMMINENT"===e?(0,q.jsx)(te.J,{theme:"danger",size:"m",children:ie(H("decommission-imminent"))}):"DECOMMIT_PENDING"===e?(0,q.jsx)(te.J,{theme:"warning",size:"m",children:ie(H("decommission-pending"))}):"DECOMMIT_REJECTED"===e?(0,q.jsx)(te.J,{theme:"normal",size:"m",children:ie(H("decommission-rejected"))}):null}var oe=i(88226),ne=i(50229),ae=i(60073),le=i(44294),de=i(15132),re=i(67808),ce=i(46549),ue=i(56839);const me=(0,E.cn)("ydb-pdisk-space-distribution"),pe=40;function ge({data:e}){const{SlotItems:t}=e,{PDiskId:i,NodeId:s}=e,o=pe*((null===t||void 0===t?void 0:t.length)||1);return null!==t&&void 0!==t&&t.length?(0,q.jsx)("div",{className:me(null),style:{height:o,minHeight:o},children:(0,q.jsx)(oe.V,{className:me("pdisk-bar"),severity:e.Severity,diskAllocatedPercent:e.AllocatedPercent,content:null===t||void 0===t?void 0:t.map(((e,t)=>(0,q.jsx)(he,{item:e,pDiskId:i,nodeId:s},t))),faded:!0})}):H("no-slots-data")}function he({item:e,nodeId:t}){return(0,q.jsx)("div",{className:me("slot-wrapper"),style:{flexGrow:Number(e.Total)||1},children:(()=>{if("vDisk"===e.SlotType){var i;const s=(0,N.f8)(null===(i=e.SlotData)||void 0===i?void 0:i.StringifiedId)?(0,b.yX)({nodeId:t,vDiskId:e.SlotData.StringifiedId}):void 0;return(0,q.jsx)(ne.P,{renderPopupContent:()=>(0,q.jsx)(re.E,{data:e.SlotData,withTitle:!0}),contentClassName:me("vdisk-popup"),placement:["right","top"],children:(0,q.jsx)(le.E,{to:s,children:(0,q.jsx)(oe.V,{className:me("slot"),severity:e.Severity,diskAllocatedPercent:e.UsagePercent,content:(0,q.jsx)(ve,{id:e.Id,title:e.Title,used:e.Used,total:e.Total})})})})}return function(e){return"log"===e.SlotType}(e)?(0,q.jsx)(ne.P,{renderPopupContent:()=>(0,q.jsx)(De,{data:e.SlotData}),contentClassName:me("vdisk-popup"),placement:["right","top"],children:(0,q.jsx)(oe.V,{className:me("slot"),severity:e.Severity,diskAllocatedPercent:e.UsagePercent,content:(0,q.jsx)(ve,{title:H("log"),used:e.Used,total:e.Total})})}):function(e){return"empty"===e.SlotType}(e)?(0,q.jsx)(ne.P,{renderPopupContent:()=>(0,q.jsx)(fe,{data:e.SlotData}),contentClassName:me("vdisk-popup"),placement:["right","top"],children:(0,q.jsx)(oe.V,{className:me("slot"),severity:e.Severity,empty:!0,content:(0,q.jsx)(ve,{title:H("empty-slot"),used:e.Total})})}):null})()})}function ve({id:e,title:t,used:i,total:s}){return(0,q.jsxs)("div",{className:me("slot-content"),children:[(0,q.jsxs)("span",{children:[(0,N.f8)(e)?(0,q.jsx)("span",{className:me("slot-id"),children:e}):null,t]}),(0,q.jsx)("span",{className:me("slot-size"),children:(()=>{const[e,t]=(0,ue.vX)(i,s);return s?`${e} / ${t}`:e})()})]})}function De({data:e}){const{LogTotalSize:t,LogUsedSize:i,SystemSize:s}=e,o=[{label:H("label.log-size"),value:(0,q.jsx)(de.O,{value:i,capacity:t,formatValues:ue.vX})}];return(0,N.f8)(s)&&o.push({label:H("label.system-size"),value:(0,ce.z3)({value:s})}),(0,q.jsx)(ae.z_,{title:H("log"),info:o})}function fe({data:e}){const{Size:t}=e,i=[{label:H("label.slot-size"),value:(0,ce.z3)({value:t})}];return(0,q.jsx)(ae.z_,{title:H("empty-slot"),info:i})}const ke=(0,E.cn)("ydb-pdisk-page"),be={spaceDistribution:"spaceDistribution",storage:"storage"},Ie=[{id:be.spaceDistribution,get title(){return H("space-distribution")}},{id:be.storage,get title(){return H("storage")}}],Se=m.z.nativeEnum(be).catch(be.spaceDistribution);function xe(){const e=(0,C.YQ)(),t=(0,z.X)(),i=(0,S.c2)(),m=s.useRef(null),[{nodeId:w,pDiskId:j,activeTab:T}]=(0,u.useQueryParams)({activeTab:u.StringParam,nodeId:u.StringParam,pDiskId:u.StringParam}),E=(0,N.f8)(w)&&(0,N.f8)(j),A=Se.parse(T);s.useEffect((()=>{e((0,x.g)("pDisk",{nodeId:w,pDiskId:j}))}),[e,w,j]);const[_]=(0,C.Nt)(),R=E?{nodeId:w,pDiskId:j}:r.hT,$=P.useGetPdiskInfoQuery(R,{pollingInterval:_}),L=$.isFetching&&void 0===$.currentData,U=$.currentData,{NodeHost:V,NodeId:B,NodeType:J,NodeDC:W,Severity:G,DecommitStatus:X}=U||{},F=async e=>{if(E){const t=await window.api.pdisk[i?"restartPDisk":"restartPDiskOld"]({nodeId:w,pDiskId:j,force:e});if(!1===(null===t||void 0===t?void 0:t.result)){throw{statusText:t.error,retryPossible:t.forceRetryPossible}}}},Q=async(e,t)=>{if(E){const i=await window.api.pdisk.changePDiskStatus({nodeId:w,pDiskId:j,force:t,decommissionStatus:e});if(!1===(null===i||void 0===i?void 0:i.result)){throw{statusText:i.error,retryPossible:i.forceRetryPossible}}}},Y=()=>{E&&e(I.F.util.invalidateTags([{type:"PDiskData",id:(0,y.r$)({nodeId:w,pDiskId:j})}]),"StorageData")},{appTitle:K}=(0,M.J)();return(0,q.jsxs)("div",{className:ke(null),ref:m,children:[(()=>{const e=j?`${H("pdisk")} ${j}`:H("pdisk"),t=V||H("node");return(0,q.jsx)(c.mg,{titleTemplate:`%s - ${e} \u2014 ${t} \u2014 ${K}`,defaultTitle:`${e} \u2014 ${t} \u2014 ${K}`})})(),(()=>{const e=V?`${H("fqdn")}: ${V}`:void 0,t=B?`${H("node")}: ${B}`:void 0;return(0,q.jsx)(k.B,{loading:L,items:[e,t,J,W],className:ke("meta")})})(),(0,q.jsxs)("div",{className:ke("title"),children:[(0,q.jsx)(g.$,{entityName:H("pdisk"),status:(0,y.XY)(G),id:(0,y.r$)({nodeId:w,pDiskId:j})}),(0,q.jsx)(se,{decommission:X})]}),(0,q.jsxs)("div",{className:ke("controls"),children:[(0,q.jsxs)(p.B,{onConfirmAction:F,onConfirmActionSuccess:Y,buttonDisabled:!E||!t,buttonView:"normal",dialogHeader:H("restart-pdisk-dialog-header"),dialogText:H("restart-pdisk-dialog-text"),retryButtonText:H("force-restart-pdisk-button"),withPopover:!0,popoverContent:H("restart-pdisk-not-allowed"),popoverDisabled:t,children:[(0,q.jsx)(n.I,{data:o.A}),H("restart-pdisk-button")]}),i?(0,q.jsx)(Z,{decommission:X,onConfirmAction:Q,onConfirmActionSuccess:Y,buttonDisabled:!E||!t,popoverDisabled:t}):null]}),$.error?(0,q.jsx)(h.o,{error:$.error}):null,L?(0,q.jsx)(v.y,{className:ke("info"),rows:10}):(0,q.jsx)(f.Q,{pDisk:U,nodeId:w,className:ke("info")}),(0,q.jsx)("div",{className:ke("tabs"),children:(0,q.jsx)(a.f,{value:A,children:(0,q.jsx)(l.w,{size:"l",children:Ie.map((({id:e,title:t})=>{const i=E?(0,b.Ck)(j,w,{activeTab:e}):void 0;return(0,q.jsx)(d.o,{value:e,children:(0,q.jsx)(D.E,{as:"tab",to:i,children:t})},e)}))})})}),(()=>{switch(A){case"spaceDistribution":return U?(0,q.jsx)("div",{className:ke("disk-distribution"),children:(0,q.jsx)(ge,{data:U})}):null;case"storage":return E?(0,q.jsx)(O.z,{nodeId:w,pDiskId:j,scrollContainerRef:m,viewContext:{nodeId:null===w||void 0===w?void 0:w.toString(),pDiskId:null===j||void 0===j?void 0:j.toString()}}):null;default:return null}})()]})}},76938:(e,t,i)=>{i.d(t,{A:()=>o});var s=i(59284);const o=e=>s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),s.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 1.5a6.5 6.5 0 1 1-6.445 7.348.75.75 0 1 1 1.487-.194A5.001 5.001 0 1 0 4.43 4.5h1.32a.75.75 0 0 1 0 1.5h-3A.75.75 0 0 1 2 5.25v-3a.75.75 0 0 1 1.5 0v1.06A6.48 6.48 0 0 1 8 1.5",clipRule:"evenodd"}))}}]);