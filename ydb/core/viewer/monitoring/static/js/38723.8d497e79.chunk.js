"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[38723],{3685:(e,s,t)=>{t.d(s,{$:()=>r});var i=t(54090),n=t(77506),o=t(33775),l=t(60712);const a=(0,n.cn)("ydb-entity-page-title");function r({entityName:e,status:s=i.m.Grey,id:t,className:n}){return(0,l.jsxs)("div",{className:a(null,n),children:[(0,l.jsx)("span",{className:a("prefix"),children:e}),(0,l.jsx)(o.k,{className:a("icon"),status:s,size:"s"}),t]})}},18677:(e,s,t)=>{t.d(s,{A:()=>n});var i=t(59284);const n=e=>i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),i.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14M6.53 5.47a.75.75 0 0 0-1.06 1.06L6.94 8 5.47 9.47a.75.75 0 1 0 1.06 1.06L8 9.06l1.47 1.47a.75.75 0 1 0 1.06-1.06L9.06 8l1.47-1.47a.75.75 0 1 0-1.06-1.06L8 6.94z",clipRule:"evenodd"}))},22983:(e,s,t)=>{t.d(s,{B:()=>d});var i=t(59284),n=t(80136),o=t(58611),l=t(55974),a=t(42829),r=t(60712);function d({children:e,onConfirmAction:s,onConfirmActionSuccess:t,dialogHeader:d,dialogText:c,retryButtonText:u,buttonDisabled:m=!1,buttonView:p="action",buttonTitle:h,buttonClassName:v,withPopover:g=!1,popoverContent:x,popoverPlacement:f="right",popoverDisabled:b=!0}){const[N,j]=i.useState(!1),[y,k]=i.useState(!1),[w,S]=i.useState(!1),D=()=>(0,r.jsx)(n.$,{onClick:()=>j(!0),view:p,disabled:m,loading:!m&&y,className:v,title:h,children:e});return(0,r.jsxs)(i.Fragment,{children:[(0,r.jsx)(l.g,{visible:N,header:d,text:c,withRetry:w,retryButtonText:u,onConfirm:async e=>{k(!0),await s(e)},onConfirmActionSuccess:async()=>{S(!1);try{await(null===t||void 0===t?void 0:t())}finally{k(!1)}},onConfirmActionError:e=>{S((0,a.D)(e)),k(!1)},onClose:()=>{j(!1)}}),g?(0,r.jsx)(o.A,{content:x,placement:f,disabled:b,children:D()}):D()]})}},27160:(e,s,t)=>{t.d(s,{D:()=>n});var i=t(77773);function n(){return(0,i.w)().theme}},42655:(e,s,t)=>{t.d(s,{y:()=>c});var i=t(59284),n=t(1608),o=t(77506),l=t(66781),a=t(60712);const r=(0,o.cn)("ydb-info-viewer-skeleton"),d=()=>(0,a.jsxs)("div",{className:r("label"),children:[(0,a.jsx)(n.E,{className:r("label__text")}),(0,a.jsx)("div",{className:r("label__dots")})]}),c=({rows:e=8,className:s,delay:t=600})=>{const[o]=(0,l.y)(t);let c=(0,a.jsxs)(i.Fragment,{children:[(0,a.jsx)(d,{}),(0,a.jsx)(n.E,{className:r("value")})]});return o||(c=null),(0,a.jsx)("div",{className:r(null,s),children:[...new Array(e)].map(((e,s)=>(0,a.jsx)("div",{className:r("row"),children:c},`skeleton-row-${s}`)))})}},42829:(e,s,t)=>{t.d(s,{D:()=>i});const i=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},45659:(e,s,t)=>{t.d(s,{Q:()=>g});var i=t(32752),n=t(92459),o=t(7435),l=t(46549),a=t(56839),r=t(31684),d=t(12888),c=t(18863),u=t(25196),m=t(15132),p=t(33775),h=t(50672),v=t(60712);function g({pDisk:e,nodeId:s,withPDiskPageLink:t,className:g}){const x=(0,d.X)(),[f,b,N,j]=function({pDisk:e,nodeId:s,withPDiskPageLink:t,isUserAllowedToMakeChanges:d}){const{PDiskId:c,Path:g,Guid:x,Category:f,Type:b,Device:N,Realtime:j,State:y,SerialNumber:k,TotalSize:w,AllocatedSize:S,AllocatedPercent:D,StatusV2:I,NumActiveSlots:C,ExpectedSlotCount:T,LogUsedSize:E,LogTotalSize:P,SystemSize:z,SharedWithOs:A}=e||{},_=[];(0,o.f8)(f)&&_.push({label:(0,h.D)("type"),value:b}),(0,o.f8)(g)&&_.push({label:(0,h.D)("path"),value:g}),(0,o.f8)(x)&&_.push({label:(0,h.D)("guid"),value:x}),k&&_.push({label:(0,h.D)("serial-number"),value:k}),A&&_.push({label:(0,h.D)("shared-with-os"),value:(0,h.D)("yes")});const M=[];(0,o.f8)(I)&&M.push({label:(0,h.D)("drive-status"),value:I}),(0,o.f8)(y)&&M.push({label:(0,h.D)("state"),value:y}),(0,o.f8)(N)&&M.push({label:(0,h.D)("device"),value:(0,v.jsx)(p.k,{status:N})}),(0,o.f8)(j)&&M.push({label:(0,h.D)("realtime"),value:(0,v.jsx)(p.k,{status:j})});const O=[];O.push({label:(0,h.D)("space"),value:(0,v.jsx)(m.O,{value:S,capacity:w,formatValues:a.vX,colorizeProgress:!0})}),isNaN(Number(D))||O.push({label:(0,h.D)("usage"),value:`${D}%`}),(0,o.f8)(C)&&(0,o.f8)(T)&&O.push({label:(0,h.D)("slots"),value:(0,v.jsx)(m.O,{value:C,capacity:T})}),(0,o.f8)(E)&&(0,o.f8)(P)&&O.push({label:(0,h.D)("log-size"),value:(0,v.jsx)(m.O,{value:E,capacity:P,formatValues:a.vX})}),(0,o.f8)(z)&&O.push({label:(0,h.D)("system-size"),value:(0,l.z3)({value:z})});const R=[];if((t||d)&&(0,o.f8)(c)&&(0,o.f8)(s)){const e=(0,n.Ck)(c,s),o=(0,r.ar)({nodeId:s,pDiskId:c});R.push({label:(0,h.D)("links"),value:(0,v.jsxs)(i.s,{wrap:"wrap",gap:2,children:[t&&(0,v.jsx)(u.K,{title:(0,h.D)("pdisk-page"),url:e,external:!1}),d&&(0,v.jsx)(u.K,{title:(0,h.D)("developer-ui"),url:o})]})})}return[_,M,O,R]}({pDisk:e,nodeId:s,withPDiskPageLink:t,isUserAllowedToMakeChanges:x});return(0,v.jsxs)(i.s,{className:g,gap:2,direction:"row",wrap:!0,children:[(0,v.jsxs)(i.s,{direction:"column",gap:2,width:500,children:[(0,v.jsx)(c.z,{info:f,renderEmptyState:()=>null}),(0,v.jsx)(c.z,{info:N,renderEmptyState:()=>null})]}),(0,v.jsxs)(i.s,{direction:"column",gap:2,width:500,children:[(0,v.jsx)(c.z,{info:b,renderEmptyState:()=>null}),(0,v.jsx)(c.z,{info:j,renderEmptyState:()=>null})]})]})}},48139:(e,s,t)=>{t.d(s,{S:()=>c});var i=t(60712),n=t(59284),o=t(90883),l=t(21246);function a(e){return(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 17 17",width:"16",height:"16",fill:"currentColor",...e,children:(0,i.jsx)("path",{d:"M4 7h9v3H4z"})})}function r(e){return(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 10",width:"16",height:"16",fill:"currentColor",...e,children:(0,i.jsx)("path",{d:"M.49 5.385l1.644-1.644 4.385 4.385L4.874 9.77.49 5.385zm4.384 1.096L10.356 1 12 2.644 6.519 8.126 4.874 6.48v.001z"})})}const d=(0,t(10417).om)("checkbox"),c=n.forwardRef((function(e,s){const{size:t="m",indeterminate:n,disabled:c=!1,content:u,children:m,title:p,style:h,className:v,qa:g}=e,{checked:x,inputProps:f}=(0,o.v)(e),b=u||m,N=(0,i.jsxs)("span",{className:d("indicator"),children:[(0,i.jsx)("span",{className:d("icon"),"aria-hidden":!0,children:n?(0,i.jsx)(a,{className:d("icon-svg",{type:"dash"})}):(0,i.jsx)(r,{className:d("icon-svg",{type:"tick"})})}),(0,i.jsx)("input",{...f,className:d("control")}),(0,i.jsx)("span",{className:d("outline")})]});return(0,i.jsx)(l.m,{ref:s,title:p,style:h,size:t,disabled:c,className:d({size:t,disabled:c,indeterminate:n,checked:x},v),qa:g,control:N,children:b})}))},55974:(e,s,t)=>{t.d(s,{g:()=>f});var i=t(59284),n=t(18677),o=t(71153),l=t(48139),a=t(71989),r=t(47653),d=t(56999),c=t(77506),u=t(81288),m=t(48372);const p=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),h=(0,m.g4)("ydb-critical-action-dialog",{en:p});var v=t(60712);const g=(0,c.cn)("ydb-critical-dialog"),x=e=>{if((0,u.cH)(e)){if(403===e.status)return h("no-rights-error");if("string"===typeof e.data)return e.data;if((0,u._E)(e)&&e.data)return(0,v.jsx)(d.O,{hideSeverity:!0,data:e.data});if(e.statusText)return e.statusText}return h("default-error")};function f({visible:e,header:s,text:t,withRetry:d,retryButtonText:c,withCheckBox:u,onClose:m,onConfirm:p,onConfirmActionSuccess:f,onConfirmActionError:b}){const[N,j]=i.useState(!1),[y,k]=i.useState(),[w,S]=i.useState(!1),D=async e=>(j(!0),p(e).then((()=>{f(),m()})).catch((e=>{b(e),k(e)})).finally((()=>{j(!1)})));return(0,v.jsx)(a.l,{open:e,hasCloseButton:!1,className:g(),size:"s",onClose:m,onTransitionOutComplete:()=>{k(void 0),S(!1)},children:y?(0,v.jsxs)(i.Fragment,{children:[(0,v.jsx)(a.l.Header,{caption:s}),(0,v.jsx)(a.l.Body,{className:g("body"),children:(0,v.jsxs)("div",{className:g("body-message",{error:!0}),children:[(0,v.jsx)("span",{className:g("error-icon"),children:(0,v.jsx)(n.A,{width:"24",height:"22"})}),x(y)]})}),(0,v.jsx)(a.l.Footer,{loading:!1,preset:"default",textButtonApply:d?c||h("button-retry"):void 0,textButtonCancel:h("button-close"),onClickButtonApply:()=>D(!0),onClickButtonCancel:m})]}):(0,v.jsxs)(i.Fragment,{children:[(0,v.jsx)(a.l.Header,{caption:s}),(0,v.jsxs)(a.l.Body,{className:g("body"),children:[(0,v.jsxs)("div",{className:g("body-message",{warning:!0}),children:[(0,v.jsx)("span",{className:g("warning-icon"),children:(0,v.jsx)(r.I,{data:o.A,size:24})}),t]}),u?(0,v.jsx)(l.S,{checked:w,onUpdate:S,children:h("checkbox-text")}):null]}),(0,v.jsx)(a.l.Footer,{loading:N,preset:"default",textButtonApply:h("button-confirm"),textButtonCancel:h("button-cancel"),propsButtonApply:{type:"submit",disabled:u&&!w},onClickButtonCancel:m,onClickButtonApply:()=>D()})]})})}},56999:(e,s,t)=>{t.d(s,{O:()=>j});var i=t(59284),n=t(45720),o=t(16929),l=t(71153),a=t(18677),r=t(80136),d=t(60461),c=t(78540),u=t(47653),m=t(74529),p=t(77506),h=t(41650);const v=["S_FATAL","S_ERROR","S_WARNING","S_INFO"];function g(e){return function(e){return!!e&&void 0!==v[e]}(e)?v[e]:"S_INFO"}var x=t(60712);const f=(0,p.cn)("kv-result-issues"),b=(0,p.cn)("kv-issues"),N=(0,p.cn)("kv-issue");function j({data:e,hideSeverity:s}){const[t,n]=i.useState(!1),o="string"===typeof e||null===e||void 0===e?void 0:e.issues,l=Array.isArray(o)&&o.length>0;return(0,x.jsxs)("div",{className:f(),children:[(0,x.jsxs)("div",{className:f("error-message"),children:[(()=>{let t;if("string"===typeof e)t=e;else{var n,o;const l=g(null===e||void 0===e||null===(n=e.error)||void 0===n?void 0:n.severity);t=(0,x.jsxs)(i.Fragment,{children:[s?null:(0,x.jsxs)(i.Fragment,{children:[(0,x.jsx)(C,{severity:l})," "]}),(0,x.jsx)("span",{className:f("error-message-text"),children:null===e||void 0===e||null===(o=e.error)||void 0===o?void 0:o.message})]})}return t})(),l&&(0,x.jsx)(r.$,{view:"normal",onClick:()=>n(!t),children:t?"Hide details":"Show details"})]}),l&&t&&(0,x.jsx)(y,{hideSeverity:s,issues:o})]})}function y({issues:e,hideSeverity:s}){const t=null===e||void 0===e?void 0:e.reduce(((e,s)=>{var t;const i=null!==(t=s.severity)&&void 0!==t?t:10;return Math.min(e,i)}),10);return(0,x.jsx)("div",{className:b(null),children:null===e||void 0===e?void 0:e.map(((e,i)=>(0,x.jsx)(k,{hideSeverity:s,issue:e,expanded:e===t},i)))})}function k({issue:e,hideSeverity:s,level:t=0}){const[n,o]=i.useState(!0),l=g(e.severity),a=e.issues,c=Array.isArray(a)&&a.length>0,u=n?"bottom":"right";return(0,x.jsxs)("div",{className:N({leaf:!c,"has-issues":c}),children:[(0,x.jsxs)("div",{className:N("line"),children:[c&&(0,x.jsx)(r.$,{view:"flat-secondary",onClick:()=>o(!n),className:N("arrow-toggle"),children:(0,x.jsx)(d.I,{direction:u,size:16})}),s?null:(0,x.jsx)(C,{severity:l}),(0,x.jsx)(w,{issue:e}),e.issue_code?(0,x.jsxs)("span",{className:N("code"),children:["Code: ",e.issue_code]}):null]}),c&&n&&(0,x.jsx)("div",{className:N("issues"),children:(0,x.jsx)(S,{issues:a,level:t+1,expanded:n})})]})}function w({issue:e}){var s;const t=function(e){const{position:s}=e;if("object"!==typeof s||null===s||!(0,h.kf)(s.row))return"";const{row:t,column:i}=s;return(0,h.kf)(i)?`${t}:${i}`:`line ${t}`}(e),i=window.ydbEditor,n=()=>(0,x.jsxs)("span",{className:N("message"),children:[t&&(0,x.jsx)("span",{className:N("place-text"),title:"Position",children:t}),(0,x.jsx)("div",{className:N("message-text"),children:(0,x.jsx)(m.A,{value:e.message,expandLabel:"Show full message"})})]}),{row:o,column:l}=null!==(s=e.position)&&void 0!==s?s:{};if(!((0,h.kf)(o)&&i))return n();return(0,x.jsx)(c.N,{href:"#",onClick:()=>{const e={lineNumber:o,column:null!==l&&void 0!==l?l:0};i.setPosition(e),i.revealPositionInCenterIfOutsideViewport(e),i.focus()},view:"primary",draggable:!1,children:n()})}function S(e){const{issues:s,level:t,expanded:i}=e;return(0,x.jsx)("div",{className:N("list"),children:s.map(((e,s)=>(0,x.jsx)(k,{issue:e,level:t,expanded:i},s)))})}const D={S_INFO:n.A,S_WARNING:o.A,S_ERROR:l.A,S_FATAL:a.A},I=(0,p.cn)("yql-issue-severity");function C({severity:e}){const s=e.slice(2).toLowerCase();return(0,x.jsxs)("span",{className:I({severity:s}),children:[(0,x.jsx)(u.I,{className:I("icon"),data:D[e]}),(0,x.jsx)("span",{className:I("title"),children:s})]})}},58389:(e,s,t)=>{t.d(s,{B:()=>u});var i=t(32752),n=t(77506),o=t(90053),l=t(70043),a=t(60712);const r=(0,n.cn)("ydb-page-meta"),d="\xa0\xa0\xb7\xa0\xa0";function c({items:e,loading:s}){return(0,a.jsx)("div",{className:r("info"),children:s?(0,a.jsx)(l.E,{className:r("skeleton")}):e.filter((e=>Boolean(e))).join(d)})}function u({className:e,...s}){return(0,a.jsxs)(i.s,{gap:1,alignItems:"center",justifyContent:"space-between",className:r(null,e),children:[(0,a.jsx)(c,{...s}),(0,a.jsx)(o.E,{})]})}},67808:(e,s,t)=>{t.d(s,{E:()=>y});t(59284);var i=t(32752),n=t(13847),o=t(92459),l=t(67375),a=t(77506),r=t(56839),d=t(31684),c=t(7187),u=t(28232),m=t(12888),p=t(41650),h=t(60073),v=t(44294),g=t(25196),x=t(15132),f=t(33775),b=t(39110),N=t(60712);const j=(0,a.cn)("ydb-vdisk-info");function y({data:e,withVDiskPageLink:s,withTitle:t,className:a,wrap:c}){var y,w;const S=(0,m.X)(),D=(0,u.J)(),{AllocatedSize:I,SizeLimit:C,AllocatedPercent:T,DiskSpace:E,FrontQueues:P,Guid:z,Replicated:A,ReplicationProgress:_,ReplicationSecondsRemaining:M,Donors:O,VDiskState:R,VDiskSlotId:L,Kind:B,SatisfactionRank:$,HasUnreadableBlobs:F,IncarnationGuid:V,InstanceGuid:U,StoragePoolName:H,ReadThroughput:W,WriteThroughput:G,PDiskId:J,StringifiedId:X,NodeId:q}=e||{},K=[];var Q,Y;((0,n.isNil)(H)||K.push({label:(0,b.r)("pool-name"),value:H}),(0,n.isNil)(R)||K.push({label:(0,b.r)("state-status"),value:R}),Number(I)>=0&&Number(C)>=0&&K.push({label:(0,b.r)("size"),value:(0,N.jsx)(x.O,{value:I,capacity:C,formatValues:r.vX,colorizeProgress:!0})}),isNaN(Number(T))||K.push({label:(0,b.r)("usage"),value:`${T}%`}),(0,n.isNil)(E)||K.push({label:(0,b.r)("space-status"),value:(0,N.jsx)(f.k,{status:E})}),(0,n.isNil)(P)||K.push({label:(0,b.r)("front-queues"),value:(0,N.jsx)(f.k,{status:P})}),(0,n.isNil)(null===$||void 0===$||null===(y=$.FreshRank)||void 0===y?void 0:y.Flag))||K.push({label:(0,b.r)("fresh-rank-satisfaction"),value:(0,N.jsx)(f.k,{status:null===$||void 0===$||null===(Q=$.FreshRank)||void 0===Q?void 0:Q.Flag})});(0,n.isNil)(null===$||void 0===$||null===(w=$.LevelRank)||void 0===w?void 0:w.Flag)||K.push({label:(0,b.r)("level-rank-satisfaction"),value:(0,N.jsx)(f.k,{status:null===$||void 0===$||null===(Y=$.LevelRank)||void 0===Y?void 0:Y.Flag})});(0,n.isNil)(W)||K.push({label:(0,b.r)("read-throughput"),value:(0,p.O4)(W)}),(0,n.isNil)(G)||K.push({label:(0,b.r)("write-throughput"),value:(0,p.O4)(G)});const Z=[];if((0,n.isNil)(A)||Z.push({label:(0,b.r)("replication-status"),value:A?(0,b.r)("yes"):(0,b.r)("no")}),!1===A&&R===l.W.OK&&((0,n.isNil)(_)||Z.push({label:(0,b.r)("replication-progress"),value:(0,N.jsx)(x.O,{value:Math.round(100*_),percents:!0,colorizeProgress:!0,capacity:100})}),!(0,n.isNil)(M))){const e=(0,r.YS)(M);e&&Z.push({label:(0,b.r)("replication-time-remaining"),value:e})}if((0,n.isNil)(L)||Z.push({label:(0,b.r)("slot-id"),value:L}),!(0,n.isNil)(J)){const e=(0,n.isNil)(q)?void 0:(0,o.Ck)(J,q),s=e?(0,N.jsx)(v.E,{to:e,children:J}):J;Z.push({label:(0,b.r)("label_pdisk-id"),value:s})}if((0,n.isNil)(B)||Z.push({label:(0,b.r)("kind"),value:B}),(0,n.isNil)(z)||Z.push({label:(0,b.r)("guid"),value:z}),(0,n.isNil)(V)||Z.push({label:(0,b.r)("incarnation-guid"),value:V}),(0,n.isNil)(U)||Z.push({label:(0,b.r)("instance-guid"),value:U}),(0,n.isNil)(F)||Z.push({label:(0,b.r)("has-unreadable-blobs"),value:F?(0,b.r)("yes"):(0,b.r)("no")}),!1===A&&R===l.W.OK&&null!==O&&void 0!==O&&O.length){const e=O.map(((e,s)=>{const{StringifiedId:t,NodeId:i}=e;if(!t||!i)return null;const n=(0,o.yX)({nodeId:i,vDiskId:t},{database:D});return(0,N.jsx)(v.E,{to:n,children:t},s)})).filter(Boolean);e.length&&Z.push({label:(0,b.r)("donors"),value:(0,N.jsx)(i.s,{direction:"column",gap:1,children:e})})}const ee=[];if(!(0,n.isNil)(X)&&s){const e=(0,o.yX)({nodeId:q,vDiskId:X},{database:D});ee.push((0,N.jsx)(g.K,{title:(0,b.r)("vdisk-page"),url:e,external:!1},e))}if(S&&!(0,n.isNil)(q)&&!(0,n.isNil)(L)&&!(0,n.isNil)(J)){const e=(0,d.Wg)({nodeId:q,pDiskId:J,vDiskSlotId:L});ee.push((0,N.jsx)(g.K,{title:(0,b.r)("developer-ui"),url:e},e))}ee.length&&Z.push({label:(0,b.r)("links"),value:(0,N.jsx)(i.s,{wrap:"wrap",gap:2,children:ee})});const se=e&&t?(0,N.jsx)(k,{data:e}):null;return(0,N.jsxs)(i.s,{className:a,gap:2,direction:c?"row":"column",wrap:c,children:[(0,N.jsx)(h.z_,{title:se,info:K,renderEmptyState:()=>null,className:j("info")}),(0,N.jsx)(h.z_,{info:Z,renderEmptyState:()=>null,className:j("info")})]})}function k({data:e}){return(0,N.jsxs)("div",{className:j("title"),children:[(0,b.r)("vdiks-title"),(0,N.jsx)(f.k,{status:(0,c.XY)(e.Severity)}),e.StringifiedId]})}},69134:(e,s,t)=>{t.r(s),t.d(s,{PDiskPage:()=>ke});var i=t(59284),n=t(76938),o=t(47653),l=t(96727),a=t(29859),r=t(66212),d=t(4980),c=t(61750),u=t(80987),m=t(370),p=t(22983),h=t(3685),v=t(44508),g=t(42655),x=t(69832),f=t(45659),b=t(58389),N=t(92459),j=t(21334),y=t(67028),k=t(40174),w=t(7187),S=t(68712),D=t(7435),I=t(27295),C=t(78034);const T=j.F.injectEndpoints({endpoints:e=>({getPdiskInfo:e.query({queryFn:async({nodeId:e,pDiskId:s},{signal:t,getState:i,dispatch:n})=>{let o;o=await(0,S.FC)("/pdisk/info",void 0,{getState:i,dispatch:n})>0?window.api.pdisk.getPDiskInfo({nodeId:e,pDiskId:s},{signal:t}):window.api.viewer.getNodeWhiteboardPDiskInfo({nodeId:e,pDiskId:s},{signal:t}).then((e=>e.PDiskStateInfo?{Whiteboard:{PDisk:{...e.PDiskStateInfo[0],ExpectedSlotCount:void 0}}}:{}));try{const s=await Promise.all([o,window.api.viewer.getNodeInfo({nodeId:e},{signal:t})]);return{data:function([e={},s]){var t,i,n;const o=null===(t=s.SystemStateInfo)||void 0===t?void 0:t[0],l=(0,C.q1)(o),{BSC:a={},Whiteboard:r={}}=e||{},{PDisk:d={},VDisks:c=[]}=r,{PDisk:u={}}=a,m=(0,I.or)({...u,...d}),p=null!==(i=m.NodeId)&&void 0!==i?i:l.NodeId,{LogUsedSize:h,LogTotalSize:v,TotalSize:g,SystemSize:x,ExpectedSlotCount:f,SlotSize:b}=m;let N;if((0,D.f8)(v)){const e=100*Number(h)/Number(v);N={SlotType:"log",Used:Number(h),Total:Number(v),UsagePercent:e,Severity:(0,w.SW)(e),SlotData:{LogUsedSize:h,LogTotalSize:v,SystemSize:x}}}const j=c.map((e=>(0,I.WT)({...e,NodeId:p})));j.sort(((e,s)=>Number(s.VDiskSlotId)-Number(e.VDiskSlotId)));const y=j.map((e=>{var s;const t=(0,w.SW)(e.AllocatedPercent),i=Number(e.AllocatedSize);let n=Number(e.SizeLimit);return i>n&&(n=i),{SlotType:"vDisk",Id:null===(s=e.VDiskId)||void 0===s?void 0:s.GroupID,Title:e.StoragePoolName,Severity:t,Used:i,Total:n,UsagePercent:e.AllocatedPercent,SlotData:e}}));let k=[];if(f&&f>y.length){const e=f-y.length;let s=Number(b);if(isNaN(s)){const t=y.reduce(((e,s)=>s.Total?e+s.Total:e),0);s=(Number(g)-t-Number(v))/e}k=(0,D._e)(e).map((()=>({SlotType:"empty",Total:s,Severity:1,SlotData:{Size:s}})))}const S=[...y,...k];return N&&S.length>0&&S.unshift(N),{...m,NodeId:p,NodeHost:l.Host,NodeType:null===(n=l.Roles)||void 0===n?void 0:n[0],NodeDC:l.DC,SlotItems:S}}(s)}}catch(l){return{error:l}}},providesTags:(e,s,t)=>["All",{type:"PDiskData",id:(0,w.r$)({nodeId:t.nodeId,pDiskId:t.pDiskId})}]})}),overrideExisting:"throw"});var E=t(77506),P=t(47779),z=t(12888),A=t(81188),_=t(37377),M=t(13066),O=t(15151),R=t(58611),L=t(80136),B=t(55974),$=t(42829),F=t(48372);const V=JSON.parse('{"fqdn":"FQDN","pdisk":"PDisk","node":"Node","storage":"Storage","space-distribution":"Space distribution","empty-slot":"Empty slot","log":"Log","label.log-size":"Log Size","label.system-size":"System Size","label.slot-size":"Slot Size","no-slots-data":"No slots data","restart-pdisk-button":"Restart PDisk","force-restart-pdisk-button":"Restart anyway","restart-pdisk-not-allowed":"You don\'t have enough rights to restart PDisk","restart-pdisk-dialog-header":"Restart PDisk","restart-pdisk-dialog-text":"PDisk will be restarted. Do you want to proceed?","decommission-none":"None","decommission-imminent":"Imminent","decommission-pending":"Pending","decommission-rejected":"Rejected","decommission-label":"{{decommission}} decommission","decommission-button":"Decommission","decommission-change-not-allowed":"You don\'t have enough rights to change PDisk decommission","decommission-dialog-title":"Change decommission status","decommission-dialog-force-change":"Change anyway","decommission-dialog-imminent-warning":"This will start imminent decommission. Existing slots will be moved from the disk","decommission-dialog-pending-warning":"This will start pending decommission. Decommission will be planned for this disk, but will not start immediatelly. Existing slots will not be moved from the disk, but no new slots will be allocated on it","decommission-dialog-rejected-warning":"This will start rejected decommission. No slots from other disks are placed on this disk in the process of decommission","decommission-dialog-none-warning":"This will reset decommission mode, allowing the disk to  be used by the storage"}'),U=(0,F.g4)("ydb-pDisk-page",{en:V});var H,W,G,J;function X(){return X=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var i in t)({}).hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},X.apply(null,arguments)}const q=function(e){return i.createElement("svg",X({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 17 17",fill:"none"},e),H||(H=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.378 7.771c.717 0 1.298.614 1.298 1.372v.914c0 .758-.581 1.372-1.298 1.372H3.46c-.716 0-1.297-.614-1.297-1.372v-.914c0-.758.58-1.372 1.297-1.372h6.92zm.77-1.248L9.935 3.958a1.292 1.292 0 00-1.16-.758H5.063c-.491 0-.94.294-1.16.758L2.69 6.523c.243-.08.501-.123.77-.123h6.918c.268 0 .527.043.77.123zm1.825 1.87V10.057c0 1.515-1.162 2.743-2.595 2.743H3.46c-1.433 0-2.594-1.228-2.594-2.743V8.393c0-.71.156-1.41.456-2.044l1.421-3.004c.44-.93 1.338-1.516 2.32-1.516h3.713c.982 0 1.88.587 2.32 1.516l1.421 3.004c.3.635.457 1.335.457 2.044zm-5.19.521c-.358 0-.648.307-.648.686 0 .379.29.686.649.686h2.162c.358 0 .649-.307.649-.686 0-.379-.29-.686-.65-.686H7.785z",fill:"currentColor",fillOpacity:.85})),W||(W=i.createElement("path",{d:"M15.25 11.428c0 2.15-1.639 3.822-3.574 3.822-1.935 0-3.574-1.671-3.574-3.822 0-2.15 1.639-3.821 3.574-3.821 1.935 0 3.574 1.671 3.574 3.821z",fill:"var(--g-color-base-background)",stroke:"currentColor",strokeWidth:1.5})),G||(G=i.createElement("path",{d:"M11.676 16.5c2.69 0 4.824-2.297 4.824-5.072 0-2.774-2.134-5.071-4.824-5.071s-4.824 2.297-4.824 5.071c0 2.775 2.134 5.072 4.824 5.072z",stroke:"var(--g-color-base-background)"})),J||(J=i.createElement("path",{d:"M12.973 10.057L10.378 12.8m0-2.743l2.595 2.743",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var K=t(60712);const Q=(0,E.cn)("ydb-pdisk-decommission-button");function Y(e){return"DECOMMIT_IMMINENT"===e?U("decommission-dialog-imminent-warning"):"DECOMMIT_PENDING"===e?U("decommission-dialog-pending-warning"):"DECOMMIT_REJECTED"===e?U("decommission-dialog-rejected-warning"):"DECOMMIT_NONE"===e?U("decommission-dialog-none-warning"):void 0}function Z({decommission:e,onConfirmAction:s,onConfirmActionSuccess:t,buttonDisabled:n,popoverDisabled:o}){const[l,a]=i.useState(),[r,d]=i.useState(!1),[c,u]=i.useState(!1),m=function(e,s){return[{text:U("decommission-none"),action:()=>s("DECOMMIT_NONE"),hidden:!e||"DECOMMIT_NONE"===e||"DECOMMIT_UNSET"===e},{text:U("decommission-pending"),action:()=>s("DECOMMIT_PENDING"),hidden:"DECOMMIT_PENDING"===e},{text:U("decommission-rejected"),action:()=>s("DECOMMIT_REJECTED"),hidden:"DECOMMIT_REJECTED"===e},{text:U("decommission-imminent"),theme:"danger",action:()=>s("DECOMMIT_IMMINENT"),hidden:"DECOMMIT_IMMINENT"===e}]}(e,a);return(0,K.jsxs)(i.Fragment,{children:[(0,K.jsx)(O.r,{renderSwitcher:e=>(0,K.jsx)(ee,{popoverDisabled:o,loading:r,disabled:n,...e}),items:m,popupProps:{className:Q("popup")}}),(0,K.jsx)(B.g,{visible:Boolean(l),header:U("decommission-dialog-title"),text:Y(l),withRetry:c,withCheckBox:!0,retryButtonText:U("decommission-dialog-force-change"),onConfirm:async e=>{d(!0),await s(l,e)},onConfirmActionSuccess:async()=>{u(!1),await(0,D.uk)(5e3);try{await t()}finally{d(!1)}},onConfirmActionError:e=>{u((0,$.D)(e)),d(!1)},onClose:()=>{a(void 0)}})]})}function ee({popoverDisabled:e,...s}){return(0,K.jsx)(R.A,{content:U("decommission-change-not-allowed"),placement:"right",disabled:e,children:(0,K.jsxs)(L.$,{view:"normal",className:Q("button"),...s,children:[(0,K.jsx)(o.I,{data:q}),U("decommission-button"),(0,K.jsx)(o.I,{data:M.A})]})})}var se=t(52443);function te(e){return U("decommission-label",{decommission:e})}function ie({decommission:e}){return"DECOMMIT_IMMINENT"===e?(0,K.jsx)(se.J,{theme:"danger",size:"m",children:te(U("decommission-imminent"))}):"DECOMMIT_PENDING"===e?(0,K.jsx)(se.J,{theme:"warning",size:"m",children:te(U("decommission-pending"))}):"DECOMMIT_REJECTED"===e?(0,K.jsx)(se.J,{theme:"normal",size:"m",children:te(U("decommission-rejected"))}):null}var ne=t(88226),oe=t(50229),le=t(60073),ae=t(44294),re=t(15132),de=t(67808),ce=t(46549),ue=t(56839);const me=(0,E.cn)("ydb-pdisk-space-distribution"),pe=40;function he({data:e}){const{SlotItems:s}=e,{PDiskId:t,NodeId:i}=e,n=pe*((null===s||void 0===s?void 0:s.length)||1);return null!==s&&void 0!==s&&s.length?(0,K.jsx)("div",{className:me(null),style:{height:n,minHeight:n},children:(0,K.jsx)(ne.V,{className:me("pdisk-bar"),severity:e.Severity,diskAllocatedPercent:e.AllocatedPercent,content:null===s||void 0===s?void 0:s.map(((e,s)=>(0,K.jsx)(ve,{item:e,pDiskId:t,nodeId:i},s))),faded:!0})}):U("no-slots-data")}function ve({item:e,nodeId:s}){return(0,K.jsx)("div",{className:me("slot-wrapper"),style:{flexGrow:Number(e.Total)||1},children:(()=>{if("vDisk"===e.SlotType){var t;const i=(0,D.f8)(null===(t=e.SlotData)||void 0===t?void 0:t.StringifiedId)?(0,N.yX)({nodeId:s,vDiskId:e.SlotData.StringifiedId}):void 0;return(0,K.jsx)(oe.P,{renderPopupContent:()=>(0,K.jsx)(de.E,{data:e.SlotData,withTitle:!0}),contentClassName:me("vdisk-popup"),placement:["right","top"],children:(0,K.jsx)(ae.E,{to:i,children:(0,K.jsx)(ne.V,{className:me("slot"),severity:e.Severity,diskAllocatedPercent:e.UsagePercent,content:(0,K.jsx)(ge,{id:e.Id,title:e.Title,used:e.Used,total:e.Total})})})})}return function(e){return"log"===e.SlotType}(e)?(0,K.jsx)(oe.P,{renderPopupContent:()=>(0,K.jsx)(xe,{data:e.SlotData}),contentClassName:me("vdisk-popup"),placement:["right","top"],children:(0,K.jsx)(ne.V,{className:me("slot"),severity:e.Severity,diskAllocatedPercent:e.UsagePercent,content:(0,K.jsx)(ge,{title:U("log"),used:e.Used,total:e.Total})})}):function(e){return"empty"===e.SlotType}(e)?(0,K.jsx)(oe.P,{renderPopupContent:()=>(0,K.jsx)(fe,{data:e.SlotData}),contentClassName:me("vdisk-popup"),placement:["right","top"],children:(0,K.jsx)(ne.V,{className:me("slot"),severity:e.Severity,empty:!0,content:(0,K.jsx)(ge,{title:U("empty-slot"),used:e.Total})})}):null})()})}function ge({id:e,title:s,used:t,total:i}){return(0,K.jsxs)("div",{className:me("slot-content"),children:[(0,K.jsxs)("span",{children:[(0,D.f8)(e)?(0,K.jsx)("span",{className:me("slot-id"),children:e}):null,s]}),(0,K.jsx)("span",{className:me("slot-size"),children:(()=>{const[e,s]=(0,ue.vX)(t,i);return i?`${e} / ${s}`:e})()})]})}function xe({data:e}){const{LogTotalSize:s,LogUsedSize:t,SystemSize:i}=e,n=[{label:U("label.log-size"),value:(0,K.jsx)(re.O,{value:t,capacity:s,formatValues:ue.vX})}];return(0,D.f8)(i)&&n.push({label:U("label.system-size"),value:(0,ce.z3)({value:i})}),(0,K.jsx)(le.z_,{title:U("log"),info:n})}function fe({data:e}){const{Size:s}=e,t=[{label:U("label.slot-size"),value:(0,ce.z3)({value:s})}];return(0,K.jsx)(le.z_,{title:U("empty-slot"),info:t})}const be=(0,E.cn)("ydb-pdisk-page"),Ne={spaceDistribution:"spaceDistribution",storage:"storage"},je=[{id:Ne.spaceDistribution,get title(){return U("space-distribution")}},{id:Ne.storage,get title(){return U("storage")}}],ye=m.z.nativeEnum(Ne).catch(Ne.spaceDistribution);function ke(){const e=(0,P.YQ)(),s=(0,z.X)(),t=(0,y.c2)(),m=i.useRef(null),[{nodeId:S,pDiskId:I,activeTab:C}]=(0,u.useQueryParams)({activeTab:u.StringParam,nodeId:u.StringParam,pDiskId:u.StringParam}),E=(0,D.f8)(S)&&(0,D.f8)(I),M=ye.parse(C);i.useEffect((()=>{e((0,k.g)("pDisk",{nodeId:S,pDiskId:I}))}),[e,S,I]);const[O]=(0,P.Nt)(),R=E?{nodeId:S,pDiskId:I}:d.hT,L=T.useGetPdiskInfoQuery(R,{pollingInterval:O}),B=L.isFetching&&void 0===L.currentData,$=L.currentData,{NodeHost:F,NodeId:V,NodeType:H,NodeDC:W,Severity:G,DecommitStatus:J}=$||{},X=async e=>{if(E){const s=await window.api.pdisk[t?"restartPDisk":"restartPDiskOld"]({nodeId:S,pDiskId:I,force:e});if(!1===(null===s||void 0===s?void 0:s.result)){throw{statusText:s.error,retryPossible:s.forceRetryPossible}}}},q=async(e,s)=>{if(E){const t=await window.api.pdisk.changePDiskStatus({nodeId:S,pDiskId:I,force:s,decommissionStatus:e});if(!1===(null===t||void 0===t?void 0:t.result)){throw{statusText:t.error,retryPossible:t.forceRetryPossible}}}},Q=()=>{E&&e(j.F.util.invalidateTags([{type:"PDiskData",id:(0,w.r$)({nodeId:S,pDiskId:I})}]),"StorageData")},{appTitle:Y}=(0,A.J)();return(0,K.jsxs)("div",{className:be(null),ref:m,children:[(()=>{const e=I?`${U("pdisk")} ${I}`:U("pdisk"),s=F||U("node");return(0,K.jsx)(c.mg,{titleTemplate:`%s - ${e} \u2014 ${s} \u2014 ${Y}`,defaultTitle:`${e} \u2014 ${s} \u2014 ${Y}`})})(),(()=>{const e=F?`${U("fqdn")}: ${F}`:void 0,s=V?`${U("node")}: ${V}`:void 0;return(0,K.jsx)(b.B,{loading:B,items:[e,s,H,W],className:be("meta")})})(),(0,K.jsxs)("div",{className:be("title"),children:[(0,K.jsx)(h.$,{entityName:U("pdisk"),status:(0,w.XY)(G),id:(0,w.r$)({nodeId:S,pDiskId:I})}),(0,K.jsx)(ie,{decommission:J})]}),(0,K.jsxs)("div",{className:be("controls"),children:[(0,K.jsxs)(p.B,{onConfirmAction:X,onConfirmActionSuccess:Q,buttonDisabled:!E||!s,buttonView:"normal",dialogHeader:U("restart-pdisk-dialog-header"),dialogText:U("restart-pdisk-dialog-text"),retryButtonText:U("force-restart-pdisk-button"),withPopover:!0,popoverContent:U("restart-pdisk-not-allowed"),popoverDisabled:s,children:[(0,K.jsx)(o.I,{data:n.A}),U("restart-pdisk-button")]}),t?(0,K.jsx)(Z,{decommission:J,onConfirmAction:q,onConfirmActionSuccess:Q,buttonDisabled:!E||!s,popoverDisabled:s}):null]}),L.error?(0,K.jsx)(v.o,{error:L.error}):null,B?(0,K.jsx)(g.y,{className:be("info"),rows:10}):(0,K.jsx)(f.Q,{pDisk:$,nodeId:S,className:be("info")}),(0,K.jsx)("div",{className:be("tabs"),children:(0,K.jsx)(l.f,{value:M,children:(0,K.jsx)(a.w,{size:"l",children:je.map((({id:e,title:s})=>{const t=E?(0,N.Ck)(I,S,{activeTab:e}):void 0;return(0,K.jsx)(r.o,{value:e,children:(0,K.jsx)(x.E,{as:"tab",to:t,children:s})},e)}))})})}),(()=>{switch(M){case"spaceDistribution":return $?(0,K.jsx)("div",{className:be("disk-distribution"),children:(0,K.jsx)(he,{data:$})}):null;case"storage":return E?(0,K.jsx)(_.z,{nodeId:S,pDiskId:I,scrollContainerRef:m,viewContext:{nodeId:null===S||void 0===S?void 0:S.toString(),pDiskId:null===I||void 0===I?void 0:I.toString()}}):null;default:return null}})()]})}},70043:(e,s,t)=>{t.d(s,{E:()=>l});var i=t(1608),n=t(66781),o=t(60712);const l=({delay:e=600,className:s})=>{const[t]=(0,n.y)(e);return t?(0,o.jsx)(i.E,{className:s}):null}},74529:(e,s,t)=>{t.d(s,{A:()=>m});var i=t(59284),n=t(78540),o=t(77506),l=t(48372);const a=JSON.parse('{"default_collapse_label":"Show less","default_expand_label":"Show more","chars_count":[" ({{count}} symbol)"," ({{count}} symbols)"," ({{count}} symbols)"," ({{count}} symbols)"]}'),r=JSON.parse('{"default_collapse_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435","default_expand_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0435\u0449\u0451","chars_count":[" ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u0430)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"]}'),d=(0,l.g4)("ydb-shorty-string",{ru:r,en:a});var c=t(60712);const u=(0,o.cn)("kv-shorty-string");function m({value:e="",limit:s=200,strict:t=!1,displayLength:o=!0,render:l=e=>e,onToggle:a,expandLabel:r=d("default_expand_label"),collapseLabel:m=d("default_collapse_label")}){const[p,h]=i.useState(!1),v=(p?m:r)+(o&&!p?d("chars_count",{count:e.length}):""),g=e.length>s+(t?0:v.length),x=p||!g?e:e.slice(0,s-4)+"\xa0...";return(0,c.jsxs)("div",{className:u(),children:[l(x),g?(0,c.jsx)(n.N,{className:u("toggle"),href:"#",onClick:e=>{e.stopPropagation(),e.preventDefault(),h((e=>!e)),null===a||void 0===a||a()},children:v}):null]})}},76938:(e,s,t)=>{t.d(s,{A:()=>n});var i=t(59284);const n=e=>i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),i.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 1.5a6.5 6.5 0 1 1-6.445 7.348.75.75 0 1 1 1.487-.194A5.001 5.001 0 1 0 4.43 4.5h1.32a.75.75 0 0 1 0 1.5h-3A.75.75 0 0 1 2 5.25v-3a.75.75 0 0 1 1.5 0v1.06A6.48 6.48 0 0 1 8 1.5",clipRule:"evenodd"}))},79879:(e,s,t)=>{t.d(s,{A:()=>n});var i=t(59284);const n=e=>i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),i.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"m3.003 4.702 4.22-2.025a1.8 1.8 0 0 1 1.554 0l4.22 2.025a.89.89 0 0 1 .503.8V6a8.55 8.55 0 0 1-3.941 7.201l-.986.631a1.06 1.06 0 0 1-1.146 0l-.986-.63A8.55 8.55 0 0 1 2.5 6v-.498c0-.341.196-.652.503-.8m3.57-3.377L2.354 3.35A2.39 2.39 0 0 0 1 5.502V6a10.05 10.05 0 0 0 4.632 8.465l.986.63a2.56 2.56 0 0 0 2.764 0l.986-.63A10.05 10.05 0 0 0 15 6v-.498c0-.918-.526-1.755-1.354-2.152l-4.22-2.025a3.3 3.3 0 0 0-2.852 0M9.5 7a1.5 1.5 0 0 1-.75 1.3v1.95a.75.75 0 0 1-1.5 0V8.3A1.5 1.5 0 1 1 9.5 7",clipRule:"evenodd"}))}}]);