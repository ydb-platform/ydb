(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[3933],{28265:(e,t,a)=>{"use strict";a.d(t,{J:()=>b});var n=a(64485),r=a(15327),i=a(67386),s=a(74647),o=a.n(s),l=a(78759),c=a(4969);const d=l.h.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.getTabletsInfo(e,{signal:a})}}catch(n){return{error:n}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),u=(0,i.P1)((e=>e),(e=>d.endpoints.getTabletsInfo.select(e)),{argsMemoize:i.PP,argsMemoizeOptions:{equalityCheck:o()}}),m=(0,i.P1)((e=>e),((e,t)=>u(t)),((e,t)=>t(e).data)),p=(0,i.P1)(((e,t)=>m(e,t)),(e=>(0,c.s)(e)),((e,t)=>null!==e&&void 0!==e&&e.TabletStateInfo?t?e.TabletStateInfo.map((e=>{const a=void 0===e.NodeId?void 0:t.get(e.NodeId);return{...e,fqdn:a}})):e.TabletStateInfo:[]));var h=a(99294),v=a(55842),x=a(72427),g=a(10161);const y=(0,h.cn)("tablets");function b(e){let{nodeId:t,path:a,database:i,className:s}=e;const[o]=(0,v.Rj)();let l={};const c=void 0===t?void 0:String(t);void 0!==c?l={nodeId:c,database:i}:a&&(l={path:a,database:i});const{currentData:u,isFetching:m,error:h}=d.useGetTabletsInfoQuery(0===Object.keys(l).length?n.CN:l,{pollingInterval:o}),b=m&&void 0===u,f=(0,v.ix)((e=>p(e,l)));return(0,g.jsxs)("div",{className:y(null,s),children:[h?(0,g.jsx)(r.V,{error:h}):null,u||b?(0,g.jsx)(x.O,{tablets:f,database:i,loading:b}):null]})}},16033:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Tenant:()=>Hv});var n=a(34706),r=a(42152),i=a(99495),s=a(93225),o=a(48653),l=a(28206),c=a(99294),d=a(10161);const u=(0,c.cn)("kv-split"),m=[0,100],p=[50,50];const h=function(e){const[t,a]=n.useState(),r=t=>{const{defaultSizePaneKey:a}=e;localStorage.setItem(a,t.join(","))};return n.useEffect((()=>{const{collapsedSizes:t,triggerCollapse:n}=e;if(n){const e=t||m;r(e),a(e)}}),[e.triggerCollapse]),n.useEffect((()=>{const{triggerExpand:t,defaultSizes:n}=e,i=n||p;t&&(r(i),a(i))}),[e.triggerExpand]),(0,d.jsx)(n.Fragment,{children:(0,d.jsx)(l.Z,{direction:e.direction||"horizontal",sizes:t||(()=>{var t;const{defaultSizePaneKey:a,defaultSizes:n=p,initialSizes:r}=e;if(r)return r;return(null===(t=localStorage.getItem(a))||void 0===t?void 0:t.split(",").map(Number))||n})(),minSize:e.minSize||[0,0],onDrag:t=>{const{onSplitDragAdditional:a}=e;a&&a(),r(t)},className:u(null,e.direction||"horizontal"),gutterSize:8,onDragStart:()=>{const{onSplitStartDragAdditional:t}=e;t&&t(),a(void 0)},expandToMin:!0,children:e.children})})};var v,x,g=a(85709),y=a(67386),b=a(64485);let f,E;var S;let T,j;var N,C,w,P,I;let D;var _,R,A,O,M,k,L;!function(e){e.StatusSuccess="StatusSuccess",e.StatusAccepted="StatusAccepted",e.StatusPathDoesNotExist="StatusPathDoesNotExist",e.StatusPathIsNotDirectory="StatusPathIsNotDirectory",e.StatusAlreadyExists="StatusAlreadyExists",e.StatusSchemeError="StatusSchemeError",e.StatusNameConflict="StatusNameConflict",e.StatusInvalidParameter="StatusInvalidParameter",e.StatusMultipleModifications="StatusMultipleModifications",e.StatusReadOnly="StatusReadOnly",e.StatusTxIdNotExists="StatusTxIdNotExists",e.StatusTxIsNotCancellable="StatusTxIsNotCancellable",e.StatusAccessDenied="StatusAccessDenied",e.StatusNotAvailable="StatusNotAvailable",e.StatusPreconditionFailed="StatusPreconditionFailed",e.StatusRedirectDomain="StatusRedirectDomain",e.StatusQuotaExceeded="StatusQuotaExceeded",e.StatusResourceExhausted="StatusResourceExhausted"}(v||(v={})),function(e){e.UNKNOWN="UNKNOWN",e.USER="USER",e.GROUP="GROUP"}(x||(x={})),function(e){e.EPathTypeInvalid="EPathTypeInvalid",e.EPathTypeDir="EPathTypeDir",e.EPathTypeTable="EPathTypeTable",e.EPathTypePersQueueGroup="EPathTypePersQueueGroup",e.EPathTypeSubDomain="EPathTypeSubDomain",e.EPathTypeTableIndex="EPathTypeTableIndex",e.EPathTypeExtSubDomain="EPathTypeExtSubDomain",e.EPathTypeColumnStore="EPathTypeColumnStore",e.EPathTypeColumnTable="EPathTypeColumnTable",e.EPathTypeCdcStream="EPathTypeCdcStream",e.EPathTypeExternalDataSource="EPathTypeExternalDataSource",e.EPathTypeExternalTable="EPathTypeExternalTable",e.EPathTypeView="EPathTypeView",e.EPathTypeReplication="EPathTypeReplication"}(f||(f={})),function(e){e.EPathSubTypeEmpty="EPathSubTypeEmpty",e.EPathSubTypeSyncIndexImplTable="EPathSubTypeSyncIndexImplTable",e.EPathSubTypeAsyncIndexImplTable="EPathSubTypeAsyncIndexImplTable",e.EPathSubTypeStreamImpl="EPathSubTypeStreamImpl"}(E||(E={})),function(e){e.EPathStateNotExist="EPathStateNotExist",e.EPathStateNoChanges="EPathStateNoChanges",e.EPathStateCreate="EPathStateCreate",e.EPathStateAlter="EPathStateAlter",e.EPathStateDrop="EPathStateDrop",e.EPathStateCopying="EPathStateCopying",e.EPathStateBackup="EPathStateBackup",e.EPathStateUpgrade="EPathStateUpgrade",e.EPathStateMigrated="EPathStateMigrated",e.EPathStateRestore="EPathStateRestore",e.EPathStateMoving="EPathStateMoving"}(S||(S={})),function(e){e.ColumnCodecPlain="ColumnCodecPlain",e.ColumnCodecLZ4="ColumnCodecLZ4",e.ColumnCodecZSTD="ColumnCodecZSTD"}(T||(T={})),function(e){e.UNIT_AUTO="UNIT_AUTO",e.UNIT_SECONDS="UNIT_SECONDS",e.UNIT_MILLISECONDS="UNIT_MILLISECONDS",e.UNIT_MICROSECONDS="UNIT_MICROSECONDS",e.UNIT_NANOSECONDS="UNIT_NANOSECONDS"}(j||(j={})),function(e){e.ECdcStreamModeInvalid="ECdcStreamModeInvalid",e.ECdcStreamModeKeysOnly="ECdcStreamModeKeysOnly",e.ECdcStreamModeUpdate="ECdcStreamModeUpdate",e.ECdcStreamModeNewImage="ECdcStreamModeNewImage",e.ECdcStreamModeOldImage="ECdcStreamModeOldImage",e.ECdcStreamModeNewAndOldImages="ECdcStreamModeNewAndOldImages"}(N||(N={})),function(e){e.ECdcStreamFormatInvalid="ECdcStreamFormatInvalid",e.ECdcStreamFormatProto="ECdcStreamFormatProto",e.ECdcStreamFormatJson="ECdcStreamFormatJson"}(C||(C={})),function(e){e.ECdcStreamStateInvalid="ECdcStreamStateInvalid",e.ECdcStreamStateReady="ECdcStreamStateReady",e.ECdcStreamStateDisabled="ECdcStreamStateDisabled"}(w||(w={})),function(e){e.HASH_FUNCTION_MODULO_N="HASH_FUNCTION_MODULO_N",e.HASH_FUNCTION_CLOUD_LOGS="HASH_FUNCTION_CLOUD_LOGS"}(P||(P={})),function(e){e.COLUMN_ENGINE_NONE="COLUMN_ENGINE_NONE",e.COLUMN_ENGINE_REPLACING_TIMESERIES="COLUMN_ENGINE_REPLACING_TIMESERIES"}(I||(I={})),function(e){e.METERING_MODE_RESERVED_CAPACITY="METERING_MODE_RESERVED_CAPACITY",e.METERING_MODE_REQUEST_UNITS="METERING_MODE_REQUEST_UNITS"}(D||(D={})),function(e){e.SysLog="SysLog",e.Log="Log",e.Data="Data",e.External="External"}(_||(_={})),function(e){e.Unspecified="Unspecified",e.Freeze="Freeze",e.Unfreeze="Unfreeze"}(R||(R={})),function(e){e.ColumnCacheNone="ColumnCacheNone",e.ColumnCacheOnce="ColumnCacheOnce",e.ColumnCacheEver="ColumnCacheEver"}(A||(A={})),function(e){e.ColumnStorage1="ColumnStorage1",e.ColumnStorage2="ColumnStorage2",e.ColumnStorage1Ext1="ColumnStorage1Ext1",e.ColumnStorage1Ext2="ColumnStorage1Ext2",e.ColumnStorage2Ext1="ColumnStorage2Ext1",e.ColumnStorage2Ext2="ColumnStorage2Ext2",e.ColumnStorage1Med2Ext2="ColumnStorage1Med2Ext2",e.ColumnStorage2Med2Ext2="ColumnStorage2Med2Ext2",e.ColumnStorageTest_1_2_1k="ColumnStorageTest_1_2_1k"}(O||(O={})),function(e){e.CompactionStrategyUnset="CompactionStrategyUnset",e.CompactionStrategyGenerational="CompactionStrategyGenerational",e.CompactionStrategySharded="CompactionStrategySharded"}(M||(M={})),function(e){e.EIndexTypeInvalid="EIndexTypeInvalid",e.EIndexTypeGlobal="EIndexTypeGlobal",e.EIndexTypeGlobalAsync="EIndexTypeGlobalAsync"}(k||(k={})),function(e){e.EIndexStateInvalid="EIndexStateInvalid",e.EIndexStateReady="EIndexStateReady",e.EIndexStateNotReady="EIndexStateNotReady",e.EIndexStateWriteOnly="EIndexStateWriteOnly"}(L||(L={}));const z={[E.EPathSubTypeSyncIndexImplTable]:"index_table",[E.EPathSubTypeAsyncIndexImplTable]:"index_table",[E.EPathSubTypeStreamImpl]:void 0,[E.EPathSubTypeEmpty]:void 0},q={[f.EPathTypeInvalid]:void 0,[f.EPathTypeSubDomain]:"database",[f.EPathTypeExtSubDomain]:"database",[f.EPathTypeDir]:"directory",[f.EPathTypeColumnStore]:"directory",[f.EPathTypeTable]:"table",[f.EPathTypeTableIndex]:"index",[f.EPathTypeColumnTable]:"column_table",[f.EPathTypeCdcStream]:"stream",[f.EPathTypePersQueueGroup]:"topic",[f.EPathTypeExternalDataSource]:"external_data_source",[f.EPathTypeExternalTable]:"external_table",[f.EPathTypeView]:"view",[f.EPathTypeReplication]:"async_replication"},U={table:f.EPathTypeTable,index:f.EPathTypeTableIndex,column_table:f.EPathTypeColumnTable,external_table:f.EPathTypeExternalTable,view:f.EPathTypeView},F=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.EPathTypeDir,t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"directory";return t&&z[t]||q[e]||a},Q={[E.EPathSubTypeSyncIndexImplTable]:"Secondary Index Table",[E.EPathSubTypeAsyncIndexImplTable]:"Secondary Index Table",[E.EPathSubTypeStreamImpl]:void 0,[E.EPathSubTypeEmpty]:void 0},G={[f.EPathTypeInvalid]:void 0,[f.EPathTypeSubDomain]:"Database",[f.EPathTypeExtSubDomain]:"Database",[f.EPathTypeDir]:"Directory",[f.EPathTypeTable]:"Table",[f.EPathTypeTableIndex]:"Secondary Index",[f.EPathTypeColumnStore]:"Tablestore",[f.EPathTypeColumnTable]:"Column-oriented table",[f.EPathTypeCdcStream]:"Changefeed",[f.EPathTypePersQueueGroup]:"Topic",[f.EPathTypeExternalDataSource]:"External Data Source",[f.EPathTypeExternalTable]:"External Table",[f.EPathTypeView]:"View",[f.EPathTypeReplication]:"Async Replication"},B={UnknownTenantType:"Database",Domain:"Cluster Root",Dedicated:"Dedicated Database",Shared:"Shared Database",Serverless:"Serverless Database"},$=e=>e&&B[e],V={[f.EPathTypeTable]:!0,[f.EPathTypeColumnTable]:!0,[f.EPathTypeExternalTable]:!0,[f.EPathTypeView]:!0,[f.EPathTypeInvalid]:!1,[f.EPathTypeDir]:!1,[f.EPathTypeSubDomain]:!1,[f.EPathTypeTableIndex]:!1,[f.EPathTypeExtSubDomain]:!1,[f.EPathTypeColumnStore]:!1,[f.EPathTypeCdcStream]:!1,[f.EPathTypePersQueueGroup]:!1,[f.EPathTypeExternalDataSource]:!1,[f.EPathTypeReplication]:!1},H=e=>{var t;return null!==(t=e&&V[e])&&void 0!==t&&t},Z={[E.EPathSubTypeSyncIndexImplTable]:!0,[E.EPathSubTypeAsyncIndexImplTable]:!0,[E.EPathSubTypeStreamImpl]:!1,[E.EPathSubTypeEmpty]:!1},W=e=>{var t;return null!==(t=e&&Z[e])&&void 0!==t&&t},J={[f.EPathTypeColumnStore]:!0,[f.EPathTypeColumnTable]:!0,[f.EPathTypeInvalid]:!1,[f.EPathTypeDir]:!1,[f.EPathTypeTable]:!1,[f.EPathTypeSubDomain]:!1,[f.EPathTypeTableIndex]:!1,[f.EPathTypeExtSubDomain]:!1,[f.EPathTypeCdcStream]:!1,[f.EPathTypePersQueueGroup]:!1,[f.EPathTypeExternalDataSource]:!1,[f.EPathTypeExternalTable]:!1,[f.EPathTypeView]:!1,[f.EPathTypeReplication]:!1},K=e=>{var t;return null!==(t=e&&J[e])&&void 0!==t&&t},Y={[f.EPathTypeSubDomain]:!0,[f.EPathTypeExtSubDomain]:!0,[f.EPathTypeInvalid]:!1,[f.EPathTypeDir]:!1,[f.EPathTypeColumnStore]:!1,[f.EPathTypeColumnTable]:!1,[f.EPathTypeTable]:!1,[f.EPathTypeTableIndex]:!1,[f.EPathTypeCdcStream]:!1,[f.EPathTypePersQueueGroup]:!1,[f.EPathTypeExternalDataSource]:!1,[f.EPathTypeExternalTable]:!1,[f.EPathTypeView]:!1,[f.EPathTypeReplication]:!1},X=e=>{var t;return null!==(t=e&&Y[e])&&void 0!==t&&t},ee={[f.EPathTypeCdcStream]:!0,[f.EPathTypePersQueueGroup]:!1,[f.EPathTypeInvalid]:!1,[f.EPathTypeColumnStore]:!1,[f.EPathTypeColumnTable]:!1,[f.EPathTypeDir]:!1,[f.EPathTypeTable]:!1,[f.EPathTypeSubDomain]:!1,[f.EPathTypeTableIndex]:!1,[f.EPathTypeExtSubDomain]:!1,[f.EPathTypeExternalDataSource]:!1,[f.EPathTypeExternalTable]:!1,[f.EPathTypeView]:!1,[f.EPathTypeReplication]:!1},te=e=>{var t;return null!==(t=e&&ee[e])&&void 0!==t&&t},ae={[E.EPathSubTypeSyncIndexImplTable]:!0,[E.EPathSubTypeAsyncIndexImplTable]:!0,[E.EPathSubTypeStreamImpl]:!1,[E.EPathSubTypeEmpty]:!1},ne={[f.EPathTypeCdcStream]:!0,[f.EPathTypePersQueueGroup]:!0,[f.EPathTypeExternalDataSource]:!0,[f.EPathTypeExternalTable]:!0,[f.EPathTypeView]:!0,[f.EPathTypeReplication]:!0,[f.EPathTypeInvalid]:!1,[f.EPathTypeColumnStore]:!1,[f.EPathTypeColumnTable]:!1,[f.EPathTypeDir]:!1,[f.EPathTypeTable]:!1,[f.EPathTypeSubDomain]:!1,[f.EPathTypeTableIndex]:!1,[f.EPathTypeExtSubDomain]:!1},re=(e,t)=>{var a;return null!==(a=t&&ae[t]||e&&ne[e])&&void 0!==a&&a},ie=(f.EPathTypeCdcStream,f.EPathTypePersQueueGroup,f.EPathTypeInvalid,f.EPathTypeColumnStore,f.EPathTypeColumnTable,f.EPathTypeDir,f.EPathTypeTable,f.EPathTypeSubDomain,f.EPathTypeTableIndex,f.EPathTypeExtSubDomain,f.EPathTypeExternalDataSource,f.EPathTypeExternalTable,f.EPathTypeView,f.EPathTypeReplication,e=>e===f.EPathTypeExternalTable),se=e=>e===f.EPathTypeTable,oe=e=>e===f.EPathTypeView;var le=a(78759);const ce=le.h.injectEndpoints({endpoints:e=>({getMultiOverview:e.query({queryFn:async(e,t)=>{let{paths:a,database:n}=e,{signal:r}=t;try{return{data:await Promise.all(a.map((e=>window.api.getDescribe({path:e,database:n},{signal:r}))))}}catch(i){return{error:i}}},keepUnusedDataFor:0,providesTags:["All"]}),getOverview:e.query({queryFn:async(e,t)=>{let{path:a,database:n}=e,{signal:r}=t;try{return{data:await window.api.getDescribe({path:a,database:n},{signal:r})}}catch(i){return{error:i}}},keepUnusedDataFor:0,providesTags:["All"]})})}),de=(0,y.P1)((e=>e),((e,t)=>t),((e,t)=>ce.endpoints.getOverview.select({path:e,database:t}))),ue=(0,y.P1)((e=>e),((e,t,a)=>de(t,a)),((e,t)=>t(e).data)),me=(0,y.P1)([(e,t)=>t,(e,t,a)=>a,(e,t,a,n)=>((e,t,a)=>{var n,r;return null===(n=ue(e,t,a))||void 0===n||null===(r=n.PathDescription)||void 0===r?void 0:r.Children})(e,t,n)],((e,t,a)=>te(t)?null===a||void 0===a?void 0:a.map((t=>{let{Name:a}=t;return e+"/"+a})):void 0));function pe(e){let{paths:t,database:a,autoRefreshInterval:n}=e;const[r,...i]=t,{currentData:s,isFetching:o,error:l}=ce.useGetOverviewQuery({path:r,database:a},{pollingInterval:n}),{currentData:c,isFetching:d,error:u}=ce.useGetMultiOverviewQuery(i.length?{paths:i,database:a}:b.CN,{pollingInterval:n});return{loading:o&&void 0===s||d&&void 0===c,error:l||u,mergedDescribe:[s,...null!==c&&void 0!==c?c:[]].reduce(((e,t)=>(null!==t&&void 0!==t&&t.Path&&(e[t.Path]=t),e)),{})}}var he=a(27810),ve=a(55842),xe=a(53785),ge=a(53096),ye=a(72555),be=a(26836),fe=a(74003),Ee=a(39202),Se=a(27084),Te=a(26390),je=a(19912),Ne=a(15327),Ce=a(66498),we=a(51992),Pe=a(32678),Ie=a(38980),De=a(42542),_e=a.n(De),Re=a(46878),Ae=a(78276);const Oe=(0,c.cn)("heatmap"),Me={width:0,height:0},ke=10,Le=2,ze=e=>{const[t,a]=n.useState(Me),{tablets:r}=e,i=n.useRef(null),s=n.useRef(null);n.useEffect((()=>{const e=i.current,a=e.getContext("2d");a.clearRect(0,0,e.offsetWidth,e.offsetHeight),r.map(function(e){return(a,n)=>{const{columnsCount:r}=t,i=n%r*(ke+Le),s=Math.floor(n/r)*(ke+Le);e.fillStyle=a.color||"grey",e.fillRect(i,s,ke,ke)}}(a))})),n.useLayoutEffect((()=>{const e=s.current;if(e){const t=e.offsetWidth-15,n=Math.floor(t/(ke+Le)),i=Math.ceil(r.length/n);a({width:t,height:i*(ke+Le),columnsCount:n,rowsCount:i})}}),[]);const o=()=>{let e=i.current,t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t},l=()=>{let e=i.current,t=0;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t},c=(e,a)=>{const{columnsCount:n}=t,r=ke+Le,i=ke+Le,s=Math.floor(e/r);return n*Math.floor(a/i)+s},u=_e()(((t,a)=>{const n=new CustomEvent("scroll");window.dispatchEvent(n);const i=e.parentRef.current,s=t-l()+i.scrollLeft,d=a-o()+i.scrollTop,u=c(s,d),m=r[u];if(m){const n={name:m.currentMetric,value:m.formattedValue};e.showTooltip(void 0,m,"tablet",n,{left:t-20,top:a-20})}else e.hideTooltip()}),20);return(0,d.jsx)("div",{ref:s,className:Oe("canvas-container"),onMouseLeave:()=>{setTimeout((()=>{e.hideTooltip()}),40)},children:(0,d.jsx)("canvas",{ref:i,width:t.width,height:t.height,onClick:t=>{const a=e.parentRef.current,n=t.clientX-l()+a.scrollLeft,i=t.clientY-o()+a.scrollTop,s=c(n,i),d=r[s];d&&window.open((e=>{const{TabletId:t}=e,a=window.location.hostname,n=(0,Re.fK)(t);return`https://${[a,Ae.EZ,n].map((e=>e.startsWith("/")?e.slice(1):e)).filter(Boolean).join("/")}`})(d),"_blank")},onMouseMove:e=>u(e.clientX,e.clientY)})})},qe={r:255,g:4,b:0},Ue={r:255,g:219,b:77},Fe={r:59,g:201,b:53},Qe={CPU:{min:0,max:1e6},Network:{min:0,max:1e9},Storage:{min:0,max:2e9},DataSize:{min:0,max:2e9},RowCount:{min:0},IndexSize:{min:0}},Ge=e=>{const t=e.toString(16);return 1===t.length?`0${t}`:t},Be=(e,t,a)=>{if(1===e)return[t];if(2===e)return[t,a];const n=(t.r-a.r)/(e-1),r=(t.g-a.g)/(e-1),i=(t.b-a.b)/(e-1),s=[];for(let o=0;o<e;o++)s.push({r:Math.round(t.r-n*o),g:Math.round(t.g-r*o),b:Math.round(t.b-i*o)});return s.map((e=>(e=>{let{r:t,g:a,b:n}=e;return`#${Ge(t)}${Ge(a)}${Ge(n)}`})(e)))},$e=e=>{const t=Math.floor(e/2),a=t+1;return[...Be(e%2===0?t:t+1,Fe,Ue),...Be(a,Ue,qe).slice(1)]},Ve=(e,t)=>{const a=new Set,n=Qe[e]||{};t.forEach((t=>{var n;a.add(Number(null===(n=t.metrics)||void 0===n?void 0:n[e]))})),Number.isInteger(n.min)&&a.add(n.min),Number.isInteger(n.max)&&a.add(n.max);const r=Array.from(a.values()).sort(((e,t)=>e-t));return{min:r[0],max:r[r.length-1]}},He=(0,c.cn)("histogram"),Ze=e=>{const t=n.useRef(),{data:a={},maxCount:r}=e,{count:i,leftBound:s,rightBound:o,color:l}=a,c=i/r*100;return(0,d.jsx)("div",{ref:t,className:He("item"),style:{backgroundColor:l,height:`${c}%`},onMouseEnter:()=>{const a=t.current;e.showTooltip(a,{count:i,leftBound:s,rightBound:o},"histogram")},onMouseLeave:e.hideTooltip})},We=e=>{const{tablets:t,currentMetric:a}=e,{min:n,max:r}=Ve(a,t),i=$e(50),s=(r-n)/50,o=i.map(((e,t)=>({color:e,count:0,leftBound:(0,Ie.uf)(n+t*s),rightBound:(0,Ie.uf)(n+(t+1)*s)})));let l=0;t.forEach((e=>{var t,n;const r=a&&Number(null===(t=e.metrics)||void 0===t?void 0:t[a]),i=Math.floor(r/s),c=(null===(n=o[i])||void 0===n?void 0:n.count)+1;c>l&&(l=c),o[i]={...o[i],count:c}}));return(0,d.jsx)("div",{className:He(),children:(0,d.jsxs)("div",{className:He("chart"),children:[Boolean(r)&&o.map(((t,a)=>(0,d.jsx)(Ze,{data:t,maxCount:l,showTooltip:e.showTooltip,hideTooltip:e.hideTooltip},a))),(0,d.jsx)("div",{className:He("x-min"),children:(0,Ie.uf)(n)}),(0,d.jsx)("div",{className:He("x-max"),children:(0,Ie.uf)(r)}),(0,d.jsx)("div",{className:He("y-min"),children:"0"}),(0,d.jsx)("div",{className:He("y-max"),children:(0,Ie.uf)(l)})]})})},Je=(0,c.cn)("heatmap"),Ke=$e(500),Ye=e=>{let{path:t,database:a}=e;const r=(0,ve.zL)(),i=n.createRef(),[s]=(0,ve.Rj)(),{currentData:o,isFetching:l,error:c}=we.Vc.useGetHeatmapTabletsInfoQuery({path:t,database:a},{pollingInterval:s}),u=l&&void 0===o,{tablets:m=[],metrics:p}=o||{},{sort:h,heatmap:v,currentMetric:x}=(0,ve.ix)((e=>e.heatmap)),g=function(){r((0,Pe.hJ)(...arguments))},y=()=>{r((0,Pe.i8)())},b=e=>{r((0,we.U_)({currentMetric:e[0]}))},f=()=>{r((0,we.U_)({sort:!h}))},E=()=>{r((0,we.U_)({heatmap:!v}))},S=()=>{const{min:e,max:t}=Ve(x,m),a=m.map((a=>{var n;const r=x&&Number(null===(n=a.metrics)||void 0===n?void 0:n[x]),i=((e,t,a)=>0===a?0:Math.round((e-t)/(a-t)*499))(r,e,t),s=Ke[i];return{...a,color:s,value:r,formattedValue:(0,Ie.uf)(r),currentMetric:x}})),n=h?a.sort(((e,t)=>Number(t.value)-Number(e.value))):a;return(0,d.jsx)("div",{ref:i,className:Je("items"),children:(0,d.jsx)(ze,{tablets:n,parentRef:i,showTooltip:g,hideTooltip:y})})};return u?(0,d.jsx)(Ce.a,{}):(()=>{const{min:e,max:t}=Ve(x,m);let a;return c&&!o||(a=v?S():(0,d.jsx)(We,{tablets:m,currentMetric:x,showTooltip:g,hideTooltip:y})),(0,d.jsxs)("div",{className:Je(),children:[(0,d.jsxs)("div",{className:Je("filters"),children:[(0,d.jsx)(Te.P,{className:Je("heatmap-select"),value:x?[x]:[],options:p,onUpdate:b,width:200}),(0,d.jsx)("div",{className:Je("sort-checkbox"),children:(0,d.jsx)(je.X,{onUpdate:f,checked:h,children:"Sort"})}),(0,d.jsx)("div",{className:Je("histogram-checkbox"),children:(0,d.jsx)(je.X,{onUpdate:E,checked:v,children:"Heatmap"})}),(0,d.jsxs)("div",{className:Je("limits"),children:[(0,d.jsxs)("div",{className:Je("limits-block"),children:[(0,d.jsx)("div",{className:Je("limits-title"),children:"min:"}),(0,d.jsx)("div",{className:Je("limits-value"),children:Number.isInteger(e)?(0,Ie.uf)(e):"\u2014"})]}),(0,d.jsxs)("div",{className:Je("limits-block"),children:[(0,d.jsx)("div",{className:Je("limits-title"),children:"max:"}),(0,d.jsx)("div",{className:Je("limits-value"),children:Number.isInteger(t)?(0,Ie.uf)(t):"\u2014"})]}),(0,d.jsxs)("div",{className:Je("limits-block"),children:[(0,d.jsx)("div",{className:Je("limits-title"),children:"count:"}),(0,d.jsx)("div",{className:Je("limits-value"),children:(0,Ie.uf)(m.length)})]})]})]}),c?(0,d.jsx)(Ne.V,{error:c}):null,a]})})()};var Xe=a(78294),et=a(71037),tt=a(74116),at=a(74640);const nt=le.h.injectEndpoints({endpoints:e=>({getOperationList:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.getOperationList(e,{signal:a})}}catch(n){return{error:n}}},providesTags:["All"]}),cancelOperation:e.mutation({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.cancelOperation(e,{signal:a})}}catch(n){return{error:n}}}}),forgetOperation:e.mutation({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.forgetOperation(e,{signal:a})}}catch(n){return{error:n}}}})}),overrideExisting:"throw"});var rt=a(34973),it=a(17784),st=a(37711);const ot=JSON.parse('{"label_operations":"Operations","title_empty":"No operations data","pleaceholder_search":"Search operations","placeholder_kind":"Select operation kind","kind_ssBackgrounds":"SS/Backgrounds","kind_export":"Export","kind_buildIndex":"Build Index","column_operationId":"Operation ID","column_status":"Status","column_createdBy":"Created By","column_createTime":"Create Time","column_endTime":"End Time","column_duration":"Duration","label_duration-ongoing":"{{value}} (ongoing)","header_cancel":"Cancel operation","header_forget":"Forget operation","text_cancel":"The operation will be cancelled. Do you want to proceed?","text_forget":"The operation will be forgotten. Do you want to proceed?","text_forgotten":"The operation {{id}} has been forgotten","text_cancelled":"The operation {{id}} has been cancelled"}'),lt=(0,st.wZ)("ydb-operations",{en:ot}),ct={ID:"id",STATUS:"status",CREATED_BY:"created_by",CREATE_TIME:"create_time",END_TIME:"end_time",DURATION:"duration"},dt={[ct.ID]:lt("column_operationId"),[ct.STATUS]:lt("column_status"),[ct.CREATED_BY]:lt("column_createdBy"),[ct.CREATE_TIME]:lt("column_createTime"),[ct.END_TIME]:lt("column_endTime"),[ct.DURATION]:lt("column_duration")},ut=(ct.ID,ct.STATUS,ct.CREATED_BY,ct.CREATE_TIME,ct.END_TIME,ct.DURATION,[{value:"export",content:lt("kind_export")},{value:"ss/backgrounds",content:lt("kind_ssBackgrounds")},{value:"buildindex",content:lt("kind_buildIndex")}]),mt=(0,c.cn)("operations");function pt(e){let{kind:t,searchValue:a,entitiesCountCurrent:r,entitiesCountTotal:i,entitiesLoading:s,handleKindChange:o,handleSearchChange:l}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(it.o,{value:a,onChange:l,placeholder:lt("pleaceholder_search"),className:mt("search")}),(0,d.jsx)(Te.P,{value:[t],width:150,options:ut,onUpdate:e=>o(e[0])}),(0,d.jsx)(rt.C,{label:lt("label_operations"),loading:s,total:i,current:r})]})}var ht=a(42805),vt=a(54296),xt=a(12205),gt=a(23795),yt=a(79777),bt=a(90132),ft=a(14561),Et=a(55982),St=a(61168);let Tt,jt;!function(e){e.STATUS_CODE_UNSPECIFIED="STATUS_CODE_UNSPECIFIED",e.SUCCESS="SUCCESS",e.BAD_REQUEST="BAD_REQUEST",e.UNAUTHORIZED="UNAUTHORIZED",e.INTERNAL_ERROR="INTERNAL_ERROR",e.ABORTED="ABORTED",e.UNAVAILABLE="UNAVAILABLE",e.OVERLOADED="OVERLOADED",e.SCHEME_ERROR="SCHEME_ERROR",e.GENERIC_ERROR="GENERIC_ERROR",e.TIMEOUT="TIMEOUT",e.BAD_SESSION="BAD_SESSION",e.PRECONDITION_FAILED="PRECONDITION_FAILED",e.ALREADY_EXISTS="ALREADY_EXISTS",e.NOT_FOUND="NOT_FOUND",e.SESSION_EXPIRED="SESSION_EXPIRED",e.CANCELLED="CANCELLED",e.UNDETERMINED="UNDETERMINED",e.UNSUPPORTED="UNSUPPORTED",e.SESSION_BUSY="SESSION_BUSY",e.EXTERNAL_ERROR="EXTERNAL_ERROR"}(Tt||(Tt={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PREPARING="STATE_PREPARING",e.STATE_TRANSFERING_DATA="STATE_TRANSFERING_DATA",e.STATE_APPLYING="STATE_APPLYING",e.STATE_DONE="STATE_DONE",e.STATE_CANCELLATION="STATE_CANCELLATION",e.STATE_CANCELLED="STATE_CANCELLED",e.STATE_REJECTION="STATE_REJECTION",e.STATE_REJECTED="STATE_REJECTED"}(jt||(jt={}));var Nt=a(72484);const Ct=function(e){let{name:t,title:a,type:n,content:r}=e;return Nt.m.add({name:null!==t&&void 0!==t?t:"Request succeeded",title:null!==a&&void 0!==a?a:"Request succeeded",theme:"error"===n?"danger":"success",content:r,isClosable:!0,autoHiding:"success"===n&&5e3})};var wt=a(83627);function Pt(e){let{database:t,refreshTable:a}=e;return[{name:ct.ID,header:dt[ct.ID],width:340,render:e=>{let{row:t}=e;return t.id?(0,d.jsx)(St.l,{placement:["top","bottom"],content:t.id,children:t.id}):he.jX}},{name:ct.STATUS,header:dt[ct.STATUS],render:e=>{let{row:t}=e;return t.status?(0,d.jsx)(gt.x,{color:t.status===Tt.SUCCESS?"positive":"danger",children:t.status}):he.jX}},{name:ct.CREATED_BY,header:dt[ct.CREATED_BY],render:e=>{let{row:t}=e;return t.created_by?t.created_by:he.jX}},{name:ct.CREATE_TIME,header:dt[ct.CREATE_TIME],render:e=>{let{row:t}=e;return t.create_time?(0,Ie.o0)((0,wt.aR)(t.create_time)):he.jX},sortAccessor:e=>e.create_time?(0,wt.aR)(e.create_time):0},{name:ct.END_TIME,header:dt[ct.END_TIME],render:e=>{let{row:t}=e;return t.end_time?(0,Ie.o0)((0,wt.aR)(t.end_time)):he.jX},sortAccessor:e=>e.end_time?(0,wt.aR)(e.end_time):Number.MAX_SAFE_INTEGER},{name:ct.DURATION,header:dt[ct.DURATION],render:e=>{let{row:t}=e,a=0;if(!t.create_time)return he.jX;const n=(0,wt.aR)(t.create_time);if(t.end_time){a=(0,wt.aR)(t.end_time)-n}else a=Date.now()-n;const r=a>he.RQ*he.NO?(0,ht.x9)(a).format("hh:mm:ss"):(0,ht.x9)(a).format("mm:ss");return t.end_time?r:lt("label_duration-ongoing",{value:r})},sortAccessor:e=>{if(!e.create_time)return 0;const t=(0,wt.aR)(e.create_time);if(e.end_time){return(0,wt.aR)(e.end_time)-t}return Date.now()-t}},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:e=>{let{row:n}=e;return(0,d.jsx)(It,{operation:n,database:t,refreshTable:a})}}]}function It(e){let{operation:t,database:a,refreshTable:n}=e;const[r,{isLoading:i}]=nt.useCancelOperationMutation(),[s,{isLoading:o}]=nt.useForgetOperationMutation(),l=t.id;return l?(0,d.jsxs)(yt.k,{gap:"2",children:[(0,d.jsx)(bt.M,{title:lt("header_forget"),placement:["left","auto"],children:(0,d.jsx)("div",{children:(0,d.jsx)(Et.U,{buttonView:"outlined",dialogHeader:lt("header_forget"),dialogText:lt("text_forget"),onConfirmAction:()=>s({id:l,database:a}).unwrap().then((()=>{Ct({name:"Forgotten",title:lt("text_forgotten",{id:l}),type:"success"}),n()})),buttonDisabled:i,children:(0,d.jsx)(ft.J,{data:vt.Z})})})}),(0,d.jsx)(bt.M,{title:lt("header_cancel"),placement:["right","auto"],children:(0,d.jsx)("div",{children:(0,d.jsx)(Et.U,{buttonView:"outlined",dialogHeader:lt("header_cancel"),dialogText:lt("text_cancel"),onConfirmAction:()=>r({id:l,database:a}).unwrap().then((()=>{Ct({name:"Cancelled",title:lt("text_cancelled",{id:l}),type:"success"}),n()})),buttonDisabled:o,children:(0,d.jsx)(ft.J,{data:xt.Z})})})})]}):null}var Dt=a(75475);const _t=Dt.z.enum(["ss/backgrounds","export","buildindex"]).catch("buildindex");function Rt(e){var t;let{database:a}=e;const[r]=(0,ve.Rj)(),{kind:o,searchValue:l,pageSize:c,pageToken:u,handleKindChange:m,handleSearchChange:p}=function(){var e,t,a;const[n,r]=(0,i.useQueryParams)({kind:i.StringParam,search:i.StringParam,pageSize:i.NumberParam,pageToken:i.StringParam});return{kind:_t.parse(n.kind),searchValue:null!==(e=n.search)&&void 0!==e?e:"",pageSize:null!==(t=n.pageSize)&&void 0!==t?t:void 0,pageToken:null!==(a=n.pageToken)&&void 0!==a?a:void 0,handleKindChange:e=>{r({kind:e},"replaceIn")},handleSearchChange:e=>{r({search:e||void 0},"replaceIn")},handlePageSizeChange:e=>{r({pageSize:e},"replaceIn")},handlePageTokenChange:e=>{r({pageToken:e},"replaceIn")}}}(),{data:h,isFetching:v,error:x,refetch:g}=nt.useGetOperationListQuery({database:a,kind:o,page_size:c,page_token:u},{pollingInterval:r}),y=n.useMemo((()=>null!==h&&void 0!==h&&h.operations?h.operations.filter((e=>{var t;return null===(t=e.id)||void 0===t?void 0:t.toLowerCase().includes(l.toLowerCase())})):[]),[null===h||void 0===h?void 0:h.operations,l]);return(0,s.u)(x)?(0,d.jsx)(et.J,{position:"left"}):(0,d.jsxs)(at.l,{children:[(0,d.jsx)(at.l.Controls,{children:(0,d.jsx)(pt,{kind:o,searchValue:l,entitiesCountCurrent:y.length,entitiesCountTotal:null===h||void 0===h||null===(t=h.operations)||void 0===t?void 0:t.length,entitiesLoading:v,handleKindChange:m,handleSearchChange:p})}),x?(0,d.jsx)(Ne.V,{error:x}):null,(0,d.jsx)(at.l.Table,{loading:v,className:mt("table"),children:h?(0,d.jsx)(tt.G,{columns:Pt({database:a,refreshTable:g}),data:y,emptyDataMessage:lt("title_empty")}):null})]})}var At=a(58095),Ot=a(28265),Mt=a(22877),kt=a(83751);function Lt(e){return`SELECT * FROM \`${e}\` LIMIT 0`}const zt=le.h.injectEndpoints({endpoints:e=>({getViewSchema:e.query({queryFn:async e=>{let{database:t,path:a}=e;try{var n,r;const e=await window.api.sendQuery({query:Lt(a),database:t,action:"execute-scan"},{withRetries:!0});return(0,kt.gW)(e)?{error:e}:{data:(null===e||void 0===e||null===(n=e.result)||void 0===n||null===(r=n[0])||void 0===r?void 0:r.columns)||[]}}catch(i){return{error:i}}},providesTags:["All"]})}),overrideExisting:"throw"});var qt=a(2634),Ut=a(43926);const Ft=JSON.parse('{"column-title.id":"Id","column-title.name":"Name","column-title.type":"Type","column-title.notNull":"NotNull","column-title.autoIncrement":"AutoIncrement","column-title.defaultValue":"Default","column-title.family":"Family","column-title.media":"Media","column-title.compression":"Compression","primary-key.title":"Primary key:","partitioning-key.title":"Partitioning key:"}'),Qt=(0,st.wZ)("ydb-schema-viewer",{en:Ft}),Gt=(0,c.cn)("schema-viewer");const Bt=e=>{let{tableData:t,extended:a,type:n}=e;const r="primary"===n?function(e){return e.filter((e=>void 0!==e.keyColumnIndex&&-1!==e.keyColumnIndex&&e.name)).sort(((e,t)=>e.keyColumnIndex-t.keyColumnIndex)).map((e=>e.name))}(t):function(e){return e.filter((e=>e.isPartitioningKeyColumn&&e.name)).map((e=>e.name))}(t),i=a?3:r.length,s=r.slice(0,i),o=r.slice(i);return r.length>0?(0,d.jsxs)("div",{className:Gt("keys",{summary:!a,type:n}),children:[(0,d.jsx)("div",{className:Gt("keys-header"),children:Qt("primary"===n?"primary-key.title":"partitioning-key.title")}),(0,d.jsxs)("div",{className:Gt("keys-values"),children:[" "+s.join(", "),o.length?(0,d.jsx)(Ut.f,{className:Gt("more-badge"),placement:["bottom"],hasArrow:!1,pinOnClick:!0,content:(0,d.jsx)("div",{className:Gt("popup-content"),children:o.map((e=>(0,d.jsx)("div",{className:Gt("popup-item"),children:e},e)))}),children:(0,d.jsx)(qt._,{className:Gt("keys-label"),children:`+${o.length}`})}):null]})]}):null};var $t=a(71624);const Vt="autoIncrement",Ht="defaultValue",Zt="familyName",Wt="prefferedPoolKind",Jt="columnCodec",Kt={name:"id",get header(){return Qt("column-title.id")},width:60,render:e=>{let{row:t}=e;return t.id}},Yt={name:"name",get header(){return Qt("column-title.name")},width:100,render:e=>{let{row:t}=e;return t.name}},Xt={name:"type",get header(){return Qt("column-title.type")},width:100,render:e=>{let{row:t}=e;return t.type}},ea={name:"notNull",get header(){return Qt("column-title.notNull")},width:100,defaultOrder:$t.ZP.DESCENDING,render:e=>{let{row:t}=e;if(t.notNull)return"\u2713"}},ta={name:Vt,get header(){return Qt("column-title.autoIncrement")},width:100,defaultOrder:$t.ZP.DESCENDING,render:e=>{let{row:t}=e;if(t.autoIncrement)return"\u2713"}},aa={name:Ht,get header(){return Qt("column-title.defaultValue")},width:100,render:e=>{let{row:t}=e;return String(t.defaultValue)}},na={name:Zt,get header(){return Qt("column-title.family")},width:100,render:e=>{let{row:t}=e;return t.familyName}},ra={name:Wt,get header(){return Qt("column-title.media")},width:100,render:e=>{let{row:t}=e;return t.prefferedPoolKind}},ia={name:Jt,get header(){return Qt("column-title.compression")},width:100,render:e=>{let{row:t}=e;return t.columnCodec}};function sa(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=function(e){var t,a,n;return null!==(t=null===e||void 0===e||null===(a=e.PartitionConfig)||void 0===a||null===(n=a.ColumnFamilies)||void 0===n?void 0:n.reduce(((e,t)=>t.Id?{...e,[t.Id]:t}:e),{}))&&void 0!==t?t:{}}(e),{Columns:a,KeyColumnNames:n}=e,r=null===a||void 0===a?void 0:a.map((e=>{var a,r,i;const{Id:s,Name:o,NotNull:l,Type:c,Family:d,DefaultFromSequence:u,DefaultFromLiteral:m}=e,p=null!==(a=null===n||void 0===n?void 0:n.findIndex((e=>e===o)))&&void 0!==a?a:-1,h=d?t[d].Name:void 0,v=d?null===(r=t[d].StorageConfig)||void 0===r||null===(i=r.Data)||void 0===i?void 0:i.PreferredPoolKind:void 0,x=d?function(e){if(e)return e===T.ColumnCodecPlain?"None":e.replace("ColumnCodec","").toLocaleLowerCase()}(t[d].ColumnCodec):void 0;return{id:s,name:o,keyColumnIndex:p,type:c,notNull:l,autoIncrement:Boolean(u),defaultValue:Object.values((null===m||void 0===m?void 0:m.value)||{})[0]||"-",familyName:h,prefferedPoolKind:v,columnCodec:x}}));return[...(null===r||void 0===r?void 0:r.filter((e=>-1!==e.keyColumnIndex)))||[],...(null===r||void 0===r?void 0:r.filter((e=>-1===e.keyColumnIndex)))||[]]}function oa(e,t){const{Table:a,ColumnTableDescription:n,ExternalTableDescription:r}=(null===t||void 0===t?void 0:t.PathDescription)||{};return se(e)?sa(a):K(e)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{Schema:t={},Sharding:a={}}=e,{Columns:n,KeyColumnNames:r}=t,{HashSharding:i={}}=a,{Columns:s=[]}=i,o=null===n||void 0===n?void 0:n.map((e=>{var t;const{Id:a,Name:n,Type:i,NotNull:o}=e,l=null!==(t=null===r||void 0===r?void 0:r.findIndex((e=>e===n)))&&void 0!==t?t:-1,c=Boolean(null===s||void 0===s?void 0:s.find((e=>e===n)));return{id:a,name:n,keyColumnIndex:l,isPartitioningKeyColumn:c,type:i,notNull:o}}));return[...(null===o||void 0===o?void 0:o.filter((e=>-1!==e.keyColumnIndex)))||[],...(null===o||void 0===o?void 0:o.filter((e=>-1===e.keyColumnIndex)))||[]]}(n):ie(e)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{Columns:t}=e;return(null===t||void 0===t?void 0:t.map((e=>{const{Id:t,Name:a,Type:n,NotNull:r}=e;return{id:t,name:a,type:n,notNull:r}})))||[]}(r):[]}function la(e){return(null===e||void 0===e?void 0:e.map((e=>{var t;return{type:null!==(t=e.type)&&void 0!==t&&t.endsWith("?")?e.type.slice(0,-1):e.type,name:e.name}})))||[]}const ca=e=>{let{type:t,path:a,tenantName:r,extended:i=!1}=e;const[s]=(0,ve.Rj)(),{currentData:o,isLoading:l}=ce.useGetOverviewQuery({path:a,database:r},{pollingInterval:s}),c=oe(t)?{path:a,database:r}:b.CN,{data:u,isLoading:m}=zt.useGetViewSchemaQuery(c),p=n.useMemo((()=>oe(t)?la(u):oa(t,o)),[o,t,u]),h=n.useMemo((()=>p.some((e=>e.autoIncrement))),[p]),v=n.useMemo((()=>p.some((e=>e.defaultValue))),[p]),x=n.useMemo((()=>oe(t)?[Yt,Xt]:ie(t)||K(t)?[Kt,Yt,Xt,ea]:se(t)?function(e,t,a){const n=[Kt,Yt,Xt,ea];return a&&n.push(aa),e&&n.push(na,ra,ia),t&&n.push(ta),n}(i,h,v):[]),[t,i,h,v]);return l||m?(0,d.jsx)(Mt.h,{}):(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)("div",{className:Gt("keys-wrapper"),children:[(0,d.jsx)(Bt,{tableData:p,extended:i,type:"primary"}),(0,d.jsx)(Bt,{tableData:p,extended:i,type:"partitioning"})]}),(0,d.jsx)("div",{className:Gt(),children:(0,d.jsx)(tt.G,{columnsWidthLSKey:"schemaTableColumnsWidth",data:p,columns:x,settings:he.LE})})]})};var da=a(60064),ua=a(87669),ma=a(16318),pa=a(77315);const ha=JSON.parse('{"td-feature-flag":"Feature flag","td-default":"Default","td-current":"Current","enabled":"Enabled","disabled":"Disabled","flag-touched":"Flag is changed","search-placeholder":"Search by feature flag","search-empty":"Empty search result","no-data":"No data"}'),va=(0,st.wZ)("ydb-diagnostics-configs",{en:ha}),xa=(0,c.cn)("ydb-diagnostics-configs"),ga=[{name:"Touched",header:"",render:e=>{let{row:t}=e;return t.Current?(0,d.jsx)(ma.J,{content:va("flag-touched"),className:xa("icon-touched"),placement:"left",children:(0,d.jsx)(ft.J,{data:ua.Z})}):null},width:36,sortable:!1,resizeable:!1},{name:"Name",get header(){return va("td-feature-flag")},render:e=>{let{row:t}=e;return t.Current?(0,d.jsx)("b",{children:t.Name}):t.Name},width:400,sortable:!0,sortAccessor:e=>{let{Current:t,Name:a}=e;return Number(!t)+a.toLowerCase()}},{name:"Default",get header(){return va("td-default")},render:e=>{let{row:t}=e;switch(t.Default){case!0:return va("enabled");case!1:return va("disabled");default:return"-"}},width:100,sortable:!1,resizeable:!1},{name:"Current",get header(){return va("td-current")},render:e=>{var t;let{row:a}=e;return(0,d.jsx)(pa.r,{disabled:!0,checked:(null!==(t=a.Current)&&void 0!==t?t:a.Default)||!1})},width:100,sortable:!1,resizeable:!1}],ya=e=>{let{database:t}=e;const[a,n]=(0,i.useQueryParam)("search",i.StringParam),{currentData:r=[],isFetching:s,error:o}=Se.$1.useGetClusterConfigQuery({database:t}),l=null===a||void 0===a?void 0:a.toLocaleLowerCase(),c=l?r.filter((e=>e.Name.toLocaleLowerCase().includes(l))):r;return(0,d.jsxs)(at.l,{children:[(0,d.jsx)(at.l.Controls,{children:(0,d.jsx)(it.o,{value:l,onChange:e=>{n(e||void 0,"replaceIn")},placeholder:va("search-placeholder")})}),(0,d.jsx)(at.l.Table,{loading:s,children:o?(0,d.jsx)(Ne.V,{error:o}):(0,d.jsx)(tt.G,{emptyDataMessage:va(l?"search-empty":"no-data"),columnsWidthLSKey:"featureFlagsColumnsWidth",columns:ga,data:c,settings:he.LE})})]})};var ba=a(78171),fa=a.n(ba),Ea=a(10142);const Sa=le.h.injectEndpoints({endpoints:e=>({getTopic:e.query({queryFn:async e=>{try{const t=await window.api.getTopic(e);return"object"!==typeof t?{error:{}}:{data:t}}catch(t){return{error:t}}},providesTags:["All"]})}),overrideExisting:"throw"}),Ta=(0,y.P1)((e=>e),((e,t)=>t),((e,t)=>Sa.endpoints.getTopic.select({path:e,database:t}))),ja=(0,y.P1)((e=>e),((e,t,a)=>Ta(t,a)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.topic_stats})),Na=(0,y.P1)((e=>e),((e,t,a)=>Ta(t,a)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.consumers})),Ca=(0,y.P1)(Na,(e=>null===e||void 0===e?void 0:e.map((e=>null===e||void 0===e?void 0:e.name)).filter((e=>void 0!==e)))),wa=(0,y.P1)(ja,(e=>{if(!e)return;const{store_size_bytes:t="0",min_last_write_time:a,max_write_time_lag:n,bytes_written:r}=e||{};return{storeSize:t,partitionsIdleTime:(0,wt.lE)(a),partitionsWriteLag:(0,wt.DA)(n),writeSpeed:(0,Ea.c4)(r)}})),Pa=(0,y.P1)(Na,(e=>null===e||void 0===e?void 0:e.map((e=>{const{name:t,consumer_stats:a}=e||{},{min_partitions_last_read_time:n,max_read_time_lag:r,max_write_time_lag:i,bytes_read:s}=a||{};return{name:t,readSpeed:(0,Ea.c4)(s),writeLag:(0,wt.DA)(i),readLag:(0,wt.DA)(r),readIdleTime:(0,wt.lE)(n)}})))),Ia=JSON.parse('{"averageSpeed":"Average speed","perMinute":"per minute","perHour":"per hour","perDay":"per day"}'),Da=JSON.parse('{"averageSpeed":"\u0421\u0440\u0435\u0434\u043d\u044f\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c","perMinute":"\u0437\u0430 \u043c\u0438\u043d\u0443\u0442\u0443","perHour":"\u0437\u0430 \u0447\u0430\u0441","perDay":"\u0437\u0430 \u0434\u0435\u043d\u044c"}'),_a=(0,st.wZ)("ydb-components-speed-multimeter",{ru:Da,en:Ia}),Ra=(0,c.cn)("speed-multimeter"),Aa=e=>{let{data:t,speedSize:a="kb",withValue:r=!0,withPopover:i=!0}=e;const{perMinute:s=0,perHour:o=0,perDay:l=0}=t||{},c=[s,o,l],u=e=>(0,Ea.td)({value:e,size:a,withSpeedLabel:!0}),m=[{value:u(s),label:_a("perMinute")},{value:u(o),label:_a("perHour")},{value:u(l),label:_a("perDay")}],[p,h]=n.useState(s),[v,x]=n.useState(r?0:void 0),[g,y]=n.useState(),b=(e,t)=>{h(e[t]),x(t),y(t)},f=e=>v===e,E=e=>g===e;return(0,d.jsx)("div",{className:Ra(),children:(0,d.jsxs)("div",{className:Ra("content"),children:[r&&(0,d.jsx)("div",{className:Ra("displayed-value"),children:u(p)}),(0,d.jsx)(ma.J,{content:(0,d.jsxs)("div",{className:Ra("popover-content"),children:[(0,d.jsx)("span",{className:Ra("popover-header"),children:_a("averageSpeed")}),m.map(((e,t)=>{return(0,d.jsx)("span",{className:Ra("popover-row",(a=f(t),a?{color:"primary"}:{color:"secondary"})),children:`${e.label}: ${e.value}`},t);var a}))]}),className:Ra("popover-container"),placement:"bottom",disabled:!i,hasArrow:!0,size:"s",children:(0,d.jsx)("div",{className:Ra("bars"),onMouseLeave:()=>{h(s),x(r?0:void 0),y(void 0)},children:(()=>{const e=Math.max(...c,0)||1;return c.map(((t,a)=>(0,d.jsx)("div",{className:Ra("bar-container",{highlighted:E(a)}),onMouseEnter:b.bind(null,c,a),children:(0,d.jsx)("div",{className:Ra("bar",{color:f(a)?"dark":"light"}),style:{width:100*t/e+"%"}})},a)))})()})})]})})},Oa=(0,c.cn)("ydb-diagnostics-consumers-topic-stats"),Ma=e=>{let{data:t}=e;const{writeSpeed:a,partitionsWriteLag:n,partitionsIdleTime:r}=t||{},i=[{label:"Write speed",value:(0,d.jsx)(Aa,{data:a})},{label:"Write lag",value:(0,Ie.gC)(n||0)},{label:"Write idle time",value:(0,Ie.gC)(r||0)}];return(0,d.jsx)("div",{className:Oa("wrapper"),children:i.map(((e,t)=>(0,d.jsxs)("div",{className:Oa("item"),children:[(0,d.jsx)("div",{className:Oa("label"),children:e.label}),(0,d.jsx)("div",{className:Oa("value"),children:e.value})]},t)))})};var ka=a(88726),La=a.n(ka),za=a(67653),qa=a(91807);const Ua=e=>{let{text:t,popoverContent:a,popoverClassName:n,className:r,contentClassName:i,buttonProps:s}=e;return(0,d.jsxs)("div",{className:r,children:[t,"\xa0",(0,d.jsx)(qa.J,{className:n,buttonProps:s,content:a,contentClassName:i})]})},Fa=70,Qa=54,Ga=268,Ba="#ADE8F5",$a="#f5be9d",Va=e=>{let{width:t,height:a,transform:n}=e;return(0,d.jsx)("path",{d:`M-${t/2} 0 c0 -${a}, ${t} -${a}, ${t} 0`,fill:"none",strokeDasharray:"4,6",stroke:"#28f",strokeWidth:"1.6",transform:n})},Ha=e=>{let{width:t}=e;return(0,d.jsx)("path",{fill:"none",strokeWidth:"2",d:`M0 0 h${t} l-10 -5 m0 10 l10 -5`})},Za=()=>(0,d.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,d.jsx)("g",{transform:"translate(0, 27)",stroke:$a,children:(0,d.jsx)(Ha,{width:203})}),(0,d.jsxs)("g",{transform:"translate(30, 0)",children:[(0,d.jsxs)("g",{transform:"translate(35, 27)",children:[(0,d.jsx)(Va,{width:Fa,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,d.jsxs)("g",{transform:"translate(119, 27)",children:[(0,d.jsx)(Va,{width:98,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write idle time"})})]})]}),(0,d.jsxs)("g",{transform:"translate(30, 0)",children:[(0,d.jsxs)("g",{transform:"translate(0, 27)",children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:$a}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,d.jsxs)("g",{transform:"translate(70, 27)",children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:$a}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,d.jsx)("g",{transform:"translate(168, 27)",children:(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),Wa=()=>(0,d.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,d.jsx)("g",{transform:"translate(0, 27)",stroke:Ba,children:(0,d.jsx)(Ha,{width:Ga})}),(0,d.jsxs)("g",{transform:"translate(30, 0)",children:[(0,d.jsxs)("g",{transform:"translate(105, 27)",children:[(0,d.jsx)(Va,{width:Fa,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read lag"})})]}),(0,d.jsxs)("g",{transform:"translate(35, 27)",children:[(0,d.jsx)(Va,{width:Fa,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,d.jsxs)("g",{transform:"translate(182, 27)",children:[(0,d.jsx)(Va,{width:91,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read idle time"})})]})]}),(0,d.jsxs)("g",{transform:"translate(30, 27)",children:[(0,d.jsxs)("g",{transform:"translate(0, 0)",children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:Ba}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,d.jsxs)("g",{transform:"translate(70, 0)",children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:Ba}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,d.jsxs)("g",{transform:"translate(140, 0)",children:[(0,d.jsx)("use",{x:"-2",y:"-10",xlinkHref:"#check",stroke:Ba}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read time"})})]}),(0,d.jsx)("g",{transform:"translate(224, 0)",children:(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),Ja=e=>{let{id:t,fill:a}=e;return(0,d.jsx)("pattern",{id:t,x:"0",y:"0",width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,d.jsx)("path",{d:"M0 5L5 0H8L0 8V5M5 8L8 5V8Z",fill:a})})},Ka=()=>(0,d.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 268 54",width:Ga,height:Qa,children:[(0,d.jsxs)("defs",{children:[(0,d.jsx)("g",{id:"check",children:(0,d.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,d.jsx)(Ja,{id:"latest-read",fill:Ba}),(0,d.jsx)(Ja,{id:"latest-write",fill:$a})]}),(0,d.jsx)(Za,{})]}),Ya=()=>(0,d.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 268 54",width:Ga,height:Qa,children:[(0,d.jsxs)("defs",{children:[(0,d.jsx)("g",{id:"check",children:(0,d.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,d.jsx)(Ja,{id:"latest-read",fill:Ba}),(0,d.jsx)(Ja,{id:"latest-write",fill:$a})]}),(0,d.jsx)(Wa,{})]}),Xa=(0,c.cn)("ydb-lag-popover-content"),en=e=>{let{text:t,type:a}=e;return(0,d.jsxs)("div",{className:Xa({type:a}),children:[(0,d.jsx)("div",{className:Xa("text"),children:t}),(0,d.jsx)("div",{children:"read"===a?(0,d.jsx)(Ya,{}):(0,d.jsx)(Ka,{})})]})},tn=JSON.parse('{"noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers","lagsPopover.readLags":"Read lags statistics, maximum among all consumer partitions (time format dd hh:mm:ss)","table.emptyDataMessage":"No consumers match the current search","controls.search":"Consumer"}'),an=JSON.parse('{"noConsumersMessage.topic":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0442\u043e\u043f\u0438\u043a\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","noConsumersMessage.stream":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0440\u0438\u043c\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","lagsPopover.readLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0447\u0442\u0435\u043d\u0438\u044f, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","table.emptyDataMessage":"\u041f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0438\u0441\u043a\u0443 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","controls.search":"Consumer"}'),nn=(0,st.wZ)("ydb-diagnostics-consumers",{ru:an,en:tn}),rn="consumer",sn="readSpeed",on="readLags",ln={[rn]:"Consumer",[sn]:"Read speed",[on]:"Read lags, duration"},cn="writeLag",dn="readLag",un="readIdleTime",mn={[cn]:"write lag",[dn]:"read lag",[un]:"read idle time"},pn=(0,c.cn)("ydb-diagnostics-consumers-columns-header"),hn=()=>(0,d.jsx)(Ua,{className:pn("lags"),text:ln[on],popoverContent:(0,d.jsx)(en,{text:nn("lagsPopover.readLags"),type:"read"})}),vn=(0,c.cn)("ydb-diagnostics-consumers-columns"),xn=[{name:rn,header:ln[rn],align:$t.ZP.LEFT,render:e=>{let{row:t}=e;if(!t.name)return"\u2013";const a=La().parse(location.search,{ignoreQueryPrefix:!0});return(0,d.jsx)(za.h,{to:(0,da.Sj)({...a,[da.XV.diagnosticsTab]:ge.qQ.partitions,selectedConsumer:t.name}),children:t.name})}},{name:sn,header:ln[sn],align:$t.ZP.RIGHT,resizeMinWidth:140,sortAccessor:e=>e.readSpeed.perMinute,render:e=>{let{row:t}=e;return(0,d.jsx)(Aa,{data:t.readSpeed})}},{name:on,header:(0,d.jsx)(hn,{}),className:vn("lags-header"),sub:[{name:cn,header:mn[cn],align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,Ie.gC)(t.writeLag)}},{name:dn,header:mn[dn],align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,Ie.gC)(t.readLag)}},{name:un,header:mn[un],align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,Ie.gC)(t.readIdleTime)}}]}],gn=(0,c.cn)("ydb-diagnostics-consumers"),yn=e=>{let{path:t,database:a,type:r}=e;const i=(e=>e===f.EPathTypeCdcStream)(r),[s,o]=n.useState(""),[l]=(0,ve.Rj)(),{currentData:c,isFetching:u,error:m}=Sa.useGetTopicQuery({path:t,database:a},{pollingInterval:l}),p=u&&void 0===c,h=(0,ve.ix)((e=>Pa(e,t,a))),v=(0,ve.ix)((e=>wa(e,t,a))),x=n.useMemo((()=>{if(!h)return[];const e=new RegExp(fa()(s),"i");return h.filter((t=>e.test(String(t.name))))}),[h,s]);return p?(0,d.jsx)(Ce.a,{size:"m"}):m||h&&h.length?(0,d.jsxs)("div",{className:gn(),children:[(0,d.jsxs)("div",{className:gn("controls"),children:[(0,d.jsx)(it.o,{onChange:e=>{o(e)},placeholder:nn("controls.search"),className:gn("search"),value:s}),v&&(0,d.jsx)(Ma,{data:v})]}),m?(0,d.jsx)(Ne.V,{error:m}):null,h?(0,d.jsx)("div",{className:gn("table-wrapper"),children:(0,d.jsx)("div",{className:gn("table-content"),children:(0,d.jsx)(tt.G,{columnsWidthLSKey:"consumersColumnsWidth",wrapperClassName:gn("table"),data:x,columns:xn,settings:he.LE,emptyDataMessage:nn("table.emptyDataMessage")})})}):null]}):(0,d.jsx)("div",{children:nn("noConsumersMessage."+(i?"stream":"topic"))})};var bn=a(99175),fn=a(19992),En=a.n(fn),Sn=a(95877);a(25219);const Tn=(0,c.cn)("ydb-describe"),jn=new Map,Nn=e=>{let{path:t,database:a,type:n}=e;const[r]=(0,ve.Rj)(),i=te(n),s=(0,ve.ix)((e=>me(e,t,n,a)),Sn.wU);let o=[];i?s&&(o=[t,...s]):o=[t];const{mergedDescribe:l,loading:c,error:u}=pe({paths:o,autoRefreshInterval:r,database:a});let m;if(l){const e=Object.keys(l);m=1===e.length?l[e[0]]:l}return c||i&&!s?(0,d.jsx)(Ce.a,{size:"m"}):m||u?(0,d.jsxs)("div",{className:Tn(),children:[u?(0,d.jsx)(Ne.V,{error:u}):null,m?(0,d.jsxs)("div",{className:Tn("result"),children:[(0,d.jsx)(En(),{data:m,className:Tn("tree"),onClick:e=>{let{path:t}=e;const a=!jn.get(t);jn.set(t,a)},searchOptions:{debounceTime:300},isExpanded:e=>jn.get(e)||!1}),(0,d.jsx)(bn.m,{view:"flat-secondary",text:JSON.stringify(m),className:Tn("copy")})]}):null]}):(0,d.jsx)("div",{className:Tn("message-container"),children:"Empty"})};var Cn=a(41591);const wn=e=>{const{PathType:t,PathSubType:a}=(null===e||void 0===e?void 0:e.Self)||{};return n=t,(r=a)&&Q[r]||n&&G[n];var n,r},Pn=e=>{var t;return null===e||void 0===e||null===(t=e.UserAttributes)||void 0===t?void 0:t.some((e=>{let{Key:t,Value:a}=e;return"__async_replica"===t&&"true"===a}))};var In=a(73211),Dn=a(9379);const _n=(0,Dn.a)({values:{PathType:e=>null===e||void 0===e?void 0:e.substring("EPathType".length),CreateStep:Ie.o0},labels:{PathType:(0,In.Z)("common.type"),CreateStep:(0,In.Z)("common.created")}}),Rn=e=>{let{value:t,withSpeedLabel:a,...n}=e;const r=(0,Ea.td)({value:t,withSpeedLabel:a,...n}),i=(0,Ea.td)({value:t,withSpeedLabel:a,size:"b"});return(0,d.jsx)("span",{title:i,children:r})},An=(e,t)=>e?(0,d.jsx)(Rn,{value:e,significantDigits:2,...t}):null,On=(0,Dn.a)({values:{Type:e=>null===e||void 0===e?void 0:e.substring(10),State:e=>null===e||void 0===e?void 0:e.substring(11),KeyColumnNames:e=>null===e||void 0===e?void 0:e.join(", "),DataColumnNames:e=>null===e||void 0===e?void 0:e.join(", "),DataSize:An},labels:{KeyColumnNames:"Columns",DataColumnNames:"Includes"}}),Mn={[D.METERING_MODE_REQUEST_UNITS]:"request-units",[D.METERING_MODE_RESERVED_CAPACITY]:"reserved-capacity"},kn=(0,Dn.a)({values:{Partitions:e=>(0,Ie.uf)((null===e||void 0===e?void 0:e.length)||0),PQTabletConfig:e=>{const t=Math.round(e.PartitionConfig.LifetimeSeconds/he.RQ*100)/100;return`${(0,Ie.uf)(t)} hours`}},labels:{Partitions:"Partitions count",PQTabletConfig:"Retention"}}),Ln=(0,Dn.a)({values:{Codecs:e=>e&&Object.values(e.Codecs||{}).join(", "),MeteringMode:e=>e&&Mn[e]},labels:{MeteringMode:"Metering mode"}}),zn=(0,Dn.a)({values:{StorageLimitBytes:Ie.td,WriteSpeedInBytesPerSecond:Ie.t$},labels:{StorageLimitBytes:"Retention storage",WriteSpeedInBytesPerSecond:"Partitions write speed"}}),qn=(0,Dn.a)({values:{Mode:e=>null===e||void 0===e?void 0:e.substring("ECdcStreamMode".length),Format:e=>null===e||void 0===e?void 0:e.substring("ECdcStreamFormat".length)}}),Un=(0,Dn.a)({values:{CPU:Ie.LO,Memory:An,Storage:An,Network:Ie.t$,ReadThroughput:Ie.t$,WriteThroughput:Ie.t$},defaultValueFormatter:Ie.uf}),Fn=(0,Dn.a)({values:{FollowerCount:Ie.uf},labels:{FollowerCountPerDataCenter:"FollowerCountPerDC"},defaultValueFormatter:e=>e&&String(e)}),Qn=(0,Dn.a)({values:{FollowerCount:Ie.uf,CrossDataCenterFollowerCount:Ie.uf}}),Gn=(0,Dn.a)({values:{DataSize:An,IndexSize:An,LastAccessTime:Ie.o0,LastUpdateTime:Ie.o0},defaultValueFormatter:Ie.uf}),Bn=new Set(["Type","State","DataSize","KeyColumnNames","DataColumnNames"]),$n=e=>{var t;let{data:a}=e;const n=wn(null===a||void 0===a?void 0:a.PathDescription);if(!a)return(0,d.jsxs)("div",{className:"error",children:["No ",n," data"]});const r=null===(t=a.PathDescription)||void 0===t?void 0:t.TableIndex,i=[];let s;for(s in r)Bn.has(s)&&i.push(On(s,null===r||void 0===r?void 0:r[s]));return(0,d.jsx)(Cn._P,{title:n,info:i})};var Vn=a(62508);const Hn=JSON.parse('{"external-objects.source-type":"Source Type","external-objects.data-source":"Data Source","external-objects.location":"Location","external-objects.auth-method":"Auth Method","external-objects.auth-method.none":"None","external-objects.auth-method.service-account":"Service Account","view.query-text":"Query Text"}'),Zn=(0,st.wZ)("ydb-tenant-objects-info",{en:Hn}),Wn=(0,c.cn)("ydb-external-data-source-info"),Jn=e=>{var t,a,n,r;return[{label:Zn("external-objects.source-type"),value:null===(t=e.PathDescription)||void 0===t||null===(a=t.ExternalDataSourceDescription)||void 0===a?void 0:a.SourceType},_n("CreateStep",null===(n=e.PathDescription)||void 0===n||null===(r=n.Self)||void 0===r?void 0:r.CreateStep)]},Kn=e=>{var t;const{Location:a,Auth:n}=(null===(t=e.PathDescription)||void 0===t?void 0:t.ExternalDataSourceDescription)||{};return[...Jn(e),{label:Zn("external-objects.location"),value:(0,d.jsx)(Vn.A,{name:a,showStatus:!1,hasClipboardButton:!0,clipboardButtonAlwaysVisible:!0,className:Wn("location")})},{label:Zn("external-objects.auth-method"),value:null!==n&&void 0!==n&&n.ServiceAccount?Zn("external-objects.auth-method.service-account"):Zn("external-objects.auth-method.none")}]},Yn=e=>{let{data:t,prepareData:a}=e;const n=wn(null===t||void 0===t?void 0:t.PathDescription);return t?(0,d.jsx)(Cn._P,{title:n,info:a(t)}):(0,d.jsxs)("div",{className:"error",children:["No ",n," data"]})},Xn=e=>{let{data:t}=e;return(0,d.jsx)(Yn,{data:t,prepareData:Kn})};var er=a(55783),tr=a(90808);const ar=(0,c.cn)("ydb-external-table-info"),nr=(e,t)=>{var a,n;const{CreateStep:r}=(null===(a=e.PathDescription)||void 0===a?void 0:a.Self)||{},{SourceType:i,DataSourcePath:s}=(null===(n=e.PathDescription)||void 0===n?void 0:n.ExternalTableDescription)||{},o=null===s||void 0===s?void 0:s.split("/").pop();return[{label:Zn("external-objects.source-type"),value:i},_n("CreateStep",r),{label:Zn("external-objects.data-source"),value:s&&(0,d.jsx)("span",{title:s,children:(0,d.jsx)(tr.j,{title:o||"",url:t})})}]},rr=(e,t)=>{var a,n;const r=null===(a=e.PathDescription)||void 0===a||null===(n=a.ExternalTableDescription)||void 0===n?void 0:n.Location;return[...nr(e,t),{label:Zn("external-objects.location"),value:(0,d.jsx)(Vn.A,{name:r,showStatus:!1,hasClipboardButton:!0,clipboardButtonAlwaysVisible:!0,className:ar("location")})}]},ir=e=>{var t,a;let{data:n,prepareData:r}=e;const i=(0,er.TH)(),s=(0,Re.mB)(i),o=(0,Re.vF)({...s,schema:null===n||void 0===n||null===(t=n.PathDescription)||void 0===t||null===(a=t.ExternalTableDescription)||void 0===a?void 0:a.DataSourcePath}),l=wn(null===n||void 0===n?void 0:n.PathDescription);return n?(0,d.jsx)(Cn._P,{title:l,info:r(n,o)}):(0,d.jsxs)("div",{className:"error",children:["No ",l," data"]})},sr=e=>{let{data:t}=e;return(0,d.jsx)(ir,{data:t,prepareData:rr})};var or=a(20134);const lr=JSON.parse('{"no-data":"No data"}'),cr=(0,st.wZ)("ydb-definition-list",{en:lr}),dr=(0,c.cn)("ydb-definition-list");function ur(e){let{title:t,items:a,nameMaxWidth:n=220,copyPosition:r="outside",className:i,itemClassName:s,...o}=e;return(0,d.jsxs)("div",{className:dr(null),children:[t?(0,d.jsx)("div",{className:dr("title"),children:t}):null,a.length?(0,d.jsx)(or.w,{items:a,nameMaxWidth:n,copyPosition:r,className:dr("properties-list",i),itemClassName:dr("item",s),...o}):cr("no-data")]})}const mr=e=>{var t,a;const n=null===(t=e.PathDescription)||void 0===t||null===(a=t.ViewDescription)||void 0===a?void 0:a.QueryText;return[{name:Zn("view.query-text"),copyText:n,content:(0,d.jsx)(gt.x,{variant:"code-2",wordBreak:"break-word",children:n})}]};function pr(e){let{data:t}=e;const a=wn(null===t||void 0===t?void 0:t.PathDescription);if(!t)return(0,d.jsxs)("div",{className:"error",children:["No ",a," data"]});const n=mr(t);return(0,d.jsx)(ur,{title:a,items:n})}function hr(e){let{state:t}=e;return t?"StandBy"in t?(0,d.jsx)(qt._,{theme:"info",children:"Standby"}):"Paused"in t?(0,d.jsx)(qt._,{theme:"info",children:"Paused"}):"Done"in t?(0,d.jsx)(qt._,{theme:"success",children:"Done"}):"Error"in t?(0,d.jsx)(qt._,{theme:"danger",children:"Error"}):(0,d.jsx)(qt._,{size:"s",children:"Unknown"}):null}const vr=JSON.parse('{"column.dstPath.name":"Dist","column.srcPath.name":"Source","everythingWithPrefix":"Everything with prefix:","noData":"No data.","title":"Replicated Paths"}'),xr=(0,st.wZ)("ydb-diagnostics-async-replication-paths",{en:vr}),gr=(0,c.cn)("ydb-async-replication-paths"),yr=[{name:xr("column.srcPath.name"),render:e=>{let{row:t}=e;return t.SrcPath},sortAccessor:e=>e.SrcPath},{name:xr("column.dstPath.name"),render:e=>{let{row:t}=e;return t.DstPath},sortAccessor:e=>e.DstPath}];function br(e){let{config:t}=e;if(!t)return null;let a=xr("noData");var n,r;t.Everything&&(a=(0,d.jsxs)("span",{children:[xr("everythingWithPrefix")," ",(0,d.jsx)(gt.x,{variant:"code-inline-2",children:null!==(n=null===(r=t.Everything)||void 0===r?void 0:r.DstPrefix)&&void 0!==n?n:"undefined"}),"."]}));return t.Specific&&(a=(0,d.jsx)(tt.G,{data:t.Specific.Targets,settings:he.E6,columns:yr})),(0,d.jsxs)("div",{className:gr(),children:[(0,d.jsx)("div",{className:gr("title"),children:xr("title")}),a]})}function fr(e){let{connection:t}=e;return t?t.StaticCredentials?(0,d.jsx)(qt._,{value:t.StaticCredentials.User,theme:"normal",children:"user"}):"OAuthToken"in t?"OAuth":"unknown":null}const Er=JSON.parse('{"credentials.label":"Credentials","noData":"No data for entity:","srcConnection.database.label":"Source Database Path","srcConnection.endpoint.label":"Source Cluster Endpoint","state.label":"State"}'),Sr=(0,st.wZ)("ydb-diagnostics-async-replication-info",{en:Er});function Tr(e){var t,a;let{data:n}=e;const r=wn(null===n||void 0===n?void 0:n.PathDescription);if(!n)return(0,d.jsxs)("div",{className:"error",children:[Sr("noData")," ",r]});const i=function(e){var t,a;const n=(null===(t=e.PathDescription)||void 0===t?void 0:t.ReplicationDescription)||{},r=n.State,i=(null===(a=n.Config)||void 0===a?void 0:a.SrcConnectionParams)||{},{Endpoint:s,Database:o}=i,l=[];r&&l.push({name:Sr("state.label"),content:(0,d.jsx)(hr,{state:r})});s&&l.push({name:Sr("srcConnection.endpoint.label"),copyText:s,content:(0,d.jsx)(gt.x,{variant:"code-inline-2",children:s})});o&&l.push({name:Sr("srcConnection.database.label"),copyText:o,content:(0,d.jsx)(gt.x,{variant:"code-inline-2",children:o})});i&&l.push({name:Sr("credentials.label"),content:(0,d.jsx)(fr,{connection:i})});return l}(n);return(0,d.jsxs)(yt.k,{direction:"column",gap:"4",children:[(0,d.jsx)(ur,{title:r,items:i}),(0,d.jsx)(br,{config:null===(t=n.PathDescription)||void 0===t||null===(a=t.ReplicationDescription)||void 0===a?void 0:a.Config})]})}const jr=JSON.parse('{"writeLagPopover":"Write lag, maximum among all topic partitions","writeIdleTimePopover":"Write idle time, maximum among all topic partitions"}'),Nr=JSON.parse('{"writeLagPopover":"\u041b\u0430\u0433 \u0437\u0430\u043f\u0438\u0441\u0438, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0442\u043e\u043f\u0438\u043a\u0430","writeIdleTimePopover":"\u0412\u0440\u0435\u043c\u044f \u0431\u0435\u0437 \u0437\u0430\u043f\u0438\u0441\u0438, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0442\u043e\u043f\u0438\u043a\u0430"}'),Cr=(0,st.wZ)("ydb-diagnostics-overview-topic-stats",{ru:Nr,en:jr}),wr=(0,c.cn)("ydb-overview-topic-stats"),Pr=e=>[{label:"Store size",value:(0,Ie.td)(e.storeSize)},{label:(0,d.jsx)(Ua,{text:"Write idle time",popoverContent:(0,d.jsx)(en,{text:Cr("writeIdleTimePopover"),type:"write"})}),value:(0,wt.tt)(e.partitionsIdleTime)},{label:(0,d.jsx)(Ua,{text:"Write lag",popoverContent:(0,d.jsx)(en,{text:Cr("writeLagPopover"),type:"write"})}),value:(0,wt.tt)(e.partitionsWriteLag)},{label:"Average write speed",value:(0,d.jsx)(Aa,{data:e.writeSpeed,withValue:!1})}],Ir=e=>{const t=e.writeSpeed;return[{label:"per minute",value:(0,Ie.t$)(t.perMinute)},{label:"per hour",value:(0,Ie.t$)(t.perHour)},{label:"per day",value:(0,Ie.t$)(t.perDay)}]},Dr=e=>{let{path:t,database:a}=e;const[r]=(0,ve.Rj)(),{currentData:i,isFetching:s,error:o}=Sa.useGetTopicQuery({path:t,database:a},{pollingInterval:r}),l=s&&void 0===i,c=(0,ve.ix)((e=>wa(e,t,a)));if(l)return(0,d.jsx)("div",{className:wr(),children:(0,d.jsx)(Ce.a,{size:"s"})});const u=o||!c?(0,d.jsx)(Ne.V,{error:o}):null;return(0,d.jsxs)("div",{className:wr(),children:[(0,d.jsx)("div",{className:wr("title"),children:"Stats"}),u,c?(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:wr("info"),children:(0,d.jsx)(Cn._P,{info:Pr(c),multilineLabels:!0})}),(0,d.jsx)("div",{className:wr("bytes-written"),children:(0,d.jsx)(Cn._P,{info:Ir(c)})})]}):null]})},_r=e=>{var t;const a=null===e||void 0===e||null===(t=e.PathDescription)||void 0===t?void 0:t.PersQueueGroup;if(!a)return[];const{Partitions:n=[],PQTabletConfig:r={PartitionConfig:{LifetimeSeconds:0}}}=a,{Codecs:i,MeteringMode:s}=r,{WriteSpeedInBytesPerSecond:o,StorageLimitBytes:l}=r.PartitionConfig;return[...(0,Cn.Z6)(kn,{Partitions:n,PQTabletConfig:r}),...(0,Cn.Z6)(zn,{StorageLimitBytes:l,WriteSpeedInBytesPerSecond:o}),...(0,Cn.Z6)(Ln,{Codecs:i,MeteringMode:s})]},Rr=(e,t)=>{var a,n,r;if(!e&&!t)return[];const i=null===e||void 0===e||null===(a=e.PathDescription)||void 0===a?void 0:a.CdcStreamDescription,{Mode:s,Format:o}=i||{};return[_n("CreateStep",null===e||void 0===e||null===(n=e.PathDescription)||void 0===n||null===(r=n.Self)||void 0===r?void 0:r.CreateStep),...(0,Cn.Z6)(qn,{Mode:s,Format:o}),..._r(t)]},Ar=e=>{let{path:t,database:a,data:n,topic:r}=e;const i=wn(null===n||void 0===n?void 0:n.PathDescription);return n&&r?(0,d.jsxs)("div",{children:[(0,d.jsx)(Cn._P,{title:i,info:Rr(n,r)}),(0,d.jsx)(Dr,{path:t,database:a})]}):(0,d.jsxs)("div",{className:"error",children:["No ",i," data"]})},Or=JSON.parse('{"page.title":"Database","pages.query":"Query","pages.diagnostics":"Diagnostics","summary.navigation":"Navigation","summary.showPreview":"Show preview","summary.source-type":"Source Type","summary.data-source":"Data Source","summary.copySchemaPath":"Copy schema path","summary.type":"Type","summary.subtype":"SubType","summary.id":"Id","summary.version":"Version","summary.created":"Created","summary.data-size":"Data size","summary.row-count":"Row count","summary.partitions":"Partitions count","summary.paths":"Paths","summary.shards":"Shards","summary.state":"State","summary.mode":"Mode","summary.format":"Format","summary.retention":"Retention","label.read-only":"ReadOnly","actions.copied":"The path is copied to the clipboard","actions.notCopied":"Couldn\u2019t copy the path","actions.copyPath":"Copy path","actions.dropIndex":"Drop index","actions.openPreview":"Open preview","actions.createTable":"Create table...","actions.createExternalTable":"Create external table...","actions.createTopic":"Create topic...","actions.createColumnTable":"Create column table...","actions.createAsyncReplication":"Create async replication...","actions.createView":"Create view...","actions.dropTable":"Drop table...","actions.dropTopic":"Drop topic...","actions.dropView":"Drop view...","actions.alterTable":"Alter table...","actions.addTableIndex":"Add index...","actions.createCdcStream":"Create changefeed...","actions.alterTopic":"Alter topic...","actions.selectQuery":"Select query...","actions.upsertQuery":"Upsert query...","actions.alterReplication":"Alter async replicaton...","actions.dropReplication":"Drop async replicaton...","actions.createDirectory":"Create directory","schema.tree.dialog.placeholder":"Relative path","schema.tree.dialog.invalid":"Invalid path","schema.tree.dialog.whitespace":"Whitespace is not allowed","schema.tree.dialog.empty":"Path is empty","schema.tree.dialog.header":"Create directory","schema.tree.dialog.description":"Inside","schema.tree.dialog.buttonCancel":"Cancel","schema.tree.dialog.buttonApply":"Create"}'),Mr=(0,st.wZ)("ydb-tenant",{en:Or});function kr(e){let{data:t}=e;const a=wn(t);return Pn(t)?(0,d.jsxs)(yt.k,{gap:1,wrap:"nowrap",children:[a," ",(0,d.jsx)(qt._,{children:Mr("label.read-only")})]}):a}const Lr=JSON.parse('{"tableStats":"Table Stats","tabletMetrics":"Tablet Metrics","partitionConfig":"Partition Config","label.ttl":"TTL for rows","value.ttl":"column: \'{{columnName}}\', expire after: {{expireTime}}","label.standalone":"Standalone","label.partitioning":"Partitioning","label.partitioning-by-size":"Partitioning by size","value.partitioning-by-size.enabled":"Enabled, split size: {{size}}","label.partitioning-by-load":"Partitioning by load","label.partitions-min":"Min number of partitions","label.partitions-max":"Max number of partitions","label.read-replicas":"Read replicas (followers)","label.bloom-filter":"Bloom filter","enabled":"Enabled","disabled":"Disabled"}'),zr=(0,st.wZ)("ydb-diagnostics-overview-table-info",{en:Lr});var qr=a(83351),Ur=a.n(qr),Fr=a(25665),Qr=a(73689);const Gr=e=>e.SchemaPresetName&&void 0!==e.SchemaPresetId,Br=e=>{if(e.Enabled&&e.Enabled.ColumnName&&void 0!==e.Enabled.ExpireAfterSeconds){const t=zr("value.ttl",{columnName:e.Enabled.ColumnName,expireTime:(0,wt.tt)(1e3*e.Enabled.ExpireAfterSeconds,1)});return{label:zr("label.ttl"),value:t}}};const $r=(e,t)=>{if(!e)return{};const{PathDescription:a={}}=e,{TableStats:n={},TabletMetrics:r={},Table:{PartitionConfig:i={},TTLSettings:s}={},ColumnTableDescription:o={}}=a,{PartCount:l,RowCount:c,DataSize:u,IndexSize:m,ByKeyFilterSize:p,LastAccessTime:h,LastUpdateTime:v,ImmediateTxCompleted:x,PlannedTxCompleted:g,TxRejectedByOverload:y,TxRejectedBySpace:b,TxCompleteLagMsec:E,InFlightTxCount:S,RowUpdates:T,RowDeletes:j,RowReads:N,RangeReads:C,RangeReadRows:w}=n,{FollowerGroups:P,FollowerCount:I,CrossDataCenterFollowerCount:D}=i;let _=[];switch(t){case f.EPathTypeTable:_=((e,t)=>{var a;const{PartitioningPolicy:n={},FollowerGroups:r,EnableFilterByKey:i}=e,s=[],o=n.SizeToSplit&&Number(n.SizeToSplit)>0?zr("value.partitioning-by-size.enabled",{size:(0,Ie.td)(n.SizeToSplit)}):zr("disabled"),l=null!==(a=n.SplitByLoadSettings)&&void 0!==a&&a.Enabled?zr("enabled"):zr("disabled");if(s.push({label:zr("label.partitioning-by-size"),value:o},{label:zr("label.partitioning-by-load"),value:l},{label:zr("label.partitions-min"),value:(0,Ie.uf)(n.MinPartitionsCount||0)}),n.MaxPartitionsCount&&s.push({label:zr("label.partitions-max"),value:(0,Ie.uf)(n.MaxPartitionsCount)}),r&&r.length){const{RequireAllDataCenters:e,FollowerCountPerDataCenter:t,FollowerCount:a}=r[0];let n;n=e&&t?`PER_AZ: ${a}`:`ANY_AZ: ${a}`,s.push({label:zr("label.read-replicas"),value:n})}if(t){const e=Br(t);e&&s.push(e)}return(0,Fr.D)(i)&&s.push({label:zr("label.bloom-filter"),value:zr(i?"enabled":"disabled")}),s})(i,s);break;case f.EPathTypeColumnTable:_=function(e){var t,a;const n=[];if(n.push({label:zr("label.standalone"),value:String(!Gr(e))}),null!==(t=e.Sharding)&&void 0!==t&&null!==(a=t.HashSharding)&&void 0!==a&&a.Columns){const t=`PARTITION BY HASH(${e.Sharding.HashSharding.Columns.join(", ")})`;n.push({label:zr("label.partitioning"),value:(0,d.jsx)(gt.x,{variant:"code-2",wordBreak:"break-word",children:t})})}if(e.TtlSettings){const t=Br(null===e||void 0===e?void 0:e.TtlSettings);t&&n.push(t)}return n}(o)}const R=(0,Cn.Z6)(Gn,{PartCount:l,RowCount:c,DataSize:u,IndexSize:m});(0,Qr.kE)(p)&&(i.EnableFilterByKey||Number(p)>0)&&R.push({label:"BloomFilterSize",value:An(p)});const A=[R,(0,Cn.Z6)(Gn,{LastAccessTime:h,LastUpdateTime:v}),(0,Cn.Z6)(Gn,{ImmediateTxCompleted:x,PlannedTxCompleted:g,TxRejectedByOverload:y,TxRejectedBySpace:b,TxCompleteLagMsec:E,InFlightTxCount:S}),(0,Cn.Z6)(Gn,{RowUpdates:T,RowDeletes:j,RowReads:N,RangeReads:C,RangeReadRows:w})],O=(0,Cn.Z6)(Un,Ur()(r,["GroupReadIops","GroupReadThroughput","GroupWriteIops","GroupWriteThroughput"]));let M=[];return Array.isArray(P)&&P.length>0?M=(0,Cn.Z6)(Fn,P[0]):void 0!==I?M.push(Qn("FollowerCount",I)):void 0!==D&&M.push(Qn("CrossDataCenterFollowerCount",D)),{generalInfo:_,tableStatsInfo:A,tabletMetricsInfo:O,partitionConfigInfo:M}},Vr=(0,c.cn)("ydb-diagnostics-table-info"),Hr=e=>{let{data:t,type:a}=e;const r=(0,d.jsx)(kr,{data:null===t||void 0===t?void 0:t.PathDescription}),{generalInfo:i,tableStatsInfo:s,tabletMetricsInfo:o=[],partitionConfigInfo:l=[]}=n.useMemo((()=>$r(t,a)),[t,a]);return(0,d.jsxs)("div",{className:Vr(),children:[(0,d.jsx)(Cn._P,{info:i,title:r,className:Vr("info-block"),renderEmptyState:()=>(0,d.jsx)("div",{className:Vr("title"),children:r})}),(0,d.jsxs)("div",{className:Vr("row"),children:[s?(0,d.jsx)("div",{className:Vr("col"),children:s.map(((e,t)=>(0,d.jsx)(Cn._P,{info:e,title:0===t?zr("tableStats"):void 0,className:Vr("info-block"),renderEmptyState:()=>null},t)))}):null,o.length>0||l.length>0?(0,d.jsxs)("div",{className:Vr("col"),children:[(0,d.jsx)(Cn._P,{info:o,title:zr("tabletMetrics"),className:Vr("info-block"),renderEmptyState:()=>null}),(0,d.jsx)(Cn._P,{info:l,title:zr("partitionConfig"),className:Vr("info-block"),renderEmptyState:()=>null})]}):null]})]})},Zr=e=>{let{data:t,path:a,database:n}=e;const r=wn(null===t||void 0===t?void 0:t.PathDescription);return t?(0,d.jsxs)("div",{children:[(0,d.jsx)(Cn._P,{title:r,info:_r(t)}),(0,d.jsx)(Dr,{path:a,database:n})]}):(0,d.jsxs)("div",{className:"error",children:["No ",r," data"]})};const Wr=function(e){let{type:t,path:a,database:r}=e;const[i]=(0,ve.Rj)(),s=te(t),o=(0,ve.ix)((e=>me(e,a,t,r)),Sn.wU);let l=[];s?o&&(l=[a,...o]):l=[a];const{mergedDescribe:c,loading:u,error:m}=pe({paths:l,database:r,autoRefreshInterval:i}),p=c[a];return u||s&&!o?(0,d.jsx)(Ce.a,{size:"m"}):(0,d.jsxs)(n.Fragment,{children:[m?(0,d.jsx)(Ne.V,{error:m}):null,m&&!p?null:(()=>{var e;const n=null!==p&&void 0!==p?p:void 0,i={[f.EPathTypeInvalid]:void 0,[f.EPathTypeDir]:void 0,[f.EPathTypeTable]:void 0,[f.EPathTypeSubDomain]:void 0,[f.EPathTypeTableIndex]:()=>(0,d.jsx)($n,{data:n}),[f.EPathTypeExtSubDomain]:void 0,[f.EPathTypeColumnStore]:void 0,[f.EPathTypeColumnTable]:void 0,[f.EPathTypeCdcStream]:()=>{const e=null===o||void 0===o?void 0:o[0];var t;if(e)return(0,d.jsx)(Ar,{path:a,database:r,data:n,topic:null!==(t=null===c||void 0===c?void 0:c[e])&&void 0!==t?t:void 0})},[f.EPathTypePersQueueGroup]:()=>(0,d.jsx)(Zr,{data:n,path:a,database:r}),[f.EPathTypeExternalTable]:()=>(0,d.jsx)(sr,{data:n}),[f.EPathTypeExternalDataSource]:()=>(0,d.jsx)(Xn,{data:n}),[f.EPathTypeView]:()=>(0,d.jsx)(pr,{data:n}),[f.EPathTypeReplication]:()=>(0,d.jsx)(Tr,{data:n})};return t&&(null===(e=i[t])||void 0===e?void 0:e.call(i))||(0,d.jsx)(Hr,{data:n,type:t})})()]})};var Jr,Kr=a(81550),Yr=a(72616);function Xr(){return Xr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Xr.apply(this,arguments)}const ei=function(e){return n.createElement("svg",Xr({fill:"currentColor",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},e),Jr||(Jr=n.createElement("path",{d:"M14.195 11.375H3.125v-7.82a.328.328 0 00-.305-.305H1.805a.309.309 0 00-.305.305v9.14c0 .178.127.305.305.305h12.39a.309.309 0 00.305-.305V11.68a.328.328 0 00-.305-.305zm-3.25-5.688L8.812 7.11 6.63 4.24c-.127-.178-.38-.178-.508.026L3.937 7.922v2.64h9.75l-2.285-4.748c-.101-.177-.304-.228-.457-.127z"})))};function ti(e){let{href:t,className:a,size:n="xs"}=e;return(0,d.jsx)(Yr.z,{href:t,target:"_blank",className:a,size:n,title:"Monitoring dashboard",children:(0,d.jsx)(ft.J,{data:ei})})}var ai=a(46987),ni=a(86636),ri=a(14345),ii=a(19214),si=a(62105);const oi=["#7EB26D","#EAB839","#6ED0E0","#EF843C","#E24D42","#1F78C1","#BA43A9","#705DA0","#508642","#CCA300"];const li=e=>{switch(e){case"ms":return ci;case"size":return di;case"percent":return ui;default:return}};function ci(e){return null===e?he.jX:(0,wt.zm)((0,Ie.W0)(mi(e),2))}function di(e){return null===e?he.jX:(0,Ea.td)({value:mi(e),precision:3})}function ui(e){return null===e?he.jX:Math.round(100*mi(e))+"%"}function mi(e){return(0,Qr.kE)(e)?Number(e):0}const pi={"30m":30*he.sU,"1h":he.RQ,"1d":he.ii,"1w":7*he.ii},hi=JSON.parse('{"not-supported":"Charts are not supported on current ydb version"}'),vi=(0,st.wZ)("ydb-metric-chart",{en:hi}),xi=le.h.injectEndpoints({endpoints:e=>({getChartData:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await async function(e){let{database:t,metrics:a,timeFrame:n,maxDataPoints:r}=e,{signal:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=a.map((e=>`target=${e.target}`)).join("&"),o=Math.round(Date.now()/1e3),l=o-pi[n];return window.api.getChartData({target:s,from:l,until:o,maxDataPoints:r,database:t},{signal:i})}(e,{signal:a});if(Array.isArray(t)){const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const a=e.map((e=>{let{datapoints:a,target:n}=e;const r=t.find((e=>e.target===n));if(!r)return;const i=a.map((e=>e[0]));return{...r,data:i}})).filter((e=>void 0!==e));return{timeline:e[0].datapoints.map((e=>1e3*e[1])),metrics:a}}(t,e.metrics);return{data:a}}return{error:new Error("string"===typeof t?vi("not-supported"):t.error)}}catch(n){return{error:n}}},providesTags:["All"],keepUnusedDataFor:0})}),overrideExisting:"throw"}),gi=(0,c.cn)("ydb-metric-chart");ni.X.set({plugins:[ii.YagrPlugin]});const yi=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{dataType:a,scaleRange:n}=t,r=li(a),i=!e.metrics.length,s=e.metrics.map(((e,t)=>{const a=e.color||oi[t],n=function(e,t){const a=(0,si.Vi)(e);if(!a.isValid())throw new Error("Invalid color is passed");return a.alpha(t).toRgbString()}(a,.1);return{id:e.target,name:e.title||e.target,data:e.data,formatter:r,lineColor:a,color:n,legendColorKey:"lineColor"}}));return{data:{timeline:e.timeline,graphs:s},libraryConfig:{chart:{size:{padding:i?[10,0,10,0]:void 0},series:{type:"area",spanGaps:!0,lineWidth:1.5},select:{zoom:!1}},scales:{y:{type:"linear",range:"nice",min:(null===n||void 0===n?void 0:n.min)||0,max:null===n||void 0===n?void 0:n.max}},axes:{y:{values:r?(e,t)=>t.map(r):void 0}},tooltip:{show:!0,tracking:"sticky"}}}},bi={timeline:[],metrics:[]},fi=e=>{let{database:t,title:a,metrics:r,timeFrame:i="1h",autorefresh:s,width:o=400,height:l=o/1.5,chartOptions:c,onChartDataStatusChange:u,isChartVisible:m}=e;const{currentData:p,error:h,isFetching:v,status:x}=xi.useGetChartDataQuery({database:t,metrics:r,timeFrame:i,maxDataPoints:o/2},{pollingInterval:s}),g=v&&!p;n.useEffect((()=>null===u||void 0===u?void 0:u("fulfilled"===x?"success":"loading")),[x,u]);const y=yi(p||bi,c);return(0,d.jsxs)("div",{className:gi(null),style:{height:l,width:o},children:[(0,d.jsx)("div",{className:gi("title"),children:a}),g?(0,d.jsx)(Ce.a,{}):m?(0,d.jsxs)("div",{className:gi("chart"),children:[(0,d.jsx)(ri.ZP,{type:"yagr",data:y}),h?(0,d.jsx)(Ne.V,{className:gi("error"),error:h}):null]}):null]})},Ei=(0,c.cn)("ydb-timeframe-selector"),Si=e=>{let{value:t,onChange:a,className:n}=e;return(0,d.jsx)("div",{className:Ei(null,n),children:Object.keys(pi).map((e=>(0,d.jsx)(Yr.z,{view:"flat",selected:t===e,onClick:()=>a(e),children:e},e)))})},Ti=(0,c.cn)("ydb-tenant-dashboard"),ji=e=>{let{database:t,charts:a}=e;const[r,s]=n.useState(!0),[o="1h",l]=(0,i.useQueryParam)("timeframe",i.StringParam),[c]=(0,ve.Rj)(),u=r?0:c,m=e=>{"success"===e&&s(!1)},p=1===a.length?872:428;return(0,d.jsxs)("div",{className:Ti(null),style:{display:r?"none":void 0},children:[(0,d.jsx)("div",{className:Ti("controls"),children:(0,d.jsx)(Si,{value:o,onChange:l})}),(0,d.jsx)("div",{className:Ti("charts"),children:a.map((e=>{const a=e.metrics.map((e=>{let{target:t}=e;return t})).join("&");return(0,d.jsx)(fi,{database:t,title:e.title,metrics:e.metrics,timeFrame:o,chartOptions:e.options,autorefresh:u,width:p,height:285.3333333333333,onChartDataStatusChange:m,isChartVisible:!r},a)}))})]})},Ni=JSON.parse('{"no-data":"No data","no-pools-data":"No pools data","top-nodes.empty-data":"No such nodes","top-groups.empty-data":"No such groups","top":"Top","nodes":"nodes","shards":"shards","groups":"groups","queries":"queries","tables":"tables","by-pools-usage":"by pools usage","by-cpu-time":"by cpu time, {{executionPeriod}}","by-cpu-usage":"by cpu usage","by-load":"by load","by-memory":"by memory","by-usage":"by usage","by-size":"by size","cards.cpu-label":"CPU","cards.storage-label":"Storage","cards.memory-label":"Memory","charts.queries-per-second":"Queries per second","charts.transaction-latency":"Transactions latencies {{percentile}}","charts.cpu-usage":"CPU usage by pool","charts.storage-usage":"Tablet storage usage","charts.memory-usage":"Memory usage","storage.tablet-storage-title":"Tablet storage","storage.tablet-storage-description":"Size of user data and indexes stored in schema objects (tables, topics, etc.)","storage.db-storage-title":"Database storage","storage.db-storage-description":"Size of data stored in distributed storage with all overheads for redundancy","executed-last-hour":"executed in the last hour","column-header.process":"Process"}'),Ci=(0,st.wZ)("ydb-diagnostics-tenant-overview",{en:Ni}),wi=[{title:Ci("charts.queries-per-second"),metrics:[{target:"queries.requests",title:Ci("charts.queries-per-second")}]},{title:Ci("charts.transaction-latency",{percentile:""}),metrics:[{target:"queries.latencies.p50",title:Ci("charts.transaction-latency",{percentile:"p50"})},{target:"queries.latencies.p75",title:Ci("charts.transaction-latency",{percentile:"p75"})},{target:"queries.latencies.p90",title:Ci("charts.transaction-latency",{percentile:"p90"})},{target:"queries.latencies.p99",title:Ci("charts.transaction-latency",{percentile:"p99"})}],options:{dataType:"ms"}}],Pi=e=>{let{database:t}=e;return(0,d.jsx)(ji,{database:t,charts:wi})},Ii=le.h.injectEndpoints({endpoints:e=>({getHealthcheckInfo:e.query({queryFn:async(e,t)=>{let{database:a,maxLevel:n}=e,{signal:r}=t;try{return{data:await window.api.getHealthcheckInfo({database:a,maxLevel:n},{signal:r})}}catch(i){return{error:i}}},providesTags:["All"]})}),overrideExisting:"throw"}),Di={RED:0,ORANGE:1,YELLOW:2,BLUE:3,GREEN:4},_i=e=>e.sort(((e,t)=>(Di[e.status]||0)-(Di[t.status]||0))),Ri=e=>{let{issue:t,data:a}=e;return _i(a.filter((e=>t.reason&&-1!==t.reason.indexOf(e.id))))},Ai=e=>_i(e.filter((t=>!e.find((e=>e.reason&&-1!==e.reason.indexOf(t.id)))))),Oi=e=>{let{data:t,roots:a}=e;return a?a.map((e=>{const a=Oi({roots:Ri({issue:e,data:t}),data:t});return{...e,reasonsItems:a}})):[]},Mi=e=>{const t={};for(const a of e)t[a.status]||(t[a.status]=0),t[a.status]++;return Object.entries(t).sort(((e,t)=>{let[a]=e,[n]=t;return(Di[a]||0)-(Di[n]||0)}))},ki=(0,y.P1)((e=>e),(e=>Ii.endpoints.getHealthcheckInfo.select({database:e}))),Li=(0,y.P1)((e=>e),((e,t)=>ki(t)),((e,t)=>{var a;return(null===(a=t(e).data)||void 0===a?void 0:a.issue_log)||[]})),zi=(0,y.P1)(Li,(function(){return Ai(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])})),qi=(0,y.P1)([Li,zi],(function(){return Oi({data:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],roots:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]})})),Ui=(0,y.P1)(Li,(function(){return Mi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])}));let Fi,Qi;!function(e){e.UNSPECIFIED="UNSPECIFIED",e.GOOD="GOOD",e.DEGRADED="DEGRADED",e.MAINTENANCE_REQUIRED="MAINTENANCE_REQUIRED",e.EMERGENCY="EMERGENCY"}(Fi||(Fi={})),function(e){e.UNSPECIFIED="UNSPECIFIED",e.GREY="GREY",e.GREEN="GREEN",e.BLUE="BLUE",e.YELLOW="YELLOW",e.ORANGE="ORANGE",e.RED="RED"}(Qi||(Qi={}));const Gi=function(e){let{autorefresh:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{currentData:a,isFetching:n,error:r,refetch:i}=Ii.useGetHealthcheckInfoQuery({database:e},{pollingInterval:t}),s=(null===a||void 0===a?void 0:a.self_check_result)||Fi.UNSPECIFIED,o=(0,ve.ix)((t=>Ui(t,e)));return{issueTrees:(0,ve.ix)((t=>qi(t,e))),issuesStatistics:o,loading:void 0===a&&n,error:r,refetch:i,selfCheckResult:s}};var Bi=a(83202),$i=a(77468);const Vi={[Qi.UNSPECIFIED]:$i.K.Grey,[Qi.GREY]:$i.K.Grey,[Qi.GREEN]:$i.K.Green,[Qi.BLUE]:$i.K.Blue,[Qi.YELLOW]:$i.K.Yellow,[Qi.ORANGE]:$i.K.Orange,[Qi.RED]:$i.K.Red},Hi=(0,c.cn)("issue-tree-item"),Zi=e=>{let{status:t,message:a,type:n,onClick:r}=e;return(0,d.jsxs)("div",{className:Hi(),onClick:r,children:[(0,d.jsx)("div",{className:Hi("field",{status:!0}),children:(0,d.jsx)(Vn.A,{mode:"icons",status:t,name:n})}),(0,d.jsx)("div",{className:Hi("field",{message:!0}),children:a})]})},Wi=(0,c.cn)("issue-tree"),Ji=e=>{let{issueTree:t}=e;const[a,r]=n.useState({}),i=n.useCallback((e=>e?(0,d.jsx)("div",{className:Wi("info-panel"),children:(0,d.jsx)(En(),{data:e,search:!1,isExpanded:()=>!0,className:Wi("inspector")})}):null),[]),s=n.useCallback((e=>e.map((e=>{const{id:t}=e,{status:n,message:o,type:l,reasonsItems:c,level:u,...m}=e,p="undefined"===typeof a[t]||a[t],h=()=>{r((e=>({...e,[t]:!p})))};return(0,d.jsxs)(Bi.L,{name:(0,d.jsx)(Zi,{status:Vi[n],message:o,type:l}),collapsed:p,hasArrow:!0,onClick:h,onArrowClick:h,level:u-1,children:[i(Ur()(m,["reason"])),s(c||[])]},t)}))),[a,i]);return(0,d.jsx)("div",{className:Wi(),children:(0,d.jsx)("div",{className:Wi("block"),children:s([t])})})},Ki=JSON.parse('{"title.healthcheck":"Healthcheck","label.update":"Update","label.show-details":"Show details","label.issues":"Issues:","status_message.ok":"No issues","no-data":"no healthcheck data"}'),Yi=JSON.parse('{"title.healthcheck":"Healthcheck","label.update":"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c","label.show-details":"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0441\u0442\u0438","label.issues":"\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u044b:","status_message.ok":"\u041d\u0435\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c","no-data":"\u043d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 healthcheck"}'),Xi=(0,st.wZ)("ydb-diagnostics-healthcheck",{ru:Yi,en:Ki}),es=(0,c.cn)("healthcheck");function ts(e){let{tenantName:t}=e;const[a]=(0,ve.Rj)(),{issueTrees:r,loading:i,error:s}=Gi(t,{autorefresh:a});return(0,d.jsx)("div",{className:es("details"),children:(0,d.jsx)("div",{className:es("details-content-wrapper"),children:s?(0,d.jsx)(Ne.V,{error:s,defaultMessage:Xi("no-data")}):i?(0,d.jsx)(Ce.a,{size:"m"}):r&&r.length?(0,d.jsx)(n.Fragment,{children:r.map((e=>(0,d.jsx)(Ji,{issueTree:e},e.id)))}):Xi("status_message.ok")})})}var as=a(93145),ns=a(29837),rs=a(22927),is=a(52232),ss=a(92921),os=a(15268),ls=a(29331);const cs=(0,c.cn)("healthcheck"),ds={[Fi.UNSPECIFIED]:ns.Z,[Fi.GOOD]:rs.Z,[Fi.DEGRADED]:is.Z,[Fi.MAINTENANCE_REQUIRED]:ss.Z,[Fi.EMERGENCY]:os.Z};function us(e){const{tenantName:t,active:a}=e,[n]=(0,ve.Rj)(),{currentData:r,isFetching:i,error:s}=Ii.useGetHealthcheckInfoQuery({database:t},{pollingInterval:n}),o=i&&void 0===r;return(0,d.jsxs)(ls.Q,{className:cs("preview"),active:a,children:[(0,d.jsx)("div",{className:cs("preview-header"),children:(0,d.jsx)("div",{className:cs("preview-title-wrapper"),children:(0,d.jsx)("div",{className:cs("preview-title"),children:Xi("title.healthcheck")})})}),(()=>{if(s)return(0,d.jsx)(Ne.V,{error:s,defaultMessage:Xi("no-data")});if(o)return(0,d.jsx)(Ce.a,{size:"m"});const e=(null===r||void 0===r?void 0:r.self_check_result)||Fi.UNSPECIFIED,t=e.toLowerCase();return(0,d.jsx)("div",{className:cs("preview-content"),children:(0,d.jsxs)("div",{className:cs("preview-issue",{[t]:!0}),children:[(0,d.jsx)(ft.J,{className:cs("preview-status-icon"),data:ds[e]}),(0,d.jsx)("div",{className:cs("self-check-status-indicator"),children:e.replace(/_/g," ")})]})})})()]})}var ms=a(20760),ps=a(73287);const hs=(0,c.cn)("ydb-metrics-card"),vs=e=>{let t;return"Warning"===e&&(t=$i.K.Yellow),"Danger"===e&&(t=$i.K.Red),t?(0,d.jsx)(ps.J,{status:t,mode:"icons",size:"l"}):null};function xs(e){let{active:t,label:a,status:n,metrics:r}=e;return(0,d.jsxs)(ls.Q,{className:hs({active:t}),active:t,children:[(0,d.jsxs)("div",{className:hs("header"),children:[a&&(0,d.jsx)("div",{className:hs("label"),children:a}),vs(n)]}),(0,d.jsx)("div",{className:hs("content"),children:r.map(((e,t)=>{let{title:a,...n}=e;return(0,d.jsxs)("div",{className:hs("metric"),children:[(0,d.jsx)("div",{className:hs("metric-title"),children:a}),(0,d.jsx)(ms.y,{size:"xs",colorizeProgress:!0,...n})]},t)}))})]})}const gs=(0,c.cn)("metrics-cards");function ys(e){let{poolsCpuStats:t,memoryStats:a,blobStorageStats:n,tabletStorageStats:r,tenantName:i}=e;const s=(0,er.TH)(),{metricsTab:o}=(0,ve.ix)((e=>e.tenant)),l=(0,Re.mB)(s),c=e=>e===o?"":e,u={[ge.Xk.cpu]:(0,da.Sj)({...l,[da.XV.metricsTab]:c(ge.Xk.cpu)}),[ge.Xk.storage]:(0,da.Sj)({...l,[da.XV.metricsTab]:c(ge.Xk.storage)}),[ge.Xk.memory]:(0,da.Sj)({...l,[da.XV.metricsTab]:c(ge.Xk.memory)}),[ge.Xk.healthcheck]:(0,da.Sj)({...l,[da.XV.metricsTab]:c(ge.Xk.healthcheck)})};return(0,d.jsxs)("div",{className:gs(),children:[(0,d.jsx)(be.rU,{to:u.cpu,className:gs("tab"),children:(0,d.jsx)(bs,{poolsCpuStats:t,active:o===ge.Xk.cpu})}),(0,d.jsx)(be.rU,{to:u.storage,className:gs("tab"),children:(0,d.jsx)(fs,{blobStorageStats:n,tabletStorageStats:r,active:o===ge.Xk.storage})}),(0,d.jsx)(be.rU,{to:u.memory,className:gs("tab"),children:(0,d.jsx)(Es,{memoryStats:a,active:o===ge.Xk.memory})}),(0,d.jsx)(be.rU,{to:u.healthcheck,className:gs("tab"),children:(0,d.jsx)(us,{tenantName:i,active:o===ge.Xk.healthcheck})})]})}function bs(e){let{poolsCpuStats:t=[],active:a}=e,n=as.L.Unspecified;const r=t.filter((e=>!("Batch"===e.name||"IO"===e.name))).map((e=>{const{name:t,usage:a,limit:r,used:i}=e,s=(0,ai.Vn)(a);return as.l[s]>as.l[n]&&(n=s),{title:t,value:i,capacity:r,warningThreshold:ai.hJ,dangerThreshold:ai.Gz}}));return(0,d.jsx)(xs,{label:Ci("cards.cpu-label"),active:a,metrics:r,status:n})}function fs(e){let{blobStorageStats:t=[],tabletStorageStats:a,active:n}=e,r=as.L.Unspecified;const i=(a||t).map((e=>{const{name:t,used:a,limit:n,usage:i}=e,s=(0,ai._W)(i);return as.l[s]>as.l[r]&&(r=s),{title:t,value:a,capacity:n,warningThreshold:ai._g,dangerThreshold:ai.nD,formatValues:Ie.QO}}));return(0,d.jsx)(xs,{label:Ci("cards.storage-label"),active:n,metrics:i,status:r})}function Es(e){let{active:t,memoryStats:a=[]}=e,n=as.L.Unspecified;const r=a.map((e=>{const{name:t,used:a,limit:r,usage:i}=e,s=(0,ai.Lv)(i);return as.l[s]>as.l[n]&&(n=s),{title:t,value:a,capacity:r,warningThreshold:ai.B8,dangerThreshold:ai.nr,formatValues:Ie.QO}}));return(0,d.jsx)(xs,{label:Ci("cards.memory-label"),active:t,metrics:r,status:n})}var Ss=a(2387),Ts=a(60918),js=a(88366),Ns=a(83023);const Cs=(0,c.cn)("tenant-overview");function ws(e){let{title:t,error:a,loading:r,tableClassNameModifiers:i={},...s}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:Cs("title"),children:t}),a?(0,d.jsx)(Ne.V,{error:a}):null,(0,d.jsx)("div",{className:Cs("table",i),children:a&&0===s.data.length?null:r?(0,d.jsx)(Mt.h,{rows:he.fl}):(0,d.jsx)(tt.G,{settings:he.E6,...s})})]})}var Ps=a(32489);const Is=e=>{let{prefix:t=Ci("top"),entity:a,postfix:r,link:i,onClick:s}=e;return i?(0,d.jsxs)(n.Fragment,{children:[t," ",(0,d.jsx)(Ps.h,{to:i,onClick:s,children:a})," ",r]}):`${t} ${a} ${r}`};function Ds(e){let{tenantName:t,additionalNodesProps:a}=e;const n=(0,ve.A3)(),[r]=(0,ve.Rj)(),[i,s]=function(e){const t={...(0,Ss.Up)(e),width:void 0},a=[(0,Ss.o9)(),(0,Ss.A6)(),t].map((e=>({...e,sortable:!1}))),n=a.map((e=>e.name));return[a,(0,Ns.w)(n,Ts.WN)]}({getNodeRef:null===a||void 0===a?void 0:a.getNodeRef,database:t}),{currentData:o,isFetching:l,error:c}=js.k.useGetNodesQuery({tenant:t,type:"any",sort:"-CPU",limit:he.fl,tablets:!1,fieldsRequired:s},{pollingInterval:r}),u=l&&void 0===o,m=(null===o||void 0===o?void 0:o.Nodes)||[],p=Is({entity:Ci("nodes"),postfix:Ci("by-pools-usage"),link:(0,da.Sj)({...n,[da.XV.diagnosticsTab]:ge.qQ.nodes})});return(0,d.jsx)(ws,{columnsWidthLSKey:Ts.t5,data:m,columns:i,title:p,loading:u,error:c,emptyDataMessage:Ci("top-nodes.empty-data")})}function _s(e){let{tenantName:t,additionalNodesProps:a}=e;const n=(0,ve.A3)(),[r]=(0,ve.Rj)(),[i,s]=function(e){const t={...(0,Ss.Up)(e),width:void 0},a=[(0,Ss.OJ)(),(0,Ss.A6)(),t,(0,Ss.Zi)()].map((e=>({...e,sortable:!1}))),n=a.map((e=>e.name));return[a,(0,Ns.w)(n,Ts.WN)]}({getNodeRef:null===a||void 0===a?void 0:a.getNodeRef,database:t}),{currentData:o,isFetching:l,error:c}=js.k.useGetNodesQuery({tenant:t,type:"any",sort:"-LoadAverage",limit:he.fl,tablets:!1,fieldsRequired:s},{pollingInterval:r}),u=l&&void 0===o,m=(null===o||void 0===o?void 0:o.Nodes)||[],p=Is({entity:Ci("nodes"),postfix:Ci("by-load"),link:(0,da.Sj)({...n,[da.XV.diagnosticsTab]:ge.qQ.nodes})});return(0,d.jsx)(ws,{columnsWidthLSKey:Ts.t5,data:m,columns:i,title:p,loading:u,error:c,emptyDataMessage:Ci("top-nodes.empty-data")})}var Rs=a(55159),As=a(23367),Os=a(15428),Ms=a(68585);const ks=JSON.parse('{"action_cancel":"Cancel"}'),Ls=(0,st.wZ)("ydb-confirmation-dialog",{en:ks}),zs=(0,c.cn)("confirmation-dialog"),qs="confirmation-dialog";function Us(e){let{caption:t="",children:a,onConfirm:n,onClose:r,progress:i,textButtonApply:s,textButtonCancel:o,buttonApplyView:l="normal",className:c,renderButtons:u,open:m}=e;return(0,d.jsxs)(Ms.V,{className:zs(null,c),size:"s",onClose:r,disableOutsideClick:!0,open:m,children:[(0,d.jsx)(Ms.V.Header,{caption:(0,d.jsx)("span",{className:zs("caption"),children:t})}),(0,d.jsx)(Ms.V.Body,{children:a}),(0,d.jsx)(Ms.V.Footer,{onClickButtonApply:n,propsButtonApply:{view:l},textButtonApply:s,textButtonCancel:null!==o&&void 0!==o?o:Ls("action_cancel"),onClickButtonCancel:r,loading:i,renderButtons:u})]})}const Fs=Os.Ue((e=>{const t=Os.dd(),a=()=>{t.hide(),t.remove()};return(0,d.jsx)(Us,{...e,onConfirm:async()=>{var n;await(null===(n=e.onConfirm)||void 0===n?void 0:n.call(e)),t.resolve(!0),a()},onClose:()=>{var n;null===(n=e.onClose)||void 0===n||n.call(e),t.resolve(!1),a()},open:t.visible})}));Os.z2(qs,Fs);var Qs=a(36413),Gs=a(86357),Bs=a(6130);function $s(){const[e]=(0,ve.yu)(he.DG,[]),t=(0,ve.ix)(Bs.zC).toLowerCase();return t?e.filter((e=>e.body.toLowerCase().includes(t))):e}const Vs=JSON.parse('{"action.save":"Save query","action.edit":"Edit query","action.save-as-new":"Save as new","action.edit-existing":"Edit existing","description":"The query will be saved in your browser","input-label":"Query name","input-placeholder":"Enter query name","button-apply":"Save","button-cancel":"Cancel","error.name-exists":"This name already exists","error.name-not-empty":"Name should not be empty"}'),Hs=(0,st.wZ)("ydb-save-query-dialog",{en:Vs}),Zs=(0,c.cn)("ydb-save-query");function Ws(e){const t=(0,ve.zL)();return n.useCallback((()=>{Os.ZP.show(Xs,e),t((0,Bs.y3)())}),[t,e])}function Js(e){let{dialogProps:t,...a}=e;const n=Ws(t);return(0,d.jsx)(Yr.z,{onClick:n,...a,children:Hs("action.save")})}function Ks(e){let{buttonProps:t={}}=e;const a=(0,ve.zL)(),n=(0,ve.ix)(Bs.g0),r=Ws(),i=()=>{a((0,Bs.PM)(n)),a((0,Bs.y3)())};return n?(()=>{const e=[{action:i,text:Hs("action.edit-existing")},{action:r,text:Hs("action.save-as-new")}];return(0,d.jsx)(Qs.h,{items:e,renderSwitcher:e=>(0,d.jsx)(Yr.z,{...e,...t,children:Hs("action.edit")}),popupProps:{placement:"top"}})})():(0,d.jsx)(Js,{})}function Ys(e){let{onSuccess:t,onCancel:a,onClose:r,open:i}=e;const s=$s(),o=(0,ve.zL)(),[l,c]=n.useState(""),[u,m]=n.useState(),p=()=>{o((0,Bs.lm)("idle")),c(""),m(void 0),null===r||void 0===r||r()},h=()=>{null===a||void 0===a||a(),p()};return(0,d.jsxs)(Ms.V,{open:i,hasCloseButton:!1,size:"s",onClose:h,children:[(0,d.jsx)(Ms.V.Header,{caption:Hs("action.save")}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault();const a=(n=l)?s.some((e=>e.name.toLowerCase()===n.trim().toLowerCase()))?Hs("error.name-exists"):void 0:Hs("error.name-not-empty");var n;m(a),a||(o((0,Bs.PM)(l)),p(),null===t||void 0===t||t())},children:[(0,d.jsxs)(Ms.V.Body,{className:Zs("dialog-body"),children:[(0,d.jsx)("div",{className:Zs("dialog-row"),children:Hs("description")}),(0,d.jsxs)("div",{className:Zs("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"queryName",className:Zs("field-title","required"),children:Hs("input-label")}),(0,d.jsx)("div",{className:Zs("control-wrapper"),children:(0,d.jsx)(Gs.o,{id:"queryName",placeholder:Hs("input-placeholder"),value:l,onUpdate:e=>{c(e),m(void 0)},hasClear:!0,autoFocus:!0,autoComplete:!1,validationState:u?"invalid":void 0,errorMessage:u})})]})]}),(0,d.jsx)(Ms.V.Footer,{textButtonApply:Hs("button-apply"),textButtonCancel:Hs("button-cancel"),onClickButtonCancel:h,propsButtonApply:{type:"submit"}})]})]})}const Xs="save-query-dialog",eo=Os.ZP.create((e=>{const t=Os.ZP.useModal();return(0,d.jsx)(Ys,{...e,onClose:()=>{var a;null===(a=e.onClose)||void 0===a||a.call(e),t.hide(),t.remove()},open:t.visible})}));Os.ZP.register(Xs,eo);const to=JSON.parse('{"action_apply":"Don\'t save","context_unsaved-changes-warning":"You have unsaved changes in query editor.\\nDo you want to proceed?"}'),ao=(0,st.wZ)("ydb-change-input-confirmation",{en:to});function no(){const e=Os.ZP.useModal(qs),t=n.useCallback((()=>{e.hide(),e.remove()}),[e]),a=n.useCallback((()=>{e.resolve(!0),t()}),[e,t]),r=n.useCallback((()=>{e.resolve(!1),t()}),[t,e]),i=n.useMemo((()=>({onSuccess:a,onCancel:r})),[a,r]);return(0,d.jsx)(Js,{view:"action",size:"l",dialogProps:i})}async function ro(){return await Os.ZP.show(qs,{id:qs,caption:ao("context_unsaved-changes-warning"),textButtonApply:ao("action_apply"),propsButtonApply:{view:"l"},renderButtons:(e,t)=>(0,d.jsxs)(n.Fragment,{children:[t,(0,d.jsx)(no,{}),e]})})}function io(e){const t=(0,ve.ix)(As.jm),a=n.useMemo((()=>function(e){return async t=>{await ro()&&e(t)}}(e)),[e]);return t?a:e}const so=(0,c.cn)("kv-truncated-query"),oo=e=>{let{value:t="",maxQueryHeight:a=6}=e;const r=t.split("\n");if(r.length>a){const e=r.slice(0,a).join("\n"),t="\n...\nThe request was truncated. Click on the line to show the full query on the query tab";return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("span",{className:so(),children:e}),(0,d.jsx)("span",{className:so("message",{color:"secondary"}),children:t})]})}return(0,d.jsx)(n.Fragment,{children:t})},lo=e=>{let{value:t=""}=e;return(0,d.jsx)(St.l,{contentClassName:so("popover-content"),content:t,children:t})},co="CPUTime",uo="QueryText",mo="EndTime",po="ReadRows",ho="ReadBytes",vo="UserSID",xo="OneLineQueryText",go="QueryHash",yo="Duration",bo="CPUCores",fo="PeakTime",Eo="IntervalEnd",So=[bo,"DataSize","InFlightTxCount"],To=[co,mo,po,ho,vo,yo],jo=e=>Object.values(So).includes(e);var No=a(57857),Co=a.n(No);const wo=6,Po={...he.LE,dynamicRenderType:"variable"},Io=JSON.parse('{"no-data":"No data","filter.text.placeholder":"Search by query text or userSID...","mode_top":"Top","mode_running":"Running","col_user":"User","col_start-time":"Start time","col_query-text":"Query text","col_app":"Application"}'),Do=(0,st.wZ)("ydb-diagnostics-top-queries",{en:Io}),_o=(0,c.cn)("kv-top-queries"),Ro="topQueriesColumnsWidth",Ao={name:co,sortAccessor:e=>Number(e.CPUTimeUs),render:e=>{var t;let{row:a}=e;return(0,wt.zm)((0,wt.BO)(null!==(t=a.CPUTimeUs)&&void 0!==t?t:void 0))},width:120,align:$t.ZP.RIGHT,sortable:!1},Oo={name:uo,sortAccessor:e=>Number(e.CPUTimeUs),render:e=>{var t;let{row:a}=e;return(0,d.jsx)("div",{className:_o("query"),children:(0,d.jsx)(oo,{value:null===(t=a.QueryText)||void 0===t?void 0:t.toString(),maxQueryHeight:wo})})},sortable:!1,width:500},Mo={name:mo,render:e=>{let{row:t}=e;return(0,Ie.o0)(new Date(t.EndTime).getTime())},align:$t.ZP.RIGHT,width:200},ko={name:po,render:e=>{let{row:t}=e;return(0,Ie.uf)(t.ReadRows)},sortAccessor:e=>Number(e.ReadRows),align:$t.ZP.RIGHT,width:150},Lo={name:ho,render:e=>{let{row:t}=e;return(0,Ie.uf)(t.ReadBytes)},sortAccessor:e=>Number(e.ReadBytes),align:$t.ZP.RIGHT,width:150},zo={name:vo,render:e=>{let{row:t}=e;return(0,d.jsx)("div",{className:_o("user-sid"),children:t.UserSID||"\u2013"})},sortAccessor:e=>String(e.UserSID),align:$t.ZP.LEFT},qo={name:xo,header:"QueryText",render:e=>{var t;let{row:a}=e;return(0,d.jsx)(lo,{value:null===(t=a.QueryText)||void 0===t?void 0:t.toString()})},sortable:!1,width:500},Uo={name:go,render:e=>{let{row:t}=e;return a=String(t.QueryText),(Co().str(a)>>>0).toString(16).toUpperCase().padStart(8,"0");var a},width:130,sortable:!1},Fo={name:yo,header:"Duration",render:e=>{var t;let{row:a}=e;return(0,wt.zm)((0,wt.BO)(null!==(t=a.Duration)&&void 0!==t?t:void 0))},sortAccessor:e=>Number(e.Duration),align:$t.ZP.RIGHT,width:150},Qo={name:"QueryStartAt",get header(){return Do("col_start-time")},render:e=>{let{row:t}=e;return(0,Ie.o0)(new Date(t.QueryStartAt).getTime())},sortable:!0,resizeable:!1,defaultOrder:$t.ZP.DESCENDING},Go=[Ao,Oo,Mo,Fo,ko,Lo,zo],Bo=[Uo,qo,Ao],$o=[zo,Qo,Oo,{name:"ApplicationName",get header(){return Do("col_app")},render:e=>{let{row:t}=e;return(0,d.jsx)("div",{className:_o("user-sid"),children:t.ApplicationName||"\u2013"})},sortable:!0}];function Vo(e){var t,a;let{tenantName:r}=e;const i=(0,ve.zL)(),s=(0,er.TH)(),o=(0,er.k6)(),l=(0,Re.mB)(s),[c]=(0,ve.Rj)(),u=Bo,{currentData:m,isFetching:p,error:h}=Rs.MU.useGetTopQueriesQuery({database:r},{pollingInterval:c}),v=p&&void 0===m,x=(null===m||void 0===m||null===(t=m.resultSets)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.result)||[],g=io(n.useCallback((e=>{const{QueryText:t}=e;i((0,As.B8)({input:t}));const a=(0,Re.mB)(s),n=(0,da.Sj)({...a,[ge.bS]:ge.m2.query,[da.XV.queryTab]:ge._0.newQuery});o.push(n)}),[i,o,s])),y=Is({entity:Ci("queries"),postfix:Ci("by-cpu-time",{executionPeriod:Ci("executed-last-hour")}),onClick:()=>{i((0,Rs.Im)({from:void 0,to:void 0}))},link:(0,da.Sj)({...l,[da.XV.diagnosticsTab]:ge.qQ.topQueries})});return(0,d.jsx)(ws,{columnsWidthLSKey:Ro,data:x||[],columns:u,onRowClick:g,title:y,loading:v,error:(0,kt.fV)(h),rowClassName:()=>Cs("top-queries-row")})}function Ho(e,t){return`SELECT\n    ${t?`CAST(SUBSTRING(CAST(Path AS String), ${t.length}) AS Utf8) AS Path`:"Path"},\n    TabletId,\n    CPUCores,\nFROM \`.sys/partition_stats\`\nWHERE\n    Path='${e}'\n    OR Path LIKE '${e}/%'\nORDER BY CPUCores DESC\nLIMIT ${he.fl}`}const Zo=le.h.injectEndpoints({endpoints:e=>({getTopShards:e.query({queryFn:async(e,t)=>{let{database:a,path:n=""}=e,{signal:r}=t;try{const e=await window.api.sendQuery({query:Ho(n,a),database:a,action:"execute-scan"},{signal:r,withRetries:!0});return(0,kt.gW)(e)?{error:e}:{data:(0,kt.Ae)(e)}}catch(i){return{error:i||new Error("Unauthorized")}}},providesTags:["All"]})}),overrideExisting:"throw"});var Wo=a(17823);function Jo(e){let{path:t,location:a,...n}=e;const r=(0,Re.mB)(a),i=(0,Re.vF)({...r,schema:t});return(0,d.jsx)(Wo.r,{view:"normal",...n,href:i})}var Ko=a(76217),Yo=a(46931);const Xo=(0,a(84029).p)(60,80,["success","warning","danger"]);var el=a(75544);const tl="topShardsColumnsWidth",al="TabletId",nl="CPUCores",rl="DataSize",il="Path",sl="NodeId",ol="InFlightTxCount",ll={TabletId:"TabletId",CPUCores:"CPUCores",DataSize:"DataSize (B)",Path:"Path",NodeId:"NodeId",PeakTime:"PeakTime",InFlightTxCount:"InFlightTxCount",IntervalEnd:"IntervalEnd"};const cl=(e,t)=>({name:il,header:ll[il],render:a=>{let{row:n}=a;return(0,d.jsx)(Jo,{path:e+n.Path,location:t,children:n.Path})},sortable:!1,width:300}),dl={name:nl,header:ll[nl],render:e=>{let{row:t}=e;return a=t.CPUCores||0,`${(0,Ie.W0)(100*Number(a),2)}%`;var a},align:$t.ZP.RIGHT},ul={name:rl,header:ll[rl],render:e=>{let{row:t}=e;return(0,Ie.uf)(t.DataSize)},align:$t.ZP.RIGHT},ml={name:al,header:ll[al],render:e=>{let{row:t}=e;return t.TabletId?(0,d.jsx)(Ko.P,{tabletId:t.TabletId}):"\u2013"},sortable:!1,width:220},pl={name:sl,header:ll[sl],render:e=>{let{row:t}=e;return t.NodeId?(0,d.jsx)(za.h,{to:(0,el.a3)(t.NodeId),children:t.NodeId}):"\u2013"},align:$t.ZP.RIGHT},hl={name:nl,header:ll[nl],render:e=>{let{row:t}=e;return(0,d.jsx)(Yo.a,{value:(0,Ie.W0)(100*Number(t.CPUCores),2),theme:Xo(100*Number(t.CPUCores))})},align:$t.ZP.RIGHT,sortable:!1,width:140,resizeMinWidth:140},vl={name:ol,header:ll[ol],render:e=>{let{row:t}=e;return(0,Ie.uf)(t.InFlightTxCount)},align:$t.ZP.RIGHT},xl=e=>{var t,a;let{tenantName:n,path:r}=e;const i=(0,er.TH)(),s=(0,Re.mB)(i),[o]=(0,ve.Rj)(),{currentData:l,isFetching:c,error:u}=Zo.useGetTopShardsQuery({database:n,path:r},{pollingInterval:o}),m=c&&void 0===l,p=(null===l||void 0===l||null===(t=l.resultSets)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.result)||[],h=((e,t)=>[ml,cl(e,t),hl])(n,i),v=Is({entity:Ci("shards"),postfix:Ci("by-cpu-usage"),link:(0,da.Sj)({...s,[da.XV.diagnosticsTab]:ge.qQ.topShards})});return(0,d.jsx)(ws,{columnsWidthLSKey:tl,data:p||[],columns:h,title:v,loading:m,error:(0,kt.fV)(u)})},gl=[{title:Ci("charts.cpu-usage"),metrics:["IC","IO","Batch","User","System"].map((e=>({target:`resources.cpu.${e}.usage`,title:e}))),options:{dataType:"percent",scaleRange:{min:0,max:1}}}];function yl(e){let{tenantName:t,additionalNodesProps:a}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(ji,{database:t,charts:gl}),(0,d.jsx)(_s,{tenantName:t,additionalNodesProps:a}),(0,d.jsx)(Ds,{tenantName:t,additionalNodesProps:a}),(0,d.jsx)(xl,{tenantName:t,path:t}),(0,d.jsx)(Vo,{tenantName:t})]})}var bl=a(92146);function fl(e){let{tenantName:t,additionalNodesProps:a}=e;const n=(0,ve.A3)(),[r]=(0,ve.Rj)(),[i,s]=function(e){const t=[(0,Ss.A6)(),(0,Ss.Up)(e),(0,Ss.VQ)(),(0,Ss.OJ)(),(0,Ss.rh)(),(0,Ss.As)(),(0,Ss.TX)(e)].map((e=>({...e,sortable:!1}))),a=t.map((e=>e.name));return[t,(0,Ns.w)(a,Ts.WN)]}({getNodeRef:null===a||void 0===a?void 0:a.getNodeRef,database:t}),{currentData:o,isFetching:l,error:c}=js.k.useGetNodesQuery({tenant:t,type:"any",tablets:!0,sort:"-Memory",limit:he.fl,fieldsRequired:s},{pollingInterval:r}),u=l&&void 0===o,m=(null===o||void 0===o?void 0:o.Nodes)||[],p=Is({entity:Ci("nodes"),postfix:Ci("by-memory"),link:(0,da.Sj)({...n,[da.XV.diagnosticsTab]:ge.qQ.nodes})});return(0,d.jsx)(ws,{columnsWidthLSKey:Ts.t5,data:m,columns:i,title:p,loading:u,error:c,emptyDataMessage:Ci("top-nodes.empty-data")})}const El=[{title:Ci("charts.memory-usage"),metrics:[{target:"resources.memory.used_bytes",title:Ci("charts.memory-usage")}],options:{dataType:"size"}}];function Sl(e){let{tenantName:t,memoryStats:a,memoryUsed:r,memoryLimit:i}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(ji,{database:t,charts:El}),(0,d.jsx)("div",{className:Cs("title"),children:"Memory details"}),(0,d.jsx)("div",{className:Cs("memory-info"),children:a?(0,d.jsx)(bl.O,{formatValues:Ie.q3,stats:a}):(0,d.jsx)(ms.y,{value:r,capacity:i,formatValues:Ie.q3,colorizeProgress:!0})}),(0,d.jsx)(fl,{tenantName:t})]})}var Tl=a(43862),jl=a(89085),Nl=a(96635),Cl=a(78090);function wl(e){let{tenant:t}=e;const a=(0,ve.A3)(),n=(0,Ee.rU)(),r=(0,Ee.tS)(),[i]=(0,ve.Rj)(),[s,o]=function(){const e=(0,Nl.m)(),t=e.map((e=>e.name));return[e,(0,Ns.w)(t,Cl.h2)]}(),{currentData:l,isFetching:c,error:u}=jl.y.useGetStorageGroupsInfoQuery({tenant:t,sort:"-Usage",with:"all",limit:he.fl,shouldUseGroupsHandler:r,fieldsRequired:o},{pollingInterval:i,skip:!n}),m=c&&void 0===l,p=(null===l||void 0===l?void 0:l.groups)||[],h=Is({entity:Ci("groups"),postfix:Ci("by-usage"),link:(0,da.Sj)({...a,[da.XV.diagnosticsTab]:ge.qQ.storage})});return(0,d.jsx)(ws,{columnsWidthLSKey:Cl.Ty,data:p,columns:s,title:h,loading:m||!n,error:u})}const Pl=e=>`\nSELECT\n    Path, SUM(DataSize) as Size\nFROM \`${e}/.sys/partition_stats\`\nGROUP BY Path\n    ORDER BY Size DESC\n    LIMIT ${he.fl}\n`,Il=le.h.injectEndpoints({endpoints:e=>({getTopTables:e.query({queryFn:async(e,t)=>{let{path:a}=e,{signal:n}=t;try{const e=await window.api.sendQuery({query:Pl(a),database:a,action:"execute-scan"},{signal:n,withRetries:!0});return(0,kt.gW)(e)?{error:e}:{data:(0,kt.Ae)(e)}}catch(r){return{error:r||"Unauthorized"}}},providesTags:["All"]})}),overrideExisting:"throw"}),Dl="topTablesTableColumnsWidth";function _l(e){var t,a;let{path:n}=e;const r=(0,er.TH)(),[i]=(0,ve.Rj)(),{currentData:s,error:o,isFetching:l}=Il.useGetTopTablesQuery({path:n},{pollingInterval:i}),c=l&&void 0===s,u=(null===s||void 0===s||null===(t=s.resultSets)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.result)||[],m=[{name:"Size",width:100,sortable:!1,render:e=>{let{row:t}=e;return(e=>{const t=(0,Ea.dT)(null!==u&&void 0!==u&&u.length?Number(u[0].Size):0,0);return(0,Ea.td)({value:e,size:t,precision:1})})(Number(t.Size))},align:$t.ZP.RIGHT},{name:"Path",width:700,sortable:!1,render:e=>{let{row:t}=e;return t.Path?(0,d.jsx)(St.l,{content:t.Path,children:(0,d.jsx)(Jo,{path:String(t.Path),location:r,children:t.Path})}):null}}],p=Is({entity:Ci("tables"),postfix:Ci("by-size")});return(0,d.jsx)(ws,{columnsWidthLSKey:Dl,data:u||[],columns:m,title:p,loading:c,error:(0,kt.fV)(o)})}const Rl=[{title:Ci("charts.storage-usage"),metrics:[{target:"resources.storage.used_bytes",title:Ci("charts.storage-usage")}],options:{dataType:"size"}}];function Al(e){let{tenantName:t,metrics:a}=e;const{blobStorageUsed:r,tabletStorageUsed:i,blobStorageLimit:s,tabletStorageLimit:o}=a,l=[{label:(0,d.jsx)(Ua,{text:Ci("storage.tablet-storage-title"),popoverContent:Ci("storage.tablet-storage-description")}),value:(0,d.jsx)(ms.y,{value:i,capacity:o,formatValues:Ie.QO,colorizeProgress:!0,warningThreshold:75,dangerThreshold:85})},{label:(0,d.jsx)(Ua,{text:Ci("storage.db-storage-title"),popoverContent:Ci("storage.db-storage-description")}),value:(0,d.jsx)(ms.y,{value:r,capacity:s,formatValues:Ie.QO,colorizeProgress:!0,warningThreshold:75,dangerThreshold:85})}];return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(ji,{database:t,charts:Rl}),(0,d.jsx)(Tl._,{className:Cs("storage-info"),title:"Storage details",info:l}),(0,d.jsx)(_l,{path:t}),(0,d.jsx)(wl,{tenant:t})]})}function Ol(e){var t,a,n;let{tenantName:r,additionalTenantProps:i,additionalNodesProps:s}=e;const{metricsTab:o}=(0,ve.ix)((e=>e.tenant)),[l]=(0,ve.Rj)(),{currentData:c,isFetching:u}=Se.$1.useGetTenantInfoQuery({path:r},{pollingInterval:l}),m=u&&void 0===c,{Name:p,Type:h,Overall:v}=c||{},x=$(h),{currentData:g}=ce.useGetOverviewQuery({path:r,database:r},{pollingInterval:l}),{Tables:y,Topics:b}=(null===g||void 0===g||null===(t=g.PathDescription)||void 0===t||null===(a=t.DomainDescription)||void 0===a?void 0:a.DiskSpaceUsage)||{},f=[null===y||void 0===y?void 0:y.TotalSize,null===b||void 0===b?void 0:b.DataSize].reduce(((e,t)=>t?e+Number(t):e),0),E={...c,Metrics:{...null===c||void 0===c?void 0:c.Metrics,Storage:String(f)}},{blobStorage:S,tabletStorage:T,blobStorageLimit:j,tabletStorageLimit:N,poolsStats:C,memoryStats:w,blobStorageStats:P,tabletStorageStats:I}=(0,ai.HH)(E),D={blobStorageUsed:S,blobStorageLimit:j,tabletStorageUsed:T,tabletStorageLimit:N};if(m)return(0,d.jsx)("div",{className:Cs("loader"),children:(0,d.jsx)(Kr.a,{size:"m"})});const _=null===i||void 0===i||null===(n=i.getMonitoringLink)||void 0===n?void 0:n.call(i,p,h);return(0,d.jsxs)("div",{className:Cs(),children:[(0,d.jsxs)("div",{className:Cs("info"),children:[(0,d.jsx)("div",{className:Cs("top-label"),children:x}),(0,d.jsxs)("div",{className:Cs("top"),children:[(0,d.jsx)("div",{className:Cs("tenant-name-wrapper"),children:(0,d.jsx)(Vn.A,{status:v,name:p||he.FU,withLeftTrim:!0,hasClipboardButton:Boolean(c),clipboardButtonAlwaysVisible:!0})}),_&&(0,d.jsx)(ti,{href:_})]}),(0,d.jsx)(ys,{poolsCpuStats:C,memoryStats:w,blobStorageStats:P,tabletStorageStats:I,tenantName:r})]}),(()=>{switch(o){case ge.Xk.cpu:return(0,d.jsx)(yl,{tenantName:r,additionalNodesProps:s});case ge.Xk.storage:return(0,d.jsx)(Al,{tenantName:r,metrics:D});case ge.Xk.memory:return(0,d.jsx)(Sl,{tenantName:r,memoryUsed:E.MemoryUsed,memoryLimit:E.MemoryLimit,memoryStats:E.MemoryStats});case ge.Xk.healthcheck:return(0,d.jsx)(ts,{tenantName:r});default:return(0,d.jsx)(Pi,{database:r})}})()]})}const Ml=(0,c.cn)("kv-detailed-overview");const kl=function(e){const{type:t,tenantName:a,path:n,additionalTenantProps:r,additionalNodesProps:i}=e,s=a===n;return(0,d.jsx)("div",{className:Ml(),children:s?(0,d.jsx)("div",{className:Ml("section"),children:(0,d.jsx)(Ol,{tenantName:a,additionalTenantProps:r,additionalNodesProps:i})}):(0,d.jsx)(Wr,{type:t,path:n,database:a})})},Ll={id:ge.qQ.overview,title:"Info"},zl={id:ge.qQ.schema,title:"Schema"},ql={id:ge.qQ.topQueries,title:"Queries"},Ul={id:ge.qQ.topShards,title:"Top shards"},Fl={id:ge.qQ.nodes,title:"Nodes"},Ql={id:ge.qQ.tablets,title:"Tablets"},Gl={id:ge.qQ.storage,title:"Storage"},Bl={id:ge.qQ.network,title:"Network"},$l={id:ge.qQ.describe,title:"Describe"},Vl={id:ge.qQ.hotKeys,title:"Hot keys"},Hl={id:ge.qQ.graph,title:"Graph"},Zl={id:ge.qQ.consumers,title:"Consumers"},Wl={id:ge.qQ.partitions,title:"Partitions"},Jl=[Ll,Ql,$l],Kl=[Ll,ql,Ul,Fl,Ql,Gl,Bl,$l,{id:ge.qQ.configs,title:"Configs"},{id:ge.qQ.operations,title:"Operations"}],Yl=[Ll,zl,Ul,Fl,Hl,Ql,Vl,$l],Xl=[Ll,zl,Ul,Fl,Ql,$l],ec=[Ll,Ul,Fl,$l],tc=[Ll,Zl,Wl,Fl,Ql,$l],ac=[Ll,Zl,Wl,Fl,Ql,$l],nc=[Ll,$l],rc=[Ll,zl,$l],ic=[Ll,zl,$l],sc={[f.EPathTypeInvalid]:void 0,[f.EPathTypeSubDomain]:Kl,[f.EPathTypeExtSubDomain]:Kl,[f.EPathTypeColumnStore]:Kl,[f.EPathTypeTable]:Yl,[f.EPathTypeColumnTable]:Xl,[f.EPathTypeDir]:ec,[f.EPathTypeTableIndex]:ec,[f.EPathTypeCdcStream]:tc,[f.EPathTypePersQueueGroup]:ac,[f.EPathTypeExternalDataSource]:nc,[f.EPathTypeExternalTable]:rc,[f.EPathTypeView]:ic,[f.EPathTypeReplication]:Jl},oc=e=>e&&sc[e]||ec,lc=e=>{let{hasFeatureFlags:t}=e;return t?Kl:Kl.filter((e=>e.id!==ge.qQ.configs))};var cc=a(2915),dc=a(38610);const uc=le.h.injectEndpoints({endpoints:e=>({getHotKeys:e.query({queryFn:async(e,t)=>{let{path:a,database:n}=e,{signal:r}=t;try{var i;const e=await window.api.getHotKeys({path:a,database:n,enableSampling:!0},{signal:r});if(Array.isArray(e.hotkeys))return{data:e.hotkeys};await Promise.race([new Promise((e=>{setTimeout(e,5e3)})),new Promise(((e,t)=>{r.addEventListener("abort",t)}))]);return{data:null!==(i=(await window.api.getHotKeys({path:a,database:n,enableSampling:!1},{signal:r})).hotkeys)&&void 0!==i?i:null}}catch(s){return{error:s}}},providesTags:["All"]})}),overrideExisting:"throw"}),mc=JSON.parse('{"hot-keys-collecting":"Please wait a little while we are collecting hot keys samples...","no-data":"No information about hot keys","help":"Hot keys contains a list of table primary key values that are accessed most often. Sample is collected upon request to the tab during 5s time interval. Samples column indicates how many requests to the particular key value were registered during collection phase."}'),pc=(0,st.wZ)("ydb-hot-keys",{en:mc});var hc;function vc(){return vc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},vc.apply(this,arguments)}const xc=function(e){return n.createElement("svg",vc({viewBox:"0 0 12 7",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),hc||(hc=n.createElement("path",{d:"M8 7h3V5h1V2H6.66C6.085.79 4.86 0 3.5 0 1.57 0 0 1.57 0 3.5S1.57 7 3.5 7c1.36 0 2.59-.79 3.16-2H8v2zm2-1H9V4H5.97l-.115.335a2.5 2.5 0 110-1.67L5.97 3H11v1h-1v2zM3.5 5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zM3 3.5a.5.5 0 111 0 .5.5 0 01-1 0z"})))},gc=(0,c.cn)("ydb-hot-keys"),yc={accessSample:"accessSample",keyValues:"keyValues"},bc=function(){return[...(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(((e,t)=>({name:e,header:(0,d.jsxs)("div",{className:gc("primary-key-column"),children:[(0,d.jsx)(ft.J,{data:xc,width:12,height:7}),e]}),render:e=>{let{row:a}=e;return a.keyValues[t]},align:$t.ZP.RIGHT,sortable:!1}))),{name:yc.accessSample,header:"Samples",render:e=>{let{row:t}=e;return t.accessSample},align:$t.ZP.RIGHT,sortable:!1}]};function fc(e){var t,a;let{path:r,database:i}=e;const{currentData:s,isFetching:o,error:l}=uc.useGetHotKeysQuery({path:r,database:i}),c=o&&void 0===s,[u]=(0,ve.Rj)(),{currentData:m,isLoading:p}=ce.useGetOverviewQuery({path:r,database:i},{pollingInterval:u}),h=null===m||void 0===m||null===(t=m.PathDescription)||void 0===t||null===(a=t.Table)||void 0===a?void 0:a.KeyColumnNames,v=n.useMemo((()=>bc(h)),[h]);return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Ec,{}),c||p?(0,d.jsx)("div",{children:pc("hot-keys-collecting")}):l?(0,d.jsx)(Ne.V,{error:l}):s?(0,d.jsx)(tt.G,{wrapperClassName:gc("table"),columns:v,data:s,settings:he.LE,initialSortOrder:{columnId:yc.accessSample,order:$t.ZP.DESCENDING}}):(0,d.jsx)("div",{children:pc("no-data")})]})}function Ec(){const[e,t]=(0,ve.yu)(he.RI);return e?null:(0,d.jsxs)(dc.Z,{theme:"info",view:"filled",type:"container",className:gc("help-card"),children:[pc("help"),(0,d.jsx)(Yr.z,{className:gc("help-card__close-button"),view:"flat",onClick:()=>t(!0),children:(0,d.jsx)(ft.J,{data:cc.Z,size:18})})]})}var Sc=a(97379),Tc=a(91538),jc=a(52154);const Nc=le.h.injectEndpoints({endpoints:e=>({getNetworkInfo:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.getNetwork({path:e,database:e},{signal:a})}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var Cc=a(32341);const wc=(0,c.cn)("node-network");function Pc(){}function Ic(e){let{nodeId:t,connected:a,capacity:r,rack:i,status:s,onClick:o=Pc,onMouseEnter:l=Pc,onMouseLeave:c=Pc,showID:u,isBlurred:m}=e;const p=n.useRef(null),h=s||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=Math.floor(e/t*100);return 100===a?$i.K.Green:a>=70?$i.K.Yellow:a>=1?$i.K.Red:$i.K.Grey}(a,r);return(0,d.jsx)("div",{ref:p,className:wc({[h.toLowerCase()]:!0,id:u,blur:m}),onMouseEnter:()=>{l(p.current,{nodeId:t,connected:a,capacity:r,rack:i},"node")},onMouseLeave:()=>{c()},onClick:()=>o(t),children:u?t:null})}const Dc=e=>null===e||void 0===e?void 0:e.reduce(((e,t)=>t.Connected?e+1:e),0);var _c,Rc,Ac,Oc,Mc,kc,Lc,zc,qc,Uc,Fc,Qc,Gc,Bc,$c;function Vc(){return Vc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Vc.apply(this,arguments)}const Hc=function(e){return n.createElement("svg",Vc({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 221 204"},e),_c||(_c=n.createElement("path",{d:"M68.46 2.529v25.227c0 1.227.876 2.278 2.102 2.511 16.643 2.979 29.14 17.812 28.498 35.448-.642 18.045-15.359 32.703-33.345 33.403-17.636.643-32.41-11.854-35.448-28.44a2.562 2.562 0 00-2.51-2.102H2.528c-1.519 0-2.687 1.285-2.512 2.745 3.446 32.703 31.243 58.106 64.939 57.814 35.155-.292 63.829-29.024 64.121-64.18.292-33.695-25.17-61.492-57.873-64.938-1.46-.175-2.744.993-2.744 2.512z",fill:"#EBF2FA"})),Rc||(Rc=n.createElement("path",{d:"M22.736 18.354l17.811 17.812c.876.876 2.278.992 3.329.233 4.146-3.095 9.052-5.197 14.366-6.19 1.226-.233 2.102-1.226 2.102-2.511V2.528a2.502 2.502 0 00-2.803-2.51C44.46 1.418 32.488 6.674 22.91 14.674c-1.168.935-1.226 2.628-.175 3.68zm-9.403 6.133C6.093 33.83 1.303 45.16.02 57.54c-.176 1.46 1.05 2.745 2.51 2.745H27.7a2.562 2.562 0 002.511-2.103c.818-4.672 2.628-9.051 5.14-12.847a2.642 2.642 0 00-.293-3.212L17.13 24.312c-1.05-1.11-2.861-.993-3.796.175zm67.275 107.392h32.995c1.868 0 3.387 1.518 3.445 3.445v65.231a3.451 3.451 0 01-3.445 3.445H80.608a3.452 3.452 0 01-3.446-3.445v-65.231a3.451 3.451 0 013.446-3.445zm77.844 27.097h-32.878a3.514 3.514 0 00-3.503 3.504v37.959a3.514 3.514 0 003.503 3.504h32.878a3.515 3.515 0 003.504-3.504V162.48a3.515 3.515 0 00-3.504-3.504zm12.205 18.28h32.586a3.639 3.639 0 013.621 3.62v19.388a3.639 3.639 0 01-3.621 3.621h-32.586a3.639 3.639 0 01-3.62-3.621v-19.388a3.638 3.638 0 013.62-3.62z",fill:"#EBF2FA"})),Ac||(Ac=n.createElement("path",{d:"M134.275 171.532h-113c-5.84 0-10.628-4.789-10.628-10.629v-73.23c0-5.84 4.788-10.629 10.628-10.629h112.941c5.84 0 10.629 4.789 10.629 10.629v73.23c.058 5.899-4.731 10.629-10.57 10.629v0z",stroke:"#2EE5C0",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})),Oc||(Oc=n.createElement("path",{d:"M21.625 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074zM31.494 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074zM41.363 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074z",fill:"#2EE5C0"})),Mc||(Mc=n.createElement("path",{d:"M10.822 98.592h133.673",stroke:"#2EE5C0",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})),kc||(kc=n.createElement("path",{d:"M184.555 149.164L57.89 156.172c-4.263.234-7.767-3.037-7.767-7.3V51.114c0-4.263 3.504-7.533 7.767-7.3l126.665 7.008c3.27.176 5.898 3.33 5.898 7.008v84.327c0 3.679-2.628 6.832-5.898 7.007z",fill:"#027BF3"})),Lc||(Lc=n.createElement("path",{d:"M65.13 54.151c0 1.986-1.576 3.504-3.562 3.387-1.985-.058-3.562-1.752-3.562-3.737 0-1.986 1.635-3.504 3.562-3.387 1.927.058 3.562 1.752 3.562 3.737zm11.506.466a3.38 3.38 0 01-3.504 3.388c-1.927-.059-3.504-1.753-3.504-3.68a3.38 3.38 0 013.504-3.387c1.927.117 3.504 1.752 3.504 3.68zm7.825 3.855c1.869.117 3.387-1.402 3.387-3.329 0-1.927-1.518-3.562-3.387-3.62-1.927-.117-3.445 1.401-3.445 3.328 0 1.927 1.576 3.562 3.445 3.62z",fill:"#fff"})),zc||(zc=n.createElement("path",{d:"M75.467 142.974V85.277c-3.971-.525-8.584-.409-13.899.7v57.64l13.899-.643zM88.84 90.651v51.799l-11.096.467v-57.23c4.322.934 7.942 2.745 11.096 4.964zm13.431 13.899a1.618 1.618 0 01-.146-.176 1.487 1.487 0 00-.146-.175c-.42-.51-.841-1.026-1.265-1.546-2.875-3.522-5.874-7.197-9.538-10.25v49.93l11.095-.467V104.55zm13.432 5.722c-3.913-.058-7.709-.701-11.096-3.445v34.922l11.096-.468v-31.009zm13.431-.409c-2.764-.173-5.529.006-8.246.181-.957.062-1.907.123-2.849.169v30.951l11.095-.467v-30.834zm24.002 29.841l-8.234.35v-22.191c8.176 9.285 8.234 21.841 8.234 21.841zM140.113 113.6a19.774 19.774 0 012.453 1.927v24.644l-11.096.467v-30.483c2.92.467 5.782 1.46 8.643 3.445z",fill:"#00236B"})),qc||(qc=n.createElement("path",{d:"M55.745 76.436a2 2 0 103.123 2.499l-3.123-2.499zm5.766-4.006l1.575-1.233a2 2 0 00-3.136-.017l1.561 1.25zm2.63 6.605a2 2 0 103.15-2.465l-3.15 2.465zm107.94 53.502a2 2 0 00-2.499 3.123l2.499-3.123zm4.006 5.766l1.214 1.59a1.999 1.999 0 00.036-3.151l-1.25 1.561zm-6.644 2.557a1.999 1.999 0 102.427 3.179l-2.427-3.179zM58.868 78.935l4.205-5.256-3.123-2.499-4.205 5.256 3.123 2.499zm1.068-5.273l4.205 5.373 3.15-2.465-4.205-5.373-3.15 2.465zm109.646 61.998l5.256 4.205 2.499-3.123-5.256-4.205-2.499 3.123zm5.292 1.054l-5.431 4.146 2.427 3.179 5.431-4.146-2.427-3.179zM147.137 69.146a2 2 0 10-.149 3.998l.149-3.998zm29.634 5.107a2 2 0 10.149-3.997l-.149 3.997zm-29.657 5.404a2 2 0 00-.102 3.999l.102-3.999zm29.681 4.758a2 2 0 00.102-3.999l-.102 4zm-29.72 5.928a2 2 0 10-.023 4l.023-4zm29.759 4.176a2 2 0 10.024-4l-.024 4zm-29.846-21.375l29.783 1.11.149-3.998-29.783-1.11-.149 3.998zm.024 10.512l29.783.76.102-4-29.783-.759-.102 3.999zm.04 10.687l29.782.176.024-4-29.783-.175-.023 4zM143.442 71.202a2.458 2.458 0 01-2.57 2.453c-1.401-.058-2.569-1.285-2.569-2.686 0-1.402 1.168-2.57 2.569-2.453 1.46.058 2.57 1.285 2.57 2.686zm.001 10.396a2.458 2.458 0 01-2.57 2.453c-1.401-.059-2.569-1.285-2.569-2.686 0-1.46 1.168-2.57 2.569-2.453 1.46.058 2.57 1.284 2.57 2.686zm-2.57 12.848a2.458 2.458 0 002.57-2.453c0-1.402-1.11-2.628-2.57-2.686-1.401-.117-2.569 1.05-2.569 2.452s1.168 2.628 2.569 2.687z",fill:"#fff"})),Uc||(Uc=n.createElement("path",{opacity:.2,d:"M190.452 91.875V57.771c0-3.68-2.628-6.833-5.899-7.008l-23.651-1.285a35.18 35.18 0 00-1.752 10.98c0 17.635 12.79 31.826 28.09 31.65 1.051.06 2.16-.058 3.212-.233z",fill:"#00236B"})),Fc||(Fc=n.createElement("path",{d:"M220.645 58.883c0-16.585-11.621-30.775-26.454-31.651-15.3-.876-28.089 12.672-28.089 30.308s12.789 31.827 28.089 31.652c14.833-.117 26.454-13.724 26.454-30.309z",fill:"#FF4645"})),Qc||(Qc=n.createElement("path",{d:"M215.329 40.372c-4.788-7.475-12.38-12.614-21.14-13.14v31.01l21.14-17.87z",fill:"#FC0"})),Gc||(Gc=n.createElement("path",{d:"M215.329 40.372l-21.14 17.87 26.455.642c0-6.89-1.986-13.315-5.315-18.512z",fill:"#00236B"})),Bc||(Bc=n.createElement("path",{d:"M194.248 58.24V27.233c-15.301-.876-28.09 12.672-28.09 30.308l28.09.7z",fill:"#FF4645"})),$c||($c=n.createElement("path",{d:"M161.151 14.734a2 2 0 10-4 0h4zm-4 4.204a2 2 0 004 0h-4zm4 8.876a2 2 0 10-4 0h4zm-4 4.555a2 2 0 004 0h-4zm10.819-6.816a2 2 0 000-4v4zm-4.263-4a2 2 0 100 4v-4zm-9.169 4a2 2 0 100-4v4zm-4.263-4a2 2 0 000 4v-4zm6.876-6.82v4.205h4v-4.204h-4zm0 13.08v4.556h4v-4.555h-4zm10.819-6.26h-4.263v4h4.263v-4zm-13.432 0h-4.263v4h4.263v-4z",fill:"#2EE5C0"})))},Zc=(0,c.cn)("network");function Wc(e){var t,a;let{tenantName:r}=e;const[i]=(0,ve.Rj)(),s=(0,ve.ix)(Cc.qz),o=(0,ve.zL)(),[l,c]=n.useState(),[u,m]=n.useState(!1),[p,h]=n.useState(!1),{currentData:v,isFetching:x,error:g}=Nc.useGetNetworkInfoQuery(r,{pollingInterval:i});if(x&&void 0===v)return(0,d.jsx)("div",{className:"loader",children:(0,d.jsx)(Kr.a,{size:"l"})});const y=v,b=null!==(t=(null===y||void 0===y?void 0:y.Tenants)&&y.Tenants[0].Nodes)&&void 0!==t?t:[];if(!g&&0===b.length)return(0,d.jsx)("div",{className:"error",children:"no nodes data"});const f=Kc(b,"NodeType"),E=l?Kc(null!==(a=l.Peers)&&void 0!==a?a:[],"NodeType"):{};return(0,d.jsxs)("div",{className:Zc(),children:[g?(0,d.jsx)(Ne.V,{error:g}):null,b.length>0?(0,d.jsx)("div",{className:Zc("inner"),children:(0,d.jsxs)("div",{className:Zc("nodes-row"),children:[(0,d.jsxs)("div",{className:Zc("left"),children:[(0,d.jsx)("div",{className:Zc("controls-wrapper"),children:(0,d.jsxs)("div",{className:Zc("controls"),children:[(0,d.jsx)(jc.T,{value:s,onChange:e=>{o((0,Cc.M6)(e))},className:Zc("problem-filter")}),(0,d.jsx)("div",{className:Zc("checkbox-wrapper"),children:(0,d.jsx)(je.X,{onUpdate:()=>{m(!u)},checked:u,children:"ID"})}),(0,d.jsx)("div",{className:Zc("checkbox-wrapper"),children:(0,d.jsx)(je.X,{onUpdate:()=>{h(!p)},checked:p,children:"Racks"})})]})}),(0,d.jsx)(Jc,{nodes:f,showId:u,showRacks:p,clickedNode:l,onClickNode:c})]}),(0,d.jsx)("div",{className:Zc("right"),children:l?(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:Zc("label"),children:["Connectivity of node"," ",(0,d.jsx)(be.rU,{className:Zc("link"),to:(0,el.a3)(l.NodeId),children:l.NodeId})," ","to other nodes"]}),(0,d.jsx)("div",{className:Zc("nodes-row"),children:(0,d.jsx)(Jc,{nodes:E,isRight:!0,showId:u,showRacks:p,clickedNode:l,onClickNode:c})})]}):(0,d.jsxs)("div",{className:Zc("placeholder"),children:[(0,d.jsx)("div",{className:Zc("placeholder-img"),children:(0,d.jsx)(ft.J,{data:Hc,width:221,height:204})}),(0,d.jsx)("div",{className:Zc("placeholder-text"),children:"Select node to see its connectivity to other nodes"})]})})]})}):null]})}function Jc(e){let{nodes:t,isRight:a,showId:n,showRacks:r,clickedNode:i,onClickNode:s}=e;const o=(0,ve.ix)(Cc.qz),l=(0,ve.zL)();let c=0;const u=Object.keys(t).map(((e,u)=>{const m=Kc(t[e],"Rack");return(0,d.jsxs)("div",{className:Zc("nodes-container",{right:a}),children:[(0,d.jsxs)("div",{className:Zc("nodes-title"),children:[e," nodes"]}),(0,d.jsx)("div",{className:Zc("nodes"),children:r?Object.keys(m).map(((e,t)=>(0,d.jsxs)("div",{className:Zc("rack-column"),children:[(0,d.jsx)("div",{className:Zc("rack-index"),children:"undefined"===e?"?":e}),m[e].map(((e,t)=>{let r,u;return!a&&"Peers"in e&&e.Peers&&(r=Object.keys(e.Peers).length,u=Dc(e.Peers)),o===Cc.pu.PROBLEMS&&r!==u||o===Cc.pu.ALL||a?(c++,(0,d.jsx)(Ic,{nodeId:e.NodeId,showID:n,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:r,connected:u,onMouseEnter:function(){l((0,Pe.hJ)(...arguments))},onMouseLeave:()=>{l((0,Pe.i8)())},onClick:a?void 0:()=>{s(i&&e.NodeId===i.NodeId?void 0:e)},isBlurred:!a&&i&&i.NodeId!==e.NodeId},t)):null}))]},t))):t[e].map(((e,t)=>{let r,u;const m=e&&"Peers"in e?e.Peers:void 0;return!a&&"Peers"in e&&e.Peers&&(r=e.Peers.length,u=Dc(m)),o===Cc.pu.PROBLEMS&&r!==u||o===Cc.pu.ALL||a?(c++,(0,d.jsx)(Ic,{nodeId:e.NodeId,showID:n,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:null===m||void 0===m?void 0:m.length,connected:u,onMouseEnter:function(){l((0,Pe.hJ)(...arguments))},onMouseLeave:()=>{l((0,Pe.i8)())},onClick:a?void 0:()=>{s(i&&e.NodeId===i.NodeId?void 0:e)},isBlurred:!a&&i&&i.NodeId!==e.NodeId},t)):null}))})]},u)}));return o===Cc.pu.PROBLEMS&&0===c?(0,d.jsx)(Tc.Q,{name:"thumbsUp",width:"200"}):u}function Kc(e,t){return e.reduce(((e,a)=>(e[a[t]]?e[a[t]].push(a):e[a[t]]=[a],e)),{})}const Yc="networkNodesTableSelectedColumns",Xc=["NodeId","Host","Connections","NetworkUtilization","SendThroughput","ReceiveThroughput","PingTime","ClockSkew"],ed=["NodeId"],td=["Host","DC","Rack","Uptime","ConnectStatus","NetworkUtilization","PingTime","ClockSkew"];function ad(e){let{database:t,path:a,parentRef:n,additionalNodesProps:r}=e;const i=(0,Ee.rU)(),s=(0,Ee.vX)(),[l]=(0,ve.yu)(he._X),c=s&&l;return(0,d.jsx)(o.s,{loading:!i,children:(()=>{return c?(0,d.jsx)(Sc.m,{path:a,database:t,parentRef:n,additionalNodesProps:r,columns:(e={database:t,getNodeRef:null===r||void 0===r?void 0:r.getNodeRef},[(0,Ss.A6)(),(0,Ss.Up)(e,{statusForIcon:"ConnectStatus"}),(0,Ss.EF)(),(0,Ss.KO)(),(0,Ss.VQ)(),(0,Ss.eb)(),(0,Ss.o9)(),(0,Ss.O8)(),(0,Ss.qQ)(),(0,Ss.ek)(),(0,Ss.oY)(),(0,Ss._5)(),(0,Ss.O5)()].map((e=>({...e,sortable:(0,Ts.Ke)(e.name)})))),defaultColumnsIds:Xc,requiredColumnsIds:ed,selectedColumnsKey:Yc,groupByParams:td}):(0,d.jsx)(Wc,{tenantName:t});var e})()})}var nd=a(4969),rd=a(72736),id=a(53366),sd=a(76485);const od=JSON.parse('{"lagsPopover.writeLags":"Write lags statistics (time format dd hh:mm:ss)","lagsPopover.readLags":"Read lags statistics (time format dd hh:mm:ss)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"Consumer:","controls.consumerSelector.emptyOption":"No consumer","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"No partitions match the current search","noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers"}'),ld=JSON.parse('{"lagsPopover.writeLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0437\u0430\u043f\u0438\u0441\u0438 (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","lagsPopover.readLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0447\u0442\u0435\u043d\u0438\u044f (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"\u0427\u0438\u0442\u0430\u0442\u0435\u043b\u044c:","controls.consumerSelector.emptyOption":"\u041d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"\u041f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0438\u0441\u043a\u0443 \u043d\u0435\u0442 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439","noConsumersMessage.topic":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0442\u043e\u043f\u0438\u043a\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","noConsumersMessage.stream":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0440\u0438\u043c\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439"}'),cd=(0,st.wZ)("ydb-diagnostics-partitions",{ru:ld,en:od}),dd={PARTITION_ID:"partitionId",STORE_SIZE:"storeSize",WRITE_SPEED:"writeSpeed",READ_SPEED:"readSpeed",WRITE_LAGS:"writeLags",READ_LAGS:"readLags",UNCOMMITED_MESSAGES:"uncommitedMessages",UNREAD_MESSAGES:"unreadMessages",START_OFFSET:"startOffset",END_OFFSET:"endOffset",COMMITED_OFFSET:"commitedOffset",READ_SESSION_ID:"readSessionId",READER_NAME:"readerName",PARTITION_HOST:"partitionHost",CONNECTION_HOST:"connectionHost"},ud={[dd.PARTITION_ID]:"Partition ID",[dd.STORE_SIZE]:"Store size",[dd.WRITE_SPEED]:"Write speed",[dd.READ_SPEED]:"Read speed",[dd.WRITE_LAGS]:"Write lags, duration",[dd.READ_LAGS]:"Read lags, duration",[dd.UNCOMMITED_MESSAGES]:"Uncommited messages",[dd.UNREAD_MESSAGES]:"Unread messages",[dd.START_OFFSET]:"Start offset",[dd.END_OFFSET]:"End offset",[dd.COMMITED_OFFSET]:"Commited offset",[dd.READ_SESSION_ID]:"Read session ID",[dd.READER_NAME]:"Reader name",[dd.PARTITION_HOST]:"Partition host",[dd.CONNECTION_HOST]:"Connection host"},md="partitionWriteLag",pd="partitionWriteIdleTime",hd={[md]:"write lag",[pd]:"write idle time"},vd="consumerWriteLag",xd="consumerReadLag",gd="consumerReadIdleTime",yd={[vd]:"write lag",[xd]:"read lag",[gd]:"read idle time"},bd=[dd.PARTITION_ID,dd.STORE_SIZE,dd.WRITE_SPEED,dd.WRITE_LAGS,dd.START_OFFSET,dd.END_OFFSET,dd.PARTITION_HOST],fd=Object.values(dd),Ed=e=>{let{consumers:t,selectedConsumer:a,onSelectedConsumerChange:r,selectDisabled:i,partitions:s,onSearchChange:o,hiddenColumns:l,onHiddenColumnsChange:c,initialColumnsIds:u}=e;const[m,p]=n.useState(""),[h,v]=n.useState("");n.useEffect((()=>{if(!s)return;const e=new RegExp(fa()(h),"i"),t=new RegExp(fa()(m),"i"),a=s.filter((a=>{const{partitionId:n,readerName:r,readSessionId:i,partitionNodeId:s,connectionNodeId:o,partitionHost:l,connectionHost:c}=a,d=e.test(n),u=[r,i,s,o,l,c].filter(Boolean).map(String),m=0===u.length||u.some((e=>t.test(e)));return d&&m}));o(a)}),[h,m,s,o]);const x=n.useMemo((()=>{const e=t&&t.length?t.map((e=>({value:e,content:e}))):[];return[{value:"",content:cd("controls.consumerSelector.emptyOption")},...e]}),[t]),g=n.useMemo((()=>{const e=[];for(const t of u){const a=t===dd.PARTITION_ID,n={title:ud[t],selected:Boolean(!l.includes(t)),id:t,required:a,sticky:a?"start":void 0};a?e.unshift(n):e.push(n)}return e}),[u,l]),y=e=>(0,d.jsx)("div",{className:Rd("select-option",{empty:""===e.value}),children:e.content});return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Te.P,{className:Rd("consumer-select"),label:cd("controls.consumerSelector"),options:x,value:[a||""],onUpdate:e=>{r(e[0]||void 0)},filterable:t&&t.length>5,disabled:i||!t||!t.length,renderOption:y,renderSelectedOption:y}),(0,d.jsx)(sd.o,{onChange:e=>{v(e)},placeholder:cd("controls.partitionSearch"),className:Rd("search",{partition:!0}),value:h}),(0,d.jsx)(sd.o,{onChange:e=>{p(e)},placeholder:cd("controls.generalSearch"),className:Rd("search",{general:!0}),value:m}),(0,d.jsx)(id.N,{popupWidth:242,items:g,showStatus:!0,onUpdate:e=>{const t=[...l];e.forEach((e=>{e.selected||l.includes(e.id)?e.selected&&l.includes(e.id)&&t.splice(l.indexOf(e.id)):t.push(e.id)})),c(t)},sortable:!1},"TableColumnSetup")]})},Sd=(0,c.cn)("ydb-diagnostics-partitions-columns-header"),Td=e=>{let{title:t}=e;return(0,d.jsx)("div",{className:Sd("multiline"),children:t})},jd=()=>(0,d.jsx)("div",{className:Sd("read-session"),children:ud[dd.READ_SESSION_ID]}),Nd=()=>(0,d.jsx)(Ua,{className:Sd("lags"),text:ud[dd.WRITE_LAGS],popoverContent:(0,d.jsx)(en,{text:cd("lagsPopover.writeLags"),type:"write"})}),Cd=()=>(0,d.jsx)(Ua,{className:Sd("lags"),text:ud[dd.READ_LAGS],popoverContent:(0,d.jsx)(en,{text:cd("lagsPopover.readLags"),type:"read"})}),wd=()=>(0,d.jsx)(Ua,{className:Sd("messages"),text:ud[dd.UNREAD_MESSAGES],popoverContent:(0,d.jsx)("div",{className:Sd("messages-popover-content"),children:cd("headers.unread")})}),Pd=()=>(0,d.jsx)(Ua,{className:Sd("messages"),text:ud[dd.UNCOMMITED_MESSAGES],popoverContent:(0,d.jsx)("div",{className:Sd("messages-popover-content"),children:cd("headers.uncommited")})}),Id=(0,c.cn)("ydb-diagnostics-partitions-columns"),Dd=[{name:dd.PARTITION_ID,header:(0,d.jsx)(Td,{title:ud[dd.PARTITION_ID]}),sortAccessor:e=>(0,Qr.kE)(e.partitionId)&&Number(e.partitionId),align:$t.ZP.LEFT,render:e=>{let{row:t}=e;return t.partitionId}},{name:dd.STORE_SIZE,header:(0,d.jsx)(Td,{title:ud[dd.STORE_SIZE]}),align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,Ie.td)(t.storeSize)}},{name:dd.WRITE_SPEED,header:ud[dd.WRITE_SPEED],align:$t.ZP.LEFT,resizeMinWidth:140,sortAccessor:e=>e.writeSpeed.perMinute,render:e=>{let{row:t}=e;return(0,d.jsx)(Aa,{data:t.writeSpeed})}},{name:dd.READ_SPEED,header:ud[dd.READ_SPEED],align:$t.ZP.LEFT,resizeMinWidth:140,sortAccessor:e=>{var t;return null===(t=e.readSpeed)||void 0===t?void 0:t.perMinute},render:e=>{let{row:t}=e;return(0,d.jsx)(Aa,{data:t.readSpeed})}},{name:dd.WRITE_LAGS,header:(0,d.jsx)(Nd,{}),className:Id("lags-header"),sub:[{name:md,header:hd[md],align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,Ie.gC)(t.partitionWriteLag)}},{name:pd,header:hd[pd],align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,Ie.gC)(t.partitionWriteIdleTime)}}]},{name:dd.READ_LAGS,header:(0,d.jsx)(Cd,{}),className:Id("lags-header"),sub:[{name:vd,header:yd[vd],align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,Ie.gC)(t.consumerWriteLag)}},{name:xd,header:yd[xd],align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,Ie.gC)(t.consumerReadLag)}},{name:gd,header:yd[gd],align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return(0,Ie.gC)(t.consumerReadIdleTime)}}]},{name:dd.UNCOMMITED_MESSAGES,header:(0,d.jsx)(Pd,{}),align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return t.uncommitedMessages}},{name:dd.UNREAD_MESSAGES,header:(0,d.jsx)(wd,{}),align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return t.unreadMessages}},{name:dd.START_OFFSET,header:(0,d.jsx)(Td,{title:ud[dd.START_OFFSET]}),sortAccessor:e=>(0,Qr.kE)(e.startOffset)&&Number(e.startOffset),align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return t.startOffset}},{name:dd.END_OFFSET,header:(0,d.jsx)(Td,{title:ud[dd.END_OFFSET]}),sortAccessor:e=>(0,Qr.kE)(e.endOffset)&&Number(e.endOffset),align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return t.endOffset}},{name:dd.COMMITED_OFFSET,header:(0,d.jsx)(Td,{title:ud[dd.COMMITED_OFFSET]}),sortAccessor:e=>(0,Qr.kE)(e.commitedOffset)&&Number(e.commitedOffset),align:$t.ZP.RIGHT,render:e=>{let{row:t}=e;return t.commitedOffset}},{name:dd.READ_SESSION_ID,header:(0,d.jsx)(jd,{}),align:$t.ZP.LEFT,width:150,render:e=>{let{row:t}=e;return t.readSessionId?(0,d.jsx)(Vn.A,{name:t.readSessionId,showStatus:!1,hasClipboardButton:!0}):"\u2013"}},{name:dd.READER_NAME,header:(0,d.jsx)(Td,{title:ud[dd.READER_NAME]}),align:$t.ZP.LEFT,width:150,render:e=>{let{row:t}=e;return t.readerName?(0,d.jsx)(Vn.A,{name:t.readerName,showStatus:!1,hasClipboardButton:!0}):"\u2013"}},{name:dd.PARTITION_HOST,header:(0,d.jsx)(Td,{title:ud[dd.PARTITION_HOST]}),align:$t.ZP.LEFT,width:200,render:e=>{let{row:t}=e;return t.partitionNodeId&&t.partitionHost?(0,d.jsx)(Vn.A,{name:t.partitionHost,path:(0,el.a3)(t.partitionNodeId),showStatus:!1,hasClipboardButton:!0}):"\u2013"}},{name:dd.CONNECTION_HOST,header:(0,d.jsx)(Td,{title:ud[dd.CONNECTION_HOST]}),align:$t.ZP.LEFT,width:200,render:e=>{let{row:t}=e;return t.connectionNodeId&&t.connectionHost?(0,d.jsx)(Vn.A,{name:t.connectionHost,path:(0,el.a3)(t.connectionNodeId),showStatus:!1,hasClipboardButton:!0}):"\u2013"}}],_d=Dd.filter((e=>bd.includes(e.name))),Rd=(0,c.cn)("ydb-diagnostics-partitions"),Ad=e=>{let{path:t,database:a}=e;const r=(0,ve.zL)(),[i,s]=n.useState([]),o=(0,ve.ix)((e=>Ca(e,t,a))),[l]=(0,ve.Rj)(),{selectedConsumer:c}=(0,ve.ix)((e=>e.partitions)),{currentData:u,isFetching:m,error:p}=Sa.useGetTopicQuery({path:t,database:a}),h=m&&void 0===u,{currentData:v,isFetching:x,error:g}=nd.W.useGetNodesListQuery(void 0),y=x&&void 0===v,f=(0,ve.ix)(nd.s),[E,S]=(0,ve.yu)(he.ZY),[T,j]=(e=>{const[t,a]=n.useState([]),[r,i]=n.useState([]);return n.useEffect((()=>{e?(a(Dd),i(fd)):(a(_d),i(bd))}),[e]),[t,r]})(c),N=h?b.CN:{path:t,database:a,consumerName:c},{currentData:C,isFetching:w,error:P}=rd.TB.useGetPartitionsQuery(N,{pollingInterval:l}),I=w&&void 0===C,D=C,_=n.useMemo((()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return null===e||void 0===e?void 0:e.map((e=>{const a=e.partitionNodeId&&t?t.get(e.partitionNodeId):void 0,n=e.connectionNodeId&&t?t.get(e.connectionNodeId):void 0;return{...e,partitionHost:a,connectionHost:n}}))}(D,f)),[D,f]);n.useEffect((()=>{const e=!h&&!o,t=c&&o&&!o.includes(c);(e||t)&&r((0,rd.M$)(void 0))}),[r,h,c,o]);const R=n.useMemo((()=>T.filter((e=>!E.includes(e.name)))),[T,E]),A=e=>{S(e)},O=e=>{r((0,rd.M$)(e))},M=h||y||I,k=g||p||P;return(0,d.jsxs)("div",{className:Rd(),children:[(0,d.jsx)("div",{className:Rd("controls"),children:(0,d.jsx)(Ed,{consumers:o,selectedConsumer:c,onSelectedConsumerChange:O,selectDisabled:Boolean(k)||M,partitions:_,onSearchChange:s,hiddenColumns:E,onHiddenColumnsChange:A,initialColumnsIds:j})}),k?(0,d.jsx)(Ne.V,{error:k}):null,(0,d.jsx)("div",{className:Rd("table-wrapper"),children:(0,d.jsx)("div",{className:Rd("table-content"),children:C?M?(0,d.jsx)(Mt.h,{className:Rd("loader")}):(0,d.jsx)(tt.G,{columnsWidthLSKey:"partitionsColumnsWidth",wrapperClassName:Rd("table"),data:i,columns:R,settings:he.LE,emptyDataMessage:cd("table.emptyDataMessage")}):null})})]})};var Od=a(67661),Md=a(54431);const kd=JSON.parse('{"date-format":"MM/DD/YYYY","date-time-format":"MM/DD/YYYY HH:mm"}'),Ld=JSON.parse('{"date-format":"DD.MM.YYYY","date-time-format":"DD.MM.YYYY HH:mm"}'),zd=(0,st.wZ)("ydb-date-range",{ru:Ld,en:kd});function qd(e){var t,a,n,r;return"relative"===(null===e||void 0===e||null===(t=e.start)||void 0===t?void 0:t.type)&&"relative"===(null===e||void 0===e||null===(a=e.end)||void 0===a?void 0:a.type)?"s":"relative"===(null===e||void 0===e||null===(n=e.start)||void 0===n?void 0:n.type)||"relative"===(null===e||void 0===e||null===(r=e.end)||void 0===r?void 0:r.type)?"m":"l"}const Ud=(0,c.cn)("date-range"),Fd={start:{value:"now-1h",type:"relative"},end:{value:"now",type:"relative"}},Qd=e=>{let{from:t,to:a,className:r,onChange:i}=e;const s=n.useCallback((e=>null===i||void 0===i?void 0:i(function(e){var t,a,n,r,i,s;return{from:"relative"===(null===e||void 0===e||null===(t=e.start)||void 0===t?void 0:t.type)?e.start.value.toString():String(null===(a=(0,ht.J)(null===e||void 0===e||null===(n=e.start)||void 0===n?void 0:n.value))||void 0===a?void 0:a.valueOf()),to:"relative"===(null===e||void 0===e||null===(r=e.end)||void 0===r?void 0:r.type)?e.end.value.toString():String(null===(i=(0,ht.J)(null===e||void 0===e||null===(s=e.end)||void 0===s?void 0:s.value))||void 0===i?void 0:i.valueOf())}}(e))),[i]),o=n.useMemo((()=>{if(t||a)return function(e){var t,a;const n=(0,ht.KN)(null!==(t=e.from)&&void 0!==t?t:""),r=(0,ht.KN)(null!==(a=e.to)&&void 0!==a?a:"");return{start:e.from?{type:n?"relative":"absolute",value:n?e.from:(0,ht.J)(Number(e.from))}:null,end:e.to?{type:r?"relative":"absolute",value:r?e.to:(0,ht.J)(Number(e.to))}:null}}({from:t,to:a})}),[t,a]),l=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,d.jsx)("div",{className:Ud(null,r),children:(0,d.jsx)(Md.H,{withPresets:!0,className:Ud("range-input",{[qd(o)]:!0}),timeZone:l,value:o||Fd,allowNullableValues:!0,size:"m",format:zd("date-time-format"),onUpdate:s,placeholder:`${zd("date-time-format")} - ${zd("date-time-format")}`,withApplyButton:!0})})},Gd=e=>{var t;let{database:a,onRowClick:r,rowClassName:i}=e;const[s]=(0,ve.Rj)(),o=(0,ve.ix)((e=>e.executeTopQueries)),{currentData:l,isLoading:c,error:u}=Rs.MU.useGetRunningQueriesQuery({database:a,filters:o},{pollingInterval:s}),m=(null===l||void 0===l||null===(t=l.resultSets)||void 0===t?void 0:t[0].result)||[];return(0,d.jsxs)(n.Fragment,{children:[u?(0,d.jsx)(Ne.V,{error:(0,kt.fV)(u)}):null,(0,d.jsx)(at.l.Table,{loading:c,children:(0,d.jsx)(tt.G,{emptyDataMessage:Do("no-data"),columnsWidthLSKey:"runningQueriesColumnsWidth",columns:$o,data:m,settings:Po,onRowClick:e=>r(e.QueryText),rowClassName:()=>i})})]})},Bd=e=>{var t,a;let{database:r,onRowClick:i,rowClassName:s}=e;const[o]=(0,ve.Rj)(),l=(0,ve.ix)((e=>e.executeTopQueries)),{currentData:c,isLoading:u,error:m}=Rs.MU.useGetTopQueriesQuery({database:r,filters:l},{pollingInterval:o}),p=(null===c||void 0===c||null===(t=c.resultSets)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.result)||[],h=Go.map((e=>{return{...e,sortable:(t=e.name,Object.values(To).includes(t))};var t}));return(0,d.jsxs)(n.Fragment,{children:[m?(0,d.jsx)(Ne.V,{error:(0,kt.fV)(m)}):null,(0,d.jsx)(at.l.Table,{loading:u,children:(0,d.jsx)(tt.G,{emptyDataMessage:Do("no-data"),columnsWidthLSKey:Ro,columns:h,data:p||[],settings:Po,onRowClick:e=>i(e.QueryText),rowClassName:()=>s})})]})},$d=(0,c.cn)("kv-top-queries"),Vd={top:"top",running:"running"},Hd=[{value:Vd.top,get content(){return Do("mode_top")}},{value:Vd.running,get content(){return Do("mode_running")}}],Zd=Dt.z.nativeEnum(Vd).catch(Vd.top),Wd=e=>{let{tenantName:t}=e;const a=(0,ve.zL)(),r=(0,er.TH)(),s=(0,er.k6)(),[o=Vd.top,l]=(0,i.useQueryParam)("queryMode",i.StringParam),c=Zd.parse(o),u=c===Vd.top,m=(0,ve.ix)((e=>e.executeTopQueries)),p=io(n.useCallback((e=>{a((0,As.B8)({input:e}));const t=(0,Re.mB)(r),n=(0,da.Sj)({...t,[ge.bS]:ge.m2.query,[da.XV.queryTab]:ge._0.newQuery});s.push(n)}),[a,s,r])),h=u?Bd:Gd;return(0,d.jsxs)(at.l,{children:[(0,d.jsxs)(at.l.Controls,{children:[(0,d.jsx)(Od.E,{options:Hd,value:c,onUpdate:l}),(0,d.jsx)(it.o,{value:m.text,onChange:e=>{a((0,Rs.Im)({text:e}))},placeholder:Do("filter.text.placeholder"),className:$d("search")}),u?(0,d.jsx)(Qd,{from:m.from,to:m.to,onChange:e=>{a((0,Rs.Im)(e))}}):null]}),(0,d.jsx)(h,{database:t,onRowClick:p,rowClassName:$d("row")})]})};var Jd=a(43647),Kd=a(70337);const Yd=JSON.parse('{"no-data":"No data","filters.mode.immediate":"Immediate","filters.mode.history":"Historical","description":"Historical data only tracks shards with CPU load over 70%"}'),Xd=JSON.parse('{"no-data":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445","filters.mode.immediate":"\u041c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u044b\u0435","filters.mode.history":"\u0418\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0435","description":"\u0418\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043e \u0448\u0430\u0440\u0434\u0430\u0445 \u0441 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u043e\u0439 CPU \u0432\u044b\u0448\u0435 70%"}'),eu=(0,st.wZ)("ydb-diagnostics-top-shards",{ru:Xd,en:Yd}),tu=e=>{let{value:t,onChange:a}=e;const r=t.mode===Kd.F.Immediate?void 0:t.from,i=t.mode===Kd.F.Immediate?void 0:t.to;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)(Od.E,{value:t.mode,onUpdate:e=>{if(!((e,t)=>Object.values(e).includes(t))(Kd.F,e)){const t=Object.values(Kd.F).join(", ");throw new Error(`Unexpected TopShards mode "${e}". Should be one of: ${t}`)}a({mode:e})},children:[(0,d.jsx)(Od.E.Option,{value:Kd.F.Immediate,children:eu("filters.mode.immediate")}),(0,d.jsx)(Od.E.Option,{value:Kd.F.History,children:eu("filters.mode.history")})]}),(0,d.jsx)(Qd,{from:r,to:i,onChange:e=>{a({mode:Kd.F.History,...e})}})]})},au=(0,c.cn)("top-shards"),nu={...he.LE,dynamicRender:!1,externalSort:!0,disableSortReset:!0,defaultOrder:$t.ZP.DESCENDING};function ru(e){return e?(0,Ie.o0)(new Date(e).getTime()):"\u2013"}function iu(e){return e?e.split(",").map((e=>({columnId:e,order:$t.ZP.DESCENDING}))):void 0}function su(e){return e.to="now",e.from="now-1h",e}const ou=e=>{var t,a;let{tenantName:r,path:i,type:s}=e;const o=(0,ve.zL)(),l=(0,er.TH)(),[c]=(0,ve.Rj)(),u=(0,ve.ix)((e=>e.shardsWorkload)),[m,p]=n.useState((()=>{const e={...u};return e.mode||(e.mode=Kd.F.Immediate),e.from||e.to||su(e),e})),[h,v]=n.useState(bo),{currentData:x,isFetching:g,error:y}=Jd.Ag.useSendShardQueryQuery({database:r,path:i,sortOrder:(b=h,b?b.split(",").map((e=>({columnId:e,order:"DESC"}))):void 0),filters:m},{pollingInterval:c});var b;const f=g&&void 0===x,E=(null===x||void 0===x||null===(t=x.resultSets)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.result)||[],S=e=>{v(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(Array.isArray(e)?e:[e]).map((e=>{let{columnId:t}=e;return t})).join(",")}(e))},T=e=>{const t={...e};if(!u.from&&!u.to&&!e.from&&!e.to)switch(e.mode){case Kd.F.Immediate:t.from=t.to=void 0;break;case Kd.F.History:su(t)}o((0,Jd.K2)(e)),p((e=>({...e,...t})))},j=n.useMemo((()=>{const e=((e,t)=>[cl(e,t),dl,ul,ml,pl,vl])(r,l),t=e.map((e=>({...e,sortable:jo(e.name)})));return m.mode===Kd.F.History&&(t.splice(5,0,{name:fo,render:e=>{let{row:t}=e;return ru(t.PeakTime)},sortable:!1}),t.push({name:Eo,render:e=>{let{row:t}=e;return ru(t.IntervalEnd)}})),t}),[m.mode,l,r]);return(0,d.jsxs)(at.l,{children:[(0,d.jsx)(at.l.Controls,{children:(0,d.jsx)(tu,{value:m,onChange:T})}),m.mode===Kd.F.History&&(0,d.jsx)("div",{className:au("hint"),children:eu("description")}),y?(0,d.jsx)(Ne.V,{error:(0,kt.fV)(y)}):null,(0,d.jsx)(at.l.Table,{loading:f,children:y&&!E?null:!E||K(s)?eu("no-data"):(0,d.jsx)(tt.G,{columnsWidthLSKey:tl,columns:j,data:E,settings:nu,onSort:S,sortOrder:iu(h)})})]})},lu=(0,c.cn)("kv-tenant-diagnostics");const cu=function(e){const t=n.useRef(null),a=(0,ve.zL)(),{diagnosticsTab:s=ge.qQ.overview}=(0,ve.ix)((e=>e.tenant)),[o]=(0,i.useQueryParams)({database:i.StringParam,schema:i.StringParam,backend:i.StringParam,clusterName:i.StringParam}),l=X(e.type)?e.path:e.tenantName,c=X(e.type)||e.path===e.tenantName,u=(0,Ee.bq)(),m=c?lc({hasFeatureFlags:u}):oc(e.type);let p=m.find((e=>e.id===s));return p||(p=m[0]),n.useEffect((()=>{p&&p.id!==s&&a((0,Se.$v)(p.id))}),[p,s,a]),(0,d.jsxs)("div",{className:lu(),children:[p?(0,d.jsx)(r.ql,{children:(0,d.jsx)("title",{children:p.title})}):null,(()=>{var e;return(0,d.jsx)("div",{className:lu("header-wrapper"),children:(0,d.jsxs)("div",{className:lu("tabs"),children:[(0,d.jsx)(ye.m,{size:"l",items:m,activeTab:null===(e=p)||void 0===e?void 0:e.id,wrapTo:(e,t)=>{let{id:a}=e;const n=(0,da.Sj)({...o,[da.XV.diagnosticsTab]:a});return(0,d.jsx)(be.rU,{to:n,className:lu("tab"),children:t},a)},allowNotSelected:!0}),(0,d.jsx)(fe.q,{})]})})})(),(0,d.jsx)("div",{className:lu("page-wrapper"),ref:t,children:(()=>{var a;const{type:n,path:r}=e;switch(null===(a=p)||void 0===a?void 0:a.id){case ge.qQ.overview:return(0,d.jsx)(kl,{type:n,tenantName:l,path:r,additionalTenantProps:e.additionalTenantProps,additionalNodesProps:e.additionalNodesProps});case ge.qQ.schema:return(0,d.jsx)(ca,{path:r,tenantName:l,type:n,extended:!0});case ge.qQ.topQueries:return(0,d.jsx)(Wd,{tenantName:l});case ge.qQ.topShards:return(0,d.jsx)(ou,{tenantName:l,path:r,type:n});case ge.qQ.nodes:return(0,d.jsx)(Xe.G,{path:r,database:l,additionalNodesProps:e.additionalNodesProps,parentRef:t});case ge.qQ.tablets:return(0,d.jsx)(Ot.J,{path:r,database:l});case ge.qQ.storage:return(0,d.jsx)(At.V,{database:l,parentRef:t});case ge.qQ.network:return(0,d.jsx)(ad,{path:r,database:l,additionalNodesProps:e.additionalNodesProps,parentRef:t});case ge.qQ.describe:return(0,d.jsx)(Nn,{path:r,database:l,type:n});case ge.qQ.hotKeys:return(0,d.jsx)(fc,{path:r,database:l});case ge.qQ.graph:return(0,d.jsx)(Ye,{path:r,database:l});case ge.qQ.consumers:return(0,d.jsx)(yn,{path:r,database:l,type:n});case ge.qQ.partitions:return(0,d.jsx)(Ad,{path:r,database:l});case ge.qQ.configs:return(0,d.jsx)(ya,{database:l});case ge.qQ.operations:return(0,d.jsx)(Rt,{database:l});default:return(0,d.jsx)("div",{children:"No data..."})}})()})]})},du=JSON.parse('{"controls.query-mode-selector_type":"Query type:","tabs.newQuery":"Editor","tabs.history":"History","tabs.saved":"Saved","history.empty":"History is empty","history.empty-search":"Search result is empty","saved.empty":"There are no saved queries","delete-dialog.header":"Delete query","delete-dialog.question":"Are you sure you want to delete query","delete-dialog.delete":"Delete","delete-dialog.cancel":"Cancel","preview.title":"Preview","preview.not-available":"Preview is not available","preview.close":"Close preview","method-description.script":"For YQL-scripts combining DDL and DML.\\nAPI call: schema.scripting","method-description.scan":"Read-only queries, potentially reading a lot of data.\\nAPI call: table.ExecuteScan","method-description.data":"DML queries for changing and fetching data in serialization mode.\\nAPI call: table.executeDataQuery","method-description.query":"Any query. An experimental API call supposed to replace all existing methods.\\nAPI Call: query.ExecuteScript","method-description.pg":"Queries in postgresql syntax.\\nAPI call: query.ExecuteScript","transaction-mode-description.serializable":"Provides the strictest isolation level for custom transactions","transaction-mode-description.onlinero":"Each read operation in the transaction is reading the data that is most recent at execution time","transaction-mode-description.stalero":"Read operations within a transaction may return results that are slightly out-of-date (lagging by fractions of a second)","transaction-mode-description.snapshot":"All the read operations within a transaction access the database snapshot. All the data reads are consistent","transaction-mode-description.implicit":"No transaction","tracing-level-description.basic":"Spans of main component operations","tracing-level-description.detailed":"Highest detail applicable for diagnosing problems in production","tracing-level-description.diagnostic":"Detailed debugging information for developers","tracing-level-description.off":"No tracing","tracing-level-description.toplevel":"Lowest detail, no more than two spans per request to the component","tracing-level-description.trace":"Very detailed debugging information","statistics-mode-description.none":"Don\'t collect statistics","statistics-mode-description.basic":"Collect statistics","statistics-mode-description.full":"Collect statistics and query plan","statistics-mode-description.profile":"Collect statistics for individual tasks","query-duration.description":"Duration of server-side query execution","action.send-query":"Send query","action.send-selected-query":"Send selected query","action.previous-query":"Previous query in history","action.next-query":"Next query in history","action.save-query":"Save query","action.stop":"Stop","filter.text.placeholder":"Search by query text...","gear.tooltip":"Query execution settings have been changed for ","banner.query-settings.message":"Query results are displayed for ","history.queryText":"Query text","history.endTime":"End time","history.duration":"Duration"}'),uu=(0,st.wZ)("ydb-query-editor",{en:du}),mu=(0,c.cn)("ydb-queries-history"),pu="queriesHistoryTableColumnsWidth";const hu=function(e){let{changeUserInput:t}=e;const a=(0,ve.zL)(),n=(0,ve.ix)(As.qV),r=(0,ve.ix)(As.vS),i=[...n].reverse(),s=io((e=>{t({input:e.queryText}),a((0,Se.jk)(ge._0.newQuery))})),o=[{name:"queryText",header:uu("history.queryText"),render:e=>{let{row:t}=e;return(0,d.jsx)("div",{className:mu("query"),children:(0,d.jsx)(oo,{value:t.queryText,maxQueryHeight:wo})})},sortable:!1,width:600},{name:"EndTime",header:uu("history.endTime"),render:e=>{let{row:t}=e;return t.endTime?(0,Ie.o0)(t.endTime.toString()):"-"},align:"right",width:200,sortable:!1},{name:"Duration",header:uu("history.duration"),render:e=>{let{row:t}=e;return t.durationUs?(0,wt.zm)((0,wt.BO)(t.durationUs)):"-"},align:"right",width:150,sortable:!1}];return(0,d.jsxs)(at.l,{className:mu(),children:[(0,d.jsx)(at.l.Controls,{children:(0,d.jsx)(it.o,{value:r,onChange:e=>{a((0,As.u$)(e))},placeholder:uu("filter.text.placeholder"),className:mu("search")})}),(0,d.jsx)(at.l.Table,{children:(0,d.jsx)(tt.G,{columnsWidthLSKey:pu,columns:o,data:i,settings:Po,emptyDataMessage:uu(r?"history.empty-search":"history.empty"),onRowClick:e=>s(e),rowClassName:()=>mu("table-row")})})]})};var vu=a(76421),xu=a(40145);const gu=(0,a(99669).k)((async()=>({Editor:(await Promise.resolve().then(a.bind(a,39862))).default})),"Editor");var yu=a(19580);function bu(e,t){const a=new Map(Object.entries(e)),n=new Map(Object.entries(t));return Array.from(a.keys()).filter((e=>a.has(e)&&void 0!==a.get(e)&&a.get(e)!==n.get(e)))}const fu=JSON.parse('{"action.settings":"Query settings","form.query-mode":"Query type","form.timeout":"Timeout","form.transaction-mode":"Transaction mode","form.statistics-mode":"Statistics collection mode","form.tracing-level":"Tracing level","form.limit-rows":"Limit rows","button-done":"Save","tooltip_plan-to-svg-statistics":"Statistics option is set to \\"Full\\" due to the enabled \\"Execution plan\\" experiment.\\n To disable it, go to the \\"Experiments\\" section in the user settings.","button-cancel":"Cancel","form.timeout.seconds":"sec","form.validation.timeout":"Must be positive","form.validation.limitRows":"Must be between 1 and 100000","description.default":" (default)","docs":"Documentation"}'),Eu=JSON.parse('{"action.settings":"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430","form.query-mode":"\u0422\u0438\u043f \u0437\u0430\u043f\u0440\u043e\u0441\u0430","form.timeout":"\u0422\u0430\u0439\u043c\u0430\u0443\u0442","form.transaction-mode":"\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438","form.statistics-mode":"\u0420\u0435\u0436\u0438\u043c \u0441\u0431\u043e\u0440\u0430 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438","form.tracing-level":"Tracing level","form.limit-rows":"\u041b\u0438\u043c\u0438\u0442 \u0441\u0442\u0440\u043e\u043a","tooltip_plan-to-svg-statistics":"\u041e\u043f\u0446\u0438\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u0432 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \\"Full\\" \u0438\u0437-\u0437\u0430 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u043e\u0433\u043e \u044d\u043a\u0441\u043f\u0435\u0440\u0438\u043c\u0435\u043d\u0442\u0430 \\"Execution plan\\".\\n \u0427\u0442\u043e\u0431\u044b \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0435\u0433\u043e, \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b \\"Experiments\\" \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f.","button-done":"\u0413\u043e\u0442\u043e\u0432\u043e","button-cancel":"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c","form.timeout.seconds":"\u0441\u0435\u043a","form.validation.timeout":"\u0422\u0430\u0439\u043c\u0430\u0443\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c","form.validation.limitRows":"\u041b\u0438\u043c\u0438\u0442 \u0441\u0442\u0440\u043e\u043a \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043c\u0435\u0436\u0434\u0443 1 \u0438 100000","description.default":" (default)","docs":"\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f"}'),Su=(0,st.wZ)("ydb-query-settings-dialog",{en:fu,ru:Eu}),Tu=[{value:kt.cy.implicit,content:kt.Nf[kt.cy.implicit],text:uu("transaction-mode-description.implicit"),isDefault:!0},{value:kt.cy.serializable,content:kt.Nf[kt.cy.serializable],text:uu("transaction-mode-description.serializable")},{value:kt.cy.onlinero,content:kt.Nf[kt.cy.onlinero],text:uu("transaction-mode-description.onlinero")},{value:kt.cy.stalero,content:kt.Nf[kt.cy.stalero],text:uu("transaction-mode-description.stalero")},{value:kt.cy.snapshot,content:kt.Nf[kt.cy.snapshot],text:uu("transaction-mode-description.snapshot")}],ju=[{value:kt.wZ.query,content:kt.U4[kt.wZ.query],text:uu("method-description.query"),isDefault:!0},{value:kt.wZ.script,content:kt.U4[kt.wZ.script],text:uu("method-description.script")},{value:kt.wZ.scan,content:kt.U4[kt.wZ.scan],text:uu("method-description.scan")},{value:kt.wZ.data,content:kt.U4[kt.wZ.data],text:uu("method-description.data")},{value:kt.wZ.pg,content:kt.U4[kt.wZ.pg],text:uu("method-description.pg")}],Nu=[{value:kt.$E.none,content:kt.Ie[kt.$E.none],text:uu("statistics-mode-description.none"),isDefault:!0},{value:kt.$E.basic,content:kt.Ie[kt.$E.basic],text:uu("statistics-mode-description.basic")},{value:kt.$E.full,content:kt.Ie[kt.$E.full],text:uu("statistics-mode-description.full")},{value:kt.$E.profile,content:kt.Ie[kt.$E.profile],text:uu("statistics-mode-description.profile")}],Cu=[{value:kt.Rm.off,content:kt.Vj[kt.Rm.off],text:uu("tracing-level-description.off"),isDefault:!0},{value:kt.Rm.toplevel,content:kt.Vj[kt.Rm.toplevel],text:uu("tracing-level-description.toplevel")},{value:kt.Rm.basic,content:kt.Vj[kt.Rm.basic],text:uu("tracing-level-description.basic")},{value:kt.Rm.detailed,content:kt.Vj[kt.Rm.detailed],text:uu("tracing-level-description.detailed")},{value:kt.Rm.diagnostic,content:kt.Vj[kt.Rm.diagnostic],text:uu("tracing-level-description.diagnostic")},{value:kt.Rm.trace,content:kt.Vj[kt.Rm.trace],text:uu("tracing-level-description.trace")}],wu={transactionMode:{title:Su("form.transaction-mode"),options:Tu},queryMode:{title:Su("form.query-mode"),options:ju},statisticsMode:{title:Su("form.statistics-mode"),options:Nu},tracingLevel:{title:Su("form.tracing-level"),options:Cu},timeout:{title:Su("form.timeout")},limitRows:{title:Su("form.limit-rows")}};function Pu(e){let{currentSettings:t,defaultSettings:a}=e;const n=bu(t,a),r={};return n.forEach((e=>{const a=wu[e],n=t[e];if("options"in a){var i;const e=null===(i=a.options.find((e=>e.value===n)))||void 0===i?void 0:i.content;e&&(r[a.title]=e)}else n&&(r[a.title]=String(n))})),r}var Iu=a(82202);const Du=()=>{const[e,t]=(0,Iu.y)(he.RE);let a;try{a=kt.J7.parse(e)}catch(n){a=void 0}return[a,t]};var _u=a(8214);const Ru=()=>{const[e,t]=(0,Iu.y)(he.Rn),[a]=Du(),[n]=(0,_u.d)(),r=a?bu(a,kt.hl):[],i=n?bu(n,kt.hl):[],s=r.length>0,o=a?Pu({currentSettings:a,defaultSettings:kt.hl}):{},l=n?Pu({currentSettings:n,defaultSettings:kt.hl}):{},c=e&&Date.now()-e<1e3*he.nU;return{isBannerShown:s&&!c,isIndicatorShown:s&&c,closeBanner:()=>t(Date.now()),resetBanner:()=>t(void 0),changedCurrentSettings:i,changedCurrentSettingsDescriptions:l,changedLastExucutionSettings:r,changedLastExecutionSettingsDescriptions:o}},Au="s-expression",Ou="yql";var Mu=a(58903);let ku;!function(e){e.triggerCollapse="triggerCollapse",e.triggerExpand="triggerExpand",e.clear="clear"}(ku||(ku={}));const Lu=e=>{localStorage.setItem(e,"true")},zu=e=>{localStorage.removeItem(e)};function qu(e){return function(t,a){switch(a){case ku.triggerCollapse:return Lu(e),{...t,triggerCollapse:!0,triggerExpand:!1,collapsed:!0};case ku.triggerExpand:return zu(e),{...t,triggerCollapse:!1,triggerExpand:!0,collapsed:!1};case ku.clear:return zu(e),{triggerCollapse:!1,triggerExpand:!1,collapsed:!1};default:return t}}}const Uu=(0,c.cn)("kv-pane-visibility-button");function Fu(e){let{onCollapse:t,onExpand:a,isCollapsed:r,initialDirection:i="top",className:s}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(bt.M,{title:"Collapse",children:(0,d.jsx)(Yr.z,{view:"flat-secondary",onClick:t,className:Uu({hidden:r},s),children:(0,d.jsx)(ft.J,{data:Mu.Z,className:Uu({[i]:!0})})})}),(0,d.jsx)(bt.M,{title:"Expand",children:(0,d.jsx)(Yr.z,{view:"flat-secondary",onClick:a,className:Uu({hidden:!r},s),children:(0,d.jsx)(ft.J,{data:Mu.Z,className:Uu({[i]:!0},"rotate")})})})]})}const Qu=(0,c.cn)("kv-divider");const Gu=function(){return(0,d.jsx)("div",{className:Qu()})},Bu=(0,c.cn)("ydb-query-elapsed-time");function $u(e){let{className:t}=e;const[,a]=n.useState({}),[r]=n.useState(Date.now()),i=Date.now()-r;n.useEffect((()=>{const e=setInterval((()=>{a({})}),he.NO);return()=>{clearInterval(e)}}),[]);const s=i>he.RQ*he.NO?(0,ht.x9)(i).format("hh:mm:ss"):(0,ht.x9)(i).format("mm:ss");return(0,d.jsx)(qt._,{className:Bu(null,t),children:s})}var Vu=a(1995),Hu=a(50015);const Zu=function(e){let{disabled:t}=e;const a=(0,ve.zL)();return(0,d.jsx)(Yr.z,{onClick:()=>{a((0,Hu.Xl)())},view:"flat-secondary",disabled:t,title:"Fullscreen",children:(0,d.jsx)(ft.J,{data:Vu.Z})})};var Wu,Ju=a(41715);function Ku(){return Ku=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ku.apply(this,arguments)}const Yu=function(e){return n.createElement("svg",Ku({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},e),Wu||(Wu=n.createElement("path",{fill:"currentColor",d:"M13.383 6.5a.309.309 0 00.305-.305V5.18a.328.328 0 00-.305-.305H11.25V2.742a.328.328 0 00-.305-.304H9.93a.309.309 0 00-.305.304v3.149c0 .355.254.609.61.609h3.148zm-7.008-.61V2.743a.328.328 0 00-.305-.304H5.055a.309.309 0 00-.305.304v2.133H2.617a.309.309 0 00-.304.305v1.015c0 .178.126.305.304.305h3.149c.33 0 .609-.254.609-.61zm0 7.618v-3.149c0-.33-.28-.609-.61-.609H2.618a.309.309 0 00-.304.305v1.015c0 .178.126.305.304.305H4.75v2.133c0 .178.127.305.305.305H6.07a.309.309 0 00.305-.305zm4.875 0v-2.133h2.133a.309.309 0 00.305-.305v-1.015a.328.328 0 00-.305-.305h-3.149c-.355 0-.609.28-.609.61v3.148c0 .178.127.305.305.305h1.015a.309.309 0 00.305-.305z"})))};var Xu;const em=(0,c.cn)("ydb-fullscreen"),tm=null!==(Xu=document.getElementById("fullscreen-root"))&&void 0!==Xu?Xu:void 0;const am=function(e){let{children:t,className:a}=e;const r=(0,ve.ix)((e=>e.fullscreen)),i=(0,ve.zL)(),s=n.useCallback((()=>{i((0,Hu.vj)())}),[i]);n.useEffect((()=>{const e=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",e,!1),()=>{document.removeEventListener("keydown",e,!1)}}),[s]);const[o,l]=n.useState(null);n.useEffect((()=>{const e=document.createElement("div");return null===tm||void 0===tm||tm.appendChild(e),e.style.display="contents",l(e),()=>{l(null),e.remove()}}),[]);const c=n.useRef(null);return n.useLayoutEffect((()=>{var e;o&&(r?null===tm||void 0===tm||tm.appendChild(o):null===(e=c.current)||void 0===e||e.appendChild(o))}),[o,r]),o?(0,d.jsx)("div",{ref:c,style:{display:"contents"},children:(0,d.jsx)(Ju.h,{container:o,children:(0,d.jsxs)("div",{className:em({fullscreen:r},a),children:[(0,d.jsx)(Yr.z,{onClick:s,view:"raised",className:em("close-button"),children:(0,d.jsx)(ft.J,{data:Yu})}),t]})})}):null};var nm=a(92243);function rm(e){const t=n.useRef(null),a=n.useId(),{data:r,opts:i,shapes:s}=e;return n.useEffect((()=>{const e=t.current;if(!e)return;e.innerHTML="",e.style.setProperty("width","100vw"),e.style.setProperty("height","100vh");const a=(0,nm.hP)(e.id,r,i,s);return a.render(),e.style.setProperty("width","100%"),e.style.setProperty("height","100%"),()=>{a.destroy()}}),[r,i,s]),(0,d.jsx)("div",{id:a,ref:t,style:{overflow:"auto"}})}const im={renderNodeTitle:e=>{const t=e.name.split("|");return t.length>1?t[1]:e.name},textOverflow:"normal",initialZoomFitsCanvas:!0},sm={node:nm.od};function om(e){return(0,d.jsx)(rm,{...e,opts:im,shapes:sm})}var lm=a(29651),cm=a(81187),dm=a(46640);function um(e){var t;const a=(0,kt.dt)(e);return"object"===typeof a&&"Query was cancelled"===(null===(t=a.error)||void 0===t?void 0:t.message)}var mm=a(87717);const pm=(0,c.cn)("ydb-query-settings-description"),hm=e=>{let{querySettings:t,prefix:a}=e;return(0,d.jsxs)("div",{className:pm("message"),children:[a,Object.entries(t).map(((e,t,a)=>{let[n,r]=e;return(0,d.jsxs)("span",{className:pm("description-item"),children:[`${n}: ${r}`,t<a.length-1?", ":null]},t)}))]})},vm=(0,c.cn)("kv-query-execution-status"),xm=()=>{const{isIndicatorShown:e,changedLastExecutionSettingsDescriptions:t}=Ru();return e?(0,d.jsx)(cm.u,{openDelay:0,content:(0,d.jsx)(hm,{prefix:uu("banner.query-settings.message"),querySettings:t}),children:(0,d.jsx)(ft.J,{data:is.Z,className:vm("query-settings-icon")})}):null},gm=e=>{let t,a,{className:n,error:r,loading:i}=e;if(i)t=(0,d.jsx)(dm.y,{size:"xs"}),a="Running";else if((0,mm.IZ)(r)&&"ECONNABORTED"===r.code)t=(0,d.jsx)(ft.J,{data:lm.Z}),a="Connection aborted";else if(um(r))t=(0,d.jsx)(ft.J,{data:xt.Z}),a="Stopped";else{const e=Boolean(r);t=(0,d.jsx)(ft.J,{data:e?ss.Z:rs.Z,className:vm("result-status-icon",{error:e})}),a=e?"Failed":"Completed"}return(0,d.jsxs)("div",{className:vm(null,n),children:[t,a,um(r)||i?null:(0,d.jsx)(xm,{})]})},ym=n.memo((function(e){const{className:t,value:a}=e,n=(0,ve.zL)();return(0,d.jsx)("span",{className:jm("cell",t),onClick:e=>n((0,Pe.hJ)(e.target,a,"cell")),children:a})})),bm=JSON.parse('{"empty":"Table is empty"}'),fm=JSON.parse('{"empty":"\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u043f\u0443\u0441\u0442\u0430\u044f"}'),Em=(0,st.wZ)("ydb-query-result-table",{ru:fm,en:bm}),Sm=e=>{let{data:t,name:a}=e,n=a.length;if(t)for(const r of t){const e=r[a]?String(r[a]).length:0;if(n=Math.max(n,e),10*n+20>=600)return 600}return 10*n+20},Tm={...he.LE,stripedRows:!0,dynamicRenderType:"variable",dynamicItemSizeGetter:()=>40,sortable:!1},jm=(0,c.cn)("ydb-query-result-table"),Nm=(e,t)=>t,Cm=e=>{const{columns:t,data:a,...r}=e,i=n.useMemo((()=>(0,kt.Xh)(a)),[a]),s=n.useMemo((()=>t?((e,t)=>{if(!e.length)return[];const a=null===t||void 0===t?void 0:t.slice(0,100);return e.map((e=>{let{name:t,type:n}=e;const r=(0,kt.T$)(n);return{name:t,width:Sm({data:a,name:t}),align:"number"===r?$t.ZP.RIGHT:$t.ZP.LEFT,render:e=>{let{row:a}=e;return(0,d.jsx)(ym,{value:String(a[t])})}}}))})(t,i):(e=>{if(!e.length)return[];const t=null===e||void 0===e?void 0:e.slice(0,100);return Object.keys(e[0]).map((a=>({name:a,width:Sm({data:t,name:a}),align:(0,Qr.kE)(e[0][a])?$t.ZP.RIGHT:$t.ZP.LEFT,render:e=>{let{row:t}=e;return(0,d.jsx)(ym,{value:String(t[a])})}})))})(i)),[i,t]);return Array.isArray(a)?s.length?(0,d.jsx)(tt.G,{data:i,columns:s,settings:Tm,rowKey:Nm,...r}):(0,d.jsx)("div",{className:jm("message"),children:Em("empty")}):null};var wm=a(87130);const Pm=le.h.injectEndpoints({endpoints:e=>({cancelQuery:e.mutation({queryFn:async(e,t)=>{let{queryId:a,database:n}=e,{signal:r}=t;try{const e=await window.api.sendQuery({database:n,action:"cancel-query",query_id:a},{signal:r});if((0,kt.gW)(e))return{error:e};return{data:(0,kt.Ae)(e)}}catch(i){return{error:i}}}})}),overrideExisting:"throw"}),Im=(0,c.cn)("cancel-query-button");function Dm(e){let{queryId:t,tenantName:a}=e;const[r,i]=Pm.useCancelQueryMutation(),s=n.useCallback((()=>{r({queryId:t,database:a})}),[t,r,a]);return(0,d.jsxs)(Yr.z,{loading:i.isLoading,onClick:s,className:Im("stop-button",{error:Boolean(i.error)}),children:[(0,d.jsx)(ft.J,{data:wm.Z,size:16}),uu("action.stop")]})}var _m=a(8475),Rm=a(72001),Am=a(25089);const Om=(0,c.cn)("ydb-query-explain-simplified-plan");function Mm(e){let{value:t,formatter:a}=e;if(!(0,Qr.kE)(t))return;const n=a(Number(t));return(0,d.jsx)("div",{className:Om("metrics-cell"),children:n})}var km=a(81778);const Lm={Table:"var(--g-color-text-info)",Predicate:"var(--g-color-text-positive)",Condition:"var(--g-color-text-utility)"};function zm(e){return e in Lm?Lm[e]:"var(--g-color-text-secondary)"}function qm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=[],a=Object.entries(e);if(1===a.length){const e=a[0][1],n=zm(a[0][0]);t.push((0,d.jsx)("span",{style:{color:n},children:(0,Ie.fm)(e)},"param"))}else{const a=function(e){const t=[],{Table:a,Predicate:n,Condition:r,...i}=e;return a&&t.push(["Table",a]),n&&t.push(["Predicate",n]),r&&t.push(["Condition",r]),t.concat(Object.entries(i))}(e);for(let e=0;e<a.length;e++){const[n,r]=a[e],i=zm(n);e>0&&t.push(", "),t.push((0,d.jsxs)("span",{style:{color:i},children:[n,": ",(0,Ie.fm)(r)]},e))}}return t}function Um(e){let{params:t}=e;return t?(0,d.jsxs)("span",{className:Om("operation-params"),children:["(",qm(t),")"]}):null}const Fm=25,Qm=9;function Gm(e){let{modifiers:t,left:a}=e;return(0,d.jsx)("div",{className:Om("divider",t),style:{left:a}})}function Bm(e){let{row:t,depth:a=0,params:r}=e;const{name:i,operationParams:s,lines:o=""}=r,l=t.getLeafRows().length>0&&t.getIsExpanded(),c=n.useMemo((()=>function(e,t){const a=e.split(".").map(Number),n=[];for(let r=0;r<a.length;r++)r===a.length-1&&0!==r&&(a[r]?n.push((0,d.jsx)(Gm,{modifiers:{horizontal:!0},left:Qm+1+Fm*(r-1)},"last")):n.push((0,d.jsx)(Gm,{modifiers:{last:!0},left:Qm+Fm*(r-1)},"last"))),r===a.length-1&&t&&n.push((0,d.jsx)(Gm,{modifiers:{first:!0},left:Qm+Fm*r},"first")),a[r]&&n.push((0,d.jsx)(Gm,{left:Qm+Fm*(r-1)},r));return n}(o,l)),[o,l]);return(0,d.jsxs)("div",{style:{paddingLeft:Fm*a},className:Om("operation-name"),children:[c,(0,d.jsxs)(yt.k,{gap:1,alignItems:"flex-start",className:Om("operation-content"),children:[t.getCanExpand()&&(0,d.jsx)(Yr.z,{view:"flat",size:"xs",onClick:t.getToggleExpandedHandler(),children:(0,d.jsx)(Yr.z.Icon,{children:(0,d.jsx)(km.F,{direction:t.getIsExpanded()?"bottom":"right",size:14})})}),(0,d.jsx)("div",{className:Om("operation-name-content"),children:(0,d.jsxs)("div",{children:[i,"\xa0",(0,d.jsx)(Um,{params:s})]})})]})]})}function $m(e){return(0,d.jsx)(Mm,{value:e.getValue(),formatter:e=>e<1e8?(0,Am.X)(e).format():(0,Qr.t_)(e,1)})}function Vm(e){let{name:t}=e;return(0,d.jsx)("div",{className:Om("table-header-content"),children:t})}const Hm=[{accessorKey:"name",accessorFn:function(e){return{name:e.name,operationParams:e.operationParams,lines:e.lines}},header:()=>(0,d.jsx)(Vm,{name:"Operation"}),size:600,cell:e=>(0,d.jsx)(Bm,{row:e.row,depth:e.row.depth,params:e.getValue()})},{accessorKey:"aCpu",header:()=>(0,d.jsx)(Vm,{name:"A-Cpu"}),size:90,minSize:100,cell:function(e){return(0,d.jsx)(Mm,{value:e.getValue(),formatter:e=>(0,wt.zm)(Math.round(e))})},meta:{align:"right",verticalAlign:"top"}},{accessorKey:"aRows",header:()=>(0,d.jsx)(Vm,{name:"A-Rows"}),size:90,minSize:100,cell:$m,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eCost",header:()=>(0,d.jsx)(Vm,{name:"E-Cost"}),size:90,minSize:100,cell:$m,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eRows",header:()=>(0,d.jsx)(Vm,{name:"E-Rows"}),size:90,minSize:100,cell:$m,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eSize",header:()=>(0,d.jsx)(Vm,{name:"E-Size"}),size:90,minSize:100,cell:$m,meta:{align:"right",verticalAlign:"top"}}];function Zm(e){let{plan:t}=e;const a=n.useMemo((()=>function(e){if(!e)return[];const t=[{items:e,prefix:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",parentIndex:-1,parentArray:[]}],a=[];for(;t.length>0;){const{items:e,prefix:n,parentIndex:r,parentArray:i}=t.pop(),s=[];for(let a=0;a<e.length;a++){const r={...e[a]},i=a<e.length-1?1:0;let o=`${n}.${i}`;n||(o=String(i)),r.lines=o,s.push(r),r.children&&t.push({items:r.children,prefix:o,parentIndex:a,parentArray:s})}-1===r?a.push(...s):i[r].children=s}return a}(t)),[t]),[r,i]=n.useState(!0),s=(0,_m.x)({columns:Hm,data:a,getSubRows:e=>e.children,enableExpanding:!0,onExpandedChange:i,state:{expanded:r}});return(0,d.jsx)("div",{className:Om(),children:(0,d.jsx)(Rm.i,{table:s,headerCellClassName:e=>{var t;let{column:a}=e;const n=null===(t=a.columnDef.meta)||void 0===t?void 0:t.align;return Om("table-header-cell",{align:n})},cellClassName:e=>{var t,a;const n=null===e||void 0===e||null===(t=e.column.columnDef.meta)||void 0===t?void 0:t.align,r=null===e||void 0===e||null===(a=e.column.columnDef.meta)||void 0===a?void 0:a.verticalAlign;return Om("table-cell",{align:n,"vertical-align":r})},className:Om("table"),stickyHeader:!0})})}var Wm=a(58231);const Jm=(0,c.cn)("ydb-query-duration"),Km=e=>{let{duration:t}=e;if(!t)return null;const a=(0,wt.tt)((0,wt.BO)(t),1);return(0,d.jsx)("span",{className:Jm(),children:(0,d.jsx)(Ua,{className:Jm("item-with-popover"),contentClassName:Jm("popover-content"),text:a,popoverClassName:Jm("popover"),popoverContent:uu("query-duration.description"),buttonProps:{className:Jm("popover-button")}})})};var Ym=a(74679);const Xm=(0,c.cn)("ydb-query-settings-banner");function ep(){const{isBannerShown:e,changedLastExecutionSettingsDescriptions:t,closeBanner:a}=Ru();return e?(0,d.jsx)(Ym.b,{className:Xm(),theme:"info",align:"baseline",message:(0,d.jsx)(hm,{prefix:uu("banner.query-settings.message"),querySettings:t}),onClose:a}):null}function tp(e){return e.replaceAll("\\","\\\\").replaceAll("\n","\\n").replaceAll("\r","\\r").replaceAll("\t","\\t")}var ap=a(15152);const np=le.h.injectEndpoints({endpoints:e=>({planToSvgQuery:e.query({queryFn:async(e,t)=>{let{plan:a,database:n}=e,{signal:r}=t;try{return{data:await window.api.planToSvg({database:n,plan:a},{signal:r})}}catch(i){return{error:i}}}})}),overrideExisting:"throw"}),rp=JSON.parse('{"description.graph-is-not-supported":"Graph can not be rendered","action.result":"Result","action.stats":"Stats","action.schema":"Schema","action.explain-plan":"Explain Plan","action.copy":"Copy {{activeSection}}","trace":"Trace","title.truncated":"Truncated","title.result":"Result","text_plan-svg":"Execution plan","text_open-plan-svg":"Open execution plan in new window","text_error-plan-svg":"Error: {{error}}"}'),ip=(0,st.wZ)("ydb-execute-result",{en:rp});function sp(e,t){return e?"flat-danger":t?"flat-secondary":"flat-info"}function op(e){let{plan:t,database:a}=e;const[r,i]=n.useState(null),[s,o]=n.useState(null),[l,{isLoading:c}]=np.useLazyPlanToSvgQueryQuery(),u=n.useCallback((()=>{l({plan:t,database:a}).unwrap().then((e=>{const t=new Blob([e],{type:"image/svg+xml"}),a=URL.createObjectURL(t);o(a),i(null),window.open(a,"_blank")})).catch((e=>{i(JSON.stringify(e))}))}),[a,l,t]);return n.useEffect((()=>()=>{s&&URL.revokeObjectURL(s)}),[s]),(0,d.jsx)(cm.u,{content:r?ip("text_error-plan-svg",{error:r}):ip("text_open-plan-svg"),children:(0,d.jsxs)(Yr.z,{view:sp(r,c),loading:c,onClick:u,disabled:c,children:[ip("text_plan-svg"),(0,d.jsx)(Yr.z.Icon,{children:(0,d.jsx)(ap.Z,{})})]})})}var lp=a(10730);const cp=le.h.injectEndpoints({endpoints:e=>({checkTrace:e.query({queryFn:async(e,t)=>{let{url:a}=e,{signal:n,dispatch:r}=t;try{const e=await window.api.checkTrace({url:a},{signal:n});return r((0,As.Rp)()),{data:e}}catch(i){return{error:i}}}})}),overrideExisting:"throw"});function dp(e,t){return e.replace(/\${(\w+)}/g,((e,a)=>t[a]||e))}function up(e){let{traceId:t,isTraceReady:a}=e;const{traceCheck:r,traceView:i}=(0,lp.kW)(),s=null!==r&&void 0!==r&&r.url?dp(r.url,{traceId:t}):"",o=null!==i&&void 0!==i&&i.url?dp(i.url,{traceId:t}):"",[l,{isLoading:c,isUninitialized:u}]=cp.useLazyCheckTraceQuery();return n.useEffect((()=>{let e;return s&&!a&&(e=l({url:s})),()=>{var t;return null===(t=e)||void 0===t?void 0:t.abort()}}),[l,s,a]),!o||u&&!a?null:(0,d.jsxs)(Yr.z,{view:c?"flat-secondary":"flat-info",loading:c,href:o,target:"_blank",children:[ip("trace"),(0,d.jsx)(Yr.z.Icon,{children:(0,d.jsx)(ap.Z,{})})]})}var mp=a(45514),pp=a(90035);const hp=(0,c.cn)("ydb-query-execute-result"),vp={result:"result",stats:"stats",schema:"schema",simplified:"simplified"};function xp(e){var t,a;let{result:r,isResultsCollapsed:i,theme:s,tenantName:l,onCollapseResults:c,onExpandResults:u}=e;const[m,p]=n.useState(0),[h,v]=n.useState(vp.result),x=(0,ve.zL)(),[g]=(0,ve.yu)(he.Mg),{error:y,isLoading:b,queryId:f,data:E}=r,S=null===E||void 0===E?void 0:E.stats,T=(null===E||void 0===E||null===(t=E.resultSets)||void 0===t?void 0:t.length)||0,j=null===E||void 0===E||null===(a=E.resultSets)||void 0===a?void 0:a[m],{plan:N,simplifiedPlan:C}=n.useMemo((()=>function(e){var t,a,n;if(!e)return{};const{plan:r}=e;if(r){const e=(0,kt.y5)(r);if(e.meta.version!==mp.J.v2)return{};const{Plan:t,SimplifiedPlan:a}=e;return{plan:t?{...(0,pp.G)(t),tables:e.tables}:void 0,simplifiedPlan:{plan:a?(0,pp.f)([a]):void 0,pristine:a}}}const{stats:i}=e,s=null===i||void 0===i||null===(t=i.Executions)||void 0===t||null===(a=t[0])||void 0===a||null===(n=a.TxPlansWithStats)||void 0===n?void 0:n[0];if(!s)return{};try{const e=JSON.parse(s);return{plan:(0,pp.G)(e)}}catch(o){return{}}}(E)),[E]),w=[{value:vp.result,content:ip("action.result")},{value:vp.stats,content:ip("action.stats")}];N&&w.push({value:vp.schema,content:ip("action.schema")}),null!==C&&void 0!==C&&C.plan&&w.push({value:vp.simplified,content:ip("action.explain-plan")});const P=(0,kt.dt)(y);n.useEffect((()=>()=>{x((0,Hu.vj)())}),[x]);const I=()=>{switch(h){case vp.result:{const e=function(e){if(null===e||void 0===e||!e.length)return"";const t=Object.keys(e[0]),a=[t.map(tp).join("\t")];for(const n of e){const e=[];for(const a of t){const t=n[a];e.push(tp("object"===typeof t?JSON.stringify(t):`${t}`))}a.push(e.join("\t"))}return a.join("\n")}(null===j||void 0===j?void 0:j.result);return e}case vp.stats:return S;case vp.simplified:return null===C||void 0===C?void 0:C.pristine;default:return}};return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)("div",{className:hp("controls"),children:[(0,d.jsxs)("div",{className:hp("controls-right"),children:[(0,d.jsx)(gm,{error:y,loading:b}),!y&&!b&&(0,d.jsxs)(n.Fragment,{children:[void 0!==(null===S||void 0===S?void 0:S.DurationUs)&&(0,d.jsx)(Km,{duration:Number(S.DurationUs)}),w&&h&&(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Gu,{}),(0,d.jsx)(Od.E,{options:w,value:h,onUpdate:e=>{v(e)}})]})]}),b?(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)($u,{className:hp("elapsed-time")}),(0,d.jsx)(Dm,{queryId:f,tenantName:l})]}):null,null!==E&&void 0!==E&&E.traceId?(0,d.jsx)(up,{traceId:E.traceId,isTraceReady:r.isTraceReady}):null,null!==E&&void 0!==E&&E.plan&&g?(0,d.jsx)(op,{plan:null===E||void 0===E?void 0:E.plan,database:l}):null]}),(0,d.jsxs)("div",{className:hp("controls-left"),children:[(()=>{const e=I(),t=(0,Ie.fm)(e);return t?(0,d.jsx)(bn.m,{text:t,view:"flat-secondary",title:ip("action.copy",{activeSection:h})}):null})(),(0,d.jsx)(Zu,{}),(0,d.jsx)(Fu,{onCollapse:c,onExpand:u,isCollapsed:i,initialDirection:"bottom"})]})]}),b||um(y)?null:(0,d.jsx)(ep,{}),(0,d.jsx)(o.s,{loading:b,children:(0,d.jsx)(am,{children:y&&!um(y)?P?"object"===typeof P?(0,d.jsx)(Wm.I,{data:P}):(0,d.jsx)("div",{className:hp("error"),children:P}):null:h===vp.result?(0,d.jsxs)("div",{className:hp("result-wrapper"),children:[T>1&&(0,d.jsx)("div",{children:(0,d.jsx)(ye.m,{className:hp("result-tabs"),size:"l",items:(0,Fr.c$)(T).map((e=>{var t,a;return{id:String(e),title:`Result #${e+1}${null!==E&&void 0!==E&&null!==(t=E.resultSets)&&void 0!==t&&null!==(a=t[e])&&void 0!==a&&a.truncated?" (T)":""}`}})),activeTab:String(m),onSelectTab:e=>p(Number(e))})}),j&&(0,d.jsxs)("div",{className:hp("result"),children:[(0,d.jsxs)("div",{className:hp("result-head"),children:[(0,d.jsx)(gt.x,{variant:"subheader-3",children:null!==j&&void 0!==j&&j.truncated?ip("title.truncated"):ip("title.result")}),j.result&&(0,d.jsx)(gt.x,{color:"secondary",variant:"body-2",className:hp("row-count"),children:`(${j.result.length})`})]}),(0,d.jsx)(Cm,{data:j.result,columns:j.columns})]})]}):h===vp.stats?(0,d.jsx)("div",{className:hp("inspector"),children:(0,d.jsx)(En(),{data:S,isExpanded:()=>!0,searchOptions:{debounceTime:300}})}):h===vp.schema?(null===N||void 0===N?void 0:N.links)&&(null===N||void 0===N?void 0:N.nodes)&&(null===N||void 0===N?void 0:N.nodes.length)?(0,d.jsx)("div",{className:hp("explain-canvas-container"),children:(0,d.jsx)(om,{data:N},s)}):ip("description.graph-is-not-supported"):h===vp.simplified?(()=>{const{plan:e}=null!==C&&void 0!==C?C:{};return e?(0,d.jsx)(Zm,{plan:e}):null})():null})})]})}var gp=a(39862);const yp=(0,c.cn)("ydb-query-explain-ast"),bp={automaticLayout:!0,selectOnLineNumbers:!0,readOnly:!0,minimap:{enabled:!1},wrappingIndent:"indent"};function fp(e){let{ast:t,theme:a}=e;return(0,d.jsx)("div",{className:yp(),children:(0,d.jsx)(gp.default,{language:Au,value:t,options:bp,theme:`vs-${a}`})})}const Ep=JSON.parse('{"description.empty-result":"There is no {{activeOption}} for the request","description.graph-is-not-supported":"Graph can not be rendered","action.schema":"Schema","action.explain-plan":"Explain Plan","action.json":"JSON","action.ast":"AST","action.copy":"Copy {{activeOption}}"}'),Sp=(0,st.wZ)("ydb-explain-result",{en:Ep}),Tp=(0,c.cn)("ydb-query-explain-graph");function jp(e){let{explain:t,theme:a}=e;const{links:n,nodes:r,version:i}=null!==t&&void 0!==t?t:{},s=i===mp.J.v2,o=n&&r&&r.length;return s&&o?(0,d.jsx)("div",{className:Tp("canvas-container"),children:(0,d.jsx)(om,{data:{links:n,nodes:r}},a)}):(0,d.jsx)("div",{className:Tp("text-message"),children:Sp("description.graph-is-not-supported")})}const Np=(0,c.cn)("ydb-query-explain-text");function Cp(e){let{explain:t}=e;return(0,d.jsx)(En(),{data:t,isExpanded:()=>!0,className:Np("inspector"),searchOptions:{debounceTime:300}})}const wp=(0,c.cn)("ydb-query-explain-result"),Pp={schema:"schema",json:"json",ast:"ast",simplified:"simplified"},Ip={[Pp.schema]:Sp("action.schema"),[Pp.json]:Sp("action.json"),[Pp.ast]:Sp("action.ast"),[Pp.simplified]:Sp("action.explain-plan")},Dp=[{value:Pp.schema,content:Ip[Pp.schema]},{value:Pp.simplified,content:Ip[Pp.simplified]},{value:Pp.json,content:Ip[Pp.json]},{value:Pp.ast,content:Ip[Pp.ast]}];function _p(e){let{theme:t,result:a,tenantName:r,onCollapseResults:i,onExpandResults:s,isResultsCollapsed:l}=e;const c=(0,ve.zL)(),[u,m]=n.useState(Pp.schema),[p,h]=n.useTransition(),{error:v,isLoading:x,queryId:g}=a,{preparedPlan:y,ast:b,simplifiedPlan:f}=a.data||{};n.useEffect((()=>()=>{c((0,Hu.vj)())}),[c]);const E=()=>(0,d.jsx)("div",{className:wp("text-message"),children:Sp("description.empty-result",{activeOption:Ip[u]})}),S=(()=>{switch(u){case Pp.json:return null===y||void 0===y?void 0:y.pristine;case Pp.ast:return b;case Pp.simplified:return null===f||void 0===f?void 0:f.pristine;default:return}})(),T=(0,Ie.fm)(S);return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)("div",{className:wp("controls"),children:[(0,d.jsxs)("div",{className:wp("controls-right"),children:[(0,d.jsx)(gm,{error:v,loading:x}),!v&&!x&&(0,d.jsxs)(n.Fragment,{children:[void 0!==(null===y||void 0===y?void 0:y.DurationUs)&&(0,d.jsx)(Km,{duration:y.DurationUs}),(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Gu,{}),(0,d.jsx)(Od.E,{options:Dp,value:u,onUpdate:e=>{h((()=>m(e)))}})]})]}),x?(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)($u,{className:wp("elapsed-time")}),(0,d.jsx)(Dm,{queryId:g,tenantName:r})]}):null]}),(0,d.jsxs)("div",{className:wp("controls-left"),children:[T&&(0,d.jsx)(bn.m,{text:T,view:"flat-secondary",title:Sp("action.copy",{activeOption:u})}),(0,d.jsx)(Zu,{disabled:Boolean(v)}),(0,d.jsx)(Fu,{onCollapse:i,onExpand:s,isCollapsed:l,initialDirection:"bottom"})]})]}),x||um(v)?null:(0,d.jsx)(ep,{}),(0,d.jsx)(o.s,{loading:x||p,children:(0,d.jsx)(am,{className:wp("result"),children:(()=>{if(um(v))return null;if(v)return(0,d.jsx)("div",{className:wp("text-message"),children:(0,kt.fV)(v)});switch(u){case Pp.json:return null!==y&&void 0!==y&&y.pristine?(0,d.jsx)(Cp,{explain:y.pristine}):E();case Pp.ast:return b?(0,d.jsx)(fp,{ast:b,theme:t}):E();case Pp.schema:var e;return null!==y&&void 0!==y&&null!==(e=y.nodes)&&void 0!==e&&e.length?(0,d.jsx)(jp,{theme:t,explain:y}):E();case Pp.simplified:{const{plan:e}=null!==f&&void 0!==f?f:{};return null!==e&&void 0!==e&&e.length?(0,d.jsx)(Zm,{plan:e}):E()}default:return null}})()})})]})}const Rp=le.h.injectEndpoints({endpoints:e=>({sendQuery:e.query({queryFn:async(e,t)=>{let{query:a,database:n,action:r}=e,{signal:i}=t;try{const e=await window.api.sendQuery({query:a,database:n,action:r},{signal:i,withRetries:!0});return(0,kt.gW)(e)?{error:e}:{data:(0,kt.Ae)(e)}}catch(s){return{error:s||new Error("Unauthorized")}}},providesTags:["All","PreviewData"]})}),overrideExisting:"throw"}),Ap=(0,c.cn)("kv-preview"),Op=e=>{var t,a,n;let{database:r,path:i,type:s}=e;const o=(0,ve.zL)(),l=H(s),c=`select * from \`${i}\` limit 32`,{currentData:u,isFetching:m,error:p}=Rp.useSendQueryQuery({database:r,query:c,action:ie(s)?"execute-query":"execute-scan"},{skip:!l,refetchOnMountOrArgChange:!0}),h=m&&void 0===u,v=null!==(t=null===u||void 0===u||null===(a=u.resultSets)||void 0===a?void 0:a[0])&&void 0!==t?t:{},x=()=>{o((0,yu.m7)(!1))};if(h)return(0,d.jsx)("div",{className:Ap("loader-container"),children:(0,d.jsx)(Kr.a,{size:"m"})});let g;l?p&&(g=(0,d.jsx)("div",{className:Ap("message-container","error"),children:(0,kt.fV)(p)})):g=(0,d.jsx)("div",{className:Ap("message-container"),children:uu("preview.not-available")});const y=null!==(n=g)&&void 0!==n?n:(0,d.jsx)("div",{className:Ap("result"),children:(0,d.jsx)(Cm,{data:v.result,columns:v.columns})});return(0,d.jsxs)("div",{className:Ap(),children:[(0,d.jsxs)("div",{className:Ap("header"),children:[(0,d.jsxs)("div",{className:Ap("title"),children:[uu("preview.title")," ",(0,d.jsx)("div",{className:Ap("table-name"),children:i})]}),(0,d.jsxs)("div",{className:Ap("controls-left"),children:[(0,d.jsx)(Zu,{disabled:Boolean(p)}),(0,d.jsx)(Yr.z,{view:"flat-secondary",onClick:x,title:uu("preview.close"),children:(0,d.jsx)(ft.J,{data:cc.Z,size:18})})]})]}),(0,d.jsx)(am,{children:y})]})};var Mp=a(68045),kp=a(81101),Lp=a(85996);function zp(e){var t;window.ydbEditor||console.error("Monaco editor not found"),null===(t=window.ydbEditor)||void 0===t||t.trigger(void 0,"insertSnippetToEditor",e)}const qp=e=>`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table\nCREATE TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}/my_row_table\``:"${1:my_row_table}"} (\n    category_id Uint64 NOT NULL,\n    id Uint64,\n    expire_at Datetime,\n    updated_on Datetime,\n    name Text,\n    \`binary-payload\` Bytes,\n    attributes JsonDocument,\n    -- uncomment to add a secondary index\n    -- INDEX idx_row_table_id GLOBAL SYNC ON ( id ) COVER ( name, attributes ), -- Secondary indexes docs https://ydb.tech/en/docs/yql/reference/syntax/create_table#secondary_index\n    PRIMARY KEY (category_id, id)\n) \nWITH (\n    AUTO_PARTITIONING_BY_SIZE = ENABLED,\n    AUTO_PARTITIONING_PARTITION_SIZE_MB = 2048,\n    AUTO_PARTITIONING_BY_LOAD = ENABLED,\n    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = 4,\n    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = 1024\n    -- uncomment to create a table with predefined partitions\n    -- , UNIFORM_PARTITIONS = 4 -- The number of partitions for uniform initial table partitioning.\n                            -- The primary key's first column must have type Uint64 or Uint32.\n                            -- A created table is immediately divided into the specified number of partitions\n    -- uncomment to launch read only replicas in every AZ\n    -- , READ_REPLICAS_SETTINGS = 'PER_AZ:1' -- Enable read replicas for stale read, launch one replica in every availability zone\n    -- uncomment to enable ttl\n    -- , TTL = Interval("PT1H") ON expire_at -- Enable background deletion of expired rows https://ydb.tech/en/docs/concepts/ttl\n    -- uncomment to create a table with a bloom filter\n    -- , KEY_BLOOM_FILTER = ENABLED -- With a Bloom filter, you can more efficiently determine\n                               -- if some keys are missing in a table when making multiple single queries by the primary key.\n)`,Up=e=>`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table#olap-tables\nCREATE TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}/my_column_table\``:"${1:my_column_table}"} (\n    id Int64 NOT NULL,\n    author Text,\n    title Text,\n    body Text,\n    PRIMARY KEY (id)\n)\nPARTITION BY HASH(id)\nWITH (STORE = COLUMN)`,Fp=()=>'-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-async-replication\nCREATE OBJECT secret_name (TYPE SECRET) WITH value="secret_value";\n\nCREATE ASYNC REPLICATION my_replication\nFOR ${1:<original_table>} AS ${2:replica_table} --[, `/remote_database/another_table_name` AS `another_local_table_name` ...]\nWITH (\n    CONNECTION_STRING="${3:grpcs://mydb.ydb.tech:2135/?database=/remote_database}",\n    TOKEN_SECRET_NAME = "secret_name"\n    -- ENDPOINT="mydb.ydb.tech:2135",\n    -- DATABASE=`/remote_database`,\n    -- USER="user",\n    -- PASSWORD_SECRET_NAME="your_password"\n);',Qp=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter_table/\n\nALTER TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"}\n    -- RENAME TO new_table_name\n    -- DROP COLUMN some_existing_column\n\${2:ADD COLUMN numeric_column Int32};`,Gp=e=>{var t;const a=null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${2:<my_table>}";return`SELECT ${(null===e||void 0===e||null===(t=e.tableData)||void 0===t?void 0:t.map((e=>"`"+e.name+"`")).join(", "))||"${1:*}"}\nFROM ${a}\n${null!==e&&void 0!==e&&e.relativePath?"":"WHERE ${3:Key1 = 1}\nORDER BY ${4:Key1}\n"}LIMIT \${5:10};`},Bp=e=>{var t;return`UPSERT INTO ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"}\n( ${(null===e||void 0===e||null===(t=e.tableData)||void 0===t?void 0:t.map((e=>`\`${e.name}\``)).join(", "))||"${2:id, name}"} )\nVALUES ( ${null!==e&&void 0!==e&&e.tableData?"${3: }":'${3:1, "foo"}'} );`},$p=e=>`DROP EXTERNAL TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:my_table}"};`,Vp=e=>{const t=null===e||void 0===e?void 0:e.relativePath.split("/").slice(0,-1).join("/");return`CREATE EXTERNAL TABLE ${t?`\`${t}/my_external_table\``:"${1:<my_external_table>}"} (\n    column1 Int,\n    column2 Int\n) WITH (\n    DATA_SOURCE="${null!==e&&void 0!==e&&e.relativePath?`${e.relativePath}`:"${2:<path_to_data_source>}"}",\n    LOCATION="",\n    FORMAT="json_as_string",\n    \`file_pattern\`=""\n);`},Hp=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-topic\nCREATE TOPIC ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\`/my_topic`:"${1:my_topic}"} (\n    CONSUMER consumer1,\n    CONSUMER consumer2 WITH (read_from = Datetime('1970-01-01T00:00:00Z')) -- Sets up the message write time starting from which the consumer will receive data.\n                                                                           -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format). \n                                                                           -- Default value: now\n) WITH (\n    min_active_partitions = 1, -- Minimum number of topic partitions.\n    partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.\n    retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.\n    retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. \n                              -- When this value is exceeded, the older data is cleared, like under a retention policy. \n                              -- 0 is interpreted as unlimited.\n    partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.\n    partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. \n                                    -- When set to zero, the actual write_burst value is equalled to \n                                    -- the quota value (this allows write bursts of up to one second).\n);`,Zp=e=>`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/alter_topic\nALTER TOPIC ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_topic>}"}\n    ADD CONSUMER new_consumer WITH (read_from = Datetime('1970-01-01T00:00:00Z')), -- Sets up the message write time starting from which the consumer will receive data.\n                                                                                   -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format).\n                                                                                   -- Default value: now\n    ALTER CONSUMER consumer1 SET (read_from = Datetime('1970-01-01T00:00:00Z')),\n    DROP CONSUMER consumer2,\n    SET (\n        min_active_partitions = 1, -- Minimum number of topic partitions.\n        partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.\n        retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.\n        retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. \n                                  -- When this value is exceeded, the older data is cleared, like under a retention policy. \n                                  -- 0 is interpreted as unlimited.\n        partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.\n        partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. \n                                        -- When set to zero, the actual write_burst value is equalled to\n                                        -- the quota value (this allows write bursts of up to one second).\n    );`,Wp=e=>`DROP TOPIC ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_topic>}"};`,Jp=e=>`CREATE VIEW ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\`/my_view`:"${1:my_view}"} WITH (security_invoker = TRUE) AS SELECT 1;`,Kp=e=>`DROP VIEW ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_view>}"};`,Yp=e=>`DROP ASYNC REPLICATION ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_replication>}"};`,Xp=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter-async-replication\nALTER ASYNC REPLICATION ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_replication>}"} SET (STATE = "DONE", FAILOVER_MODE = "FORCE");`,eh=e=>`ALTER TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"} ADD INDEX \${2:index_name} GLOBAL ON (\${3:<column_name>});`,th=e=>{const t=null===e||void 0===e?void 0:e.relativePath.split("/").pop(),a=null===e||void 0===e?void 0:e.relativePath.split("/").slice(0,-1).join("/");return`ALTER TABLE ${a?`\`${a}\``:"${1:<my_table>}"} DROP INDEX ${t||"${2:<index_name>}"};`},ah=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter_table/changefeed\nALTER TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"} ADD CHANGEFEED \${2:changefeed_name} WITH (\n    MODE = \${3:'UPDATES'}, -- KEYS_ONLY, UPDATES, NEW_IMAGE, OLD_IMAGE, or NEW_AND_OLD_IMAGES\n    FORMAT = \${4:'JSON'}, -- JSON or DEBEZIUM_JSON\n    VIRTUAL_TIMESTAMPS = \${5:TRUE}, -- true or false\n    RETENTION_PERIOD = \${6:Interval('PT12H')}, -- Interval value, e.g., Interval('PT24H')\n    -- TOPIC_MIN_ACTIVE_PARTITIONS: The number of topic partitions. By default, the number of topic partitions is equal to the number of table partitions\n    INITIAL_SCAN = \${8:TRUE} -- true or false\n)\n\n-- MODE options:\n--   KEYS_ONLY: Only the primary key components and change flag are written.\n--   UPDATES: Updated column values that result from updates are written.\n--   NEW_IMAGE: Any column values resulting from updates are written.\n--   OLD_IMAGE: Any column values before updates are written.\n--   NEW_AND_OLD_IMAGES: A combination of NEW_IMAGE and OLD_IMAGE modes.`,nh=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-group\nCREATE GROUP ${1:group_name}\n-- group_name: The name of the group. It may contain lowercase Latin letters and digits.",rh=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-user\nCREATE USER ${1:user_name} PASSWORD ${2:'password'}\n-- user_name: The name of the user. It may contain lowercase Latin letters and digits.\n-- option: The password of the user:\n    -- PASSWORD 'password' creates a user with the password password. The ENCRYPTED option is always enabled.\n    -- PASSWORD NULL creates a user with an empty password.",ih=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/delete\nDELETE FROM ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"}\nWHERE \${2:Key1 = 1};`,sh=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/drop-group\nDROP GROUP ${1:<group_name>}\n\n-- IF EXISTS: Suppress an error if the group doesn't exist.\n-- group_name: The name of the group to be deleted.",oh=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/drop-user\nDROP USER ${1:<user_name>}\n\n-- IF EXISTS: Suppress an error if the user doesn't exist.\n-- user_name: The name of the user to be deleted.",lh=e=>`GRANT \${1:<permission_name>}\nON ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${2:<path_to_scheme_object>}"}\nTO \${3:<role_name>}\n\n-- permission_name: The name of the access right to schema objects that needs to be assigned.\n-- path_to_scheme_object: The path to the schema object for which rights are being granted.\n-- role_name: The name of the user or group to whom rights on the schema object are being granted.\n-- WITH GRANT OPTION: Using this construct gives the user or group of users the right to manage access rights - \n--                    to assign or revoke certain rights. This construct has functionality similar to granting \n--                    the "ydb.access.grant" or GRANT right. A subject with the ydb.access.grant right cannot \n--                    grant rights broader than they possess themselves.`,ch=e=>`REVOKE \${1:<permission_name>}\nON ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${2:<path_to_scheme_object>}"}\nFROM \${3:<role_name>}\n\n-- permission_name: The name of the access right to schema objects that needs to be revoked.\n-- path_to_scheme_object: The path to the schema object from which rights are being revoked.\n-- role_name: The name of the user or group from whom rights on the schema object are being revoked.\n-- GRANT OPTION FOR: Using this construct revokes the user's or group's right to manage access rights.\n--                   All previously granted rights by this user remain in effect.\n--                   This construct has functionality similar to revoking the "ydb.access.grant" or GRANT right.`,dh=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/update\nUPDATE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"}\nSET \${2:Column1 = 'foo', Column2 = 'bar'}\nWHERE \${3:Key1 = 1};`,uh=e=>`DROP TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"};`,mh=e=>{const t=t=>()=>{e(t())};return{createRowTable:t(qp),createColumnTable:t(Up),createAsyncReplication:t(Fp),alterAsyncReplication:t(Xp),dropAsyncReplication:t(Yp),alterTable:t(Qp),selectQuery:t(Gp),upsertQuery:t(Bp),createExternalTable:t(Vp),dropExternalTable:t($p),createTopic:t(Hp),alterTopic:t(Zp),dropTopic:t(Wp),createView:t(Jp),dropTable:t(uh),deleteRows:t(ih),updateTable:t(dh),createUser:t(rh),createGroup:t(nh),createCdcStream:t(ah),grantPrivilege:t(lh),revokePrivilege:t(ch),dropUser:t(oh),dropGroup:t(sh),addTableIndex:t(eh),dropTableIndex:t(th)}},ph=JSON.parse('{"button.new-sql":"New query","action.create-row-table":"Create row table","action.create-column-table":"Create column table","action.create-external-table":"Create external table","action.upsert-to-table":"Upsert into table","action.update-table":"Update table","action.alter-table":"Alter table","action.select-rows":"Select from a table","action.delete-rows":"Delete rows","action.drop-table":"Drop table","action.add-index":"Add index","action.drop-index":"Drop index","action.drop-external-table":"Drop external table","menu.tables":"Tables","menu.topics":"Topics","menu.capture":"Change data capture","menu.replication":"Async replication","menu.users":"Users","action.create-topic":"Create Topic","action.drop-topic":"Drop Topic","action.alter-topic":"Alter Topic","action.create-cdc-stream":"Create changefeed","action.create-async-replication":"Create async replication","action.create-user":"Create user","action.create-group":"Create group","action.drop-user":"Drop user","action.drop-group":"Drop group","action.grant-privilege":"Grant privilege","action.revoke-privilege":"Revoke privilege","action.alter-async-replication":"Alter async replication","action.drop-async-replication":"Drop async replication"}'),hh=(0,st.wZ)("ydb-new-sql",{en:ph});function vh(){const e=io(n.useCallback((e=>{zp(e)}),[])),t=mh(e),a=[{text:hh("menu.tables"),items:[{text:hh("action.create-row-table"),action:t.createRowTable},{text:hh("action.create-column-table"),action:t.createColumnTable},{text:hh("action.create-external-table"),action:t.createExternalTable},{text:hh("action.upsert-to-table"),action:t.upsertQuery},{text:hh("action.update-table"),action:t.updateTable},{text:hh("action.alter-table"),action:t.alterTable},{text:hh("action.select-rows"),action:t.selectQuery},{text:hh("action.delete-rows"),action:t.deleteRows},{text:hh("action.drop-table"),action:t.dropTable},{text:hh("action.drop-external-table"),action:t.dropExternalTable},{text:hh("action.add-index"),action:t.addTableIndex},{text:hh("action.drop-index"),action:t.dropTableIndex}]},{text:hh("menu.topics"),items:[{text:hh("action.create-topic"),action:t.createTopic},{text:hh("action.alter-topic"),action:t.alterTopic},{text:hh("action.drop-topic"),action:t.dropTopic}]},{text:hh("menu.replication"),items:[{text:hh("action.create-async-replication"),action:t.createAsyncReplication},{text:hh("action.alter-async-replication"),action:t.alterAsyncReplication},{text:hh("action.drop-async-replication"),action:t.dropAsyncReplication}]},{text:hh("menu.capture"),items:[{text:hh("action.create-cdc-stream"),action:t.createCdcStream}]},{text:hh("menu.users"),items:[{text:hh("action.create-user"),action:t.createUser},{text:hh("action.create-group"),action:t.createGroup},{text:hh("action.drop-user"),action:t.dropUser},{text:hh("action.drop-group"),action:t.dropGroup},{text:hh("action.grant-privilege"),action:t.grantPrivilege},{text:hh("action.revoke-privilege"),action:t.revokePrivilege}]}];return(0,d.jsx)(Qs.h,{items:a,renderSwitcher:e=>(0,d.jsxs)(Yr.z,{...e,children:[hh("button.new-sql"),(0,d.jsx)(Yr.z.Icon,{children:(0,d.jsx)(Lp.Z,{})})]}),popupProps:{placement:"top"}})}const xh=(0,c.cn)("ydb-query-editor-controls"),gh=e=>{let{onClick:t,runIsLoading:a}=e;const{changedCurrentSettings:n,changedCurrentSettingsDescriptions:r}=Ru(),i=n.length>0?{view:"outlined-info",selected:!0}:null;return(0,d.jsx)(cm.u,{disabled:0===n.length,content:(0,d.jsx)(hm,{prefix:uu("gear.tooltip"),querySettings:r}),openDelay:0,placement:["top-start"],children:(0,d.jsxs)(Yr.z,{onClick:t,loading:a,className:xh("gear-button"),...i,children:[(0,d.jsx)(ft.J,{data:Mp.Z,size:16}),i?(0,d.jsxs)("div",{className:xh("changed-settings"),children:["(",n.length,")"]}):null]})})},yh=e=>{let{disabled:t,isLoading:a,highlightedAction:n,handleSendExecuteClick:r,onSettingsButtonClick:i,handleGetExplainQueryClick:s}=e;const o="execute"===n?"action":void 0,l="explain"===n?"action":void 0;return(0,d.jsxs)("div",{className:xh(),children:[(0,d.jsxs)("div",{className:xh("left"),children:[(0,d.jsxs)(Yr.z,{onClick:()=>{r()},disabled:t,loading:a,view:o,className:xh("run-button"),children:[(0,d.jsx)(ft.J,{data:kp.Z,size:14}),"Run"]}),(0,d.jsx)(Yr.z,{onClick:()=>{s()},disabled:t,loading:a,view:l,children:"Explain"}),(0,d.jsx)(gh,{onClick:i,runIsLoading:a})]}),(0,d.jsxs)("div",{className:xh("right"),children:[(0,d.jsx)(vh,{}),(0,d.jsx)(Ks,{buttonProps:{disabled:t}})]})]})};var bh=a(94941),fh=a(55247);const Eh=()=>-1,Sh=(0,c.cn)("ydb-query-settings-select");function Th(e){return(0,d.jsx)("div",{className:Sh("selector"),children:(0,d.jsx)(Te.P,{id:e.id,disabled:e.disabled,options:e.settingOptions,value:[e.setting],onUpdate:t=>{e.onUpdateSetting(t[0])},getOptionHeight:Eh,popupClassName:Sh("popup"),renderOption:e=>(0,d.jsxs)("div",{className:Sh("item",{type:e.value}),children:[(0,d.jsxs)("div",{className:Sh("item-title"),children:[e.content,e.isDefault?Su("description.default"):""]}),e.text&&(0,d.jsx)("span",{className:Sh("item-description"),children:e.text})]}),width:"max"})})}const jh=(0,c.cn)("ydb-query-settings-dialog");function Nh(){const e=(0,ve.zL)(),t=(0,ve.ix)(Bs.oK),[a,r]=(0,ve.dU)(),i=n.useCallback((()=>{e((0,Bs.lm)("idle"))}),[e]),s=n.useCallback((e=>{r(e),i()}),[i,r]);return(0,d.jsxs)(Ms.V,{open:"settings"===t,size:"s",onClose:i,className:jh(),hasCloseButton:!1,children:[(0,d.jsx)(Ms.V.Header,{caption:Su("action.settings")}),(0,d.jsx)(Ch,{initialValues:a,onSubmit:s,onClose:i})]})}function Ch(e){let{initialValues:t,onSubmit:a,onClose:r}=e;const{control:i,handleSubmit:s,formState:{errors:o}}=(0,fh.cI)({defaultValues:t,resolver:(0,bh.F)(kt.J7)}),[l]=(0,ve.yu)(he.Mg),c=(0,Ee.uY)();return(0,d.jsxs)("form",{onSubmit:s(a),children:[(0,d.jsxs)(Ms.V.Body,{className:jh("dialog-body"),children:[(0,d.jsxs)(yt.k,{direction:"row",alignItems:"flex-start",className:jh("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"queryMode",className:jh("field-title"),children:wu.queryMode.title}),(0,d.jsx)("div",{className:jh("control-wrapper",{queryMode:!0}),children:(0,d.jsx)(fh.Qr,{name:"queryMode",control:i,render:e=>{let{field:t}=e;return(0,d.jsx)(Th,{id:"queryMode",setting:t.value,onUpdateSetting:t.onChange,settingOptions:wu.queryMode.options})}})})]}),(0,d.jsxs)(yt.k,{direction:"row",alignItems:"flex-start",className:jh("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"timeout",className:jh("field-title"),children:wu.timeout.title}),(0,d.jsx)("div",{className:jh("control-wrapper"),children:(0,d.jsx)(fh.Qr,{name:"timeout",control:i,render:e=>{var t,a;let{field:r}=e;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Gs.o,{id:"timeout",type:"number",...r,value:null===(t=r.value)||void 0===t?void 0:t.toString(),className:jh("timeout"),placeholder:"60",validationState:o.timeout?"invalid":void 0,errorMessage:null===(a=o.timeout)||void 0===a?void 0:a.message,errorPlacement:"inside"}),(0,d.jsx)("span",{className:jh("timeout-suffix"),children:Su("form.timeout.seconds")})]})}})})]}),c&&(0,d.jsxs)(yt.k,{direction:"row",alignItems:"flex-start",className:jh("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"tracingLevel",className:jh("field-title"),children:wu.tracingLevel.title}),(0,d.jsx)("div",{className:jh("control-wrapper"),children:(0,d.jsx)(fh.Qr,{name:"tracingLevel",control:i,render:e=>{let{field:t}=e;return(0,d.jsx)(Th,{id:"tracingLevel",setting:t.value,onUpdateSetting:t.onChange,settingOptions:wu.tracingLevel.options})}})})]}),(0,d.jsxs)(yt.k,{direction:"row",alignItems:"flex-start",className:jh("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"transactionMode",className:jh("field-title"),children:wu.transactionMode.title}),(0,d.jsx)("div",{className:jh("control-wrapper",{transactionMode:!0}),children:(0,d.jsx)(fh.Qr,{name:"transactionMode",control:i,render:e=>{let{field:t}=e;return(0,d.jsx)(Th,{id:"transactionMode",setting:t.value,onUpdateSetting:t.onChange,settingOptions:wu.transactionMode.options})}})})]}),(0,d.jsxs)(yt.k,{direction:"row",alignItems:"flex-start",className:jh("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"statisticsMode",className:jh("field-title"),children:wu.statisticsMode.title}),(0,d.jsx)(cm.u,{className:jh("statistics-mode-tooltip"),disabled:!l,openDelay:0,content:Su("tooltip_plan-to-svg-statistics"),children:(0,d.jsx)("div",{className:jh("control-wrapper",{statisticsMode:!0}),children:(0,d.jsx)(fh.Qr,{name:"statisticsMode",control:i,render:e=>{let{field:t}=e;return(0,d.jsx)(Th,{id:"statisticsMode",disabled:l,setting:t.value,onUpdateSetting:t.onChange,settingOptions:wu.statisticsMode.options})}})})})]}),(0,d.jsxs)(yt.k,{direction:"row",alignItems:"flex-start",className:jh("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"limitRows",className:jh("field-title"),children:wu.limitRows.title}),(0,d.jsx)("div",{className:jh("control-wrapper"),children:(0,d.jsx)(fh.Qr,{name:"limitRows",control:i,render:e=>{var t,a;let{field:n}=e;return(0,d.jsx)(Gs.o,{id:"limitRows",type:"number",...n,value:null===(t=n.value)||void 0===t?void 0:t.toString(),className:jh("limit-rows"),placeholder:"10000",validationState:o.limitRows?"invalid":void 0,errorMessage:null===(a=o.limitRows)||void 0===a?void 0:a.message,errorPlacement:"inside"})}})})]})]}),(0,d.jsx)(Ms.V.Footer,{textButtonApply:Su("button-done"),textButtonCancel:Su("button-cancel"),onClickButtonCancel:r,propsButtonApply:{type:"submit"},renderButtons:(e,t)=>(0,d.jsxs)("div",{className:jh("buttons-container"),children:[(0,d.jsx)(Wo.r,{href:"https://ydb.tech/docs",target:"_blank",className:jh("documentation-link"),children:Su("docs")}),(0,d.jsxs)("div",{className:jh("main-buttons"),children:[t,e]})]})})]})}const wh={automaticLayout:!0,selectOnLineNumbers:!0,minimap:{enabled:!1}};const Ph="navigation",Ih=(0,c.cn)("query-editor"),Dh={triggerExpand:!1,triggerCollapse:!1,collapsed:!0};function _h(e){const t=function(){const[e]=(0,ve.yu)(he.y6),[t]=(0,ve.yu)(he.XX);return n.useMemo((()=>{const a=Boolean(e);return{quickSuggestions:a,suggestOnTriggerCharacters:a,acceptSuggestionOnEnter:t?"on":"off",...wh}}),[e,t])}(),a=(0,ve.zL)(),{tenantName:r,path:i,type:s,theme:o,changeUserInput:l}=e,c=(0,ve.ix)(As.m_),u=(0,ve.ix)(As.tF),m=(0,ve.ix)(As.qV),p=(0,ve.ix)(As.Wz),v=(0,ve.ix)(As.jm),x=(0,ve.ix)(yu.bX),g=Boolean(u),[y]=(0,ve.dU)(),b=(0,Ee.uY)(),[f,E]=Du(),{resetBanner:S}=Ru(),[T,j]=(0,ve.yu)(he.w7),[N]=As.c4.useUseSendQueryMutation();n.useEffect((()=>{c!==r&&a((0,As.K0)(r))}),[a,r,c]);const[C,w]=n.useReducer(qu(he.eG),Dh);n.useEffect((()=>{w(ku.triggerCollapse)}),[]),n.useEffect((()=>{w(x||g?ku.triggerExpand:ku.triggerCollapse)}),[x,g]);const P=(0,ve.xd)((()=>m&&0!==m.length?m[m.length-1].queryText:"")),I=(0,ve.xd)((e=>{const t=null!==e&&void 0!==e?e:v;j(kt.Jf.execute),(0,vu.isEqual)(f,y)||(S(),E(y));const n=(0,xu.Z)();var i;(N({actionType:"execute",query:t,database:r,querySettings:y,enableTracingLevel:b,queryId:n}),a((0,yu.m7)(!1)),e)||t!==(null===(i=m[p])||void 0===i?void 0:i.queryText)&&a((0,As.hO)({queryText:v,queryId:n}));w(ku.triggerExpand)})),D=()=>{a((0,Bs.lm)("settings"))},_=(0,ve.xd)((()=>{j(kt.Jf.explain),(0,vu.isEqual)(f,y)||(S(),E(y));const e=(0,xu.Z)();N({actionType:"explain",query:v,database:r,querySettings:y,enableTracingLevel:b,queryId:e}),a((0,yu.m7)(!1)),w(ku.triggerExpand)})),R=(0,ve.xd)((()=>{T===kt.Jf.explain?_():I()}));return(0,d.jsxs)("div",{className:Ih(),children:[(0,d.jsxs)(h,{direction:"vertical",defaultSizePaneKey:he.XN,triggerCollapse:C.triggerCollapse,triggerExpand:C.triggerExpand,minSize:[0,52],collapsedSizes:[100,0],onSplitStartDragAdditional:()=>{w(ku.clear)},children:[(0,d.jsxs)("div",{className:Ih("pane-wrapper",{top:!0}),children:[(0,d.jsx)("div",{className:Ih("monaco-wrapper"),children:(0,d.jsx)("div",{className:Ih("monaco"),children:(0,d.jsx)(gu,{language:Ou,value:v,options:t,onChange:e=>{l({input:e})},editorDidMount:(e,t)=>{window.ydbEditor=e;const n=function(e){const{KeyMod:t,KeyCode:a}=e,n=t.CtrlCmd;return{sendQuery:n|a.Enter,sendSelectedQuery:n|t.Shift|e.KeyCode.Enter,selectPreviousQuery:n|a.UpArrow,selectNextQuery:n|a.DownArrow,saveQuery:n|a.KeyS,saveSelectedQuery:n|t.Shift|a.KeyS}}(t);t.editor.registerCommand("insertSnippetToEditor",((t,a)=>{const n=e.getContribution("snippetController2");n&&(e.focus(),e.setValue(""),n.insert(a))})),function(e){const t=_e()((()=>{e.layout()}),100);e.layout(),window.addEventListener("resize",t),e.onDidDispose((()=>{window.removeEventListener("resize",t)}))}(e),function(e,t){Ah(e.getValue(),t()),e.onDidChangeModelContent((()=>{Ah(e.getValue(),t())})),e.onDidDispose((()=>{window.onbeforeunload=null}))}(e,P),e.focus(),e.addAction({id:"sendQuery",label:uu("action.send-query"),keybindings:[n.sendQuery],precondition:void 0,keybindingContext:void 0,contextMenuGroupId:Ph,contextMenuOrder:1,run:()=>R()});const r=e.createContextKey("canSendSelectedText",!1);e.onDidChangeCursorSelection((e=>{let{selection:t,secondarySelections:a}=e;const n=t.selectionStartLineNumber!==t.positionLineNumber||t.selectionStartColumn!==t.positionColumn,i=a.length>0;r.set(n&&!i)})),e.addAction({id:"sendSelectedQuery",label:uu("action.send-selected-query"),keybindings:[n.sendSelectedQuery],precondition:"canSendSelectedText",contextMenuGroupId:Ph,contextMenuOrder:1,run:e=>{const t=e.getSelection(),a=e.getModel();if(t&&a){const e=a.getValueInRange({startLineNumber:t.getSelectionStart().lineNumber,startColumn:t.getSelectionStart().column,endLineNumber:t.getPosition().lineNumber,endColumn:t.getPosition().column});I(e)}}}),e.addAction({id:"previous-query",label:uu("action.previous-query"),keybindings:[n.selectPreviousQuery],contextMenuGroupId:Ph,contextMenuOrder:2,run:()=>{a((0,As.NU)())}}),e.addAction({id:"next-query",label:uu("action.next-query"),keybindings:[n.selectNextQuery],contextMenuGroupId:Ph,contextMenuOrder:3,run:()=>{a((0,As.AJ)())}}),e.addAction({id:"save-query",label:uu("action.save-query"),keybindings:[n.saveQuery],run:()=>{Os.ZP.show(Xs)}})},theme:`vs-${o}`,editorWillUnmount:()=>{window.ydbEditor=void 0}})})}),(0,d.jsx)(yh,{handleSendExecuteClick:I,onSettingsButtonClick:D,isLoading:Boolean(null===u||void 0===u?void 0:u.isLoading),handleGetExplainQueryClick:_,disabled:!v,highlightedAction:T})]}),(0,d.jsx)("div",{className:Ih("pane-wrapper"),children:(0,d.jsx)(Rh,{resultVisibilityState:C,onExpandResultHandler:()=>{w(ku.triggerExpand)},onCollapseResultHandler:()=>{w(ku.triggerCollapse)},type:s,theme:o,result:u,tenantName:r,path:i,showPreview:x},null===u||void 0===u?void 0:u.queryId)})]}),(0,d.jsx)(Nh,{})]})}function Rh(e){let{resultVisibilityState:t,onExpandResultHandler:a,onCollapseResultHandler:n,type:r,theme:i,result:s,tenantName:o,path:l,showPreview:c}=e;return c?(0,d.jsx)(Op,{database:o,path:l,type:r}):"execute"===(null===s||void 0===s?void 0:s.type)?(0,d.jsx)(xp,{result:s,isResultsCollapsed:t.collapsed,onExpandResults:a,onCollapseResults:n,theme:i,tenantName:o}):"explain"===(null===s||void 0===s?void 0:s.type)?(0,d.jsx)(_p,{result:s,theme:i,tenantName:o,isResultsCollapsed:t.collapsed,onExpandResults:a,onCollapseResults:n}):null}function Ah(e,t){const a=!!e&&e!==t;window.onbeforeunload=a?e=>{e.preventDefault(),e.returnValue=""}:null}const Oh=[{id:ge._0.newQuery,title:uu("tabs.newQuery")},{id:ge._0.history,title:uu("tabs.history")},{id:ge._0.saved,title:uu("tabs.saved")}],Mh=e=>{let{className:t,activeTab:a}=e;const n=(0,er.TH)(),r=(0,Re.mB)(n);return(0,d.jsx)("div",{className:t,children:(0,d.jsx)(ye.m,{size:"l",allowNotSelected:!0,activeTab:a,items:Oh,wrapTo:(e,t)=>{let{id:a}=e;const n=(0,da.Sj)({...r,[da.XV.queryTab]:a});return(0,d.jsx)(Ps.h,{to:n,children:t},a)}})})};var kh=a(7603),Lh=a(44899);const zh=(0,c.cn)("ydb-saved-queries"),qh=e=>{let{visible:t,queryName:a,onCancelClick:n,onConfirmClick:r}=e;return(0,d.jsxs)(Ms.V,{open:t,hasCloseButton:!1,size:"s",onClose:n,onEnterKeyDown:r,children:[(0,d.jsx)(Ms.V.Header,{caption:uu("delete-dialog.header")}),(0,d.jsxs)(Ms.V.Body,{className:zh("dialog-body"),children:[uu("delete-dialog.question"),(0,d.jsx)("span",{className:zh("dialog-query-name"),children:` ${a}?`})]}),(0,d.jsx)(Ms.V.Footer,{textButtonApply:uu("delete-dialog.delete"),textButtonCancel:uu("delete-dialog.cancel"),onClickButtonCancel:n,onClickButtonApply:r})]})},Uh=e=>{let{changeUserInput:t}=e;const a=$s(),r=(0,ve.zL)(),i=(0,ve.ix)(Bs.zC),[s,o]=n.useState(!1),[l,c]=n.useState(""),u=()=>{o(!1),c("")},m=io(n.useCallback((e=>{let{queryText:a,queryName:n}=e;t({input:a}),r((0,Bs.GC)(n)),r((0,Se.jk)(ge._0.newQuery))}),[t,r])),p=[{name:"name",header:"Name",render:e=>{let{row:t}=e;return(0,d.jsx)("div",{className:zh("query-name"),children:t.name})},width:200},{name:"body",header:"Query Text",render:e=>{let{row:t}=e;return(0,d.jsxs)("div",{className:zh("query"),children:[(0,d.jsx)("div",{className:zh("query-body"),children:(0,d.jsx)(oo,{value:t.body,maxQueryHeight:wo})}),(0,d.jsxs)("span",{className:zh("controls"),children:[(0,d.jsx)(Yr.z,{view:"flat-secondary",children:(0,d.jsx)(ft.J,{data:kh.Z})}),(0,d.jsx)(Yr.z,{view:"flat-secondary",onClick:(a=t.name,e=>{e.stopPropagation(),o(!0),c(a)}),children:(0,d.jsx)(ft.J,{data:Lh.Z})})]})]});var a},sortable:!1,resizeMinWidth:650}];return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)(at.l,{className:zh(),children:[(0,d.jsx)(at.l.Controls,{children:(0,d.jsx)(it.o,{onChange:e=>{r((0,Bs.b0)(e))},placeholder:uu("filter.text.placeholder"),className:zh("search")})}),(0,d.jsx)(at.l.Table,{children:(0,d.jsx)(tt.G,{columnsWidthLSKey:"savedQueriesTableColumnsWidth",columns:p,data:a,settings:Po,emptyDataMessage:uu(i?"history.empty-search":"saved.empty"),rowClassName:()=>zh("row"),onRowClick:e=>m({queryText:e.body,queryName:e.name}),initialSortOrder:{columnId:"name",order:$t.ZP.ASCENDING}})})]}),(0,d.jsx)(qh,{visible:s,queryName:l,onCancelClick:()=>{u()},onConfirmClick:()=>{u(),r((0,Bs.qF)(l)),c("")}})]})},Fh=(0,c.cn)("ydb-query"),Qh=e=>{const t=(0,ve.zL)(),{queryTab:a=ge._0.newQuery}=(0,ve.ix)((e=>e.tenant)),i=e=>{t((0,As.B8)(e))},s=n.useMemo((()=>Oh.find((e=>{let{id:t}=e;return t===a}))),[a]);return(0,d.jsxs)("div",{className:Fh(),children:[s?(0,d.jsx)(r.ql,{children:(0,d.jsx)("title",{children:s.title})}):null,(0,d.jsx)(Mh,{className:Fh("tabs"),activeTab:a}),(0,d.jsx)("div",{className:Fh("content"),children:(()=>{switch(a){case ge._0.newQuery:return(0,d.jsx)(_h,{changeUserInput:i,...e});case ge._0.history:return(0,d.jsx)(hu,{changeUserInput:i});case ge._0.saved:return(0,d.jsx)(Uh,{changeUserInput:i});default:return null}})()})]})};var Gh=a(34996),Bh=a(71267);const $h=["query","diagnostics"],Vh={query:Gh.Z,diagnostics:Bh.Z};const Hh=(0,c.cn)("ydb-tenant-navigation"),Zh=e=>{let{id:t,title:a,icon:n}=e;return{value:t,content:(0,d.jsxs)("span",{className:Hh("item"),children:[(0,d.jsx)(ft.J,{data:n,size:16,className:Hh("icon")}),(0,d.jsx)("span",{className:Hh("text"),children:a})]})}},Wh=()=>{const e=function(){const e=(0,er.k6)(),t=(0,er.TH)(),a=(0,Re.mB)(t),[,r]=(0,ve.yu)(he.pf),{tenantPage:i}=(0,ve.ix)((e=>e.tenant)),s=n.useMemo((()=>{if(t.pathname!==Re.ZP.tenant)return[];const n=$h.map((t=>{const n=ge.m2[t],s=(0,da.Sj)({...a,[ge.bS]:n});return{id:n,title:Mr(`pages.${t}`),icon:Vh[t],path:s,current:i===n,onForward:()=>{r(n),e.push(s)}}}));return n}),[i,r,t.pathname,e,a]);return s}();return(0,d.jsx)("div",{className:Hh(),children:(0,d.jsx)(Od.E,{width:"auto",onUpdate:t=>{const a=e.find((e=>e.id===t));null===a||void 0===a||a.onForward()},size:"l",className:Hh("body"),value:(e.find((e=>e.current))||e[0]).id,options:e.map(Zh)})})},Jh=(0,c.cn)("object-general");const Kh=function(e){const t=(0,xe.C)(),{tenantPage:a}=(0,ve.ix)((e=>e.tenant));return(0,d.jsxs)("div",{className:Jh(),children:[(0,d.jsx)(Wh,{}),(()=>{const{type:n,additionalTenantProps:r,additionalNodesProps:i,tenantName:s,path:o}=e;return a===ge.m2.query?(0,d.jsx)(Qh,{tenantName:s,path:o,theme:t,type:n}):(0,d.jsx)(cu,{type:n,tenantName:s,path:o,additionalTenantProps:r,additionalNodesProps:i})})()]})};var Yh=a(13872);const Xh=le.h.injectEndpoints({endpoints:e=>({getSchemaAcl:e.query({queryFn:async(e,t)=>{let{path:a,database:n}=e,{signal:r}=t;try{const e=await window.api.getSchemaAcl({path:a,database:n},{signal:r});return{data:{acl:e.Common.ACL,effectiveAcl:e.Common.EffectiveACL,owner:e.Common.Owner,interruptInheritance:e.Common.InterruptInheritance}}}catch(i){return{error:i}}},providesTags:["All"]})}),overrideExisting:"throw"}),ev=JSON.parse('{"title_rights":"Access Rights","title_effective-rights":"Effective Access Rights","title_owner":"Owner","title_interupt-inheritance":"Interrupt inheritance","description_empty":"No Acl data"}'),tv=(0,st.wZ)("ydb-acl",{en:ev}),av=(0,c.cn)("ydb-acl"),nv=e=>{if(e&&e.endsWith("@staff")&&!e.startsWith("svc_")){return e.split("@")[0]}return e},rv=["access","type","inheritance"],iv={access:"Access",type:"Access type",inheritance:"Inheritance type"},sv="Allow",ov=new Set(["Object","Container"]);function lv(e){let{value:t}=e;const a="string"===typeof t?[t]:t;return(0,d.jsx)("div",{className:av("definition-content"),children:a.map((e=>(0,d.jsx)("span",{children:e},e)))})}function cv(e){if(!e||!e.length)return[];const t=function(e){return e.map((e=>{const{AccessRules:t=[],AccessRights:a=[],AccessType:n,InheritanceType:r,Subject:i}=e,s=t.concat(a),o=n===sv?void 0:n;let l;return((null===r||void 0===r?void 0:r.length)!==ov.size||r.some((e=>!ov.has(e))))&&(l=r),{access:s.length?s:void 0,type:o,inheritance:l,Subject:i}}))}(e);return t.map((e=>{let{Subject:t,...a}=e;const n=Object.entries(a).filter((e=>{let[t,a]=e;return Boolean(a)}));return 1===n.length&&"access"===n[0][0]?{name:t,content:(0,d.jsx)(lv,{value:n[0][1]}),multilineName:!0}:{label:(0,d.jsx)("span",{className:av("group-label"),children:t}),items:rv.map((e=>{const t=a[e];if(t)return{name:iv[e],content:(0,d.jsx)(lv,{value:t}),multilineName:!0}})).filter(Fr.D)}}))}const dv=e=>{let{path:t,database:a}=e;const{currentData:r,isFetching:i,error:s}=Xh.useGetSchemaAclQuery({path:t,database:a}),o=i&&!r,{acl:l,effectiveAcl:c,owner:u,interruptInheritance:m}=r||{},p=cv(l),h=cv(c),v=function(e){const t=nv(e);return t?[{name:t,content:tv("title_owner"),multilineName:!0}]:[]}(u),x=m?[{name:tv("title_interupt-inheritance"),content:(0,d.jsx)(ft.J,{data:Yh.Z,size:20}),multilineName:!0}]:[];if(o)return(0,d.jsx)(Ce.a,{});if(s)return(0,d.jsx)(Ne.V,{error:s});if(!l&&!u&&!c)return(0,d.jsx)(n.Fragment,{children:tv("description_empty")});const g=v.concat(p);return(0,d.jsxs)("div",{className:av(),children:[(0,d.jsx)(uv,{items:x}),(0,d.jsx)(uv,{items:g,title:tv("title_rights")}),(0,d.jsx)(uv,{items:h,title:tv("title_effective-rights")})]})};function uv(e){let{items:t,title:a}=e;return t.length?(0,d.jsxs)(n.Fragment,{children:[a&&(0,d.jsx)("div",{className:av("list-title"),children:a}),(0,d.jsx)(or.w,{items:t,nameMaxWidth:200,className:av("result",{"no-title":!a}),responsive:!0})]}):null}var mv=a(49459);const pv=(e,t,a)=>{const{setActivePath:n}=a;return{openPreview:()=>{t(le.h.util.invalidateTags(["PreviewData"])),t((0,yu.m7)(!0)),t((0,Se.Cs)(ge.m2.query)),t((0,Se.jk)(ge._0.newQuery)),n(e)}}},hv=(e,t)=>(0,d.jsx)(Yr.z,{view:"flat-secondary",onClick:e.openPreview,title:Mr("actions.openPreview"),size:t||"s",children:(0,d.jsx)(ft.J,{data:mv.Z})}),vv=(e,t,a)=>(n,r)=>{const i=pv(n,e,t),s=hv(i,a);return{async_replication:void 0,database:void 0,directory:void 0,table:s,column_table:s,index_table:void 0,topic:void 0,stream:void 0,index:void 0,external_table:s,external_data_source:void 0,view:s}[r]},xv=(e,t,a)=>(n,r)=>{const i=pv(n,e,t);return{preview:hv(i,a)}[r]};var gv=a(91517);const yv=le.h.injectEndpoints({endpoints:e=>({getTableSchemaData:e.mutation({queryFn:async(e,t)=>{let{path:a,tenantName:n,type:r}=e,{dispatch:i}=t;try{if(oe(r)){const e=await i(zt.endpoints.getViewSchema.initiate({database:n,path:a}));if((0,kt.gW)(e))return{error:e};return{data:la(e.data)}}const e=await i(ce.endpoints.getOverview.initiate({path:a,database:n}));return{data:oa(r,e.data)}}catch(s){return{error:s}}}})})});var bv=a(1868),fv=a.n(bv);function Ev(e,t){const a=e.replace(/^\/+|\/+$/g,""),n=t.replace(/^\/+|\/+$/g,"");if(!a.startsWith(n))return a||"/";if(a===n)return`/${a}`;let r=a.slice(n.length);return r=r.replace(/^\/+/,"")||"/",r}function Sv(e,t){return t===f.EPathTypeDir&&(2===e.split("/").length&&e.startsWith("/"))}const Tv=(e,t,a)=>{const{setActivePath:n,showCreateDirectoryDialog:r,getTableSchemaDataPromise:i,getConfirmation:s}=a,o=a=>()=>{const r=()=>{const r=U[e.type],s=[Gp,Bp].includes(a)&&r&&i?i({path:e.path,tenantName:e.tenantName,type:r}):Promise.resolve(void 0);t((0,Se.Cs)(ge.m2.query)),t((0,Se.jk)(ge._0.newQuery)),n(e.path),s.then((t=>{zp(a({...e,tableData:t}))}))};if(s){s().then((e=>{e&&r()}))}else r()};return{createDirectory:r?()=>{r(e.path)}:void 0,createTable:o(qp),createColumnTable:o(Up),createAsyncReplication:o(Fp),alterAsyncReplication:o(Xp),dropAsyncReplication:o(Yp),alterTable:o(Qp),dropTable:o(uh),selectQuery:o(Gp),upsertQuery:o(Bp),createExternalTable:o(Vp),dropExternalTable:o($p),selectQueryFromExternalTable:o(Gp),createTopic:o(Hp),alterTopic:o(Zp),dropTopic:o(Wp),createView:o(Jp),dropView:o(Kp),dropIndex:o(th),addTableIndex:o(eh),createCdcStream:o(ah),copyPath:()=>{try{fv()(e.relativePath),Ct({name:"Copied",title:Mr("actions.copied"),type:"success"})}catch{Ct({name:"Not copied",title:Mr("actions.notCopied"),type:"error"})}}}},jv=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return(n,r)=>{const i=Ev(n,a),s=Tv({path:n,relativePath:i,tenantName:a,type:r},e,t),o={text:Mr("actions.copyPath"),action:s.copyPath},l=[[o],[{text:Mr("actions.createTable"),action:s.createTable},{text:Mr("actions.createColumnTable"),action:s.createColumnTable},{text:Mr("actions.createAsyncReplication"),action:s.createAsyncReplication},{text:Mr("actions.createTopic"),action:s.createTopic},{text:Mr("actions.createView"),action:s.createView}]];s.createDirectory&&l.splice(1,0,[{text:Mr("actions.createDirectory"),action:s.createDirectory}]);const c=[[o],[{text:Mr("actions.alterTable"),action:s.alterTable},{text:Mr("actions.dropTable"),action:s.dropTable},{text:Mr("actions.selectQuery"),action:s.selectQuery},{text:Mr("actions.upsertQuery"),action:s.upsertQuery},{text:Mr("actions.addTableIndex"),action:s.addTableIndex},{text:Mr("actions.createCdcStream"),action:s.createCdcStream}]],d=[[o],[{text:Mr("actions.alterTable"),action:s.alterTable},{text:Mr("actions.dropTable"),action:s.dropTable},{text:Mr("actions.selectQuery"),action:s.selectQuery},{text:Mr("actions.upsertQuery"),action:s.upsertQuery}]],u=[[o],[{text:Mr("actions.alterTopic"),action:s.alterTopic},{text:Mr("actions.dropTopic"),action:s.dropTopic}]],m=[[o],[{text:Mr("actions.selectQuery"),action:s.selectQueryFromExternalTable}],[{text:Mr("actions.dropTable"),action:s.dropExternalTable}]],p=[[o],[{text:Mr("actions.createExternalTable"),action:s.createExternalTable}]],h=[[o],[{text:Mr("actions.selectQuery"),action:s.selectQuery}],[{text:Mr("actions.dropView"),action:s.dropView}]],v=[o];return{async_replication:[[o],[{text:Mr("actions.alterReplication"),action:s.alterAsyncReplication},{text:Mr("actions.dropReplication"),action:s.dropAsyncReplication}]],database:l,directory:l,table:c,column_table:d,index_table:v,topic:u,stream:v,index:[[o,{text:Mr("actions.dropIndex"),action:s.dropIndex}]],external_table:m,external_data_source:p,view:h}[r]}},Nv=(0,c.cn)("ydb-schema-create-directory-dialog"),Cv="relativePath";function wv(e){let{open:t,onClose:a,database:r,parentPath:i,onSuccess:s}=e;const[o,l]=n.useState(""),[c,u]=n.useState(""),[m,p]=yu.m3.useCreateDirectoryMutation(),h=()=>{l(""),p.reset()},v=()=>{a(),u(""),h()};return(0,d.jsxs)(Ms.V,{open:t,onClose:v,size:"s",children:[(0,d.jsx)(Ms.V.Header,{caption:Mr("schema.tree.dialog.header")}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=(a=c)?/\s/.test(a)?Mr("schema.tree.dialog.whitespace"):"":Mr("schema.tree.dialog.empty");var a;l(t),t||m({database:r,path:`${i}/${c}`}).unwrap().then((()=>{v(),s(c)}))},children:[(0,d.jsxs)(Ms.V.Body,{children:[(0,d.jsxs)("label",{htmlFor:Cv,className:Nv("label"),children:[(0,d.jsx)("span",{className:Nv("description"),children:Mr("schema.tree.dialog.description")}),`${i}/`]}),(0,d.jsx)("div",{className:Nv("input-wrapper"),children:(0,d.jsx)(Gs.o,{placeholder:Mr("schema.tree.dialog.placeholder"),value:c,onUpdate:e=>{u(e),h()},autoFocus:!0,hasClear:!0,autoComplete:!1,disabled:p.isLoading,validationState:o?"invalid":void 0,id:Cv,errorMessage:o})}),p.isError&&(0,d.jsx)(Ne.V,{error:p.error,defaultMessage:Mr("schema.tree.dialog.invalid")})]}),(0,d.jsx)(Ms.V.Footer,{loading:p.isLoading,textButtonApply:Mr("schema.tree.dialog.buttonApply"),textButtonCancel:Mr("schema.tree.dialog.buttonCancel"),onClickButtonCancel:v,propsButtonApply:{type:"submit"}})]})]})}const Pv=n.createContext(void 0),Iv=n.createContext(void 0);function Dv(e){let{children:t}=e;const[a,r]=n.useState("");return(0,d.jsx)(Pv.Provider,{value:a,children:(0,d.jsx)(Iv.Provider,{value:r,children:t})})}function _v(){const e=n.useContext(Iv);if(void 0===e)throw new Error("useDispatchTreeKey must be used within a TreeKeyProvider");return e}const Rv=2*he.NO;function Av(e){const t=(0,Ee.j0)(),{rootPath:a,rootName:r,rootType:i,currentPath:s,onActivePathUpdate:o}=e,l=(0,ve.zL)(),c=(0,ve.ix)(As.jm),[u]=yv.useGetTableSchemaDataMutation(),m=n.useCallback((async e=>{try{return await Promise.race([u(e).unwrap(),(0,Fr.Dc)(Rv)])}catch(t){return}}),[u]),[p,h]=(0,ve.dU)(),[v,x]=n.useState(!1),[g,y]=n.useState(""),b=_v(),f=function(){const e=n.useContext(Pv);if(void 0===e)throw new Error("useTreeKey must be used within a TreeKeyProvider");return e}();n.useEffect((()=>{null!==s&&void 0!==s&&s.startsWith(a)||o(a)}),[s,o,a]);return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(wv,{onClose:()=>{x(!1)},open:v,database:a,parentPath:g,onSuccess:e=>{const t=`${g}/${e}`;o(t),b(t)}}),(0,d.jsx)(gv.f,{rootState:{path:a,name:r,type:F(i),collapsed:!1},fetchPath:async e=>{let t;for(;;){const n=l(yu.m3.endpoints.getSchema.initiate({path:e,database:a},{forceRefetch:!0})),{data:r,originalArgs:i}=await n;if(n.unsubscribe(),(null===i||void 0===i?void 0:i.path)===e){t=null===r||void 0===r?void 0:r[e];break}}if(!t)throw new Error(`no describe data about path ${e}`);const{PathDescription:{Children:n=[]}={}}=t;return n.map((e=>{const{Name:t="",PathType:a,PathSubType:n}=e;return{name:t,type:F(a,n),expandable:!re(a,n)}}))},getActions:jv(l,{setActivePath:o,updateQueryExecutionSettings:e=>h({...p,...e}),showCreateDirectoryDialog:t?e=>{y(e),x(!0)}:void 0,getTableSchemaDataPromise:m,getConfirmation:c?ro:void 0},a),renderAdditionalNodeElements:vv(l,{setActivePath:o}),activePath:s,onActivePathUpdate:o,cache:!1,virtualize:!0},f)]})}const Ov=JSON.parse('{"title_navigation":"Navigation","field_source-type":"Source Type","field_data-source":"Data Source","action_copySchemaPath":"Copy schema path","action_openInDiagnostics":"Open in Diagnostics","field_type":"Type","field_subtype":"SubType","field_id":"Id","field_version":"Version","field_created":"Created","field_data-size":"Data size","field_row-count":"Row count","field_partitions":"Partitions count","field_paths":"Paths","field_shards":"Shards","field_state":"State","field_mode":"Mode","field_format":"Format","field_retention":"Retention"}'),Mv=(0,st.wZ)("ydb-object-summary",{en:Ov}),kv=(0,c.cn)("ydb-object-summary");function Lv(e){var t;let{tenantName:a,path:n}=e;const{data:r={},isLoading:s}=(0,yu.hz)({path:a,database:a}),o=null===r||void 0===r||null===(t=r.PathDescription)||void 0===t?void 0:t.Self,[,l]=(0,i.useQueryParam)("schema",i.StringParam);return!o&&s?(0,d.jsx)("div",{children:(0,d.jsx)(Ce.a,{})}):(0,d.jsxs)("div",{className:kv("tree-wrapper"),children:[(0,d.jsx)("div",{className:kv("tree-header"),children:Mv("title_navigation")}),(0,d.jsx)("div",{className:kv("tree"),children:o?(0,d.jsx)(Av,{rootPath:a,rootName:o.Name||a,rootType:o.PathType,currentPath:n,onActivePathUpdate:l}):null})]})}var zv=a(47471);function qv(){const e=(0,ve.zL)(),{diagnosticsTab:t,tenantPage:a}=(0,ve.ix)((e=>e.tenant)),n=a===ge.m2.diagnostics&&t===ge.qQ.schema;return(0,d.jsx)("div",{children:!n&&(0,d.jsx)(Yr.z,{title:Mv("action_openInDiagnostics"),onClick:()=>{e((0,Se.Cs)(ge.m2.diagnostics)),e((0,Se.$v)(ge.qQ.schema))},size:"s",children:(0,d.jsx)(ft.J,{data:zv.Z,size:14})})})}var Uv=a(26714),Fv=a(8064);function Qv(){const e=_v();return(0,d.jsx)(bt.M,{title:"Refresh",children:(0,d.jsx)(Yr.z,{view:"flat-secondary",onClick:()=>{e((0,Fv.x0)())},children:(0,d.jsx)(ft.J,{data:Uv.Z})})})}const Gv=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:Boolean(localStorage.getItem(he.Mn))});function Bv(e){var t;let{type:a,subType:r,tenantName:s,path:o,onCollapseSummary:l,onExpandSummary:c,isCollapsed:u}=e;const[m]=(0,ve.Rj)(),p=(0,ve.zL)(),[,v]=(0,i.useQueryParam)("schema",i.StringParam),[x,g]=n.useReducer(qu(he.Mn),void 0,Gv),{summaryTab:y=ge.uw.overview}=(0,ve.ix)((e=>e.tenant)),b=(0,er.TH)(),S=La().parse(b.search,{ignoreQueryPrefix:!0}),{currentData:T}=ce.useGetOverviewQuery({path:o,database:s},{pollingInterval:m}),j=null===T||void 0===T||null===(t=T.PathDescription)||void 0===t?void 0:t.Self;n.useEffect((()=>{const e=H(a);!a||e||da.Cc.find((e=>e.id===y))||p((0,Se.Tu)(ge.uw.overview))}),[p,a,y]);const N=()=>{const e=H(a)?[...da.Cc,...da.c7]:da.Cc;return(0,d.jsx)("div",{className:kv("tabs"),children:(0,d.jsxs)(yt.k,{className:kv("tabs-inner"),justifyContent:"space-between",alignItems:"center",children:[(0,d.jsx)(ye.m,{size:"l",items:e,activeTab:y,wrapTo:(e,t)=>{let{id:a}=e;const n=(0,da.Sj)({...S,[da.XV.summaryTab]:a});return(0,d.jsx)(be.rU,{to:n,className:kv("tab"),children:t},a)},allowNotSelected:!0}),y===ge.uw.schema&&(0,d.jsx)(qv,{})]})})},C=()=>{switch(y){case ge.uw.acl:return(0,d.jsx)(dv,{path:o,database:s});case ge.uw.schema:return(0,d.jsx)(ca,{type:a,path:o,tenantName:s});default:return(()=>{var e;if(!j)return;const{CreateStep:t,PathType:a,PathSubType:r,PathId:i,PathVersion:s}=j,l=[],c=Sv(o,a)?"Domain":null===a||void 0===a?void 0:a.replace(/^EPathType/,"");l.push({name:Mv("field_type"),content:c}),r!==E.EPathSubTypeEmpty&&l.push({name:Mv("field_subtype"),content:null===r||void 0===r?void 0:r.replace(/^EPathSubType/,"")}),l.push({name:Mv("field_id"),content:i}),l.push({name:Mv("field_version"),content:s}),l.push({name:Mv("field_created"),content:(0,Ie.o0)(t)});const{PathDescription:u}=T;if(null!==u&&void 0!==u&&u.TableStats){const{DataSize:e,RowCount:t}=u.TableStats;l.push({name:Mv("field_data-size"),content:An(e)},{name:Mv("field_row-count"),content:(0,Ie.uf)(t)})}const m=()=>{var e;const{PathsInside:t,ShardsInside:a,PathsLimit:n,ShardsLimit:r}=null!==(e=null===u||void 0===u?void 0:u.DomainDescription)&&void 0!==e?e:{};let i=(0,Ie.uf)(t),s=(0,Ie.uf)(a);return i&&n&&(i=`${i} / ${(0,Ie.uf)(n)}`),s&&r&&(s=`${s} / ${(0,Ie.uf)(r)}`),[{name:Mv("field_paths"),content:i},{name:Mv("field_shards"),content:s}]},p={[f.EPathTypeInvalid]:void 0,[f.EPathTypeDir]:void 0,[f.EPathTypeTable]:()=>{var e;return[{name:Mv("field_partitions"),content:null===u||void 0===u||null===(e=u.TablePartitions)||void 0===e?void 0:e.length}]},[f.EPathTypeSubDomain]:m,[f.EPathTypeTableIndex]:void 0,[f.EPathTypeExtSubDomain]:m,[f.EPathTypeColumnStore]:()=>{var e,t;return[{name:Mv("field_partitions"),content:null===u||void 0===u||null===(e=u.ColumnStoreDescription)||void 0===e||null===(t=e.ColumnShards)||void 0===t?void 0:t.length}]},[f.EPathTypeColumnTable]:()=>{var e,t,a;return[{name:Mv("field_partitions"),content:null===u||void 0===u||null===(e=u.ColumnTableDescription)||void 0===e||null===(t=e.Sharding)||void 0===t||null===(a=t.ColumnShards)||void 0===a?void 0:a.length}]},[f.EPathTypeCdcStream]:()=>{const{Mode:e,Format:t}=(null===u||void 0===u?void 0:u.CdcStreamDescription)||{};return[{name:Mv("field_mode"),content:null===e||void 0===e?void 0:e.replace(/^ECdcStreamMode/,"")},{name:Mv("field_format"),content:null===t||void 0===t?void 0:t.replace(/^ECdcStreamFormat/,"")}]},[f.EPathTypePersQueueGroup]:()=>{var e,t,a;const n=null===u||void 0===u?void 0:u.PersQueueGroup,r=null===n||void 0===n||null===(e=n.PQTabletConfig)||void 0===e||null===(t=e.PartitionConfig)||void 0===t?void 0:t.LifetimeSeconds;return[{name:Mv("field_partitions"),content:null===n||void 0===n||null===(a=n.Partitions)||void 0===a?void 0:a.length},{name:Mv("field_retention"),content:r&&(0,Ie.xh)(r)}]},[f.EPathTypeExternalTable]:()=>{var e,t;const a=(0,Re.vF)({...S,schema:null===u||void 0===u||null===(e=u.ExternalTableDescription)||void 0===e?void 0:e.DataSourcePath}),{SourceType:n,DataSourcePath:r}=(null===u||void 0===u?void 0:u.ExternalTableDescription)||{},i=(null===r||void 0===r||null===(t=r.match(/([^/]*)\/*$/))||void 0===t?void 0:t[1])||"";return[{name:Mv("field_source-type"),content:n},{name:Mv("field_data-source"),content:r&&(0,d.jsx)("span",{title:r,children:(0,d.jsx)(tr.j,{title:i||"",url:a})})}]},[f.EPathTypeExternalDataSource]:()=>{var e;return[{name:Mv("field_source-type"),content:null===u||void 0===u||null===(e=u.ExternalDataSourceDescription)||void 0===e?void 0:e.SourceType}]},[f.EPathTypeView]:void 0,[f.EPathTypeReplication]:()=>{var e;const t=null===u||void 0===u||null===(e=u.ReplicationDescription)||void 0===e?void 0:e.State;return t?[{name:Mv("field_state"),content:(0,d.jsx)(hr,{state:t})}]:[]}},h=a&&(null===(e=p[a])||void 0===e?void 0:e.call(p))||[];l.push(...h);const v=l.filter((e=>e.content)).map((e=>({...e,content:(0,d.jsx)("div",{className:kv("overview-item-content"),children:e.content}),multilineName:!0})));return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:kv("overview-title"),children:(0,d.jsx)(kr,{data:u})}),(0,d.jsx)(or.w,{items:v,responsive:!0,nameMaxWidth:150})]})})()}},w=()=>{g(ku.triggerCollapse)},P=()=>{g(ku.triggerExpand)},I=()=>{g(ku.clear)},D=Ev(o,s),_=()=>{const e=H(a)&&!W(r);return(0,d.jsxs)(n.Fragment,{children:[e&&xv(p,{setActivePath:v},"m")(o,"preview"),(0,d.jsx)(bn.m,{text:D,view:"flat-secondary",title:Mv("action_copySchemaPath")}),(0,d.jsx)(Fu,{onCollapse:w,onExpand:P,isCollapsed:x.collapsed,initialDirection:"bottom"})]})},R=()=>{const{Status:e,Reason:t}=null!==T&&void 0!==T?T:{};if(a){let e=a.replace("EPathType","");return Sv(o,a)&&(e="domain"),(0,d.jsx)("div",{className:kv("entity-type"),children:e})}let n;return e&&t&&(n=`${e}: ${t}`),(0,d.jsx)("div",{className:kv("entity-type",{error:!0}),children:(0,d.jsx)(qa.J,{content:n,offset:{left:0}})})};return(0,d.jsx)(Dv,{children:(0,d.jsxs)("div",{className:kv(),children:[(0,d.jsx)("div",{className:kv({hidden:u}),children:(0,d.jsxs)(h,{direction:"vertical",defaultSizePaneKey:he.wr,onSplitStartDragAdditional:I,triggerCollapse:x.triggerCollapse,triggerExpand:x.triggerExpand,minSize:[200,52],collapsedSizes:[100,0],children:[(0,d.jsx)(Lv,{tenantName:s,path:o}),(0,d.jsxs)("div",{className:kv("info"),children:[(0,d.jsxs)("div",{className:kv("sticky-top"),children:[(0,d.jsxs)("div",{className:kv("info-header"),children:[(0,d.jsxs)("div",{className:kv("info-title"),children:[R(),(0,d.jsx)("div",{className:kv("path-name"),children:D})]}),(0,d.jsx)("div",{className:kv("info-controls"),children:_()})]}),N()]}),(0,d.jsx)("div",{className:kv("overview-wrapper"),children:C()})]})]})}),(0,d.jsxs)(yt.k,{className:kv("actions"),gap:.5,children:[!u&&(0,d.jsx)(Qv,{}),(0,d.jsx)(Fu,{onCollapse:l,onExpand:c,isCollapsed:u,initialDirection:"left"})]})]})})}const $v=(0,c.cn)("tenant-page"),Vv=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:Boolean(localStorage.getItem(he.sO))});function Hv(e){var t;const[l]=(0,ve.Rj)(),[c,u]=n.useReducer(qu(he.sO),void 0,Vv),[{database:m,name:p,schema:v},x]=(0,i.useQueryParams)({database:i.StringParam,name:i.StringParam,schema:i.StringParam});n.useEffect((()=>{p&&!m&&x({database:p,name:void 0},"replaceIn")}),[m,p,x]);const y=null!==m&&void 0!==m?m:p;if(!y)throw new Error("Tenant name is not defined");const b=n.useRef();n.useEffect((()=>{if(b.current!==y){(async()=>{const{registerYQLCompletionItemProvider:e}=await a.e(633).then(a.bind(a,30633));e(y)})().catch(console.error),b.current=y}}),[y]);const f=(0,ve.zL)();n.useEffect((()=>{f((0,g.J)("tenant",{tenantName:y}))}),[y,f]);const E=null!==v&&void 0!==v?v:y,{currentData:S,error:T,isLoading:j}=ce.useGetOverviewQuery({path:E,database:y},{pollingInterval:l}),{PathType:N,PathSubType:C}=(null===S||void 0===S||null===(t=S.PathDescription)||void 0===t?void 0:t.Self)||{},w=(0,s.u)(T),[P,I]=n.useState(!0);P&&!j&&I(!1);const D=E||Mr("page.title");return(0,d.jsxs)("div",{className:$v(),children:[(0,d.jsx)(r.ql,{defaultTitle:`${D} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${D} \u2014 YDB Monitoring`}),(0,d.jsx)(o.s,{loading:P,children:(0,d.jsx)(s.S,{error:w?T:void 0,children:(0,d.jsxs)(h,{defaultSizePaneKey:he.z4,defaultSizes:[25,75],triggerCollapse:c.triggerCollapse,triggerExpand:c.triggerExpand,minSize:[36,200],onSplitStartDragAdditional:()=>{u(ku.clear)},children:[(0,d.jsx)(Bv,{type:N,subType:C,tenantName:y,path:E,onCollapseSummary:()=>{u(ku.triggerCollapse)},onExpandSummary:()=>{u(ku.triggerExpand)},isCollapsed:c.collapsed}),(0,d.jsx)("div",{className:$v("main"),children:(0,d.jsx)(Kh,{type:N,additionalTenantProps:e.additionalTenantProps,additionalNodesProps:e.additionalNodesProps,tenantName:y,path:E})})]})})})]})}},24960:()=>{},26759:()=>{},56272:()=>{}}]);