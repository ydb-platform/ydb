"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[4263],{65070:(e,t,s)=>{s.d(t,{U:()=>d});var i=s(68963),o=s(17176),n=s(68330),a=s(86793),l=s(45743),r=s(75859);function d(e){let{children:t,onConfirmAction:s,onConfirmActionSuccess:d,dialogHeader:c,dialogText:u,retryButtonText:m,buttonDisabled:p=!1,buttonView:h="action",buttonClassName:v,withPopover:g=!1,popoverContent:b,popoverPlacement:D="right",popoverDisabled:k=!0}=e;const[x,y]=i.useState(!1),[f,j]=i.useState(!1),[S,N]=i.useState(!1),w=()=>(0,r.jsx)(o.z,{onClick:()=>y(!0),view:h,disabled:p,loading:!p&&f,className:v,children:t});return(0,r.jsxs)(i.Fragment,{children:[(0,r.jsx)(a.g,{visible:x,header:c,text:u,withRetry:S,retryButtonText:m,onConfirm:async e=>{j(!0),await s(e)},onConfirmActionSuccess:async()=>{N(!1);try{await(null===d||void 0===d?void 0:d())}finally{j(!1)}},onConfirmActionError:e=>{N((0,l.q)(e)),j(!1)},onClose:()=>{y(!1)}}),g?(0,r.jsx)(n.J,{content:b,placement:D,disabled:k,children:w()}):w()]})}},94790:(e,t,s)=>{s.d(t,{f:()=>a});var i=s(68963),o=s(44920),n=s(75859);const a=e=>{let{children:t,content:s,className:a,pinOnClick:l,hasArrow:r=!0,placement:d=["top","bottom"],...c}=e;const[u,m]=i.useState(!1),[p,h]=i.useState(!1),v=i.useRef(null);return(0,n.jsxs)(i.Fragment,{children:[(0,n.jsx)(o.G,{anchorRef:v,open:p||u,placement:d,hasArrow:r,onOutsideClick:()=>{h(!1)},...c,children:s}),(0,n.jsx)("span",{className:a,ref:v,onClick:l?()=>{h(!0)}:void 0,onMouseEnter:()=>{m(!0)},onMouseLeave:()=>{m(!1)},children:t})]})}},86793:(e,t,s)=>{s.d(t,{g:()=>g});var i=s(68963),o=s(76506),n=s(71586),a=s(48897),l=s(25822),r=s(88776),d=s(24362),c=s(30817);const u=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),m=(0,c.wZ)("ydb-critical-action-dialog",{en:u});var p=s(75859);const h=(0,d.cn)("ydb-critical-dialog"),v=e=>403===e.status?m("no-rights-error"):e.statusText?e.statusText:m("default-error");function g(e){let{visible:t,header:s,text:d,withRetry:c,retryButtonText:u,withCheckBox:g,onClose:b,onConfirm:D,onConfirmActionSuccess:k,onConfirmActionError:x}=e;const[y,f]=i.useState(!1),[j,S]=i.useState(),[N,w]=i.useState(!1),I=async e=>(f(!0),D(e).then((()=>{k(),b()})).catch((e=>{x(e),S(e)})).finally((()=>{f(!1)})));return(0,p.jsx)(l.V,{open:t,hasCloseButton:!1,className:h(),size:"s",onClose:b,onTransitionExited:()=>{S(void 0),w(!1)},children:j?(0,p.jsxs)(i.Fragment,{children:[(0,p.jsx)(l.V.Header,{caption:s}),(0,p.jsx)(l.V.Body,{className:h("body"),children:(0,p.jsxs)("div",{className:h("body-message",{error:!0}),children:[(0,p.jsx)("span",{className:h("error-icon"),children:(0,p.jsx)(o.Z,{width:"24",height:"22"})}),v(j)]})}),(0,p.jsx)(l.V.Footer,{loading:!1,preset:"default",textButtonApply:c?u||m("button-retry"):void 0,textButtonCancel:m("button-close"),onClickButtonApply:()=>I(!0),onClickButtonCancel:b})]}):(0,p.jsxs)(i.Fragment,{children:[(0,p.jsx)(l.V.Header,{caption:s}),(0,p.jsxs)(l.V.Body,{className:h("body"),children:[(0,p.jsxs)("div",{className:h("body-message",{warning:!0}),children:[(0,p.jsx)("span",{className:h("warning-icon"),children:(0,p.jsx)(r.J,{data:n.Z,size:24})}),d]}),g?(0,p.jsx)(a.X,{checked:N,onUpdate:w,children:m("checkbox-text")}):null]}),(0,p.jsx)(l.V.Footer,{loading:y,preset:"default",textButtonApply:m("button-confirm"),textButtonCancel:m("button-cancel"),propsButtonApply:{type:"submit",disabled:g&&!N},onClickButtonCancel:b,onClickButtonApply:()=>I()})]})})}},45743:(e,t,s)=>{s.d(t,{q:()=>i});const i=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},30832:(e,t,s)=>{s.d(t,{a:()=>l});var i=s(24362),o=s(98366),n=s(75859);const a=(0,i.cn)("ydb-entity-page-title");function l(e){let{entityName:t,status:s,id:i,className:l}=e;return(0,n.jsxs)("div",{className:a(null,l),children:[(0,n.jsx)("span",{className:a("prefix"),children:t}),(0,n.jsx)(o.J,{className:a("icon"),status:s,size:"s"}),i]})}},91816:(e,t,s)=>{s.d(t,{b:()=>c});var i=s(68963),o=s(56711),n=s(24362),a=s(42587),l=s(75859);const r=(0,n.cn)("ydb-info-viewer-skeleton"),d=()=>(0,l.jsxs)("div",{className:r("label"),children:[(0,l.jsx)(o.O,{className:r("label__text")}),(0,l.jsx)("div",{className:r("label__dots")})]}),c=e=>{let{rows:t=8,className:s,delay:n=600}=e;const[c]=(0,a.$)(n);let u=(0,l.jsxs)(i.Fragment,{children:[(0,l.jsx)(d,{}),(0,l.jsx)(o.O,{className:r("value")})]});return c||(u=null),(0,l.jsx)("div",{className:r(null,s),children:[...new Array(t)].map(((e,t)=>(0,l.jsx)("div",{className:r("row"),children:u},`skeleton-row-${t}`)))})}},8659:(e,t,s)=>{s.d(t,{P:()=>y});var i=s(77796),o=s(54665),n=s(14146),a=s(5922),l=s(81854),r=s(24362),d=s(34301),c=s(48169),u=s(17096),m=s(69214),p=s(23373),h=s(32270),v=s(67359),g=s(30817);const b=JSON.parse('{"type":"Type","path":"Path","guid":"GUID","serial-number":"Serial Number","shared-with-os":"SharedWithOs","drive-status":"Drive Status","state":"State","device":"Device","realtime":"Realtime","space":"Space","slots":"Slots","log-size":"Log Size","system-size":"System Size","links":"Links","developer-ui":"Developer UI","pdisk-page":"PDisk page","yes":"Yes"}'),D=(0,g.wZ)("ydb-pDisk-info",{en:b});var k=s(75859);const x=(0,r.cn)("ydb-pdisk-info");function y(e){let{pDisk:t,nodeId:s,withPDiskPageLink:r,className:g}=e;const b=(0,u.ix)(n.VH),[y,f,j,S]=function(e){let{pDisk:t,nodeId:s,withPDiskPageLink:i,isUserAllowedToMakeChanges:n}=e;const{PDiskId:r,Path:u,Guid:p,Category:g,Type:b,Device:y,Realtime:f,State:j,SerialNumber:S,TotalSize:N,AllocatedSize:w,StatusV2:I,NumActiveSlots:C,ExpectedSlotCount:T,LogUsedSize:P,LogTotalSize:E,SystemSize:z,SharedWithOs:M}=t||{},A=[];(0,a.D)(g)&&A.push({label:D("type"),value:b}),(0,a.D)(u)&&A.push({label:D("path"),value:u}),(0,a.D)(p)&&A.push({label:D("guid"),value:p}),S&&A.push({label:D("serial-number"),value:S}),(0,a.D)(M)&&A.push({label:D("shared-with-os"),value:D("yes")});const O=[];(0,a.D)(I)&&O.push({label:D("drive-status"),value:I}),(0,a.D)(j)&&O.push({label:D("state"),value:j}),(0,a.D)(y)&&O.push({label:D("device"),value:(0,k.jsx)(m.A,{status:y})}),(0,a.D)(f)&&O.push({label:D("realtime"),value:(0,k.jsx)(m.A,{status:f})});const _=[];_.push({label:D("space"),value:(0,k.jsx)(v.y,{value:w,capacity:N,formatValues:d.q3,colorizeProgress:!0})}),(0,a.D)(C)&&(0,a.D)(T)&&_.push({label:D("slots"),value:(0,k.jsx)(v.y,{value:C,capacity:T})}),(0,a.D)(P)&&(0,a.D)(E)&&_.push({label:D("log-size"),value:(0,k.jsx)(v.y,{value:P,capacity:E,formatValues:d.q3})}),(0,a.D)(z)&&_.push({label:D("system-size"),value:(0,l.td)({value:z})});const V=[];if((i||n)&&(0,a.D)(r)&&(0,a.D)(s)){const e=(0,o.ds)(r,s),t=(0,c.ok)({nodeId:s,pDiskId:r});V.push({label:D("links"),value:(0,k.jsxs)("span",{className:x("links"),children:[i&&(0,k.jsx)(h.j,{title:D("pdisk-page"),url:e,external:!1}),n&&(0,k.jsx)(h.j,{title:D("developer-ui"),url:t})]})})}return[A,O,_,V]}({pDisk:t,nodeId:s,withPDiskPageLink:r,isUserAllowedToMakeChanges:b});return(0,k.jsxs)(i.k,{className:g,gap:2,direction:"row",wrap:!0,children:[(0,k.jsxs)(i.k,{direction:"column",gap:2,width:500,children:[(0,k.jsx)(p._,{info:y,renderEmptyState:()=>null}),(0,k.jsx)(p._,{info:j,renderEmptyState:()=>null})]}),(0,k.jsxs)(i.k,{direction:"column",gap:2,width:500,children:[(0,k.jsx)(p._,{info:f,renderEmptyState:()=>null}),(0,k.jsx)(p._,{info:S,renderEmptyState:()=>null})]})]})}},27174:(e,t,s)=>{s.d(t,{B:()=>m});var i=s(77796),o=s(24362),n=s(50422),a=s(56711),l=s(42587),r=s(75859);const d=e=>{let{delay:t=600,className:s}=e;const[i]=(0,l.$)(t);return i?(0,r.jsx)(a.O,{className:s}):null},c=(0,o.cn)("ydb-page-meta");function u(e){let{items:t,loading:s}=e;return(0,r.jsx)("div",{className:c("info"),children:s?(0,r.jsx)(d,{className:c("skeleton")}):t.filter((e=>Boolean(e))).join("\xa0\xa0\xb7\xa0\xa0")})}function m(e){let{className:t,...s}=e;return(0,r.jsxs)(i.k,{gap:1,alignItems:"center",justifyContent:"space-between",className:c(null,t),children:[(0,r.jsx)(u,{...s}),(0,r.jsx)(n.q,{})]})}},22200:(e,t,s)=>{s.d(t,{K:()=>y});s(68963);var i=s(54665),o=s(14146),n=s(5922),a=s(24362),l=s(34301),r=s(48169),d=s(92666),c=s(17096),u=s(55850),m=s(69214),p=s(62206),h=s(32270),v=s(67359),g=s(30817);const b=JSON.parse('{"slot-id":"VDisk Slot Id","pool-name":"Storage Pool Name","kind":"Kind","guid":"GUID","incarnation-guid":"Incarnation GUID","instance-guid":"Instance GUID","replication-status":"Replicated","state-status":"VDisk State","space-status":"Disk Space","fresh-rank-satisfaction":"Fresh Rank Satisfaction","level-rank-satisfaction":"Level Rank Satisfaction","front-queues":"Front Queues","has-unreadable-blobs":"Has Unreadable Blobs","size":"Size","read-throughput":"Read Throughput","write-throughput":"Write Throughput","links":"Links","vdisk-page":"VDisk Page","developer-ui":"Developer UI","yes":"Yes","no":"No","vdiks-title":"VDisk"}'),D=(0,g.wZ)("ydb-vDisk-info",{en:b});var k=s(75859);const x=(0,a.cn)("ydb-vdisk-info");function y(e){var t,s;let{data:a,withVDiskPageLink:d,withTitle:g,...b}=e;const y=(0,c.ix)(o.VH),{AllocatedSize:j,DiskSpace:S,FrontQueues:N,Guid:w,Replicated:I,VDiskState:C,VDiskSlotId:T,Kind:P,SatisfactionRank:E,AvailableSize:z,HasUnreadableBlobs:M,IncarnationGuid:A,InstanceGuid:O,StoragePoolName:_,ReadThroughput:V,WriteThroughput:R,PDiskId:B,NodeId:L}=a||{},U=[];var F,H;((0,n.D)(T)&&U.push({label:D("slot-id"),value:T}),(0,n.D)(_)&&U.push({label:D("pool-name"),value:_}),(0,n.D)(C)&&U.push({label:D("state-status"),value:C}),Number(j)>=0&&Number(z)>=0&&U.push({label:D("size"),value:(0,k.jsx)(v.y,{value:j,capacity:Number(j)+Number(z),formatValues:l.q3,colorizeProgress:!0})}),(0,n.D)(P)&&U.push({label:D("kind"),value:P}),(0,n.D)(w)&&U.push({label:D("guid"),value:w}),(0,n.D)(A)&&U.push({label:D("incarnation-guid"),value:A}),(0,n.D)(O)&&U.push({label:D("instance-guid"),value:O}),(0,n.D)(I)&&U.push({label:D("replication-status"),value:D(I?"yes":"no")}),(0,n.D)(S)&&U.push({label:D("space-status"),value:(0,k.jsx)(m.A,{status:S})}),(0,n.D)(null===E||void 0===E||null===(t=E.FreshRank)||void 0===t?void 0:t.Flag))&&U.push({label:D("fresh-rank-satisfaction"),value:(0,k.jsx)(m.A,{status:null===E||void 0===E||null===(F=E.FreshRank)||void 0===F?void 0:F.Flag})});(0,n.D)(null===E||void 0===E||null===(s=E.LevelRank)||void 0===s?void 0:s.Flag)&&U.push({label:D("level-rank-satisfaction"),value:(0,k.jsx)(m.A,{status:null===E||void 0===E||null===(H=E.LevelRank)||void 0===H?void 0:H.Flag})});(0,n.D)(N)&&U.push({label:D("front-queues"),value:(0,k.jsx)(m.A,{status:N})}),(0,n.D)(M)&&U.push({label:D("has-unreadable-blobs"),value:D(M?"yes":"no")}),(0,n.D)(V)&&U.push({label:D("read-throughput"),value:(0,u.Qt)(V)}),(0,n.D)(R)&&U.push({label:D("write-throughput"),value:(0,u.Qt)(R)});if((0,n.D)(B)&&(0,n.D)(L)&&(0,n.D)(T)){const e=[];if(d){const t=(0,i.By)(T,B,L);e.push((0,k.jsx)(h.j,{title:D("vdisk-page"),url:t,external:!1},t))}if(y){const t=(0,r.yf)({nodeId:L,pDiskId:B,vDiskSlotId:T});e.push((0,k.jsx)(h.j,{title:D("developer-ui"),url:t},t))}e.length&&U.push({label:D("links"),value:(0,k.jsx)("div",{className:x("links"),children:e})})}const q=a&&g?(0,k.jsx)(f,{data:a}):null;return(0,k.jsx)(p._P,{info:U,title:q,...b})}function f(e){let{data:t}=e;return(0,k.jsxs)("div",{className:x("title"),children:[D("vdiks-title"),(0,k.jsx)(m.A,{status:(0,d.b2)(t.Severity),name:(0,l.a2)(t.VDiskId)})]})}},64263:(e,t,s)=>{s.r(t),s.d(t,{PDiskPage:()=>xe});var i=s(68963),o=s(3475),n=s(88776),a=s(8179),l=s(17095),r=s(49352),d=s(52846),c=s(95408),u=s(65070),m=s(30832),p=s(26688),h=s(91816),v=s(68036),g=s(8659),b=s(27174),D=s(54665),k=s(905),x=s(14146),y=s(17880),f=s(79061),j=s(92666),S=s(29326),N=s(5922),w=s(3764),I=s(51688);const C=k.h.injectEndpoints({endpoints:e=>({getPdiskInfo:e.query({queryFn:async(e,t)=>{let{nodeId:s,pDiskId:i}=e,{signal:o,getState:n,dispatch:a}=t;let l;l=await(0,S.AE)("/pdisk/info",{getState:n,dispatch:a})>0?window.api.getPDiskInfo({nodeId:s,pDiskId:i},{signal:o}):window.api.getNodeWhiteboardPDiskInfo({nodeId:s,pDiskId:i},{signal:o}).then((e=>e.PDiskStateInfo?{Whiteboard:{PDisk:{...e.PDiskStateInfo[0],ExpectedSlotCount:void 0}}}:{}));try{const e=function(e){var t,s,i;let[o={},n]=e;const{BSC:a={},Whiteboard:l={}}=o||{},{PDisk:r={},VDisks:d=[]}=l,{PDisk:c={}}=a,u=(0,w.b)(r,c),{LogUsedSize:m,LogTotalSize:p,TotalSize:h,SystemSize:v,ExpectedSlotCount:g,EnforcedDynamicSlotSize:b}=u;let D;(0,N.D)(p)&&(D={SlotType:"log",Used:Number(m),Total:Number(p),UsagePercent:100*Number(m)/Number(p),Severity:1,SlotData:{LogUsedSize:m,LogTotalSize:p,SystemSize:v}});const k=d.map(w.w).sort(((e,t)=>Number(t.VDiskSlotId)-Number(e.VDiskSlotId))).map((e=>{var t;return{SlotType:"vDisk",Id:null===(t=e.VDiskId)||void 0===t?void 0:t.GroupID,Title:e.StoragePoolName,Severity:e.Severity,Used:Number(e.AllocatedSize),Total:Number(e.TotalSize),UsagePercent:e.AllocatedPercent,SlotData:e}}));let x=[];if(g&&g>k.length){const e=g-k.length;let t=Number(b);if(isNaN(t)){const s=k.reduce(((e,t)=>t.Total?e+t.Total:e),0);t=(Number(h)-s-Number(p))/e}x=(0,N.c$)(e).map((()=>({SlotType:"empty",Total:t,Severity:1,SlotData:{Size:t}})))}const y=[...k,...x];D&&y.length>0&&y.unshift(D);const f=null===(t=n.SystemStateInfo)||void 0===t?void 0:t[0],j=(0,I.Ns)(f);return{...u,NodeId:null!==(s=u.NodeId)&&void 0!==s?s:j.NodeId,NodeHost:j.Host,NodeType:null===(i=j.Roles)||void 0===i?void 0:i[0],NodeDC:j.DC,SlotItems:y}}(await Promise.all([l,window.api.getNodeInfo(s,{signal:o})]));return{data:e}}catch(r){return{error:r}}},providesTags:(e,t,s)=>["All",{type:"PDiskData",id:(0,j.CH)(s.nodeId,s.pDiskId)}]})}),overrideExisting:"throw"});var T=s(24362),P=s(17096),E=s(45578),z=s(57542),M=s(30831),A=s(68330),O=s(17176),_=s(86793),V=s(45743),R=s(30817);const B=JSON.parse('{"fqdn":"FQDN","pdisk":"PDisk","node":"Node","storage":"Storage","disk-distribution":"Disk distribution","empty-slot":"Empty slot","log":"Log","label.log-size":"Log Size","label.system-size":"System Size","label.slot-size":"Slot Size","no-slots-data":"No slots data","restart-pdisk-button":"Restart PDisk","force-restart-pdisk-button":"Restart anyway","restart-pdisk-not-allowed":"You don\'t have enough rights to restart PDisk","restart-pdisk-dialog-header":"Restart PDisk","restart-pdisk-dialog-text":"PDisk will be restarted. Do you want to proceed?","decommission-none":"None","decommission-imminent":"Imminent","decommission-pending":"Pending","decommission-rejected":"Rejected","decommission-label":"{{decommission}} decommission","decommission-button":"Decommission","decommission-change-not-allowed":"You don\'t have enough rights to change PDisk decommission","decommission-dialog-title":"Change decommission status","decommission-dialog-force-change":"Change anyway","decommission-dialog-imminent-warning":"This will start imminent decommission. Existing slots will be moved from the disk","decommission-dialog-pending-warning":"This will start pending decommission. Decommission will be planned for this disk, but will not start immediatelly. Existing slots will not be moved from the disk, but no new slots will be allocated on it","decommission-dialog-rejected-warning":"This will start rejected decommission. No slots from other disks are placed on this disk in the process of decommission","decommission-dialog-none-warning":"This will reset decommission mode, allowing the disk to  be used by the storage"}'),L=(0,R.wZ)("ydb-pDisk-page",{en:B});var U,F,H,q;function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},G.apply(this,arguments)}const J=function(e){return i.createElement("svg",G({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 17 17",fill:"none"},e),U||(U=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.378 7.771c.717 0 1.298.614 1.298 1.372v.914c0 .758-.581 1.372-1.298 1.372H3.46c-.716 0-1.297-.614-1.297-1.372v-.914c0-.758.58-1.372 1.297-1.372h6.92zm.77-1.248L9.935 3.958a1.292 1.292 0 00-1.16-.758H5.063c-.491 0-.94.294-1.16.758L2.69 6.523c.243-.08.501-.123.77-.123h6.918c.268 0 .527.043.77.123zm1.825 1.87V10.057c0 1.515-1.162 2.743-2.595 2.743H3.46c-1.433 0-2.594-1.228-2.594-2.743V8.393c0-.71.156-1.41.456-2.044l1.421-3.004c.44-.93 1.338-1.516 2.32-1.516h3.713c.982 0 1.88.587 2.32 1.516l1.421 3.004c.3.635.457 1.335.457 2.044zm-5.19.521c-.358 0-.648.307-.648.686 0 .379.29.686.649.686h2.162c.358 0 .649-.307.649-.686 0-.379-.29-.686-.65-.686H7.785z",fill:"currentColor",fillOpacity:.85})),F||(F=i.createElement("path",{d:"M15.25 11.428c0 2.15-1.639 3.822-3.574 3.822-1.935 0-3.574-1.671-3.574-3.822 0-2.15 1.639-3.821 3.574-3.821 1.935 0 3.574 1.671 3.574 3.821z",fill:"var(--g-color-base-background)",stroke:"currentColor",strokeWidth:1.5})),H||(H=i.createElement("path",{d:"M11.676 16.5c2.69 0 4.824-2.297 4.824-5.072 0-2.774-2.134-5.071-4.824-5.071s-4.824 2.297-4.824 5.071c0 2.775 2.134 5.072 4.824 5.072z",stroke:"var(--g-color-base-background)"})),q||(q=i.createElement("path",{d:"M12.973 10.057L10.378 12.8m0-2.743l2.595 2.743",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var $=s(75859);const W=(0,T.cn)("ydb-pdisk-decommission-button");function Z(e){return"DECOMMIT_IMMINENT"===e?L("decommission-dialog-imminent-warning"):"DECOMMIT_PENDING"===e?L("decommission-dialog-pending-warning"):"DECOMMIT_REJECTED"===e?L("decommission-dialog-rejected-warning"):"DECOMMIT_NONE"===e?L("decommission-dialog-none-warning"):void 0}function Q(e){let{decommission:t,onConfirmAction:s,onConfirmActionSuccess:o,buttonDisabled:n,popoverDisabled:a}=e;const[l,r]=i.useState(),[d,c]=i.useState(!1),[u,m]=i.useState(!1),p=function(e,t){return[{text:L("decommission-none"),action:()=>t("DECOMMIT_NONE"),hidden:!e||"DECOMMIT_NONE"===e||"DECOMMIT_UNSET"===e},{text:L("decommission-pending"),action:()=>t("DECOMMIT_PENDING"),hidden:"DECOMMIT_PENDING"===e},{text:L("decommission-rejected"),action:()=>t("DECOMMIT_REJECTED"),hidden:"DECOMMIT_REJECTED"===e},{text:L("decommission-imminent"),theme:"danger",action:()=>t("DECOMMIT_IMMINENT"),hidden:"DECOMMIT_IMMINENT"===e}]}(t,r);return(0,$.jsxs)(i.Fragment,{children:[(0,$.jsx)(M.h,{renderSwitcher:e=>(0,$.jsx)(Y,{popoverDisabled:a,loading:d,disabled:n,...e}),items:p,popupProps:{className:W("popup")}}),(0,$.jsx)(_.g,{visible:Boolean(l),header:L("decommission-dialog-title"),text:Z(l),withRetry:u,withCheckBox:!0,retryButtonText:L("decommission-dialog-force-change"),onConfirm:async e=>{c(!0),await s(l,e)},onConfirmActionSuccess:async()=>{m(!1),await(0,N.Dc)(5e3);try{await o()}finally{c(!1)}},onConfirmActionError:e=>{m((0,V.q)(e)),c(!1)},onClose:()=>{r(void 0)}})]})}function Y(e){let{popoverDisabled:t,...s}=e;return(0,$.jsx)(A.J,{content:L("decommission-change-not-allowed"),placement:"right",disabled:t,children:(0,$.jsxs)(O.z,{view:"normal",className:W("button"),...s,children:[(0,$.jsx)(n.J,{data:J}),L("decommission-button"),(0,$.jsx)(n.J,{data:z.Z})]})})}var K=s(14979);function X(e){return L("decommission-label",{decommission:e})}function ee(e){let{decommission:t}=e;return"DECOMMIT_IMMINENT"===t?(0,$.jsx)(K._,{theme:"danger",size:"m",children:X(L("decommission-imminent"))}):"DECOMMIT_PENDING"===t?(0,$.jsx)(K._,{theme:"warning",size:"m",children:X(L("decommission-pending"))}):"DECOMMIT_REJECTED"===t?(0,$.jsx)(K._,{theme:"normal",size:"m",children:X(L("decommission-rejected"))}):null}var te=s(94790),se=s(1796),ie=s(62206),oe=s(74170),ne=s(67359),ae=s(22200),le=s(81854),re=s(34301);const de=(0,T.cn)("ydb-pdisk-space-distribution"),ce=40;function ue(e){let{data:t}=e;const{SlotItems:s}=t,{PDiskId:i,NodeId:o}=t,n=ce*((null===s||void 0===s?void 0:s.length)||1);return null!==s&&void 0!==s&&s.length?(0,$.jsx)("div",{className:de(null),style:{height:n,minHeight:n},children:(0,$.jsx)(se.p,{className:de("pdisk-bar"),severity:t.Severity,diskAllocatedPercent:t.AllocatedPercent,content:null===s||void 0===s?void 0:s.map(((e,t)=>(0,$.jsx)(me,{item:e,pDiskId:i,nodeId:o},t))),faded:!0})}):L("no-slots-data")}function me(e){let{item:t,pDiskId:s,nodeId:i}=e;return(0,$.jsx)("div",{className:de("slot-wrapper"),style:{flexGrow:Number(t.Total)||1},children:(()=>{if("vDisk"===t.SlotType){var e;const o=(0,N.D)(null===(e=t.SlotData)||void 0===e?void 0:e.VDiskSlotId)&&(0,N.D)(s)&&(0,N.D)(i)?(0,D.By)(t.SlotData.VDiskSlotId,s,i):void 0;return(0,$.jsx)(te.f,{content:(0,$.jsx)(ae.K,{data:t.SlotData,withTitle:!0}),contentClassName:de("vdisk-popup"),placement:["right","top"],children:(0,$.jsx)(oe.h,{to:o,children:(0,$.jsx)(se.p,{className:de("slot"),severity:t.Severity,diskAllocatedPercent:t.UsagePercent,content:(0,$.jsx)(pe,{id:t.Id,title:t.Title,used:t.Used,total:t.Total})})})})}return function(e){return"log"===e.SlotType}(t)?(0,$.jsx)(te.f,{content:(0,$.jsx)(he,{data:t.SlotData}),contentClassName:de("vdisk-popup"),placement:["right","top"],children:(0,$.jsx)(se.p,{className:de("slot"),severity:t.Severity,diskAllocatedPercent:t.UsagePercent,content:(0,$.jsx)(pe,{title:L("log"),used:t.Used,total:t.Total})})}):function(e){return"empty"===e.SlotType}(t)?(0,$.jsx)(te.f,{content:(0,$.jsx)(ve,{data:t.SlotData}),contentClassName:de("vdisk-popup"),placement:["right","top"],children:(0,$.jsx)(se.p,{className:de("slot"),severity:t.Severity,empty:!0,content:(0,$.jsx)(pe,{title:L("empty-slot"),used:t.Total})})}):null})()})}function pe(e){let{id:t,title:s,used:i,total:o}=e;return(0,$.jsxs)("div",{className:de("slot-content"),children:[(0,$.jsxs)("span",{children:[(0,N.D)(t)?(0,$.jsx)("span",{className:de("slot-id"),children:t}):null,s]}),(0,$.jsx)("span",{className:de("slot-size"),children:(()=>{const[e,t]=(0,re.q3)(i,o);return o?`${e} / ${t}`:e})()})]})}function he(e){let{data:t}=e;const{LogTotalSize:s,LogUsedSize:i,SystemSize:o}=t,n=[{label:L("label.log-size"),value:(0,$.jsx)(ne.y,{value:i,capacity:s,formatValues:re.q3})}];return(0,N.D)(o)&&n.push({label:L("label.system-size"),value:(0,le.td)({value:o})}),(0,$.jsx)(ie._P,{title:L("log"),info:n})}function ve(e){let{data:t}=e;const{Size:s}=t,i=[{label:L("label.slot-size"),value:(0,le.td)({value:s})}];return(0,$.jsx)(ie._P,{title:L("empty-slot"),info:i})}const ge=(0,T.cn)("ydb-pdisk-page"),be={diskDistribution:"diskDistribution",storage:"storage"},De=[{id:be.diskDistribution,get title(){return L("disk-distribution")}},{id:be.storage,get title(){return L("storage")}}],ke=c.z.nativeEnum(be).catch(be.diskDistribution);function xe(){const e=(0,P.zL)(),t=(0,P.ix)(x.VH),s=(0,y.X_)(),[{nodeId:c,pDiskId:S,activeTab:w}]=(0,d.useQueryParams)({activeTab:d.StringParam,nodeId:d.StringParam,pDiskId:d.StringParam}),I=(0,N.D)(c)&&(0,N.D)(S),T=ke.parse(w);i.useEffect((()=>{e((0,f.J)("pDisk",{nodeId:c,pDiskId:S}))}),[e,c,S]);const[z]=(0,P.Rj)(),M=I?{nodeId:c,pDiskId:S}:l.CN,A=C.useGetPdiskInfoQuery(M,{pollingInterval:z}),O=A.isFetching&&void 0===A.currentData,_=A.currentData,{NodeHost:V,NodeId:R,NodeType:B,NodeDC:U,Severity:F,DecommitStatus:H}=_||{},q=async e=>{if(I){const t=await window.api[s?"restartPDisk":"restartPDiskOld"]({nodeId:c,pDiskId:S,force:e});if(!1===(null===t||void 0===t?void 0:t.result)){throw{statusText:t.error,retryPossible:t.forceRetryPossible}}}},G=async(e,t)=>{if(I){const s=await window.api.changePDiskStatus({nodeId:c,pDiskId:S,force:t,decommissionStatus:e});if(!1===(null===s||void 0===s?void 0:s.result)){throw{statusText:s.error,retryPossible:s.forceRetryPossible}}}},J=()=>{I&&e(k.h.util.invalidateTags([{type:"PDiskData",id:(0,j.CH)(c,S)}]),"StorageData")};return(0,$.jsxs)("div",{className:ge(null),children:[(()=>{const e=S?`${L("pdisk")} ${S}`:L("pdisk"),t=V||L("node");return(0,$.jsx)(r.ql,{titleTemplate:`%s - ${e} \u2014 ${t} \u2014 YDB Monitoring`,defaultTitle:`${e} \u2014 ${t} \u2014 YDB Monitoring`})})(),(()=>{const e=V?`${L("fqdn")}: ${V}`:void 0,t=R?`${L("node")}: ${R}`:void 0;return(0,$.jsx)(b.B,{loading:O,items:[e,t,B,U],className:ge("meta")})})(),(0,$.jsxs)("div",{className:ge("title"),children:[(0,$.jsx)(m.a,{entityName:L("pdisk"),status:(0,j.b2)(F),id:(0,j.CH)(c,S)}),(0,$.jsx)(ee,{decommission:H})]}),(0,$.jsxs)("div",{className:ge("controls"),children:[(0,$.jsxs)(u.U,{onConfirmAction:q,onConfirmActionSuccess:J,buttonDisabled:!I||!t,buttonView:"normal",dialogHeader:L("restart-pdisk-dialog-header"),dialogText:L("restart-pdisk-dialog-text"),retryButtonText:L("force-restart-pdisk-button"),withPopover:!0,popoverContent:L("restart-pdisk-not-allowed"),popoverDisabled:t,children:[(0,$.jsx)(n.J,{data:o.Z}),L("restart-pdisk-button")]}),s?(0,$.jsx)(Q,{decommission:H,onConfirmAction:G,onConfirmActionSuccess:J,buttonDisabled:!I||!t,popoverDisabled:t}):null]}),A.error?(0,$.jsx)(p.V,{error:A.error}):null,O?(0,$.jsx)(h.b,{className:ge("info"),rows:10}):(0,$.jsx)(g.P,{pDisk:_,nodeId:c,className:ge("info")}),(0,$.jsx)("div",{className:ge("tabs"),children:(0,$.jsx)(a.m,{size:"l",items:De,activeTab:T,wrapTo:(e,t)=>{let{id:s}=e;const i=I?(0,D.ds)(S,c,{activeTab:s}):void 0;return(0,$.jsx)(v.h,{to:i,children:t},s)}})}),(()=>{switch(T){case"diskDistribution":return _?(0,$.jsx)("div",{className:ge("disk-distribution"),children:(0,$.jsx)(ue,{data:_})}):null;case"storage":return I?(0,$.jsx)(E.K,{nodeId:c,pDiskId:S}):null;default:return null}})()]})}}}]);