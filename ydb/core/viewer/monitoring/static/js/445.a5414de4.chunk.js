"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[445],{14659:(e,t,a)=>{a.d(t,{U:()=>x});var s=a(68963),n=a(17176),i=a(68330),l=a(76506),o=a(71586),r=a(25822),d=a(88776),c=a(24362),u=a(30817);const v=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close"}'),p=(0,u.wZ)("ydb-critical-action-dialog",{en:v});var h=a(75859);const m=(0,c.cn)("ydb-critical-dialog"),b=e=>403===e.status?p("no-rights-error"):e.statusText?e.statusText:p("default-error");function g(e){let{visible:t,text:a,withRetry:n,retryButtonText:i,onClose:c,onConfirm:u,onConfirmActionSuccess:v,onConfirmActionError:g}=e;const[x,j]=s.useState(!1),[y,k]=s.useState(),f=async e=>(j(!0),u(e).then((()=>{v(),c()})).catch((e=>{g(e),k(e)})).finally((()=>{j(!1)})));return(0,h.jsx)(r.V,{open:t,hasCloseButton:!1,className:m(),size:"s",onClose:c,onTransitionExited:()=>k(void 0),children:y?(0,h.jsxs)(s.Fragment,{children:[(0,h.jsxs)(r.V.Body,{className:m("body"),children:[(0,h.jsx)("span",{className:m("error-icon"),children:(0,h.jsx)(l.Z,{width:"24",height:"22"})}),b(y)]}),(0,h.jsx)(r.V.Footer,{loading:!1,preset:"default",textButtonApply:n?i||p("button-retry"):void 0,textButtonCancel:p("button-close"),onClickButtonApply:()=>f(!0),onClickButtonCancel:c})]}):(0,h.jsxs)(s.Fragment,{children:[(0,h.jsxs)(r.V.Body,{className:m("body"),children:[(0,h.jsx)("span",{className:m("warning-icon"),children:(0,h.jsx)(d.J,{data:o.Z,size:24})}),a]}),(0,h.jsx)(r.V.Footer,{loading:x,preset:"default",textButtonApply:p("button-confirm"),textButtonCancel:p("button-cancel"),propsButtonApply:{type:"submit"},onClickButtonCancel:c,onClickButtonApply:()=>f()})]})})}function x(e){let{children:t,onConfirmAction:a,onConfirmActionSuccess:l,dialogContent:o,retryButtonText:r,buttonDisabled:d=!1,buttonView:c="action",buttonClassName:u,withPopover:v=!1,popoverContent:p,popoverPlacement:m="right",popoverDisabled:b=!0}=e;const[x,j]=s.useState(!1),[y,k]=s.useState(!1),[f,N]=s.useState(!1),D=()=>(0,h.jsx)(n.z,{onClick:()=>j(!0),view:c,disabled:d,loading:!d&&y,className:u,children:t});return(0,h.jsxs)(s.Fragment,{children:[(0,h.jsx)(g,{visible:x,text:o,withRetry:f,retryButtonText:r,onConfirm:async e=>{k(!0),await a(e),k(!1)},onConfirmActionSuccess:async()=>{if(N(!1),l){k(!0);try{await l()}catch{}finally{k(!1)}}},onConfirmActionError:e=>{const t=Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible);N(t),k(!1)},onClose:()=>{j(!1)}}),v?(0,h.jsx)(i.J,{content:p,placement:m,disabled:b,children:D()}):D()]})}},8659:(e,t,a)=>{a.d(t,{P:()=>k});var s=a(54665),n=a(14146),i=a(17880),l=a(5922),o=a(81854),r=a(24362),d=a(34301),c=a(48169),u=a(17096),v=a(69214),p=a(23373),h=a(32270),m=a(67359),b=a(30817);const g=JSON.parse('{"decomission-status":"Decomission Status","type":"Type","path":"Path","guid":"GUID","serial-number":"Serial Number","shared-with-os":"SharedWithOs","drive-status":"Drive Status","state":"State","device":"Device","realtime":"Realtime","space":"Space","slots":"Slots","log-size":"Log Size","system-size":"System Size","links":"Links","developer-ui":"Developer UI","pdisk-page":"PDisk page","yes":"Yes"}'),x=(0,b.wZ)("ydb-pDisk-info",{en:g});var j=a(75859);const y=(0,r.cn)("ydb-pdisk-info");function k(e){let{pDisk:t,nodeId:a,withPDiskPageLink:r,className:b}=e;const g=(0,u.ix)(n.VH),k=(0,i.X_)(),[f,N,D,I]=function(e){let{pDisk:t,nodeId:a,withPDiskPageLink:n,isUserAllowedToMakeChanges:i}=e;const{PDiskId:r,Path:u,Guid:p,Category:b,Type:g,Device:k,Realtime:f,State:N,SerialNumber:D,TotalSize:I,AllocatedSize:S,DecommitStatus:w,StatusV2:T,NumActiveSlots:P,ExpectedSlotCount:C,LogUsedSize:V,LogTotalSize:z,SystemSize:A,SharedWithOs:R}=t||{},q=[];(0,l.D)(w)&&q.push({label:x("decomission-status"),value:w.replace("DECOMMIT_","")}),(0,l.D)(b)&&q.push({label:x("type"),value:g}),(0,l.D)(u)&&q.push({label:x("path"),value:u}),(0,l.D)(p)&&q.push({label:x("guid"),value:p}),D&&q.push({label:x("serial-number"),value:D}),(0,l.D)(R)&&q.push({label:x("shared-with-os"),value:x("yes")});const F=[];(0,l.D)(T)&&F.push({label:x("drive-status"),value:T}),(0,l.D)(N)&&F.push({label:x("state"),value:N}),(0,l.D)(k)&&F.push({label:x("device"),value:(0,j.jsx)(v.A,{status:k})}),(0,l.D)(f)&&F.push({label:x("realtime"),value:(0,j.jsx)(v.A,{status:f})});const E=[];E.push({label:x("space"),value:(0,j.jsx)(m.y,{value:S,capacity:I,formatValues:d.q3,colorizeProgress:!0})}),(0,l.D)(P)&&(0,l.D)(C)&&E.push({label:x("slots"),value:(0,j.jsx)(m.y,{value:P,capacity:C})}),(0,l.D)(V)&&(0,l.D)(z)&&E.push({label:x("log-size"),value:(0,j.jsx)(m.y,{value:V,capacity:z,formatValues:d.q3})}),(0,l.D)(A)&&E.push({label:x("system-size"),value:(0,o.td)({value:A})});const L=[];if((n||i)&&(0,l.D)(r)&&(0,l.D)(a)){const e=(0,s.ds)(r,a),t=(0,c.ok)({nodeId:a,pDiskId:r});L.push({label:x("links"),value:(0,j.jsxs)("span",{className:y("links"),children:[n&&(0,j.jsx)(h.j,{title:x("pdisk-page"),url:e,external:!1}),i&&(0,j.jsx)(h.j,{title:x("developer-ui"),url:t})]})})}return[q,F,E,L]}({pDisk:t,nodeId:a,withPDiskPageLink:r&&k,isUserAllowedToMakeChanges:g});return(0,j.jsxs)("div",{className:y("wrapper",b),children:[(0,j.jsxs)("div",{className:y("col"),children:[(0,j.jsx)(p._,{info:f,renderEmptyState:()=>null}),(0,j.jsx)(p._,{info:D,renderEmptyState:()=>null})]}),(0,j.jsxs)("div",{className:y("col"),children:[(0,j.jsx)(p._,{info:N,renderEmptyState:()=>null}),(0,j.jsx)(p._,{info:I,renderEmptyState:()=>null})]})]})}},97482:(e,t,a)=>{a.d(t,{f:()=>l});var s=a(14979),n=a(83496),i=a(75859);function l(e){let{state:t}=e;return(0,i.jsx)(s._,{theme:(0,n.KR)(t),children:t})}},12199:(e,t,a)=>{a.d(t,{$:()=>r});var s=a(24362),n=a(75859);const i=(0,s.cn)("tag"),l=e=>{let{text:t,type:a}=e;return(0,n.jsx)("div",{className:i({type:a}),children:t})},o=(0,s.cn)("tags"),r=e=>{let{tags:t,tagsType:a,className:s=""}=e;return(0,n.jsx)("div",{className:o(null,s),children:t&&t.map(((e,t)=>(0,n.jsx)(l,{text:e,type:a},t)))})}},22200:(e,t,a)=>{a.d(t,{K:()=>f});a(68963);var s=a(54665),n=a(14146),i=a(17880),l=a(5922),o=a(24362),r=a(34301),d=a(48169),c=a(92666),u=a(17096),v=a(55850),p=a(69214),h=a(62206),m=a(32270),b=a(67359),g=a(30817);const x=JSON.parse('{"slot-id":"VDisk Slot Id","pool-name":"Storage Pool Name","kind":"Kind","guid":"GUID","incarnation-guid":"Incarnation GUID","instance-guid":"Instance GUID","replication-status":"Replicated","state-status":"VDisk State","space-status":"Disk Space","fresh-rank-satisfaction":"Fresh Rank Satisfaction","level-rank-satisfaction":"Level Rank Satisfaction","front-queues":"Front Queues","has-unreadable-blobs":"Has Unreadable Blobs","size":"Size","read-throughput":"Read Throughput","write-throughput":"Write Throughput","links":"Links","vdisk-page":"VDisk Page","developer-ui":"Developer UI","yes":"Yes","no":"No","vdiks-title":"VDisk"}'),j=(0,g.wZ)("ydb-vDisk-info",{en:x});var y=a(75859);const k=(0,o.cn)("ydb-vdisk-info");function f(e){var t,a;let{data:o,withVDiskPageLink:c,withTitle:g,...x}=e;const f=(0,i.X_)(),D=(0,u.ix)(n.VH),{AllocatedSize:I,DiskSpace:S,FrontQueues:w,Guid:T,Replicated:P,VDiskState:C,VDiskSlotId:V,Kind:z,SatisfactionRank:A,AvailableSize:R,HasUnreadableBlobs:q,IncarnationGuid:F,InstanceGuid:E,StoragePoolName:L,ReadThroughput:B,WriteThroughput:U,PDiskId:Z,NodeId:G}=o||{},O=[];var _,J;((0,l.D)(V)&&O.push({label:j("slot-id"),value:V}),(0,l.D)(L)&&O.push({label:j("pool-name"),value:L}),(0,l.D)(C)&&O.push({label:j("state-status"),value:C}),Number(I)>=0&&Number(R)>=0&&O.push({label:j("size"),value:(0,y.jsx)(b.y,{value:I,capacity:Number(I)+Number(R),formatValues:r.q3,colorizeProgress:!0})}),(0,l.D)(z)&&O.push({label:j("kind"),value:z}),(0,l.D)(T)&&O.push({label:j("guid"),value:T}),(0,l.D)(F)&&O.push({label:j("incarnation-guid"),value:F}),(0,l.D)(E)&&O.push({label:j("instance-guid"),value:E}),(0,l.D)(P)&&O.push({label:j("replication-status"),value:j(P?"yes":"no")}),(0,l.D)(S)&&O.push({label:j("space-status"),value:(0,y.jsx)(p.A,{status:S})}),(0,l.D)(null===A||void 0===A||null===(t=A.FreshRank)||void 0===t?void 0:t.Flag))&&O.push({label:j("fresh-rank-satisfaction"),value:(0,y.jsx)(p.A,{status:null===A||void 0===A||null===(_=A.FreshRank)||void 0===_?void 0:_.Flag})});(0,l.D)(null===A||void 0===A||null===(a=A.LevelRank)||void 0===a?void 0:a.Flag)&&O.push({label:j("level-rank-satisfaction"),value:(0,y.jsx)(p.A,{status:null===A||void 0===A||null===(J=A.LevelRank)||void 0===J?void 0:J.Flag})});(0,l.D)(w)&&O.push({label:j("front-queues"),value:(0,y.jsx)(p.A,{status:w})}),(0,l.D)(q)&&O.push({label:j("has-unreadable-blobs"),value:j(q?"yes":"no")}),(0,l.D)(B)&&O.push({label:j("read-throughput"),value:(0,v.Qt)(B)}),(0,l.D)(U)&&O.push({label:j("write-throughput"),value:(0,v.Qt)(U)});if((0,l.D)(Z)&&(0,l.D)(G)&&(0,l.D)(V)){const e=[];if(c&&f){const t=(0,s.By)(V,Z,G);e.push((0,y.jsx)(m.j,{title:j("vdisk-page"),url:t,external:!1},t))}if(D){const t=(0,d.yf)({nodeId:G,pDiskId:Z,vDiskSlotId:V});e.push((0,y.jsx)(m.j,{title:j("developer-ui"),url:t},t))}e.length&&O.push({label:j("links"),value:(0,y.jsx)("div",{className:k("links"),children:e})})}const H=o&&g?(0,y.jsx)(N,{data:o}):null;return(0,y.jsx)(h._P,{info:O,title:H,...x})}function N(e){let{data:t}=e;return(0,y.jsxs)("div",{className:k("title"),children:[j("vdiks-title"),(0,y.jsx)(p.A,{status:(0,c.b2)(t.Severity),name:(0,r.a2)(t.VDiskId)})]})}},66179:(e,t,a)=>{a.r(t),a.d(t,{Node:()=>je,STORAGE_ROLE:()=>xe});var s=a(68963),n=a(8179),i=a(49352),l=a(86974),o=a(83203),r=a(50422),d=a(39683),c=a(88776),u=a(24362),v=a(48169),p=a(69214),h=a(12199),m=a(75859);const b=(0,u.cn)("basic-node-viewer"),g=e=>{let t,{node:a,additionalNodesProps:n,className:i}=e;return null!==n&&void 0!==n&&n.getNodeRef?t=n.getNodeRef(a)+"internal":a.NodeId&&(t=(0,v.wq)(a.NodeId)+"internal"),(0,m.jsx)("div",{className:b(null,i),children:a?(0,m.jsxs)(s.Fragment,{children:[(0,m.jsx)("div",{className:b("title"),children:"Node"}),(0,m.jsx)(p.A,{status:a.SystemState,name:a.Host}),t&&(0,m.jsx)("a",{rel:"noopener noreferrer",className:b("link",{external:!0}),href:t,target:"_blank",children:(0,m.jsx)(c.J,{data:d.Z})}),(0,m.jsxs)("div",{className:b("id"),children:[(0,m.jsx)("label",{className:b("label"),children:"NodeID"}),(0,m.jsx)("label",{children:a.NodeId})]}),a.DC&&(0,m.jsx)(h.$,{tags:[a.DC]}),a.Roles&&(0,m.jsx)(h.$,{tags:a.Roles,tagsType:"blue"})]}):(0,m.jsx)("div",{className:"error",children:"no data"})})};var x=a(26688),j=a(52317),y=a(23373);const k=(0,u.cn)("ydb-pool-usage"),f=e=>{let t="green";return e>60&&e<=80?t="yellow":e>80&&(t="red"),t},N=e=>{let{data:t={}}=e;const{Threads:a,Name:s="Unknown",Usage:n=0}=t,i=n&&a,l=Math.floor(100*n),o=l>100?100:l;return(0,m.jsxs)("div",{className:k(),children:[(0,m.jsxs)("div",{className:k("info"),children:[(0,m.jsx)("div",{className:k("pool-name"),children:s}),i&&(0,m.jsxs)("div",{className:k("value"),children:[(0,m.jsxs)("div",{className:k("percents"),children:[l<1?"<1":l,"%"]}),(0,m.jsxs)("div",{className:k("threads"),children:["(\xd7",a,")"]})]})]}),(0,m.jsx)("div",{className:k("visual"),children:(0,m.jsx)("div",{className:k("usage-line",{type:f(o)}),style:{width:"".concat(o,"%")}})})]})};var D=a(67359);const I=(0,u.cn)("full-node-viewer"),S=e=>{var t,a,s,n;let{node:i,className:l}=e;const o=null===i||void 0===i||null===(t=i.Endpoints)||void 0===t?void 0:t.map((e=>{let{Name:t,Address:a}=e;return{label:t,value:a}})),r=[];null!==i&&void 0!==i&&null!==(a=i.Tenants)&&void 0!==a&&a.length&&r.push({label:"Database",value:i.Tenants[0]}),r.push({label:"Version",value:null===i||void 0===i?void 0:i.Version},{label:"Uptime",value:null===i||void 0===i?void 0:i.Uptime},{label:"DC",value:(null===i||void 0===i?void 0:i.DataCenterDescription)||(null===i||void 0===i?void 0:i.DC)},{label:"Rack",value:null===i||void 0===i?void 0:i.Rack});const d=null===i||void 0===i||null===(s=i.LoadAveragePercents)||void 0===s?void 0:s.map(((e,t)=>({label:j.x5[t],value:(0,m.jsx)(D.y,{value:e,percents:!0,colorizeProgress:!0,capacity:100})})));return(0,m.jsx)("div",{className:"".concat(I()," ").concat(l),children:i?(0,m.jsxs)("div",{className:I("common-info"),children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:I("section-title"),children:"Pools"}),(0,m.jsx)("div",{className:I("section",{pools:!0}),children:null===i||void 0===i||null===(n=i.PoolStats)||void 0===n?void 0:n.map(((e,t)=>(0,m.jsx)(N,{data:e},t)))})]}),o&&o.length&&(0,m.jsx)(y.Z,{title:"Endpoints",className:I("section"),info:o}),(0,m.jsx)(y.Z,{title:"Common info",className:I("section"),info:r}),(0,m.jsx)(y.Z,{title:"Load average",className:I("section",{average:!0}),info:d})]}):(0,m.jsx)("div",{className:"error",children:"no data"})})};var w=a(62776),T=a(54665),P=a(79061),C=a(905),V=a(51688);const z=e=>{var t;if(null===(t=e.SystemStateInfo)||void 0===t||!t.length)return{};const a=e.SystemStateInfo[0];return(0,V.Ns)(a)},A=C.h.injectEndpoints({endpoints:e=>({getNodeInfo:e.query({queryFn:async(e,t)=>{let{nodeId:a}=e,{signal:s}=t;try{const e=await window.api.getNodeInfo(a,{signal:s});return{data:z(e)}}catch(n){return{error:n}}},providesTags:["All"]}),getNodeStructure:e.query({queryFn:async(e,t)=>{let{nodeId:a}=e,{signal:s}=t;try{return{data:await window.api.getStorageInfo({nodeId:a},{signal:s})}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var R=a(17096),q=a(70885),F=a(66809),E=a(92398),L=a(92820),B=a(85198),U=a.n(B),Z=a(36313),G=a(34301),O=a(3764);const _=(0,Z.P1)((e=>e),(e=>A.endpoints.getNodeStructure.select({nodeId:e}))),J=(0,Z.P1)((e=>e),((e,t)=>_(t)),((e,t)=>t(e).data)),H=(0,Z.P1)(((e,t)=>Number(t)),((e,t)=>J(e,t)),((e,t)=>{const a=null===t||void 0===t?void 0:t.StoragePools,s={};null===a||void 0===a||a.forEach((t=>{const a=t.Groups;null===a||void 0===a||a.forEach((a=>{var n;const i=null===(n=a.VDisks)||void 0===n?void 0:n.filter((t=>t.NodeId===e)).map(O.w);null===i||void 0===i||i.forEach((a=>{const n=(0,G.a2)(a.VDiskId),i=(0,O.b)(a.PDisk),l=i.PDiskId;s[String(l)]||(s[String(l)]={vDisks:{},...i}),s[String(l)].vDisks[n]={...a,PDiskId:l,NodeId:e,StoragePoolName:t.Name}}))}))}));return Object.keys(s).reduce(((e,t)=>{const a=s[t].vDisks,n=Object.keys(a).reduce(((e,t,s)=>(e.push({...a[t],id:t,order:s}),e)),[]);return e[t]={...s[t],vDisks:n},e}),{})}));var M=a(67585),K=a(19812),Q=a(17176),Y=a(68330),W=a(33569),$=a(8659),X=a(22200),ee=a(75850),te=a(17632),ae=a(5922),se=a(30817);const ne=JSON.parse('{"pdisk.developer-ui-button-title":"PDisk Developer UI page","vdisk.developer-ui-button-title":"VDisk Developer UI page"}'),ie=JSON.parse('{"pdisk.developer-ui-button-title":"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 PDisk \u0432 Developer UI","vdisk.developer-ui-button-title":"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 VDisk \u0432 Developer UI"}'),le=(0,se.wZ)("ydb-node-page",{en:ne,ru:ie}),oe=(0,u.cn)("kv-node-structure");function re(e){let{label:t,value:a,className:s}=e;return(0,m.jsxs)("span",{className:oe("pdisk-title-item",s),children:[t&&(0,m.jsxs)("span",{className:oe("pdisk-title-item-label"),children:[t,":"]}),(0,m.jsx)("span",{className:oe("pdisk-title-item-value"),children:a})]})}const de=(0,u.cn)("kv-node-structure");var ce;!function(e){e.slotId="VDiskSlotId",e.VDiskState="VDiskState",e.Size="Size",e.Info="Info"}(ce||(ce={}));const ue={VDiskSlotId:"Slot id",VDiskState:"Status",Size:"Size",Info:""};function ve(e){let{pDiskId:t,selectedVdiskId:a,nodeId:s}=e;return[{name:ce.slotId,header:ue[ce.slotId],width:100,render:e=>{let{row:n}=e;const i=n.VDiskSlotId;let l=null;return(0,ae.D)(s)&&(0,ae.D)(t)&&(0,ae.D)(i)&&(l=(0,v.yf)({nodeId:s,pDiskId:t,vDiskSlotId:i})),(0,m.jsxs)("div",{className:de("vdisk-id",{selected:n.id===a}),children:[(0,m.jsx)("span",{children:i}),l&&(0,m.jsx)(Q.z,{size:"s",className:de("external-button",{hidden:!0}),href:l,target:"_blank",title:le("vdisk.developer-ui-button-title"),children:(0,m.jsx)(c.J,{data:d.Z})})]})},align:K.ZP.LEFT},{name:ce.VDiskState,header:ue[ce.VDiskState],width:70,render:e=>{let{row:t}=e;return(0,m.jsx)(p.A,{status:t.VDiskState===te.H.OK?ee.K.Green:ee.K.Red})},sortAccessor:e=>e.VDiskState===te.H.OK?1:0,align:K.ZP.CENTER},{name:ce.Size,header:ue[ce.Size],width:100,render:e=>{let{row:t}=e;return(0,m.jsx)(D.y,{value:t.AllocatedSize,capacity:Number(t.AllocatedSize)+Number(t.AvailableSize),formatValues:G.q3,colorizeProgress:!0})},sortAccessor:e=>Number(e.AllocatedSize),align:K.ZP.CENTER},{name:ce.Info,header:ue[ce.Info],width:70,render:e=>{let{row:t}=e;return(0,m.jsx)(Y.J,{placement:["right"],content:(0,m.jsx)(X.K,{data:t,withTitle:!0,withVDiskPageLink:!0}),tooltipContentClassName:de("vdisk-details"),children:(0,m.jsx)(Q.z,{view:"flat-secondary",className:de("vdisk-details-button",{selected:t.id===a}),children:(0,m.jsx)(c.J,{data:M.Z,size:18})})})},sortable:!1}]}function pe(e){let{id:t,data:a,selectedVdiskId:n,nodeId:i,unfolded:l}=e;const[o,r]=s.useState(null!==l&&void 0!==l&&l),{TotalSize:d=0,AvailableSize:c=0,Device:u,PDiskId:v,Type:h,vDisks:b}=a,g=Number(d),x=Number(c);return(0,m.jsxs)("div",{className:de("pdisk"),id:t,children:[(0,m.jsxs)("div",{className:de("pdisk-header"),children:[(0,m.jsxs)("div",{className:de("pdisk-title-wrapper"),children:[(0,m.jsx)(p.A,{status:u}),(0,m.jsx)(re,{label:"PDiskID",value:v,className:de("pdisk-title-id")}),(0,m.jsx)(re,{value:h,className:de("pdisk-title-type")}),(0,m.jsx)(D.y,{value:g-x,capacity:g,formatValues:G.q3,colorizeProgress:!0,className:de("pdisk-title-size")}),(0,m.jsx)(re,{label:"VDisks",value:b.length})]}),(0,m.jsx)(Q.z,{onClick:o?()=>{r(!1)}:()=>{r(!0)},view:"flat-secondary",children:(0,m.jsx)(W.F,{direction:o?"top":"bottom"})})]}),o&&(U()(a)?(0,m.jsx)("div",{children:"No information about PDisk"}):(0,m.jsxs)("div",{children:[(0,m.jsx)($.P,{pDisk:a,nodeId:i,className:de("pdisk-details"),withPDiskPageLink:!0}),(0,m.jsxs)("div",{className:de("vdisks-container"),children:[(0,m.jsx)("div",{className:de("vdisks-header"),children:"VDisks"}),(0,m.jsx)(K.ZP,{theme:"yandex-cloud",data:b,columns:ve({nodeId:i,pDiskId:v,selectedVdiskId:n}),settings:{...j.LE,dynamicRender:!1},rowClassName:e=>e.id===n?de("selected-vdisk"):""})]})]}))]})}const he=(0,u.cn)("kv-node-structure");function me(e){let{type:t,id:a}=e;return"".concat(t,"-").concat(a)}const be=function(e){let{nodeId:t,className:a}=e;const n=(0,R.ix)((e=>H(e,t))),[i]=(0,R.Rj)(),{currentData:l,isFetching:o,error:r}=A.useGetNodeStructureQuery({nodeId:t},{pollingInterval:i}),d=o&&void 0===l,{pdiskId:c,vdiskId:u}=L.parse(window.location.href,!0).query,v=s.useRef(null),p=s.useRef(!1);return s.useEffect((()=>{if(!U()(n)&&!p.current&&v.current){const t=document.getElementById(me({type:"pdisk",id:c}));let a=0;if(u){var e;const t=null===(e=n[c])||void 0===e?void 0:e.vDisks,s=null===t||void 0===t?void 0:t.find((e=>e.id===u)),i=s?document.querySelector(".data-table"):void 0,l=(null===s||void 0===s?void 0:s.order)||0;i&&(a+=i.offsetTop+40*l)}t&&(v.current.scrollTo({behavior:"smooth",top:a||t.offsetTop}),p.current=!0)}}),[n,c,u]),(0,m.jsxs)("div",{className:he(),ref:v,children:[r?(0,m.jsx)(x.V,{error:r,className:he("error")}):null,(0,m.jsx)("div",{className:a,children:d?(0,m.jsx)(w.a,{size:"m"}):r&&!l?null:(()=>{const e=Object.keys(n);return e.length>0?e.map((e=>(0,m.jsx)(pe,{data:n[e],id:me({type:"pdisk",id:e}),unfolded:c===e,selectedVdiskId:u,nodeId:t},e))):"There is no information about node structure."})()})]})},ge=(0,u.cn)("node"),xe="Storage";function je(e){var t;const a=s.useRef(null),d=(0,R.zL)(),c=(0,l.TH)(),u=null!==(t=(0,l.$B)(T.ZP.node))&&void 0!==t?t:Object.create(null),{id:v,activeTab:p}=u.params,{tenantName:h}=(0,T.mB)(c),[b]=(0,R.Rj)(),{currentData:j,isFetching:y,error:k}=A.useGetNodeInfoQuery({nodeId:v},{pollingInterval:b}),f=y&&void 0===j,N=j,{activeTabVerified:D,nodeTabs:I}=s.useMemo((()=>{var e;const t=((null===N||void 0===N||null===(e=N.Roles)||void 0===e?void 0:e.find((e=>e===xe)))?E.ZJ:E.ZJ.filter((e=>e.id!==E.P_))).map((e=>({...e,title:e.name})));let a=t.find((e=>{let{id:t}=e;return t===p}));return a||(a=t[0]),{activeTabVerified:a,nodeTabs:t}}),[p,N]);s.useEffect((()=>{var e;const t=(null===N||void 0===N||null===(e=N.Tenants)||void 0===e?void 0:e[0])||(null===h||void 0===h?void 0:h.toString());d((0,P.J)("node",{tenantName:t,nodeId:v}))}),[d,N,v,h]);const C=()=>{switch(D.id){case E.P_:return(0,m.jsx)("div",{className:ge("storage"),children:(0,m.jsx)(q.V,{nodeId:v,parentContainer:a.current})});case E.IA:return(0,m.jsx)(F.J,{nodeId:v,className:ge("node-page-wrapper")});case E.mD:return(0,m.jsx)(S,{node:N,className:ge("overview-wrapper")});case E.pV:return(0,m.jsx)(be,{className:ge("node-page-wrapper"),nodeId:v});default:return!1}};return f?(0,m.jsx)(w.a,{size:"l"}):N?(0,m.jsxs)("div",{className:ge(null,e.className),ref:a,children:[(0,m.jsx)(i.ql,{titleTemplate:"%s \u2014 ".concat(N.Host," \u2014 YDB Monitoring"),defaultTitle:"".concat(N.Host," \u2014 YDB Monitoring"),children:(0,m.jsx)("title",{children:D.title})}),(0,m.jsx)(g,{node:N,additionalNodesProps:e.additionalNodesProps,className:ge("header")}),k?(0,m.jsx)(x.V,{error:k,className:ge("error")}):null,(0,m.jsxs)("div",{className:ge("tabs"),children:[(0,m.jsx)(n.m,{size:"l",items:I,activeTab:D.id,wrapTo:(e,t)=>{let{id:a}=e;return(0,m.jsx)(o.rU,{to:(0,T.ax)(T.ZP.node,{id:v,activeTab:a}),className:ge("tab"),children:t},a)},allowNotSelected:!0}),(0,m.jsx)(r.q,{})]}),(0,m.jsx)("div",{className:ge("content"),children:C()})]}):k?(0,m.jsx)(x.V,{error:k}):(0,m.jsx)("div",{className:"error",children:"no node data"})}},66809:(e,t,a)=>{a.d(t,{J:()=>A});var s=a(66950),n=a(10288),i=a(88776),l=a(17095),o=a(14659),r=a(41919),d=a(69214),c=a(26688),u=a(74170),v=a(2098),p=a(22692),h=a(97482),m=a(54665),b=a(14146),g=a(76386),x=a(99399),j=a(28164),y=a(24362),k=a(52317),f=a(34301),N=a(48169),D=a(17096),I=a(92398),S=a(30817);const w=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet"}'),T=(0,S.wZ)("ydb-tablets",{en:w});var P=a(75859);const C=(0,y.cn)("tablets"),V=[{name:"Type",get header(){return T("Type")},render:e=>{let{row:t}=e;const a=!1===t.Leader;return(0,P.jsxs)("span",{children:[t.Type," ",a?(0,P.jsx)(n.x,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return T("Tablet")},render:e=>{var t;let{row:a}=e;if(!a.TabletId)return k.jX;const s=(0,m.fK)(a.TabletId,{nodeId:a.NodeId,type:a.Type});return(0,P.jsx)(d.A,{name:null===(t=a.TabletId)||void 0===t?void 0:t.toString(),path:s,hasClipboardButton:!0,showStatus:!1,additionalControls:(0,P.jsx)(r.Q,{href:(0,N.wz)(a.TabletId)})})}},{name:"State",get header(){return T("State")},render:e=>{let{row:t}=e;return(0,P.jsx)(h.f,{state:t.State})}},{name:"NodeId",get header(){return T("Node ID")},render:e=>{let{row:t}=e;const a=void 0===t.NodeId?void 0:(0,I.a3)(t.NodeId);return(0,P.jsx)(u.h,{to:a,children:t.NodeId})},align:"right"},{name:"fqdn",get header(){return T("Node FQDN")},render:e=>{let{row:t}=e;return t.fqdn?(0,P.jsx)(d.A,{name:t.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,P.jsx)("span",{children:"\u2014"})}},{name:"Generation",get header(){return T("Generation")},align:"right"},{name:"Uptime",get header(){return T("Uptime")},render:e=>{let{row:t}=e;return(0,f.fG)(t.ChangeTime)},sortAccessor:e=>-Number(e.ChangeTime),align:"right"},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:e=>{let{row:t}=e;return(0,P.jsx)(z,{...t})}}];function z(e){const t=e.State===j.g.Stopped,a=(0,D.ix)(b.VH),[n]=g._.useKillTabletMutation(),l=e.TabletId;return l?(0,P.jsx)(o.U,{buttonView:"outlined",dialogContent:T("dialog.kill"),onConfirmAction:()=>n({id:l}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:T("controls.kill-not-allowed"),popoverDisabled:a,children:(0,P.jsx)(i.J,{data:s.Z})}):null}function A(e){let{nodeId:t,path:a,className:s}=e;const[n]=(0,D.Rj)();let i={};const o=void 0===t?void 0:String(t);void 0!==o?i={nodes:[String(o)]}:a&&(i={path:a});const{currentData:r,isFetching:d,error:u}=x.zg.useGetTabletsInfoQuery(0===Object.keys(i).length?l.CN:i,{pollingInterval:n}),h=d&&void 0===r,m=(0,D.ix)((e=>(0,x.Sq)(e,i)));return h?(0,P.jsx)(p.h,{}):(0,P.jsxs)("div",{className:C(null,s),children:[u?(0,P.jsx)(c.V,{error:u}):null,r?(0,P.jsx)(v.G,{columns:V,data:m,settings:k.LE,emptyDataMessage:T("noTabletsData")}):null]})}},76386:(e,t,a)=>{a.d(t,{_:()=>n});var s=a(51688);const n=a(905).h.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async(e,t)=>{let{id:a,database:n}=e,{signal:i}=t;try{const[e,t,l]=await Promise.all([window.api.getTablet({id:a,database:n},{signal:i}),window.api.getTabletHistory({id:a,database:n},{signal:i}),window.api.getNodesList({signal:i})]),o=(0,s.dn)(l),r=Object.keys(t).reduce(((e,a)=>{var s;const n=null===(s=t[a])||void 0===s?void 0:s.TabletStateInfo;if(n&&n.length){const t=n.find((e=>e.Leader))||n[0],{ChangeTime:s,Generation:i,State:l,Leader:r,FollowerId:d}=t,c=o&&a?o.get(Number(a)):void 0;"Dead"!==l&&e.push({nodeId:a,generation:i,changeTime:s,state:l,leader:r,followerId:d,fqdn:c})}return e}),[]),{TabletStateInfo:d=[]}=e,[c={}]=d,{TabletId:u}=c;return{data:{id:u,data:c,history:r}}}catch(l){return{error:l}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async(e,t)=>{let{tenantId:a}=e,{signal:s}=t;try{const e=await window.api.getTabletDescribe(a,{signal:s}),{SchemeShard:t,PathId:n}=a;return{data:(null===e||void 0===e?void 0:e.Path)||"".concat(t,":").concat(n)}}catch(n){return{error:n}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async(e,t)=>{let{id:a,hiveId:s}=e,{signal:n}=t;try{return{data:await window.api.getTabletFromHive({id:a,hiveId:s},{signal:n})}}catch(i){return{error:i}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async e=>{let{id:t}=e;try{return{data:await window.api.killTablet(t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.stopTablet(t,a)}}catch(s){return{error:s}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.resumeTablet(t,a)}}catch(s){return{error:s}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})},99399:(e,t,a)=>{a.d(t,{Sq:()=>u,em:()=>c,zg:()=>r});var s=a(36313),n=a(85690),i=a.n(n),l=a(905),o=a(99337);const r=l.h.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.getTabletsInfo(e,{signal:a})}}catch(s){return{error:s}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),d=(0,s.P1)((e=>e),(e=>r.endpoints.getTabletsInfo.select(e)),{argsMemoize:s.PP,argsMemoizeOptions:{equalityCheck:i()}}),c=(0,s.P1)((e=>e),((e,t)=>d(t)),((e,t)=>t(e).data)),u=(0,s.P1)(((e,t)=>c(e,t)),(e=>(0,o.d)(e)),((e,t)=>null!==e&&void 0!==e&&e.TabletStateInfo?t?e.TabletStateInfo.map((e=>{const a=void 0===e.NodeId?void 0:t.get(e.NodeId);return{...e,fqdn:a}})):e.TabletStateInfo:[]))}}]);