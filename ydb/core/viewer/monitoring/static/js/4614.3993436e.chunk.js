(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[4614],{79737:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,X:()=>l});var n=a(5874),r=a(77506),i=a(60712);const s=(0,r.cn)("ydb-table");function o({children:e,className:t}){return(0,i.jsx)("div",{className:s("table-header-content",t),children:e})}function l({className:e,width:t,wrapperClassName:a,...r}){return(0,i.jsx)("div",{className:s(null,a),children:(0,i.jsx)(n.W,{headerCellClassName:({column:e})=>{var t;const a=null===(t=e.columnDef.meta)||void 0===t?void 0:t.align;return s("table-header-cell",{align:a})},cellClassName:e=>{var t,a;const n=null===e||void 0===e||null===(t=e.column.columnDef.meta)||void 0===t?void 0:t.align,r=null===e||void 0===e||null===(a=e.column.columnDef.meta)||void 0===a?void 0:a.verticalAlign;return s("table-cell",{align:n,"vertical-align":r})},className:s("table",{width:t},e),...r})})}},76768:(e,t,a)=>{"use strict";a.d(t,{C:()=>b});var n=a(44992),r=a(44508),i=a(53850),s=a(62060),o=a.n(s),l=a(21334),c=a(24600);const d=l.F.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.viewer.getTabletsInfo(e,{signal:t})}}catch(a){return{error:a}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),u=(0,i.Mz)((e=>e),(e=>d.endpoints.getTabletsInfo.select(e)),{argsMemoize:i.i5,argsMemoizeOptions:{equalityCheck:o()}}),p=(0,i.Mz)((e=>e),((e,t)=>u(t)),((e,t)=>t(e).data)),m=(0,i.Mz)(((e,t)=>p(e,t)),(e=>(0,c.E)(e)),((e,t)=>null!==e&&void 0!==e&&e.TabletStateInfo?t?e.TabletStateInfo.map((e=>{const a=void 0===e.NodeId?void 0:t.get(e.NodeId);return{...e,fqdn:a}})):e.TabletStateInfo:[]));var h=a(77506),v=a(90182),g=a(88616),y=a(60712);const x=(0,h.cn)("tablets");function b({nodeId:e,path:t,database:a,className:i}){const[s]=(0,v.Nt)();let o={};const l=void 0===e?void 0:String(e);void 0!==l?o={nodeId:l,database:a}:t&&(o={path:t,database:a});const{currentData:c,isFetching:u,error:p}=d.useGetTabletsInfoQuery(0===Object.keys(o).length?n.hT:o,{pollingInterval:s}),h=u&&void 0===c,b=(0,v.N4)((e=>m(e,o)));return(0,y.jsxs)("div",{className:x(null,i),children:[p?(0,y.jsx)(r.o,{error:p}):null,c||h?(0,y.jsx)(g.Q,{tablets:b,database:a,loading:h}):null]})}},37875:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Tenant:()=>Jv});var n=a(59284),r=a(61750),i=a(67087),s=a(64689),o=a(98167),l=a(61283),c=a(77506),d=a(60712);const u=(0,c.cn)("kv-split"),p=[0,100],m=[50,50];const h=function(e){const[t,a]=n.useState(),r=t=>{const{defaultSizePaneKey:a}=e;localStorage.setItem(a,t.join(","))};return n.useEffect((()=>{const{collapsedSizes:t,triggerCollapse:n}=e;if(n){const e=t||p;r(e),a(e)}}),[e.triggerCollapse]),n.useEffect((()=>{const{triggerExpand:t,defaultSizes:n}=e,i=n||m;t&&(r(i),a(i))}),[e.triggerExpand]),(0,d.jsx)(n.Fragment,{children:(0,d.jsx)(l.A,{direction:e.direction||"horizontal",sizes:t||(()=>{var t;const{defaultSizePaneKey:a,defaultSizes:n=m,initialSizes:r}=e;if(r)return r;return(null===(t=localStorage.getItem(a))||void 0===t?void 0:t.split(",").map(Number))||n})(),minSize:e.minSize||[0,0],onDrag:t=>{const{onSplitDragAdditional:a}=e;a&&a(),r(t)},className:u(null,e.direction||"horizontal"),gutterSize:8,onDragStart:()=>{const{onSplitStartDragAdditional:t}=e;t&&t(),a(void 0)},expandToMin:!0,children:e.children})})};var v,g,y=a(40174),x=a(53850),b=a(44992);let f,S;var E;let T,N;var j,C,w,P,I;let D;var A,_,R,O,M,k,L;!function(e){e.StatusSuccess="StatusSuccess",e.StatusAccepted="StatusAccepted",e.StatusPathDoesNotExist="StatusPathDoesNotExist",e.StatusPathIsNotDirectory="StatusPathIsNotDirectory",e.StatusAlreadyExists="StatusAlreadyExists",e.StatusSchemeError="StatusSchemeError",e.StatusNameConflict="StatusNameConflict",e.StatusInvalidParameter="StatusInvalidParameter",e.StatusMultipleModifications="StatusMultipleModifications",e.StatusReadOnly="StatusReadOnly",e.StatusTxIdNotExists="StatusTxIdNotExists",e.StatusTxIsNotCancellable="StatusTxIsNotCancellable",e.StatusAccessDenied="StatusAccessDenied",e.StatusNotAvailable="StatusNotAvailable",e.StatusPreconditionFailed="StatusPreconditionFailed",e.StatusRedirectDomain="StatusRedirectDomain",e.StatusQuotaExceeded="StatusQuotaExceeded",e.StatusResourceExhausted="StatusResourceExhausted"}(v||(v={})),function(e){e.UNKNOWN="UNKNOWN",e.USER="USER",e.GROUP="GROUP"}(g||(g={})),function(e){e.EPathTypeInvalid="EPathTypeInvalid",e.EPathTypeDir="EPathTypeDir",e.EPathTypeTable="EPathTypeTable",e.EPathTypePersQueueGroup="EPathTypePersQueueGroup",e.EPathTypeSubDomain="EPathTypeSubDomain",e.EPathTypeTableIndex="EPathTypeTableIndex",e.EPathTypeExtSubDomain="EPathTypeExtSubDomain",e.EPathTypeColumnStore="EPathTypeColumnStore",e.EPathTypeColumnTable="EPathTypeColumnTable",e.EPathTypeCdcStream="EPathTypeCdcStream",e.EPathTypeExternalDataSource="EPathTypeExternalDataSource",e.EPathTypeExternalTable="EPathTypeExternalTable",e.EPathTypeView="EPathTypeView",e.EPathTypeReplication="EPathTypeReplication"}(f||(f={})),function(e){e.EPathSubTypeEmpty="EPathSubTypeEmpty",e.EPathSubTypeSyncIndexImplTable="EPathSubTypeSyncIndexImplTable",e.EPathSubTypeAsyncIndexImplTable="EPathSubTypeAsyncIndexImplTable",e.EPathSubTypeStreamImpl="EPathSubTypeStreamImpl"}(S||(S={})),function(e){e.EPathStateNotExist="EPathStateNotExist",e.EPathStateNoChanges="EPathStateNoChanges",e.EPathStateCreate="EPathStateCreate",e.EPathStateAlter="EPathStateAlter",e.EPathStateDrop="EPathStateDrop",e.EPathStateCopying="EPathStateCopying",e.EPathStateBackup="EPathStateBackup",e.EPathStateUpgrade="EPathStateUpgrade",e.EPathStateMigrated="EPathStateMigrated",e.EPathStateRestore="EPathStateRestore",e.EPathStateMoving="EPathStateMoving"}(E||(E={})),function(e){e.ColumnCodecPlain="ColumnCodecPlain",e.ColumnCodecLZ4="ColumnCodecLZ4",e.ColumnCodecZSTD="ColumnCodecZSTD"}(T||(T={})),function(e){e.UNIT_AUTO="UNIT_AUTO",e.UNIT_SECONDS="UNIT_SECONDS",e.UNIT_MILLISECONDS="UNIT_MILLISECONDS",e.UNIT_MICROSECONDS="UNIT_MICROSECONDS",e.UNIT_NANOSECONDS="UNIT_NANOSECONDS"}(N||(N={})),function(e){e.ECdcStreamModeInvalid="ECdcStreamModeInvalid",e.ECdcStreamModeKeysOnly="ECdcStreamModeKeysOnly",e.ECdcStreamModeUpdate="ECdcStreamModeUpdate",e.ECdcStreamModeNewImage="ECdcStreamModeNewImage",e.ECdcStreamModeOldImage="ECdcStreamModeOldImage",e.ECdcStreamModeNewAndOldImages="ECdcStreamModeNewAndOldImages"}(j||(j={})),function(e){e.ECdcStreamFormatInvalid="ECdcStreamFormatInvalid",e.ECdcStreamFormatProto="ECdcStreamFormatProto",e.ECdcStreamFormatJson="ECdcStreamFormatJson"}(C||(C={})),function(e){e.ECdcStreamStateInvalid="ECdcStreamStateInvalid",e.ECdcStreamStateReady="ECdcStreamStateReady",e.ECdcStreamStateDisabled="ECdcStreamStateDisabled"}(w||(w={})),function(e){e.HASH_FUNCTION_MODULO_N="HASH_FUNCTION_MODULO_N",e.HASH_FUNCTION_CLOUD_LOGS="HASH_FUNCTION_CLOUD_LOGS"}(P||(P={})),function(e){e.COLUMN_ENGINE_NONE="COLUMN_ENGINE_NONE",e.COLUMN_ENGINE_REPLACING_TIMESERIES="COLUMN_ENGINE_REPLACING_TIMESERIES"}(I||(I={})),function(e){e.METERING_MODE_RESERVED_CAPACITY="METERING_MODE_RESERVED_CAPACITY",e.METERING_MODE_REQUEST_UNITS="METERING_MODE_REQUEST_UNITS"}(D||(D={})),function(e){e.SysLog="SysLog",e.Log="Log",e.Data="Data",e.External="External"}(A||(A={})),function(e){e.Unspecified="Unspecified",e.Freeze="Freeze",e.Unfreeze="Unfreeze"}(_||(_={})),function(e){e.ColumnCacheNone="ColumnCacheNone",e.ColumnCacheOnce="ColumnCacheOnce",e.ColumnCacheEver="ColumnCacheEver"}(R||(R={})),function(e){e.ColumnStorage1="ColumnStorage1",e.ColumnStorage2="ColumnStorage2",e.ColumnStorage1Ext1="ColumnStorage1Ext1",e.ColumnStorage1Ext2="ColumnStorage1Ext2",e.ColumnStorage2Ext1="ColumnStorage2Ext1",e.ColumnStorage2Ext2="ColumnStorage2Ext2",e.ColumnStorage1Med2Ext2="ColumnStorage1Med2Ext2",e.ColumnStorage2Med2Ext2="ColumnStorage2Med2Ext2",e.ColumnStorageTest_1_2_1k="ColumnStorageTest_1_2_1k"}(O||(O={})),function(e){e.CompactionStrategyUnset="CompactionStrategyUnset",e.CompactionStrategyGenerational="CompactionStrategyGenerational",e.CompactionStrategySharded="CompactionStrategySharded"}(M||(M={})),function(e){e.EIndexTypeInvalid="EIndexTypeInvalid",e.EIndexTypeGlobal="EIndexTypeGlobal",e.EIndexTypeGlobalAsync="EIndexTypeGlobalAsync"}(k||(k={})),function(e){e.EIndexStateInvalid="EIndexStateInvalid",e.EIndexStateReady="EIndexStateReady",e.EIndexStateNotReady="EIndexStateNotReady",e.EIndexStateWriteOnly="EIndexStateWriteOnly"}(L||(L={}));const z={[S.EPathSubTypeSyncIndexImplTable]:"index_table",[S.EPathSubTypeAsyncIndexImplTable]:"index_table",[S.EPathSubTypeStreamImpl]:void 0,[S.EPathSubTypeEmpty]:void 0},F={[f.EPathTypeInvalid]:void 0,[f.EPathTypeSubDomain]:"database",[f.EPathTypeExtSubDomain]:"database",[f.EPathTypeDir]:"directory",[f.EPathTypeColumnStore]:"directory",[f.EPathTypeTable]:"table",[f.EPathTypeTableIndex]:"index",[f.EPathTypeColumnTable]:"column_table",[f.EPathTypeCdcStream]:"stream",[f.EPathTypePersQueueGroup]:"topic",[f.EPathTypeExternalDataSource]:"external_data_source",[f.EPathTypeExternalTable]:"external_table",[f.EPathTypeView]:"view",[f.EPathTypeReplication]:"async_replication"},U={table:f.EPathTypeTable,index:f.EPathTypeTableIndex,column_table:f.EPathTypeColumnTable,external_table:f.EPathTypeExternalTable,view:f.EPathTypeView},q=(e=f.EPathTypeDir,t,a="directory")=>t&&z[t]||F[e]||a,Q={[S.EPathSubTypeSyncIndexImplTable]:"Secondary Index Table",[S.EPathSubTypeAsyncIndexImplTable]:"Secondary Index Table",[S.EPathSubTypeStreamImpl]:void 0,[S.EPathSubTypeEmpty]:void 0},B={[f.EPathTypeInvalid]:void 0,[f.EPathTypeSubDomain]:"Database",[f.EPathTypeExtSubDomain]:"Database",[f.EPathTypeDir]:"Directory",[f.EPathTypeTable]:"Table",[f.EPathTypeTableIndex]:"Secondary Index",[f.EPathTypeColumnStore]:"Tablestore",[f.EPathTypeColumnTable]:"Column-oriented table",[f.EPathTypeCdcStream]:"Changefeed",[f.EPathTypePersQueueGroup]:"Topic",[f.EPathTypeExternalDataSource]:"External Data Source",[f.EPathTypeExternalTable]:"External Table",[f.EPathTypeView]:"View",[f.EPathTypeReplication]:"Async Replication"},$={UnknownTenantType:"Database",Domain:"Cluster Root",Dedicated:"Dedicated Database",Shared:"Shared Database",Serverless:"Serverless Database"},G={[f.EPathTypeTable]:!0,[f.EPathTypeColumnTable]:!0,[f.EPathTypeExternalTable]:!0,[f.EPathTypeView]:!0,[f.EPathTypeInvalid]:!1,[f.EPathTypeDir]:!1,[f.EPathTypeSubDomain]:!1,[f.EPathTypeTableIndex]:!1,[f.EPathTypeExtSubDomain]:!1,[f.EPathTypeColumnStore]:!1,[f.EPathTypeCdcStream]:!1,[f.EPathTypePersQueueGroup]:!1,[f.EPathTypeExternalDataSource]:!1,[f.EPathTypeReplication]:!1},H=e=>{var t;return null!==(t=e&&G[e])&&void 0!==t&&t},W={[S.EPathSubTypeSyncIndexImplTable]:!0,[S.EPathSubTypeAsyncIndexImplTable]:!0,[S.EPathSubTypeStreamImpl]:!1,[S.EPathSubTypeEmpty]:!1},V=e=>{var t;return null!==(t=e&&W[e])&&void 0!==t&&t},J={[f.EPathTypeColumnStore]:!0,[f.EPathTypeColumnTable]:!0,[f.EPathTypeInvalid]:!1,[f.EPathTypeDir]:!1,[f.EPathTypeTable]:!1,[f.EPathTypeSubDomain]:!1,[f.EPathTypeTableIndex]:!1,[f.EPathTypeExtSubDomain]:!1,[f.EPathTypeCdcStream]:!1,[f.EPathTypePersQueueGroup]:!1,[f.EPathTypeExternalDataSource]:!1,[f.EPathTypeExternalTable]:!1,[f.EPathTypeView]:!1,[f.EPathTypeReplication]:!1},Y=e=>{var t;return null!==(t=e&&J[e])&&void 0!==t&&t},K={[f.EPathTypeSubDomain]:!0,[f.EPathTypeExtSubDomain]:!0,[f.EPathTypeInvalid]:!1,[f.EPathTypeDir]:!1,[f.EPathTypeColumnStore]:!1,[f.EPathTypeColumnTable]:!1,[f.EPathTypeTable]:!1,[f.EPathTypeTableIndex]:!1,[f.EPathTypeCdcStream]:!1,[f.EPathTypePersQueueGroup]:!1,[f.EPathTypeExternalDataSource]:!1,[f.EPathTypeExternalTable]:!1,[f.EPathTypeView]:!1,[f.EPathTypeReplication]:!1},Z=e=>{var t;return null!==(t=e&&K[e])&&void 0!==t&&t},X={[f.EPathTypeCdcStream]:!0,[f.EPathTypePersQueueGroup]:!1,[f.EPathTypeInvalid]:!1,[f.EPathTypeColumnStore]:!1,[f.EPathTypeColumnTable]:!1,[f.EPathTypeDir]:!1,[f.EPathTypeTable]:!1,[f.EPathTypeSubDomain]:!1,[f.EPathTypeTableIndex]:!1,[f.EPathTypeExtSubDomain]:!1,[f.EPathTypeExternalDataSource]:!1,[f.EPathTypeExternalTable]:!1,[f.EPathTypeView]:!1,[f.EPathTypeReplication]:!1},ee=e=>{var t;return null!==(t=e&&X[e])&&void 0!==t&&t},te={[S.EPathSubTypeSyncIndexImplTable]:!0,[S.EPathSubTypeAsyncIndexImplTable]:!0,[S.EPathSubTypeStreamImpl]:!1,[S.EPathSubTypeEmpty]:!1},ae={[f.EPathTypeCdcStream]:!0,[f.EPathTypePersQueueGroup]:!0,[f.EPathTypeExternalDataSource]:!0,[f.EPathTypeExternalTable]:!0,[f.EPathTypeView]:!0,[f.EPathTypeReplication]:!0,[f.EPathTypeInvalid]:!1,[f.EPathTypeColumnStore]:!1,[f.EPathTypeColumnTable]:!1,[f.EPathTypeDir]:!1,[f.EPathTypeTable]:!1,[f.EPathTypeSubDomain]:!1,[f.EPathTypeTableIndex]:!1,[f.EPathTypeExtSubDomain]:!1},ne=(e,t)=>{var a;return null!==(a=t&&te[t]||e&&ae[e])&&void 0!==a&&a},re=(f.EPathTypeCdcStream,f.EPathTypePersQueueGroup,f.EPathTypeInvalid,f.EPathTypeColumnStore,f.EPathTypeColumnTable,f.EPathTypeDir,f.EPathTypeTable,f.EPathTypeSubDomain,f.EPathTypeTableIndex,f.EPathTypeExtSubDomain,f.EPathTypeExternalDataSource,f.EPathTypeExternalTable,f.EPathTypeView,f.EPathTypeReplication,e=>e===f.EPathTypeExternalTable),ie=e=>e===f.EPathTypeTable,se=e=>e===f.EPathTypeView;var oe=a(21334);const le=oe.F.injectEndpoints({endpoints:e=>({getMultiOverview:e.query({queryFn:async({paths:e,database:t},{signal:a})=>{try{return{data:await Promise.all(e.map((e=>window.api.viewer.getDescribe({path:e,database:t},{signal:a}))))}}catch(n){return{error:n}}},keepUnusedDataFor:0,providesTags:["All"]}),getOverview:e.query({queryFn:async({path:e,database:t,timeout:a},{signal:n})=>{try{return{data:await window.api.viewer.getDescribe({path:e,database:t,timeout:a},{signal:n})}}catch(r){return{error:r}}},keepUnusedDataFor:0,providesTags:["All"]})})}),ce=(0,x.Mz)((e=>e),((e,t)=>t),((e,t)=>le.endpoints.getOverview.select({path:e,database:t}))),de=(0,x.Mz)((e=>e),((e,t,a)=>ce(t,a)),((e,t)=>t(e).data)),ue=(0,x.Mz)([(e,t)=>t,(e,t,a)=>a,(e,t,a,n)=>((e,t,a)=>{var n,r;return null===(n=de(e,t,a))||void 0===n||null===(r=n.PathDescription)||void 0===r?void 0:r.Children})(e,t,n)],((e,t,a)=>ee(t)?null===a||void 0===a?void 0:a.map((({Name:t})=>e+"/"+t)):void 0));function pe({paths:e,database:t,autoRefreshInterval:a}){const[n,...r]=e,{currentData:i,isFetching:s,error:o}=le.useGetOverviewQuery({path:n,database:t},{pollingInterval:a}),{currentData:l,isFetching:c,error:d}=le.useGetMultiOverviewQuery(r.length?{paths:r,database:t}:b.hT,{pollingInterval:a});return{loading:s&&void 0===i||c&&void 0===l,error:o||d,mergedDescribe:[i,...null!==l&&void 0!==l?l:[]].reduce(((e,t)=>(null!==t&&void 0!==t&&t.Path&&(e[t.Path]=t),e)),{})}}var me=a(76086),he=a(90182),ve=a(22680),ge=a(52531),ye=a(23871),xe=a(52905),be=a(90053),fe=a(67028),Se=a(18517),Ee=a(24555),Te=a(74321),Ne=a(44508),je=a(52248),Ce=a(90565),we=a(49818),Pe=a(86200),Ie=a(61758),De=a.n(Ie),Ae=a(92459),_e=a(58351);const Re=(0,c.cn)("heatmap"),Oe={width:0,height:0},Me=10,ke=e=>{const[t,a]=n.useState(Oe),{tablets:r}=e,i=n.useRef(null),s=n.useRef(null);n.useEffect((()=>{const e=i.current,a=e.getContext("2d");a.clearRect(0,0,e.offsetWidth,e.offsetHeight),r.map(function(e){return(a,n)=>{const{columnsCount:r}=t,i=n%r*12,s=12*Math.floor(n/r);e.fillStyle=a.color||"grey",e.fillRect(i,s,Me,Me)}}(a))})),n.useLayoutEffect((()=>{const e=s.current;if(e){const t=e.offsetWidth-15,n=Math.floor(t/12),i=Math.ceil(r.length/n);a({width:t,height:12*i,columnsCount:n,rowsCount:i})}}),[]);const o=()=>{let e=i.current,t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t},l=()=>{let e=i.current,t=0;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t},c=(e,a)=>{const{columnsCount:n}=t,r=Math.floor(e/12);return n*Math.floor(a/12)+r},u=De()(((t,a)=>{const n=new CustomEvent("scroll");window.dispatchEvent(n);const i=e.parentRef.current,s=t-l()+i.scrollLeft,d=a-o()+i.scrollTop,u=c(s,d),p=r[u];if(p){const n={name:p.currentMetric,value:p.formattedValue};e.showTooltip(void 0,p,"tablet",n,{left:t-20,top:a-20})}else e.hideTooltip()}),20);return(0,d.jsx)("div",{ref:s,className:Re("canvas-container"),onMouseLeave:()=>{setTimeout((()=>{e.hideTooltip()}),40)},children:(0,d.jsx)("canvas",{ref:i,width:t.width,height:t.height,onClick:t=>{const a=e.parentRef.current,n=t.clientX-l()+a.scrollLeft,i=t.clientY-o()+a.scrollTop,s=c(n,i),d=r[s];d&&window.open((e=>{const{TabletId:t}=e,a=window.location.hostname,n=(0,Ae.DM)(t);return`https://${[a,_e.P8,n].map((e=>e.startsWith("/")?e.slice(1):e)).filter(Boolean).join("/")}`})(d),"_blank")},onMouseMove:e=>u(e.clientX,e.clientY)})})},Le={r:255,g:4,b:0},ze={r:255,g:219,b:77},Fe={r:59,g:201,b:53},Ue={CPU:{min:0,max:1e6},Network:{min:0,max:1e9},Storage:{min:0,max:2e9},DataSize:{min:0,max:2e9},RowCount:{min:0},IndexSize:{min:0}},qe=e=>{const t=e.toString(16);return 1===t.length?`0${t}`:t},Qe=(e,t,a)=>{if(1===e)return[t];if(2===e)return[t,a];const n=(t.r-a.r)/(e-1),r=(t.g-a.g)/(e-1),i=(t.b-a.b)/(e-1),s=[];for(let o=0;o<e;o++)s.push({r:Math.round(t.r-n*o),g:Math.round(t.g-r*o),b:Math.round(t.b-i*o)});return s.map((e=>(({r:e,g:t,b:a})=>`#${qe(e)}${qe(t)}${qe(a)}`)(e)))},Be=e=>{const t=Math.floor(e/2),a=t+1;return[...Qe(e%2===0?t:t+1,Fe,ze),...Qe(a,ze,Le).slice(1)]},$e=(e,t)=>{const a=new Set,n=Ue[e]||{};t.forEach((t=>{var n;a.add(Number(null===(n=t.metrics)||void 0===n?void 0:n[e]))})),Number.isInteger(n.min)&&a.add(n.min),Number.isInteger(n.max)&&a.add(n.max);const r=Array.from(a.values()).sort(((e,t)=>e-t));return{min:r[0],max:r[r.length-1]}},Ge=(0,c.cn)("histogram"),He=e=>{const t=n.useRef(),{data:a={},maxCount:r}=e,{count:i,leftBound:s,rightBound:o,color:l}=a,c=i/r*100;return(0,d.jsx)("div",{ref:t,className:Ge("item"),style:{backgroundColor:l,height:`${c}%`},onMouseEnter:()=>{const a=t.current;e.showTooltip(a,{count:i,leftBound:s,rightBound:o},"histogram")},onMouseLeave:e.hideTooltip})},We=e=>{const{tablets:t,currentMetric:a}=e,{min:n,max:r}=$e(a,t),i=Be(50),s=(r-n)/50,o=i.map(((e,t)=>({color:e,count:0,leftBound:(0,Pe.ZV)(n+t*s),rightBound:(0,Pe.ZV)(n+(t+1)*s)})));let l=0;t.forEach((e=>{var t,n;const r=a&&Number(null===(t=e.metrics)||void 0===t?void 0:t[a]),i=Math.floor(r/s),c=(null===(n=o[i])||void 0===n?void 0:n.count)+1;c>l&&(l=c),o[i]={...o[i],count:c}}));return(0,d.jsx)("div",{className:Ge(),children:(0,d.jsxs)("div",{className:Ge("chart"),children:[Boolean(r)&&o.map(((t,a)=>(0,d.jsx)(He,{data:t,maxCount:l,showTooltip:e.showTooltip,hideTooltip:e.hideTooltip},a))),(0,d.jsx)("div",{className:Ge("x-min"),children:(0,Pe.ZV)(n)}),(0,d.jsx)("div",{className:Ge("x-max"),children:(0,Pe.ZV)(r)}),(0,d.jsx)("div",{className:Ge("y-min"),children:"0"}),(0,d.jsx)("div",{className:Ge("y-max"),children:(0,Pe.ZV)(l)})]})})},Ve=(0,c.cn)("heatmap"),Je=Be(500),Ye=({path:e,database:t})=>{const a=(0,he.YQ)(),r=n.createRef(),[i]=(0,he.Nt)(),{currentData:s,isFetching:o,error:l}=Ce.f1.useGetHeatmapTabletsInfoQuery({path:e,database:t},{pollingInterval:i}),c=o&&void 0===s,{tablets:u=[],metrics:p}=s||{},{sort:m,heatmap:h,currentMetric:v}=(0,he.N4)((e=>e.heatmap)),g=(...e)=>{a((0,we.DK)(...e))},y=()=>{a((0,we.w7)())},x=e=>{a((0,Ce.nd)({currentMetric:e[0]}))},b=()=>{a((0,Ce.nd)({sort:!m}))},f=()=>{a((0,Ce.nd)({heatmap:!h}))},S=()=>{const{min:e,max:t}=$e(v,u),a=u.map((a=>{var n;const r=v&&Number(null===(n=a.metrics)||void 0===n?void 0:n[v]),i=((e,t,a)=>0===a?0:Math.round((e-t)/(a-t)*499))(r,e,t),s=Je[i];return{...a,color:s,value:r,formattedValue:(0,Pe.ZV)(r),currentMetric:v}})),n=m?a.sort(((e,t)=>Number(t.value)-Number(e.value))):a;return(0,d.jsx)("div",{ref:r,className:Ve("items"),children:(0,d.jsx)(ke,{tablets:n,parentRef:r,showTooltip:g,hideTooltip:y})})};return c?(0,d.jsx)(je.a,{}):(()=>{const{min:e,max:t}=$e(v,u);let a;return l&&!s||(a=h?S():(0,d.jsx)(We,{tablets:u,currentMetric:v,showTooltip:g,hideTooltip:y})),(0,d.jsxs)("div",{className:Ve(),children:[(0,d.jsxs)("div",{className:Ve("filters"),children:[(0,d.jsx)(Ee.l,{className:Ve("heatmap-select"),value:v?[v]:[],options:p,onUpdate:x,width:200}),(0,d.jsx)("div",{className:Ve("sort-checkbox"),children:(0,d.jsx)(Te.S,{onUpdate:b,checked:m,children:"Sort"})}),(0,d.jsx)("div",{className:Ve("histogram-checkbox"),children:(0,d.jsx)(Te.S,{onUpdate:f,checked:h,children:"Heatmap"})}),(0,d.jsxs)("div",{className:Ve("limits"),children:[(0,d.jsxs)("div",{className:Ve("limits-block"),children:[(0,d.jsx)("div",{className:Ve("limits-title"),children:"min:"}),(0,d.jsx)("div",{className:Ve("limits-value"),children:Number.isInteger(e)?(0,Pe.ZV)(e):"\u2014"})]}),(0,d.jsxs)("div",{className:Ve("limits-block"),children:[(0,d.jsx)("div",{className:Ve("limits-title"),children:"max:"}),(0,d.jsx)("div",{className:Ve("limits-value"),children:Number.isInteger(t)?(0,Pe.ZV)(t):"\u2014"})]}),(0,d.jsxs)("div",{className:Ve("limits-block"),children:[(0,d.jsx)("div",{className:Ve("limits-title"),children:"count:"}),(0,d.jsx)("div",{className:Ve("limits-value"),children:(0,Pe.ZV)(u.length)})]})]})]}),l?(0,d.jsx)(Ne.o,{error:l}):null,a]})})()};var Ke=a(7117),Ze=a(59109),Xe=a(17594),et=a(89073);const tt=oe.F.injectEndpoints({endpoints:e=>({getOperationList:e.query({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.operation.getOperationList(e,{signal:t})}}catch(a){return{error:a}}},providesTags:["All"]}),cancelOperation:e.mutation({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.operation.cancelOperation(e,{signal:t})}}catch(a){return{error:a}}}}),forgetOperation:e.mutation({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.operation.forgetOperation(e,{signal:t})}}catch(a){return{error:a}}}})}),overrideExisting:"throw"});var at=a(28539),nt=a(95963),rt=a(48372);const it=JSON.parse('{"label_operations":"Operations","title_empty":"No operations data","pleaceholder_search":"Search operations","placeholder_kind":"Select operation kind","kind_ssBackgrounds":"SS/Backgrounds","kind_export":"Export","kind_buildIndex":"Build Index","column_operationId":"Operation ID","column_status":"Status","column_createdBy":"Created By","column_createTime":"Create Time","column_endTime":"End Time","column_duration":"Duration","label_duration-ongoing":"{{value}} (ongoing)","header_cancel":"Cancel operation","header_forget":"Forget operation","text_cancel":"The operation will be cancelled. Do you want to proceed?","text_forget":"The operation will be forgotten. Do you want to proceed?","text_forgotten":"The operation {{id}} has been forgotten","text_cancelled":"The operation {{id}} has been cancelled"}'),st=(0,rt.g4)("ydb-operations",{en:it}),ot="id",lt="status",ct="created_by",dt="create_time",ut="end_time",pt="duration",mt={[ot]:st("column_operationId"),[lt]:st("column_status"),[ct]:st("column_createdBy"),[dt]:st("column_createTime"),[ut]:st("column_endTime"),[pt]:st("column_duration")},ht=[{value:"export",content:st("kind_export")},{value:"ss/backgrounds",content:st("kind_ssBackgrounds")},{value:"buildindex",content:st("kind_buildIndex")}],vt=(0,c.cn)("operations");function gt({kind:e,searchValue:t,entitiesCountCurrent:a,entitiesCountTotal:r,entitiesLoading:i,handleKindChange:s,handleSearchChange:o}){return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(nt.v,{value:t,onChange:o,placeholder:st("pleaceholder_search"),className:vt("search")}),(0,d.jsx)(Ee.l,{value:[e],width:150,options:ht,onUpdate:e=>s(e[0])}),(0,d.jsx)(at.T,{label:st("label_operations"),loading:i,total:r,current:a})]})}var yt=a(14750),xt=a(58272),bt=a(45345),ft=a(98089),St=a(87184),Et=a(18650),Tt=a(99991),Nt=a(22983),jt=a(71661);let Ct,wt;!function(e){e.STATUS_CODE_UNSPECIFIED="STATUS_CODE_UNSPECIFIED",e.SUCCESS="SUCCESS",e.BAD_REQUEST="BAD_REQUEST",e.UNAUTHORIZED="UNAUTHORIZED",e.INTERNAL_ERROR="INTERNAL_ERROR",e.ABORTED="ABORTED",e.UNAVAILABLE="UNAVAILABLE",e.OVERLOADED="OVERLOADED",e.SCHEME_ERROR="SCHEME_ERROR",e.GENERIC_ERROR="GENERIC_ERROR",e.TIMEOUT="TIMEOUT",e.BAD_SESSION="BAD_SESSION",e.PRECONDITION_FAILED="PRECONDITION_FAILED",e.ALREADY_EXISTS="ALREADY_EXISTS",e.NOT_FOUND="NOT_FOUND",e.SESSION_EXPIRED="SESSION_EXPIRED",e.CANCELLED="CANCELLED",e.UNDETERMINED="UNDETERMINED",e.UNSUPPORTED="UNSUPPORTED",e.SESSION_BUSY="SESSION_BUSY",e.EXTERNAL_ERROR="EXTERNAL_ERROR"}(Ct||(Ct={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PREPARING="STATE_PREPARING",e.STATE_TRANSFERING_DATA="STATE_TRANSFERING_DATA",e.STATE_APPLYING="STATE_APPLYING",e.STATE_DONE="STATE_DONE",e.STATE_CANCELLATION="STATE_CANCELLATION",e.STATE_CANCELLED="STATE_CANCELLED",e.STATE_REJECTION="STATE_REJECTION",e.STATE_REJECTED="STATE_REJECTED"}(wt||(wt={}));var Pt=a(59625);const It=function({name:e,title:t,type:a,content:n}){return Pt.X.add({name:null!==e&&void 0!==e?e:"Request succeeded",title:null!==t&&void 0!==t?t:"Request succeeded",theme:"error"===a?"danger":"success",content:n,isClosable:!0,autoHiding:"success"===a&&5e3})};var Dt=a(73891);function At({database:e,refreshTable:t}){return[{name:ot,header:mt[ot],width:340,render:({row:e})=>e.id?(0,d.jsx)(jt.s,{placement:["top","bottom"],content:e.id,children:e.id}):me.Pd},{name:lt,header:mt[lt],render:({row:e})=>e.status?(0,d.jsx)(ft.E,{color:e.status===Ct.SUCCESS?"positive":"danger",children:e.status}):me.Pd},{name:ct,header:mt[ct],render:({row:e})=>e.created_by?e.created_by:me.Pd},{name:dt,header:mt[dt],render:({row:e})=>e.create_time?(0,Pe.r6)((0,Dt.ee)(e.create_time)):me.Pd,sortAccessor:e=>e.create_time?(0,Dt.ee)(e.create_time):0},{name:ut,header:mt[ut],render:({row:e})=>e.end_time?(0,Pe.r6)((0,Dt.ee)(e.end_time)):me.Pd,sortAccessor:e=>e.end_time?(0,Dt.ee)(e.end_time):Number.MAX_SAFE_INTEGER},{name:pt,header:mt[pt],render:({row:e})=>{let t=0;if(!e.create_time)return me.Pd;const a=(0,Dt.ee)(e.create_time);if(e.end_time){t=(0,Dt.ee)(e.end_time)-a}else t=Date.now()-a;const n=t>me.Jg*me.KF?(0,yt.p0)(t).format("hh:mm:ss"):(0,yt.p0)(t).format("mm:ss");return e.end_time?n:st("label_duration-ongoing",{value:n})},sortAccessor:e=>{if(!e.create_time)return 0;const t=(0,Dt.ee)(e.create_time);if(e.end_time){return(0,Dt.ee)(e.end_time)-t}return Date.now()-t}},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:({row:a})=>(0,d.jsx)(_t,{operation:a,database:e,refreshTable:t})}]}function _t({operation:e,database:t,refreshTable:a}){const[n,{isLoading:r}]=tt.useCancelOperationMutation(),[i,{isLoading:s}]=tt.useForgetOperationMutation(),o=e.id;return o?(0,d.jsxs)(St.s,{gap:"2",children:[(0,d.jsx)(Et.m,{title:st("header_forget"),placement:["left","auto"],children:(0,d.jsx)("div",{children:(0,d.jsx)(Nt.B,{buttonView:"outlined",dialogHeader:st("header_forget"),dialogText:st("text_forget"),onConfirmAction:()=>i({id:o,database:t}).unwrap().then((()=>{It({name:"Forgotten",title:st("text_forgotten",{id:o}),type:"success"}),a()})),buttonDisabled:r,children:(0,d.jsx)(Tt.I,{data:xt.A})})})}),(0,d.jsx)(Et.m,{title:st("header_cancel"),placement:["right","auto"],children:(0,d.jsx)("div",{children:(0,d.jsx)(Nt.B,{buttonView:"outlined",dialogHeader:st("header_cancel"),dialogText:st("text_cancel"),onConfirmAction:()=>n({id:o,database:t}).unwrap().then((()=>{It({name:"Cancelled",title:st("text_cancelled",{id:o}),type:"success"}),a()})),buttonDisabled:s,children:(0,d.jsx)(Tt.I,{data:bt.A})})})})]}):null}var Rt=a(370);const Ot=Rt.z.enum(["ss/backgrounds","export","buildindex"]).catch("buildindex");function Mt({database:e}){var t;const[a]=(0,he.Nt)(),{kind:r,searchValue:o,pageSize:l,pageToken:c,handleKindChange:u,handleSearchChange:p}=function(){var e,t,a;const[n,r]=(0,i.useQueryParams)({kind:i.StringParam,search:i.StringParam,pageSize:i.NumberParam,pageToken:i.StringParam});return{kind:Ot.parse(n.kind),searchValue:null!==(e=n.search)&&void 0!==e?e:"",pageSize:null!==(t=n.pageSize)&&void 0!==t?t:void 0,pageToken:null!==(a=n.pageToken)&&void 0!==a?a:void 0,handleKindChange:e=>{r({kind:e},"replaceIn")},handleSearchChange:e=>{r({search:e||void 0},"replaceIn")},handlePageSizeChange:e=>{r({pageSize:e},"replaceIn")},handlePageTokenChange:e=>{r({pageToken:e},"replaceIn")}}}(),{data:m,isFetching:h,error:v,refetch:g}=tt.useGetOperationListQuery({database:e,kind:r,page_size:l,page_token:c},{pollingInterval:a}),y=n.useMemo((()=>null!==m&&void 0!==m&&m.operations?m.operations.filter((e=>{var t;return null===(t=e.id)||void 0===t?void 0:t.toLowerCase().includes(o.toLowerCase())})):[]),[null===m||void 0===m?void 0:m.operations,o]);return(0,s.P)(v)?(0,d.jsx)(Ze.O,{position:"left"}):(0,d.jsxs)(et.L,{children:[(0,d.jsx)(et.L.Controls,{children:(0,d.jsx)(gt,{kind:r,searchValue:o,entitiesCountCurrent:y.length,entitiesCountTotal:null===m||void 0===m||null===(t=m.operations)||void 0===t?void 0:t.length,entitiesLoading:h,handleKindChange:u,handleSearchChange:p})}),v?(0,d.jsx)(Ne.o,{error:v}):null,(0,d.jsx)(et.L.Table,{loading:h,className:vt("table"),children:m?(0,d.jsx)(Xe.l,{columns:At({database:e,refreshTable:g}),data:y,emptyDataMessage:st("title_empty")}):null})]})}var kt=a(41122),Lt=a(76768),zt=a(19228),Ft=a(11822);function Ut(e){return`SELECT * FROM \`${e}\` LIMIT 0`}const qt=oe.F.injectEndpoints({endpoints:e=>({getViewSchema:e.query({queryFn:async({database:e,path:t,timeout:a})=>{try{var n,r;const i=await window.api.viewer.sendQuery({query:Ut(t),database:e,action:"execute-scan",timeout:a},{withRetries:!0});return(0,Ft.We)(i)?{error:i}:{data:(null===i||void 0===i||null===(n=i.result)||void 0===n||null===(r=n[0])||void 0===r?void 0:r.columns)||[]}}catch(i){return{error:i}}},providesTags:["All"]})}),overrideExisting:"throw"});var Qt=a(47665),Bt=a(24543);const $t=JSON.parse('{"column-title.id":"Id","column-title.name":"Name","column-title.type":"Type","column-title.notNull":"NotNull","column-title.autoIncrement":"AutoIncrement","column-title.defaultValue":"Default","column-title.family":"Family","column-title.media":"Media","column-title.compression":"Compression","primary-key.title":"Primary key:","partitioning-key.title":"Partitioning key:"}'),Gt=(0,rt.g4)("ydb-schema-viewer",{en:$t}),Ht=(0,c.cn)("schema-viewer");const Wt=({tableData:e,extended:t,type:a})=>{const n="primary"===a?function(e){return e.filter((e=>void 0!==e.keyColumnIndex&&-1!==e.keyColumnIndex&&e.name)).sort(((e,t)=>e.keyColumnIndex-t.keyColumnIndex)).map((e=>e.name))}(e):function(e){return e.filter((e=>e.isPartitioningKeyColumn&&e.name)).map((e=>e.name))}(e),r=t?3:n.length,i=n.slice(0,r),s=n.slice(r);return n.length>0?(0,d.jsxs)("div",{className:Ht("keys",{summary:!t,type:a}),children:[(0,d.jsx)("div",{className:Ht("keys-header"),children:Gt("primary"===a?"primary-key.title":"partitioning-key.title")}),(0,d.jsxs)("div",{className:Ht("keys-values"),children:[" "+i.join(", "),s.length?(0,d.jsx)(Bt.u,{className:Ht("more-badge"),placement:["bottom"],hasArrow:!1,pinOnClick:!0,content:(0,d.jsx)("div",{className:Ht("popup-content"),children:s.map((e=>(0,d.jsx)("div",{className:Ht("popup-item"),children:e},e)))}),children:(0,d.jsx)(Qt.J,{className:Ht("keys-label"),children:`+${s.length}`})}):null]})]}):null};var Vt=a(4557);const Jt="name",Yt="type",Kt="notNull",Zt="autoIncrement",Xt="defaultValue",ea="familyName",ta="prefferedPoolKind",aa="columnCodec",na={name:"id",get header(){return Gt("column-title.id")},width:60,render:({row:e})=>e.id},ra={name:Jt,get header(){return Gt("column-title.name")},width:100,render:({row:e})=>e.name},ia={name:Yt,get header(){return Gt("column-title.type")},width:100,render:({row:e})=>e.type},sa={name:Kt,get header(){return Gt("column-title.notNull")},width:100,defaultOrder:Vt.Ay.DESCENDING,render:({row:e})=>{if(e.notNull)return"\u2713"}},oa={name:Zt,get header(){return Gt("column-title.autoIncrement")},width:100,defaultOrder:Vt.Ay.DESCENDING,render:({row:e})=>{if(e.autoIncrement)return"\u2713"}},la={name:Xt,get header(){return Gt("column-title.defaultValue")},width:100,render:({row:e})=>String(e.defaultValue)},ca={name:ea,get header(){return Gt("column-title.family")},width:100,render:({row:e})=>e.familyName},da={name:ta,get header(){return Gt("column-title.media")},width:100,render:({row:e})=>e.prefferedPoolKind},ua={name:aa,get header(){return Gt("column-title.compression")},width:100,render:({row:e})=>e.columnCodec};function pa(e={}){const t=function(e){var t,a,n;return null!==(t=null===e||void 0===e||null===(a=e.PartitionConfig)||void 0===a||null===(n=a.ColumnFamilies)||void 0===n?void 0:n.reduce(((e,t)=>t.Id?{...e,[t.Id]:t}:e),{}))&&void 0!==t?t:{}}(e),{Columns:a,KeyColumnNames:n}=e,r=null===a||void 0===a?void 0:a.map((e=>{var a,r,i,s;const{Id:o,Name:l,NotNull:c,Type:d,Family:u,DefaultFromSequence:p,DefaultFromLiteral:m}=e,h=null!==(a=null===n||void 0===n?void 0:n.findIndex((e=>e===l)))&&void 0!==a?a:-1,v=u?t[u].Name:void 0,g=u?null===(r=t[u].StorageConfig)||void 0===r||null===(i=r.Data)||void 0===i?void 0:i.PreferredPoolKind:void 0,y=u?function(e){if(e)return e===T.ColumnCodecPlain?"None":e.replace("ColumnCodec","").toLocaleLowerCase()}(t[u].ColumnCodec):void 0;return{id:o,name:l,keyColumnIndex:h,type:d,notNull:c,autoIncrement:Boolean(p),defaultValue:null!==(s=Object.values((null===m||void 0===m?void 0:m.value)||{})[0])&&void 0!==s?s:"-",familyName:v,prefferedPoolKind:g,columnCodec:y}}));return[...(null===r||void 0===r?void 0:r.filter((e=>-1!==e.keyColumnIndex)))||[],...(null===r||void 0===r?void 0:r.filter((e=>-1===e.keyColumnIndex)))||[]]}function ma(e,t){const{Table:a,ColumnTableDescription:n,ExternalTableDescription:r}=(null===t||void 0===t?void 0:t.PathDescription)||{};return ie(e)?pa(a):Y(e)?function(e={}){const{Schema:t={},Sharding:a={}}=e,{Columns:n,KeyColumnNames:r}=t,{HashSharding:i={}}=a,{Columns:s=[]}=i,o=null===n||void 0===n?void 0:n.map((e=>{var t;const{Id:a,Name:n,Type:i,NotNull:o}=e,l=null!==(t=null===r||void 0===r?void 0:r.findIndex((e=>e===n)))&&void 0!==t?t:-1,c=Boolean(null===s||void 0===s?void 0:s.find((e=>e===n)));return{id:a,name:n,keyColumnIndex:l,isPartitioningKeyColumn:c,type:i,notNull:o}}));return[...(null===o||void 0===o?void 0:o.filter((e=>-1!==e.keyColumnIndex)))||[],...(null===o||void 0===o?void 0:o.filter((e=>-1===e.keyColumnIndex)))||[]]}(n):re(e)?function(e={}){const{Columns:t}=e;return(null===t||void 0===t?void 0:t.map((e=>{const{Id:t,Name:a,Type:n,NotNull:r}=e;return{id:t,name:a,type:n,notNull:r}})))||[]}(r):[]}function ha(e){return(null===e||void 0===e?void 0:e.map((e=>{var t;return{type:null!==(t=e.type)&&void 0!==t&&t.endsWith("?")?e.type.slice(0,-1):e.type,name:e.name}})))||[]}const va=({type:e,path:t,tenantName:a,extended:r=!1})=>{const[i]=(0,he.Nt)(),{currentData:s,isLoading:o}=le.useGetOverviewQuery({path:t,database:a},{pollingInterval:i}),l=se(e)?{path:t,database:a}:b.hT,{data:c,isLoading:u}=qt.useGetViewSchemaQuery(l),p=n.useMemo((()=>se(e)?ha(c):ma(e,s)),[s,e,c]),m=n.useMemo((()=>p.some((e=>e.autoIncrement))),[p]),h=n.useMemo((()=>p.some((e=>e.defaultValue))),[p]),v=n.useMemo((()=>se(e)?[ra,ia]:re(e)||Y(e)?[na,ra,ia,sa]:ie(e)?function(e,t,a){const n=[na,ra,ia,sa];return a&&n.push(la),e&&n.push(ca,da,ua),t&&n.push(oa),n}(r,m,h):[]),[e,r,m,h]);return o||u?(0,d.jsx)(zt.Q,{}):(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)("div",{className:Ht("keys-wrapper"),children:[(0,d.jsx)(Wt,{tableData:p,extended:r,type:"primary"}),(0,d.jsx)(Wt,{tableData:p,extended:r,type:"partitioning"})]}),(0,d.jsx)("div",{className:Ht(),children:(0,d.jsx)(Xe.l,{columnsWidthLSKey:"schemaTableColumnsWidth",data:p,columns:v,settings:me.N3})})]})};var ga=a(54309),ya=a(96589),xa=a(84375),ba=a(85589);const fa=JSON.parse('{"td-feature-flag":"Feature flag","td-default":"Default","td-current":"Current","enabled":"Enabled","disabled":"Disabled","flag-touched":"Flag is changed","search-placeholder":"Search by feature flag","search-empty":"Empty search result","no-data":"No data"}'),Sa=(0,rt.g4)("ydb-diagnostics-configs",{en:fa}),Ea=(0,c.cn)("ydb-diagnostics-configs"),Ta=[{name:"Touched",header:"",render:({row:e})=>e.Current?(0,d.jsx)(xa.A,{content:Sa("flag-touched"),className:Ea("icon-touched"),placement:"left",children:(0,d.jsx)(Tt.I,{data:ya.A})}):null,width:36,sortable:!1,resizeable:!1},{name:"Name",get header(){return Sa("td-feature-flag")},render:({row:e})=>e.Current?(0,d.jsx)("b",{children:e.Name}):e.Name,width:400,sortable:!0,sortAccessor:({Current:e,Name:t})=>Number(!e)+t.toLowerCase()},{name:"Default",get header(){return Sa("td-default")},render:({row:e})=>{switch(e.Default){case!0:return Sa("enabled");case!1:return Sa("disabled");default:return"-"}},width:100,sortable:!1,resizeable:!1},{name:"Current",get header(){return Sa("td-current")},render:({row:e})=>{var t;return(0,d.jsx)(ba.d,{disabled:!0,checked:(null!==(t=e.Current)&&void 0!==t?t:e.Default)||!1})},width:100,sortable:!1,resizeable:!1}],Na=({database:e})=>{const[t,a]=(0,i.useQueryParam)("search",i.StringParam),{currentData:n=[],isFetching:r,error:s}=Se.z6.useGetClusterConfigQuery({database:e}),o=null===t||void 0===t?void 0:t.toLocaleLowerCase(),l=o?n.filter((e=>e.Name.toLocaleLowerCase().includes(o))):n;return(0,d.jsxs)(et.L,{children:[(0,d.jsx)(et.L.Controls,{children:(0,d.jsx)(nt.v,{value:o,onChange:e=>{a(e||void 0,"replaceIn")},placeholder:Sa("search-placeholder")})}),(0,d.jsx)(et.L.Table,{loading:r,children:s?(0,d.jsx)(Ne.o,{error:s}):(0,d.jsx)(Xe.l,{emptyDataMessage:Sa(o?"search-empty":"no-data"),columnsWidthLSKey:"featureFlagsColumnsWidth",columns:Ta,data:l,settings:me.N3})})]})};var ja=a(23536),Ca=a.n(ja),wa=a(46549);const Pa=oe.F.injectEndpoints({endpoints:e=>({getTopic:e.query({queryFn:async e=>{try{const t=await window.api.viewer.getTopic(e);return"object"!==typeof t?{error:{}}:{data:t}}catch(t){return{error:t}}},providesTags:["All"]})}),overrideExisting:"throw"}),Ia=(0,x.Mz)((e=>e),((e,t)=>t),((e,t)=>Pa.endpoints.getTopic.select({path:e,database:t}))),Da=(0,x.Mz)((e=>e),((e,t,a)=>Ia(t,a)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.topic_stats})),Aa=(0,x.Mz)((e=>e),((e,t,a)=>Ia(t,a)),((e,t)=>{var a;return null===(a=t(e).data)||void 0===a?void 0:a.consumers})),_a=(0,x.Mz)(Aa,(e=>null===e||void 0===e?void 0:e.map((e=>null===e||void 0===e?void 0:e.name)).filter((e=>void 0!==e)))),Ra=(0,x.Mz)(Da,(e=>{if(!e)return;const{store_size_bytes:t="0",min_last_write_time:a,max_write_time_lag:n,bytes_written:r}=e||{};return{storeSize:t,partitionsIdleTime:(0,Dt.MC)(a),partitionsWriteLag:(0,Dt.i6)(n),writeSpeed:(0,wa.ey)(r)}})),Oa=(0,x.Mz)(Aa,(e=>null===e||void 0===e?void 0:e.map((e=>{const{name:t,consumer_stats:a}=e||{},{min_partitions_last_read_time:n,max_read_time_lag:r,max_write_time_lag:i,bytes_read:s}=a||{};return{name:t,readSpeed:(0,wa.ey)(s),writeLag:(0,Dt.i6)(i),readLag:(0,Dt.i6)(r),readIdleTime:(0,Dt.MC)(n)}})))),Ma=JSON.parse('{"averageSpeed":"Average speed","perMinute":"per minute","perHour":"per hour","perDay":"per day"}'),ka=JSON.parse('{"averageSpeed":"\u0421\u0440\u0435\u0434\u043d\u044f\u044f \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u044c","perMinute":"\u0437\u0430 \u043c\u0438\u043d\u0443\u0442\u0443","perHour":"\u0437\u0430 \u0447\u0430\u0441","perDay":"\u0437\u0430 \u0434\u0435\u043d\u044c"}'),La=(0,rt.g4)("ydb-components-speed-multimeter",{ru:ka,en:Ma}),za=(0,c.cn)("speed-multimeter"),Fa=({data:e,speedSize:t="kb",withValue:a=!0,withPopover:r=!0})=>{const{perMinute:i=0,perHour:s=0,perDay:o=0}=e||{},l=[i,s,o],c=e=>(0,wa.z3)({value:e,size:t,withSpeedLabel:!0}),u=[{value:c(i),label:La("perMinute")},{value:c(s),label:La("perHour")},{value:c(o),label:La("perDay")}],[p,m]=n.useState(i),[h,v]=n.useState(a?0:void 0),[g,y]=n.useState(),x=(e,t)=>{m(e[t]),v(t),y(t)},b=e=>h===e,f=e=>g===e;return(0,d.jsx)("div",{className:za(),children:(0,d.jsxs)("div",{className:za("content"),children:[a&&(0,d.jsx)("div",{className:za("displayed-value"),children:c(p)}),(0,d.jsx)(xa.A,{content:(0,d.jsxs)("div",{className:za("popover-content"),children:[(0,d.jsx)("span",{className:za("popover-header"),children:La("averageSpeed")}),u.map(((e,t)=>{return(0,d.jsx)("span",{className:za("popover-row",(a=b(t),a?{color:"primary"}:{color:"secondary"})),children:`${e.label}: ${e.value}`},t);var a}))]}),className:za("popover-container"),placement:"bottom",disabled:!r,hasArrow:!0,size:"s",children:(0,d.jsx)("div",{className:za("bars"),onMouseLeave:()=>{m(i),v(a?0:void 0),y(void 0)},children:(()=>{const e=Math.max(...l,0)||1;return l.map(((t,a)=>(0,d.jsx)("div",{className:za("bar-container",{highlighted:f(a)}),onMouseEnter:x.bind(null,l,a),children:(0,d.jsx)("div",{className:za("bar",{color:b(a)?"dark":"light"}),style:{width:100*t/e+"%"}})},a)))})()})})]})})},Ua=(0,c.cn)("ydb-diagnostics-consumers-topic-stats"),qa=({data:e})=>{const{writeSpeed:t,partitionsWriteLag:a,partitionsIdleTime:n}=e||{},r=[{label:"Write speed",value:(0,d.jsx)(Fa,{data:t})},{label:"Write lag",value:(0,Pe.lr)(a||0)},{label:"Write idle time",value:(0,Pe.lr)(n||0)}];return(0,d.jsx)("div",{className:Ua("wrapper"),children:r.map(((e,t)=>(0,d.jsxs)("div",{className:Ua("item"),children:[(0,d.jsx)("div",{className:Ua("label"),children:e.label}),(0,d.jsx)("div",{className:Ua("value"),children:e.value})]},t)))})};var Qa=a(74309),Ba=a.n(Qa),$a=a(44294),Ga=a(6170);const Ha=({text:e,popoverContent:t,popoverClassName:a,className:n,contentClassName:r,buttonProps:i})=>(0,d.jsxs)("div",{className:n,children:[e,"\xa0",(0,d.jsx)(Ga.B,{className:a,buttonProps:i,content:t,contentClassName:r})]}),Wa=70,Va=54,Ja=268,Ya="#ADE8F5",Ka="#f5be9d",Za=({width:e,height:t,transform:a})=>(0,d.jsx)("path",{d:`M-${e/2} 0 c0 -${t}, ${e} -${t}, ${e} 0`,fill:"none",strokeDasharray:"4,6",stroke:"#28f",strokeWidth:"1.6",transform:a}),Xa=({width:e})=>(0,d.jsx)("path",{fill:"none",strokeWidth:"2",d:`M0 0 h${e} l-10 -5 m0 10 l10 -5`}),en=()=>(0,d.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,d.jsx)("g",{transform:"translate(0, 27)",stroke:Ka,children:(0,d.jsx)(Xa,{width:203})}),(0,d.jsxs)("g",{transform:"translate(30, 0)",children:[(0,d.jsxs)("g",{transform:"translate(35, 27)",children:[(0,d.jsx)(Za,{width:Wa,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,d.jsxs)("g",{transform:"translate(119, 27)",children:[(0,d.jsx)(Za,{width:98,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write idle time"})})]})]}),(0,d.jsxs)("g",{transform:"translate(30, 0)",children:[(0,d.jsxs)("g",{transform:"translate(0, 27)",children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:Ka}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,d.jsxs)("g",{transform:"translate(70, 27)",children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:Ka}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,d.jsx)("g",{transform:"translate(168, 27)",children:(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),tn=()=>(0,d.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,d.jsx)("g",{transform:"translate(0, 27)",stroke:Ya,children:(0,d.jsx)(Xa,{width:Ja})}),(0,d.jsxs)("g",{transform:"translate(30, 0)",children:[(0,d.jsxs)("g",{transform:"translate(105, 27)",children:[(0,d.jsx)(Za,{width:Wa,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read lag"})})]}),(0,d.jsxs)("g",{transform:"translate(35, 27)",children:[(0,d.jsx)(Za,{width:Wa,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,d.jsxs)("g",{transform:"translate(182, 27)",children:[(0,d.jsx)(Za,{width:91,height:15}),(0,d.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read idle time"})})]})]}),(0,d.jsxs)("g",{transform:"translate(30, 27)",children:[(0,d.jsxs)("g",{transform:"translate(0, 0)",children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:Ya}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,d.jsxs)("g",{transform:"translate(70, 0)",children:[(0,d.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:Ya}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,d.jsxs)("g",{transform:"translate(140, 0)",children:[(0,d.jsx)("use",{x:"-2",y:"-10",xlinkHref:"#check",stroke:Ya}),(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"read time"})})]}),(0,d.jsx)("g",{transform:"translate(224, 0)",children:(0,d.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,d.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),an=({id:e,fill:t})=>(0,d.jsx)("pattern",{id:e,x:"0",y:"0",width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,d.jsx)("path",{d:"M0 5L5 0H8L0 8V5M5 8L8 5V8Z",fill:t})}),nn=()=>(0,d.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 268 54",width:Ja,height:Va,children:[(0,d.jsxs)("defs",{children:[(0,d.jsx)("g",{id:"check",children:(0,d.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,d.jsx)(an,{id:"latest-read",fill:Ya}),(0,d.jsx)(an,{id:"latest-write",fill:Ka})]}),(0,d.jsx)(en,{})]}),rn=()=>(0,d.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 268 54",width:Ja,height:Va,children:[(0,d.jsxs)("defs",{children:[(0,d.jsx)("g",{id:"check",children:(0,d.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,d.jsx)(an,{id:"latest-read",fill:Ya}),(0,d.jsx)(an,{id:"latest-write",fill:Ka})]}),(0,d.jsx)(tn,{})]}),sn=(0,c.cn)("ydb-lag-popover-content"),on=({text:e,type:t})=>(0,d.jsxs)("div",{className:sn({type:t}),children:[(0,d.jsx)("div",{className:sn("text"),children:e}),(0,d.jsx)("div",{children:"read"===t?(0,d.jsx)(rn,{}):(0,d.jsx)(nn,{})})]}),ln=JSON.parse('{"noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers","lagsPopover.readLags":"Read lags statistics, maximum among all consumer partitions (time format dd hh:mm:ss)","table.emptyDataMessage":"No consumers match the current search","controls.search":"Consumer"}'),cn=JSON.parse('{"noConsumersMessage.topic":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0442\u043e\u043f\u0438\u043a\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","noConsumersMessage.stream":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0440\u0438\u043c\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","lagsPopover.readLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0447\u0442\u0435\u043d\u0438\u044f, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","table.emptyDataMessage":"\u041f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0438\u0441\u043a\u0443 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","controls.search":"Consumer"}'),dn=(0,rt.g4)("ydb-diagnostics-consumers",{ru:cn,en:ln}),un="consumer",pn="readSpeed",mn="readLags",hn={[un]:"Consumer",[pn]:"Read speed",[mn]:"Read lags, duration"},vn="writeLag",gn="readLag",yn="readIdleTime",xn={[vn]:"write lag",[gn]:"read lag",[yn]:"read idle time"},bn=(0,c.cn)("ydb-diagnostics-consumers-columns-header"),fn=()=>(0,d.jsx)(Ha,{className:bn("lags"),text:hn[mn],popoverContent:(0,d.jsx)(on,{text:dn("lagsPopover.readLags"),type:"read"})}),Sn=(0,c.cn)("ydb-diagnostics-consumers-columns"),En=[{name:un,header:hn[un],align:Vt.Ay.LEFT,render:({row:e})=>{if(!e.name)return"\u2013";const t=Ba().parse(location.search,{ignoreQueryPrefix:!0});return(0,d.jsx)($a.E,{to:(0,ga.YL)({...t,[ga.vh.diagnosticsTab]:ge.iJ.partitions,selectedConsumer:e.name}),children:e.name})}},{name:pn,header:hn[pn],align:Vt.Ay.RIGHT,resizeMinWidth:140,sortAccessor:e=>e.readSpeed.perMinute,render:({row:e})=>(0,d.jsx)(Fa,{data:e.readSpeed})},{name:mn,header:(0,d.jsx)(fn,{}),className:Sn("lags-header"),sub:[{name:vn,header:xn[vn],align:Vt.Ay.RIGHT,render:({row:e})=>(0,Pe.lr)(e.writeLag)},{name:gn,header:xn[gn],align:Vt.Ay.RIGHT,render:({row:e})=>(0,Pe.lr)(e.readLag)},{name:yn,header:xn[yn],align:Vt.Ay.RIGHT,render:({row:e})=>(0,Pe.lr)(e.readIdleTime)}]}],Tn=(0,c.cn)("ydb-diagnostics-consumers"),Nn=({path:e,database:t,type:a})=>{const r=(e=>e===f.EPathTypeCdcStream)(a),[i,s]=n.useState(""),[o]=(0,he.Nt)(),{currentData:l,isFetching:c,error:u}=Pa.useGetTopicQuery({path:e,database:t},{pollingInterval:o}),p=c&&void 0===l,m=(0,he.N4)((a=>Oa(a,e,t))),h=(0,he.N4)((a=>Ra(a,e,t))),v=n.useMemo((()=>{if(!m)return[];const e=new RegExp(Ca()(i),"i");return m.filter((t=>e.test(String(t.name))))}),[m,i]);return p?(0,d.jsx)(je.a,{size:"m"}):u||m&&m.length?(0,d.jsxs)("div",{className:Tn(),children:[(0,d.jsxs)("div",{className:Tn("controls"),children:[(0,d.jsx)(nt.v,{onChange:e=>{s(e)},placeholder:dn("controls.search"),className:Tn("search"),value:i}),h&&(0,d.jsx)(qa,{data:h})]}),u?(0,d.jsx)(Ne.o,{error:u}):null,m?(0,d.jsx)("div",{className:Tn("table-wrapper"),children:(0,d.jsx)("div",{className:Tn("table-content"),children:(0,d.jsx)(Xe.l,{columnsWidthLSKey:"consumersColumnsWidth",wrapperClassName:Tn("table"),data:v,columns:En,settings:me.N3,emptyDataMessage:dn("table.emptyDataMessage")})})}):null]}):(0,d.jsx)("div",{children:dn("noConsumersMessage."+(r?"stream":"topic"))})};var jn=a(96873),Cn=a(97434),wn=a(84476),Pn=a(67063),In=a.n(Pn);const Dn=JSON.parse('{"context_case-sensitive-search":"Case sensitive search enadled","context_case-sensitive-search-disabled":"Case sensitive search disabled"}'),An=(0,rt.g4)("ydb-json-tree",{en:Dn});var _n=a(94630);a(91434);const Rn=(0,c.cn)("ydb-json-tree");function On({treeClassName:e,search:t,...a}){const[n,r]=(0,he.iK)(me.iD,!1);return(0,d.jsxs)("div",{className:Rn(),children:[(0,d.jsx)(In(),{className:Rn("tree",e),filterOptions:{ignoreCase:!n},searchOptions:{debounceTime:300},...a}),!1!==t&&(0,d.jsx)(Et.m,{title:An(n?"context_case-sensitive-search":"context_case-sensitive-search-disabled"),children:(0,d.jsx)(wn.$,{view:"outlined",className:Rn("case"),onClick:()=>r(!n),selected:n,children:(0,d.jsx)(Tt.I,{data:_n.A})})})]})}const Mn=(0,c.cn)("ydb-describe"),kn=new Map,Ln=({path:e,database:t,type:a})=>{const[n]=(0,he.Nt)(),r=ee(a),i=(0,he.N4)((n=>ue(n,e,a,t)),Cn.bN);let s=[];r?i&&(s=[e,...i]):s=[e];const{mergedDescribe:o,loading:l,error:c}=pe({paths:s,autoRefreshInterval:n,database:t});let u;if(o){const e=Object.keys(o);u=1===e.length?o[e[0]]:o}return l||r&&!i?(0,d.jsx)(je.a,{size:"m"}):u||c?(0,d.jsxs)("div",{className:Mn(),children:[c?(0,d.jsx)(Ne.o,{error:c}):null,u?(0,d.jsxs)("div",{className:Mn("result"),children:[(0,d.jsx)(On,{data:u,onClick:({path:e})=>{const t=!kn.get(e);kn.set(e,t)},isExpanded:e=>kn.get(e)||!1}),(0,d.jsx)(jn.b,{view:"flat-secondary",text:JSON.stringify(u),className:Mn("copy")})]}):null]}):(0,d.jsx)("div",{className:Mn("message-container"),children:"Empty"})};var zn=a(60073);const Fn=e=>{const{PathType:t,PathSubType:a}=(null===e||void 0===e?void 0:e.Self)||{};return n=t,(r=a)&&Q[r]||n&&B[n];var n,r},Un=e=>{var t;return null===e||void 0===e||null===(t=e.UserAttributes)||void 0===t?void 0:t.some((({Key:e,Value:t})=>"__async_replica"===e&&"true"===t))};var qn=a(5741),Qn=a(82176);const Bn=(0,Qn.H)({values:{PathType:e=>null===e||void 0===e?void 0:e.substring(9),CreateStep:Pe.r6},labels:{PathType:(0,qn.A)("common.type"),CreateStep:(0,qn.A)("common.created")}}),$n=({value:e,withSpeedLabel:t,...a})=>{const n=(0,wa.z3)({value:e,withSpeedLabel:t,...a}),r=(0,wa.z3)({value:e,withSpeedLabel:t,size:"b"});return(0,d.jsx)("span",{title:r,children:n})},Gn=(e,t)=>e?(0,d.jsx)($n,{value:e,significantDigits:2,...t}):null,Hn=(0,Qn.H)({values:{Type:e=>null===e||void 0===e?void 0:e.substring(10),State:e=>null===e||void 0===e?void 0:e.substring(11),KeyColumnNames:e=>null===e||void 0===e?void 0:e.join(", "),DataColumnNames:e=>null===e||void 0===e?void 0:e.join(", "),DataSize:Gn},labels:{KeyColumnNames:"Columns",DataColumnNames:"Includes"}}),Wn={[D.METERING_MODE_REQUEST_UNITS]:"request-units",[D.METERING_MODE_RESERVED_CAPACITY]:"reserved-capacity"},Vn=(0,Qn.H)({values:{Partitions:e=>(0,Pe.ZV)((null===e||void 0===e?void 0:e.length)||0),PQTabletConfig:e=>{const t=Math.round(e.PartitionConfig.LifetimeSeconds/me.Jg*100)/100;return`${(0,Pe.ZV)(t)} hours`}},labels:{Partitions:"Partitions count",PQTabletConfig:"Retention"}}),Jn=(0,Qn.H)({values:{Codecs:e=>e&&Object.values(e.Codecs||{}).join(", "),MeteringMode:e=>e&&Wn[e]},labels:{MeteringMode:"Metering mode"}}),Yn=(0,Qn.H)({values:{StorageLimitBytes:Pe.z3,WriteSpeedInBytesPerSecond:Pe.tC},labels:{StorageLimitBytes:"Retention storage",WriteSpeedInBytesPerSecond:"Partitions write speed"}}),Kn=(0,Qn.H)({values:{Mode:e=>null===e||void 0===e?void 0:e.substring(14),Format:e=>null===e||void 0===e?void 0:e.substring(16)}}),Zn=(0,Qn.H)({values:{CPU:Pe.iM,Memory:Gn,Storage:Gn,Network:Pe.tC,ReadThroughput:Pe.tC,WriteThroughput:Pe.tC},defaultValueFormatter:Pe.ZV}),Xn=(0,Qn.H)({values:{FollowerCount:Pe.ZV},labels:{FollowerCountPerDataCenter:"FollowerCountPerDC"},defaultValueFormatter:e=>e&&String(e)}),er=(0,Qn.H)({values:{FollowerCount:Pe.ZV,CrossDataCenterFollowerCount:Pe.ZV}}),tr=(0,Qn.H)({values:{DataSize:Gn,IndexSize:Gn,LastAccessTime:Pe.r6,LastUpdateTime:Pe.r6},defaultValueFormatter:Pe.ZV}),ar=new Set(["Type","State","DataSize","KeyColumnNames","DataColumnNames"]),nr=({data:e})=>{var t;const a=Fn(null===e||void 0===e?void 0:e.PathDescription);if(!e)return(0,d.jsxs)("div",{className:"error",children:["No ",a," data"]});const n=null===(t=e.PathDescription)||void 0===t?void 0:t.TableIndex,r=[];let i;for(i in n)ar.has(i)&&r.push(Hn(i,null===n||void 0===n?void 0:n[i]));return(0,d.jsx)(zn.z_,{title:a,info:r})};var rr=a(10508);const ir=JSON.parse('{"external-objects.source-type":"Source Type","external-objects.data-source":"Data Source","external-objects.location":"Location","external-objects.auth-method":"Auth Method","external-objects.auth-method.none":"None","external-objects.auth-method.service-account":"Service Account","view.query-text":"Query Text"}'),sr=(0,rt.g4)("ydb-tenant-objects-info",{en:ir}),or=(0,c.cn)("ydb-external-data-source-info"),lr=e=>{var t,a,n,r;return[{label:sr("external-objects.source-type"),value:null===(t=e.PathDescription)||void 0===t||null===(a=t.ExternalDataSourceDescription)||void 0===a?void 0:a.SourceType},Bn("CreateStep",null===(n=e.PathDescription)||void 0===n||null===(r=n.Self)||void 0===r?void 0:r.CreateStep)]},cr=e=>{var t;const{Location:a,Auth:n}=(null===(t=e.PathDescription)||void 0===t?void 0:t.ExternalDataSourceDescription)||{};return[...lr(e),{label:sr("external-objects.location"),value:(0,d.jsx)(rr.c,{name:a,showStatus:!1,hasClipboardButton:!0,clipboardButtonAlwaysVisible:!0,className:or("location")})},{label:sr("external-objects.auth-method"),value:null!==n&&void 0!==n&&n.ServiceAccount?sr("external-objects.auth-method.service-account"):sr("external-objects.auth-method.none")}]},dr=({data:e,prepareData:t})=>{const a=Fn(null===e||void 0===e?void 0:e.PathDescription);return e?(0,d.jsx)(zn.z_,{title:a,info:t(e)}):(0,d.jsxs)("div",{className:"error",children:["No ",a," data"]})},ur=({data:e})=>(0,d.jsx)(dr,{data:e,prepareData:cr});var pr=a(10755),mr=a(25196);const hr=(0,c.cn)("ydb-external-table-info"),vr=(e,t)=>{var a,n;const{CreateStep:r}=(null===(a=e.PathDescription)||void 0===a?void 0:a.Self)||{},{SourceType:i,DataSourcePath:s}=(null===(n=e.PathDescription)||void 0===n?void 0:n.ExternalTableDescription)||{},o=null===s||void 0===s?void 0:s.split("/").pop();return[{label:sr("external-objects.source-type"),value:i},Bn("CreateStep",r),{label:sr("external-objects.data-source"),value:s&&(0,d.jsx)("span",{title:s,children:(0,d.jsx)(mr.K,{title:o||"",url:t})})}]},gr=(e,t)=>{var a,n;const r=null===(a=e.PathDescription)||void 0===a||null===(n=a.ExternalTableDescription)||void 0===n?void 0:n.Location;return[...vr(e,t),{label:sr("external-objects.location"),value:(0,d.jsx)(rr.c,{name:r,showStatus:!1,hasClipboardButton:!0,clipboardButtonAlwaysVisible:!0,className:hr("location")})}]},yr=({data:e,prepareData:t})=>{var a,n;const r=(0,pr.zy)(),i=(0,Ae.mA)(r),s=(0,Ae.Ow)({...i,schema:null===e||void 0===e||null===(a=e.PathDescription)||void 0===a||null===(n=a.ExternalTableDescription)||void 0===n?void 0:n.DataSourcePath}),o=Fn(null===e||void 0===e?void 0:e.PathDescription);return e?(0,d.jsx)(zn.z_,{title:o,info:t(e,s)}):(0,d.jsxs)("div",{className:"error",children:["No ",o," data"]})},xr=({data:e})=>(0,d.jsx)(yr,{data:e,prepareData:gr});var br=a(49001);const fr=JSON.parse('{"no-data":"No data"}'),Sr=(0,rt.g4)("ydb-definition-list",{en:fr}),Er=(0,c.cn)("ydb-definition-list");function Tr({title:e,items:t,nameMaxWidth:a=220,copyPosition:n="outside",className:r,itemClassName:i,...s}){return(0,d.jsxs)("div",{className:Er(null),children:[e?(0,d.jsx)("div",{className:Er("title"),children:e}):null,t.length?(0,d.jsx)(br.u,{items:t,nameMaxWidth:a,copyPosition:n,className:Er("properties-list",r),itemClassName:Er("item",i),...s}):Sr("no-data")]})}function Nr({data:e}){const t=Fn(null===e||void 0===e?void 0:e.PathDescription);if(!e)return(0,d.jsxs)("div",{className:"error",children:["No ",t," data"]});const a=(e=>{var t,a;const n=null===(t=e.PathDescription)||void 0===t||null===(a=t.ViewDescription)||void 0===a?void 0:a.QueryText;return[{name:sr("view.query-text"),copyText:n,content:(0,d.jsx)(ft.E,{variant:"code-2",wordBreak:"break-word",children:n})}]})(e);return(0,d.jsx)(Tr,{title:t,items:a})}function jr({state:e}){return e?"StandBy"in e?(0,d.jsx)(Qt.J,{theme:"info",children:"Standby"}):"Paused"in e?(0,d.jsx)(Qt.J,{theme:"info",children:"Paused"}):"Done"in e?(0,d.jsx)(Qt.J,{theme:"success",children:"Done"}):"Error"in e?(0,d.jsx)(Qt.J,{theme:"danger",children:"Error"}):(0,d.jsx)(Qt.J,{size:"s",children:"Unknown"}):null}const Cr=JSON.parse('{"column.dstPath.name":"Dist","column.srcPath.name":"Source","everythingWithPrefix":"Everything with prefix:","noData":"No data.","title":"Replicated Paths"}'),wr=(0,rt.g4)("ydb-diagnostics-async-replication-paths",{en:Cr}),Pr=(0,c.cn)("ydb-async-replication-paths"),Ir=[{name:wr("column.srcPath.name"),render:({row:e})=>e.SrcPath,sortAccessor:e=>e.SrcPath},{name:wr("column.dstPath.name"),render:({row:e})=>e.DstPath,sortAccessor:e=>e.DstPath}];function Dr({config:e}){if(!e)return null;let t=wr("noData");var a,n;e.Everything&&(t=(0,d.jsxs)("span",{children:[wr("everythingWithPrefix")," ",(0,d.jsx)(ft.E,{variant:"code-inline-2",children:null!==(a=null===(n=e.Everything)||void 0===n?void 0:n.DstPrefix)&&void 0!==a?a:"undefined"}),"."]}));return e.Specific&&(t=(0,d.jsx)(Xe.l,{data:e.Specific.Targets,settings:me.jp,columns:Ir})),(0,d.jsxs)("div",{className:Pr(),children:[(0,d.jsx)("div",{className:Pr("title"),children:wr("title")}),t]})}function Ar({connection:e}){return e?e.StaticCredentials?(0,d.jsx)(Qt.J,{value:e.StaticCredentials.User,theme:"normal",children:"user"}):"OAuthToken"in e?"OAuth":"unknown":null}const _r=JSON.parse('{"credentials.label":"Credentials","noData":"No data for entity:","srcConnection.database.label":"Source Database Path","srcConnection.endpoint.label":"Source Cluster Endpoint","state.label":"State"}'),Rr=(0,rt.g4)("ydb-diagnostics-async-replication-info",{en:_r});function Or({data:e}){var t,a;const n=Fn(null===e||void 0===e?void 0:e.PathDescription);if(!e)return(0,d.jsxs)("div",{className:"error",children:[Rr("noData")," ",n]});const r=function(e){var t,a;const n=(null===(t=e.PathDescription)||void 0===t?void 0:t.ReplicationDescription)||{},r=n.State,i=(null===(a=n.Config)||void 0===a?void 0:a.SrcConnectionParams)||{},{Endpoint:s,Database:o}=i,l=[];r&&l.push({name:Rr("state.label"),content:(0,d.jsx)(jr,{state:r})});s&&l.push({name:Rr("srcConnection.endpoint.label"),copyText:s,content:(0,d.jsx)(ft.E,{variant:"code-inline-2",children:s})});o&&l.push({name:Rr("srcConnection.database.label"),copyText:o,content:(0,d.jsx)(ft.E,{variant:"code-inline-2",children:o})});i&&l.push({name:Rr("credentials.label"),content:(0,d.jsx)(Ar,{connection:i})});return l}(e);return(0,d.jsxs)(St.s,{direction:"column",gap:"4",children:[(0,d.jsx)(Tr,{title:n,items:r}),(0,d.jsx)(Dr,{config:null===(t=e.PathDescription)||void 0===t||null===(a=t.ReplicationDescription)||void 0===a?void 0:a.Config})]})}const Mr=JSON.parse('{"writeLagPopover":"Write lag, maximum among all topic partitions","writeIdleTimePopover":"Write idle time, maximum among all topic partitions"}'),kr=JSON.parse('{"writeLagPopover":"\u041b\u0430\u0433 \u0437\u0430\u043f\u0438\u0441\u0438, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0442\u043e\u043f\u0438\u043a\u0430","writeIdleTimePopover":"\u0412\u0440\u0435\u043c\u044f \u0431\u0435\u0437 \u0437\u0430\u043f\u0438\u0441\u0438, \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u0440\u0435\u0434\u0438 \u0432\u0441\u0435\u0445 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439 \u0442\u043e\u043f\u0438\u043a\u0430"}'),Lr=(0,rt.g4)("ydb-diagnostics-overview-topic-stats",{ru:kr,en:Mr}),zr=(0,c.cn)("ydb-overview-topic-stats"),Fr=e=>[{label:"Store size",value:(0,Pe.z3)(e.storeSize)},{label:(0,d.jsx)(Ha,{text:"Write idle time",popoverContent:(0,d.jsx)(on,{text:Lr("writeIdleTimePopover"),type:"write"})}),value:(0,Dt.Bi)(e.partitionsIdleTime)},{label:(0,d.jsx)(Ha,{text:"Write lag",popoverContent:(0,d.jsx)(on,{text:Lr("writeLagPopover"),type:"write"})}),value:(0,Dt.Bi)(e.partitionsWriteLag)},{label:"Average write speed",value:(0,d.jsx)(Fa,{data:e.writeSpeed,withValue:!1})}],Ur=e=>{const t=e.writeSpeed;return[{label:"per minute",value:(0,Pe.tC)(t.perMinute)},{label:"per hour",value:(0,Pe.tC)(t.perHour)},{label:"per day",value:(0,Pe.tC)(t.perDay)}]},qr=({path:e,database:t})=>{const[a]=(0,he.Nt)(),{currentData:r,isFetching:i,error:s}=Pa.useGetTopicQuery({path:e,database:t},{pollingInterval:a}),o=i&&void 0===r,l=(0,he.N4)((a=>Ra(a,e,t)));if(o)return(0,d.jsx)("div",{className:zr(),children:(0,d.jsx)(je.a,{size:"s"})});const c=s||!l?(0,d.jsx)(Ne.o,{error:s}):null;return(0,d.jsxs)("div",{className:zr(),children:[(0,d.jsx)("div",{className:zr("title"),children:"Stats"}),c,l?(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:zr("info"),children:(0,d.jsx)(zn.z_,{info:Fr(l),multilineLabels:!0})}),(0,d.jsx)("div",{className:zr("bytes-written"),children:(0,d.jsx)(zn.z_,{info:Ur(l)})})]}):null]})},Qr=e=>{var t;const a=null===e||void 0===e||null===(t=e.PathDescription)||void 0===t?void 0:t.PersQueueGroup;if(!a)return[];const{Partitions:n=[],PQTabletConfig:r={PartitionConfig:{LifetimeSeconds:0}}}=a,{Codecs:i,MeteringMode:s}=r,{WriteSpeedInBytesPerSecond:o,StorageLimitBytes:l}=r.PartitionConfig;return[...(0,zn.jl)(Vn,{Partitions:n,PQTabletConfig:r}),...(0,zn.jl)(Yn,{StorageLimitBytes:l,WriteSpeedInBytesPerSecond:o}),...(0,zn.jl)(Jn,{Codecs:i,MeteringMode:s})]},Br=(e,t)=>{var a,n,r;if(!e&&!t)return[];const i=null===e||void 0===e||null===(a=e.PathDescription)||void 0===a?void 0:a.CdcStreamDescription,{Mode:s,Format:o}=i||{};return[Bn("CreateStep",null===e||void 0===e||null===(n=e.PathDescription)||void 0===n||null===(r=n.Self)||void 0===r?void 0:r.CreateStep),...(0,zn.jl)(Kn,{Mode:s,Format:o}),...Qr(t)]},$r=({path:e,database:t,data:a,topic:n})=>{const r=Fn(null===a||void 0===a?void 0:a.PathDescription);return a&&n?(0,d.jsxs)("div",{children:[(0,d.jsx)(zn.z_,{title:r,info:Br(a,n)}),(0,d.jsx)(qr,{path:e,database:t})]}):(0,d.jsxs)("div",{className:"error",children:["No ",r," data"]})},Gr=JSON.parse('{"page.title":"Database","pages.query":"Query","pages.diagnostics":"Diagnostics","summary.navigation":"Navigation","summary.showPreview":"Show preview","summary.source-type":"Source Type","summary.data-source":"Data Source","summary.copySchemaPath":"Copy schema path","summary.type":"Type","summary.subtype":"SubType","summary.id":"Id","summary.version":"Version","summary.created":"Created","summary.data-size":"Data size","summary.row-count":"Row count","summary.partitions":"Partitions count","summary.paths":"Paths","summary.shards":"Shards","summary.state":"State","summary.mode":"Mode","summary.format":"Format","summary.retention":"Retention","label.read-only":"ReadOnly","actions.copied":"The path is copied to the clipboard","actions.notCopied":"Couldn\u2019t copy the path","actions.copyPath":"Copy path","actions.dropIndex":"Drop index","actions.openPreview":"Open preview","actions.createTable":"Create table...","actions.createExternalTable":"Create external table...","actions.createTopic":"Create topic...","actions.createColumnTable":"Create column table...","actions.createAsyncReplication":"Create async replication...","actions.createView":"Create view...","actions.dropTable":"Drop table...","actions.dropTopic":"Drop topic...","actions.dropView":"Drop view...","actions.alterTable":"Alter table...","actions.addTableIndex":"Add index...","actions.createCdcStream":"Create changefeed...","actions.alterTopic":"Alter topic...","actions.selectQuery":"Select query...","actions.upsertQuery":"Upsert query...","actions.alterReplication":"Alter async replicaton...","actions.dropReplication":"Drop async replicaton...","actions.createDirectory":"Create directory","schema.tree.dialog.placeholder":"Relative path","schema.tree.dialog.invalid":"Invalid path","schema.tree.dialog.whitespace":"Whitespace is not allowed","schema.tree.dialog.empty":"Path is empty","schema.tree.dialog.header":"Create directory","schema.tree.dialog.description":"Inside","schema.tree.dialog.buttonCancel":"Cancel","schema.tree.dialog.buttonApply":"Create"}'),Hr=(0,rt.g4)("ydb-tenant",{en:Gr});function Wr({data:e}){const t=Fn(e);return Un(e)?(0,d.jsxs)(St.s,{gap:1,wrap:"nowrap",children:[t," ",(0,d.jsx)(Qt.J,{children:Hr("label.read-only")})]}):t}const Vr=JSON.parse('{"tableStats":"Table Stats","tabletMetrics":"Tablet Metrics","partitionConfig":"Partition Config","label.ttl":"TTL for rows","value.ttl":"column: \'{{columnName}}\', expire after: {{expireTime}}","label.standalone":"Standalone","label.partitioning":"Partitioning","label.partitioning-by-size":"Partitioning by size","value.partitioning-by-size.enabled":"Enabled, split size: {{size}}","label.partitioning-by-load":"Partitioning by load","label.partitions-min":"Min number of partitions","label.partitions-max":"Max number of partitions","label.read-replicas":"Read replicas (followers)","label.bloom-filter":"Bloom filter","enabled":"Enabled","disabled":"Disabled"}'),Jr=(0,rt.g4)("ydb-diagnostics-overview-table-info",{en:Vr});var Yr=a(62091),Kr=a.n(Yr),Zr=a(7435),Xr=a(41650);const ei=e=>{if(e.Enabled&&e.Enabled.ColumnName&&void 0!==e.Enabled.ExpireAfterSeconds){const t=Jr("value.ttl",{columnName:e.Enabled.ColumnName,expireTime:(0,Dt.Bi)(1e3*e.Enabled.ExpireAfterSeconds,1)});return{label:Jr("label.ttl"),value:t}}};const ti=(e,t)=>{if(!e)return{};const{PathDescription:a={}}=e,{TableStats:n={},TabletMetrics:r={},Table:{PartitionConfig:i={},TTLSettings:s}={},ColumnTableDescription:o={}}=a,{PartCount:l,RowCount:c,DataSize:u,IndexSize:p,ByKeyFilterSize:m,LastAccessTime:h,LastUpdateTime:v,ImmediateTxCompleted:g,PlannedTxCompleted:y,TxRejectedByOverload:x,TxRejectedBySpace:b,TxCompleteLagMsec:S,InFlightTxCount:E,RowUpdates:T,RowDeletes:N,RowReads:j,RangeReads:C,RangeReadRows:w}=n,{FollowerGroups:P,FollowerCount:I,CrossDataCenterFollowerCount:D}=i;let A=[];switch(t){case f.EPathTypeTable:A=((e,t)=>{var a;const{PartitioningPolicy:n={},FollowerGroups:r,EnableFilterByKey:i}=e,s=[],o=n.SizeToSplit&&Number(n.SizeToSplit)>0?Jr("value.partitioning-by-size.enabled",{size:(0,Pe.z3)(n.SizeToSplit)}):Jr("disabled"),l=null!==(a=n.SplitByLoadSettings)&&void 0!==a&&a.Enabled?Jr("enabled"):Jr("disabled");if(s.push({label:Jr("label.partitioning-by-size"),value:o},{label:Jr("label.partitioning-by-load"),value:l},{label:Jr("label.partitions-min"),value:(0,Pe.ZV)(n.MinPartitionsCount||0)}),n.MaxPartitionsCount&&s.push({label:Jr("label.partitions-max"),value:(0,Pe.ZV)(n.MaxPartitionsCount)}),r&&r.length){const{RequireAllDataCenters:e,FollowerCountPerDataCenter:t,FollowerCount:a}=r[0];let n;n=e&&t?`PER_AZ: ${a}`:`ANY_AZ: ${a}`,s.push({label:Jr("label.read-replicas"),value:n})}if(t){const e=ei(t);e&&s.push(e)}return(0,Zr.f8)(i)&&s.push({label:Jr("label.bloom-filter"),value:Jr(i?"enabled":"disabled")}),s})(i,s);break;case f.EPathTypeColumnTable:A=function(e){var t,a;const n=[];var r;if(n.push({label:Jr("label.standalone"),value:String((r=e,!(r.SchemaPresetName&&void 0!==r.SchemaPresetId)))}),null!==(t=e.Sharding)&&void 0!==t&&null!==(a=t.HashSharding)&&void 0!==a&&a.Columns){const t=`PARTITION BY HASH(${e.Sharding.HashSharding.Columns.join(", ")})`;n.push({label:Jr("label.partitioning"),value:(0,d.jsx)(ft.E,{variant:"code-2",wordBreak:"break-word",children:t})})}if(e.TtlSettings){const t=ei(null===e||void 0===e?void 0:e.TtlSettings);t&&n.push(t)}return n}(o)}const _=(0,zn.jl)(tr,{PartCount:l,RowCount:c,DataSize:u,IndexSize:p});(0,Xr.kf)(m)&&(i.EnableFilterByKey||Number(m)>0)&&_.push({label:"BloomFilterSize",value:Gn(m)});const R=[_,(0,zn.jl)(tr,{LastAccessTime:h,LastUpdateTime:v}),(0,zn.jl)(tr,{ImmediateTxCompleted:g,PlannedTxCompleted:y,TxRejectedByOverload:x,TxRejectedBySpace:b,TxCompleteLagMsec:S,InFlightTxCount:E}),(0,zn.jl)(tr,{RowUpdates:T,RowDeletes:N,RowReads:j,RangeReads:C,RangeReadRows:w})],O=(0,zn.jl)(Zn,Kr()(r,["GroupReadIops","GroupReadThroughput","GroupWriteIops","GroupWriteThroughput"]));let M=[];return Array.isArray(P)&&P.length>0?M=(0,zn.jl)(Xn,P[0]):void 0!==I?M.push(er("FollowerCount",I)):void 0!==D&&M.push(er("CrossDataCenterFollowerCount",D)),{generalInfo:A,tableStatsInfo:R,tabletMetricsInfo:O,partitionConfigInfo:M}},ai=(0,c.cn)("ydb-diagnostics-table-info"),ni=({data:e,type:t})=>{const a=(0,d.jsx)(Wr,{data:null===e||void 0===e?void 0:e.PathDescription}),{generalInfo:r,tableStatsInfo:i,tabletMetricsInfo:s=[],partitionConfigInfo:o=[]}=n.useMemo((()=>ti(e,t)),[e,t]);return(0,d.jsxs)("div",{className:ai(),children:[(0,d.jsx)(zn.z_,{info:r,title:a,className:ai("info-block"),renderEmptyState:()=>(0,d.jsx)("div",{className:ai("title"),children:a})}),(0,d.jsxs)("div",{className:ai("row"),children:[i?(0,d.jsx)("div",{className:ai("col"),children:i.map(((e,t)=>(0,d.jsx)(zn.z_,{info:e,title:0===t?Jr("tableStats"):void 0,className:ai("info-block"),renderEmptyState:()=>null},t)))}):null,s.length>0||o.length>0?(0,d.jsxs)("div",{className:ai("col"),children:[(0,d.jsx)(zn.z_,{info:s,title:Jr("tabletMetrics"),className:ai("info-block"),renderEmptyState:()=>null}),(0,d.jsx)(zn.z_,{info:o,title:Jr("partitionConfig"),className:ai("info-block"),renderEmptyState:()=>null})]}):null]})]})},ri=({data:e,path:t,database:a})=>{const n=Fn(null===e||void 0===e?void 0:e.PathDescription);return e?(0,d.jsxs)("div",{children:[(0,d.jsx)(zn.z_,{title:n,info:Qr(e)}),(0,d.jsx)(qr,{path:t,database:a})]}):(0,d.jsxs)("div",{className:"error",children:["No ",n," data"]})};const ii=function({type:e,path:t,database:a}){const[r]=(0,he.Nt)(),i=ee(e),s=(0,he.N4)((n=>ue(n,t,e,a)),Cn.bN);let o=[];i?s&&(o=[t,...s]):o=[t];const{mergedDescribe:l,loading:c,error:u}=pe({paths:o,database:a,autoRefreshInterval:r}),p=l[t];return c||i&&!s?(0,d.jsx)(je.a,{size:"m"}):(0,d.jsxs)(n.Fragment,{children:[u?(0,d.jsx)(Ne.o,{error:u}):null,u&&!p?null:(()=>{var n;const r=null!==p&&void 0!==p?p:void 0,i={[f.EPathTypeInvalid]:void 0,[f.EPathTypeDir]:void 0,[f.EPathTypeTable]:void 0,[f.EPathTypeSubDomain]:void 0,[f.EPathTypeTableIndex]:()=>(0,d.jsx)(nr,{data:r}),[f.EPathTypeExtSubDomain]:void 0,[f.EPathTypeColumnStore]:void 0,[f.EPathTypeColumnTable]:void 0,[f.EPathTypeCdcStream]:()=>{const e=null===s||void 0===s?void 0:s[0];var n;if(e)return(0,d.jsx)($r,{path:t,database:a,data:r,topic:null!==(n=null===l||void 0===l?void 0:l[e])&&void 0!==n?n:void 0})},[f.EPathTypePersQueueGroup]:()=>(0,d.jsx)(ri,{data:r,path:t,database:a}),[f.EPathTypeExternalTable]:()=>(0,d.jsx)(xr,{data:r}),[f.EPathTypeExternalDataSource]:()=>(0,d.jsx)(ur,{data:r}),[f.EPathTypeView]:()=>(0,d.jsx)(Nr,{data:r}),[f.EPathTypeReplication]:()=>(0,d.jsx)(Or,{data:r})};return e&&(null===(n=i[e])||void 0===n?void 0:n.call(i))||(0,d.jsx)(ni,{data:r,type:e})})()]})};var si,oi=a(74417);function li(){return li=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},li.apply(this,arguments)}const ci=function(e){return n.createElement("svg",li({fill:"currentColor",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},e),si||(si=n.createElement("path",{d:"M14.195 11.375H3.125v-7.82a.328.328 0 00-.305-.305H1.805a.309.309 0 00-.305.305v9.14c0 .178.127.305.305.305h12.39a.309.309 0 00.305-.305V11.68a.328.328 0 00-.305-.305zm-3.25-5.688L8.812 7.11 6.63 4.24c-.127-.178-.38-.178-.508.026L3.937 7.922v2.64h9.75l-2.285-4.748c-.101-.177-.304-.228-.457-.127z"})))};function di({href:e,className:t,size:a="xs"}){return(0,d.jsx)(wn.$,{href:e,target:"_blank",className:t,size:a,title:"Monitoring dashboard",children:(0,d.jsx)(Tt.I,{data:ci})})}var ui=a(20680),pi=a(66643),mi=a(40014),hi=a(25533),vi=a(90474);const gi=["#7EB26D","#EAB839","#6ED0E0","#EF843C","#E24D42","#1F78C1","#BA43A9","#705DA0","#508642","#CCA300"];function yi(e){return null===e?me.Pd:(0,Dt.Xo)((0,Pe.CR)(fi(e),2))}function xi(e){return null===e?me.Pd:(0,wa.z3)({value:fi(e),precision:3})}function bi(e){return null===e?me.Pd:Math.round(100*fi(e))+"%"}function fi(e){return(0,Xr.kf)(e)?Number(e):0}const Si={"30m":30*me.r0,"1h":me.Jg,"1d":me.tt,"1w":7*me.tt},Ei=JSON.parse('{"not-supported":"Charts are not supported on current ydb version"}'),Ti=(0,rt.g4)("ydb-metric-chart",{en:Ei}),Ni=oe.F.injectEndpoints({endpoints:e=>({getChartData:e.query({queryFn:async(e,{signal:t})=>{try{const a=await(async({database:e,metrics:t,timeFrame:a,maxDataPoints:n},{signal:r}={})=>{const i=t.map((e=>`target=${e.target}`)).join("&"),s=Math.round(Date.now()/1e3),o=s-Si[a];return window.api.viewer.getChartData({target:i,from:o,until:s,maxDataPoints:n,database:e},{signal:r})})(e,{signal:t});if(Array.isArray(a)){return{data:((e=[],t)=>{const a=e.map((({datapoints:e,target:a})=>{const n=t.find((e=>e.target===a));if(!n)return;const r=e.map((e=>e[0]));return{...n,data:r}})).filter((e=>void 0!==e));return{timeline:e[0].datapoints.map((e=>1e3*e[1])),metrics:a}})(a,e.metrics)}}return{error:new Error("string"===typeof a?Ti("not-supported"):a.error)}}catch(a){return{error:a}}},providesTags:["All"],keepUnusedDataFor:0})}),overrideExisting:"throw"}),ji=(0,c.cn)("ydb-metric-chart");pi.W.set({plugins:[hi.YagrPlugin]});const Ci=(e,t={})=>{const{dataType:a,scaleRange:n}=t,r=(e=>{switch(e){case"ms":return yi;case"size":return xi;case"percent":return bi;default:return}})(a),i=!e.metrics.length,s=e.metrics.map(((e,t)=>{const a=e.color||gi[t],n=function(e,t){const a=(0,vi.Mj)(e);if(!a.isValid())throw new Error("Invalid color is passed");return a.alpha(t).toRgbString()}(a,.1);return{id:e.target,name:e.title||e.target,data:e.data,formatter:r,lineColor:a,color:n,legendColorKey:"lineColor"}}));return{data:{timeline:e.timeline,graphs:s},libraryConfig:{chart:{size:{padding:i?[10,0,10,0]:void 0},series:{type:"area",spanGaps:!0,lineWidth:1.5},select:{zoom:!1}},scales:{y:{type:"linear",range:"nice",min:(null===n||void 0===n?void 0:n.min)||0,max:null===n||void 0===n?void 0:n.max}},axes:{y:{values:r?(e,t)=>t.map(r):void 0}},tooltip:{show:!0,tracking:"sticky"}}}},wi={timeline:[],metrics:[]},Pi=({database:e,title:t,metrics:a,timeFrame:r="1h",autorefresh:i,width:s=400,height:o=s/1.5,chartOptions:l,onChartDataStatusChange:c,isChartVisible:u})=>{const{currentData:p,error:m,isFetching:h,status:v}=Ni.useGetChartDataQuery({database:e,metrics:a,timeFrame:r,maxDataPoints:s/2},{pollingInterval:i}),g=h&&!p;n.useEffect((()=>null===c||void 0===c?void 0:c("fulfilled"===v?"success":"loading")),[v,c]);const y=Ci(p||wi,l);return(0,d.jsxs)("div",{className:ji(null),style:{height:o,width:s},children:[(0,d.jsx)("div",{className:ji("title"),children:t}),g?(0,d.jsx)(je.a,{}):u?(0,d.jsxs)("div",{className:ji("chart"),children:[(0,d.jsx)(mi.Ay,{type:"yagr",data:y}),m?(0,d.jsx)(Ne.o,{className:ji("error"),error:m}):null]}):null]})},Ii=(0,c.cn)("ydb-timeframe-selector"),Di=({value:e,onChange:t,className:a})=>(0,d.jsx)("div",{className:Ii(null,a),children:Object.keys(Si).map((a=>(0,d.jsx)(wn.$,{view:"flat",selected:e===a,onClick:()=>t(a),children:a},a)))}),Ai=(0,c.cn)("ydb-tenant-dashboard"),_i=({database:e,charts:t})=>{const[a,r]=n.useState(!0),[s="1h",o]=(0,i.useQueryParam)("timeframe",i.StringParam),[l]=(0,he.Nt)(),c=a?0:l,u=e=>{"success"===e&&r(!1)},p=1===t.length?872:428,m=428/1.5;return(0,d.jsxs)("div",{className:Ai(null),style:{display:a?"none":void 0},children:[(0,d.jsx)("div",{className:Ai("controls"),children:(0,d.jsx)(Di,{value:s,onChange:o})}),(0,d.jsx)("div",{className:Ai("charts"),children:t.map((t=>{const n=t.metrics.map((({target:e})=>e)).join("&");return(0,d.jsx)(Pi,{database:e,title:t.title,metrics:t.metrics,timeFrame:s,chartOptions:t.options,autorefresh:c,width:p,height:m,onChartDataStatusChange:u,isChartVisible:!a},n)}))})]})},Ri=JSON.parse('{"no-data":"No data","no-pools-data":"No pools data","top-nodes.empty-data":"No such nodes","top-groups.empty-data":"No such groups","top":"Top","nodes":"nodes","shards":"shards","groups":"groups","queries":"queries","tables":"tables","by-pools-usage":"by pools usage","by-cpu-time":"by cpu time, {{executionPeriod}}","by-cpu-usage":"by cpu usage","by-load":"by load","by-memory":"by memory","by-usage":"by usage","by-size":"by size","cards.cpu-label":"CPU","cards.storage-label":"Storage","cards.memory-label":"Memory","charts.queries-per-second":"Queries per second","charts.transaction-latency":"Transactions latencies {{percentile}}","charts.cpu-usage":"CPU usage by pool","charts.storage-usage":"Tablet storage usage","charts.memory-usage":"Memory usage","storage.tablet-storage-title":"Tablet storage","storage.tablet-storage-description":"Size of user data and indexes stored in schema objects (tables, topics, etc.)","storage.db-storage-title":"Database storage","storage.db-storage-description":"Size of data stored in distributed storage with all overheads for redundancy","executed-last-hour":"executed in the last hour","column-header.process":"Process"}'),Oi=(0,rt.g4)("ydb-diagnostics-tenant-overview",{en:Ri}),Mi=[{title:Oi("charts.queries-per-second"),metrics:[{target:"queries.requests",title:Oi("charts.queries-per-second")}]},{title:Oi("charts.transaction-latency",{percentile:""}),metrics:[{target:"queries.latencies.p50",title:Oi("charts.transaction-latency",{percentile:"p50"})},{target:"queries.latencies.p75",title:Oi("charts.transaction-latency",{percentile:"p75"})},{target:"queries.latencies.p90",title:Oi("charts.transaction-latency",{percentile:"p90"})},{target:"queries.latencies.p99",title:Oi("charts.transaction-latency",{percentile:"p99"})}],options:{dataType:"ms"}}],ki=({database:e})=>(0,d.jsx)(_i,{database:e,charts:Mi}),Li=oe.F.injectEndpoints({endpoints:e=>({getHealthcheckInfo:e.query({queryFn:async({database:e,maxLevel:t},{signal:a})=>{try{return{data:await window.api.viewer.getHealthcheckInfo({database:e,maxLevel:t},{signal:a})}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"}),zi={RED:0,ORANGE:1,YELLOW:2,BLUE:3,GREEN:4},Fi=e=>e.sort(((e,t)=>(zi[e.status]||0)-(zi[t.status]||0))),Ui=({issue:e,data:t})=>Fi(t.filter((t=>e.reason&&-1!==e.reason.indexOf(t.id)))),qi=({data:e,roots:t})=>t?t.map((t=>{const a=qi({roots:Ui({issue:t,data:e}),data:e});return{...t,reasonsItems:a}})):[],Qi=(0,x.Mz)((e=>e),(e=>Li.endpoints.getHealthcheckInfo.select({database:e}))),Bi=(0,x.Mz)((e=>e),((e,t)=>Qi(t)),((e,t)=>{var a;return(null===(a=t(e).data)||void 0===a?void 0:a.issue_log)||[]})),$i=(0,x.Mz)(Bi,((e=[])=>{return Fi((t=e).filter((e=>!t.find((t=>t.reason&&-1!==t.reason.indexOf(e.id))))));var t})),Gi=(0,x.Mz)([Bi,$i],((e=[],t=[])=>qi({data:e,roots:t}))),Hi=(0,x.Mz)(Bi,((e=[])=>(e=>{const t={};for(const a of e)t[a.status]||(t[a.status]=0),t[a.status]++;return Object.entries(t).sort((([e],[t])=>(zi[e]||0)-(zi[t]||0)))})(e)));let Wi,Vi;!function(e){e.UNSPECIFIED="UNSPECIFIED",e.GOOD="GOOD",e.DEGRADED="DEGRADED",e.MAINTENANCE_REQUIRED="MAINTENANCE_REQUIRED",e.EMERGENCY="EMERGENCY"}(Wi||(Wi={})),function(e){e.UNSPECIFIED="UNSPECIFIED",e.GREY="GREY",e.GREEN="GREEN",e.BLUE="BLUE",e.YELLOW="YELLOW",e.ORANGE="ORANGE",e.RED="RED"}(Vi||(Vi={}));var Ji=a(63126),Yi=a(54090);const Ki={[Vi.UNSPECIFIED]:Yi.m.Grey,[Vi.GREY]:Yi.m.Grey,[Vi.GREEN]:Yi.m.Green,[Vi.BLUE]:Yi.m.Blue,[Vi.YELLOW]:Yi.m.Yellow,[Vi.ORANGE]:Yi.m.Orange,[Vi.RED]:Yi.m.Red},Zi=(0,c.cn)("issue-tree-item"),Xi=({status:e,message:t,type:a,onClick:n})=>(0,d.jsxs)("div",{className:Zi(),onClick:n,children:[(0,d.jsx)("div",{className:Zi("field",{status:!0}),children:(0,d.jsx)(rr.c,{mode:"icons",status:e,name:a})}),(0,d.jsx)("div",{className:Zi("field",{message:!0}),children:t})]}),es=(0,c.cn)("issue-tree"),ts=({issueTree:e})=>{const[t,a]=n.useState({}),r=n.useCallback((e=>e?(0,d.jsx)("div",{className:es("info-panel"),children:(0,d.jsx)(On,{data:e,search:!1,isExpanded:()=>!0,treeClassName:es("inspector")})}):null),[]),i=n.useCallback((e=>e.map((e=>{const{id:n}=e,{status:s,message:o,type:l,reasonsItems:c,level:u,...p}=e,m="undefined"===typeof t[n]||t[n],h=()=>{a((e=>({...e,[n]:!m})))};return(0,d.jsxs)(Ji.G,{name:(0,d.jsx)(Xi,{status:Ki[s],message:o,type:l}),collapsed:m,hasArrow:!0,onClick:h,onArrowClick:h,level:u-1,children:[r(Kr()(p,["reason"])),i(c||[])]},n)}))),[t,r]);return(0,d.jsx)("div",{className:es(),children:(0,d.jsx)("div",{className:es("block"),children:i([e])})})},as=JSON.parse('{"title.healthcheck":"Healthcheck","label.update":"Update","label.show-details":"Show details","label.issues":"Issues:","status_message.ok":"No issues","no-data":"no healthcheck data"}'),ns=JSON.parse('{"title.healthcheck":"Healthcheck","label.update":"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c","label.show-details":"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0441\u0442\u0438","label.issues":"\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u044b:","status_message.ok":"\u041d\u0435\u0442 \u043f\u0440\u043e\u0431\u043b\u0435\u043c","no-data":"\u043d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 healthcheck"}'),rs=(0,rt.g4)("ydb-diagnostics-healthcheck",{ru:ns,en:as}),is=(0,c.cn)("healthcheck");function ss({tenantName:e}){const[t]=(0,he.Nt)(),{issueTrees:a,loading:r,error:i}=((e,{autorefresh:t}={})=>{const{currentData:a,isFetching:n,error:r,refetch:i}=Li.useGetHealthcheckInfoQuery({database:e},{pollingInterval:t}),s=(null===a||void 0===a?void 0:a.self_check_result)||Wi.UNSPECIFIED,o=(0,he.N4)((t=>Hi(t,e)));return{issueTrees:(0,he.N4)((t=>Gi(t,e))),issuesStatistics:o,loading:void 0===a&&n,error:r,refetch:i,selfCheckResult:s}})(e,{autorefresh:t});return(0,d.jsx)("div",{className:is("details"),children:(0,d.jsx)("div",{className:is("details-content-wrapper"),children:i?(0,d.jsx)(Ne.o,{error:i,defaultMessage:rs("no-data")}):r?(0,d.jsx)(je.a,{size:"m"}):a&&a.length?(0,d.jsx)(n.Fragment,{children:a.map((e=>(0,d.jsx)(ts,{issueTree:e},e.id)))}):rs("status_message.ok")})})}var os=a(8861),ls=a(73633),cs=a(70825),ds=a(43937),us=a(10800),ps=a(71153),ms=a(2102);const hs=(0,c.cn)("healthcheck"),vs={[Wi.UNSPECIFIED]:ls.A,[Wi.GOOD]:cs.A,[Wi.DEGRADED]:ds.A,[Wi.MAINTENANCE_REQUIRED]:us.A,[Wi.EMERGENCY]:ps.A};function gs(e){const{tenantName:t,active:a}=e,[n]=(0,he.Nt)(),{currentData:r,isFetching:i,error:s}=Li.useGetHealthcheckInfoQuery({database:t},{pollingInterval:n}),o=i&&void 0===r;return(0,d.jsxs)(ms.A,{className:hs("preview"),active:a,children:[(0,d.jsx)("div",{className:hs("preview-header"),children:(0,d.jsx)("div",{className:hs("preview-title-wrapper"),children:(0,d.jsx)("div",{className:hs("preview-title"),children:rs("title.healthcheck")})})}),(()=>{if(s)return(0,d.jsx)(Ne.o,{error:s,defaultMessage:rs("no-data")});if(o)return(0,d.jsx)(je.a,{size:"m"});const e=(null===r||void 0===r?void 0:r.self_check_result)||Wi.UNSPECIFIED,t=e.toLowerCase();return(0,d.jsx)("div",{className:hs("preview-content"),children:(0,d.jsxs)("div",{className:hs("preview-issue",{[t]:!0}),children:[(0,d.jsx)(Tt.I,{className:hs("preview-status-icon"),data:vs[e]}),(0,d.jsx)("div",{className:hs("self-check-status-indicator"),children:e.replace(/_/g," ")})]})})})()]})}var ys=a(15132),xs=a(33775);const bs=(0,c.cn)("ydb-metrics-card"),fs=e=>{let t;return"Warning"===e&&(t=Yi.m.Yellow),"Danger"===e&&(t=Yi.m.Red),t?(0,d.jsx)(xs.k,{status:t,mode:"icons",size:"l"}):null};function Ss({active:e,label:t,status:a,metrics:n}){return(0,d.jsxs)(ms.A,{className:bs({active:e}),active:e,children:[(0,d.jsxs)("div",{className:bs("header"),children:[t&&(0,d.jsx)("div",{className:bs("label"),children:t}),fs(a)]}),(0,d.jsx)("div",{className:bs("content"),children:n.map((({title:e,...t},a)=>(0,d.jsxs)("div",{className:bs("metric"),children:[(0,d.jsx)("div",{className:bs("metric-title"),children:e}),(0,d.jsx)(ys.O,{size:"xs",colorizeProgress:!0,...t})]},a)))})]})}const Es=(0,c.cn)("metrics-cards");function Ts({poolsCpuStats:e,memoryStats:t,blobStorageStats:a,tabletStorageStats:n,tenantName:r}){const i=(0,pr.zy)(),{metricsTab:s}=(0,he.N4)((e=>e.tenant)),o=(0,Ae.mA)(i),l=e=>e===s?"":e,c={[ge.pA.cpu]:(0,ga.YL)({...o,[ga.vh.metricsTab]:l(ge.pA.cpu)}),[ge.pA.storage]:(0,ga.YL)({...o,[ga.vh.metricsTab]:l(ge.pA.storage)}),[ge.pA.memory]:(0,ga.YL)({...o,[ga.vh.metricsTab]:l(ge.pA.memory)}),[ge.pA.healthcheck]:(0,ga.YL)({...o,[ga.vh.metricsTab]:l(ge.pA.healthcheck)})};return(0,d.jsxs)("div",{className:Es(),children:[(0,d.jsx)(xe.N_,{to:c.cpu,className:Es("tab"),children:(0,d.jsx)(Ns,{poolsCpuStats:e,active:s===ge.pA.cpu})}),(0,d.jsx)(xe.N_,{to:c.storage,className:Es("tab"),children:(0,d.jsx)(js,{blobStorageStats:a,tabletStorageStats:n,active:s===ge.pA.storage})}),(0,d.jsx)(xe.N_,{to:c.memory,className:Es("tab"),children:(0,d.jsx)(Cs,{memoryStats:t,active:s===ge.pA.memory})}),(0,d.jsx)(xe.N_,{to:c.healthcheck,className:Es("tab"),children:(0,d.jsx)(gs,{tenantName:r,active:s===ge.pA.healthcheck})})]})}function Ns({poolsCpuStats:e=[],active:t}){let a=os.u.Unspecified;const n=e.filter((e=>!("Batch"===e.name||"IO"===e.name))).map((e=>{const{name:t,usage:n,limit:r,used:i}=e,s=(0,ui.ni)(n);return os.Z[s]>os.Z[a]&&(a=s),{title:t,value:i,capacity:r,warningThreshold:ui.Xi,dangerThreshold:ui._O}}));return(0,d.jsx)(Ss,{label:Oi("cards.cpu-label"),active:t,metrics:n,status:a})}function js({blobStorageStats:e=[],tabletStorageStats:t,active:a}){let n=os.u.Unspecified;const r=(t||e).map((e=>{const{name:t,used:a,limit:r,usage:i}=e,s=(0,ui.oK)(i);return os.Z[s]>os.Z[n]&&(n=s),{title:t,value:a,capacity:r,warningThreshold:ui.Ct,dangerThreshold:ui.T6,formatValues:Pe.j9}}));return(0,d.jsx)(Ss,{label:Oi("cards.storage-label"),active:a,metrics:r,status:n})}function Cs({active:e,memoryStats:t=[]}){let a=os.u.Unspecified;const n=t.map((e=>{const{name:t,used:n,limit:r,usage:i}=e,s=(0,ui.E)(i);return os.Z[s]>os.Z[a]&&(a=s),{title:t,value:n,capacity:r,warningThreshold:ui.Ke,dangerThreshold:ui.xI,formatValues:Pe.j9}}));return(0,d.jsx)(Ss,{label:Oi("cards.memory-label"),active:e,metrics:n,status:a})}var ws=a(78762),Ps=a(86782),Is=a(15298),Ds=a(40781);const As=(0,c.cn)("tenant-overview");function _s({title:e,error:t,loading:a,tableClassNameModifiers:r={},...i}){return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:As("title"),children:e}),t?(0,d.jsx)(Ne.o,{error:t}):null,(0,d.jsx)("div",{className:As("table",r),children:t&&0===i.data.length?null:a?(0,d.jsx)(zt.Q,{rows:me.Nz}):(0,d.jsx)(Xe.l,{settings:me.jp,...i})})]})}var Rs=a(82015);const Os=({prefix:e=Oi("top"),entity:t,postfix:a,link:r,onClick:i})=>r?(0,d.jsxs)(n.Fragment,{children:[e," ",(0,d.jsx)(Rs.E,{to:r,onClick:i,children:t})," ",a]}):`${e} ${t} ${a}`;function Ms({tenantName:e,additionalNodesProps:t}){const a=(0,he.e4)(),[n]=(0,he.Nt)(),[r,i]=function(e){const t={...(0,ws.Nh)(e),width:void 0},a=[(0,ws.kv)(),(0,ws._E)(),t].map((e=>({...e,sortable:!1}))),n=a.map((e=>e.name));return[a,(0,Ds.R)(n,Ps.fN)]}({getNodeRef:null===t||void 0===t?void 0:t.getNodeRef,database:e}),{currentData:s,isFetching:o,error:l}=Is.s.useGetNodesQuery({tenant:e,type:"any",sort:"-CPU",limit:me.Nz,tablets:!1,fieldsRequired:i},{pollingInterval:n}),c=o&&void 0===s,u=(null===s||void 0===s?void 0:s.Nodes)||[],p=Os({entity:Oi("nodes"),postfix:Oi("by-pools-usage"),link:(0,ga.YL)({...a,[ga.vh.diagnosticsTab]:ge.iJ.nodes})});return(0,d.jsx)(_s,{columnsWidthLSKey:Ps.zO,data:u,columns:r,title:p,loading:c,error:l,emptyDataMessage:Oi("top-nodes.empty-data")})}function ks({tenantName:e,additionalNodesProps:t}){const a=(0,he.e4)(),[n]=(0,he.Nt)(),[r,i]=function(e){const t={...(0,ws.Nh)(e),width:void 0},a=[(0,ws.fR)(),(0,ws._E)(),t,(0,ws.Rn)()].map((e=>({...e,sortable:!1}))),n=a.map((e=>e.name));return[a,(0,Ds.R)(n,Ps.fN)]}({getNodeRef:null===t||void 0===t?void 0:t.getNodeRef,database:e}),{currentData:s,isFetching:o,error:l}=Is.s.useGetNodesQuery({tenant:e,type:"any",sort:"-LoadAverage",limit:me.Nz,tablets:!1,fieldsRequired:i},{pollingInterval:n}),c=o&&void 0===s,u=(null===s||void 0===s?void 0:s.Nodes)||[],p=Os({entity:Oi("nodes"),postfix:Oi("by-load"),link:(0,ga.YL)({...a,[ga.vh.diagnosticsTab]:ge.iJ.nodes})});return(0,d.jsx)(_s,{columnsWidthLSKey:Ps.zO,data:u,columns:r,title:p,loading:c,error:l,emptyDataMessage:Oi("top-nodes.empty-data")})}var Ls=a(69053),zs=a(10468),Fs=a(16332),Us=a(2198);const qs=JSON.parse('{"action_cancel":"Cancel"}'),Qs=(0,rt.g4)("ydb-confirmation-dialog",{en:qs}),Bs=(0,c.cn)("confirmation-dialog"),$s="confirmation-dialog";function Gs({caption:e="",children:t,onConfirm:a,onClose:n,progress:r,textButtonApply:i,textButtonCancel:s,buttonApplyView:o="normal",className:l,renderButtons:c,open:u}){return(0,d.jsxs)(Us.l,{className:Bs(null,l),size:"s",onClose:n,disableOutsideClick:!0,open:u,children:[(0,d.jsx)(Us.l.Header,{caption:(0,d.jsx)("span",{className:Bs("caption"),children:e})}),(0,d.jsx)(Us.l.Body,{children:t}),(0,d.jsx)(Us.l.Footer,{onClickButtonApply:a,propsButtonApply:{view:o},textButtonApply:i,textButtonCancel:null!==s&&void 0!==s?s:Qs("action_cancel"),onClickButtonCancel:n,loading:r,renderButtons:c})]})}const Hs=Fs.vt((e=>{const t=Fs.hS(),a=()=>{t.hide(),t.remove()};return(0,d.jsx)(Gs,{...e,onConfirm:async()=>{var n;await(null===(n=e.onConfirm)||void 0===n?void 0:n.call(e)),t.resolve(!0),a()},onClose:()=>{var n;null===(n=e.onClose)||void 0===n||n.call(e),t.resolve(!1),a()},open:t.visible})}));Fs.kz($s,Hs);var Ws=a(40569),Vs=a(28664),Js=a(36894);function Ys(){const[e]=(0,he.iK)(me.ld,[]),t=(0,he.N4)(Js.cu).toLowerCase();return t?e.filter((e=>e.body.toLowerCase().includes(t))):e}const Ks=JSON.parse('{"action.save":"Save query","action.edit":"Edit query","action.save-as-new":"Save as new","action.edit-existing":"Edit existing","description":"The query will be saved in your browser","input-label":"Query name","input-placeholder":"Enter query name","button-apply":"Save","button-cancel":"Cancel","error.name-exists":"This name already exists","error.name-not-empty":"Name should not be empty"}'),Zs=(0,rt.g4)("ydb-save-query-dialog",{en:Ks}),Xs=(0,c.cn)("ydb-save-query");function eo(e){const t=(0,he.YQ)();return n.useCallback((()=>{Fs.Ay.show(ro,e),t((0,Js.gJ)())}),[t,e])}function to({dialogProps:e,...t}){const a=eo(e);return(0,d.jsx)(wn.$,{onClick:a,...t,children:Zs("action.save")})}function ao({buttonProps:e={}}){const t=(0,he.YQ)(),a=(0,he.N4)(Js.aW),n=eo(),r=()=>{t((0,Js.Wg)(a)),t((0,Js.gJ)())};return a?(()=>{const t=[{action:r,text:Zs("action.edit-existing")},{action:n,text:Zs("action.save-as-new")}];return(0,d.jsx)(Ws.r,{items:t,renderSwitcher:t=>(0,d.jsx)(wn.$,{...t,...e,children:Zs("action.edit")}),popupProps:{placement:"top"}})})():(0,d.jsx)(to,{})}function no({onSuccess:e,onCancel:t,onClose:a,open:r}){const i=Ys(),s=(0,he.YQ)(),[o,l]=n.useState(""),[c,u]=n.useState(),p=()=>{s((0,Js.NJ)("idle")),l(""),u(void 0),null===a||void 0===a||a()},m=()=>{null===t||void 0===t||t(),p()};return(0,d.jsxs)(Us.l,{open:r,hasCloseButton:!1,size:"s",onClose:m,children:[(0,d.jsx)(Us.l.Header,{caption:Zs("action.save")}),(0,d.jsxs)("form",{onSubmit:t=>{t.preventDefault();const a=(n=o)?i.some((e=>e.name.toLowerCase()===n.trim().toLowerCase()))?Zs("error.name-exists"):void 0:Zs("error.name-not-empty");var n;u(a),a||(s((0,Js.Wg)(o)),p(),null===e||void 0===e||e())},children:[(0,d.jsxs)(Us.l.Body,{className:Xs("dialog-body"),children:[(0,d.jsx)("div",{className:Xs("dialog-row"),children:Zs("description")}),(0,d.jsxs)("div",{className:Xs("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"queryName",className:Xs("field-title","required"),children:Zs("input-label")}),(0,d.jsx)("div",{className:Xs("control-wrapper"),children:(0,d.jsx)(Vs.k,{id:"queryName",placeholder:Zs("input-placeholder"),value:o,onUpdate:e=>{l(e),u(void 0)},hasClear:!0,autoFocus:!0,autoComplete:!1,validationState:c?"invalid":void 0,errorMessage:c})})]})]}),(0,d.jsx)(Us.l.Footer,{textButtonApply:Zs("button-apply"),textButtonCancel:Zs("button-cancel"),onClickButtonCancel:m,propsButtonApply:{type:"submit"}})]})]})}const ro="save-query-dialog",io=Fs.Ay.create((e=>{const t=Fs.Ay.useModal();return(0,d.jsx)(no,{...e,onClose:()=>{var a;null===(a=e.onClose)||void 0===a||a.call(e),t.hide(),t.remove()},open:t.visible})}));Fs.Ay.register(ro,io);const so=JSON.parse('{"action_apply":"Don\'t save","context_unsaved-changes-warning":"You have unsaved changes in query editor.\\nDo you want to proceed?"}'),oo=(0,rt.g4)("ydb-change-input-confirmation",{en:so});function lo(){const e=Fs.Ay.useModal($s),t=n.useCallback((()=>{e.hide(),e.remove()}),[e]),a=n.useCallback((()=>{e.resolve(!0),t()}),[e,t]),r=n.useCallback((()=>{e.resolve(!1),t()}),[t,e]),i=n.useMemo((()=>({onSuccess:a,onCancel:r})),[a,r]);return(0,d.jsx)(to,{view:"action",size:"l",dialogProps:i})}async function co(){return await Fs.Ay.show($s,{id:$s,caption:oo("context_unsaved-changes-warning"),textButtonApply:oo("action_apply"),propsButtonApply:{view:"l"},renderButtons:(e,t)=>(0,d.jsxs)(n.Fragment,{children:[t,(0,d.jsx)(lo,{}),e]})})}function uo(e){const t=(0,he.N4)(zs.Wp),a=n.useMemo((()=>function(e){return async t=>{await co()&&e(t)}}(e)),[e]);return t?a:e}const po=(0,c.cn)("kv-truncated-query"),mo=({value:e="",maxQueryHeight:t=6})=>{const a=e.split("\n");if(a.length>t){const e=a.slice(0,t).join("\n"),r="\n...\nThe request was truncated. Click on the line to show the full query on the query tab";return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("span",{className:po(),children:e}),(0,d.jsx)("span",{className:po("message",{color:"secondary"}),children:r})]})}return(0,d.jsx)(n.Fragment,{children:e})},ho=({value:e=""})=>(0,d.jsx)(jt.s,{contentClassName:po("popover-content"),content:e,children:e});var vo=a(70206),go=a.n(vo);const yo={...me.N3,dynamicRenderType:"variable"},xo=JSON.parse('{"cpu-time":"CPUTime","read-rows":"ReadRows","read-bytes":"ReadBytes","query-hash":"QueryHash","user":"User","start-time":"Start time","end-time":"End time","duration":"Duration","query-text":"Query text","application":"Application"}'),bo=(0,rt.g4)("ydb-top-queries-columns",{en:xo}),fo="topQueriesColumnsWidth",So="CPUTime",Eo="QueryText",To="EndTime",No="ReadRows",jo="ReadBytes",Co="UserSID",wo="OneLineQueryText",Po="QueryHash",Io="Duration",Do="QueryStartAt",Ao="ApplicationName",_o={get CPUTime(){return bo("cpu-time")},get QueryText(){return bo("query-text")},get EndTime(){return bo("end-time")},get ReadRows(){return bo("read-rows")},get ReadBytes(){return bo("read-bytes")},get UserSID(){return bo("user")},get OneLineQueryText(){return bo("query-text")},get QueryHash(){return bo("query-hash")},get Duration(){return bo("duration")},get QueryStartAt(){return bo("start-time")},get ApplicationName(){return bo("application")}},Ro={CPUTime:"CPUTimeUs",QueryText:void 0,EndTime:"EndTime",ReadRows:"ReadRows",ReadBytes:"ReadBytes",UserSID:"UserSID",OneLineQueryText:void 0,QueryHash:void 0,Duration:"Duration",QueryStartAt:"QueryStartAt",ApplicationName:"ApplicationName"};function Oo(e){return Ro[e]}function Mo(e){return Boolean(Oo(e))}const ko=(0,c.cn)("kv-top-queries"),Lo={name:So,header:_o.CPUTime,sortAccessor:e=>Number(e.CPUTimeUs),render:({row:e})=>{var t;return(0,Dt.Xo)((0,Dt.Jc)(null!==(t=e.CPUTimeUs)&&void 0!==t?t:void 0))},width:120,align:Vt.Ay.RIGHT,sortable:!1},zo={name:Eo,header:_o.QueryText,sortAccessor:e=>Number(e.CPUTimeUs),render:({row:e})=>{var t;return(0,d.jsx)("div",{className:ko("query"),children:(0,d.jsx)(mo,{value:null===(t=e.QueryText)||void 0===t?void 0:t.toString(),maxQueryHeight:6})})},sortable:!1,width:500},Fo={name:To,header:_o.EndTime,render:({row:e})=>(0,Pe.r6)(new Date(e.EndTime).getTime()),align:Vt.Ay.RIGHT,width:200},Uo={name:No,header:_o.ReadRows,render:({row:e})=>(0,Pe.ZV)(e.ReadRows),sortAccessor:e=>Number(e.ReadRows),align:Vt.Ay.RIGHT,width:150},qo={name:jo,header:_o.ReadBytes,render:({row:e})=>(0,Pe.ZV)(e.ReadBytes),sortAccessor:e=>Number(e.ReadBytes),align:Vt.Ay.RIGHT,width:150},Qo={name:Co,header:_o.UserSID,render:({row:e})=>(0,d.jsx)("div",{className:ko("user-sid"),children:e.UserSID||"\u2013"}),sortAccessor:e=>String(e.UserSID),align:Vt.Ay.LEFT},Bo={name:wo,header:_o.OneLineQueryText,render:({row:e})=>{var t;return(0,d.jsx)(ho,{value:null===(t=e.QueryText)||void 0===t?void 0:t.toString()})},sortable:!1,width:500},$o={name:Po,header:_o.QueryHash,render:({row:e})=>{return t=String(e.QueryText),(go().str(t)>>>0).toString(16).toUpperCase().padStart(8,"0");var t},width:130,sortable:!1},Go={name:Io,header:_o.Duration,render:({row:e})=>{var t;return(0,Dt.Xo)((0,Dt.Jc)(null!==(t=e.Duration)&&void 0!==t?t:void 0))},sortAccessor:e=>Number(e.Duration),align:Vt.Ay.RIGHT,width:150},Ho={name:Do,header:_o.QueryStartAt,render:({row:e})=>(0,Pe.r6)(new Date(e.QueryStartAt).getTime()),sortable:!0,resizeable:!1,defaultOrder:Vt.Ay.DESCENDING},Wo={name:Ao,header:_o.ApplicationName,render:({row:e})=>(0,d.jsx)("div",{className:ko("user-sid"),children:e.ApplicationName||"\u2013"}),sortable:!0};function Vo({tenantName:e}){var t,a;const r=(0,he.YQ)(),i=(0,pr.zy)(),s=(0,pr.W6)(),o=(0,Ae.mA)(i),[l]=(0,he.Nt)(),c=n.useMemo((()=>[$o,Bo,Lo].map((e=>({...e,sortable:!1})))),[]),{currentData:u,isFetching:p,error:m}=Ls.Ke.useGetTopQueriesQuery({database:e},{pollingInterval:l}),h=p&&void 0===u,v=(null===u||void 0===u||null===(t=u.resultSets)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.result)||[],g=uo(n.useCallback((e=>{const{QueryText:t}=e;r((0,zs.iZ)({input:t}));const a=(0,Ae.mA)(i),n=(0,ga.YL)({...a,[ge.Dt]:ge.Dg.query,[ga.vh.queryTab]:ge.tQ.newQuery});s.push(n)}),[r,s,i])),y=Os({entity:Oi("queries"),postfix:Oi("by-cpu-time",{executionPeriod:Oi("executed-last-hour")}),onClick:()=>{r((0,Ls.TX)({from:void 0,to:void 0}))},link:(0,ga.YL)({...o,[ga.vh.diagnosticsTab]:ge.iJ.topQueries})});return(0,d.jsx)(_s,{columnsWidthLSKey:fo,data:v||[],columns:c,onRowClick:g,title:y,loading:h,error:(0,Ft.Cb)(m),rowClassName:()=>As("top-queries-row")})}function Jo(e,t){return`SELECT\n    ${t?`CAST(SUBSTRING(CAST(Path AS String), ${t.length}) AS Utf8) AS Path`:"Path"},\n    TabletId,\n    CPUCores,\nFROM \`.sys/partition_stats\`\nWHERE\n    Path='${e}'\n    OR Path LIKE '${e}/%'\nORDER BY CPUCores DESC\nLIMIT ${me.Nz}`}const Yo=oe.F.injectEndpoints({endpoints:e=>({getTopShards:e.query({queryFn:async({database:e,path:t=""},{signal:a})=>{try{const n=await window.api.viewer.sendQuery({query:Jo(t,e),database:e,action:"execute-scan"},{signal:a,withRetries:!0});return(0,Ft.We)(n)?{error:n}:{data:(0,Ft.fW)(n)}}catch(n){return{error:n||new Error("Unauthorized")}}},providesTags:["All"]})}),overrideExisting:"throw"});var Ko=a(67884);function Zo({path:e,location:t,...a}){const n=(0,Ae.mA)(t),r=(0,Ae.Ow)({...n,schema:e});return(0,d.jsx)(Ko.N,{view:"normal",...a,href:r})}var Xo=a(80420),el=a(13342);const tl=(0,a(16439).H)(60,80,["success","warning","danger"]);var al=a(29819);const nl=JSON.parse('{"tablet-id":"TabletId","cpu-cores":"CPUCores","data-size":"DataSize (B)","path":"Path","node-id":"NodeId","peak-time":"PeakTime","in-flight-tx-count":"InFlightTxCount","interval-end":"IntervalEnd"}'),rl=(0,rt.g4)("ydb-top-shards-columns",{en:nl}),il="topShardsColumnsWidth",sl="TabletId",ol="CPUCores",ll="DataSize",cl="Path",dl="NodeId",ul="PeakTime",pl="InFlightTxCount",ml="IntervalEnd",hl={get TabletId(){return rl("tablet-id")},get CPUCores(){return rl("cpu-cores")},get DataSize(){return rl("data-size")},get Path(){return rl("path")},get NodeId(){return rl("node-id")},get PeakTime(){return rl("peak-time")},get InFlightTxCount(){return rl("in-flight-tx-count")},get IntervalEnd(){return rl("interval-end")}},vl={TabletId:void 0,CPUCores:"CPUCores",DataSize:"DataSize",Path:void 0,NodeId:void 0,PeakTime:void 0,InFlightTxCount:"InFlightTxCount",IntervalEnd:void 0};function gl(e){return vl[e]}const yl=(e,t)=>({name:cl,header:hl.Path,render:({row:a})=>(0,d.jsx)(Zo,{path:e+a.Path,location:t,children:a.Path}),sortable:!1,width:300}),xl={name:ol,header:hl.CPUCores,render:({row:e})=>{return t=e.CPUCores||0,`${(0,Pe.CR)(100*Number(t),2)}%`;var t},align:Vt.Ay.RIGHT},bl={name:ll,header:hl.DataSize,render:({row:e})=>(0,Pe.ZV)(e.DataSize),align:Vt.Ay.RIGHT},fl={name:sl,header:hl.TabletId,render:({row:e})=>e.TabletId?(0,d.jsx)(Xo.$,{tabletId:e.TabletId}):"\u2013",sortable:!1,width:220},Sl={name:dl,header:hl.NodeId,render:({row:e})=>e.NodeId?(0,d.jsx)($a.E,{to:(0,al.vI)(e.NodeId),children:e.NodeId}):"\u2013",align:Vt.Ay.RIGHT},El={name:ol,header:hl.CPUCores,render:({row:e})=>(0,d.jsx)(el.U,{value:(0,Pe.CR)(100*Number(e.CPUCores),2),theme:tl(100*Number(e.CPUCores))}),align:Vt.Ay.RIGHT,sortable:!1,width:140,resizeMinWidth:140},Tl={name:pl,header:hl.InFlightTxCount,render:({row:e})=>(0,Pe.ZV)(e.InFlightTxCount),align:Vt.Ay.RIGHT},Nl=({tenantName:e,path:t})=>{var a,n;const r=(0,pr.zy)(),i=(0,Ae.mA)(r),[s]=(0,he.Nt)(),{currentData:o,isFetching:l,error:c}=Yo.useGetTopShardsQuery({database:e,path:t},{pollingInterval:s}),u=l&&void 0===o,p=(null===o||void 0===o||null===(a=o.resultSets)||void 0===a||null===(n=a[0])||void 0===n?void 0:n.result)||[],m=((e,t)=>[fl,yl(e,t),El])(e,r),h=Os({entity:Oi("shards"),postfix:Oi("by-cpu-usage"),link:(0,ga.YL)({...i,[ga.vh.diagnosticsTab]:ge.iJ.topShards})});return(0,d.jsx)(_s,{columnsWidthLSKey:il,data:p||[],columns:m,title:h,loading:u,error:(0,Ft.Cb)(c)})},jl=[{title:Oi("charts.cpu-usage"),metrics:["IC","IO","Batch","User","System"].map((e=>({target:`resources.cpu.${e}.usage`,title:e}))),options:{dataType:"percent",scaleRange:{min:0,max:1}}}];function Cl({tenantName:e,additionalNodesProps:t}){return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(_i,{database:e,charts:jl}),(0,d.jsx)(ks,{tenantName:e,additionalNodesProps:t}),(0,d.jsx)(Ms,{tenantName:e,additionalNodesProps:t}),(0,d.jsx)(Nl,{tenantName:e,path:e}),(0,d.jsx)(Vo,{tenantName:e})]})}var wl=a(73473);function Pl({tenantName:e,additionalNodesProps:t}){const a=(0,he.e4)(),[n]=(0,he.Nt)(),[r,i]=function(e){const t=[(0,ws._E)(),(0,ws.Nh)(e),(0,ws.jl)(),(0,ws.fR)(),(0,ws.iX)(),(0,ws.oz)(),(0,ws.qp)(e)].map((e=>({...e,sortable:!1}))),a=t.map((e=>e.name));return[t,(0,Ds.R)(a,Ps.fN)]}({getNodeRef:null===t||void 0===t?void 0:t.getNodeRef,database:e}),{currentData:s,isFetching:o,error:l}=Is.s.useGetNodesQuery({tenant:e,type:"any",tablets:!0,sort:"-Memory",limit:me.Nz,fieldsRequired:i},{pollingInterval:n}),c=o&&void 0===s,u=(null===s||void 0===s?void 0:s.Nodes)||[],p=Os({entity:Oi("nodes"),postfix:Oi("by-memory"),link:(0,ga.YL)({...a,[ga.vh.diagnosticsTab]:ge.iJ.nodes})});return(0,d.jsx)(_s,{columnsWidthLSKey:Ps.zO,data:u,columns:r,title:p,loading:c,error:l,emptyDataMessage:Oi("top-nodes.empty-data")})}const Il=[{title:Oi("charts.memory-usage"),metrics:[{target:"resources.memory.used_bytes",title:Oi("charts.memory-usage")}],options:{dataType:"size"}}];function Dl({tenantName:e,memoryStats:t,memoryUsed:a,memoryLimit:r}){return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(_i,{database:e,charts:Il}),(0,d.jsx)("div",{className:As("title"),children:"Memory details"}),(0,d.jsx)("div",{className:As("memory-info"),children:t?(0,d.jsx)(wl.S,{formatValues:Pe.vX,stats:t}):(0,d.jsx)(ys.O,{value:a,capacity:r,formatValues:Pe.vX,colorizeProgress:!0})}),(0,d.jsx)(Pl,{tenantName:e})]})}var Al=a(18863),_l=a(10174),Rl=a(19093),Ol=a(10360);function Ml({tenant:e}){const t=(0,he.e4)(),a=(0,fe.Pm)(),n=(0,fe.YA)(),[r]=(0,he.Nt)(),[i,s]=function(){const e=(0,Rl.k)(),t=e.map((e=>e.name));return[e,(0,Ds.R)(t,Ol.YX)]}(),{currentData:o,isFetching:l,error:c}=_l.S.useGetStorageGroupsInfoQuery({tenant:e,sort:"-Usage",with:"all",limit:me.Nz,shouldUseGroupsHandler:n,fieldsRequired:s},{pollingInterval:r,skip:!a}),u=l&&void 0===o,p=(null===o||void 0===o?void 0:o.groups)||[],m=Os({entity:Oi("groups"),postfix:Oi("by-usage"),link:(0,ga.YL)({...t,[ga.vh.diagnosticsTab]:ge.iJ.storage})});return(0,d.jsx)(_s,{columnsWidthLSKey:Ol.qK,data:p,columns:i,title:m,loading:u||!a,error:c})}const kl=e=>`\nSELECT\n    Path, SUM(DataSize) as Size\nFROM \`${e}/.sys/partition_stats\`\nGROUP BY Path\n    ORDER BY Size DESC\n    LIMIT ${me.Nz}\n`,Ll=oe.F.injectEndpoints({endpoints:e=>({getTopTables:e.query({queryFn:async({path:e},{signal:t})=>{try{const a=await window.api.viewer.sendQuery({query:kl(e),database:e,action:"execute-scan"},{signal:t,withRetries:!0});return(0,Ft.We)(a)?{error:a}:{data:(0,Ft.fW)(a)}}catch(a){return{error:a||"Unauthorized"}}},providesTags:["All"]})}),overrideExisting:"throw"});function zl({path:e}){var t,a;const n=(0,pr.zy)(),[r]=(0,he.Nt)(),{currentData:i,error:s,isFetching:o}=Ll.useGetTopTablesQuery({path:e},{pollingInterval:r}),l=o&&void 0===i,c=(null===i||void 0===i||null===(t=i.resultSets)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.result)||[],u=[{name:"Size",width:100,sortable:!1,render:({row:e})=>(e=>{const t=(0,wa.dd)(null!==c&&void 0!==c&&c.length?Number(c[0].Size):0,0);return(0,wa.z3)({value:e,size:t,precision:1})})(Number(e.Size)),align:Vt.Ay.RIGHT},{name:"Path",width:700,sortable:!1,render:({row:e})=>e.Path?(0,d.jsx)(jt.s,{content:e.Path,children:(0,d.jsx)(Zo,{path:String(e.Path),location:n,children:e.Path})}):null}],p=Os({entity:Oi("tables"),postfix:Oi("by-size")});return(0,d.jsx)(_s,{columnsWidthLSKey:"topTablesTableColumnsWidth",data:c||[],columns:u,title:p,loading:l,error:(0,Ft.Cb)(s)})}const Fl=[{title:Oi("charts.storage-usage"),metrics:[{target:"resources.storage.used_bytes",title:Oi("charts.storage-usage")}],options:{dataType:"size"}}];function Ul({tenantName:e,metrics:t}){const{blobStorageUsed:a,tabletStorageUsed:r,blobStorageLimit:i,tabletStorageLimit:s}=t,o=[{label:(0,d.jsx)(Ha,{text:Oi("storage.tablet-storage-title"),popoverContent:Oi("storage.tablet-storage-description")}),value:(0,d.jsx)(ys.O,{value:r,capacity:s,formatValues:Pe.j9,colorizeProgress:!0,warningThreshold:75,dangerThreshold:85})},{label:(0,d.jsx)(Ha,{text:Oi("storage.db-storage-title"),popoverContent:Oi("storage.db-storage-description")}),value:(0,d.jsx)(ys.O,{value:a,capacity:i,formatValues:Pe.j9,colorizeProgress:!0,warningThreshold:75,dangerThreshold:85})}];return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(_i,{database:e,charts:Fl}),(0,d.jsx)(Al.z,{className:As("storage-info"),title:"Storage details",info:o}),(0,d.jsx)(zl,{path:e}),(0,d.jsx)(Ml,{tenant:e})]})}function ql({tenantName:e,additionalTenantProps:t,additionalNodesProps:a}){var n,r,i;const{metricsTab:s}=(0,he.N4)((e=>e.tenant)),[o]=(0,he.Nt)(),{currentData:l,isFetching:c}=Se.z6.useGetTenantInfoQuery({path:e},{pollingInterval:o}),u=c&&void 0===l,{Name:p,Type:m,Overall:h}=l||{},v=(g=m)&&$[g];var g;const{currentData:y}=le.useGetOverviewQuery({path:e,database:e},{pollingInterval:o}),{Tables:x,Topics:b}=(null===y||void 0===y||null===(n=y.PathDescription)||void 0===n||null===(r=n.DomainDescription)||void 0===r?void 0:r.DiskSpaceUsage)||{},f=[null===x||void 0===x?void 0:x.TotalSize,null===b||void 0===b?void 0:b.DataSize].reduce(((e,t)=>t?e+Number(t):e),0),S={...l,Metrics:{...null===l||void 0===l?void 0:l.Metrics,Storage:String(f)}},{blobStorage:E,tabletStorage:T,blobStorageLimit:N,tabletStorageLimit:j,poolsStats:C,memoryStats:w,blobStorageStats:P,tabletStorageStats:I}=(0,ui.uI)(S),D={blobStorageUsed:E,blobStorageLimit:N,tabletStorageUsed:T,tabletStorageLimit:j};if(u)return(0,d.jsx)("div",{className:As("loader"),children:(0,d.jsx)(oi.a,{size:"m"})});const A=null===t||void 0===t||null===(i=t.getMonitoringLink)||void 0===i?void 0:i.call(t,p,m);return(0,d.jsxs)("div",{className:As(),children:[(0,d.jsxs)("div",{className:As("info"),children:[(0,d.jsx)("div",{className:As("top-label"),children:v}),(0,d.jsxs)("div",{className:As("top"),children:[(0,d.jsx)("div",{className:As("tenant-name-wrapper"),children:(0,d.jsx)(rr.c,{status:h,name:p||me.oK,withLeftTrim:!0,hasClipboardButton:Boolean(l),clipboardButtonAlwaysVisible:!0})}),A&&(0,d.jsx)(di,{href:A})]}),(0,d.jsx)(Ts,{poolsCpuStats:C,memoryStats:w,blobStorageStats:P,tabletStorageStats:I,tenantName:e})]}),(()=>{switch(s){case ge.pA.cpu:return(0,d.jsx)(Cl,{tenantName:e,additionalNodesProps:a});case ge.pA.storage:return(0,d.jsx)(Ul,{tenantName:e,metrics:D});case ge.pA.memory:return(0,d.jsx)(Dl,{tenantName:e,memoryUsed:S.MemoryUsed,memoryLimit:S.MemoryLimit,memoryStats:S.MemoryStats});case ge.pA.healthcheck:return(0,d.jsx)(ss,{tenantName:e});default:return(0,d.jsx)(ki,{database:e})}})()]})}const Ql=(0,c.cn)("kv-detailed-overview");const Bl=function(e){const{type:t,tenantName:a,path:n,additionalTenantProps:r,additionalNodesProps:i}=e,s=a===n;return(0,d.jsx)("div",{className:Ql(),children:s?(0,d.jsx)("div",{className:Ql("section"),children:(0,d.jsx)(ql,{tenantName:a,additionalTenantProps:r,additionalNodesProps:i})}):(0,d.jsx)(ii,{type:t,path:n,database:a})})},$l={id:ge.iJ.overview,title:"Info"},Gl={id:ge.iJ.schema,title:"Schema"},Hl={id:ge.iJ.topQueries,title:"Queries"},Wl={id:ge.iJ.topShards,title:"Top shards"},Vl={id:ge.iJ.nodes,title:"Nodes"},Jl={id:ge.iJ.tablets,title:"Tablets"},Yl={id:ge.iJ.storage,title:"Storage"},Kl={id:ge.iJ.network,title:"Network"},Zl={id:ge.iJ.describe,title:"Describe"},Xl={id:ge.iJ.hotKeys,title:"Hot keys"},ec={id:ge.iJ.graph,title:"Graph"},tc={id:ge.iJ.consumers,title:"Consumers"},ac={id:ge.iJ.partitions,title:"Partitions"},nc=[$l,Jl,Zl],rc=[$l,Hl,Wl,Vl,Jl,Yl,Kl,Zl,{id:ge.iJ.configs,title:"Configs"},{id:ge.iJ.operations,title:"Operations"}],ic=[$l,Gl,Wl,Vl,ec,Jl,Xl,Zl],sc=[$l,Gl,Wl,Vl,Jl,Zl],oc=[$l,Wl,Vl,Zl],lc=[$l,tc,ac,Vl,Jl,Zl],cc=[$l,tc,ac,Vl,Jl,Zl],dc=[$l,Zl],uc=[$l,Gl,Zl],pc=[$l,Gl,Zl],mc={[f.EPathTypeInvalid]:void 0,[f.EPathTypeSubDomain]:rc,[f.EPathTypeExtSubDomain]:rc,[f.EPathTypeColumnStore]:rc,[f.EPathTypeTable]:ic,[f.EPathTypeColumnTable]:sc,[f.EPathTypeDir]:oc,[f.EPathTypeTableIndex]:oc,[f.EPathTypeCdcStream]:lc,[f.EPathTypePersQueueGroup]:cc,[f.EPathTypeExternalDataSource]:dc,[f.EPathTypeExternalTable]:uc,[f.EPathTypeView]:pc,[f.EPathTypeReplication]:nc};var hc=a(81240),vc=a(80604);const gc=oe.F.injectEndpoints({endpoints:e=>({getHotKeys:e.query({queryFn:async({path:e,database:t},{signal:a})=>{try{var n;const r=await window.api.viewer.getHotKeys({path:e,database:t,enableSampling:!0},{signal:a});if(Array.isArray(r.hotkeys))return{data:r.hotkeys};await Promise.race([new Promise((e=>{setTimeout(e,5e3)})),new Promise(((e,t)=>{a.addEventListener("abort",t)}))]);return{data:null!==(n=(await window.api.viewer.getHotKeys({path:e,database:t,enableSampling:!1},{signal:a})).hotkeys)&&void 0!==n?n:null}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"}),yc=JSON.parse('{"hot-keys-collecting":"Please wait a little while we are collecting hot keys samples...","no-data":"No information about hot keys","help":"Hot keys contains a list of table primary key values that are accessed most often. Sample is collected upon request to the tab during 5s time interval. Samples column indicates how many requests to the particular key value were registered during collection phase."}'),xc=(0,rt.g4)("ydb-hot-keys",{en:yc});var bc;function fc(){return fc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},fc.apply(this,arguments)}const Sc=function(e){return n.createElement("svg",fc({viewBox:"0 0 12 7",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e),bc||(bc=n.createElement("path",{d:"M8 7h3V5h1V2H6.66C6.085.79 4.86 0 3.5 0 1.57 0 0 1.57 0 3.5S1.57 7 3.5 7c1.36 0 2.59-.79 3.16-2H8v2zm2-1H9V4H5.97l-.115.335a2.5 2.5 0 110-1.67L5.97 3H11v1h-1v2zM3.5 5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zM3 3.5a.5.5 0 111 0 .5.5 0 01-1 0z"})))},Ec=(0,c.cn)("ydb-hot-keys"),Tc="accessSample";function Nc({path:e,database:t}){var a,r;const{currentData:i,isFetching:s,error:o}=gc.useGetHotKeysQuery({path:e,database:t}),l=s&&void 0===i,[c]=(0,he.Nt)(),{currentData:u,isLoading:p}=le.useGetOverviewQuery({path:e,database:t},{pollingInterval:c}),m=null===u||void 0===u||null===(a=u.PathDescription)||void 0===a||null===(r=a.Table)||void 0===r?void 0:r.KeyColumnNames,h=n.useMemo((()=>((e=[])=>[...e.map(((e,t)=>({name:e,header:(0,d.jsxs)("div",{className:Ec("primary-key-column"),children:[(0,d.jsx)(Tt.I,{data:Sc,width:12,height:7}),e]}),render:({row:e})=>e.keyValues[t],align:Vt.Ay.RIGHT,sortable:!1}))),{name:Tc,header:"Samples",render:({row:e})=>e.accessSample,align:Vt.Ay.RIGHT,sortable:!1}])(m)),[m]);return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(jc,{}),l||p?(0,d.jsx)("div",{children:xc("hot-keys-collecting")}):o?(0,d.jsx)(Ne.o,{error:o}):i?(0,d.jsx)(Xe.l,{wrapperClassName:Ec("table"),columns:h,data:i,settings:me.N3,initialSortOrder:{columnId:Tc,order:Vt.Ay.DESCENDING}}):(0,d.jsx)("div",{children:xc("no-data")})]})}function jc(){const[e,t]=(0,he.iK)(me.Gj);return e?null:(0,d.jsxs)(vc.Z,{theme:"info",view:"filled",type:"container",className:Ec("help-card"),children:[xc("help"),(0,d.jsx)(wn.$,{className:Ec("help-card__close-button"),view:"flat",onClick:()=>t(!0),children:(0,d.jsx)(Tt.I,{data:hc.A,size:18})})]})}var Cc=a(78524),wc=a(9252);const Pc=oe.F.injectEndpoints({endpoints:e=>({getNetworkInfo:e.query({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.viewer.getNetwork({path:e,database:e},{signal:t})}}catch(a){return{error:a}}},providesTags:["All"]})}),overrideExisting:"throw"});var Ic=a(88610);const Dc=(0,c.cn)("node-network");function Ac(){}function _c({nodeId:e,connected:t,capacity:a,rack:r,status:i,onClick:s=Ac,onMouseEnter:o=Ac,onMouseLeave:l=Ac,showID:c,isBlurred:u}){const p=n.useRef(null),m=i||function(e=0,t=0){const a=Math.floor(e/t*100);return 100===a?Yi.m.Green:a>=70?Yi.m.Yellow:a>=1?Yi.m.Red:Yi.m.Grey}(t,a);return(0,d.jsx)("div",{ref:p,className:Dc({[m.toLowerCase()]:!0,id:c,blur:u}),onMouseEnter:()=>{o(p.current,{nodeId:e,connected:t,capacity:a,rack:r},"node")},onMouseLeave:()=>{l()},onClick:()=>s(e),children:c?e:null})}const Rc=e=>null===e||void 0===e?void 0:e.reduce(((e,t)=>t.Connected?e+1:e),0);var Oc,Mc,kc,Lc,zc,Fc,Uc,qc,Qc,Bc,$c,Gc,Hc,Wc,Vc;function Jc(){return Jc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Jc.apply(this,arguments)}const Yc=function(e){return n.createElement("svg",Jc({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 221 204"},e),Oc||(Oc=n.createElement("path",{d:"M68.46 2.529v25.227c0 1.227.876 2.278 2.102 2.511 16.643 2.979 29.14 17.812 28.498 35.448-.642 18.045-15.359 32.703-33.345 33.403-17.636.643-32.41-11.854-35.448-28.44a2.562 2.562 0 00-2.51-2.102H2.528c-1.519 0-2.687 1.285-2.512 2.745 3.446 32.703 31.243 58.106 64.939 57.814 35.155-.292 63.829-29.024 64.121-64.18.292-33.695-25.17-61.492-57.873-64.938-1.46-.175-2.744.993-2.744 2.512z",fill:"#EBF2FA"})),Mc||(Mc=n.createElement("path",{d:"M22.736 18.354l17.811 17.812c.876.876 2.278.992 3.329.233 4.146-3.095 9.052-5.197 14.366-6.19 1.226-.233 2.102-1.226 2.102-2.511V2.528a2.502 2.502 0 00-2.803-2.51C44.46 1.418 32.488 6.674 22.91 14.674c-1.168.935-1.226 2.628-.175 3.68zm-9.403 6.133C6.093 33.83 1.303 45.16.02 57.54c-.176 1.46 1.05 2.745 2.51 2.745H27.7a2.562 2.562 0 002.511-2.103c.818-4.672 2.628-9.051 5.14-12.847a2.642 2.642 0 00-.293-3.212L17.13 24.312c-1.05-1.11-2.861-.993-3.796.175zm67.275 107.392h32.995c1.868 0 3.387 1.518 3.445 3.445v65.231a3.451 3.451 0 01-3.445 3.445H80.608a3.452 3.452 0 01-3.446-3.445v-65.231a3.451 3.451 0 013.446-3.445zm77.844 27.097h-32.878a3.514 3.514 0 00-3.503 3.504v37.959a3.514 3.514 0 003.503 3.504h32.878a3.515 3.515 0 003.504-3.504V162.48a3.515 3.515 0 00-3.504-3.504zm12.205 18.28h32.586a3.639 3.639 0 013.621 3.62v19.388a3.639 3.639 0 01-3.621 3.621h-32.586a3.639 3.639 0 01-3.62-3.621v-19.388a3.638 3.638 0 013.62-3.62z",fill:"#EBF2FA"})),kc||(kc=n.createElement("path",{d:"M134.275 171.532h-113c-5.84 0-10.628-4.789-10.628-10.629v-73.23c0-5.84 4.788-10.629 10.628-10.629h112.941c5.84 0 10.629 4.789 10.629 10.629v73.23c.058 5.899-4.731 10.629-10.57 10.629v0z",stroke:"#2EE5C0",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})),Lc||(Lc=n.createElement("path",{d:"M21.625 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074zM31.494 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074zM41.363 90.769a3.037 3.037 0 100-6.074 3.037 3.037 0 000 6.074z",fill:"#2EE5C0"})),zc||(zc=n.createElement("path",{d:"M10.822 98.592h133.673",stroke:"#2EE5C0",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round"})),Fc||(Fc=n.createElement("path",{d:"M184.555 149.164L57.89 156.172c-4.263.234-7.767-3.037-7.767-7.3V51.114c0-4.263 3.504-7.533 7.767-7.3l126.665 7.008c3.27.176 5.898 3.33 5.898 7.008v84.327c0 3.679-2.628 6.832-5.898 7.007z",fill:"#027BF3"})),Uc||(Uc=n.createElement("path",{d:"M65.13 54.151c0 1.986-1.576 3.504-3.562 3.387-1.985-.058-3.562-1.752-3.562-3.737 0-1.986 1.635-3.504 3.562-3.387 1.927.058 3.562 1.752 3.562 3.737zm11.506.466a3.38 3.38 0 01-3.504 3.388c-1.927-.059-3.504-1.753-3.504-3.68a3.38 3.38 0 013.504-3.387c1.927.117 3.504 1.752 3.504 3.68zm7.825 3.855c1.869.117 3.387-1.402 3.387-3.329 0-1.927-1.518-3.562-3.387-3.62-1.927-.117-3.445 1.401-3.445 3.328 0 1.927 1.576 3.562 3.445 3.62z",fill:"#fff"})),qc||(qc=n.createElement("path",{d:"M75.467 142.974V85.277c-3.971-.525-8.584-.409-13.899.7v57.64l13.899-.643zM88.84 90.651v51.799l-11.096.467v-57.23c4.322.934 7.942 2.745 11.096 4.964zm13.431 13.899a1.618 1.618 0 01-.146-.176 1.487 1.487 0 00-.146-.175c-.42-.51-.841-1.026-1.265-1.546-2.875-3.522-5.874-7.197-9.538-10.25v49.93l11.095-.467V104.55zm13.432 5.722c-3.913-.058-7.709-.701-11.096-3.445v34.922l11.096-.468v-31.009zm13.431-.409c-2.764-.173-5.529.006-8.246.181-.957.062-1.907.123-2.849.169v30.951l11.095-.467v-30.834zm24.002 29.841l-8.234.35v-22.191c8.176 9.285 8.234 21.841 8.234 21.841zM140.113 113.6a19.774 19.774 0 012.453 1.927v24.644l-11.096.467v-30.483c2.92.467 5.782 1.46 8.643 3.445z",fill:"#00236B"})),Qc||(Qc=n.createElement("path",{d:"M55.745 76.436a2 2 0 103.123 2.499l-3.123-2.499zm5.766-4.006l1.575-1.233a2 2 0 00-3.136-.017l1.561 1.25zm2.63 6.605a2 2 0 103.15-2.465l-3.15 2.465zm107.94 53.502a2 2 0 00-2.499 3.123l2.499-3.123zm4.006 5.766l1.214 1.59a1.999 1.999 0 00.036-3.151l-1.25 1.561zm-6.644 2.557a1.999 1.999 0 102.427 3.179l-2.427-3.179zM58.868 78.935l4.205-5.256-3.123-2.499-4.205 5.256 3.123 2.499zm1.068-5.273l4.205 5.373 3.15-2.465-4.205-5.373-3.15 2.465zm109.646 61.998l5.256 4.205 2.499-3.123-5.256-4.205-2.499 3.123zm5.292 1.054l-5.431 4.146 2.427 3.179 5.431-4.146-2.427-3.179zM147.137 69.146a2 2 0 10-.149 3.998l.149-3.998zm29.634 5.107a2 2 0 10.149-3.997l-.149 3.997zm-29.657 5.404a2 2 0 00-.102 3.999l.102-3.999zm29.681 4.758a2 2 0 00.102-3.999l-.102 4zm-29.72 5.928a2 2 0 10-.023 4l.023-4zm29.759 4.176a2 2 0 10.024-4l-.024 4zm-29.846-21.375l29.783 1.11.149-3.998-29.783-1.11-.149 3.998zm.024 10.512l29.783.76.102-4-29.783-.759-.102 3.999zm.04 10.687l29.782.176.024-4-29.783-.175-.023 4zM143.442 71.202a2.458 2.458 0 01-2.57 2.453c-1.401-.058-2.569-1.285-2.569-2.686 0-1.402 1.168-2.57 2.569-2.453 1.46.058 2.57 1.285 2.57 2.686zm.001 10.396a2.458 2.458 0 01-2.57 2.453c-1.401-.059-2.569-1.285-2.569-2.686 0-1.46 1.168-2.57 2.569-2.453 1.46.058 2.57 1.284 2.57 2.686zm-2.57 12.848a2.458 2.458 0 002.57-2.453c0-1.402-1.11-2.628-2.57-2.686-1.401-.117-2.569 1.05-2.569 2.452s1.168 2.628 2.569 2.687z",fill:"#fff"})),Bc||(Bc=n.createElement("path",{opacity:.2,d:"M190.452 91.875V57.771c0-3.68-2.628-6.833-5.899-7.008l-23.651-1.285a35.18 35.18 0 00-1.752 10.98c0 17.635 12.79 31.826 28.09 31.65 1.051.06 2.16-.058 3.212-.233z",fill:"#00236B"})),$c||($c=n.createElement("path",{d:"M220.645 58.883c0-16.585-11.621-30.775-26.454-31.651-15.3-.876-28.089 12.672-28.089 30.308s12.789 31.827 28.089 31.652c14.833-.117 26.454-13.724 26.454-30.309z",fill:"#FF4645"})),Gc||(Gc=n.createElement("path",{d:"M215.329 40.372c-4.788-7.475-12.38-12.614-21.14-13.14v31.01l21.14-17.87z",fill:"#FC0"})),Hc||(Hc=n.createElement("path",{d:"M215.329 40.372l-21.14 17.87 26.455.642c0-6.89-1.986-13.315-5.315-18.512z",fill:"#00236B"})),Wc||(Wc=n.createElement("path",{d:"M194.248 58.24V27.233c-15.301-.876-28.09 12.672-28.09 30.308l28.09.7z",fill:"#FF4645"})),Vc||(Vc=n.createElement("path",{d:"M161.151 14.734a2 2 0 10-4 0h4zm-4 4.204a2 2 0 004 0h-4zm4 8.876a2 2 0 10-4 0h4zm-4 4.555a2 2 0 004 0h-4zm10.819-6.816a2 2 0 000-4v4zm-4.263-4a2 2 0 100 4v-4zm-9.169 4a2 2 0 100-4v4zm-4.263-4a2 2 0 000 4v-4zm6.876-6.82v4.205h4v-4.204h-4zm0 13.08v4.556h4v-4.555h-4zm10.819-6.26h-4.263v4h4.263v-4zm-13.432 0h-4.263v4h4.263v-4z",fill:"#2EE5C0"})))},Kc=(0,c.cn)("network");function Zc({tenantName:e}){var t,a;const[r]=(0,he.Nt)(),i=(0,he.N4)(Ic.yV),s=(0,he.YQ)(),[o,l]=n.useState(),[c,u]=n.useState(!1),[p,m]=n.useState(!1),{currentData:h,isFetching:v,error:g}=Pc.useGetNetworkInfoQuery(e,{pollingInterval:r});if(v&&void 0===h)return(0,d.jsx)("div",{className:"loader",children:(0,d.jsx)(oi.a,{size:"l"})});const y=h,x=null!==(t=(null===y||void 0===y?void 0:y.Tenants)&&y.Tenants[0].Nodes)&&void 0!==t?t:[];if(!g&&0===x.length)return(0,d.jsx)("div",{className:"error",children:"no nodes data"});const b=ed(x,"NodeType"),f=o?ed(null!==(a=o.Peers)&&void 0!==a?a:[],"NodeType"):{};return(0,d.jsxs)("div",{className:Kc(),children:[g?(0,d.jsx)(Ne.o,{error:g}):null,x.length>0?(0,d.jsx)("div",{className:Kc("inner"),children:(0,d.jsxs)("div",{className:Kc("nodes-row"),children:[(0,d.jsxs)("div",{className:Kc("left"),children:[(0,d.jsx)("div",{className:Kc("controls-wrapper"),children:(0,d.jsxs)("div",{className:Kc("controls"),children:[(0,d.jsx)(wc.k,{value:i,onChange:e=>{s((0,Ic.$u)(e))},className:Kc("problem-filter")}),(0,d.jsx)("div",{className:Kc("checkbox-wrapper"),children:(0,d.jsx)(Te.S,{onUpdate:()=>{u(!c)},checked:c,children:"ID"})}),(0,d.jsx)("div",{className:Kc("checkbox-wrapper"),children:(0,d.jsx)(Te.S,{onUpdate:()=>{m(!p)},checked:p,children:"Racks"})})]})}),(0,d.jsx)(Xc,{nodes:b,showId:c,showRacks:p,clickedNode:o,onClickNode:l})]}),(0,d.jsx)("div",{className:Kc("right"),children:o?(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:Kc("label"),children:["Connectivity of node"," ",(0,d.jsx)(xe.N_,{className:Kc("link"),to:(0,al.vI)(o.NodeId),children:o.NodeId})," ","to other nodes"]}),(0,d.jsx)("div",{className:Kc("nodes-row"),children:(0,d.jsx)(Xc,{nodes:f,isRight:!0,showId:c,showRacks:p,clickedNode:o,onClickNode:l})})]}):(0,d.jsxs)("div",{className:Kc("placeholder"),children:[(0,d.jsx)("div",{className:Kc("placeholder-img"),children:(0,d.jsx)(Tt.I,{data:Yc,width:221,height:204})}),(0,d.jsx)("div",{className:Kc("placeholder-text"),children:"Select node to see its connectivity to other nodes"})]})})]})}):null]})}function Xc({nodes:e,isRight:t,showId:a,showRacks:n,clickedNode:r,onClickNode:i}){const s=(0,he.N4)(Ic.yV),o=(0,he.YQ)();let l=0;const c=Object.keys(e).map(((c,u)=>{const p=ed(e[c],"Rack");return(0,d.jsxs)("div",{className:Kc("nodes-container",{right:t}),children:[(0,d.jsxs)("div",{className:Kc("nodes-title"),children:[c," nodes"]}),(0,d.jsx)("div",{className:Kc("nodes"),children:n?Object.keys(p).map(((e,n)=>(0,d.jsxs)("div",{className:Kc("rack-column"),children:[(0,d.jsx)("div",{className:Kc("rack-index"),children:"undefined"===e?"?":e}),p[e].map(((e,n)=>{let c,u;return!t&&"Peers"in e&&e.Peers&&(c=Object.keys(e.Peers).length,u=Rc(e.Peers)),s===Ic.s$.PROBLEMS&&c!==u||s===Ic.s$.ALL||t?(l++,(0,d.jsx)(_c,{nodeId:e.NodeId,showID:a,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:c,connected:u,onMouseEnter:(...e)=>{o((0,we.DK)(...e))},onMouseLeave:()=>{o((0,we.w7)())},onClick:t?void 0:()=>{i(r&&e.NodeId===r.NodeId?void 0:e)},isBlurred:!t&&r&&r.NodeId!==e.NodeId},n)):null}))]},n))):e[c].map(((e,n)=>{let c,u;const p=e&&"Peers"in e?e.Peers:void 0;return!t&&"Peers"in e&&e.Peers&&(c=e.Peers.length,u=Rc(p)),s===Ic.s$.PROBLEMS&&c!==u||s===Ic.s$.ALL||t?(l++,(0,d.jsx)(_c,{nodeId:e.NodeId,showID:a,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:null===p||void 0===p?void 0:p.length,connected:u,onMouseEnter:(...e)=>{o((0,we.DK)(...e))},onMouseLeave:()=>{o((0,we.w7)())},onClick:t?void 0:()=>{i(r&&e.NodeId===r.NodeId?void 0:e)},isBlurred:!t&&r&&r.NodeId!==e.NodeId},n)):null}))})]},u)}));return s===Ic.s$.PROBLEMS&&0===l?(0,d.jsx)(Cc.v,{name:"thumbsUp",width:"200"}):c}function ed(e,t){return e.reduce(((e,a)=>(e[a[t]]?e[a[t]].push(a):e[a[t]]=[a],e)),{})}const td=["NodeId","Host","Connections","NetworkUtilization","SendThroughput","ReceiveThroughput","PingTime","ClockSkew"],ad=["NodeId"],nd=["Host","DC","Rack","Uptime","ConnectStatus","NetworkUtilization","PingTime","ClockSkew"];function rd({database:e,path:t,parentRef:a,additionalNodesProps:n}){const r=(0,fe.Pm)(),i=(0,fe.WF)(),[s]=(0,he.iK)(me.g5),l=i&&s;return(0,d.jsx)(o.r,{loading:!r,children:(()=>{return l?(0,d.jsx)(Ke.G,{path:t,database:e,parentRef:a,withPeerRoleFilter:!0,additionalNodesProps:n,columns:(r={database:e,getNodeRef:null===n||void 0===n?void 0:n.getNodeRef},[(0,ws._E)(),(0,ws.Nh)(r,{statusForIcon:"ConnectStatus"}),(0,ws.uk)(),(0,ws.OX)(),(0,ws.jl)(),(0,ws.fr)(),(0,ws.kv)(),(0,ws.SH)(),(0,ws.H)(),(0,ws.DH)(),(0,ws.ui)(),(0,ws.wN)(),(0,ws.pt)()].map((e=>({...e,sortable:(0,Ps.sp)(e.name)})))),defaultColumnsIds:td,requiredColumnsIds:ad,selectedColumnsKey:"networkNodesTableSelectedColumns",groupByParams:nd}):(0,d.jsx)(Zc,{tenantName:e});var r})()})}var id=a(24600),sd=a(47058),od=a(29289),ld=a(41775);const cd=JSON.parse('{"lagsPopover.writeLags":"Write lags statistics (time format dd hh:mm:ss)","lagsPopover.readLags":"Read lags statistics (time format dd hh:mm:ss)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"Consumer:","controls.consumerSelector.emptyOption":"No consumer","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"No partitions match the current search","noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers"}'),dd=JSON.parse('{"lagsPopover.writeLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0437\u0430\u043f\u0438\u0441\u0438 (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","lagsPopover.readLags":"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0430\u0433\u043e\u0432 \u0447\u0442\u0435\u043d\u0438\u044f (\u0444\u043e\u0440\u043c\u0430\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0434\u0434 \u0447\u0447:\u043c\u043c:\u0441\u0441)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"\u0427\u0438\u0442\u0430\u0442\u0435\u043b\u044c:","controls.consumerSelector.emptyOption":"\u041d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"\u041f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u043e\u0438\u0441\u043a\u0443 \u043d\u0435\u0442 \u043f\u0430\u0440\u0442\u0438\u0446\u0438\u0439","noConsumersMessage.topic":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0442\u043e\u043f\u0438\u043a\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439","noConsumersMessage.stream":"\u0423 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0440\u0438\u043c\u0430 \u043d\u0435\u0442 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u0435\u0439"}'),ud=(0,rt.g4)("ydb-diagnostics-partitions",{ru:dd,en:cd}),pd={PARTITION_ID:"partitionId",STORE_SIZE:"storeSize",WRITE_SPEED:"writeSpeed",READ_SPEED:"readSpeed",WRITE_LAGS:"writeLags",READ_LAGS:"readLags",UNCOMMITED_MESSAGES:"uncommitedMessages",UNREAD_MESSAGES:"unreadMessages",START_OFFSET:"startOffset",END_OFFSET:"endOffset",COMMITED_OFFSET:"commitedOffset",READ_SESSION_ID:"readSessionId",READER_NAME:"readerName",PARTITION_HOST:"partitionHost",CONNECTION_HOST:"connectionHost"},md={[pd.PARTITION_ID]:"Partition ID",[pd.STORE_SIZE]:"Store size",[pd.WRITE_SPEED]:"Write speed",[pd.READ_SPEED]:"Read speed",[pd.WRITE_LAGS]:"Write lags, duration",[pd.READ_LAGS]:"Read lags, duration",[pd.UNCOMMITED_MESSAGES]:"Uncommited messages",[pd.UNREAD_MESSAGES]:"Unread messages",[pd.START_OFFSET]:"Start offset",[pd.END_OFFSET]:"End offset",[pd.COMMITED_OFFSET]:"Commited offset",[pd.READ_SESSION_ID]:"Read session ID",[pd.READER_NAME]:"Reader name",[pd.PARTITION_HOST]:"Partition host",[pd.CONNECTION_HOST]:"Connection host"},hd="partitionWriteLag",vd="partitionWriteIdleTime",gd={[hd]:"write lag",[vd]:"write idle time"},yd="consumerWriteLag",xd="consumerReadLag",bd="consumerReadIdleTime",fd={[yd]:"write lag",[xd]:"read lag",[bd]:"read idle time"},Sd=[pd.PARTITION_ID,pd.STORE_SIZE,pd.WRITE_SPEED,pd.WRITE_LAGS,pd.START_OFFSET,pd.END_OFFSET,pd.PARTITION_HOST],Ed=Object.values(pd),Td=({consumers:e,selectedConsumer:t,onSelectedConsumerChange:a,selectDisabled:r,partitions:i,onSearchChange:s,hiddenColumns:o,onHiddenColumnsChange:l,initialColumnsIds:c})=>{const[u,p]=n.useState(""),[m,h]=n.useState("");n.useEffect((()=>{if(!i)return;const e=new RegExp(Ca()(m),"i"),t=new RegExp(Ca()(u),"i"),a=i.filter((a=>{const{partitionId:n,readerName:r,readSessionId:i,partitionNodeId:s,connectionNodeId:o,partitionHost:l,connectionHost:c}=a,d=e.test(n),u=[r,i,s,o,l,c].filter(Boolean).map(String),p=0===u.length||u.some((e=>t.test(e)));return d&&p}));s(a)}),[m,u,i,s]);const v=n.useMemo((()=>{const t=e&&e.length?e.map((e=>({value:e,content:e}))):[];return[{value:"",content:ud("controls.consumerSelector.emptyOption")},...t]}),[e]),g=n.useMemo((()=>{const e=[];for(const t of c){const a=t===pd.PARTITION_ID,n={title:md[t],selected:Boolean(!o.includes(t)),id:t,required:a,sticky:a?"start":void 0};a?e.unshift(n):e.push(n)}return e}),[c,o]),y=e=>(0,d.jsx)("div",{className:Od("select-option",{empty:""===e.value}),children:e.content});return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Ee.l,{className:Od("consumer-select"),label:ud("controls.consumerSelector"),options:v,value:[t||""],onUpdate:e=>{a(e[0]||void 0)},filterable:e&&e.length>5,disabled:r||!e||!e.length,renderOption:y,renderSelectedOption:y}),(0,d.jsx)(ld.v,{onChange:e=>{h(e)},placeholder:ud("controls.partitionSearch"),className:Od("search",{partition:!0}),value:m}),(0,d.jsx)(ld.v,{onChange:e=>{p(e)},placeholder:ud("controls.generalSearch"),className:Od("search",{general:!0}),value:u}),(0,d.jsx)(od.O,{popupWidth:242,items:g,showStatus:!0,onUpdate:e=>{const t=[...o];e.forEach((e=>{e.selected||o.includes(e.id)?e.selected&&o.includes(e.id)&&t.splice(o.indexOf(e.id)):t.push(e.id)})),l(t)},sortable:!1},"TableColumnSetup")]})},Nd=(0,c.cn)("ydb-diagnostics-partitions-columns-header"),jd=({title:e})=>(0,d.jsx)("div",{className:Nd("multiline"),children:e}),Cd=()=>(0,d.jsx)("div",{className:Nd("read-session"),children:md[pd.READ_SESSION_ID]}),wd=()=>(0,d.jsx)(Ha,{className:Nd("lags"),text:md[pd.WRITE_LAGS],popoverContent:(0,d.jsx)(on,{text:ud("lagsPopover.writeLags"),type:"write"})}),Pd=()=>(0,d.jsx)(Ha,{className:Nd("lags"),text:md[pd.READ_LAGS],popoverContent:(0,d.jsx)(on,{text:ud("lagsPopover.readLags"),type:"read"})}),Id=()=>(0,d.jsx)(Ha,{className:Nd("messages"),text:md[pd.UNREAD_MESSAGES],popoverContent:(0,d.jsx)("div",{className:Nd("messages-popover-content"),children:ud("headers.unread")})}),Dd=()=>(0,d.jsx)(Ha,{className:Nd("messages"),text:md[pd.UNCOMMITED_MESSAGES],popoverContent:(0,d.jsx)("div",{className:Nd("messages-popover-content"),children:ud("headers.uncommited")})}),Ad=(0,c.cn)("ydb-diagnostics-partitions-columns"),_d=[{name:pd.PARTITION_ID,header:(0,d.jsx)(jd,{title:md[pd.PARTITION_ID]}),sortAccessor:e=>(0,Xr.kf)(e.partitionId)&&Number(e.partitionId),align:Vt.Ay.LEFT,render:({row:e})=>e.partitionId},{name:pd.STORE_SIZE,header:(0,d.jsx)(jd,{title:md[pd.STORE_SIZE]}),align:Vt.Ay.RIGHT,render:({row:e})=>(0,Pe.z3)(e.storeSize)},{name:pd.WRITE_SPEED,header:md[pd.WRITE_SPEED],align:Vt.Ay.LEFT,resizeMinWidth:140,sortAccessor:e=>e.writeSpeed.perMinute,render:({row:e})=>(0,d.jsx)(Fa,{data:e.writeSpeed})},{name:pd.READ_SPEED,header:md[pd.READ_SPEED],align:Vt.Ay.LEFT,resizeMinWidth:140,sortAccessor:e=>{var t;return null===(t=e.readSpeed)||void 0===t?void 0:t.perMinute},render:({row:e})=>(0,d.jsx)(Fa,{data:e.readSpeed})},{name:pd.WRITE_LAGS,header:(0,d.jsx)(wd,{}),className:Ad("lags-header"),sub:[{name:hd,header:gd[hd],align:Vt.Ay.RIGHT,render:({row:e})=>(0,Pe.lr)(e.partitionWriteLag)},{name:vd,header:gd[vd],align:Vt.Ay.RIGHT,render:({row:e})=>(0,Pe.lr)(e.partitionWriteIdleTime)}]},{name:pd.READ_LAGS,header:(0,d.jsx)(Pd,{}),className:Ad("lags-header"),sub:[{name:yd,header:fd[yd],align:Vt.Ay.RIGHT,render:({row:e})=>(0,Pe.lr)(e.consumerWriteLag)},{name:xd,header:fd[xd],align:Vt.Ay.RIGHT,render:({row:e})=>(0,Pe.lr)(e.consumerReadLag)},{name:bd,header:fd[bd],align:Vt.Ay.RIGHT,render:({row:e})=>(0,Pe.lr)(e.consumerReadIdleTime)}]},{name:pd.UNCOMMITED_MESSAGES,header:(0,d.jsx)(Dd,{}),align:Vt.Ay.RIGHT,render:({row:e})=>e.uncommitedMessages},{name:pd.UNREAD_MESSAGES,header:(0,d.jsx)(Id,{}),align:Vt.Ay.RIGHT,render:({row:e})=>e.unreadMessages},{name:pd.START_OFFSET,header:(0,d.jsx)(jd,{title:md[pd.START_OFFSET]}),sortAccessor:e=>(0,Xr.kf)(e.startOffset)&&Number(e.startOffset),align:Vt.Ay.RIGHT,render:({row:e})=>e.startOffset},{name:pd.END_OFFSET,header:(0,d.jsx)(jd,{title:md[pd.END_OFFSET]}),sortAccessor:e=>(0,Xr.kf)(e.endOffset)&&Number(e.endOffset),align:Vt.Ay.RIGHT,render:({row:e})=>e.endOffset},{name:pd.COMMITED_OFFSET,header:(0,d.jsx)(jd,{title:md[pd.COMMITED_OFFSET]}),sortAccessor:e=>(0,Xr.kf)(e.commitedOffset)&&Number(e.commitedOffset),align:Vt.Ay.RIGHT,render:({row:e})=>e.commitedOffset},{name:pd.READ_SESSION_ID,header:(0,d.jsx)(Cd,{}),align:Vt.Ay.LEFT,width:150,render:({row:e})=>e.readSessionId?(0,d.jsx)(rr.c,{name:e.readSessionId,showStatus:!1,hasClipboardButton:!0}):"\u2013"},{name:pd.READER_NAME,header:(0,d.jsx)(jd,{title:md[pd.READER_NAME]}),align:Vt.Ay.LEFT,width:150,render:({row:e})=>e.readerName?(0,d.jsx)(rr.c,{name:e.readerName,showStatus:!1,hasClipboardButton:!0}):"\u2013"},{name:pd.PARTITION_HOST,header:(0,d.jsx)(jd,{title:md[pd.PARTITION_HOST]}),align:Vt.Ay.LEFT,width:200,render:({row:e})=>e.partitionNodeId&&e.partitionHost?(0,d.jsx)(rr.c,{name:e.partitionHost,path:(0,al.vI)(e.partitionNodeId),showStatus:!1,hasClipboardButton:!0}):"\u2013"},{name:pd.CONNECTION_HOST,header:(0,d.jsx)(jd,{title:md[pd.CONNECTION_HOST]}),align:Vt.Ay.LEFT,width:200,render:({row:e})=>e.connectionNodeId&&e.connectionHost?(0,d.jsx)(rr.c,{name:e.connectionHost,path:(0,al.vI)(e.connectionNodeId),showStatus:!1,hasClipboardButton:!0}):"\u2013"}],Rd=_d.filter((e=>Sd.includes(e.name))),Od=(0,c.cn)("ydb-diagnostics-partitions"),Md=({path:e,database:t})=>{const a=(0,he.YQ)(),[r,i]=n.useState([]),s=(0,he.N4)((a=>_a(a,e,t))),[o]=(0,he.Nt)(),{selectedConsumer:l}=(0,he.N4)((e=>e.partitions)),{currentData:c,isFetching:u,error:p}=Pa.useGetTopicQuery({path:e,database:t}),m=u&&void 0===c,{currentData:h,isFetching:v,error:g}=id.m.useGetNodesListQuery(void 0),y=v&&void 0===h,x=(0,he.N4)(id.E),[f,S]=(0,he.iK)(me.bs),[E,T]=(e=>{const[t,a]=n.useState([]),[r,i]=n.useState([]);return n.useEffect((()=>{e?(a(_d),i(Ed)):(a(Rd),i(Sd))}),[e]),[t,r]})(l),N=m?b.hT:{path:e,database:t,consumerName:l},{currentData:j,isFetching:C,error:w}=sd.aD.useGetPartitionsQuery(N,{pollingInterval:o}),P=C&&void 0===j,I=j,D=n.useMemo((()=>((e=[],t)=>null===e||void 0===e?void 0:e.map((e=>{const a=e.partitionNodeId&&t?t.get(e.partitionNodeId):void 0,n=e.connectionNodeId&&t?t.get(e.connectionNodeId):void 0;return{...e,partitionHost:a,connectionHost:n}})))(I,x)),[I,x]);n.useEffect((()=>{const e=!m&&!s,t=l&&s&&!s.includes(l);(e||t)&&a((0,sd.WD)(void 0))}),[a,m,l,s]);const A=n.useMemo((()=>E.filter((e=>!f.includes(e.name)))),[E,f]),_=e=>{S(e)},R=e=>{a((0,sd.WD)(e))},O=m||y||P,M=g||p||w;return(0,d.jsxs)("div",{className:Od(),children:[(0,d.jsx)("div",{className:Od("controls"),children:(0,d.jsx)(Td,{consumers:s,selectedConsumer:l,onSelectedConsumerChange:R,selectDisabled:Boolean(M)||O,partitions:D,onSearchChange:i,hiddenColumns:f,onHiddenColumnsChange:_,initialColumnsIds:T})}),M?(0,d.jsx)(Ne.o,{error:M}):null,(0,d.jsx)("div",{className:Od("table-wrapper"),children:(0,d.jsx)("div",{className:Od("table-content"),children:j?O?(0,d.jsx)(zt.Q,{className:Od("loader")}):(0,d.jsx)(Xe.l,{columnsWidthLSKey:"partitionsColumnsWidth",wrapperClassName:Od("table"),data:r,columns:A,settings:me.N3,emptyDataMessage:ud("table.emptyDataMessage")}):null})})]})};var kd=a(44433),Ld=a(79142);const zd=JSON.parse('{"date-format":"MM/DD/YYYY","date-time-format":"MM/DD/YYYY HH:mm"}'),Fd=JSON.parse('{"date-format":"DD.MM.YYYY","date-time-format":"DD.MM.YYYY HH:mm"}'),Ud=(0,rt.g4)("ydb-date-range",{ru:Fd,en:zd});function qd(e){var t,a,n,r;return"relative"===(null===e||void 0===e||null===(t=e.start)||void 0===t?void 0:t.type)&&"relative"===(null===e||void 0===e||null===(a=e.end)||void 0===a?void 0:a.type)?"s":"relative"===(null===e||void 0===e||null===(n=e.start)||void 0===n?void 0:n.type)||"relative"===(null===e||void 0===e||null===(r=e.end)||void 0===r?void 0:r.type)?"m":"l"}const Qd=(0,c.cn)("date-range"),Bd={start:{value:"now-1h",type:"relative"},end:{value:"now",type:"relative"}},$d=({from:e,to:t,className:a,onChange:r})=>{const i=n.useCallback((e=>null===r||void 0===r?void 0:r(function(e){var t,a,n,r,i,s;return{from:"relative"===(null===e||void 0===e||null===(t=e.start)||void 0===t?void 0:t.type)?e.start.value.toString():String(null===(a=(0,yt.bQ)(null===e||void 0===e||null===(n=e.start)||void 0===n?void 0:n.value))||void 0===a?void 0:a.valueOf()),to:"relative"===(null===e||void 0===e||null===(r=e.end)||void 0===r?void 0:r.type)?e.end.value.toString():String(null===(i=(0,yt.bQ)(null===e||void 0===e||null===(s=e.end)||void 0===s?void 0:s.value))||void 0===i?void 0:i.valueOf())}}(e))),[r]),s=n.useMemo((()=>{if(e||t)return function(e){var t,a;const n=(0,yt.eP)(null!==(t=e.from)&&void 0!==t?t:""),r=(0,yt.eP)(null!==(a=e.to)&&void 0!==a?a:"");return{start:e.from?{type:n?"relative":"absolute",value:n?e.from:(0,yt.bQ)(Number(e.from))}:null,end:e.to?{type:r?"relative":"absolute",value:r?e.to:(0,yt.bQ)(Number(e.to))}:null}}({from:e,to:t})}),[e,t]),o=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,d.jsx)("div",{className:Qd(null,a),children:(0,d.jsx)(Ld.k,{withPresets:!0,className:Qd("range-input",{[qd(s)]:!0}),timeZone:o,value:s||Bd,allowNullableValues:!0,size:"m",format:Ud("date-time-format"),onUpdate:i,placeholder:`${Ud("date-time-format")} - ${Ud("date-time-format")}`,withApplyButton:!0})})},Gd=JSON.parse('{"no-data":"No data","filter.text.placeholder":"Search by query text or userSID...","mode_top":"Top","mode_running":"Running"}'),Hd=(0,rt.g4)("ydb-diagnostics-top-queries",{en:Gd}),Wd={...yo,disableSortReset:!0};function Vd(e){const[t,a]=(0,he.GY)({initialSortColumn:e,initialSortOrder:-1,multiple:!0}),r=n.useMemo((()=>(0,he.JN)(t,Oo)),[t]);return{tableSort:t,handleTableSort:a,backendSort:r}}const Jd=({database:e,onRowClick:t,rowClassName:a})=>{var r;const[i]=(0,he.Nt)(),s=(0,he.N4)((e=>e.executeTopQueries)),{tableSort:o,handleTableSort:l,backendSort:c}=Vd(Do),{currentData:u,isFetching:p,error:m}=Ls.Ke.useGetRunningQueriesQuery({database:e,filters:s,sortOrder:c},{pollingInterval:i}),h=p&&void 0===u,v=(null===u||void 0===u||null===(r=u.resultSets)||void 0===r?void 0:r[0].result)||[],g=n.useMemo((()=>[Qo,Ho,zo,Wo].map((e=>({...e,sortable:Mo(e.name)})))),[]);return(0,d.jsxs)(n.Fragment,{children:[m?(0,d.jsx)(Ne.o,{error:(0,Ft.Cb)(m)}):null,(0,d.jsx)(et.L.Table,{loading:h,children:(0,d.jsx)(Xe.l,{emptyDataMessage:Hd("no-data"),columnsWidthLSKey:"runningQueriesColumnsWidth",columns:g,data:v,settings:Wd,onRowClick:e=>t(e.QueryText),rowClassName:()=>a,sortOrder:o,onSort:l})})]})},Yd=({database:e,onRowClick:t,rowClassName:a})=>{var r,i;const[s]=(0,he.Nt)(),o=(0,he.N4)((e=>e.executeTopQueries)),{tableSort:l,handleTableSort:c,backendSort:u}=Vd(So),{currentData:p,isFetching:m,error:h}=Ls.Ke.useGetTopQueriesQuery({database:e,filters:o,sortOrder:u},{pollingInterval:s}),v=m&&void 0===p,g=(null===p||void 0===p||null===(r=p.resultSets)||void 0===r||null===(i=r[0])||void 0===i?void 0:i.result)||[],y=n.useMemo((()=>[$o,Lo,zo,Fo,Go,Uo,qo,Qo].map((e=>({...e,sortable:Mo(e.name)})))),[]);return(0,d.jsxs)(n.Fragment,{children:[h?(0,d.jsx)(Ne.o,{error:(0,Ft.Cb)(h)}):null,(0,d.jsx)(et.L.Table,{loading:v,children:(0,d.jsx)(Xe.l,{emptyDataMessage:Hd("no-data"),columnsWidthLSKey:fo,columns:y,data:g||[],settings:Wd,onRowClick:e=>t(e.QueryText),rowClassName:()=>a,sortOrder:l,onSort:c})})]})},Kd=(0,c.cn)("kv-top-queries"),Zd={top:"top",running:"running"},Xd=[{value:Zd.top,get content(){return Hd("mode_top")}},{value:Zd.running,get content(){return Hd("mode_running")}}],eu=Rt.z.nativeEnum(Zd).catch(Zd.top),tu=({tenantName:e})=>{const t=(0,he.YQ)(),a=(0,pr.zy)(),r=(0,pr.W6)(),[s=Zd.top,o]=(0,i.useQueryParam)("queryMode",i.StringParam),l=eu.parse(s),c=l===Zd.top,u=(0,he.N4)((e=>e.executeTopQueries)),p=uo(n.useCallback((e=>{t((0,zs.iZ)({input:e}));const n=(0,Ae.mA)(a),i=(0,ga.YL)({...n,[ge.Dt]:ge.Dg.query,[ga.vh.queryTab]:ge.tQ.newQuery});r.push(i)}),[t,r,a])),m=c?Yd:Jd;return(0,d.jsxs)(et.L,{children:[(0,d.jsxs)(et.L.Controls,{children:[(0,d.jsx)(kd.a,{options:Xd,value:l,onUpdate:o}),(0,d.jsx)(nt.v,{value:u.text,onChange:e=>{t((0,Ls.TX)({text:e}))},placeholder:Hd("filter.text.placeholder"),className:Kd("search")}),c?(0,d.jsx)($d,{from:u.from,to:u.to,onChange:e=>{t((0,Ls.TX)(e))}}):null]}),(0,d.jsx)(m,{database:e,onRowClick:p,rowClassName:Kd("row")})]})};var au=a(46496),nu=a(87747);const ru=JSON.parse('{"no-data":"No data","filters.mode.immediate":"Immediate","filters.mode.history":"Historical","description":"Historical data only tracks shards with CPU load over 70%"}'),iu=JSON.parse('{"no-data":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445","filters.mode.immediate":"\u041c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u044b\u0435","filters.mode.history":"\u0418\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0435","description":"\u0418\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043e \u0448\u0430\u0440\u0434\u0430\u0445 \u0441 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u043e\u0439 CPU \u0432\u044b\u0448\u0435 70%"}'),su=(0,rt.g4)("ydb-diagnostics-top-shards",{ru:iu,en:ru}),ou=({value:e,onChange:t})=>{const a=e.mode===nu.h.Immediate?void 0:e.from,r=e.mode===nu.h.Immediate?void 0:e.to;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)(kd.a,{value:e.mode,onUpdate:e=>{if(!((e,t)=>Object.values(e).includes(t))(nu.h,e)){const t=Object.values(nu.h).join(", ");throw new Error(`Unexpected TopShards mode "${e}". Should be one of: ${t}`)}t({mode:e})},children:[(0,d.jsx)(kd.a.Option,{value:nu.h.Immediate,children:su("filters.mode.immediate")}),(0,d.jsx)(kd.a.Option,{value:nu.h.History,children:su("filters.mode.history")})]}),(0,d.jsx)($d,{from:a,to:r,onChange:e=>{t({mode:nu.h.History,...e})}})]})};const lu=(0,c.cn)("top-shards"),cu={...me.N3,dynamicRender:!1,externalSort:!0,disableSortReset:!0,defaultOrder:Vt.Ay.DESCENDING};function du(e){return e?(0,Pe.r6)(new Date(e).getTime()):"\u2013"}function uu(e){return e.to="now",e.from="now-1h",e}const pu=({tenantName:e,path:t,type:a})=>{var r,i;const s=(0,he.YQ)(),o=(0,pr.zy)(),[l]=(0,he.Nt)(),c=(0,he.N4)((e=>e.shardsWorkload)),[u,p]=n.useState((()=>{const e={...c};return e.mode||(e.mode=nu.h.Immediate),e.from||e.to||uu(e),e})),{tableSort:m,handleTableSort:h,backendSort:v}=function(){const[e,t]=(0,he.GY)({initialSortColumn:ol,fixedOrderType:-1,multiple:!0}),a=n.useMemo((()=>(0,he.JN)(e,gl)),[e]);return{tableSort:e,handleTableSort:t,backendSort:a}}(),{currentData:g,isFetching:y,error:x}=au.Xx.useSendShardQueryQuery({database:e,path:t,sortOrder:v,filters:u},{pollingInterval:l}),b=y&&void 0===g,f=(null===g||void 0===g||null===(r=g.resultSets)||void 0===r||null===(i=r[0])||void 0===i?void 0:i.result)||[],S=e=>{const t={...e};if(!c.from&&!c.to&&!e.from&&!e.to)switch(e.mode){case nu.h.Immediate:t.from=t.to=void 0;break;case nu.h.History:uu(t)}s((0,au.rF)(e)),p((e=>({...e,...t})))},E=n.useMemo((()=>{const t=((e,t)=>[yl(e,t),xl,bl,fl,Sl,Tl])(e,o),a=t.map((e=>{return{...e,sortable:(t=e.name,Boolean(gl(t)))};var t}));return u.mode===nu.h.History&&(a.splice(5,0,{name:ul,render:({row:e})=>du(e.PeakTime),sortable:!1}),a.push({name:ml,render:({row:e})=>du(e.IntervalEnd)})),a}),[u.mode,o,e]);return(0,d.jsxs)(et.L,{children:[(0,d.jsx)(et.L.Controls,{children:(0,d.jsx)(ou,{value:u,onChange:S})}),u.mode===nu.h.History&&(0,d.jsx)("div",{className:lu("hint"),children:su("description")}),x?(0,d.jsx)(Ne.o,{error:(0,Ft.Cb)(x)}):null,(0,d.jsx)(et.L.Table,{loading:b,children:x&&!f?null:!f||Y(a)?su("no-data"):(0,d.jsx)(Xe.l,{columnsWidthLSKey:il,columns:E,data:f,settings:cu,onSort:h,sortOrder:m})})]})},mu=(0,c.cn)("kv-tenant-diagnostics");const hu=function(e){const t=n.useRef(null),a=(0,he.YQ)(),{diagnosticsTab:s=ge.iJ.overview}=(0,he.N4)((e=>e.tenant)),[o]=(0,i.useQueryParams)({database:i.StringParam,schema:i.StringParam,backend:i.StringParam,clusterName:i.StringParam}),l=Z(e.type)?e.path:e.tenantName,c=Z(e.type)||e.path===e.tenantName,u=(0,fe._Q)(),p=c?(({hasFeatureFlags:e})=>e?rc:rc.filter((e=>e.id!==ge.iJ.configs)))({hasFeatureFlags:u}):(m=e.type)&&mc[m]||oc;var m;let h=p.find((e=>e.id===s));return h||(h=p[0]),n.useEffect((()=>{h&&h.id!==s&&a((0,Se.WO)(h.id))}),[h,s,a]),(0,d.jsxs)("div",{className:mu(),children:[h?(0,d.jsx)(r.mg,{children:(0,d.jsx)("title",{children:h.title})}):null,(()=>{var e;return(0,d.jsx)("div",{className:mu("header-wrapper"),children:(0,d.jsxs)("div",{className:mu("tabs"),children:[(0,d.jsx)(ye.t,{size:"l",items:p,activeTab:null===(e=h)||void 0===e?void 0:e.id,wrapTo:({id:e},t)=>{const a=(0,ga.YL)({...o,[ga.vh.diagnosticsTab]:e});return(0,d.jsx)(xe.N_,{to:a,className:mu("tab"),children:t},e)},allowNotSelected:!0}),(0,d.jsx)(be.E,{})]})})})(),(0,d.jsx)("div",{className:mu("page-wrapper"),ref:t,children:(()=>{var a;const{type:n,path:r}=e;switch(null===(a=h)||void 0===a?void 0:a.id){case ge.iJ.overview:return(0,d.jsx)(Bl,{type:n,tenantName:l,path:r,additionalTenantProps:e.additionalTenantProps,additionalNodesProps:e.additionalNodesProps});case ge.iJ.schema:return(0,d.jsx)(va,{path:r,tenantName:l,type:n,extended:!0});case ge.iJ.topQueries:return(0,d.jsx)(tu,{tenantName:l});case ge.iJ.topShards:return(0,d.jsx)(pu,{tenantName:l,path:r,type:n});case ge.iJ.nodes:return(0,d.jsx)(Ke.G,{path:r,database:l,additionalNodesProps:e.additionalNodesProps,parentRef:t});case ge.iJ.tablets:return(0,d.jsx)(Lt.C,{path:r,database:l});case ge.iJ.storage:return(0,d.jsx)(kt.p,{database:l,parentRef:t});case ge.iJ.network:return(0,d.jsx)(rd,{path:r,database:l,additionalNodesProps:e.additionalNodesProps,parentRef:t});case ge.iJ.describe:return(0,d.jsx)(Ln,{path:r,database:l,type:n});case ge.iJ.hotKeys:return(0,d.jsx)(Nc,{path:r,database:l});case ge.iJ.graph:return(0,d.jsx)(Ye,{path:r,database:l});case ge.iJ.consumers:return(0,d.jsx)(Nn,{path:r,database:l,type:n});case ge.iJ.partitions:return(0,d.jsx)(Md,{path:r,database:l});case ge.iJ.configs:return(0,d.jsx)(Na,{database:l});case ge.iJ.operations:return(0,d.jsx)(Mt,{database:l});default:return(0,d.jsx)("div",{children:"No data..."})}})()})]})},vu=JSON.parse('{"controls.query-mode-selector_type":"Query type:","tabs.newQuery":"Editor","tabs.history":"History","tabs.saved":"Saved","history.empty":"History is empty","history.empty-search":"Search result is empty","saved.empty":"There are no saved queries","delete-dialog.header":"Delete query","delete-dialog.question":"Are you sure you want to delete query","delete-dialog.delete":"Delete","delete-dialog.cancel":"Cancel","preview.title":"Preview","preview.not-available":"Preview is not available","preview.close":"Close preview","preview.truncated":"truncated","method-description.script":"For YQL-scripts combining DDL and DML.\\nAPI call: schema.scripting","method-description.scan":"Read-only queries, potentially reading a lot of data.\\nAPI call: table.ExecuteScan","method-description.data":"DML queries for changing and fetching data in serialization mode.\\nAPI call: table.executeDataQuery","method-description.query":"Any query. An experimental API call supposed to replace all existing methods.\\nAPI Call: query.ExecuteScript","method-description.pg":"Queries in postgresql syntax.\\nAPI call: query.ExecuteScript","transaction-mode-description.serializable":"Provides the strictest isolation level for custom transactions","transaction-mode-description.onlinero":"Each read operation in the transaction is reading the data that is most recent at execution time","transaction-mode-description.stalero":"Read operations within a transaction may return results that are slightly out-of-date (lagging by fractions of a second)","transaction-mode-description.snapshot":"All the read operations within a transaction access the database snapshot. All the data reads are consistent","transaction-mode-description.implicit":"No transaction","tracing-level-description.basic":"Spans of main component operations","tracing-level-description.detailed":"Highest detail applicable for diagnosing problems in production","tracing-level-description.diagnostic":"Detailed debugging information for developers","tracing-level-description.off":"No tracing","tracing-level-description.toplevel":"Lowest detail, no more than two spans per request to the component","tracing-level-description.trace":"Very detailed debugging information","statistics-mode-description.none":"Don\'t collect statistics","statistics-mode-description.basic":"Collect statistics","statistics-mode-description.full":"Collect statistics and query plan","statistics-mode-description.profile":"Collect statistics for individual tasks","query-duration.description":"Duration of server-side query execution","action.send-query":"Send query","action.send-selected-query":"Send selected query","action.previous-query":"Previous query in history","action.next-query":"Next query in history","action.save-query":"Save query","action.stop":"Stop","filter.text.placeholder":"Search by query text...","gear.tooltip":"Query execution settings have been changed for ","banner.query-settings.message":"Query results are displayed for ","history.queryText":"Query text","history.endTime":"End time","history.duration":"Duration"}'),gu=(0,rt.g4)("ydb-query-editor",{en:vu}),yu=(0,c.cn)("ydb-queries-history");const xu=function({changeUserInput:e}){const t=(0,he.YQ)(),a=(0,he.N4)(zs.py),n=(0,he.N4)(zs.jY),r=[...a].reverse(),i=uo((a=>{e({input:a.queryText}),t((0,Se.sH)(ge.tQ.newQuery))})),s=[{name:"queryText",header:gu("history.queryText"),render:({row:e})=>(0,d.jsx)("div",{className:yu("query"),children:(0,d.jsx)(mo,{value:e.queryText,maxQueryHeight:6})}),sortable:!1,width:600},{name:"EndTime",header:gu("history.endTime"),render:({row:e})=>e.endTime?(0,Pe.r6)(e.endTime.toString()):"-",align:"right",width:200,sortable:!1},{name:"Duration",header:gu("history.duration"),render:({row:e})=>e.durationUs?(0,Dt.Xo)((0,Dt.Jc)(e.durationUs)):"-",align:"right",width:150,sortable:!1}];return(0,d.jsxs)(et.L,{className:yu(),children:[(0,d.jsx)(et.L.Controls,{children:(0,d.jsx)(nt.v,{value:n,onChange:e=>{t((0,zs.Ni)(e))},placeholder:gu("filter.text.placeholder"),className:yu("search")})}),(0,d.jsx)(et.L.Table,{children:(0,d.jsx)(Xe.l,{columnsWidthLSKey:"queriesHistoryTableColumnsWidth",columns:s,data:r,settings:yo,emptyDataMessage:gu(n?"history.empty-search":"history.empty"),onRowClick:e=>i(e),rowClassName:()=>yu("table-row")})})]})};var bu=a(13847),fu=a(72093);const Su=(0,a(99006)._)((async()=>({Editor:(await Promise.resolve().then(a.bind(a,6376))).default})),"Editor");var Eu=a(29078);function Tu(e,t){const a=new Map(Object.entries(e)),n=new Map(Object.entries(t));return Array.from(a.keys()).filter((e=>a.has(e)&&void 0!==a.get(e)&&a.get(e)!==n.get(e)))}const Nu=JSON.parse('{"action.settings":"Query settings","form.query-mode":"Query type","form.timeout":"Timeout","form.transaction-mode":"Transaction mode","form.statistics-mode":"Statistics collection mode","form.tracing-level":"Tracing level","form.limit-rows":"Limit rows","button-done":"Save","tooltip_plan-to-svg-statistics":"Statistics option is set to \\"Full\\" due to the enabled \\"Execution plan\\" experiment.\\n To disable it, go to the \\"Experiments\\" section in the user settings.","button-cancel":"Cancel","form.timeout.seconds":"sec","form.validation.timeout":"Must be positive","form.validation.limitRows":"Must be between 1 and 100000","description.default":" (default)","docs":"Documentation"}'),ju=JSON.parse('{"action.settings":"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430","form.query-mode":"\u0422\u0438\u043f \u0437\u0430\u043f\u0440\u043e\u0441\u0430","form.timeout":"\u0422\u0430\u0439\u043c\u0430\u0443\u0442","form.transaction-mode":"\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0438\u0437\u043e\u043b\u044f\u0446\u0438\u0438","form.statistics-mode":"\u0420\u0435\u0436\u0438\u043c \u0441\u0431\u043e\u0440\u0430 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438","form.tracing-level":"Tracing level","form.limit-rows":"\u041b\u0438\u043c\u0438\u0442 \u0441\u0442\u0440\u043e\u043a","tooltip_plan-to-svg-statistics":"\u041e\u043f\u0446\u0438\u044f \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u0432 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \\"Full\\" \u0438\u0437-\u0437\u0430 \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u043e\u0433\u043e \u044d\u043a\u0441\u043f\u0435\u0440\u0438\u043c\u0435\u043d\u0442\u0430 \\"Execution plan\\".\\n \u0427\u0442\u043e\u0431\u044b \u043e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0435\u0433\u043e, \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b \\"Experiments\\" \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f.","button-done":"\u0413\u043e\u0442\u043e\u0432\u043e","button-cancel":"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c","form.timeout.seconds":"\u0441\u0435\u043a","form.validation.timeout":"\u0422\u0430\u0439\u043c\u0430\u0443\u0442 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c","form.validation.limitRows":"\u041b\u0438\u043c\u0438\u0442 \u0441\u0442\u0440\u043e\u043a \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043c\u0435\u0436\u0434\u0443 1 \u0438 100000","description.default":" (default)","docs":"\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f"}'),Cu=(0,rt.g4)("ydb-query-settings-dialog",{en:Nu,ru:ju}),wu=[{value:Ft.Wg.implicit,content:Ft._d[Ft.Wg.implicit],text:gu("transaction-mode-description.implicit"),isDefault:!0},{value:Ft.Wg.serializable,content:Ft._d[Ft.Wg.serializable],text:gu("transaction-mode-description.serializable")},{value:Ft.Wg.onlinero,content:Ft._d[Ft.Wg.onlinero],text:gu("transaction-mode-description.onlinero")},{value:Ft.Wg.stalero,content:Ft._d[Ft.Wg.stalero],text:gu("transaction-mode-description.stalero")},{value:Ft.Wg.snapshot,content:Ft._d[Ft.Wg.snapshot],text:gu("transaction-mode-description.snapshot")}],Pu=[{value:Ft.ei.query,content:Ft.om[Ft.ei.query],text:gu("method-description.query"),isDefault:!0},{value:Ft.ei.script,content:Ft.om[Ft.ei.script],text:gu("method-description.script")},{value:Ft.ei.scan,content:Ft.om[Ft.ei.scan],text:gu("method-description.scan")},{value:Ft.ei.data,content:Ft.om[Ft.ei.data],text:gu("method-description.data")},{value:Ft.ei.pg,content:Ft.om[Ft.ei.pg],text:gu("method-description.pg")}],Iu=[{value:Ft.pE.none,content:Ft.Pn[Ft.pE.none],text:gu("statistics-mode-description.none"),isDefault:!0},{value:Ft.pE.basic,content:Ft.Pn[Ft.pE.basic],text:gu("statistics-mode-description.basic")},{value:Ft.pE.full,content:Ft.Pn[Ft.pE.full],text:gu("statistics-mode-description.full")},{value:Ft.pE.profile,content:Ft.Pn[Ft.pE.profile],text:gu("statistics-mode-description.profile")}],Du=[{value:Ft.PB.off,content:Ft.PX[Ft.PB.off],text:gu("tracing-level-description.off"),isDefault:!0},{value:Ft.PB.toplevel,content:Ft.PX[Ft.PB.toplevel],text:gu("tracing-level-description.toplevel")},{value:Ft.PB.basic,content:Ft.PX[Ft.PB.basic],text:gu("tracing-level-description.basic")},{value:Ft.PB.detailed,content:Ft.PX[Ft.PB.detailed],text:gu("tracing-level-description.detailed")},{value:Ft.PB.diagnostic,content:Ft.PX[Ft.PB.diagnostic],text:gu("tracing-level-description.diagnostic")},{value:Ft.PB.trace,content:Ft.PX[Ft.PB.trace],text:gu("tracing-level-description.trace")}],Au={transactionMode:{title:Cu("form.transaction-mode"),options:wu},queryMode:{title:Cu("form.query-mode"),options:Pu},statisticsMode:{title:Cu("form.statistics-mode"),options:Iu},tracingLevel:{title:Cu("form.tracing-level"),options:Du},timeout:{title:Cu("form.timeout")},limitRows:{title:Cu("form.limit-rows")}};function _u({currentSettings:e,defaultSettings:t}){const a=Tu(e,t),n={};return a.forEach((t=>{const a=Au[t],r=e[t];if("options"in a){var i;const e=null===(i=a.options.find((e=>e.value===r)))||void 0===i?void 0:i.content;e&&(n[a.title]=e)}else r&&(n[a.title]=String(r))})),n}var Ru=a(80967);const Ou=()=>{const[e,t]=(0,Ru.i)(me.fr);let a;try{a=Ft.id.parse(e)}catch(n){a=void 0}return[a,t]};var Mu=a(95312);const ku=()=>{const[e,t]=(0,Ru.i)(me.YQ),[a]=Ou(),[n]=(0,Mu.X)(),r=a?Tu(a,Ft.jU):[],i=n?Tu(n,Ft.jU):[],s=r.length>0,o=a?_u({currentSettings:a,defaultSettings:Ft.jU}):{},l=n?_u({currentSettings:n,defaultSettings:Ft.jU}):{},c=e&&Date.now()-e<1e3*me.Du;return{isBannerShown:s&&!c,isIndicatorShown:s&&c,closeBanner:()=>t(Date.now()),resetBanner:()=>t(void 0),changedCurrentSettings:i,changedCurrentSettingsDescriptions:l,changedLastExucutionSettings:r,changedLastExecutionSettingsDescriptions:o}};var Lu=a(53472);let zu;!function(e){e.triggerCollapse="triggerCollapse",e.triggerExpand="triggerExpand",e.clear="clear"}(zu||(zu={}));const Fu=e=>{localStorage.setItem(e,"true")},Uu=e=>{localStorage.removeItem(e)};function qu(e){return function(t,a){switch(a){case zu.triggerCollapse:return Fu(e),{...t,triggerCollapse:!0,triggerExpand:!1,collapsed:!0};case zu.triggerExpand:return Uu(e),{...t,triggerCollapse:!1,triggerExpand:!0,collapsed:!1};case zu.clear:return Uu(e),{triggerCollapse:!1,triggerExpand:!1,collapsed:!1};default:return t}}}const Qu=(0,c.cn)("kv-pane-visibility-button");function Bu({onCollapse:e,onExpand:t,isCollapsed:a,initialDirection:r="top",className:i}){return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Et.m,{title:"Collapse",children:(0,d.jsx)(wn.$,{view:"flat-secondary",onClick:e,className:Qu({hidden:a},i),children:(0,d.jsx)(Tt.I,{data:Lu.A,className:Qu({[r]:!0})})})}),(0,d.jsx)(Et.m,{title:"Expand",children:(0,d.jsx)(wn.$,{view:"flat-secondary",onClick:t,className:Qu({hidden:!a},i),children:(0,d.jsx)(Tt.I,{data:Lu.A,className:Qu({[r]:!0},"rotate")})})})]})}var $u=a(31819),Gu=a(72976);const Hu=function({disabled:e}){const t=(0,he.YQ)();return(0,d.jsx)(wn.$,{onClick:()=>{t((0,Gu.Jf)())},view:"flat-secondary",disabled:e,title:"Fullscreen",children:(0,d.jsx)(Tt.I,{data:$u.A})})};var Wu,Vu=a(98392);function Ju(){return Ju=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ju.apply(this,arguments)}const Yu=function(e){return n.createElement("svg",Ju({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},e),Wu||(Wu=n.createElement("path",{fill:"currentColor",d:"M13.383 6.5a.309.309 0 00.305-.305V5.18a.328.328 0 00-.305-.305H11.25V2.742a.328.328 0 00-.305-.304H9.93a.309.309 0 00-.305.304v3.149c0 .355.254.609.61.609h3.148zm-7.008-.61V2.743a.328.328 0 00-.305-.304H5.055a.309.309 0 00-.305.304v2.133H2.617a.309.309 0 00-.304.305v1.015c0 .178.126.305.304.305h3.149c.33 0 .609-.254.609-.61zm0 7.618v-3.149c0-.33-.28-.609-.61-.609H2.618a.309.309 0 00-.304.305v1.015c0 .178.126.305.304.305H4.75v2.133c0 .178.127.305.305.305H6.07a.309.309 0 00.305-.305zm4.875 0v-2.133h2.133a.309.309 0 00.305-.305v-1.015a.328.328 0 00-.305-.305h-3.149c-.355 0-.609.28-.609.61v3.148c0 .178.127.305.305.305h1.015a.309.309 0 00.305-.305z"})))};var Ku;const Zu=(0,c.cn)("ydb-fullscreen"),Xu=null!==(Ku=document.getElementById("fullscreen-root"))&&void 0!==Ku?Ku:void 0;const ep=function({children:e,className:t}){const a=(0,he.N4)((e=>e.fullscreen)),r=(0,he.YQ)(),i=n.useCallback((()=>{r((0,Gu.sM)())}),[r]);n.useEffect((()=>{const e=e=>{"Escape"===e.key&&i()};return document.addEventListener("keydown",e,!1),()=>{document.removeEventListener("keydown",e,!1)}}),[i]);const[s,o]=n.useState(null);n.useEffect((()=>{const e=document.createElement("div");return null===Xu||void 0===Xu||Xu.appendChild(e),e.style.display="contents",o(e),()=>{o(null),e.remove()}}),[]);const l=n.useRef(null);return n.useLayoutEffect((()=>{var e;s&&(a?null===Xu||void 0===Xu||Xu.appendChild(s):null===(e=l.current)||void 0===e||e.appendChild(s))}),[s,a]),s?(0,d.jsx)("div",{ref:l,style:{display:"contents"},children:(0,d.jsx)(Vu.Z,{container:s,children:(0,d.jsxs)("div",{className:Zu({fullscreen:a},t),children:[(0,d.jsx)(wn.$,{onClick:i,view:"raised",className:Zu("close-button"),children:(0,d.jsx)(Tt.I,{data:Yu})}),(0,d.jsx)("div",{className:Zu("content"),children:e})]})})}):null},tp=n.memo((function(e){const{className:t,value:a}=e,n=(0,he.YQ)();return(0,d.jsx)("span",{className:op("cell",t),onClick:e=>n((0,we.DK)(e.target,a,"cell")),children:a})})),ap=JSON.parse('{"empty":"Table is empty"}'),np=JSON.parse('{"empty":"\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u043f\u0443\u0441\u0442\u0430\u044f"}'),rp=(0,rt.g4)("ydb-query-result-table",{ru:np,en:ap}),ip=({data:e,name:t})=>{let a=t.length;if(e)for(const n of e){const e=n[t]?String(n[t]).length:0;if(a=Math.max(a,e),10*a+20>=600)return 600}return 10*a+20},sp={...me.N3,stripedRows:!0,sortable:!1,displayIndices:!0},op=(0,c.cn)("ydb-query-result-table"),lp=(e,t)=>t,cp=(e,t)=>t+1,dp=e=>{const{columns:t,data:a,...r}=e,i=n.useMemo((()=>(0,Ft.vi)(a)),[a]),s=n.useMemo((()=>t?((e,t)=>{if(!e.length)return[];const a=null===t||void 0===t?void 0:t.slice(0,100);return e.map((({name:e,type:t})=>{const n=(0,Ft.nh)(t);return{name:e,width:ip({data:a,name:e}),align:"number"===n?Vt.Ay.RIGHT:Vt.Ay.LEFT,render:({row:t})=>(0,d.jsx)(tp,{value:String(t[e])})}}))})(t,i):(e=>{if(!e.length)return[];const t=null===e||void 0===e?void 0:e.slice(0,100);return Object.keys(e[0]).map((a=>({name:a,width:ip({data:t,name:a}),align:(0,Xr.kf)(e[0][a])?Vt.Ay.RIGHT:Vt.Ay.LEFT,render:({row:e})=>(0,d.jsx)(tp,{value:String(e[a])})})))})(i)),[i,t]);return Array.isArray(a)?s.length?(0,d.jsx)(Xe.l,{data:i,columns:s,settings:sp,rowKey:lp,visibleRowIndex:cp,...r}):(0,d.jsx)("div",{className:op("message"),children:rp("empty")}):null},up=oe.F.injectEndpoints({endpoints:e=>({sendQuery:e.query({queryFn:async({query:e,database:t,action:a,limitRows:n},{signal:r})=>{try{const i=await window.api.viewer.sendQuery({query:e,database:t,action:a,limit_rows:n},{signal:r,withRetries:!0});return(0,Ft.We)(i)?{error:i}:{data:(0,Ft.fW)(i)}}catch(i){return{error:i||new Error("Unauthorized")}}},providesTags:["All","PreviewData"]})}),overrideExisting:"throw"}),pp=(0,c.cn)("kv-preview"),mp=({database:e,path:t,type:a})=>{var n,r,i;const s=(0,he.YQ)(),o=H(a),l=`select * from \`${t}\` limit 101`,{currentData:c,isFetching:u,error:p}=up.useSendQueryQuery({database:e,query:l,action:re(a)?"execute-query":"execute-scan",limitRows:100},{skip:!o,refetchOnMountOrArgChange:!0}),m=u&&void 0===c,h=null!==(n=null===c||void 0===c||null===(r=c.resultSets)||void 0===r?void 0:r[0])&&void 0!==n?n:{},v=()=>{s((0,Eu.o)(!1))};if(m)return(0,d.jsx)("div",{className:pp("loader-container"),children:(0,d.jsx)(oi.a,{size:"m"})});let g;o?p&&(g=(0,d.jsx)("div",{className:pp("message-container","error"),children:(0,Ft.Cb)(p)})):g=(0,d.jsx)("div",{className:pp("message-container"),children:gu("preview.not-available")});const y=null!==(i=g)&&void 0!==i?i:(0,d.jsx)("div",{className:pp("result"),children:(0,d.jsx)(dp,{data:h.result,columns:h.columns})});return(0,d.jsxs)("div",{className:pp(),children:[(()=>{var e,a;return(0,d.jsxs)("div",{className:pp("header"),children:[(0,d.jsxs)("div",{className:pp("title"),children:[gu("preview.title"),(0,d.jsxs)(ft.E,{color:"secondary",variant:"body-2",children:[h.truncated?`${gu("preview.truncated")} `:"","(",null!==(e=null===(a=h.result)||void 0===a?void 0:a.length)&&void 0!==e?e:0,")"]}),(0,d.jsx)("div",{className:pp("table-name"),children:t})]}),(0,d.jsxs)("div",{className:pp("controls-left"),children:[(0,d.jsx)(Hu,{disabled:Boolean(p)}),(0,d.jsx)(wn.$,{view:"flat-secondary",onClick:v,title:gu("preview.close"),children:(0,d.jsx)(Tt.I,{data:hc.A,size:18})})]})]})})(),(0,d.jsx)(ep,{children:y})]})};var hp=a(27738),vp=a(594),gp=a(1155);const yp=(0,c.cn)("ydb-query-settings-description"),xp=({querySettings:e,prefix:t})=>(0,d.jsxs)("div",{className:yp("message"),children:[t,Object.entries(e).map((([e,t],a,n)=>(0,d.jsxs)("span",{className:yp("description-item"),children:[`${e}: ${t}`,a<n.length-1?", ":null]},a)))]});var bp=a(13066);function fp(e){var t;window.ydbEditor||console.error("Monaco editor not found"),null===(t=window.ydbEditor)||void 0===t||t.trigger(void 0,"insertSnippetToEditor",e)}const Sp=e=>`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table\nCREATE TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}/my_row_table\``:"${1:my_row_table}"} (\n    category_id Uint64 NOT NULL,\n    id Uint64,\n    expire_at Datetime,\n    updated_on Datetime,\n    name Text,\n    \`binary-payload\` Bytes,\n    attributes JsonDocument,\n    -- uncomment to add a secondary index\n    -- INDEX idx_row_table_id GLOBAL SYNC ON ( id ) COVER ( name, attributes ), -- Secondary indexes docs https://ydb.tech/en/docs/yql/reference/syntax/create_table#secondary_index\n    PRIMARY KEY (category_id, id)\n) \nWITH (\n    AUTO_PARTITIONING_BY_SIZE = ENABLED,\n    AUTO_PARTITIONING_PARTITION_SIZE_MB = 2048,\n    AUTO_PARTITIONING_BY_LOAD = ENABLED,\n    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = 4,\n    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = 1024\n    -- uncomment to create a table with predefined partitions\n    -- , UNIFORM_PARTITIONS = 4 -- The number of partitions for uniform initial table partitioning.\n                            -- The primary key's first column must have type Uint64 or Uint32.\n                            -- A created table is immediately divided into the specified number of partitions\n    -- uncomment to launch read only replicas in every AZ\n    -- , READ_REPLICAS_SETTINGS = 'PER_AZ:1' -- Enable read replicas for stale read, launch one replica in every availability zone\n    -- uncomment to enable ttl\n    -- , TTL = Interval("PT1H") ON expire_at -- Enable background deletion of expired rows https://ydb.tech/en/docs/concepts/ttl\n    -- uncomment to create a table with a bloom filter\n    -- , KEY_BLOOM_FILTER = ENABLED -- With a Bloom filter, you can more efficiently determine\n                               -- if some keys are missing in a table when making multiple single queries by the primary key.\n)`,Ep=e=>`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table#olap-tables\nCREATE TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}/my_column_table\``:"${1:my_column_table}"} (\n    id Int64 NOT NULL,\n    author Text,\n    title Text,\n    body Text,\n    PRIMARY KEY (id)\n)\nPARTITION BY HASH(id)\nWITH (STORE = COLUMN)`,Tp=()=>'-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-async-replication\nCREATE OBJECT secret_name (TYPE SECRET) WITH value="secret_value";\n\nCREATE ASYNC REPLICATION my_replication\nFOR ${1:<original_table>} AS ${2:replica_table} --[, `/remote_database/another_table_name` AS `another_local_table_name` ...]\nWITH (\n    CONNECTION_STRING="${3:grpcs://mydb.ydb.tech:2135/?database=/remote_database}",\n    TOKEN_SECRET_NAME = "secret_name"\n    -- ENDPOINT="mydb.ydb.tech:2135",\n    -- DATABASE=`/remote_database`,\n    -- USER="user",\n    -- PASSWORD_SECRET_NAME="your_password"\n);',Np=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter_table/\n\nALTER TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"}\n    -- RENAME TO new_table_name\n    -- DROP COLUMN some_existing_column\n\${2:ADD COLUMN numeric_column Int32};`,jp=e=>{var t;const a=null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${2:<my_table>}";return`SELECT ${(null===e||void 0===e||null===(t=e.schemaData)||void 0===t?void 0:t.map((e=>"`"+e.name+"`")).join(", "))||"${1:*}"}\nFROM ${a}\n${null!==e&&void 0!==e&&e.relativePath?"":"WHERE ${3:Key1 = 1}\nORDER BY ${4:Key1}\n"}LIMIT \${5:10};`},Cp=e=>{var t;return`UPSERT INTO ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"}\n( ${(null===e||void 0===e||null===(t=e.schemaData)||void 0===t?void 0:t.map((e=>`\`${e.name}\``)).join(", "))||"${2:id, name}"} )\nVALUES ( ${null!==e&&void 0!==e&&e.schemaData?"${3: }":'${3:1, "foo"}'} );`},wp=e=>`DROP EXTERNAL TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:my_table}"};`,Pp=e=>{const t=null===e||void 0===e?void 0:e.relativePath.split("/").slice(0,-1).join("/");return`CREATE EXTERNAL TABLE ${t?`\`${t}/my_external_table\``:"${1:<my_external_table>}"} (\n    column1 Int,\n    column2 Int\n) WITH (\n    DATA_SOURCE="${null!==e&&void 0!==e&&e.relativePath?`${e.relativePath}`:"${2:<path_to_data_source>}"}",\n    LOCATION="",\n    FORMAT="json_as_string",\n    \`file_pattern\`=""\n);`},Ip=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-topic\nCREATE TOPIC ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\`/my_topic`:"${1:my_topic}"} (\n    CONSUMER consumer1,\n    CONSUMER consumer2 WITH (read_from = Datetime('1970-01-01T00:00:00Z')) -- Sets up the message write time starting from which the consumer will receive data.\n                                                                           -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format). \n                                                                           -- Default value: now\n) WITH (\n    min_active_partitions = 1, -- Minimum number of topic partitions.\n    partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.\n    retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.\n    retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. \n                              -- When this value is exceeded, the older data is cleared, like under a retention policy. \n                              -- 0 is interpreted as unlimited.\n    partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.\n    partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. \n                                    -- When set to zero, the actual write_burst value is equalled to \n                                    -- the quota value (this allows write bursts of up to one second).\n);`,Dp=e=>`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/alter_topic\nALTER TOPIC ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_topic>}"}\n    ADD CONSUMER new_consumer WITH (read_from = Datetime('1970-01-01T00:00:00Z')), -- Sets up the message write time starting from which the consumer will receive data.\n                                                                                   -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format).\n                                                                                   -- Default value: now\n    ALTER CONSUMER consumer1 SET (read_from = Datetime('1970-01-01T00:00:00Z')),\n    DROP CONSUMER consumer2,\n    SET (\n        min_active_partitions = 1, -- Minimum number of topic partitions.\n        partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.\n        retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.\n        retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. \n                                  -- When this value is exceeded, the older data is cleared, like under a retention policy. \n                                  -- 0 is interpreted as unlimited.\n        partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.\n        partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. \n                                        -- When set to zero, the actual write_burst value is equalled to\n                                        -- the quota value (this allows write bursts of up to one second).\n    );`,Ap=e=>`DROP TOPIC ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_topic>}"};`,_p=e=>`CREATE VIEW ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\`/my_view`:"${1:my_view}"} WITH (security_invoker = TRUE) AS SELECT 1;`,Rp=e=>`DROP VIEW ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_view>}"};`,Op=e=>`DROP ASYNC REPLICATION ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_replication>}"};`,Mp=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter-async-replication\nALTER ASYNC REPLICATION ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_replication>}"} SET (STATE = "DONE", FAILOVER_MODE = "FORCE");`,kp=e=>`ALTER TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"} ADD INDEX \${2:index_name} GLOBAL ON (\${3:<column_name>});`,Lp=e=>{const t=null===e||void 0===e?void 0:e.relativePath.split("/").pop(),a=null===e||void 0===e?void 0:e.relativePath.split("/").slice(0,-1).join("/");return`ALTER TABLE ${a?`\`${a}\``:"${1:<my_table>}"} DROP INDEX ${t||"${2:<index_name>}"};`},zp=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter_table/changefeed\nALTER TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"} ADD CHANGEFEED \${2:changefeed_name} WITH (\n    MODE = \${3:'UPDATES'}, -- KEYS_ONLY, UPDATES, NEW_IMAGE, OLD_IMAGE, or NEW_AND_OLD_IMAGES\n    FORMAT = \${4:'JSON'}, -- JSON or DEBEZIUM_JSON\n    VIRTUAL_TIMESTAMPS = \${5:TRUE}, -- true or false\n    RETENTION_PERIOD = \${6:Interval('PT12H')}, -- Interval value, e.g., Interval('PT24H')\n    -- TOPIC_MIN_ACTIVE_PARTITIONS: The number of topic partitions. By default, the number of topic partitions is equal to the number of table partitions\n    INITIAL_SCAN = \${8:TRUE} -- true or false\n)\n\n-- MODE options:\n--   KEYS_ONLY: Only the primary key components and change flag are written.\n--   UPDATES: Updated column values that result from updates are written.\n--   NEW_IMAGE: Any column values resulting from updates are written.\n--   OLD_IMAGE: Any column values before updates are written.\n--   NEW_AND_OLD_IMAGES: A combination of NEW_IMAGE and OLD_IMAGE modes.`,Fp=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-group\nCREATE GROUP ${1:group_name}\n-- group_name: The name of the group. It may contain lowercase Latin letters and digits.",Up=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-user\nCREATE USER ${1:user_name} PASSWORD ${2:'password'}\n-- user_name: The name of the user. It may contain lowercase Latin letters and digits.\n-- option: The password of the user:\n    -- PASSWORD 'password' creates a user with the password password. The ENCRYPTED option is always enabled.\n    -- PASSWORD NULL creates a user with an empty password.",qp=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/delete\nDELETE FROM ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"}\nWHERE \${2:Key1 = 1};`,Qp=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/drop-group\nDROP GROUP ${1:<group_name>}\n\n-- IF EXISTS: Suppress an error if the group doesn't exist.\n-- group_name: The name of the group to be deleted.",Bp=()=>"-- docs: https://ydb.tech/docs/en/yql/reference/syntax/drop-user\nDROP USER ${1:<user_name>}\n\n-- IF EXISTS: Suppress an error if the user doesn't exist.\n-- user_name: The name of the user to be deleted.",$p=e=>`GRANT \${1:<permission_name>}\nON ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${2:<path_to_scheme_object>}"}\nTO \${3:<role_name>}\n\n-- permission_name: The name of the access right to schema objects that needs to be assigned.\n-- path_to_scheme_object: The path to the schema object for which rights are being granted.\n-- role_name: The name of the user or group to whom rights on the schema object are being granted.\n-- WITH GRANT OPTION: Using this construct gives the user or group of users the right to manage access rights - \n--                    to assign or revoke certain rights. This construct has functionality similar to granting \n--                    the "ydb.access.grant" or GRANT right. A subject with the ydb.access.grant right cannot \n--                    grant rights broader than they possess themselves.`,Gp=e=>`REVOKE \${1:<permission_name>}\nON ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${2:<path_to_scheme_object>}"}\nFROM \${3:<role_name>}\n\n-- permission_name: The name of the access right to schema objects that needs to be revoked.\n-- path_to_scheme_object: The path to the schema object from which rights are being revoked.\n-- role_name: The name of the user or group from whom rights on the schema object are being revoked.\n-- GRANT OPTION FOR: Using this construct revokes the user's or group's right to manage access rights.\n--                   All previously granted rights by this user remain in effect.\n--                   This construct has functionality similar to revoking the "ydb.access.grant" or GRANT right.`,Hp=e=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/update\nUPDATE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"}\nSET \${2:Column1 = 'foo', Column2 = 'bar'}\nWHERE \${3:Key1 = 1};`,Wp=e=>`DROP TABLE ${null!==e&&void 0!==e&&e.relativePath?`\`${null===e||void 0===e?void 0:e.relativePath}\``:"${1:<my_table>}"};`,Vp=JSON.parse('{"button.new-sql":"New query","action.create-row-table":"Create row table","action.create-column-table":"Create column table","action.create-external-table":"Create external table","action.upsert-to-table":"Upsert into table","action.update-table":"Update table","action.alter-table":"Alter table","action.select-rows":"Select from a table","action.delete-rows":"Delete rows","action.drop-table":"Drop table","action.add-index":"Add index","action.drop-index":"Drop index","action.drop-external-table":"Drop external table","menu.tables":"Tables","menu.topics":"Topics","menu.capture":"Change data capture","menu.replication":"Async replication","menu.users":"Users","action.create-topic":"Create Topic","action.drop-topic":"Drop Topic","action.alter-topic":"Alter Topic","action.create-cdc-stream":"Create changefeed","action.create-async-replication":"Create async replication","action.create-user":"Create user","action.create-group":"Create group","action.drop-user":"Drop user","action.drop-group":"Drop group","action.grant-privilege":"Grant privilege","action.revoke-privilege":"Revoke privilege","action.alter-async-replication":"Alter async replication","action.drop-async-replication":"Drop async replication"}'),Jp=(0,rt.g4)("ydb-new-sql",{en:Vp});function Yp(){const e=(e=>{const t=t=>()=>{e(t())};return{createRowTable:t(Sp),createColumnTable:t(Ep),createAsyncReplication:t(Tp),alterAsyncReplication:t(Mp),dropAsyncReplication:t(Op),alterTable:t(Np),selectQuery:t(jp),upsertQuery:t(Cp),createExternalTable:t(Pp),dropExternalTable:t(wp),createTopic:t(Ip),alterTopic:t(Dp),dropTopic:t(Ap),createView:t(_p),dropTable:t(Wp),deleteRows:t(qp),updateTable:t(Hp),createUser:t(Up),createGroup:t(Fp),createCdcStream:t(zp),grantPrivilege:t($p),revokePrivilege:t(Gp),dropUser:t(Bp),dropGroup:t(Qp),addTableIndex:t(kp),dropTableIndex:t(Lp)}})(uo(n.useCallback((e=>{fp(e)}),[]))),t=[{text:Jp("menu.tables"),items:[{text:Jp("action.create-row-table"),action:e.createRowTable},{text:Jp("action.create-column-table"),action:e.createColumnTable},{text:Jp("action.create-external-table"),action:e.createExternalTable},{text:Jp("action.upsert-to-table"),action:e.upsertQuery},{text:Jp("action.update-table"),action:e.updateTable},{text:Jp("action.alter-table"),action:e.alterTable},{text:Jp("action.select-rows"),action:e.selectQuery},{text:Jp("action.delete-rows"),action:e.deleteRows},{text:Jp("action.drop-table"),action:e.dropTable},{text:Jp("action.drop-external-table"),action:e.dropExternalTable},{text:Jp("action.add-index"),action:e.addTableIndex},{text:Jp("action.drop-index"),action:e.dropTableIndex}]},{text:Jp("menu.topics"),items:[{text:Jp("action.create-topic"),action:e.createTopic},{text:Jp("action.alter-topic"),action:e.alterTopic},{text:Jp("action.drop-topic"),action:e.dropTopic}]},{text:Jp("menu.replication"),items:[{text:Jp("action.create-async-replication"),action:e.createAsyncReplication},{text:Jp("action.alter-async-replication"),action:e.alterAsyncReplication},{text:Jp("action.drop-async-replication"),action:e.dropAsyncReplication}]},{text:Jp("menu.capture"),items:[{text:Jp("action.create-cdc-stream"),action:e.createCdcStream}]},{text:Jp("menu.users"),items:[{text:Jp("action.create-user"),action:e.createUser},{text:Jp("action.create-group"),action:e.createGroup},{text:Jp("action.drop-user"),action:e.dropUser},{text:Jp("action.drop-group"),action:e.dropGroup},{text:Jp("action.grant-privilege"),action:e.grantPrivilege},{text:Jp("action.revoke-privilege"),action:e.revokePrivilege}]}];return(0,d.jsx)(Ws.r,{items:t,renderSwitcher:e=>(0,d.jsxs)(wn.$,{...e,children:[Jp("button.new-sql"),(0,d.jsx)(wn.$.Icon,{children:(0,d.jsx)(bp.A,{})})]}),popupProps:{placement:"top"}})}const Kp=(0,c.cn)("ydb-query-editor-controls"),Zp=({onClick:e,runIsLoading:t})=>{const{changedCurrentSettings:a,changedCurrentSettingsDescriptions:n}=ku(),r=a.length>0?{view:"outlined-info",selected:!0}:null;return(0,d.jsx)(gp.m,{disabled:0===a.length,content:(0,d.jsx)(xp,{prefix:gu("gear.tooltip"),querySettings:n}),openDelay:0,placement:["top-start"],children:(0,d.jsxs)(wn.$,{onClick:e,loading:t,className:Kp("gear-button"),...r,children:[(0,d.jsx)(Tt.I,{data:hp.A,size:16}),r?(0,d.jsxs)("div",{className:Kp("changed-settings"),children:["(",a.length,")"]}):null]})})},Xp=({disabled:e,isLoading:t,highlightedAction:a,handleSendExecuteClick:n,onSettingsButtonClick:r,handleGetExplainQueryClick:i})=>{const s="execute"===a?"action":void 0,o="explain"===a?"action":void 0;return(0,d.jsxs)("div",{className:Kp(),children:[(0,d.jsxs)("div",{className:Kp("left"),children:[(0,d.jsxs)(wn.$,{onClick:()=>{n()},disabled:e,loading:t,view:s,className:Kp("run-button"),children:[(0,d.jsx)(Tt.I,{data:vp.A,size:14}),"Run"]}),(0,d.jsx)(wn.$,{onClick:()=>{i()},disabled:e,loading:t,view:o,children:"Explain"}),(0,d.jsx)(Zp,{onClick:r,runIsLoading:t})]}),(0,d.jsxs)("div",{className:Kp("right"),children:[(0,d.jsx)(Yp,{}),(0,d.jsx)(ao,{buttonProps:{disabled:e}})]})]})},em=(0,c.cn)("kv-divider");const tm=function(){return(0,d.jsx)("div",{className:em()})},am=(0,c.cn)("ydb-query-elapsed-time");function nm({className:e}){const[,t]=n.useState({}),[a]=n.useState(Date.now()),r=Date.now()-a;n.useEffect((()=>{const e=setInterval((()=>{t({})}),me.KF);return()=>{clearInterval(e)}}),[]);const i=r>me.Jg*me.KF?(0,yt.p0)(r).format("hh:mm:ss"):(0,yt.p0)(r).format("mm:ss");return(0,d.jsx)(Qt.J,{className:am(null,e),children:i})}var rm=a(64280),im=a(80953);function sm(e){var t;const a=(0,Ft.KH)(e);return"object"===typeof a&&"Query was cancelled"===(null===(t=a.error)||void 0===t?void 0:t.message)}var om=a(81288);const lm=(0,c.cn)("kv-query-execution-status"),cm=()=>{const{isIndicatorShown:e,changedLastExecutionSettingsDescriptions:t}=ku();return e?(0,d.jsx)(gp.m,{openDelay:0,content:(0,d.jsx)(xp,{prefix:gu("banner.query-settings.message"),querySettings:t}),children:(0,d.jsx)(Tt.I,{data:ds.A,className:lm("query-settings-icon")})}):null},dm=({className:e,error:t,loading:a})=>{let n,r;if(a)n=(0,d.jsx)(im.t,{size:"xs"}),r="Running";else if((0,om.F0)(t)&&"ECONNABORTED"===t.code)n=(0,d.jsx)(Tt.I,{data:rm.A}),r="Connection aborted";else if(sm(t))n=(0,d.jsx)(Tt.I,{data:bt.A}),r="Stopped";else{const e=Boolean(t);n=(0,d.jsx)(Tt.I,{data:e?us.A:cs.A,className:lm("result-status-icon",{error:e})}),r=e?"Failed":"Completed"}return(0,d.jsxs)("div",{className:lm(null,e),children:[n,r,sm(t)||a?null:(0,d.jsx)(cm,{})]})};var um=a(66528);const pm=oe.F.injectEndpoints({endpoints:e=>({cancelQuery:e.mutation({queryFn:async({queryId:e,database:t},{signal:a})=>{try{const n=await window.api.viewer.sendQuery({database:t,action:"cancel-query",query_id:e},{signal:a});if((0,Ft.We)(n))return{error:n};return{data:(0,Ft.fW)(n)}}catch(n){return{error:n}}}})}),overrideExisting:"throw"}),mm=(0,c.cn)("cancel-query-button");function hm({queryId:e,tenantName:t}){const[a,r]=pm.useCancelQueryMutation(),i=n.useCallback((()=>{a({queryId:e,database:t})}),[e,a,t]);return(0,d.jsxs)(wn.$,{loading:r.isLoading,onClick:i,className:mm("stop-button",{error:Boolean(r.error)}),children:[(0,d.jsx)(Tt.I,{data:um.A,size:16}),gu("action.stop")]})}const vm=(0,c.cn)("ydb-query-duration"),gm=({duration:e})=>{if(!e)return null;const t=(0,Dt.Bi)((0,Dt.Jc)(e),1);return(0,d.jsx)("span",{className:vm(),children:(0,d.jsx)(Ha,{className:vm("item-with-popover"),contentClassName:vm("popover-content"),text:t,popoverClassName:vm("popover"),popoverContent:gu("query-duration.description"),buttonProps:{className:vm("popover-button")}})})};var ym=a(55299);const xm=(0,c.cn)("ydb-query-settings-banner");function bm(){const{isBannerShown:e,changedLastExecutionSettingsDescriptions:t,closeBanner:a}=ku();return e?(0,d.jsx)(ym.F,{className:xm(),theme:"info",align:"baseline",message:(0,d.jsx)(xp,{prefix:gu("banner.query-settings.message"),querySettings:t}),onClose:a}):null}function fm(e){return e.replaceAll("\\","\\\\").replaceAll("\n","\\n").replaceAll("\r","\\r").replaceAll("\t","\\t")}var Sm=a(6376);const Em=(0,c.cn)("ydb-query-ast"),Tm={automaticLayout:!0,selectOnLineNumbers:!0,readOnly:!0,minimap:{enabled:!1},wrappingIndent:"indent"};function Nm({ast:e,theme:t}){return(0,d.jsx)("div",{className:Em(),children:(0,d.jsx)(Sm.default,{language:"s-expression",value:e,options:Tm,theme:`vs-${t}`})})}var jm=a(73253);function Cm(e){const t=n.useRef(null),a=n.useId(),{data:r,opts:i,shapes:s}=e;return n.useEffect((()=>{const e=t.current;if(!e)return;e.innerHTML="",e.style.setProperty("width","100vw"),e.style.setProperty("height","100vh");const a=(0,jm.og)(e.id,r,i,s);return a.render(),e.style.setProperty("width","100%"),e.style.setProperty("height","100%"),()=>{a.destroy()}}),[r,i,s]),(0,d.jsx)("div",{id:a,ref:t,style:{overflow:"auto"}})}const wm={renderNodeTitle:e=>{const t=e.name.split("|");return t.length>1?t[1]:e.name},textOverflow:"normal",initialZoomFitsCanvas:!0},Pm={node:jm.SO};function Im(e){return(0,d.jsx)(Cm,{...e,opts:wm,shapes:Pm})}const Dm=JSON.parse('{"description.graph-is-not-supported":"Graph can not be rendered","description.empty-result":"There is no {{activeSection}} for the request","action.result":"Result","action.stats":"Stats","action.schema":"Schema","action.explain-plan":"Explain Plan","action.json":"JSON","action.ast":"AST","action.copy":"Copy {{activeSection}}","trace":"Trace","title.truncated":"Truncated","title.result":"Result","text_plan-svg":"Execution plan","text_open-plan-svg":"Open execution plan in new window","text_error-plan-svg":"Error: {{error}}"}'),Am=(0,rt.g4)("ydb-execute-result",{en:Dm}),_m=(0,c.cn)("ydb-query-result-stub-message");function Rm({message:e}){return(0,d.jsx)("div",{className:_m(null),children:e})}const Om=(0,c.cn)("ydb-query-explain-graph");function Mm({explain:e={},theme:t}){const{links:a,nodes:n}=e;return a&&n&&n.length?(0,d.jsx)("div",{className:Om("canvas-container"),children:(0,d.jsx)(Im,{data:{links:a,nodes:n}},t)}):(0,d.jsx)(Rm,{message:Am("description.graph-is-not-supported")})}var km=a(112);const Lm=oe.F.injectEndpoints({endpoints:e=>({planToSvgQuery:e.query({queryFn:async({plan:e,database:t},{signal:a})=>{try{return{data:await window.api.viewer.planToSvg({database:t,plan:e},{signal:a})}}catch(n){return{error:n}}}})}),overrideExisting:"throw"});function zm(e,t){return e?"flat-danger":t?"flat-secondary":"flat-info"}function Fm({plan:e,database:t}){const[a,r]=n.useState(null),[i,s]=n.useState(null),[o,{isLoading:l}]=Lm.useLazyPlanToSvgQueryQuery(),c=n.useCallback((()=>{o({plan:e,database:t}).unwrap().then((e=>{const t=new Blob([e],{type:"image/svg+xml"}),a=URL.createObjectURL(t);s(a),r(null),window.open(a,"_blank")})).catch((e=>{r(JSON.stringify(e))}))}),[t,o,e]);return n.useEffect((()=>()=>{i&&URL.revokeObjectURL(i)}),[i]),(0,d.jsx)(gp.m,{content:a?Am("text_error-plan-svg",{error:a}):Am("text_open-plan-svg"),children:(0,d.jsxs)(wn.$,{view:zm(a,l),loading:l,onClick:c,disabled:l,children:[Am("text_plan-svg"),(0,d.jsx)(wn.$.Icon,{children:(0,d.jsx)(km.A,{})})]})})}const Um=(0,c.cn)("ydb-query-json-viewer");function qm({data:e}){return(0,d.jsx)("div",{className:Um("inspector"),children:(0,d.jsx)(On,{data:e,isExpanded:()=>!0})})}var Qm=a(89954);const Bm=(0,c.cn)("ydb-query-result-error ");function $m({error:e}){const t=(0,Ft.KH)(e);return!t||sm(e)?null:"object"===typeof t?(0,d.jsx)(Qm.O,{data:t}):(0,d.jsx)("div",{className:Bm("message"),children:t})}const Gm=(0,c.cn)("ydb-query-result-sets-viewer");function Hm({resultSets:e,selectedResultSet:t,setSelectedResultSet:a}){const n=(null===e||void 0===e?void 0:e.length)||0,r=null===e||void 0===e?void 0:e[t];return(0,d.jsxs)("div",{className:Gm("result-wrapper"),children:[(()=>{if(n>1){const r=(0,Zr._e)(n).map((t=>{var a;return{id:String(t),title:`Result #${t+1}${null!==e&&void 0!==e&&null!==(a=e[t])&&void 0!==a&&a.truncated?" (T)":""}`}}));return(0,d.jsx)("div",{children:(0,d.jsx)(ye.t,{className:Gm("tabs"),size:"l",items:r,activeTab:String(t),onSelectTab:e=>a(Number(e))})})}return null})(),r?(0,d.jsxs)("div",{className:Gm("result"),children:[(0,d.jsxs)("div",{className:Gm("head"),children:[(0,d.jsx)(ft.E,{variant:"subheader-3",children:null!==r&&void 0!==r&&r.truncated?Am("title.truncated"):Am("title.result")}),null!==r&&void 0!==r&&r.result?(0,d.jsx)(ft.E,{color:"secondary",variant:"body-2",className:Gm("row-count"),children:`(${null===r||void 0===r?void 0:r.result.length})`}):null]}),(0,d.jsx)(dp,{data:r.result,columns:r.columns})]}):null]})}var Wm=a(36590),Vm=a(79737),Jm=a(79685);const Ym=(0,c.cn)("ydb-query-simplified-plan");function Km({value:e,formatter:t}){if(!(0,Xr.kf)(e))return;const a=t(Number(e));return(0,d.jsx)("div",{className:Ym("metrics-cell"),children:a})}var Zm=a(33705);const Xm={Table:"var(--g-color-text-info)",Predicate:"var(--g-color-text-positive)",Condition:"var(--g-color-text-utility)"};function eh(e){return e in Xm?Xm[e]:"var(--g-color-text-secondary)"}function th(e={}){const t=[],a=Object.entries(e);if(1===a.length){const e=a[0][1],n=eh(a[0][0]);t.push((0,d.jsx)("span",{style:{color:n},children:(0,Pe.vN)(e)},"param"))}else{const a=function(e){const t=[],{Table:a,Predicate:n,Condition:r,...i}=e;return a&&t.push(["Table",a]),n&&t.push(["Predicate",n]),r&&t.push(["Condition",r]),t.concat(Object.entries(i))}(e);for(let e=0;e<a.length;e++){const[n,r]=a[e],i=eh(n);e>0&&t.push(", "),t.push((0,d.jsxs)("span",{style:{color:i},children:[n,": ",(0,Pe.vN)(r)]},e))}}return t}function ah({params:e}){return e?(0,d.jsxs)("span",{className:Ym("operation-params"),children:["(",th(e),")"]}):null}function nh({modifiers:e,left:t}){return(0,d.jsx)("div",{className:Ym("divider",e),style:{left:t}})}function rh({row:e,depth:t=0,params:a}){const{name:r,operationParams:i,lines:s=""}=a,o=e.getLeafRows().length>0&&e.getIsExpanded(),l=n.useMemo((()=>function(e,t){const a=e.split(".").map(Number),n=[];for(let r=0;r<a.length;r++)r===a.length-1&&0!==r&&(a[r]?n.push((0,d.jsx)(nh,{modifiers:{horizontal:!0},left:10+25*(r-1)},"last")):n.push((0,d.jsx)(nh,{modifiers:{last:!0},left:9+25*(r-1)},"last"))),r===a.length-1&&t&&n.push((0,d.jsx)(nh,{modifiers:{first:!0},left:9+25*r},"first")),a[r]&&n.push((0,d.jsx)(nh,{left:9+25*(r-1)},r));return n}(s,o)),[s,o]);return(0,d.jsxs)("div",{style:{paddingLeft:25*t},className:Ym("operation-name"),children:[l,(0,d.jsxs)(St.s,{gap:1,alignItems:"center",className:Ym("operation-content"),children:[e.getCanExpand()&&(0,d.jsx)(wn.$,{view:"flat",size:"xs",onClick:e.getToggleExpandedHandler(),children:(0,d.jsx)(wn.$.Icon,{children:(0,d.jsx)(Zm.I,{direction:e.getIsExpanded()?"bottom":"right",size:14})})}),(0,d.jsx)("div",{className:Ym("operation-name-content"),children:(0,d.jsxs)("div",{children:[r,"\xa0",(0,d.jsx)(ah,{params:i})]})})]})]})}function ih(e){return(0,d.jsx)(Km,{value:e.getValue(),formatter:e=>e<1e8?(0,Jm.p)(e).format():(0,Xr.z0)(e,1)})}const sh=[{accessorKey:"name",accessorFn:function(e){return{name:e.name,operationParams:e.operationParams,lines:e.lines}},header:()=>(0,d.jsx)(Vm.A,{children:"Operation"}),size:600,cell:e=>(0,d.jsx)(rh,{row:e.row,depth:e.row.depth,params:e.getValue()})},{accessorKey:"aCpu",header:()=>(0,d.jsx)(Vm.A,{children:"A-Cpu"}),size:90,minSize:90,cell:function(e){return(0,d.jsx)(Km,{value:e.getValue(),formatter:e=>(0,Dt.Xo)(Math.round(e))})},meta:{align:"right",verticalAlign:"top"}},{accessorKey:"aRows",header:()=>(0,d.jsx)(Vm.A,{children:"A-Rows"}),size:90,minSize:90,cell:ih,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eCost",header:()=>(0,d.jsx)(Vm.A,{children:"E-Cost"}),size:90,minSize:90,cell:ih,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eRows",header:()=>(0,d.jsx)(Vm.A,{children:"E-Rows"}),size:90,minSize:90,cell:ih,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eSize",header:()=>(0,d.jsx)(Vm.A,{children:"E-Size"}),size:90,minSize:90,cell:ih,meta:{align:"right",verticalAlign:"top"}}];function oh({plan:e}){const t=n.useMemo((()=>function(e,t=""){if(!e)return[];const a=[{items:e,prefix:t,parentIndex:-1,parentArray:[]}],n=[];for(;a.length>0;){const{items:e,prefix:t,parentIndex:r,parentArray:i}=a.pop(),s=[];for(let n=0;n<e.length;n++){const r={...e[n]},i=n<e.length-1?1:0;let o=`${t}.${i}`;t||(o=String(i)),r.lines=o,s.push(r),r.children&&a.push({items:r.children,prefix:o,parentIndex:n,parentArray:s})}-1===r?n.push(...s):i[r].children=s}return n}(e)),[e]),[a,r]=n.useState(!0),i=(0,Wm.K)({columns:sh,data:t,getSubRows:e=>e.children,enableExpanding:!0,onExpandedChange:r,state:{expanded:a},enableColumnResizing:!0,columnResizeMode:"onChange"});return(0,d.jsx)(Vm.X,{wrapperClassName:Ym(),table:i,stickyHeader:!0,width:"max"})}var lh=a(67298);const ch=oe.F.injectEndpoints({endpoints:e=>({checkTrace:e.query({queryFn:async({url:e},{signal:t,dispatch:a})=>{try{const n=await window.api.trace.checkTrace({url:e},{signal:t});return a((0,zs.P7)()),{data:n}}catch(n){return{error:n}}}})}),overrideExisting:"throw"});function dh(e,t){return e.replace(/\${(\w+)}/g,((e,a)=>t[a]||e))}function uh({traceId:e,isTraceReady:t}){const{traceCheck:a,traceView:r}=(0,lh.Zd)(),i=null!==a&&void 0!==a&&a.url?dh(a.url,{traceId:e}):"",s=null!==r&&void 0!==r&&r.url?dh(r.url,{traceId:e}):"",[o,{isLoading:l,isUninitialized:c}]=ch.useLazyCheckTraceQuery();return n.useEffect((()=>{let e;return i&&!t&&(e=o({url:i})),()=>{var t;return null===(t=e)||void 0===t?void 0:t.abort()}}),[o,i,t]),!s||c&&!t?null:(0,d.jsxs)(wn.$,{view:l?"flat-secondary":"flat-info",loading:l,href:s,target:"_blank",children:[Am("trace"),(0,d.jsx)(wn.$.Icon,{children:(0,d.jsx)(km.A,{})})]})}const ph=(0,c.cn)("ydb-query-result"),mh="result",hh="schema",vh="simplified",gh="json",yh="stats",xh="ast",bh={get result(){return Am("action.result")},get schema(){return Am("action.schema")},get simplified(){return Am("action.explain-plan")},get json(){return Am("action.json")},get stats(){return Am("action.stats")},get ast(){return Am("action.ast")}},fh=["result","schema","simplified","stats"],Sh=["schema","json","simplified","ast"];function Eh({result:e,resultType:t="execute",isResultsCollapsed:a,theme:r,tenantName:i,onCollapseResults:s,onExpandResults:l}){const c=(0,he.YQ)(),u="execute"===t,p="explain"===t,[m,h]=n.useState(0),[v,g]=n.useState((()=>u?mh:hh)),[y]=(0,he.iK)(me.lr),{error:x,isLoading:b,queryId:f,data:S={}}=e,{preparedPlan:E,simplifiedPlan:T,stats:N,resultSets:j,ast:C}=S;n.useEffect((()=>{"execute"!==t||fh.includes(v)||g("result"),"explain"!==t||Sh.includes(v)||g("schema")}),[v,t]);const w=n.useMemo((()=>{let e=[];return u?e=fh:p&&(e=Sh),e.map((e=>({value:e,content:bh[e]})))}),[u,p]);n.useEffect((()=>()=>{c((0,Gu.sM)())}),[c]);const P=e=>{g(e)},I=()=>{switch(v){case mh:{var e;const t=null===S||void 0===S||null===(e=S.resultSets)||void 0===e?void 0:e[m],a=function(e){if(null===e||void 0===e||!e.length)return"";const t=Object.keys(e[0]),a=[t.map(fm).join("\t")];for(const n of e){const e=[];for(const a of t){const t=n[a];e.push(fm("object"===typeof t?JSON.stringify(t):`${t}`))}a.push(e.join("\t"))}return a.join("\n")}(null===t||void 0===t?void 0:t.result);return a}case gh:return null===E||void 0===E?void 0:E.pristine;case vh:return null===T||void 0===T?void 0:T.pristine;case yh:return N;case xh:return C;default:return}},D=()=>{const e=I(),t=(0,Pe.vN)(e);return t?(0,d.jsx)(jn.b,{text:t,view:"flat-secondary",title:Am("action.copy",{activeSection:v})}):null},A=()=>(0,d.jsx)(Rm,{message:Am("description.empty-result",{activeSection:bh[v]})});return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)("div",{className:ph("controls"),children:[(0,d.jsxs)("div",{className:ph("controls-left"),children:[(0,d.jsx)(dm,{error:x,loading:b}),!x&&!b&&(0,d.jsxs)(n.Fragment,{children:[(0,Zr.f8)(null===N||void 0===N?void 0:N.DurationUs)?(0,d.jsx)(gm,{duration:Number(N.DurationUs)}):null,w.length&&v?(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(tm,{}),(0,d.jsx)(kd.a,{options:w,value:v,onUpdate:P})]}):null]}),b?(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(nm,{className:ph("elapsed-time")}),(0,d.jsx)(hm,{queryId:f,tenantName:i})]}):null,null!==S&&void 0!==S&&S.traceId&&u?(0,d.jsx)(uh,{traceId:S.traceId,isTraceReady:e.isTraceReady}):null,null!==S&&void 0!==S&&S.plan&&y&&u?(0,d.jsx)(Fm,{plan:null===S||void 0===S?void 0:S.plan,database:i}):null]}),(0,d.jsxs)("div",{className:ph("controls-right"),children:[D(),(0,d.jsx)(Hu,{}),(0,d.jsx)(Bu,{onCollapse:s,onExpand:l,isCollapsed:a,initialDirection:"bottom"})]})]}),b||sm(x)?null:(0,d.jsx)(bm,{}),(0,d.jsx)(o.r,{loading:b,children:(0,d.jsx)(ep,{className:ph("result"),children:(()=>{return x?(0,d.jsx)($m,{error:x}):v===mh?(0,d.jsx)(Hm,{resultSets:j,selectedResultSet:m,setSelectedResultSet:h}):v===hh?null!==E&&void 0!==E&&null!==(e=E.nodes)&&void 0!==e&&e.length?(0,d.jsx)(Mm,{theme:r,explain:E}):A():v===gh?null!==E&&void 0!==E&&E.pristine?(0,d.jsx)(qm,{data:null===E||void 0===E?void 0:E.pristine}):A():v===vh?null!==T&&void 0!==T&&null!==(t=T.plan)&&void 0!==t&&t.length?(0,d.jsx)(oh,{plan:T.plan}):A():v===yh?N?(0,d.jsx)(qm,{data:N}):A():v===xh?C?(0,d.jsx)(Nm,{ast:C,theme:r}):A():null;var e,t})()})})]})}var Th=a(16122),Nh=a(23971);const jh=()=>-1,Ch=(0,c.cn)("ydb-query-settings-select");function wh(e){return(0,d.jsx)("div",{className:Ch("selector"),children:(0,d.jsx)(Ee.l,{id:e.id,disabled:e.disabled,options:e.settingOptions,value:[e.setting],onUpdate:t=>{e.onUpdateSetting(t[0])},getOptionHeight:jh,popupClassName:Ch("popup"),renderOption:e=>(0,d.jsxs)("div",{className:Ch("item",{type:e.value}),children:[(0,d.jsxs)("div",{className:Ch("item-title"),children:[e.content,e.isDefault?Cu("description.default"):""]}),e.text&&(0,d.jsx)("span",{className:Ch("item-description"),children:e.text})]}),width:"max"})})}const Ph=(0,c.cn)("ydb-query-settings-dialog");function Ih(){const e=(0,he.YQ)(),t=(0,he.N4)(Js.xM),[a,r]=(0,he.XS)(),i=n.useCallback((()=>{e((0,Js.NJ)("idle"))}),[e]),s=n.useCallback((e=>{r(e),i()}),[i,r]);return(0,d.jsxs)(Us.l,{open:"settings"===t,size:"s",onClose:i,className:Ph(),hasCloseButton:!1,children:[(0,d.jsx)(Us.l.Header,{caption:Cu("action.settings")}),(0,d.jsx)(Dh,{initialValues:a,onSubmit:s,onClose:i})]})}function Dh({initialValues:e,onSubmit:t,onClose:a}){const{control:r,handleSubmit:i,formState:{errors:s}}=(0,Nh.mN)({defaultValues:e,resolver:(0,Th.u)(Ft.id)}),[o]=(0,he.iK)(me.lr),l=(0,fe.Oi)();return(0,d.jsxs)("form",{onSubmit:i(t),children:[(0,d.jsxs)(Us.l.Body,{className:Ph("dialog-body"),children:[(0,d.jsxs)(St.s,{direction:"row",alignItems:"flex-start",className:Ph("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"queryMode",className:Ph("field-title"),children:Au.queryMode.title}),(0,d.jsx)("div",{className:Ph("control-wrapper",{queryMode:!0}),children:(0,d.jsx)(Nh.xI,{name:"queryMode",control:r,render:({field:e})=>(0,d.jsx)(wh,{id:"queryMode",setting:e.value,onUpdateSetting:e.onChange,settingOptions:Au.queryMode.options})})})]}),(0,d.jsxs)(St.s,{direction:"row",alignItems:"flex-start",className:Ph("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"timeout",className:Ph("field-title"),children:Au.timeout.title}),(0,d.jsx)("div",{className:Ph("control-wrapper"),children:(0,d.jsx)(Nh.xI,{name:"timeout",control:r,render:({field:e})=>{var t,a;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Vs.k,{id:"timeout",type:"number",...e,value:null===(t=e.value)||void 0===t?void 0:t.toString(),className:Ph("timeout"),placeholder:"60",validationState:s.timeout?"invalid":void 0,errorMessage:null===(a=s.timeout)||void 0===a?void 0:a.message,errorPlacement:"inside"}),(0,d.jsx)("span",{className:Ph("timeout-suffix"),children:Cu("form.timeout.seconds")})]})}})})]}),l&&(0,d.jsxs)(St.s,{direction:"row",alignItems:"flex-start",className:Ph("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"tracingLevel",className:Ph("field-title"),children:Au.tracingLevel.title}),(0,d.jsx)("div",{className:Ph("control-wrapper"),children:(0,d.jsx)(Nh.xI,{name:"tracingLevel",control:r,render:({field:e})=>(0,d.jsx)(wh,{id:"tracingLevel",setting:e.value,onUpdateSetting:e.onChange,settingOptions:Au.tracingLevel.options})})})]}),(0,d.jsxs)(St.s,{direction:"row",alignItems:"flex-start",className:Ph("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"transactionMode",className:Ph("field-title"),children:Au.transactionMode.title}),(0,d.jsx)("div",{className:Ph("control-wrapper",{transactionMode:!0}),children:(0,d.jsx)(Nh.xI,{name:"transactionMode",control:r,render:({field:e})=>(0,d.jsx)(wh,{id:"transactionMode",setting:e.value,onUpdateSetting:e.onChange,settingOptions:Au.transactionMode.options})})})]}),(0,d.jsxs)(St.s,{direction:"row",alignItems:"flex-start",className:Ph("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"statisticsMode",className:Ph("field-title"),children:Au.statisticsMode.title}),(0,d.jsx)(gp.m,{className:Ph("statistics-mode-tooltip"),disabled:!o,openDelay:0,content:Cu("tooltip_plan-to-svg-statistics"),children:(0,d.jsx)("div",{className:Ph("control-wrapper",{statisticsMode:!0}),children:(0,d.jsx)(Nh.xI,{name:"statisticsMode",control:r,render:({field:e})=>(0,d.jsx)(wh,{id:"statisticsMode",disabled:o,setting:e.value,onUpdateSetting:e.onChange,settingOptions:Au.statisticsMode.options})})})})]}),(0,d.jsxs)(St.s,{direction:"row",alignItems:"flex-start",className:Ph("dialog-row"),children:[(0,d.jsx)("label",{htmlFor:"limitRows",className:Ph("field-title"),children:Au.limitRows.title}),(0,d.jsx)("div",{className:Ph("control-wrapper"),children:(0,d.jsx)(Nh.xI,{name:"limitRows",control:r,render:({field:e})=>{var t,a;return(0,d.jsx)(Vs.k,{id:"limitRows",type:"number",...e,value:null===(t=e.value)||void 0===t?void 0:t.toString(),className:Ph("limit-rows"),placeholder:"10000",validationState:s.limitRows?"invalid":void 0,errorMessage:null===(a=s.limitRows)||void 0===a?void 0:a.message,errorPlacement:"inside"})}})})]})]}),(0,d.jsx)(Us.l.Footer,{textButtonApply:Cu("button-done"),textButtonCancel:Cu("button-cancel"),onClickButtonCancel:a,propsButtonApply:{type:"submit"},renderButtons:(e,t)=>(0,d.jsxs)("div",{className:Ph("buttons-container"),children:[(0,d.jsx)(Ko.N,{href:"https://ydb.tech/docs",target:"_blank",className:Ph("documentation-link"),children:Cu("docs")}),(0,d.jsxs)("div",{className:Ph("main-buttons"),children:[t,e]})]})})]})}const Ah={automaticLayout:!0,selectOnLineNumbers:!0,minimap:{enabled:!1}};const _h="navigation",Rh=(0,c.cn)("query-editor"),Oh={triggerExpand:!1,triggerCollapse:!1,collapsed:!0};function Mh(e){const t=function(){const[e]=(0,he.iK)(me.LK),[t]=(0,he.iK)(me.IO);return n.useMemo((()=>{const a=Boolean(e);return{quickSuggestions:a,suggestOnTriggerCharacters:a,acceptSuggestionOnEnter:t?"on":"off",...Ah}}),[e,t])}(),a=(0,he.YQ)(),{tenantName:r,path:i,type:s,theme:o,changeUserInput:l}=e,c=(0,he.N4)(zs.yJ),u=(0,he.N4)(zs.wf),p=(0,he.N4)(zs.py),m=(0,he.N4)(zs.Kz),v=(0,he.N4)(zs.Wp),g=(0,he.N4)(Eu.Ab),y=Boolean(u),[x]=(0,he.XS)(),b=(0,fe.Oi)(),[f,S]=Ou(),{resetBanner:E}=ku(),[T,N]=(0,he.iK)(me.zk),[j]=zs.JO.useUseSendQueryMutation();n.useEffect((()=>{c!==r&&a((0,zs.Id)(r))}),[a,r,c]);const[C,w]=n.useReducer(qu(me.GV),Oh);n.useEffect((()=>{w(zu.triggerCollapse)}),[]),n.useEffect((()=>{w(g||y?zu.triggerExpand:zu.triggerCollapse)}),[g,y]);const P=(0,he.A5)((()=>p&&0!==p.length?p[p.length-1].queryText:"")),I=(0,he.A5)((e=>{const t=null!==e&&void 0!==e?e:v;N(Ft.x5.execute),(0,bu.isEqual)(f,x)||(E(),S(x));const n=(0,fu.A)();var i;(j({actionType:"execute",query:t,database:r,querySettings:x,enableTracingLevel:b,queryId:n}),a((0,Eu.o)(!1)),e)||t!==(null===(i=p[m])||void 0===i?void 0:i.queryText)&&a((0,zs.nO)({queryText:v,queryId:n}));w(zu.triggerExpand)})),D=()=>{a((0,Js.NJ)("settings"))},A=(0,he.A5)((()=>{N(Ft.x5.explain),(0,bu.isEqual)(f,x)||(E(),S(x));const e=(0,fu.A)();j({actionType:"explain",query:v,database:r,querySettings:x,enableTracingLevel:b,queryId:e}),a((0,Eu.o)(!1)),w(zu.triggerExpand)})),_=(0,he.A5)((()=>{T===Ft.x5.explain?A():I()}));return(0,d.jsxs)("div",{className:Rh(),children:[(0,d.jsxs)(h,{direction:"vertical",defaultSizePaneKey:me.l_,triggerCollapse:C.triggerCollapse,triggerExpand:C.triggerExpand,minSize:[0,52],collapsedSizes:[100,0],onSplitStartDragAdditional:()=>{w(zu.clear)},children:[(0,d.jsxs)("div",{className:Rh("pane-wrapper",{top:!0}),children:[(0,d.jsx)("div",{className:Rh("monaco-wrapper"),children:(0,d.jsx)("div",{className:Rh("monaco"),children:(0,d.jsx)(Su,{language:"yql",value:v,options:t,onChange:e=>{l({input:e})},editorDidMount:(e,t)=>{window.ydbEditor=e;const n=function(e){const{KeyMod:t,KeyCode:a}=e,n=t.CtrlCmd;return{sendQuery:n|a.Enter,sendSelectedQuery:n|t.Shift|e.KeyCode.Enter,selectPreviousQuery:n|a.UpArrow,selectNextQuery:n|a.DownArrow,saveQuery:n|a.KeyS,saveSelectedQuery:n|t.Shift|a.KeyS}}(t);t.editor.registerCommand("insertSnippetToEditor",((t,a)=>{const n=e.getContribution("snippetController2");n&&(e.focus(),e.setValue(""),n.insert(a))})),function(e){const t=De()((()=>{e.layout()}),100);e.layout(),window.addEventListener("resize",t),e.onDidDispose((()=>{window.removeEventListener("resize",t)}))}(e),function(e,t){Lh(e.getValue(),t()),e.onDidChangeModelContent((()=>{Lh(e.getValue(),t())})),e.onDidDispose((()=>{window.onbeforeunload=null}))}(e,P),e.focus(),e.addAction({id:"sendQuery",label:gu("action.send-query"),keybindings:[n.sendQuery],precondition:void 0,keybindingContext:void 0,contextMenuGroupId:_h,contextMenuOrder:1,run:()=>_()});const r=e.createContextKey("canSendSelectedText",!1);e.onDidChangeCursorSelection((({selection:e,secondarySelections:t})=>{const a=e.selectionStartLineNumber!==e.positionLineNumber||e.selectionStartColumn!==e.positionColumn,n=t.length>0;r.set(a&&!n)})),e.addAction({id:"sendSelectedQuery",label:gu("action.send-selected-query"),keybindings:[n.sendSelectedQuery],precondition:"canSendSelectedText",contextMenuGroupId:_h,contextMenuOrder:1,run:e=>{const t=e.getSelection(),a=e.getModel();if(t&&a){const e=a.getValueInRange({startLineNumber:t.getSelectionStart().lineNumber,startColumn:t.getSelectionStart().column,endLineNumber:t.getPosition().lineNumber,endColumn:t.getPosition().column});I(e)}}}),e.addAction({id:"previous-query",label:gu("action.previous-query"),keybindings:[n.selectPreviousQuery],contextMenuGroupId:_h,contextMenuOrder:2,run:()=>{a((0,zs.JK)())}}),e.addAction({id:"next-query",label:gu("action.next-query"),keybindings:[n.selectNextQuery],contextMenuGroupId:_h,contextMenuOrder:3,run:()=>{a((0,zs.tS)())}}),e.addAction({id:"save-query",label:gu("action.save-query"),keybindings:[n.saveQuery],run:()=>{Fs.Ay.show(ro)}})},theme:`vs-${o}`,editorWillUnmount:()=>{window.ydbEditor=void 0}})})}),(0,d.jsx)(Xp,{handleSendExecuteClick:I,onSettingsButtonClick:D,isLoading:Boolean(null===u||void 0===u?void 0:u.isLoading),handleGetExplainQueryClick:A,disabled:!v,highlightedAction:T})]}),(0,d.jsx)("div",{className:Rh("pane-wrapper"),children:(0,d.jsx)(kh,{resultVisibilityState:C,onExpandResultHandler:()=>{w(zu.triggerExpand)},onCollapseResultHandler:()=>{w(zu.triggerCollapse)},type:s,theme:o,result:u,tenantName:r,path:i,showPreview:g},null===u||void 0===u?void 0:u.queryId)})]}),(0,d.jsx)(Ih,{})]})}function kh({resultVisibilityState:e,onExpandResultHandler:t,onCollapseResultHandler:a,type:n,theme:r,result:i,tenantName:s,path:o,showPreview:l}){return l?(0,d.jsx)(mp,{database:s,path:o,type:n}):i?(0,d.jsx)(Eh,{result:i,resultType:null===i||void 0===i?void 0:i.type,theme:r,tenantName:s,isResultsCollapsed:e.collapsed,onExpandResults:t,onCollapseResults:a}):null}function Lh(e,t){const a=!!e&&e!==t;window.onbeforeunload=a?e=>{e.preventDefault(),e.returnValue=""}:null}const zh=[{id:ge.tQ.newQuery,title:gu("tabs.newQuery")},{id:ge.tQ.history,title:gu("tabs.history")},{id:ge.tQ.saved,title:gu("tabs.saved")}],Fh=({className:e,activeTab:t})=>{const a=(0,pr.zy)(),n=(0,Ae.mA)(a);return(0,d.jsx)("div",{className:e,children:(0,d.jsx)(ye.t,{size:"l",allowNotSelected:!0,activeTab:t,items:zh,wrapTo:({id:e},t)=>{const a=(0,ga.YL)({...n,[ga.vh.queryTab]:e});return(0,d.jsx)(Rs.E,{to:a,children:t},e)}})})};var Uh=a(65872),qh=a(64470);const Qh=(0,c.cn)("ydb-saved-queries"),Bh=({visible:e,queryName:t,onCancelClick:a,onConfirmClick:n})=>(0,d.jsxs)(Us.l,{open:e,hasCloseButton:!1,size:"s",onClose:a,onEnterKeyDown:n,children:[(0,d.jsx)(Us.l.Header,{caption:gu("delete-dialog.header")}),(0,d.jsxs)(Us.l.Body,{className:Qh("dialog-body"),children:[gu("delete-dialog.question"),(0,d.jsx)("span",{className:Qh("dialog-query-name"),children:` ${t}?`})]}),(0,d.jsx)(Us.l.Footer,{textButtonApply:gu("delete-dialog.delete"),textButtonCancel:gu("delete-dialog.cancel"),onClickButtonCancel:a,onClickButtonApply:n})]}),$h=({changeUserInput:e})=>{const t=Ys(),a=(0,he.YQ)(),r=(0,he.N4)(Js.cu),[i,s]=n.useState(!1),[o,l]=n.useState(""),c=()=>{s(!1),l("")},u=uo(n.useCallback((({queryText:t,queryName:n})=>{e({input:t}),a((0,Js.JP)(n)),a((0,Se.sH)(ge.tQ.newQuery))}),[e,a])),p=[{name:"name",header:"Name",render:({row:e})=>(0,d.jsx)("div",{className:Qh("query-name"),children:e.name}),width:200},{name:"body",header:"Query Text",render:({row:e})=>{return(0,d.jsxs)("div",{className:Qh("query"),children:[(0,d.jsx)("div",{className:Qh("query-body"),children:(0,d.jsx)(mo,{value:e.body,maxQueryHeight:6})}),(0,d.jsxs)("span",{className:Qh("controls"),children:[(0,d.jsx)(wn.$,{view:"flat-secondary",children:(0,d.jsx)(Tt.I,{data:Uh.A})}),(0,d.jsx)(wn.$,{view:"flat-secondary",onClick:(t=e.name,e=>{e.stopPropagation(),s(!0),l(t)}),children:(0,d.jsx)(Tt.I,{data:qh.A})})]})]});var t},sortable:!1,resizeMinWidth:650}];return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsxs)(et.L,{className:Qh(),children:[(0,d.jsx)(et.L.Controls,{children:(0,d.jsx)(nt.v,{onChange:e=>{a((0,Js.ys)(e))},placeholder:gu("filter.text.placeholder"),className:Qh("search")})}),(0,d.jsx)(et.L.Table,{children:(0,d.jsx)(Xe.l,{columnsWidthLSKey:"savedQueriesTableColumnsWidth",columns:p,data:t,settings:yo,emptyDataMessage:gu(r?"history.empty-search":"saved.empty"),rowClassName:()=>Qh("row"),onRowClick:e=>u({queryText:e.body,queryName:e.name}),initialSortOrder:{columnId:"name",order:Vt.Ay.ASCENDING}})})]}),(0,d.jsx)(Bh,{visible:i,queryName:o,onCancelClick:()=>{c()},onConfirmClick:()=>{c(),a((0,Js.fu)(o)),l("")}})]})},Gh=(0,c.cn)("ydb-query"),Hh=e=>{const t=(0,he.YQ)(),{queryTab:a=ge.tQ.newQuery}=(0,he.N4)((e=>e.tenant)),i=e=>{t((0,zs.iZ)(e))},s=n.useMemo((()=>zh.find((({id:e})=>e===a))),[a]);return(0,d.jsxs)("div",{className:Gh(),children:[s?(0,d.jsx)(r.mg,{children:(0,d.jsx)("title",{children:s.title})}):null,(0,d.jsx)(Fh,{className:Gh("tabs"),activeTab:a}),(0,d.jsx)("div",{className:Gh("content"),children:(()=>{switch(a){case ge.tQ.newQuery:return(0,d.jsx)(Mh,{changeUserInput:i,...e});case ge.tQ.history:return(0,d.jsx)(xu,{changeUserInput:i});case ge.tQ.saved:return(0,d.jsx)($h,{changeUserInput:i});default:return null}})()})]})};var Wh=a(46649),Vh=a(93844);const Jh=["query","diagnostics"],Yh={query:Wh.A,diagnostics:Vh.A};const Kh=(0,c.cn)("ydb-tenant-navigation"),Zh=({id:e,title:t,icon:a})=>({value:e,content:(0,d.jsxs)("span",{className:Kh("item"),children:[(0,d.jsx)(Tt.I,{data:a,size:16,className:Kh("icon")}),(0,d.jsx)("span",{className:Kh("text"),children:t})]})}),Xh=()=>{const e=function(){const e=(0,pr.W6)(),t=(0,pr.zy)(),a=(0,Ae.mA)(t),[,r]=(0,he.iK)(me.Mt),{tenantPage:i}=(0,he.N4)((e=>e.tenant)),s=n.useMemo((()=>{if(t.pathname!==Ae.Ay.tenant)return[];const n=Jh.map((t=>{const n=ge.Dg[t],s=(0,ga.YL)({...a,[ge.Dt]:n});return{id:n,title:Hr(`pages.${t}`),icon:Yh[t],path:s,current:i===n,onForward:()=>{r(n),e.push(s)}}}));return n}),[i,r,t.pathname,e,a]);return s}();return(0,d.jsx)("div",{className:Kh(),children:(0,d.jsx)(kd.a,{width:"auto",onUpdate:t=>{const a=e.find((e=>e.id===t));null===a||void 0===a||a.onForward()},size:"l",className:Kh("body"),value:(e.find((e=>e.current))||e[0]).id,options:e.map(Zh)})})},ev=(0,c.cn)("object-general");const tv=function(e){const t=(0,ve.i)(),{tenantPage:a}=(0,he.N4)((e=>e.tenant));return(0,d.jsxs)("div",{className:ev(),children:[(0,d.jsx)(Xh,{}),(()=>{const{type:n,additionalTenantProps:r,additionalNodesProps:i,tenantName:s,path:o}=e;return a===ge.Dg.query?(0,d.jsx)(Hh,{tenantName:s,path:o,theme:t,type:n}):(0,d.jsx)(hu,{type:n,tenantName:s,path:o,additionalTenantProps:r,additionalNodesProps:i})})()]})};var av=a(1956);const nv=oe.F.injectEndpoints({endpoints:e=>({getSchemaAcl:e.query({queryFn:async({path:e,database:t},{signal:a})=>{try{const n=await window.api.viewer.getSchemaAcl({path:e,database:t},{signal:a});return{data:{acl:n.Common.ACL,effectiveAcl:n.Common.EffectiveACL,owner:n.Common.Owner,interruptInheritance:n.Common.InterruptInheritance}}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"}),rv=JSON.parse('{"title_rights":"Access Rights","title_effective-rights":"Effective Access Rights","title_owner":"Owner","title_interupt-inheritance":"Interrupt inheritance","description_empty":"No Acl data"}'),iv=(0,rt.g4)("ydb-acl",{en:rv}),sv=(0,c.cn)("ydb-acl"),ov=["access","type","inheritance"],lv={access:"Access",type:"Access type",inheritance:"Inheritance type"},cv=new Set(["Object","Container"]);function dv({value:e}){const t="string"===typeof e?[e]:e;return(0,d.jsx)("div",{className:sv("definition-content"),children:t.map((e=>(0,d.jsx)("span",{children:e},e)))})}function uv(e){if(!e||!e.length)return[];const t=function(e){return e.map((e=>{const{AccessRules:t=[],AccessRights:a=[],AccessType:n,InheritanceType:r,Subject:i}=e,s=t.concat(a),o="Allow"===n?void 0:n;let l;return((null===r||void 0===r?void 0:r.length)!==cv.size||r.some((e=>!cv.has(e))))&&(l=r),{access:s.length?s:void 0,type:o,inheritance:l,Subject:i}}))}(e);return t.map((({Subject:e,...t})=>{const a=Object.entries(t).filter((([e,t])=>Boolean(t)));return 1===a.length&&"access"===a[0][0]?{name:e,content:(0,d.jsx)(dv,{value:a[0][1]}),multilineName:!0}:{label:(0,d.jsx)("span",{className:sv("group-label"),children:e}),items:ov.map((e=>{const a=t[e];if(a)return{name:lv[e],content:(0,d.jsx)(dv,{value:a}),multilineName:!0}})).filter(Zr.f8)}}))}const pv=({path:e,database:t})=>{const{currentData:a,isFetching:r,error:i}=nv.useGetSchemaAclQuery({path:e,database:t}),s=r&&!a,{acl:o,effectiveAcl:l,owner:c,interruptInheritance:u}=a||{},p=uv(o),m=uv(l),h=function(e){const t=(a=e,a&&a.endsWith("@staff")&&!a.startsWith("svc_")?a.split("@")[0]:a);var a;return t?[{name:t,content:iv("title_owner"),multilineName:!0}]:[]}(c),v=u?[{name:iv("title_interupt-inheritance"),content:(0,d.jsx)(Tt.I,{data:av.A,size:20}),multilineName:!0}]:[];if(s)return(0,d.jsx)(je.a,{});if(i)return(0,d.jsx)(Ne.o,{error:i});if(!o&&!c&&!l)return(0,d.jsx)(n.Fragment,{children:iv("description_empty")});const g=h.concat(p);return(0,d.jsxs)("div",{className:sv(),children:[(0,d.jsx)(mv,{items:v}),(0,d.jsx)(mv,{items:g,title:iv("title_rights")}),(0,d.jsx)(mv,{items:m,title:iv("title_effective-rights")})]})};function mv({items:e,title:t}){return e.length?(0,d.jsxs)(n.Fragment,{children:[t&&(0,d.jsx)("div",{className:sv("list-title"),children:t}),(0,d.jsx)(br.u,{items:e,nameMaxWidth:200,className:sv("result",{"no-title":!t}),responsive:!0})]}):null}var hv=a(11951);const vv=(e,t,a)=>{const{setActivePath:n}=a;return{openPreview:()=>{t(oe.F.util.invalidateTags(["PreviewData"])),t((0,Eu.o)(!0)),t((0,Se.es)(ge.Dg.query)),t((0,Se.sH)(ge.tQ.newQuery)),n(e)}}},gv=(e,t)=>(0,d.jsx)(wn.$,{view:"flat-secondary",onClick:e.openPreview,title:Hr("actions.openPreview"),size:t||"s",children:(0,d.jsx)(Tt.I,{data:hv.A})}),yv=(e,t,a)=>(n,r)=>{const i=vv(n,e,t),s=gv(i,a);return{async_replication:void 0,database:void 0,directory:void 0,table:s,column_table:s,index_table:void 0,topic:void 0,stream:void 0,index:void 0,external_table:s,external_data_source:void 0,view:s}[r]},xv=(e,t,a)=>(n,r)=>{const i=vv(n,e,t);return{preview:gv(i,a)}[r]};var bv=a(57949);const fv=5*me.KF,Sv=oe.F.injectEndpoints({endpoints:e=>({getTableSchemaData:e.query({queryFn:async({path:e,tenantName:t,type:a},{dispatch:n})=>{try{if(se(a)){const a=await n(qt.endpoints.getViewSchema.initiate({database:t,path:e,timeout:fv}));if((0,Ft.We)(a))return{error:a};return{data:ha(a.data)}}const r=await n(le.endpoints.getOverview.initiate({path:e,database:t,timeout:fv}));return{data:ma(a,r.data)}}catch(r){return{error:r}}}})})});var Ev=a(32133),Tv=a.n(Ev);function Nv(e,t){const a=e.replace(/^\/+|\/+$/g,""),n=t.replace(/^\/+|\/+$/g,"");if(!a.startsWith(n))return a||"/";if(a===n)return`/${a}`;let r=a.slice(n.length);return r=r.replace(/^\/+/,"")||"/",r}function jv(e,t){return t===f.EPathTypeDir&&(2===e.split("/").length&&e.startsWith("/"))}const Cv=({text:e,action:t,isLoading:a})=>({text:(0,d.jsxs)(St.s,{justifyContent:"space-between",alignItems:"center",children:[e,a&&(0,d.jsx)(im.t,{size:"xs"})]}),action:t,disabled:a}),wv=(e,t,a="")=>(n,r)=>{const i=((e,t,a)=>{const{setActivePath:n,showCreateDirectoryDialog:r,getConfirmation:i,schemaData:s}=a,o=a=>()=>{const r=()=>{t((0,Se.es)(ge.Dg.query)),t((0,Se.sH)(ge.tQ.newQuery)),n(e.path),fp(a({...e,schemaData:s}))};i?i().then((e=>{e&&r()})):r()};return{createDirectory:r?()=>{r(e.path)}:void 0,createTable:o(Sp),createColumnTable:o(Ep),createAsyncReplication:o(Tp),alterAsyncReplication:o(Mp),dropAsyncReplication:o(Op),alterTable:o(Np),dropTable:o(Wp),selectQuery:o(jp),upsertQuery:o(Cp),createExternalTable:o(Pp),dropExternalTable:o(wp),selectQueryFromExternalTable:o(jp),createTopic:o(Ip),alterTopic:o(Dp),dropTopic:o(Ap),createView:o(_p),dropView:o(Rp),dropIndex:o(Lp),addTableIndex:o(kp),createCdcStream:o(zp),copyPath:()=>{try{Tv()(e.relativePath),It({name:"Copied",title:Hr("actions.copied"),type:"success"})}catch{It({name:"Not copied",title:Hr("actions.notCopied"),type:"error"})}}}})({path:n,relativePath:Nv(n,a),tenantName:a,type:r},e,t),s={text:Hr("actions.copyPath"),action:i.copyPath},o=[[s],[{text:Hr("actions.createTable"),action:i.createTable},{text:Hr("actions.createColumnTable"),action:i.createColumnTable},{text:Hr("actions.createAsyncReplication"),action:i.createAsyncReplication},{text:Hr("actions.createTopic"),action:i.createTopic},{text:Hr("actions.createView"),action:i.createView}]];i.createDirectory&&o.splice(1,0,[{text:Hr("actions.createDirectory"),action:i.createDirectory}]);const l=[[s],[{text:Hr("actions.alterTable"),action:i.alterTable},{text:Hr("actions.dropTable"),action:i.dropTable},Cv({text:Hr("actions.selectQuery"),action:i.selectQuery,isLoading:t.isSchemaDataLoading}),Cv({text:Hr("actions.upsertQuery"),action:i.upsertQuery,isLoading:t.isSchemaDataLoading}),{text:Hr("actions.addTableIndex"),action:i.addTableIndex},{text:Hr("actions.createCdcStream"),action:i.createCdcStream}]],c=[[s],[{text:Hr("actions.alterTable"),action:i.alterTable},{text:Hr("actions.dropTable"),action:i.dropTable},{text:Hr("actions.selectQuery"),action:i.selectQuery},{text:Hr("actions.upsertQuery"),action:i.upsertQuery}]],d=[[s],[{text:Hr("actions.alterTopic"),action:i.alterTopic},{text:Hr("actions.dropTopic"),action:i.dropTopic}]],u=[[s],[{text:Hr("actions.selectQuery"),action:i.selectQueryFromExternalTable}],[{text:Hr("actions.dropTable"),action:i.dropExternalTable}]],p=[[s],[{text:Hr("actions.createExternalTable"),action:i.createExternalTable}]],m=[[s],[{text:Hr("actions.selectQuery"),action:i.selectQuery}],[{text:Hr("actions.dropView"),action:i.dropView}]],h=[s];return{async_replication:[[s],[{text:Hr("actions.alterReplication"),action:i.alterAsyncReplication},{text:Hr("actions.dropReplication"),action:i.dropAsyncReplication}]],database:o,directory:o,table:l,column_table:c,index_table:h,topic:d,stream:h,index:[[s,{text:Hr("actions.dropIndex"),action:i.dropIndex}]],external_table:u,external_data_source:p,view:m}[r]},Pv=(0,c.cn)("ydb-schema-create-directory-dialog"),Iv="relativePath";function Dv({open:e,onClose:t,database:a,parentPath:r,onSuccess:i}){const[s,o]=n.useState(""),[l,c]=n.useState(""),[u,p]=Eu.sM.useCreateDirectoryMutation(),m=()=>{o(""),p.reset()},h=()=>{t(),c(""),m()};return(0,d.jsxs)(Us.l,{open:e,onClose:h,size:"s",children:[(0,d.jsx)(Us.l.Header,{caption:Hr("schema.tree.dialog.header")}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=(n=l)?/\s/.test(n)?Hr("schema.tree.dialog.whitespace"):"":Hr("schema.tree.dialog.empty");var n;o(t),t||u({database:a,path:`${r}/${l}`}).unwrap().then((()=>{h(),i(l)}))},children:[(0,d.jsxs)(Us.l.Body,{children:[(0,d.jsxs)("label",{htmlFor:Iv,className:Pv("label"),children:[(0,d.jsx)("span",{className:Pv("description"),children:Hr("schema.tree.dialog.description")}),`${r}/`]}),(0,d.jsx)("div",{className:Pv("input-wrapper"),children:(0,d.jsx)(Vs.k,{placeholder:Hr("schema.tree.dialog.placeholder"),value:l,onUpdate:e=>{c(e),m()},autoFocus:!0,hasClear:!0,autoComplete:!1,disabled:p.isLoading,validationState:s?"invalid":void 0,id:Iv,errorMessage:s})}),p.isError&&(0,d.jsx)(Ne.o,{error:p.error,defaultMessage:Hr("schema.tree.dialog.invalid")})]}),(0,d.jsx)(Us.l.Footer,{loading:p.isLoading,textButtonApply:Hr("schema.tree.dialog.buttonApply"),textButtonCancel:Hr("schema.tree.dialog.buttonCancel"),onClickButtonCancel:h,propsButtonApply:{type:"submit"}})]})]})}const Av=n.createContext(void 0),_v=n.createContext(void 0);function Rv({children:e}){const[t,a]=n.useState("");return(0,d.jsx)(Av.Provider,{value:t,children:(0,d.jsx)(_v.Provider,{value:a,children:e})})}function Ov(){const e=n.useContext(_v);if(void 0===e)throw new Error("useDispatchTreeKey must be used within a TreeKeyProvider");return e}function Mv(e){const t=(0,fe.Ii)(),{rootPath:a,rootName:r,rootType:i,currentPath:s,onActivePathUpdate:o}=e,l=(0,he.YQ)(),c=(0,he.N4)(zs.Wp),[u,{currentData:p,isFetching:m}]=Sv.useLazyGetTableSchemaDataQuery(),[h,v]=(0,he.XS)(),[g,y]=n.useState(!1),[x,b]=n.useState(""),f=Ov(),S=function(){const e=n.useContext(Av);if(void 0===e)throw new Error("useTreeKey must be used within a TreeKeyProvider");return e}();n.useEffect((()=>{null!==s&&void 0!==s&&s.startsWith(a)||o(a)}),[s,o,a]);const E=e=>{b(e),y(!0)},T=n.useMemo((()=>wv(l,{setActivePath:o,updateQueryExecutionSettings:e=>v({...h,...e}),showCreateDirectoryDialog:t?E:void 0,getConfirmation:c?co:void 0,schemaData:p,isSchemaDataLoading:m},a)),[p,t,l,c,m,o,h,a,v]);return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(Dv,{onClose:()=>{y(!1)},open:g,database:a,parentPath:x,onSuccess:e=>{const t=`${x}/${e}`;o(t),f(t)}}),(0,d.jsx)(bv.F,{rootState:{path:a,name:r,type:q(i),collapsed:!1},fetchPath:async e=>{let t;for(;;){const n=l(Eu.sM.endpoints.getSchema.initiate({path:e,database:a},{forceRefetch:!0})),{data:r,originalArgs:i}=await n;if(n.unsubscribe(),(null===i||void 0===i?void 0:i.path)===e){t=null===r||void 0===r?void 0:r[e];break}}if(!t)throw new Error(`no describe data about path ${e}`);const{PathDescription:{Children:n=[]}={}}=t;return n.map((e=>{const{Name:t="",PathType:a,PathSubType:n}=e;return{name:t,type:q(a,n),expandable:!ne(a,n)}}))},getActions:T,onActionsOpenToggle:({path:e,type:t,isOpen:n})=>{const r=U[t];return n&&r&&u({path:e,tenantName:a,type:r}),[]},renderAdditionalNodeElements:yv(l,{setActivePath:o}),activePath:s,onActivePathUpdate:o,cache:!1,virtualize:!0},S)]})}const kv=JSON.parse('{"title_navigation":"Navigation","field_source-type":"Source Type","field_data-source":"Data Source","action_copySchemaPath":"Copy schema path","action_openInDiagnostics":"Open in Diagnostics","field_type":"Type","field_subtype":"SubType","field_id":"Id","field_version":"Version","field_created":"Created","field_data-size":"Data size","field_row-count":"Row count","field_partitions":"Partitions count","field_paths":"Paths","field_shards":"Shards","field_state":"State","field_mode":"Mode","field_format":"Format","field_retention":"Retention"}'),Lv=(0,rt.g4)("ydb-object-summary",{en:kv}),zv=(0,c.cn)("ydb-object-summary");function Fv({tenantName:e,path:t}){var a;const{data:n={},isLoading:r}=(0,Eu.Tn)({path:e,database:e}),s=null===n||void 0===n||null===(a=n.PathDescription)||void 0===a?void 0:a.Self,[,o]=(0,i.useQueryParam)("schema",i.StringParam);return!s&&r?(0,d.jsx)("div",{children:(0,d.jsx)(je.a,{})}):(0,d.jsxs)("div",{className:zv("tree-wrapper"),children:[(0,d.jsx)("div",{className:zv("tree-header"),children:Lv("title_navigation")}),(0,d.jsx)("div",{className:zv("tree"),children:s?(0,d.jsx)(Mv,{rootPath:e,rootName:s.Name||e,rootType:s.PathType,currentPath:t,onActivePathUpdate:o}):null})]})}var Uv=a(16963);function qv(){const e=(0,he.YQ)(),{diagnosticsTab:t,tenantPage:a}=(0,he.N4)((e=>e.tenant)),n=a===ge.Dg.diagnostics&&t===ge.iJ.schema;return(0,d.jsx)("div",{children:!n&&(0,d.jsx)(wn.$,{title:Lv("action_openInDiagnostics"),onClick:()=>{e((0,Se.es)(ge.Dg.diagnostics)),e((0,Se.WO)(ge.iJ.schema))},size:"s",children:(0,d.jsx)(Tt.I,{data:Uv.A,size:14})})})}var Qv=a(8873),Bv=a(97091);function $v(){const e=Ov();return(0,d.jsx)(Et.m,{title:"Refresh",children:(0,d.jsx)(wn.$,{view:"flat-secondary",onClick:()=>{e((0,Bv.Ak)())},children:(0,d.jsx)(Tt.I,{data:Qv.A})})})}const Gv=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:Boolean(localStorage.getItem(me.hh))});function Hv({type:e,subType:t,tenantName:a,path:r,onCollapseSummary:s,onExpandSummary:o,isCollapsed:l}){var c;const[u]=(0,he.Nt)(),p=(0,he.YQ)(),[,m]=(0,i.useQueryParam)("schema",i.StringParam),[v,g]=n.useReducer(qu(me.hh),void 0,Gv),{summaryTab:y=ge.ml.overview}=(0,he.N4)((e=>e.tenant)),x=(0,pr.zy)(),b=Ba().parse(x.search,{ignoreQueryPrefix:!0}),{currentData:E}=le.useGetOverviewQuery({path:r,database:a},{pollingInterval:u}),T=null===E||void 0===E||null===(c=E.PathDescription)||void 0===c?void 0:c.Self;n.useEffect((()=>{const t=H(e);!e||t||ga.x$.find((e=>e.id===y))||p((0,Se.Mj)(ge.ml.overview))}),[p,e,y]);const N=()=>{const t=H(e)?[...ga.x$,...ga.nb]:ga.x$;return(0,d.jsx)("div",{className:zv("tabs"),children:(0,d.jsxs)(St.s,{className:zv("tabs-inner"),justifyContent:"space-between",alignItems:"center",children:[(0,d.jsx)(ye.t,{size:"l",items:t,activeTab:y,wrapTo:({id:e},t)=>{const a=(0,ga.YL)({...b,[ga.vh.summaryTab]:e});return(0,d.jsx)(xe.N_,{to:a,className:zv("tab"),children:t},e)},allowNotSelected:!0}),y===ge.ml.schema&&(0,d.jsx)(qv,{})]})})},j=()=>{switch(y){case ge.ml.acl:return(0,d.jsx)(pv,{path:r,database:a});case ge.ml.schema:return(0,d.jsx)(va,{type:e,path:r,tenantName:a});default:return(()=>{var e;if(!T)return;const{CreateStep:t,PathType:a,PathSubType:i,PathId:s,PathVersion:o}=T,l=[],c=jv(r,a)?"Domain":null===a||void 0===a?void 0:a.replace(/^EPathType/,"");l.push({name:Lv("field_type"),content:c}),i!==S.EPathSubTypeEmpty&&l.push({name:Lv("field_subtype"),content:null===i||void 0===i?void 0:i.replace(/^EPathSubType/,"")}),l.push({name:Lv("field_id"),content:s}),l.push({name:Lv("field_version"),content:o}),l.push({name:Lv("field_created"),content:(0,Pe.r6)(t)});const{PathDescription:u}=E;if(null!==u&&void 0!==u&&u.TableStats){const{DataSize:e,RowCount:t}=u.TableStats;l.push({name:Lv("field_data-size"),content:Gn(e)},{name:Lv("field_row-count"),content:(0,Pe.ZV)(t)})}const p=()=>{var e;const{PathsInside:t,ShardsInside:a,PathsLimit:n,ShardsLimit:r}=null!==(e=null===u||void 0===u?void 0:u.DomainDescription)&&void 0!==e?e:{};let i=(0,Pe.ZV)(t),s=(0,Pe.ZV)(a);return i&&n&&(i=`${i} / ${(0,Pe.ZV)(n)}`),s&&r&&(s=`${s} / ${(0,Pe.ZV)(r)}`),[{name:Lv("field_paths"),content:i},{name:Lv("field_shards"),content:s}]},m={[f.EPathTypeInvalid]:void 0,[f.EPathTypeDir]:void 0,[f.EPathTypeTable]:()=>{var e;return[{name:Lv("field_partitions"),content:null===u||void 0===u||null===(e=u.TablePartitions)||void 0===e?void 0:e.length}]},[f.EPathTypeSubDomain]:p,[f.EPathTypeTableIndex]:void 0,[f.EPathTypeExtSubDomain]:p,[f.EPathTypeColumnStore]:()=>{var e,t;return[{name:Lv("field_partitions"),content:null===u||void 0===u||null===(e=u.ColumnStoreDescription)||void 0===e||null===(t=e.ColumnShards)||void 0===t?void 0:t.length}]},[f.EPathTypeColumnTable]:()=>{var e,t,a;return[{name:Lv("field_partitions"),content:null===u||void 0===u||null===(e=u.ColumnTableDescription)||void 0===e||null===(t=e.Sharding)||void 0===t||null===(a=t.ColumnShards)||void 0===a?void 0:a.length}]},[f.EPathTypeCdcStream]:()=>{const{Mode:e,Format:t}=(null===u||void 0===u?void 0:u.CdcStreamDescription)||{};return[{name:Lv("field_mode"),content:null===e||void 0===e?void 0:e.replace(/^ECdcStreamMode/,"")},{name:Lv("field_format"),content:null===t||void 0===t?void 0:t.replace(/^ECdcStreamFormat/,"")}]},[f.EPathTypePersQueueGroup]:()=>{var e,t,a;const n=null===u||void 0===u?void 0:u.PersQueueGroup,r=null===n||void 0===n||null===(e=n.PQTabletConfig)||void 0===e||null===(t=e.PartitionConfig)||void 0===t?void 0:t.LifetimeSeconds;return[{name:Lv("field_partitions"),content:null===n||void 0===n||null===(a=n.Partitions)||void 0===a?void 0:a.length},{name:Lv("field_retention"),content:r&&(0,Pe.Pt)(r)}]},[f.EPathTypeExternalTable]:()=>{var e,t;const a=(0,Ae.Ow)({...b,schema:null===u||void 0===u||null===(e=u.ExternalTableDescription)||void 0===e?void 0:e.DataSourcePath}),{SourceType:n,DataSourcePath:r}=(null===u||void 0===u?void 0:u.ExternalTableDescription)||{},i=(null===r||void 0===r||null===(t=r.match(/([^/]*)\/*$/))||void 0===t?void 0:t[1])||"";return[{name:Lv("field_source-type"),content:n},{name:Lv("field_data-source"),content:r&&(0,d.jsx)("span",{title:r,children:(0,d.jsx)(mr.K,{title:i||"",url:a})})}]},[f.EPathTypeExternalDataSource]:()=>{var e;return[{name:Lv("field_source-type"),content:null===u||void 0===u||null===(e=u.ExternalDataSourceDescription)||void 0===e?void 0:e.SourceType}]},[f.EPathTypeView]:void 0,[f.EPathTypeReplication]:()=>{var e;const t=null===u||void 0===u||null===(e=u.ReplicationDescription)||void 0===e?void 0:e.State;return t?[{name:Lv("field_state"),content:(0,d.jsx)(jr,{state:t})}]:[]}},h=a&&(null===(e=m[a])||void 0===e?void 0:e.call(m))||[];l.push(...h);const v=l.filter((e=>e.content)).map((e=>({...e,content:(0,d.jsx)("div",{className:zv("overview-item-content"),children:e.content}),multilineName:!0})));return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)("div",{className:zv("overview-title"),children:(0,d.jsx)(Wr,{data:u})}),(0,d.jsx)(br.u,{items:v,responsive:!0,nameMaxWidth:150})]})})()}},C=()=>{g(zu.triggerCollapse)},w=()=>{g(zu.triggerExpand)},P=()=>{g(zu.clear)},I=Nv(r,a),D=()=>{const a=H(e)&&!V(t);return(0,d.jsxs)(n.Fragment,{children:[a&&xv(p,{setActivePath:m},"m")(r,"preview"),(0,d.jsx)(jn.b,{text:I,view:"flat-secondary",title:Lv("action_copySchemaPath")}),(0,d.jsx)(Bu,{onCollapse:C,onExpand:w,isCollapsed:v.collapsed,initialDirection:"bottom"})]})},A=()=>{const{Status:t,Reason:a}=null!==E&&void 0!==E?E:{};if(e){let t=e.replace("EPathType","");return jv(r,e)&&(t="domain"),(0,d.jsx)("div",{className:zv("entity-type"),children:t})}let n;return t&&a&&(n=`${t}: ${a}`),(0,d.jsx)("div",{className:zv("entity-type",{error:!0}),children:(0,d.jsx)(Ga.B,{content:n,offset:{left:0}})})};return(0,d.jsx)(Rv,{children:(0,d.jsxs)("div",{className:zv(),children:[(0,d.jsx)("div",{className:zv({hidden:l}),children:(0,d.jsxs)(h,{direction:"vertical",defaultSizePaneKey:me.ED,onSplitStartDragAdditional:P,triggerCollapse:v.triggerCollapse,triggerExpand:v.triggerExpand,minSize:[200,52],collapsedSizes:[100,0],children:[(0,d.jsx)(Fv,{tenantName:a,path:r}),(0,d.jsxs)("div",{className:zv("info"),children:[(0,d.jsxs)("div",{className:zv("sticky-top"),children:[(0,d.jsxs)("div",{className:zv("info-header"),children:[(0,d.jsxs)("div",{className:zv("info-title"),children:[A(),(0,d.jsx)("div",{className:zv("path-name"),children:I})]}),(0,d.jsx)("div",{className:zv("info-controls"),children:D()})]}),N()]}),(0,d.jsx)("div",{className:zv("overview-wrapper"),children:j()})]})]})}),(0,d.jsxs)(St.s,{className:zv("actions"),gap:.5,children:[!l&&(0,d.jsx)($v,{}),(0,d.jsx)(Bu,{onCollapse:s,onExpand:o,isCollapsed:l,initialDirection:"left"})]})]})})}const Wv=(0,c.cn)("tenant-page"),Vv=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:Boolean(localStorage.getItem(me.jX))});function Jv(e){var t;const[l]=(0,he.Nt)(),[c,u]=n.useReducer(qu(me.jX),void 0,Vv),[{database:p,name:m,schema:v},g]=(0,i.useQueryParams)({database:i.StringParam,name:i.StringParam,schema:i.StringParam});n.useEffect((()=>{m&&!p&&g({database:m,name:void 0},"replaceIn")}),[p,m,g]);const x=null!==p&&void 0!==p?p:m;if(!x)throw new Error("Tenant name is not defined");const b=n.useRef();n.useEffect((()=>{if(b.current!==x){(async()=>{const{registerYQLCompletionItemProvider:e}=await a.e(5210).then(a.bind(a,35210));e(x)})().catch(console.error),b.current=x}}),[x]);const f=(0,he.YQ)();n.useEffect((()=>{f((0,y.g)("tenant",{tenantName:x}))}),[x,f]);const S=null!==v&&void 0!==v?v:x,{currentData:E,error:T,isLoading:N}=le.useGetOverviewQuery({path:S,database:x},{pollingInterval:l}),{PathType:j,PathSubType:C}=(null===E||void 0===E||null===(t=E.PathDescription)||void 0===t?void 0:t.Self)||{},w=(0,s.P)(T),[P,I]=n.useState(!0);P&&!N&&I(!1);const D=S||Hr("page.title");return(0,d.jsxs)("div",{className:Wv(),children:[(0,d.jsx)(r.mg,{defaultTitle:`${D} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${D} \u2014 YDB Monitoring`}),(0,d.jsx)(o.r,{loading:P,children:(0,d.jsx)(s.A,{error:w?T:void 0,children:(0,d.jsxs)(h,{defaultSizePaneKey:me.jQ,defaultSizes:[25,75],triggerCollapse:c.triggerCollapse,triggerExpand:c.triggerExpand,minSize:[36,200],onSplitStartDragAdditional:()=>{u(zu.clear)},children:[(0,d.jsx)(Hv,{type:j,subType:C,tenantName:x,path:S,onCollapseSummary:()=>{u(zu.triggerCollapse)},onExpandSummary:()=>{u(zu.triggerExpand)},isCollapsed:c.collapsed}),(0,d.jsx)("div",{className:Wv("main"),children:(0,d.jsx)(tv,{type:j,additionalTenantProps:e.additionalTenantProps,additionalNodesProps:e.additionalNodesProps,tenantName:x,path:S})})]})})})]})}},66574:()=>{},2748:()=>{},52246:()=>{}}]);