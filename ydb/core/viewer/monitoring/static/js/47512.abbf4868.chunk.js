"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[47512],{14188:(e,s,n)=>{n.r(s),n.d(s,{Cluster:()=>Ws});var t=n(59284),r=n(89169),l=n(23871),a=n(61750),o=n(10755),i=n(67087),d=n(90053),c=n(10508),u=n(44294),v=n(92459),h=n(67028),m=n(67157),p=n(40174),g=n(77506),j=n(90182),x=n(7117),N=n(99936),f=n(88616),b=n(93381),y=n(64470),C=n(4557),w=n(84476),k=n(99991),T=n(40569),S=n(28539),_=n(44508),E=n(78524),V=n(48295),O=n(9252),D=n(17594),L=n(95963),A=n(89073),z=n(23900),M=n(87184),G=n(54309),I=n(12888),P=n(25196),R=n(48372);const B=JSON.parse('{"field_links":"Links","field_monitoring-link":"Monitoring","field_logs-link":"Logs","context_unknown":"unknown database"}'),$=(0,R.g4)("ydb-tenant-name-wrapper",{en:B});var U=n(60712);function F({tenant:e,additionalTenantsProps:s}){var n,t;const r=(0,I.X)(),l=((e,s)=>{var n;if("function"!==typeof(null===s||void 0===s?void 0:s.prepareTenantBackend))return;let t;const r=null!==(n=e.NodeIds)&&void 0!==n?n:e.sharedNodeIds;r&&r.length>0&&(t=r[Math.floor(Math.random()*r.length)].toString());return s.prepareTenantBackend(t)})(e,s),a=Boolean(l),o=null===s||void 0===s||null===(n=s.getMonitoringLink)||void 0===n?void 0:n.call(s,e.Name,e.Type),i=null===s||void 0===s||null===(t=s.getLogsLink)||void 0===t?void 0:t.call(s,e.Name),d=(o||i)&&r?(0,U.jsx)(z.u,{responsive:!0,children:(0,U.jsx)(z.u.Item,{name:$("field_links"),children:(0,U.jsxs)(M.s,{gap:2,wrap:"wrap",children:[o&&(0,U.jsx)(P.K,{title:$("field_monitoring-link"),url:o}),i&&(0,U.jsx)(P.K,{title:$("field_logs-link"),url:i})]})})}):null;return(0,U.jsx)(c.c,{externalLink:a,name:e.Name||$("context_unknown"),withLeftTrim:!0,status:e.Overall,infoPopoverContent:d,hasClipboardButton:!0,path:(0,G.YL)({database:e.Name,backend:l},{withBasename:a})})}var W=n(88610),Z=n(53850),q=n(23536),H=n.n(q),Q=n(54090),Y=n(76086),K=n(56674);const J=(0,Z.Mz)((e=>e),(e=>K.GJ.endpoints.getTenantsInfo.select({clusterName:e}))),X=(0,Z.Mz)((e=>e),((e,s)=>J(s)),(e=>(0,W.CN)(e,Y.Xm)),((e,s,n)=>{var t;const r=null!==(t=s(e).data)&&void 0!==t?t:[];return!n&&r.length>1?r.filter((e=>"Domain"!==e.Type)):r})),ee=e=>e.tenants.searchValue,se=(0,Z.Mz)([X,W.yV,ee],((e,s,n)=>{let t=((e,s)=>s===W.s$.ALL?e:e.filter((e=>e.Overall&&e.Overall!==Q.m.Green)))(e,s);return t=((e,s)=>e.filter((e=>{const n=new RegExp(H()(s),"i");return n.test(e.Name||"")||n.test(e.controlPlaneName)})))(t,n),t})),ne={};const te=new Proxy(ne,{set:()=>{throw new Error("Use configureUIFactory(...) method instead of direct modifications")}});var re=n(56839),le=n(28232);const ae=JSON.parse('{"create-database":"Create database","remove":"Remove"}'),oe=(0,R.g4)("ydb-tenants-table",{en:ae}),ie=(0,g.cn)("tenants"),de=({additionalTenantsProps:e})=>{const s=(0,j.YQ)(),n=(0,le.H)(),[r]=(0,j.Nt)(),{currentData:l,isFetching:a,error:o}=K.GJ.useGetTenantsInfoQuery({clusterName:n},{pollingInterval:r}),i=a&&void 0===l,d=(0,h.sH)()&&void 0!==te.onCreateDB,c=(0,h.TW)()&&void 0!==te.onDeleteDB,u=(0,j.N4)((e=>X(e,n))),v=(0,j.N4)(ee),m=(0,j.N4)((e=>se(e,n))),p=(0,j.N4)(W.yV),g=e=>{s((0,W.$u)(e))},x=e=>{s((0,K.gB)(e))};return(0,U.jsx)("div",{className:ie("table-wrapper"),children:(0,U.jsxs)(A.L,{children:[(0,U.jsx)(A.L.Controls,{className:ie("controls"),children:(0,U.jsxs)(t.Fragment,{children:[(0,U.jsx)(L.v,{value:v,onChange:x,placeholder:"Database name",className:ie("search")}),(0,U.jsx)(O.k,{value:p,onChange:g}),(0,U.jsx)(S.T,{total:u.length,current:(null===m||void 0===m?void 0:m.length)||0,label:"Databases",loading:i}),d&&n&&!i?(0,U.jsxs)(w.$,{view:"action",onClick:()=>{var e;return null===(e=te.onCreateDB)||void 0===e?void 0:e.call(te,{clusterName:n})},className:ie("create-database"),children:[(0,U.jsx)(k.I,{data:b.A}),oe("create-database")]}):null]})}),o?(0,U.jsx)(_.o,{error:o}):null,(0,U.jsx)(A.L.Table,{loading:i,children:l?(()=>{const s=[{name:"Name",header:"Database",render:({row:s})=>(0,U.jsx)(F,{tenant:s,additionalTenantsProps:e}),width:440,sortable:!0,defaultOrder:C.Ay.DESCENDING},{name:"controlPlaneName",header:"Name",render:({row:e})=>e.controlPlaneName,width:200,sortable:!0,defaultOrder:C.Ay.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:({row:e})=>"Serverless"!==e.Type?e.Type:(0,U.jsxs)("div",{className:ie("type"),children:[(0,U.jsx)("span",{className:ie("type-value"),children:e.Type}),(0,U.jsx)(w.$,{className:ie("type-button"),onClick:()=>x(e.sharedTenantName||""),children:"Show shared"})]})},{name:"State",width:90,render:({row:e})=>e.State?e.State.toLowerCase():"\u2014",customStyle:()=>({textTransform:"capitalize"})},{name:"cpu",header:"CPU",width:80,render:({row:e})=>e.cpu&&e.cpu>1e4?(0,re.iM)(e.cpu):"\u2014",align:C.Ay.RIGHT,defaultOrder:C.Ay.DESCENDING},{name:"memory",header:"Memory",width:120,render:({row:e})=>e.memory?(0,re.vX)(e.memory):"\u2014",align:C.Ay.RIGHT,defaultOrder:C.Ay.DESCENDING},{name:"storage",header:"Storage",width:120,render:({row:e})=>e.storage?(0,re.vX)(e.storage):"\u2014",align:C.Ay.RIGHT,defaultOrder:C.Ay.DESCENDING},{name:"nodesCount",header:"Nodes",width:100,render:({row:e})=>e.nodesCount?(0,re.ZV)(e.nodesCount):"\u2014",align:C.Ay.RIGHT,defaultOrder:C.Ay.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:({row:e})=>e.groupsCount?(0,re.ZV)(e.groupsCount):"\u2014",align:C.Ay.RIGHT,defaultOrder:C.Ay.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:({PoolStats:e=[]})=>e.reduce(((e,s)=>e+(s.Usage||0)),0),defaultOrder:C.Ay.DESCENDING,align:C.Ay.LEFT,render:({row:e})=>(0,U.jsx)(V._,{pools:e.PoolStats})}];return c&&s.push({name:"actions",header:"",width:40,resizeable:!1,align:C.Ay.CENTER,render:({row:e})=>{var s;const t=null===(s=e.UserAttributes)||void 0===s?void 0:s.database_id,r=e.Name;let l=[];return n&&r&&t&&(l=[{text:oe("remove"),iconStart:(0,U.jsx)(y.A,{}),action:()=>{var e;null===(e=te.onDeleteDB)||void 0===e||e.call(te,{clusterName:n,databaseId:t,databaseName:r})},className:ie("remove-db")}]),l.length?(0,U.jsx)(T.r,{defaultSwitcherProps:{view:"flat",size:"s",pin:"brick-brick"},items:l}):null}}),0===m.length&&p!==W.s$.ALL?(0,U.jsx)(E.v,{name:"thumbsUp",width:"200"}):(0,U.jsx)(D.l,{columnsWidthLSKey:"databasesTableColumnsWidth",data:m,columns:s,settings:Y.N3,emptyDataMessage:"No such tenants"})})():null})]})})};var ce=n(44433),ue=n(74321),ve=n(98167),he=n(15298),me=n(18143);const pe=(0,g.cn)("ydb-cluster-versions-bar"),ge=({versionsValues:e=[],size:s="s",progressClassName:n})=>(0,U.jsxs)("div",{className:pe(),children:[(0,U.jsx)(me.k,{value:100,stack:e,size:s,className:n}),(0,U.jsx)("div",{className:pe("versions"),children:e.map(((s,n)=>(0,U.jsx)("div",{className:pe("version-title"),style:{color:s.color},title:s.version,children:`${s.version}${n===e.length-1?"":","}`},s.version)))})]});var je=n(63126),xe=n(78762),Ne=n(88655);function fe(e){return[(0,xe._E)(),(0,xe.Nh)(e),(0,xe.jl)(),(0,xe.pH)(),(0,xe.fr)(),(0,xe.ID)()]}const be=({nodes:e})=>{const s=(0,Ne.E)(),n=fe({getNodeRef:null===s||void 0===s?void 0:s.getNodeRef});return(0,U.jsx)(D.l,{columnsWidthLSKey:"versionsTableColumnsWidth",data:e,columns:n,settings:Y.N3})};var ye=n(96873);const Ce=(0,g.cn)("ydb-versions-nodes-tree-title"),we=({title:e,nodes:s,items:n,versionColor:t,versionsValues:r})=>{let l;return l=n?n.reduce(((e,s)=>s.nodes?e+s.nodes.length:e),0):s?s.length:0,(0,U.jsxs)("div",{className:Ce("overview"),children:[(0,U.jsxs)("div",{className:Ce("overview-container"),children:[t?(0,U.jsx)("div",{className:Ce("version-color"),style:{background:t}}):null,e?(0,U.jsxs)("span",{className:Ce("overview-title"),children:[e,(0,U.jsx)(ye.b,{text:e,size:"s",className:Ce("clipboard-button"),view:"normal"})]}):null]}),(0,U.jsxs)("div",{className:Ce("overview-info"),children:[(0,U.jsxs)("div",{children:[(0,U.jsx)("span",{className:Ce("info-value"),children:l}),(0,U.jsx)("span",{className:Ce("info-label",{margin:"left"}),children:"Nodes"})]}),r?(0,U.jsxs)("div",{className:Ce("version-progress"),children:[(0,U.jsx)("span",{className:Ce("info-label",{margin:"right"}),children:"Versions"}),(0,U.jsx)(me.k,{size:"s",value:100,stack:r})]}):null]})]})},ke=(0,g.cn)("ydb-versions-grouped-node-tree"),Te=({title:e,nodes:s,items:n,expanded:r=!1,versionColor:l,versionsValues:a,level:o=0})=>{const[i,d]=t.useState(!1);t.useEffect((()=>{d(r)}),[r]);const c=(0,U.jsx)(we,{title:e,nodes:s,items:n,versionColor:l,versionsValues:a}),u=()=>{d((e=>!e))};return n?(0,U.jsx)("div",{className:ke({"first-level":0===o}),children:(0,U.jsx)(je.G,{name:c,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:n.map(((e,s)=>(0,U.jsx)(Te,{title:e.title,nodes:e.nodes,expanded:r,versionColor:e.versionColor,level:o+1},s)))},e)}):(0,U.jsx)("div",{className:ke({"first-level":0===o}),children:(0,U.jsx)(je.G,{name:c,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:(0,U.jsx)("div",{className:ke("dt-wrapper"),children:(0,U.jsx)(be,{nodes:s||[]})})},e)})};var Se=n(78018),_e=n.n(Se),Ee=n(38596);const Ve=.5,Oe=(e=[],s)=>{const n=e.reduce(((e,s)=>(s.Version&&(e[s.Version]?e[s.Version]=e[s.Version]+1:e[s.Version]=1),e)),{});return Le(Object.keys(n).map((t=>{const r=n[t]/e.length*100;return{title:t,version:t,color:null===s||void 0===s?void 0:s.get((0,Ee.U)(t)),value:r<Ve?Ve:r}})))};function De(e,s,n){const t=null!==n&&void 0!==n?n:e.reduce(((e,s)=>e+s.count),0);return Le(e.map((e=>{const n=e.count/t*100;return{title:e.name,version:e.name,color:null===s||void 0===s?void 0:s.get((0,Ee.U)(e.name)),value:n<Ve?Ve:n}})))}function Le(e){let s=e[0].value,n=0,t=0;e.forEach(((e,r)=>{t+=e.value,e.value>s&&(s=e.value,n=r)}));const r=[...e];return r[n]={...e[n],value:s+100-t},r}let Ae=function(e){return e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage",e}({});const ze=(e,s)=>{var n;return(null===(n=e.title)||void 0===n?void 0:n.localeCompare(s.title||""))||-1},Me=(e,s,n)=>{if(e&&e.length){if(n===Ae.VERSION){const n=_e()(e,"Version");return Object.keys(n).map((e=>{const t=n[e].filter((({Tenants:e})=>Boolean(e))),r=_e()(t,"Tenants"),l=Object.keys(r).map((e=>({title:e,nodes:r[e]}))).sort(ze);return l.length?{title:e,items:l,versionColor:null===s||void 0===s?void 0:s.get((0,Ee.U)(e))}:null})).filter((e=>Boolean(e)))}{const n=e.filter((({Tenants:e})=>Boolean(e))),t=_e()(n,"Tenants");return Object.keys(t).map((e=>{const n=Oe(t[e],s),r=_e()(t[e],"Version"),l=Object.keys(r).map((e=>({title:e,nodes:r[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ee.U)(e))})));return l.length?{title:e,items:l,versionsValues:n}:null})).filter((e=>Boolean(e))).sort(ze)}}},Ge=(e,s)=>{if(!e||!e.length)return;const n=e.filter((({Roles:e})=>null===e||void 0===e?void 0:e.includes("Storage"))),t=_e()(n,"Version");return Object.keys(t).map((e=>({title:e,nodes:t[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ee.U)(e))})))},Ie=(e,s)=>{if(!e||!e.length)return;const n=e.filter((({Roles:e,Version:s})=>!e&&s)),t=_e()(n,"Version");return Object.keys(t).map((e=>({title:e,nodes:t[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ee.U)(e))})))},Pe=JSON.parse('{"title_overall":"Overall","title_storage":"Storage nodes","title_database":"Database nodes","title_other":"Other nodes"}'),Re=(0,R.g4)("ydb-versions",{en:Pe});var Be=n(44992),$e=n(39567),Ue=n(98730),Fe=n(40537),We=n(66592);const Ze=({cluster:e,versionToColor:s,clusterLoading:n})=>{const{currentData:r}=he.s.useGetNodesQuery((0,Ue.L)(e)||n?Be.hT:{tablets:!1,fieldsRequired:["SystemState","SubDomainKey"],group:"Version"});return t.useMemo((()=>{if((0,Ue.L)(e)&&e.MapVersions){return De(Object.entries(e.MapVersions).map((([e,s])=>({name:e,count:s}))),s,e.NodesTotal)}return r?Array.isArray(r.NodeGroups)?De(r.NodeGroups,s,null===e||void 0===e?void 0:e.NodesTotal):Oe(r.Nodes,s):[]}),[r,s,e])};function qe(e){const s=function(){const[e]=(0,i.useQueryParam)("clusterName",i.StringParam),s=(0,j.N4)((e=>e.singleClusterMode)),{data:n}=$e.ub.useGetClustersListQuery(void 0,{skip:s});return t.useMemo((()=>{if(s)return;const t=(n||[]).find((s=>s.name===e)),r=(null===t||void 0===t?void 0:t.versions)||[];return()=>(0,Fe.Vm)((0,Fe.HD)(r))}),[s,n,e])}();return t.useMemo((()=>s?s():(0,We._n)(null===e||void 0===e?void 0:e.Versions)),[null===e||void 0===e?void 0:e.Versions,s])}const He=(0,g.cn)("ydb-versions");function Qe({cluster:e,loading:s}){const[n]=(0,j.Nt)(),{currentData:t,isLoading:r}=he.s.useGetNodesQuery({tablets:!1,fieldsRequired:["SystemState","SubDomainKey"]},{pollingInterval:n}),l=qe(),a=Ze({cluster:e,versionToColor:l,clusterLoading:s});return(0,U.jsx)(ve.r,{loading:s||r,children:(0,U.jsx)(Ye,{versionsValues:a,nodes:null===t||void 0===t?void 0:t.Nodes,versionToColor:l})})}function Ye({versionsValues:e,nodes:s,versionToColor:n}){const[r,l]=t.useState(Ae.VERSION),[a,o]=t.useState(!1),i=e=>{l(e)},d=Me(s,n,r),c=Ge(s,n),u=Ie(s,n),v=null!==c&&void 0!==c&&c.length?(0,U.jsxs)(t.Fragment,{children:[(0,U.jsx)("h4",{children:Re("title_storage")}),c.map((({title:e,nodes:s,items:n,versionColor:t})=>(0,U.jsx)(Te,{title:e,nodes:s,items:n,versionColor:t},`storage-nodes-${e}`)))]}):null,h=null!==d&&void 0!==d&&d.length?(0,U.jsxs)(t.Fragment,{children:[(0,U.jsx)("h4",{children:Re("title_database")}),(0,U.jsxs)("div",{className:He("controls"),children:[(0,U.jsxs)("div",{className:He("group"),children:[(0,U.jsx)("span",{className:He("label"),children:"Group by:"}),(0,U.jsxs)(ce.a,{value:r,onUpdate:i,children:[(0,U.jsx)(ce.a.Option,{value:Ae.TENANT,children:Ae.TENANT}),(0,U.jsx)(ce.a.Option,{value:Ae.VERSION,children:Ae.VERSION})]})]}),(0,U.jsx)(ue.S,{className:He("checkbox"),onChange:()=>o((e=>!e)),checked:a,children:"All expanded"})]}),d.map((({title:e,nodes:s,items:n,versionColor:t,versionsValues:r})=>(0,U.jsx)(Te,{title:e,nodes:s,items:n,expanded:a,versionColor:t,versionsValues:r},`tenant-nodes-${e}`)))]}):null,m=null!==u&&void 0!==u&&u.length?(0,U.jsxs)(t.Fragment,{children:[(0,U.jsx)("h4",{children:Re("title_other")}),u.map((({title:e,nodes:s,items:n,versionColor:t,versionsValues:r})=>(0,U.jsx)(Te,{title:e,nodes:s,items:n,versionColor:t,versionsValues:r},`other-nodes-${e}`)))]}):null,p=(0,U.jsxs)(t.Fragment,{children:[(0,U.jsx)("h4",{children:Re("title_overall")}),(0,U.jsx)("div",{className:He("overall-wrapper"),children:(0,U.jsx)(ge,{progressClassName:He("overall-progress"),versionsValues:e.filter((e=>"unknown"!==e.title)),size:"m"})})]});return(0,U.jsxs)("div",{className:He(),children:[p,v,h,m]})}var Ke=n(98089);const Je=(0,g.cn)("tag"),Xe=({text:e,type:s})=>(0,U.jsx)("div",{className:Je({type:s}),children:e}),es=({tags:e,tagsType:s,className:n="",gap:t=1})=>(0,U.jsx)(M.s,{className:n,gap:t,wrap:"wrap",alignItems:"center",children:e&&e.map(((e,n)=>(0,U.jsx)(Xe,{text:e,type:s},n)))});var ss=n(7435);const ns=JSON.parse('{"disk-type":"Disk Type","erasure":"Erasure","allocated":"Allocated","available":"Available","usage":"Usage","label_nodes-state":"Nodes state","label_dc":"Nodes data centers","storage-size":"Storage size","storage-groups":"Storage groups, {{diskType}}","links":"Links","link_cores":"Coredumps","link_logging":"Logging","link_slo-logs":"SLO Logs","context_cores":"cores","title_cpu":"CPU","title_storage":"Storage","title_memory":"Memory","title_info":"Info","title_links":"Links","label_nodes":"Nodes","label_hosts":"Hosts","label_storage-groups":"Storage groups","label_databases":"Databases","label_load":"Load"}'),ts=(0,R.g4)("ydb-cluster",{en:ns});var rs=n(2102);const ls=(0,g.cn)("ydb-doughnut-metrics");function as({status:e,fillWidth:s,children:n,className:t}){let r="var(--g-color-line-generic-solid)",l=3.6*s-90;s>50&&(r="var(--doughnut-color)",l=3.6*s+90);const a=l;return(0,U.jsx)("div",{className:ls(null,t),children:(0,U.jsx)("div",{style:{backgroundImage:`linear-gradient(${a}deg, transparent 50%, ${r} 50%), linear-gradient(-90deg, var(--g-color-line-generic-solid) 50%, transparent 50%)`},className:ls("doughnut",{status:e}),children:(0,U.jsx)("div",{className:ls("text-wrapper"),children:n})})})}as.Legend=function({children:e,variant:s="subheader-3"}){return(0,U.jsx)(Ke.E,{variant:s,color:"secondary",className:ls("legend"),children:e})},as.Value=function({children:e,variant:s="subheader-2"}){return(0,U.jsx)(Ke.E,{variant:s,color:"secondary",className:ls("value"),children:e})};var os=n(70043);const is=(0,g.cn)("ydb-cluster-dashboard");function ds({children:e,title:s,size:n,className:t}){return(0,U.jsxs)(rs.A,{className:is("card",{size:n},t),size:n,interactive:!1,children:[s?(0,U.jsx)(Ke.E,{variant:"subheader-3",className:is("card-title"),children:s}):null,e]})}function cs({title:e,children:s,size:n,...t}){return(0,U.jsx)(ds,{title:e,size:n,children:(0,U.jsx)(as,{...t,className:is("doughnut"),children:s})})}function us(){return(0,U.jsx)(ds,{className:is("skeleton-wrapper"),children:(0,U.jsx)(os.E,{className:is("skeleton")})})}function vs(){return(0,U.jsxs)(t.Fragment,{children:[(0,U.jsx)(us,{}),(0,U.jsx)(us,{}),(0,U.jsx)(us,{})]})}var hs=n(35736),ms=n(57439),ps=n(24543),gs=n(46549);const js=(0,g.cn)("ydb-disk-groups-stats"),xs=({stats:e,children:s})=>(0,U.jsx)("div",{className:js(),children:(0,U.jsx)(ps.u,{placement:["right"],pinOnClick:!0,content:(0,U.jsx)(Ns,{stats:e}),children:s})});function Ns({stats:e}){const{diskType:s,erasure:n,allocatedSize:t,availableSize:r}=e,l=(0,gs.fn)(Math.max(t,r)),a=(0,gs.z3)({value:t,size:l}),o=(0,gs.z3)({value:r,size:l}),i=Math.round(t/(t+r)*100),d=[{name:ts("disk-type"),content:s},{name:ts("erasure"),content:n},{name:ts("allocated"),content:a},{name:ts("available"),content:o},{name:ts("usage"),content:i+"%"}];return(0,U.jsx)(ms.u,{items:d,className:js("popup-content"),responsive:!0})}function fs({value:e,capacity:s,colorizeProgress:n=!0,warningThreshold:t,dangerThreshold:r,inverseColorize:l=!1,legendFormatter:a}){const o=parseFloat(String(e)),i=parseFloat(String(s));let d=o/i*100||0;d=d>100?100:d;const c=d<1?.5:d;return{status:(0,hs.w)({fillWidth:d,warningThreshold:t,dangerThreshold:r,colorizeProgress:n,inverseColorize:l}),percents:(0,re.l9)(d/100),legend:a({value:o,capacity:i}),fill:c}}const bs=["storage","tenant"];const ys=e=>Object.values(e).reduce(((e,s)=>(Object.values(s).forEach((s=>{e+=s.createdGroups})),e)),0);function Cs({value:e,capacity:s}){let n=[];return n=s<1e4?[(0,re.ZV)(Math.round(e)),(0,re.ZV)(Math.round(s))]:(0,re.Nd)(e,s,void 0,"",!0),`${n[0]} / ${n[1]}\n${ts("context_cores")}`}function ws({value:e,capacity:s,...n}){const{status:t,percents:r,legend:l,fill:a}=fs({value:e,capacity:s,legendFormatter:Cs,...n});return(0,U.jsxs)(cs,{status:t,fillWidth:a,title:ts("title_cpu"),children:[(0,U.jsx)(as.Legend,{children:l}),(0,U.jsx)(as.Value,{children:r})]})}function ks({value:e,capacity:s}){const n=(0,re.j9)(e,s,void 0,"\n");return`${n[0]} / ${n[1]}`}function Ts({value:e,capacity:s,...n}){const{status:t,percents:r,legend:l,fill:a}=fs({value:e,capacity:s,legendFormatter:ks,...n});return(0,U.jsxs)(cs,{status:t,fillWidth:a,title:ts("title_memory"),children:[(0,U.jsx)(as.Legend,{children:l}),(0,U.jsx)(as.Value,{children:r})]})}function Ss({value:e,capacity:s}){const n=(0,re.j9)(e,s,void 0,"\n");return`${n[0]} / ${n[1]}`}function _s({value:e,capacity:s,...n}){const{status:t,percents:r,legend:l,fill:a}=fs({value:e,capacity:s,legendFormatter:Ss,...n});return(0,U.jsxs)(cs,{status:t,fillWidth:a,title:ts("title_storage"),children:[(0,U.jsx)(as.Legend,{children:l}),(0,U.jsx)(as.Value,{children:r})]})}function Es({value:e}){return(0,ss.f8)(e)?(0,U.jsx)(Ke.E,{variant:"subheader-3",color:"secondary",children:(0,re.ZV)(e)}):null}function Vs({cluster:e,...s}){return s.error?(0,U.jsx)(_.o,{error:s.error,className:is("error")}):(0,U.jsx)("div",{className:is(),children:(0,U.jsxs)(M.s,{gap:4,wrap:!0,children:[(0,U.jsx)(M.s,{gap:4,wrap:"nowrap",children:(0,U.jsx)(Os,{...s,cluster:e})}),(0,U.jsx)("div",{className:is("cards-container"),children:(0,U.jsx)(Ds,{...s,cluster:e})})]})})}function Os({cluster:e,loading:s}){if(s)return(0,U.jsx)(vs,{});const n=[];if((0,Ue.L)(e)){const{CoresUsed:s,NumberOfCpus:t,CoresTotal:r}=e,l=null!==r&&void 0!==r?r:t;(0,ss.f8)(s)&&(0,ss.f8)(l)&&n.push((0,U.jsx)(ws,{value:s,capacity:l},"cores"))}const{StorageTotal:t,StorageUsed:r}=e;(0,ss.f8)(t)&&(0,ss.f8)(r)&&n.push((0,U.jsx)(_s,{value:r,capacity:t},"storage"));const{MemoryTotal:l,MemoryUsed:a}=e;return(0,ss.f8)(l)&&(0,ss.f8)(a)&&n.push((0,U.jsx)(Ts,{value:a,capacity:l},"memory")),n}function Ds({cluster:e,groupStats:s={},loading:n}){if(n)return null;const r=[],l=function(e){const s=[];if((0,Ue.L)(e)&&e.MapNodeRoles)for(const[n,r]of Object.entries(e.MapNodeRoles))bs.includes(n.toLowerCase())&&s.push((0,U.jsxs)(t.Fragment,{children:[n,": ",(0,re.ZV)(r)]},n));return s}(e);if(r.push((0,U.jsx)(ds,{size:"l",title:ts("label_nodes"),children:(0,U.jsxs)(M.s,{gap:2,direction:"column",children:[(0,U.jsx)(Es,{value:null===e||void 0===e?void 0:e.NodesAlive}),null!==l&&void 0!==l&&l.length?(0,U.jsx)(es,{tags:l,gap:3}):null]})},"roles")),Object.keys(s).length){const e=function(e){const s=[];return Object.entries(e).forEach((([e,n])=>{Object.values(n).forEach((n=>{s.push((0,U.jsxs)(xs,{stats:n,children:[e,": ",(0,re.ZV)(n.createdGroups)," /"," ",(0,re.ZV)(n.totalGroups)]},`${e}|${n.erasure}`))}))})),s}(s),n=ys(s);r.push((0,U.jsx)(ds,{size:"l",title:ts("label_storage-groups"),children:(0,U.jsxs)(M.s,{gap:2,direction:"column",children:[(0,U.jsx)(Es,{value:n}),(0,U.jsx)(es,{tags:e,gap:3})]})},"groups"))}const a=function(e){var s;return(0,Ue.L)(e)&&e.MapDataCenters?Object.keys(e.MapDataCenters):null===(s=e.DataCenters)||void 0===s?void 0:s.filter(Boolean)}(e);return null!==a&&void 0!==a&&a.length&&r.push((0,U.jsx)(ds,{size:"l",title:ts("label_hosts"),children:(0,U.jsxs)(M.s,{gap:2,direction:"column",children:[(0,U.jsx)(Es,{value:null===e||void 0===e?void 0:e.Hosts}),(0,U.jsx)(es,{tags:a,gap:3})]})},"hosts")),e.Tenants&&r.push((0,U.jsx)(ds,{size:"l",title:ts("label_databases"),children:(0,U.jsx)(Es,{value:null===e||void 0===e?void 0:e.Tenants})},"tenants")),r}var Ls=n(42655);const As=(0,g.cn)("cluster-info");var zs=n(41650);function Ms(){const{cores:e,logging:s}=(0,m.Zd)();return t.useMemo((()=>{const n=[],t=function(e){try{const s=(0,zs.qF)(e);if(s&&"object"===typeof s&&"url"in s&&"string"===typeof s.url)return s.url}catch{}}(e),{logsUrl:r,sloLogsUrl:l}=function(e){try{const s=(0,zs.qF)(e);if(s&&"object"===typeof s){return{logsUrl:"url"in s&&"string"===typeof s.url?s.url:void 0,sloLogsUrl:"slo_logs_url"in s&&"string"===typeof s.slo_logs_url?s.slo_logs_url:void 0}}}catch{}return{}}(s);return t&&n.push({title:ts("link_cores"),url:t}),r&&n.push({title:ts("link_logging"),url:r}),l&&n.push({title:ts("link_slo-logs"),url:l}),n}),[e,s])}var Gs=n(15132);const Is=(0,g.cn)("ydb-nodes-state");function Ps({state:e,children:s}){return(0,U.jsx)("div",{className:Is({[e.toLowerCase()]:!0}),children:s})}const Rs={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},Bs=(e,s)=>{var n;const r=[];if((0,Ue.L)(e)&&e.MapNodeStates){const s=Object.entries(e.MapNodeStates);s.sort(((e,s)=>Rs[s[0]]-Rs[e[0]]));const n=s.map((([e,s])=>(0,U.jsx)(Ps,{state:e,children:(0,re.ZV)(s)},e)));r.push({label:ts("label_nodes-state"),value:(0,U.jsx)(M.s,{gap:2,children:n})})}const l=(e=>{if((0,Ue.L)(e)&&e.MapDataCenters)return Object.entries(e.MapDataCenters).map((([e,s])=>(0,U.jsxs)(t.Fragment,{children:[e,": ",(0,re.ZV)(s)]},e)))})(e);return null!==l&&void 0!==l&&l.length&&r.push({label:ts("label_dc"),value:(0,U.jsx)(es,{tags:l,gap:2,className:As("dc")})}),r.push({label:ts("label_load"),value:(0,U.jsx)(Gs.O,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null!==(n=null===e||void 0===e?void 0:e.RealNumberOfCpus)&&void 0!==n?n:null===e||void 0===e?void 0:e.NumberOfCpus})}),r.push(...s),r},$s=({cluster:e,loading:s,error:n,additionalClusterProps:t={}})=>{const{info:r=[],links:l=[]}=t,a=Ms(),o=l.concat(a),i=Bs(null!==e&&void 0!==e?e:{},r);return(0,U.jsxs)("div",{className:As(),children:[n?(0,U.jsx)(_.o,{error:n,className:As("error")}):null,s?(0,U.jsx)(Ls.y,{className:As("skeleton"),rows:4}):(0,U.jsxs)(M.s,{gap:10,wrap:"nowrap",children:[n&&!e?null:(0,U.jsxs)("div",{children:[(0,U.jsx)("div",{className:As("section-title"),children:ts("title_info")}),(0,U.jsx)(z.u,{nameMaxWidth:200,children:i.map((({label:e,value:s})=>(0,U.jsx)(z.u.Item,{name:e,children:s},e)))})]}),o.length?(0,U.jsxs)("div",{children:[(0,U.jsx)("div",{className:As("section-title"),children:ts("title_links")}),(0,U.jsx)(M.s,{direction:"column",gap:4,children:o.map((({title:e,url:s})=>(0,U.jsx)(P.K,{title:e,url:s},e)))})]}):null]})]})};var Us=n(87842);const Fs=(0,g.cn)("ydb-cluster");function Ws({additionalClusterProps:e,additionalTenantsProps:s,additionalNodesProps:n}){const g=t.useRef(null),b=(0,h.fp)(),y=(0,j.YQ)(),C=function(){const e=(0,j.YQ)(),s=(0,j.N4)((e=>e.cluster.defaultClusterTab)),n=(0,o.W5)(v.Ay.cluster),{activeTab:r}=(null===n||void 0===n?void 0:n.params)||{};let l;l=(0,Us.eC)(r)?r:s;return t.useEffect((()=>{l!==s&&e((0,m.Yv)(l))}),[l,s,e]),l}(),[{clusterName:w,backend:k}]=(0,i.useQueryParams)({clusterName:i.StringParam,backend:i.StringParam}),T=(0,j.N4)((e=>(0,m.zR)(e,null!==w&&void 0!==w?w:void 0))),{title:S}=(0,m.Zd)(),_=null!==S&&void 0!==S?S:T,{data:{clusterData:E,groupsStats:V}={},isLoading:O,error:D}=m.Zh.useGetClusterInfoQuery(null!==w&&void 0!==w?w:void 0),L=D&&"object"===typeof D?D:void 0,A=(0,j.N4)((e=>(0,m.ds)(e,null!==w&&void 0!==w?w:void 0)));t.useEffect((()=>{y((0,p.g)("cluster",{}))}),[y]);const z=t.useMemo((()=>Us.bn.find((({id:e})=>e===C))),[C]);return(0,U.jsxs)("div",{className:Fs(),ref:g,children:[(0,U.jsx)(a.mg,{defaultTitle:`${_} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${_} \u2014 YDB Monitoring`,children:z?(0,U.jsx)("title",{children:z.title}):null}),(0,U.jsx)("div",{className:Fs("header"),children:O?(0,U.jsx)(r.E,{className:Fs("title-skeleton")}):(0,U.jsx)(c.c,{size:"m",status:null===E||void 0===E?void 0:E.Overall,name:_,className:Fs("title")})}),(0,U.jsx)("div",{className:Fs("sticky-wrapper"),children:(0,U.jsx)(d.E,{className:Fs("auto-refresh-control")})}),b&&(0,U.jsx)(Vs,{cluster:null!==E&&void 0!==E?E:{},groupStats:V,loading:O,error:L||(null===E||void 0===E?void 0:E.error)}),(0,U.jsx)("div",{className:Fs("tabs-sticky-wrapper"),children:(0,U.jsx)(l.t,{size:"l",allowNotSelected:!0,activeTab:C,items:Us.bn,wrapTo:({id:e},s)=>{const n=(0,Us.a)(e,{clusterName:w,backend:k});return(0,U.jsx)(u.E,{to:n,onClick:()=>{y((0,m.Yv)(e))},children:s},e)}})}),(0,U.jsxs)(o.dO,{children:[(0,U.jsx)(o.qh,{path:(0,v.a3)((0,Us.a)(Us.Bi.overview)).pathname,children:(0,U.jsx)($s,{cluster:E,loading:O,error:L,additionalClusterProps:e})}),(0,U.jsx)(o.qh,{path:(0,v.a3)((0,Us.a)(Us.Bi.tablets)).pathname,children:(0,U.jsx)(f.Q,{loading:O,tablets:A})}),(0,U.jsx)(o.qh,{path:(0,v.a3)((0,Us.a)(Us.Bi.tenants)).pathname,children:(0,U.jsx)(de,{additionalTenantsProps:s})}),(0,U.jsx)(o.qh,{path:(0,v.a3)((0,Us.a)(Us.Bi.nodes)).pathname,children:(0,U.jsx)(x.G,{parentRef:g,additionalNodesProps:n})}),(0,U.jsx)(o.qh,{path:(0,v.a3)((0,Us.a)(Us.Bi.storage)).pathname,children:(0,U.jsx)(N.z,{parentRef:g})}),(0,U.jsx)(o.qh,{path:(0,v.a3)((0,Us.a)(Us.Bi.versions)).pathname,children:(0,U.jsx)(Qe,{cluster:E,loading:O})}),(0,U.jsx)(o.qh,{render:()=>(0,U.jsx)(o.rd,{to:(0,v.a3)((0,Us.a)(C))})})]})]})}},42655:(e,s,n)=>{n.d(s,{y:()=>c});var t=n(59284),r=n(89169),l=n(77506),a=n(66781),o=n(60712);const i=(0,l.cn)("ydb-info-viewer-skeleton"),d=()=>(0,o.jsxs)("div",{className:i("label"),children:[(0,o.jsx)(r.E,{className:i("label__text")}),(0,o.jsx)("div",{className:i("label__dots")})]}),c=({rows:e=8,className:s,delay:n=600})=>{const[l]=(0,a.y)(n);let c=(0,o.jsxs)(t.Fragment,{children:[(0,o.jsx)(d,{}),(0,o.jsx)(r.E,{className:i("value")})]});return l||(c=null),(0,o.jsx)("div",{className:i(null,s),children:[...new Array(e)].map(((e,s)=>(0,o.jsx)("div",{className:i("row"),children:c},`skeleton-row-${s}`)))})}},70043:(e,s,n)=>{n.d(s,{E:()=>a});var t=n(89169),r=n(66781),l=n(60712);const a=({delay:e=600,className:s})=>{const[n]=(0,r.y)(e);return n?(0,l.jsx)(t.E,{className:s}):null}}}]);