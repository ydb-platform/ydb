"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[4905],{28539:(e,t,a)=>{a.d(t,{T:()=>s.T});var s=a(53755)},52248:(e,t,a)=>{a.d(t,{a:()=>s.a});var s=a(47334)},56735:(e,t,a)=>{a.d(t,{Q:()=>j});var s=a(87184),i=a(92459),n=a(7435),l=a(46549),d=a(77506),o=a(56839),r=a(31684),c=a(12888),u=a(18863),v=a(25196),p=a(15132),h=a(33775),m=a(48372);const b=JSON.parse('{"type":"Type","path":"Path","guid":"GUID","serial-number":"Serial Number","shared-with-os":"SharedWithOs","drive-status":"Drive Status","state":"State","device":"Device","realtime":"Realtime","space":"Space","slots":"Slots","log-size":"Log Size","system-size":"System Size","links":"Links","developer-ui":"Developer UI","pdisk-page":"PDisk page","yes":"Yes"}'),g=(0,m.g4)("ydb-pDisk-info",{en:b});var f=a(60712);const x=(0,d.cn)("ydb-pdisk-info");function j({pDisk:e,nodeId:t,withPDiskPageLink:a,className:d}){const m=(0,c.X)(),[b,j,I,k]=function({pDisk:e,nodeId:t,withPDiskPageLink:a,isUserAllowedToMakeChanges:s}){const{PDiskId:d,Path:c,Guid:u,Category:m,Type:b,Device:j,Realtime:I,State:k,SerialNumber:y,TotalSize:N,AllocatedSize:T,StatusV2:w,NumActiveSlots:S,ExpectedSlotCount:D,LogUsedSize:z,LogTotalSize:A,SystemSize:P,SharedWithOs:C}=e||{},E=[];(0,n.f8)(m)&&E.push({label:g("type"),value:b}),(0,n.f8)(c)&&E.push({label:g("path"),value:c}),(0,n.f8)(u)&&E.push({label:g("guid"),value:u}),y&&E.push({label:g("serial-number"),value:y}),(0,n.f8)(C)&&E.push({label:g("shared-with-os"),value:g("yes")});const L=[];(0,n.f8)(w)&&L.push({label:g("drive-status"),value:w}),(0,n.f8)(k)&&L.push({label:g("state"),value:k}),(0,n.f8)(j)&&L.push({label:g("device"),value:(0,f.jsx)(h.k,{status:j})}),(0,n.f8)(I)&&L.push({label:g("realtime"),value:(0,f.jsx)(h.k,{status:I})});const V=[];V.push({label:g("space"),value:(0,f.jsx)(p.O,{value:T,capacity:N,formatValues:o.vX,colorizeProgress:!0})}),(0,n.f8)(S)&&(0,n.f8)(D)&&V.push({label:g("slots"),value:(0,f.jsx)(p.O,{value:S,capacity:D})}),(0,n.f8)(z)&&(0,n.f8)(A)&&V.push({label:g("log-size"),value:(0,f.jsx)(p.O,{value:z,capacity:A,formatValues:o.vX})}),(0,n.f8)(P)&&V.push({label:g("system-size"),value:(0,l.z3)({value:P})});const R=[];if((a||s)&&(0,n.f8)(d)&&(0,n.f8)(t)){const e=(0,i.Ck)(d,t),n=(0,r.ar)({nodeId:t,pDiskId:d});R.push({label:g("links"),value:(0,f.jsxs)("span",{className:x("links"),children:[a&&(0,f.jsx)(v.K,{title:g("pdisk-page"),url:e,external:!1}),s&&(0,f.jsx)(v.K,{title:g("developer-ui"),url:n})]})})}return[E,L,V,R]}({pDisk:e,nodeId:t,withPDiskPageLink:a,isUserAllowedToMakeChanges:m});return(0,f.jsxs)(s.s,{className:d,gap:2,direction:"row",wrap:!0,children:[(0,f.jsxs)(s.s,{direction:"column",gap:2,width:500,children:[(0,f.jsx)(u.z,{info:b,renderEmptyState:()=>null}),(0,f.jsx)(u.z,{info:I,renderEmptyState:()=>null})]}),(0,f.jsxs)(s.s,{direction:"column",gap:2,width:500,children:[(0,f.jsx)(u.z,{info:j,renderEmptyState:()=>null}),(0,f.jsx)(u.z,{info:k,renderEmptyState:()=>null})]})]})}},17594:(e,t,a)=>{a.d(t,{l:()=>r});var s=a(69024),i=a(4557),n=a(77506),l=a(16819),d=a(60712);const o=(0,n.cn)("ydb-resizeable-data-table");function r({columnsWidthLSKey:e,columns:t,settings:a,wrapperClassName:n,...r}){const[c,u]=(0,l.a)(e),v=(0,s.j)(t,c),p={...a,defaultResizeable:!0};return(0,d.jsx)("div",{className:o(null,n),children:(0,d.jsx)(i.Ay,{theme:"yandex-cloud",columns:v,onResize:u,settings:p,...r})})}},80420:(e,t,a)=>{a.d(t,{$:()=>m});var s=a(40336),i=a(63291),n=a(92459),l=a(31684),d=a(12888),o=a(71661),r=a(10508),c=a(25196),u=a(48372);const v=JSON.parse('{"field_links":"Links","context_developer-ui":"Developer UI"}'),p=(0,u.g4)("ydb-tablet-name-wrapper",{en:v});var h=a(60712);function m({tabletId:e,database:t}){const a=(0,d.X)(),u=(0,n.DM)(e,{database:t});return(0,h.jsx)(o.s,{disabled:!a,delayClosing:200,content:(0,h.jsx)(s.u,{responsive:!0,children:(0,h.jsx)(s.u.Item,{name:p("field_links"),children:(0,h.jsx)(c.K,{title:p("context_developer-ui"),url:(0,l._t)(e)})})}),placement:["top","bottom"],behavior:i.m.Immediate,children:(0,h.jsx)(r.c,{name:e.toString(),path:u,hasClipboardButton:!0,showStatus:!1})})}},27775:(e,t,a)=>{a.d(t,{i:()=>l});var s=a(47665),i=a(58267),n=a(60712);function l({state:e}){return(0,n.jsx)(s.J,{theme:(0,i._)(e),children:e})}},13758:(e,t,a)=>{a.r(t),a.d(t,{Node:()=>Te});var s=a(59284),i=a(23871),n=a(44992),l=a(61750),d=a(10755),o=a(67087),r=a(3685),c=a(44508),u=a(87184),v=a(77506),p=a(31684),h=a(88655),m=a(12888);var b=a(18863),g=a(25196),f=a(60712);const x=(0,v.cn)("ydb-pool-usage"),j=e=>{let t="green";return e>60&&e<=80?t="yellow":e>80&&(t="red"),t},I=({data:e={}})=>{const{Threads:t,Name:a="Unknown",Usage:s=0}=e,i=s&&t,n=Math.floor(100*s),l=n>100?100:n;return(0,f.jsxs)("div",{className:x(),children:[(0,f.jsxs)("div",{className:x("info"),children:[(0,f.jsx)("div",{className:x("pool-name"),children:a}),i&&(0,f.jsxs)("div",{className:x("value"),children:[(0,f.jsxs)("div",{className:x("percents"),children:[n<1?"<1":n,"%"]}),(0,f.jsxs)("div",{className:x("threads"),children:["(\xd7",t,")"]})]})]}),(0,f.jsx)("div",{className:x("visual"),children:(0,f.jsx)("div",{className:x("usage-line",{type:j(l)}),style:{width:`${l}%`}})})]})};var k=a(15132),y=a(41826),N=a(48372);const T=JSON.parse('{"database":"Database","uptime":"Uptime","version":"Version","dc":"DC","rack":"Rack","links":"Links","la-interval-1m":"1 min","la-interval-5m":"5 min","la-interval-15m":"15 min","developer-ui":"Developer UI","no-data":"No data","title.common-info":"Common info","title.endpoints":"Endpoints","title.roles":"Roles","title.pools":"Pools","title.load-average":"Load average"}'),w=(0,N.g4)("ydb-node-info",{en:T}),S=(0,v.cn)("full-node-viewer"),D=({node:e,className:t})=>{var a,s,i,n,l;const d=function(e){const t=(0,h.E)();if((0,m.X)()){if(null!==t&&void 0!==t&&t.getNodeRef){const a=t.getNodeRef(e);return a?(0,p.Un)(a):void 0}if(null!==e&&void 0!==e&&e.NodeId){const t=(0,p.Kx)(e.NodeId);return(0,p.Un)(t)}}}(e),o=[];null!==e&&void 0!==e&&null!==(a=e.Tenants)&&void 0!==a&&a.length&&o.push({label:w("database"),value:e.Tenants[0]}),o.push({label:w("version"),value:null===e||void 0===e?void 0:e.Version},{label:w("uptime"),value:(0,f.jsx)(y.p,{StartTime:null===e||void 0===e?void 0:e.StartTime,DisconnectTime:null===e||void 0===e?void 0:e.DisconnectTime})},{label:w("dc"),value:(null===e||void 0===e?void 0:e.DataCenterDescription)||(null===e||void 0===e?void 0:e.DC)}),null!==e&&void 0!==e&&e.Rack&&o.push({label:w("rack"),value:null===e||void 0===e?void 0:e.Rack}),d&&o.push({label:w("links"),value:(0,f.jsx)(g.K,{url:d,title:w("developer-ui")})});const r=null===e||void 0===e||null===(s=e.Endpoints)||void 0===s?void 0:s.map((({Name:e,Address:t})=>({label:e,value:t}))),c=null===e||void 0===e||null===(i=e.LoadAveragePercents)||void 0===i?void 0:i.map(((e,t)=>{return{label:(a=t,[w("la-interval-1m"),w("la-interval-5m"),w("la-interval-15m")][a]),value:(0,f.jsx)(k.O,{value:e,percents:!0,colorizeProgress:!0,capacity:100})};var a}));return e?(0,f.jsx)("div",{className:S(null,t),children:(0,f.jsxs)(u.s,{wrap:!0,gap:4,children:[(0,f.jsxs)(u.s,{direction:"column",gap:2,children:[(0,f.jsx)(b.z,{title:w("title.common-info"),className:S("section"),info:o}),r&&r.length?(0,f.jsx)(b.z,{title:w("title.endpoints"),className:S("section"),info:r}):null]}),(0,f.jsxs)(u.s,{direction:"column",gap:2,children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:S("section-title"),children:w("title.pools")}),(0,f.jsx)("div",{className:S("section",{pools:!0}),children:null===e||void 0===e||null===(n=e.PoolStats)||void 0===n?void 0:n.map(((e,t)=>(0,f.jsx)(I,{data:e},t)))})]}),(0,f.jsx)(b.z,{title:w("title.load-average"),className:S("section",{average:!0}),info:c})]}),e.Roles&&e.Roles.length?(0,f.jsx)(u.s,{direction:"column",gap:2,children:(0,f.jsxs)("div",{className:S("section"),children:[(0,f.jsx)("div",{className:S("section-title"),children:w("title.roles")}),null===e||void 0===e||null===(l=e.Roles)||void 0===l?void 0:l.map((e=>(0,f.jsx)("div",{className:S("role"),children:e},e)))]})}):null]})}):(0,f.jsx)("div",{className:"error",children:w("no-data")})};var z=a(42655),A=a(44294),P=a(58389),C=a(92459),E=a(67028),L=a(40174),V=a(21334),R=a(78034);const q=e=>{var t;if(null===(t=e.SystemStateInfo)||void 0===t||!t.length)return{};const a=e.SystemStateInfo[0];return(0,R.q1)(a)},O=V.F.injectEndpoints({endpoints:e=>({getNodeInfo:e.query({queryFn:async({nodeId:e},{signal:t})=>{try{const a=await window.api.viewer.getNodeInfo(e,{signal:t});return{data:q(a)}}catch(a){return{error:a}}},providesTags:["All"]}),getNodeStructure:e.query({queryFn:async({nodeId:e},{signal:t})=>{try{return{data:await window.api.viewer.getStorageInfo({nodeId:e},{signal:t})}}catch(a){return{error:a}}},providesTags:["All"]})}),overrideExisting:"throw"});var F=a(90182),M=a(99936),U=a(71635),$=a(29819),G=a(905),Q=a.n(G),X=a(52248),K=a(53850),_=a(56839),H=a(27295);const B=(0,K.Mz)((e=>e),(e=>O.endpoints.getNodeStructure.select({nodeId:e}))),W=(0,K.Mz)((e=>e),((e,t)=>B(t)),((e,t)=>t(e).data)),J=(0,K.Mz)(((e,t)=>Number(t)),((e,t)=>W(e,t)),((e,t)=>{const a=null===t||void 0===t?void 0:t.StoragePools,s={};null===a||void 0===a||a.forEach((t=>{const a=t.Groups;null===a||void 0===a||a.forEach((a=>{var i;const n=null===(i=a.VDisks)||void 0===i?void 0:i.filter((t=>t.NodeId===e)).map(H.WT);null===n||void 0===n||n.forEach((a=>{var i;const n=(0,_.U9)(a.VDiskId),l=null===(i=a.PDisk)||void 0===i?void 0:i.PDiskId;s[String(l)]||(s[String(l)]={vDisks:{},...a.PDisk}),s[String(l)].vDisks[n]={...a,PDiskId:l,NodeId:e,StoragePoolName:t.Name}}))}))}));return Object.keys(s).reduce(((e,t)=>{const a=s[t].vDisks,i=Object.keys(a).reduce(((e,t,s)=>(e.push({...a[t],id:t,order:s}),e)),[]);return e[t]={...s[t],vDisks:i},e}),{})}));var Y=a(112),Z=a(45720),ee=a(4557),te=a(84476),ae=a(99991),se=a(84375),ie=a(33705),ne=a(56735),le=a(33775),de=a(67440),oe=a(54090),re=a(67375),ce=a(7435),ue=a(76086),ve=a(29971);const pe=(0,v.cn)("kv-node-structure");function he({label:e,value:t,className:a}){return(0,f.jsxs)("span",{className:pe("pdisk-title-item",a),children:[e&&(0,f.jsxs)("span",{className:pe("pdisk-title-item-label"),children:[e,":"]}),(0,f.jsx)("span",{className:pe("pdisk-title-item-value"),children:t})]})}const me=(0,v.cn)("kv-node-structure");var be=function(e){return e.slotId="VDiskSlotId",e.VDiskState="VDiskState",e.Size="Size",e.Info="Info",e}(be||{});const ge={VDiskSlotId:"Slot id",VDiskState:"Status",Size:"Size",Info:""};function fe({pDiskId:e,selectedVdiskId:t,nodeId:a,withDeveloperUILink:s}){return[{name:be.slotId,header:ge[be.slotId],width:100,render:({row:i})=>{const n=i.VDiskSlotId;let l=null;return(0,ce.f8)(a)&&(0,ce.f8)(e)&&(0,ce.f8)(n)&&(l=(0,p.Wg)({nodeId:a,pDiskId:e,vDiskSlotId:n})),(0,f.jsxs)("div",{className:me("vdisk-id",{selected:i.id===t}),children:[(0,f.jsx)("span",{children:n}),l&&s?(0,f.jsx)(te.$,{size:"s",className:me("external-button",{hidden:!0}),href:l,target:"_blank",title:(0,ve.A)("vdisk.developer-ui-button-title"),children:(0,f.jsx)(ae.I,{data:Y.A})}):null]})},align:ee.Ay.LEFT},{name:be.VDiskState,header:ge[be.VDiskState],width:70,render:({row:e})=>(0,f.jsx)(le.k,{status:e.VDiskState===re.W.OK?oe.m.Green:oe.m.Red}),sortAccessor:e=>e.VDiskState===re.W.OK?1:0,align:ee.Ay.CENTER},{name:be.Size,header:ge[be.Size],width:170,render:({row:e})=>(0,f.jsx)(k.O,{value:e.AllocatedSize,capacity:Number(e.AllocatedSize)+Number(e.AvailableSize),formatValues:_.vX,colorizeProgress:!0}),sortAccessor:e=>Number(e.AllocatedSize),align:ee.Ay.CENTER},{name:be.Info,header:ge[be.Info],width:70,render:({row:e})=>(0,f.jsx)(se.A,{placement:["right"],content:(0,f.jsx)(de.E,{data:e,withTitle:!0,withVDiskPageLink:!0}),tooltipContentClassName:me("vdisk-details"),children:(0,f.jsx)(te.$,{view:"flat-secondary",className:me("vdisk-details-button",{selected:e.id===t}),children:(0,f.jsx)(ae.I,{data:Z.A,size:18})})}),sortable:!1}]}function xe({id:e,data:t,selectedVdiskId:a,nodeId:i,unfolded:n}){const l=(0,m.X)(),[d,o]=s.useState(null!==n&&void 0!==n&&n),{TotalSize:r=0,AvailableSize:c=0,Device:u,PDiskId:v,Type:p,vDisks:h}=t,b=Number(r),g=Number(c);return(0,f.jsxs)("div",{className:me("pdisk"),id:e,children:[(0,f.jsxs)("div",{className:me("pdisk-header"),children:[(0,f.jsxs)("div",{className:me("pdisk-title-wrapper"),children:[(0,f.jsx)(le.k,{status:u}),(0,f.jsx)(he,{label:"PDiskID",value:v,className:me("pdisk-title-id")}),(0,f.jsx)(he,{value:p,className:me("pdisk-title-type")}),(0,f.jsx)(k.O,{value:b-g,capacity:b,formatValues:_.vX,colorizeProgress:!0,className:me("pdisk-title-size")}),(0,f.jsx)(he,{label:"VDisks",value:h.length})]}),(0,f.jsx)(te.$,{onClick:d?()=>{o(!1)}:()=>{o(!0)},view:"flat-secondary",children:(0,f.jsx)(ie.I,{direction:d?"top":"bottom"})})]}),d&&(Q()(t)?(0,f.jsx)("div",{children:"No information about PDisk"}):(0,f.jsxs)("div",{children:[(0,f.jsx)(ne.Q,{pDisk:t,nodeId:i,className:me("pdisk-details"),withPDiskPageLink:!0}),(0,f.jsxs)("div",{className:me("vdisks-container"),children:[(0,f.jsx)("div",{className:me("vdisks-header"),children:"VDisks"}),(0,f.jsx)(ee.Ay,{theme:"yandex-cloud",data:h,columns:fe({nodeId:i,pDiskId:v,selectedVdiskId:a,withDeveloperUILink:l}),settings:{...ue.N3,dynamicRender:!1},rowClassName:e=>e.id===a?me("selected-vdisk"):""})]})]}))]})}const je=(0,v.cn)("kv-node-structure");function Ie({type:e,id:t}){return`${e}-${t}`}const ke=function({nodeId:e,className:t}){const a=(0,F.N4)((t=>J(t,e))),[i]=(0,F.Nt)(),{currentData:n,isFetching:l,error:d}=O.useGetNodeStructureQuery({nodeId:e},{pollingInterval:i}),r=l&&void 0===n,[{pdiskId:u,vdiskId:v}]=(0,o.useQueryParams)({pdiskId:o.StringParam,vdiskId:o.StringParam}),p=s.useRef(null),h=s.useRef(!1);return s.useEffect((()=>{if(!Q()(a)&&!h.current&&p.current&&u){const t=document.getElementById(Ie({type:"pdisk",id:u}));let s=0;if(v){var e;const t=null===(e=a[u])||void 0===e?void 0:e.vDisks,i=null===t||void 0===t?void 0:t.find((e=>e.id===v)),n=i?document.querySelector(".data-table"):void 0,l=(null===i||void 0===i?void 0:i.order)||0;n&&(s+=n.offsetTop+40*l)}t&&(p.current.scrollTo({behavior:"smooth",top:s||t.offsetTop}),h.current=!0)}}),[a,u,v]),(0,f.jsxs)("div",{className:je(),ref:p,children:[d?(0,f.jsx)(c.o,{error:d,className:je("error")}):null,(0,f.jsx)("div",{className:t,children:r?(0,f.jsx)(X.a,{size:"m"}):d&&!n?null:(()=>{const t=Object.keys(a);return t.length>0?t.map((t=>(0,f.jsx)(xe,{data:a[t],id:Ie({type:"pdisk",id:t}),unfolded:u===t,selectedVdiskId:v,nodeId:e},t))):"There is no information about node structure."})()})]})},ye=(0,v.cn)("node"),Ne="Storage";function Te(){var e,t;const a=s.useRef(null),i=(0,F.YQ)(),l=(0,d.W5)(C.Ay.node),r=null===l||void 0===l?void 0:l.params.id,u=null===l||void 0===l?void 0:l.params.activeTab,[{database:v}]=(0,o.useQueryParams)($.Gi),p=$.IK.parse(u),[h]=(0,F.Nt)(),m=r?{nodeId:r}:n.hT,{currentData:b,isLoading:g,error:x}=O.useGetNodeInfoQuery(m,{pollingInterval:h}),j=(0,E.Pm)(),I=(0,E.c2)(),k=g||!j,y=null===b||void 0===b||null===(e=b.Roles)||void 0===e?void 0:e.find((e=>e===Ne)),{activeTab:N,nodeTabs:T}=s.useMemo((()=>{var e;let t=y?$.GX:$.GX.filter((e=>"storage"!==e.id));I&&(t=t.filter((e=>"structure"!==e.id)));return{activeTab:null!==(e=t.find((({id:e})=>e===p)))&&void 0!==e?e:t[0],nodeTabs:t}}),[y,I,p]),w=(null===b||void 0===b||null===(t=b.Tenants)||void 0===t?void 0:t[0])||(null===v||void 0===v?void 0:v.toString());return s.useEffect((()=>{g||i((0,L.g)("node",{tenantName:w,nodeRole:y?"Storage":"Compute",nodeId:r}))}),[i,w,r,g,y]),(0,f.jsxs)("div",{className:ye(null),ref:a,children:[(0,f.jsx)(we,{node:b,activeTabTitle:N.title}),(0,f.jsx)(Se,{node:b,loading:k}),(0,f.jsx)(De,{node:b}),x?(0,f.jsx)(c.o,{error:x,className:ye("error")}):null,(0,f.jsx)(ze,{node:b,loading:k}),r?(0,f.jsx)(Ae,{nodeId:r,tenantName:w,activeTabId:N.id,tabs:T,parentContainer:a}):null]})}function we({node:e,activeTabTitle:t}){const a=null!==e&&void 0!==e&&e.Host?e.Host:(0,ve.A)("node");return(0,f.jsx)(l.mg,{titleTemplate:`%s \u2014 ${a} \u2014 YDB Monitoring`,defaultTitle:`${a} \u2014 YDB Monitoring`,children:(0,f.jsx)("title",{children:t})})}function Se({node:e,loading:t}){const a=null!==e&&void 0!==e&&e.Host?`${(0,ve.A)("fqdn")}: ${e.Host}`:void 0,s=null!==e&&void 0!==e&&e.DC?`${(0,ve.A)("dc")}: ${e.DC}`:void 0;return(0,f.jsx)(P.B,{loading:t,items:[a,s],className:ye("meta")})}function De({node:e}){return(0,f.jsx)(r.$,{entityName:(0,ve.A)("node"),status:null===e||void 0===e?void 0:e.SystemState,id:null===e||void 0===e?void 0:e.NodeId,className:ye("title")})}function ze({node:e,loading:t}){return t?(0,f.jsx)(z.y,{className:ye("info"),rows:10}):(0,f.jsx)(D,{node:e,className:ye("info")})}function Ae({nodeId:e,tenantName:t,activeTabId:a,tabs:n,parentContainer:l}){return(0,f.jsxs)(s.Fragment,{children:[(0,f.jsx)("div",{className:ye("tabs"),children:(0,f.jsx)(i.t,{size:"l",items:n,activeTab:a,wrapTo:({id:a},s)=>{const i=(0,$.vI)(e,{database:t},a);return(0,f.jsx)(A.E,{to:i,children:s},a)}})}),(()=>{switch(a){case"storage":return(0,f.jsx)(M.z,{nodeId:e,parentRef:l,viewContext:{nodeId:e}});case"tablets":return(0,f.jsx)(U.C,{nodeId:e,database:t});case"structure":return(0,f.jsx)(ke,{nodeId:e});default:return!1}})()]})}},71635:(e,t,a)=>{a.d(t,{C:()=>g});var s=a(44992),i=a(53850),n=a(62060),l=a.n(n),d=a(21334),o=a(24600);const r=d.F.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.viewer.getTabletsInfo(e,{signal:t})}}catch(a){return{error:a}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),c=(0,i.Mz)((e=>e),(e=>r.endpoints.getTabletsInfo.select(e)),{argsMemoize:i.i5,argsMemoizeOptions:{equalityCheck:l()}}),u=(0,i.Mz)((e=>e),((e,t)=>c(t)),((e,t)=>t(e).data)),v=(0,i.Mz)(((e,t)=>u(e,t)),(e=>(0,o.K)(e)),((e,t)=>null!==e&&void 0!==e&&e.TabletStateInfo?t?e.TabletStateInfo.map((e=>{var a;const s=void 0===e.NodeId||null===(a=t.get(e.NodeId))||void 0===a?void 0:a.Host;return{...e,fqdn:s}})):e.TabletStateInfo:[]));var p=a(7435),h=a(90182),m=a(88616),b=a(60712);function g({nodeId:e,path:t,database:a}){const[i]=(0,h.Nt)();let n={};(0,p.f8)(e)?n={nodeId:e,database:a}:t&&(n={path:t,database:a});const{isLoading:l,error:d}=r.useGetTabletsInfoQuery(0===Object.keys(n).length?s.hT:n,{pollingInterval:i}),o=(0,h.N4)((e=>v(e,n)));return(0,b.jsx)(m.Q,{tablets:o,database:a,loading:l,error:d})}},88616:(e,t,a)=>{a.d(t,{Q:()=>z});var s=a(59284),i=a(76938),n=a(98089),l=a(99991),d=a(67087),o=a(22983),r=a(28539),c=a(10508),u=a(44508),v=a(44294),p=a(17594),h=a(41775),m=a(89073),b=a(80420),g=a(27775),f=a(41826),x=a(21545),j=a(6354),I=a(76086),k=a(12888),y=a(29819),N=a(48372);const T=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill-header":"Restart tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet","controls.search-placeholder":"Tablet ID","controls.entities-count-label":"Tablets"}'),w=(0,N.g4)("ydb-tablets",{en:T});var S=a(60712);function D(e){const t=e.State===j.r.Stopped,a=(0,k.X)(),[s]=x.X.useKillTabletMutation(),n=e.TabletId;return n?(0,S.jsx)(o.B,{buttonView:"outlined",buttonTitle:w("dialog.kill-header"),dialogHeader:w("dialog.kill-header"),dialogText:w("dialog.kill-text"),onConfirmAction:()=>s({id:n}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:w(a?"dialog.kill-header":"controls.kill-not-allowed"),popoverPlacement:["right","auto"],popoverDisabled:!1,children:(0,S.jsx)(l.I,{data:i.A})}):null}function z({database:e,tablets:t,loading:a,error:i}){const[{tabletsSearch:l},o]=(0,d.useQueryParams)({tabletsSearch:d.StringParam}),x=s.useMemo((()=>function({database:e}){return[{name:"Type",width:150,get header(){return w("Type")},render:({row:e})=>{const t=!1===e.Leader;return(0,S.jsxs)("span",{children:[e.Type," ",t?(0,S.jsx)(n.E,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return w("Tablet")},render:({row:t})=>t.TabletId?(0,S.jsx)(b.$,{tabletId:t.TabletId,database:e}):I.Pd},{name:"State",get header(){return w("State")},render:({row:e})=>(0,S.jsx)(g.i,{state:e.State})},{name:"NodeId",get header(){return w("Node ID")},render:({row:e})=>{const t=void 0===e.NodeId?void 0:(0,y.vI)(e.NodeId);return(0,S.jsx)(v.E,{to:t,children:e.NodeId})},align:"right"},{name:"fqdn",get header(){return w("Node FQDN")},render:({row:e})=>e.fqdn?(0,S.jsx)(c.c,{name:e.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,S.jsx)("span",{children:"\u2014"})},{name:"Generation",get header(){return w("Generation")},align:"right"},{name:"Uptime",get header(){return w("Uptime")},render:({row:e})=>(0,S.jsx)(f.H,{ChangeTime:e.ChangeTime}),sortAccessor:e=>-Number(e.ChangeTime),align:"right",width:120},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:({row:e})=>(0,S.jsx)(D,{...e})}]}({database:e})),[e]),j=s.useMemo((()=>t.filter((e=>String(e.TabletId).includes(null!==l&&void 0!==l?l:"")))),[t,l]);return(0,S.jsxs)(m.L,{children:[(0,S.jsxs)(m.L.Controls,{children:[(0,S.jsx)(h.v,{placeholder:w("controls.search-placeholder"),onChange:e=>{o({tabletsSearch:e||void 0},"replaceIn")},value:null!==l&&void 0!==l?l:"",width:238}),(0,S.jsx)(r.T,{label:w("controls.entities-count-label"),loading:a,total:t.length,current:j.length})]}),i?(0,S.jsx)(u.o,{error:i}):null,(0,S.jsx)(m.L.Table,{loading:a,children:(0,S.jsx)(p.l,{columns:x,data:j,settings:I.N3,emptyDataMessage:w("noTabletsData")})})]})}},21545:(e,t,a)=>{a.d(t,{X:()=>i});var s=a(78034);const i=a(21334).F.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async({id:e,database:t},{signal:a})=>{try{const[i,n,l]=await Promise.all([window.api.viewer.getTablet({id:e,database:t},{signal:a}),window.api.viewer.getTabletHistory({id:e,database:t},{signal:a}),window.api.viewer.getNodesList({signal:a})]),d=(0,s.nN)(l),o=Object.keys(n).reduce(((e,t)=>{var a;const s=null===(a=n[t])||void 0===a?void 0:a.TabletStateInfo;if(s&&s.length){var i;const a=s.find((e=>e.Leader))||s[0],{ChangeTime:n,Generation:l,State:o,Leader:r,FollowerId:c}=a,u=d&&t?null===(i=d.get(Number(t)))||void 0===i?void 0:i.Host:void 0;"Dead"!==o&&e.push({nodeId:t,generation:l,changeTime:n,state:o,leader:r,followerId:c,fqdn:u})}return e}),[]),{TabletStateInfo:r=[]}=i,[c={}]=r,{TabletId:u}=c;return{data:{id:u,data:c,history:o}}}catch(i){return{error:i}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async({tenantId:e},{signal:t})=>{try{const a=await window.api.viewer.getTabletDescribe(e,{signal:t}),{SchemeShard:s,PathId:i}=e;return{data:(null===a||void 0===a?void 0:a.Path)||`${s}:${i}`}}catch(a){return{error:a}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async({id:e,hiveId:t},{signal:a})=>{try{return{data:await window.api.tablets.getTabletFromHive({id:e,hiveId:t},{signal:a})}}catch(s){return{error:s}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async({id:e})=>{try{return{data:await window.api.tablets.killTablet(e)}}catch(t){return{error:t}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.stopTablet(e,t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.resumeTablet(e,t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})},76938:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(59284);const i=e=>s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),s.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 1.5a6.5 6.5 0 1 1-6.445 7.348.75.75 0 1 1 1.487-.194A5.001 5.001 0 1 0 4.43 4.5h1.32a.75.75 0 0 1 0 1.5h-3A.75.75 0 0 1 2 5.25v-3a.75.75 0 0 1 1.5 0v1.06A6.48 6.48 0 0 1 8 1.5",clipRule:"evenodd"}))}}]);