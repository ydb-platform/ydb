"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[5022],{41919:(e,t,r)=>{r.d(t,{Q:()=>d});var n=r(39683),s=r(17176),a=r(88776),l=r(24362),o=r(75859);const i=(0,l.cn)("developer-ui-link-button");function d(e){let{href:t,visible:r=!1,className:l}=e;return(0,o.jsx)(s.z,{size:"s",href:t,className:i({visible:r},l),target:"_blank",children:(0,o.jsx)(a.J,{data:n.Z})})}},49201:(e,t,r)=>{r.d(t,{C:()=>i});var n=r(14979),s=r(24362);const a=(0,r(30817).wZ)("ydb-entities-count",{ru:{of:"\u0438\u0437"},en:{of:"of"}});var l=r(75859);const o=(0,s.cn)("ydb-entities-count"),i=e=>{let{total:t,current:r,label:s,loading:i,className:d}=e,u="";return s&&(u+="".concat(s,": ")),i?u+="...":(u+="".concat(r),t&&Number(t)!==Number(r)&&(u+=" ".concat(a("of")," ").concat(t))),(0,l.jsx)(n._,{theme:"info",size:"m",className:o(null,d),children:u})}},62776:(e,t,r)=>{r.d(t,{a:()=>n.a});var n=r(91173)},89778:(e,t,r)=>{r.d(t,{k:()=>h});var n=r(10502),s=r(92398),a=r(48169),l=r(51688),o=r(99683),i=r(41919),d=r(69214),u=r(27506),c=r(75859);const h=e=>{let{node:t,getNodeRef:r,database:h}=e;if(!t.Host)return(0,c.jsx)("span",{children:"\u2014"});const m=!(0,l.TA)(t);let p;r?p=r(t)+"internal":t.NodeId&&(p=(0,a.wq)(t.NodeId)+"internal");const g=m?(0,s.a3)(t.NodeId,{tenantName:null!==h&&void 0!==h?h:t.TenantName}):void 0,v=p?(0,c.jsx)(i.Q,{href:p}):null;return(0,c.jsx)(o.l,{disabled:!m,content:(0,c.jsx)(u.bP,{data:t}),placement:["top","bottom"],behavior:n.x.Immediate,children:(0,c.jsx)(d.A,{name:t.Host,status:t.SystemState,path:g,hasClipboardButton:!0,additionalControls:v})})}},11635:(e,t,r)=>{r.d(t,{WQ:()=>G});var n=r(68963),s=r(5922),a=r(47101);const l=r(905).h.injectEndpoints({endpoints:function(e){return{fetchTableChunk:e.query({queryFn:async(e,t)=>{let{offset:r,limit:n,sortParams:s,filters:a,fetchData:l}=e,{signal:o}=t;try{return{data:await l({limit:n,offset:r,filters:a,sortParams:s,signal:o})}}catch(i){return{error:i}}},providesTags:["All"]})}}});var o=r(17096),i=r(26688),d=r(56711);const u="left",c=!0,h=-1,m=40;const p=(0,r(24362).cn)("ydb-paginated-table");var g=r(75859);const v=e=>{let{children:t,className:r,height:n,width:s,align:a=u,resizeable:l}=e;return(0,g.jsx)("td",{className:p("row-cell",{align:a},r),style:{height:"".concat(n,"px"),width:"".concat(s,"px"),maxWidth:l?"".concat(s,"px"):void 0},children:t})},f=e=>{let{index:t,columns:r,height:n}=e;return(0,g.jsx)("tr",{className:p("row",{loading:!0}),children:r.map((e=>{var r;const s=null!==(r=e.resizeable)&&void 0!==r?r:c;return(0,g.jsx)(v,{height:n,width:e.width,align:e.align,className:e.className,resizeable:s,children:(0,g.jsx)(d.O,{style:{width:"80%",height:"50%"}})},"".concat(e.name).concat(t))}))})},b=e=>{let{row:t,index:r,columns:n,getRowClassName:s,height:a}=e;const l=null===s||void 0===s?void 0:s(t);return(0,g.jsx)("tr",{className:p("row",l),children:n.map((e=>{var n;const s=null!==(n=e.resizeable)&&void 0!==n?n:c;return(0,g.jsx)(v,{height:a,width:e.width,align:e.align,className:e.className,resizeable:s,children:e.render({row:t,index:r})},"".concat(e.name).concat(r))}))})},w=e=>{let{columns:t,children:r}=e;return(0,g.jsx)("tr",{className:p("row",{empty:!0}),children:(0,g.jsx)("td",{colSpan:t.length,className:p("td"),children:r})})},x=e=>{var t;let{id:r,limit:a,rowHeight:d,columns:u,fetchData:c,tableName:h,filters:m,sortParams:p,observer:v,getRowClassName:x,renderErrorMessage:N,onDataFetched:j,isActive:y}=e;const S=n.useRef(null),[C,E]=n.useState(!0),[O]=(0,o.Rj)(),I={offset:r*a,limit:a,fetchData:c,filters:m,sortParams:p,tableName:h};l.useFetchTableChunkQuery(I,{skip:C||!y,pollingInterval:O});const{currentData:A,error:F}=l.endpoints.fetchTableChunk.useQueryState(I);n.useEffect((()=>{let e=0;return y&&C&&(e=window.setTimeout((()=>{E(!1)}),200)),()=>{window.clearTimeout(e)}}),[y,C]),n.useEffect((()=>{const e=S.current;return e&&v.observe(e),()=>{e&&v.unobserve(e)}}),[v]),n.useEffect((()=>{if(A&&y){const{total:e=0,found:t=0}=A;j(e,t)}}),[A,y,j]);const U=(null===A||void 0===A||null===(t=A.data)||void 0===t?void 0:t.length)||a,G=U?U*d:a*d;return(0,g.jsx)("tbody",{ref:S,id:r.toString(),style:{height:"".concat(G,"px"),display:y?"table-row-group":"block"},children:(()=>{if(!y)return null;if(!A){if(F){const e=F;return(0,g.jsx)(w,{columns:u,children:N?N(e):(0,g.jsx)(i.V,{error:e})})}return(0,s.c$)(U).map((e=>(0,g.jsx)(f,{columns:u,height:d,index:e},e)))}return A.data.map(((e,t)=>(0,g.jsx)(b,{index:t,row:e,columns:u,height:d,getRowClassName:x},t)))})()})};function N(e){let{minWidth:t,maxWidth:r,getCurrentColumnWidth:s,onResize:a}=e;const l=n.useRef(null),[o,i]=n.useState(!1);return n.useEffect((()=>{const e=l.current;if(!e)return;let n,o,d;const u=function(e){let t,r=null;return function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];t=s,"number"!==typeof r&&(r=requestAnimationFrame((()=>{e(...t),r=null})))}}((e=>{if(j(e),"number"!==typeof n||"number"!==typeof o)return;const s=e.clientX-n,l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return Math.max(t,Math.min(e,r))}(o+s,t,r);l!==d&&(d=l,null===a||void 0===a||a(d))})),c=e=>{j(e),void 0!==d&&(null===a||void 0===a||a(d)),i(!1),n=void 0,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)},h=e=>{o=s(),j(e),n=e.clientX,i(!0),document.addEventListener("mousemove",u),document.addEventListener("mouseup",c)};return e.addEventListener("mousedown",h),()=>{e.removeEventListener("mousedown",h),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)}}),[a,t,r,s]),(0,g.jsx)("span",{ref:l,className:p("resize-handler",{resizing:o}),onClick:e=>j(e)})}function j(e){e.preventDefault(),e.stopPropagation()}const y=e=>{let{order:t}=e;return(0,g.jsx)("svg",{className:p("sort-icon",{desc:-1===t}),viewBox:"0 0 10 6",width:"10",height:"6",children:(0,g.jsx)("path",{fill:"currentColor",d:"M0 5h10l-5 -5z"})})},S=e=>{let{sortOrder:t,sortable:r,defaultSortOrder:n}=e;return r?(0,g.jsx)("span",{className:p("sort-icon-container",{shadow:!t}),children:(0,g.jsx)(y,{order:t||n})}):null},C=e=>{var t;let{column:r,resizeable:s,sortOrder:a,defaultSortOrder:l,onSort:o,rowHeight:i,onCellMount:d,onCellUnMount:u,onColumnsResize:c}=e;const h=n.useRef(null);n.useEffect((()=>{const e=h.current;return e&&(null===d||void 0===d||d(e)),()=>{e&&(null===u||void 0===u||u(e))}}),[d,u]);const m=n.useCallback((()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.getBoundingClientRect().width}),[]),v=n.useCallback((e=>{null===c||void 0===c||c(r.name,e)}),[c,r.name]),f=null!==(t=r.header)&&void 0!==t?t:r.name,b={height:"".concat(i,"px"),width:"".concat(r.width,"px"),minWidth:s?"".concat(r.width,"px"):void 0,maxWidth:s?"".concat(r.width,"px"):void 0};return(0,g.jsxs)("th",{ref:h,className:p("head-cell-wrapper"),style:b,children:[(0,g.jsxs)("div",{className:p("head-cell",{align:r.align,sortable:r.sortable},r.className),onClick:()=>{r.sortable&&(null===o||void 0===o||o(r.name))},children:[(0,g.jsx)("div",{className:p("head-cell-content"),children:f}),(0,g.jsx)(S,{sortOrder:a,sortable:r.sortable,defaultSortOrder:l})]}),s?(0,g.jsx)(N,{maxWidth:r.resizeMaxWidth,minWidth:r.resizeMinWidth,getCurrentColumnWidth:m,onResize:v}):null]})},E=e=>{let{columns:t,onSort:r,onColumnsResize:s,defaultSortOrder:a=h,rowHeight:l=m}=e;const[o,i]=n.useState({}),d=e=>{let t={};if(e===o.columnId){if(o.sortOrder&&o.sortOrder!==a)return i(t),void(null===r||void 0===r||r(t));t={sortOrder:1===o.sortOrder?-1:1,columnId:e}}else t={sortOrder:a,columnId:e};null===r||void 0===r||r(t),i(t)};return(0,g.jsxs)(n.Fragment,{children:[(0,g.jsx)("colgroup",{children:t.map((e=>(0,g.jsx)("col",{style:{width:"".concat(e.width,"px")}},e.name)))}),(0,g.jsx)("thead",{className:p("head"),children:(0,g.jsx)("tr",{children:t.map((e=>{var t;const r=o.columnId===e.name?o.sortOrder:void 0,n=s&&(null!==(t=e.resizeable)&&void 0!==t?t:c);return(0,g.jsx)(C,{column:e,resizeable:n,sortOrder:r,defaultSortOrder:a,onSort:d,rowHeight:l,onColumnsResize:s},e.name)}))})})]})};var O=r(30817);const I=JSON.parse('{"empty":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"}'),A=(0,O.wZ)("ydb-paginated-table",{ru:I,en:{empty:"No data"}}),F=e=>{let{limit:t,fetchData:r,filters:l,tableName:o,columns:i,getRowClassName:d,rowHeight:u=m,parentContainer:c,initialSortParams:h,onColumnsResize:v,renderControls:f,renderErrorMessage:b,renderEmptyDataMessage:N,containerClassName:j}=e;const[y,S]=n.useState(h),[C,O]=n.useState(t),[I,F]=n.useState(0),[U,G]=n.useState([]),[D,P]=n.useState(!0),_=n.useRef(null),T=n.useCallback(((e,t)=>{O(e),F(t),P(!1)}),[]),k=(e=>{let{onEntry:t,onLeave:r,parentContainer:s}=e;const a=n.useRef();return n.useEffect((()=>(a.current=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?t(e.target.id):r(e.target.id)}))}),{root:s,rootMargin:"100%"}),()=>{var e;null===(e=a.current)||void 0===e||e.disconnect(),a.current=void 0})),[s,t,r]),a.current})({onEntry:n.useCallback((e=>{G((t=>[...new Set([...t,Number(e)])]))}),[]),onLeave:n.useCallback((e=>{G((t=>t.filter((t=>t!==Number(e)))))}),[]),parentContainer:c});n.useLayoutEffect((()=>{var e;(O(t),F(0),P(!0),c)?c.scrollTo(0,0):null===(e=_.current)||void 0===e||e.scrollTo(0,0);G([0])}),[l,t,c]);const R=()=>{if(!k)return null;if(!D&&0===I)return(0,g.jsx)("tbody",{children:(0,g.jsx)(w,{columns:i,children:N?N():A("empty")})});const e=I||t,n=Math.ceil(e/t);return(0,s.c$)(n).map((e=>(0,g.jsx)(x,{id:e,limit:t,rowHeight:u,columns:i,fetchData:r,filters:l,tableName:o,sortParams:y,getRowClassName:d,renderErrorMessage:b,onDataFetched:T,isActive:U.includes(e),observer:k},e)))},M=()=>(0,g.jsxs)("table",{className:p("table"),children:[(0,g.jsx)(E,{columns:i,onSort:S,onColumnsResize:v}),R()]});return(0,g.jsx)("div",{ref:_,className:p(null,j),children:f?(0,g.jsxs)(a.l,{children:[(0,g.jsx)(a.l.Controls,{children:f({inited:!D,totalEntities:C,foundEntities:I})}),(0,g.jsx)(a.l.Table,{children:M()})]}):M()})};var U=r(89712);function G(e){let{columnsWidthLSKey:t,columns:r,...n}=e;const[s,a]=(0,U.M)(t),l=function(e,t){return e.map((e=>{var r;return{...e,width:null!==(r=t[e.name])&&void 0!==r?r:e.width}}))}(r,s);return(0,g.jsx)(F,{columns:l,onColumnsResize:a,containerClassName:p("resizeable-table-container"),...n})}},30629:(e,t,r)=>{r.d(t,{o:()=>i});var n=r(68963),s=r(77264),a=r(24362),l=r(75859);const o=(0,a.cn)("ydb-search"),i=e=>{let{onChange:t,value:r="",className:a,debounce:i=200,placeholder:d}=e;const[u,c]=n.useState(r),h=n.useRef();n.useEffect((()=>{c((e=>e!==r?r:e))}),[r]);return(0,l.jsx)(s.o,{hasClear:!0,autoFocus:!0,className:o(null,a),placeholder:d,value:u,onUpdate:e=>{c(e),window.clearTimeout(h.current),h.current=window.setTimeout((()=>{null===t||void 0===t||t(e)}),i)}})}},22692:(e,t,r)=>{r.d(t,{h:()=>o});var n=r(56711),s=r(24362),a=r(75859);const l=(0,s.cn)("table-skeleton"),o=e=>{let{rows:t=2,className:r}=e;return(0,a.jsxs)("div",{className:l(null,r),children:[(0,a.jsxs)("div",{className:l("row"),children:[(0,a.jsx)(n.O,{className:l("col-1")}),(0,a.jsx)(n.O,{className:l("col-2")}),(0,a.jsx)(n.O,{className:l("col-3")}),(0,a.jsx)(n.O,{className:l("col-4")}),(0,a.jsx)(n.O,{className:l("col-5")})]}),[...new Array(t)].map(((e,t)=>(0,a.jsx)("div",{className:l("row"),children:(0,a.jsx)(n.O,{className:l("col-full")})},"skeleton-row-".concat(t))))]})}},47101:(e,t,r)=>{r.d(t,{l:()=>o});var n=r(24362),s=r(22692),a=r(75859);const l=(0,n.cn)("ydb-table-with-controls-layout"),o=e=>{let{children:t,className:r}=e;return(0,a.jsx)("div",{className:l(null,r),children:t})};o.Controls=function(e){let{children:t,className:r}=e;return(0,a.jsx)("div",{className:l("controls-wrapper"),children:(0,a.jsx)("div",{className:l("controls",r),children:t})})},o.Table=function(e){let{children:t,loading:r,className:n}=e;return r?(0,a.jsx)(s.h,{className:l("loader")}):(0,a.jsx)("div",{className:l("table",n),children:t})}},43989:(e,t,r)=>{r.d(t,{X:()=>l});var n=r(79734),s=r(51688),a=r(75859);const l=e=>{let{value:t,onChange:r,className:l}=e;return(0,a.jsxs)(n.E,{value:t,onUpdate:r,className:l,children:[(0,a.jsx)(n.E.Option,{value:s.Uu.All,children:s.qU[s.Uu.All]}),(0,a.jsx)(n.E.Option,{value:s.Uu.SmallUptime,children:s.qU[s.Uu.SmallUptime]})]})}},82994:(e,t,r)=>{r.d(t,{V:()=>Me});var n=r(52317),s=r(17096),a=r(52846),l=r(82073),o=r(8747),i=r(95829),d=r(95408);const u=d.z.nativeEnum(i.G).catch(i.G.all),c=d.z.nativeEnum(i.d).catch(i.d.groups);var h=r(51688),m=r(68963),p=r(49201),g=r(30629),v=r(43989),f=r(79734),b=r(75859);const w={[i.d.groups]:"Groups",[i.d.nodes]:"Nodes"},x=e=>{let{value:t,onChange:r}=e;return(0,b.jsxs)(f.E,{value:t,onUpdate:r,qa:"storage-type-filter",children:[(0,b.jsx)(f.E.Option,{value:i.d.groups,children:w[i.d.groups]}),(0,b.jsx)(f.E.Option,{value:i.d.nodes,children:w[i.d.nodes]})]})},N={[i.G.all]:"All",[i.G.missing]:"Degraded",[i.G.space]:"Out of Space"},j=e=>{let{value:t,onChange:r}=e;return(0,b.jsxs)(f.E,{value:t,onUpdate:r,qa:"storage-visible-entities-filter",children:[(0,b.jsx)(f.E.Option,{value:i.G.missing,children:N[i.G.missing]}),(0,b.jsx)(f.E.Option,{value:i.G.space,children:N[i.G.space]}),(0,b.jsx)(f.E.Option,{value:i.G.all,children:N[i.G.all]})]})};var y=r(2418),S=r(69214),C=r(24362),E=r(10703),O=r(30817);const I=JSON.parse('{"label":"Usage:","default_value":"Any","groups_count":["{{count}} group","{{count}} groups","{{count}} groups","No groups"]}'),A=JSON.parse('{"label":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435:","default_value":"\u041b\u044e\u0431\u043e\u0435","groups_count":["{{count}} \u0433\u0440\u0443\u043f\u043f\u0430","{{count}} \u0433\u0440\u0443\u043f\u043f\u044b","{{count}} \u0433\u0440\u0443\u043f\u043f","\u041d\u0435\u0442 \u0433\u0440\u0443\u043f\u043f"]}'),F=(0,O.wZ)("ydb-usage-filter",{ru:A,en:I}),U=(0,C.cn)("usage-filter"),G=e=>{const{className:t,value:r=[],groups:n=[],onChange:s,debounce:a=200}=e,[l,o]=m.useState(r),i=m.useRef();m.useEffect((()=>{o((e=>e.join(",")!==r.join(",")?r:e))}),[r]);const d=m.useMemo((()=>n.map((e=>{let{threshold:t,count:r}=e;return{value:String(t),text:"".concat(t,"%"),data:{count:r}}}))),[n]),u=Math.max(...n.map((e=>{let{count:t}=e;return t})));return(0,b.jsx)(y.P,{className:U(null,t),label:F("label"),value:l,placeholder:F("default_value"),options:d,multiple:!0,onUpdate:e=>{o(e),window.clearTimeout(i.current),i.current=window.setTimeout((()=>{null===s||void 0===s||s(e)}),a)},renderOption:e=>{let{value:t,data:r,text:n}=e;return(0,b.jsxs)("div",{className:U("option"),children:[(0,b.jsx)(S.A,{className:U("option-title"),status:(0,E.CZ)(Number(t)),name:n,size:"xs"}),(0,b.jsxs)("div",{className:U("option-meta"),children:[F("groups_count",{count:r.count}),(0,b.jsx)("div",{className:U("option-bar"),style:{width:"".concat(r.count/u*100,"%")}})]})]})},getOptionHeight:()=>50,popupWidth:280,disabled:0===n.length})},D=JSON.parse('{"groups":"Groups","nodes":"Nodes","controls_groups-search-placeholder":"Group ID, Pool name","controls_nodes-search-placeholder":"Node ID, FQDN"}'),P=JSON.parse('{"groups":"\u0413\u0440\u0443\u043f\u043f\u044b","nodes":"\u041d\u043e\u0434\u044b","controls_groups-search-placeholder":"ID \u0433\u0440\u0443\u043f\u043f\u044b, \u0438\u043c\u044f \u043f\u0443\u043b\u0430","controls_nodes-search-placeholder":"ID \u0443\u0437\u043b\u0430, FQDN"}'),_=(0,O.wZ)("ydb-storage",{ru:P,en:D}),T=(0,C.cn)("global-storage"),k=e=>{let{searchValue:t,handleSearchValueChange:r,withTypeSelector:n,storageType:s,handleStorageTypeChange:a,visibleEntities:l,handleVisibleEntitiesChange:o,nodesUptimeFilter:d,handleNodesUptimeFilterChange:u,withGroupsUsageFilter:c,groupsUsageFilter:h,groupsUsageFilterOptions:f,handleGroupsUsageFilterChange:w,entitiesCountCurrent:N,entitiesCountTotal:y,entitiesLoading:S}=e;const C=s===i.d.nodes,E=_(C?"nodes":"groups");return(0,b.jsxs)(m.Fragment,{children:[(0,b.jsx)(g.o,{value:t,onChange:r,placeholder:_(C?"controls_nodes-search-placeholder":"controls_groups-search-placeholder"),className:T("search")}),n&&(0,b.jsx)(x,{value:s,onChange:a}),(0,b.jsx)(j,{value:l,onChange:o}),C&&(0,b.jsx)(v.X,{value:d,onChange:u}),!C&&c&&(0,b.jsx)(G,{value:h,onChange:w,groups:f}),(0,b.jsx)(p.C,{label:E,loading:S,total:y,current:N})]})};var R=r(11635),M=r(17176),L=r(79023),z=r(56350);const V=JSON.parse('{"default_message":"Everything is fine!","default_button_label":"Show All"}'),K=JSON.parse('{"default_message":"\u0412\u0441\u0451 \u0432 \u043f\u043e\u0440\u044f\u0434\u043a\u0435!","default_button_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435"}'),W=(0,O.wZ)("ydb-storage-empty-filter",{ru:K,en:V}),Z=e=>{let{title:t,message:r=W("default_message"),showAll:n=W("default_button_label"),onShowAll:s}=e;return(0,b.jsx)(L.u,{image:(0,b.jsx)(z.Q,{name:"thumbsUp"}),position:"left",title:t,description:r,actions:s&&[(0,b.jsx)(M.z,{onClick:s,children:n},"show-all")]})};var H=r(43817);const Q=e=>{let t,{visibleEntities:r,onShowAll:n}=e;return r===i.G.space&&(t=(0,H.Z)("empty.out_of_space")),r===i.G.missing&&(t=(0,H.Z)("empty.degraded")),t?(0,b.jsx)(Z,{title:t,showAll:(0,H.Z)("show_all"),onShowAll:n}):null};var J=r(77382),Y=r(46393),q=r(92092),B=r(11431);const X=(e,t)=>"getStorageGroups|offset".concat(t,"|limit").concat(e),$=async e=>{const{limit:t,offset:r,sortParams:n,filters:s}=e,{sortOrder:a,columnId:l}=null!==n&&void 0!==n?n:{},{searchValue:o,visibleEntities:i,database:d,nodeId:u}=null!==s&&void 0!==s?s:{},c=await window.api.getStorageInfo({version:B.w.v2,limit:t,offset:r,sortOrder:a,sortValue:l,filter:o,visibleEntities:i,database:d,nodeId:u},{concurrentId:X(t,r)}),h=(0,q.KJ)(c);return{data:h.groups||[],found:h.found||0,total:h.total||0}},ee=e=>{let{searchValue:t,visibleEntities:r,database:n,nodeId:s,onShowAll:a,parentContainer:l,renderControls:o,renderErrorMessage:d}=e;const u=(0,Y.V)(r),c=m.useMemo((()=>({searchValue:t,visibleEntities:r,database:n,nodeId:s})),[t,r,n,s]);return(0,b.jsx)(R.WQ,{columnsWidthLSKey:J.Ty,parentContainer:l,columns:u,fetchData:$,limit:50,renderControls:o,renderErrorMessage:d,renderEmptyDataMessage:()=>r!==i.G.all?(0,b.jsx)(Q,{onShowAll:a,visibleEntities:r}):(0,H.Z)("empty.default"),filters:c,tableName:"storage-groups"})},te=JSON.parse('{"empty.default":"No such nodes","empty.out_of_space":"No nodes with out of space errors","empty.degraded":"No degraded nodes","empty.small_uptime":"No nodes with uptime < 1h","empty.several_filters":"No nodes match current filters combination","show_all":"Show all nodes"}'),re=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432","empty.out_of_space":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043a\u043e\u043d\u0447\u0430\u0435\u0442\u0441\u044f \u043c\u0435\u0441\u0442\u043e","empty.degraded":"\u041d\u0435\u0442 \u0434\u0435\u0433\u0440\u0430\u0434\u0438\u0440\u043e\u0432\u0430\u0432\u0448\u0438\u0445 \u0443\u0437\u043b\u043e\u0432","empty.small_uptime":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432 \u0441 uptime < 1h","empty.several_filters":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432, \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043f\u043e\u0434 \u0442\u0435\u043a\u0443\u0449\u0438\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b","show_all":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435 \u0443\u0437\u043b\u044b"}'),ne=(0,O.wZ)("ydb-storage-nodes",{ru:re,en:te}),se=e=>{let t,{visibleEntities:r,nodesUptimeFilter:n,onShowAll:s}=e;return r===i.G.space&&(t=ne("empty.out_of_space")),r===i.G.missing&&(t=ne("empty.degraded")),n===h.Uu.SmallUptime&&(t=ne("empty.small_uptime")),r!==i.G.all&&n!==h.Uu.All&&(t=ne("empty.several_filters")),t?(0,b.jsx)(Z,{title:t,showAll:ne("show_all"),onShowAll:s}):null},ae=(e,t)=>"getStorageNodes|offset".concat(t,"|limit").concat(e),le=async e=>{const{type:t="static",storage:r=!0,limit:n,offset:s,sortParams:a,filters:l}=e,{searchValue:o,nodesUptimeFilter:i,visibleEntities:d,database:u}=null!==l&&void 0!==l?l:{},{sortOrder:c,columnId:m}=null!==a&&void 0!==a?a:{},p=await window.api.getNodes({type:t,storage:r,limit:n,offset:s,sortOrder:c,sortValue:m,filter:o,uptime:(0,h.RW)(i),visibleEntities:d,database:u},{concurrentId:ae(n,s)}),g=(0,q.Y2)(p);return{data:g.nodes||[],found:g.found||0,total:g.total||0}};var oe=r(19812),ie=r(89778),de=r(17931);const ue=(0,C.cn)("global-storage-nodes"),ce=e=>ue("node",{unavailable:(0,h.TA)(e)}),he="storageNodesColumnsWidth",me="NodeId",pe="Host",ge="DC",ve="Rack",fe="Uptime",be="PDisks",we="Missing",xe=(e,t,r)=>{const s=((e,t)=>{const r=null===e||void 0===e?void 0:e.getNodeRef;return[{name:me,header:"Node ID",width:100,align:oe.ZP.RIGHT,render:e=>{let{row:t}=e;return t.NodeId}},{name:pe,header:"Host",width:350,render:e=>{let{row:n}=e;return(0,b.jsx)(ie.k,{node:n,getNodeRef:r,database:t})},align:oe.ZP.LEFT},{name:ge,header:"DC",width:100,render:e=>{let{row:t}=e;return t.DC||n.jX},align:oe.ZP.LEFT},{name:ve,header:"Rack",width:100,render:e=>{let{row:t}=e;return t.Rack||"\u2014"},align:oe.ZP.LEFT},{name:fe,header:"Uptime",width:130,sortAccessor:e=>{let{StartTime:t}=e;return t?-t:0},align:oe.ZP.RIGHT,render:e=>{let{row:t}=e;return t.Uptime}},{name:we,header:"Missing",width:100,align:oe.ZP.CENTER,defaultOrder:oe.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.Missing}},{name:be,className:ue("pdisks-column"),header:"PDisks",render:e=>{var t;let{row:r}=e;return(0,b.jsx)("div",{className:ue("pdisks-wrapper"),children:null===(t=r.PDisks)||void 0===t?void 0:t.map((e=>{var t;const n=null===(t=r.VDisks)||void 0===t?void 0:t.filter((t=>t.PDiskId===e.PDiskId));return(0,b.jsx)("div",{className:ue("pdisks-item"),children:(0,b.jsx)(de.l,{data:e,vDisks:n})},e.PDiskId)}))})},align:oe.ZP.CENTER,sortable:!1,width:900,resizeable:!1}]})(e,r),a=s.map((e=>({...e,sortable:(0,h.oh)(e.name)})));return t!==i.G.missing?a.filter((e=>e.name!==we)):a},Ne=e=>{let{searchValue:t,visibleEntities:r,nodesUptimeFilter:n,database:s,additionalNodesProps:a,onShowAll:l,parentContainer:o,renderControls:d,renderErrorMessage:u}=e;const c=m.useMemo((()=>({searchValue:t,visibleEntities:r,nodesUptimeFilter:n,database:s})),[t,r,n,s]),p=m.useMemo((()=>xe(a,r,s)),[a,r,s]);return(0,b.jsx)(R.WQ,{columnsWidthLSKey:he,parentContainer:o,columns:p,fetchData:le,rowHeight:50,limit:50,renderControls:d,renderErrorMessage:u,renderEmptyDataMessage:()=>r!==i.G.all||n!==h.Uu.All?(0,b.jsx)(se,{onShowAll:l,nodesUptimeFilter:n,visibleEntities:r}):ne("empty.default"),getRowClassName:ce,filters:c,tableName:"storage-nodes"})},je=e=>{var t;let{database:r,nodeId:n,parentContainer:s,additionalNodesProps:d}=e;const[m,p]=(0,a.useQueryParams)({type:a.StringParam,visible:a.StringParam,search:a.StringParam,uptimeFilter:a.StringParam}),g=c.parse(m.type),v=u.parse(m.visible),f=null!==(t=m.search)&&void 0!==t?t:"",w=h.U8.parse(m.uptimeFilter),x=e=>{p({search:e||void 0},"replaceIn")},N=e=>{p({visible:e},"replaceIn")},j=e=>{p({type:e},"replaceIn")},y=e=>{p({uptimeFilter:e},"replaceIn")},S=()=>{p({visible:i.G.all,uptimeFilter:h.Uu.All},"replaceIn")},C=e=>{let{totalEntities:t,foundEntities:r,inited:s}=e;return(0,b.jsx)(k,{searchValue:f,handleSearchValueChange:x,withTypeSelector:!n,storageType:g,handleStorageTypeChange:j,visibleEntities:v,handleVisibleEntitiesChange:N,nodesUptimeFilter:w,handleNodesUptimeFilterChange:y,withGroupsUsageFilter:!1,entitiesCountCurrent:r,entitiesCountTotal:t,entitiesLoading:!s})},E=e=>403===e.status?(0,b.jsx)(l.J,{position:"left"}):(0,b.jsx)(o.V,{error:e});return g===i.d.nodes?(0,b.jsx)(Ne,{searchValue:f,visibleEntities:v,nodesUptimeFilter:w,database:r,additionalNodesProps:d,onShowAll:S,parentContainer:s,renderControls:C,renderErrorMessage:E}):(0,b.jsx)(ee,{searchValue:f,visibleEntities:v,database:r,nodeId:n,onShowAll:()=>{N(i.G.all)},parentContainer:s,renderControls:C,renderErrorMessage:E})};var ye=r(86969),Se=r(1440),Ce=r(26688),Ee=r(47101),Oe=r(15106),Ie=r(14223);const Ae=e=>e.trim().toLowerCase(),Fe=(e,t)=>{const r=Ae(t);return r?e.filter((e=>{var t,n;return(null===(t=e.NodeId)||void 0===t?void 0:t.toString().includes(r))||(null===(n=e.Host)||void 0===n?void 0:n.toLowerCase().includes(r))})):e},Ue=(e,t)=>{const r=Ae(t);return r?e.filter((e=>{var t,n;return(null===(t=e.PoolName)||void 0===t?void 0:t.toLowerCase().includes(r))||(null===(n=e.GroupID)||void 0===n?void 0:n.toString().includes(r))})):e},Ge=(e,t)=>Array.isArray(t)&&0!==t.length?e.filter((e=>{const r=e.Usage;return t.some((e=>Number(e)<=r&&r<Number(e)+5))})):e;const De=r(905).h.injectEndpoints({endpoints:e=>({getStorageNodesInfo:e.query({queryFn:async(e,t)=>{let{signal:r}=t;try{const t=await window.api.getNodes({storage:!0,type:"static",...e},{signal:r});return{data:(0,q.Y2)(t)}}catch(n){return{error:n}}},providesTags:["All"]}),getStorageGroupsInfo:e.query({queryFn:async(e,t)=>{let{signal:r}=t;try{const t=await window.api.getStorageInfo({version:B.w.v1,...e},{signal:r});return{data:(0,q.KJ)(t)}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var Pe=r(2098);function _e(e){let{data:t,tableSettings:r,visibleEntities:n,onShowAll:s,sort:a,handleSort:l}=e;const o=(0,Y.V)(n);return t.length||n===i.G.all?(0,b.jsx)(Pe.G,{columnsWidthLSKey:J.Ty,data:t,columns:o,settings:r,emptyDataMessage:(0,H.Z)("empty.default"),sortOrder:a,onSort:l},n):(0,b.jsx)(Q,{onShowAll:s,visibleEntities:n})}function Te(e){let{data:t,tableSettings:r,visibleEntities:n,onShowAll:s,nodesUptimeFilter:a,additionalNodesProps:l,sort:o,handleSort:d,database:u}=e;const c=xe(l,n,u);return t.length||n===i.G.all&&a===h.Uu.All?(0,b.jsx)(Pe.G,{columnsWidthLSKey:he,data:t,columns:c,settings:{...r,dynamicRenderType:"variable"},emptyDataMessage:ne("empty.default"),rowClassName:ce,sortOrder:o,onSort:d},n):(0,b.jsx)(se,{visibleEntities:n,nodesUptimeFilter:a,onShowAll:s})}const ke=(0,a.withDefault)({encode:a.ArrayParam.encode,decode:e=>null===e||void 0===e?e:Array.isArray(e)?e.filter(Boolean):e?[e]:[]},[]),Re=e=>{var t;let{additionalNodesProps:r,database:l,nodeId:o}=e;const[d]=(0,s.Rj)(),[p,g]=(0,a.useQueryParams)({type:a.StringParam,visible:a.StringParam,search:a.StringParam,uptimeFilter:a.StringParam,usageFilter:ke}),v=c.parse(p.type),f=u.parse(p.visible),w=null!==(t=p.search)&&void 0!==t?t:"",x=h.U8.parse(p.uptimeFilter),N=p.usageFilter,[j,y]=m.useState({sortOrder:void 0,sortValue:void 0}),S=j.sortValue?j:E.TP,[C,O]=m.useState({sortOrder:void 0,sortValue:void 0}),I=C.sortOrder?C:(0,E._r)(f),A=void 0!==o,F=A?i.d.groups:v,U=De.useGetStorageNodesInfoQuery({database:l,visibleEntities:f},{skip:F!==i.d.nodes,pollingInterval:d}),G=De.useGetStorageGroupsInfoQuery({database:l,visibleEntities:f,nodeId:o},{skip:F!==i.d.groups,pollingInterval:d}),{currentData:D,isFetching:P,error:_}=F===i.d.nodes?U:G,{currentData:{nodes:R=[]}={}}=U,{currentData:{groups:M=[]}={}}=G,{nodes:L,groups:z,...V}=null!==D&&void 0!==D?D:{found:0,total:0},K=void 0===D&&P,W=m.useMemo((()=>function(e,t,r){let n=e||[];return n=Fe(n,t),n=(0,Ie.f)(n,r),n}(R,w,x)),[w,R,x]),Z=m.useMemo((()=>function(e,t,r){let n=e||[];return n=Ue(n,t),n=Ge(n,r),n}(M,w,N)),[w,M,N]),H=m.useMemo((()=>function(e){const t={};return null===e||void 0===e||e.forEach((e=>{const r=(0,Oe.Ic)(e,5);Object.prototype.hasOwnProperty.call(t,r)||(t[r]=0),t[r]+=1})),Object.entries(t).map((e=>{let[t,r]=e;return{threshold:Number(t),count:r}})).sort(((e,t)=>t.threshold-e.threshold))}(M)),[M]),[Q,J]=(0,s.sC)(S,(e=>y(e))),[Y,q]=(0,s.sC)(I,(e=>O(e))),B=e=>{g({usageFilter:e.length?e:void 0},"replaceIn")},X=e=>{g({search:e||void 0},"replaceIn")},$=e=>{g({visible:e},"replaceIn")},ee=e=>{g({type:e},"replaceIn")},te=e=>{g({uptimeFilter:e},"replaceIn")},re=()=>{$(i.G.all),te(h.Uu.All)};return(0,Se.u)(_)?(0,b.jsx)(ye.J,{position:"left"}):(0,b.jsxs)(Ee.l,{children:[(0,b.jsx)(Ee.l.Controls,{children:(0,b.jsx)(k,{searchValue:w,handleSearchValueChange:X,withTypeSelector:!A,storageType:F,handleStorageTypeChange:ee,visibleEntities:f,handleVisibleEntitiesChange:$,nodesUptimeFilter:x,handleNodesUptimeFilterChange:te,groupsUsageFilter:N,groupsUsageFilterOptions:H,handleGroupsUsageFilterChange:B,entitiesCountCurrent:F===i.d.groups?Z.length:W.length,entitiesCountTotal:V.total,entitiesLoading:K})}),_?(0,b.jsx)(Ce.V,{error:_}):null,(0,b.jsx)(Ee.l.Table,{loading:K,className:T("table"),children:D?(0,b.jsxs)(m.Fragment,{children:[F===i.d.groups&&(0,b.jsx)(_e,{visibleEntities:f,data:Z,tableSettings:n.LE,onShowAll:()=>$(i.G.all),sort:Y,handleSort:q},"groups"),F===i.d.nodes&&(0,b.jsx)(Te,{visibleEntities:f,nodesUptimeFilter:x,data:W,tableSettings:n.LE,onShowAll:re,additionalNodesProps:r,sort:Q,handleSort:J,database:l},"nodes")]}):null})]})},Me=e=>{let{parentContainer:t,...r}=e;const[a]=(0,s.yu)(n.Qy);return a?(0,b.jsx)(je,{parentContainer:t,...r}):(0,b.jsx)(Re,{...r})}},14223:(e,t,r)=>{r.d(t,{A:()=>h,f:()=>u});var n=r(75850),s=r(52317),a=r(34301),l=r(27070),o=r(51688),i=r(80839);const d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(arguments.length>1?arguments[1]:void 0)===i.pu.ALL?e:e.filter((e=>{let{SystemState:t}=e;return t&&t!==n.K.Green}))},u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(arguments.length>1?arguments[1]:void 0)===o.Uu.All?e:e.filter((e=>{let{StartTime:t}=e;return!t||(0,a.OW)(t)<s.RQ}))},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!t)return e;const r=(0,l.Y)(t);return e.filter((e=>!e.Host||(r.test(e.Host)||r.test(String(e.NodeId)))))};function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{uptimeFilter:t,searchValue:r,problemFilter:n}=arguments.length>1?arguments[1]:void 0,s=u(e,t);return s=d(s,n),s=c(s,r),s}},83496:(e,t,r)=>{r.d(t,{FW:()=>l,KR:()=>o});var n=r(75850),s=r(28164);const a={[s.g.Dead]:n.K.Red,[s.g.Created]:n.K.Yellow,[s.g.ResolveStateStorage]:n.K.Yellow,[s.g.Candidate]:n.K.Yellow,[s.g.BlockBlobStorage]:n.K.Yellow,[s.g.WriteZeroEntry]:n.K.Yellow,[s.g.Restored]:n.K.Yellow,[s.g.Discover]:n.K.Yellow,[s.g.Lock]:n.K.Yellow,[s.g.Stopped]:n.K.Yellow,[s.g.ResolveLeader]:n.K.Yellow,[s.g.RebuildGraph]:n.K.Yellow,[s.g.Deleted]:n.K.Green,[s.g.Active]:n.K.Green},l=(Object.keys(s.g),Object.entries(a).reduce(((e,t)=>{let[r,n]=t;return e[n]?e[n].push(r):e[n]=[r],e}),{}),e=>{if(!e)return n.K.Grey;return t=e,Object.values(n.K).includes(t)?e:a[e];var t});function o(e){if(!e)return"unknown";switch(e){case s.g.Dead:return"danger";case s.g.Active:case s.g.Deleted:return"success";default:return"warning"}}}}]);