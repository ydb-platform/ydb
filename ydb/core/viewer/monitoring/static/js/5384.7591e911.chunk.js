"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[5384],{65070:(e,t,a)=>{a.d(t,{U:()=>d});var s=a(68963),n=a(17176),i=a(68330),l=a(86793),r=a(45743),o=a(75859);function d(e){let{children:t,onConfirmAction:a,onConfirmActionSuccess:d,dialogHeader:c,dialogText:u,retryButtonText:v,buttonDisabled:p=!1,buttonView:h="action",buttonClassName:m,withPopover:b=!1,popoverContent:g,popoverPlacement:x="right",popoverDisabled:k=!0}=e;const[j,y]=s.useState(!1),[N,f]=s.useState(!1),[D,I]=s.useState(!1),S=()=>(0,o.jsx)(n.z,{onClick:()=>y(!0),view:h,disabled:p,loading:!p&&N,className:m,children:t});return(0,o.jsxs)(s.Fragment,{children:[(0,o.jsx)(l.g,{visible:j,header:c,text:u,withRetry:D,retryButtonText:v,onConfirm:async e=>{f(!0),await a(e)},onConfirmActionSuccess:async()=>{I(!1);try{await(null===d||void 0===d?void 0:d())}finally{f(!1)}},onConfirmActionError:e=>{I((0,r.q)(e)),f(!1)},onClose:()=>{y(!1)}}),b?(0,o.jsx)(i.J,{content:g,placement:x,disabled:k,children:S()}):S()]})}},86793:(e,t,a)=>{a.d(t,{g:()=>b});var s=a(68963),n=a(76506),i=a(71586),l=a(48897),r=a(25822),o=a(88776),d=a(24362),c=a(30817);const u=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),v=(0,c.wZ)("ydb-critical-action-dialog",{en:u});var p=a(75859);const h=(0,d.cn)("ydb-critical-dialog"),m=e=>403===e.status?v("no-rights-error"):e.statusText?e.statusText:v("default-error");function b(e){let{visible:t,header:a,text:d,withRetry:c,retryButtonText:u,withCheckBox:b,onClose:g,onConfirm:x,onConfirmActionSuccess:k,onConfirmActionError:j}=e;const[y,N]=s.useState(!1),[f,D]=s.useState(),[I,S]=s.useState(!1),w=async e=>(N(!0),x(e).then((()=>{k(),g()})).catch((e=>{j(e),D(e)})).finally((()=>{N(!1)})));return(0,p.jsx)(r.V,{open:t,hasCloseButton:!1,className:h(),size:"s",onClose:g,onTransitionExited:()=>{D(void 0),S(!1)},children:f?(0,p.jsxs)(s.Fragment,{children:[(0,p.jsx)(r.V.Header,{caption:a}),(0,p.jsx)(r.V.Body,{className:h("body"),children:(0,p.jsxs)("div",{className:h("body-message",{error:!0}),children:[(0,p.jsx)("span",{className:h("error-icon"),children:(0,p.jsx)(n.Z,{width:"24",height:"22"})}),m(f)]})}),(0,p.jsx)(r.V.Footer,{loading:!1,preset:"default",textButtonApply:c?u||v("button-retry"):void 0,textButtonCancel:v("button-close"),onClickButtonApply:()=>w(!0),onClickButtonCancel:g})]}):(0,p.jsxs)(s.Fragment,{children:[(0,p.jsx)(r.V.Header,{caption:a}),(0,p.jsxs)(r.V.Body,{className:h("body"),children:[(0,p.jsxs)("div",{className:h("body-message",{warning:!0}),children:[(0,p.jsx)("span",{className:h("warning-icon"),children:(0,p.jsx)(o.J,{data:i.Z,size:24})}),d]}),b?(0,p.jsx)(l.X,{checked:I,onUpdate:S,children:v("checkbox-text")}):null]}),(0,p.jsx)(r.V.Footer,{loading:y,preset:"default",textButtonApply:v("button-confirm"),textButtonCancel:v("button-cancel"),propsButtonApply:{type:"submit",disabled:b&&!I},onClickButtonCancel:g,onClickButtonApply:()=>w()})]})})}},45743:(e,t,a)=>{a.d(t,{q:()=>s});const s=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},8659:(e,t,a)=>{a.d(t,{P:()=>y});var s=a(77796),n=a(54665),i=a(14146),l=a(5922),r=a(81854),o=a(24362),d=a(34301),c=a(48169),u=a(17096),v=a(69214),p=a(23373),h=a(32270),m=a(67359),b=a(30817);const g=JSON.parse('{"type":"Type","path":"Path","guid":"GUID","serial-number":"Serial Number","shared-with-os":"SharedWithOs","drive-status":"Drive Status","state":"State","device":"Device","realtime":"Realtime","space":"Space","slots":"Slots","log-size":"Log Size","system-size":"System Size","links":"Links","developer-ui":"Developer UI","pdisk-page":"PDisk page","yes":"Yes"}'),x=(0,b.wZ)("ydb-pDisk-info",{en:g});var k=a(75859);const j=(0,o.cn)("ydb-pdisk-info");function y(e){let{pDisk:t,nodeId:a,withPDiskPageLink:o,className:b}=e;const g=(0,u.ix)(i.VH),[y,N,f,D]=function(e){let{pDisk:t,nodeId:a,withPDiskPageLink:s,isUserAllowedToMakeChanges:i}=e;const{PDiskId:o,Path:u,Guid:p,Category:b,Type:g,Device:y,Realtime:N,State:f,SerialNumber:D,TotalSize:I,AllocatedSize:S,StatusV2:w,NumActiveSlots:T,ExpectedSlotCount:P,LogUsedSize:V,LogTotalSize:C,SystemSize:z,SharedWithOs:A}=t||{},R=[];(0,l.D)(b)&&R.push({label:x("type"),value:g}),(0,l.D)(u)&&R.push({label:x("path"),value:u}),(0,l.D)(p)&&R.push({label:x("guid"),value:p}),D&&R.push({label:x("serial-number"),value:D}),(0,l.D)(A)&&R.push({label:x("shared-with-os"),value:x("yes")});const q=[];(0,l.D)(w)&&q.push({label:x("drive-status"),value:w}),(0,l.D)(f)&&q.push({label:x("state"),value:f}),(0,l.D)(y)&&q.push({label:x("device"),value:(0,k.jsx)(v.A,{status:y})}),(0,l.D)(N)&&q.push({label:x("realtime"),value:(0,k.jsx)(v.A,{status:N})});const F=[];F.push({label:x("space"),value:(0,k.jsx)(m.y,{value:S,capacity:I,formatValues:d.q3,colorizeProgress:!0})}),(0,l.D)(T)&&(0,l.D)(P)&&F.push({label:x("slots"),value:(0,k.jsx)(m.y,{value:T,capacity:P})}),(0,l.D)(V)&&(0,l.D)(C)&&F.push({label:x("log-size"),value:(0,k.jsx)(m.y,{value:V,capacity:C,formatValues:d.q3})}),(0,l.D)(z)&&F.push({label:x("system-size"),value:(0,r.td)({value:z})});const E=[];if((s||i)&&(0,l.D)(o)&&(0,l.D)(a)){const e=(0,n.ds)(o,a),t=(0,c.ok)({nodeId:a,pDiskId:o});E.push({label:x("links"),value:(0,k.jsxs)("span",{className:j("links"),children:[s&&(0,k.jsx)(h.j,{title:x("pdisk-page"),url:e,external:!1}),i&&(0,k.jsx)(h.j,{title:x("developer-ui"),url:t})]})})}return[R,q,F,E]}({pDisk:t,nodeId:a,withPDiskPageLink:o,isUserAllowedToMakeChanges:g});return(0,k.jsxs)(s.k,{className:b,gap:2,direction:"row",wrap:!0,children:[(0,k.jsxs)(s.k,{direction:"column",gap:2,width:500,children:[(0,k.jsx)(p._,{info:y,renderEmptyState:()=>null}),(0,k.jsx)(p._,{info:f,renderEmptyState:()=>null})]}),(0,k.jsxs)(s.k,{direction:"column",gap:2,width:500,children:[(0,k.jsx)(p._,{info:N,renderEmptyState:()=>null}),(0,k.jsx)(p._,{info:D,renderEmptyState:()=>null})]})]})}},97482:(e,t,a)=>{a.d(t,{f:()=>l});var s=a(14979),n=a(83496),i=a(75859);function l(e){let{state:t}=e;return(0,i.jsx)(s._,{theme:(0,n.KR)(t),children:t})}},12199:(e,t,a)=>{a.d(t,{$:()=>o});a(68963);var s=a(24362),n=a(75859);const i=(0,s.cn)("tag"),l=e=>{let{text:t,type:a}=e;return(0,n.jsx)("div",{className:i({type:a}),children:t})},r=(0,s.cn)("tags"),o=e=>{let{tags:t,tagsType:a,className:s=""}=e;return(0,n.jsx)("div",{className:r(null,s),children:t&&t.map(((e,t)=>(0,n.jsx)(l,{text:e,type:a},t)))})}},22200:(e,t,a)=>{a.d(t,{K:()=>y});a(68963);var s=a(54665),n=a(14146),i=a(5922),l=a(24362),r=a(34301),o=a(48169),d=a(92666),c=a(17096),u=a(55850),v=a(69214),p=a(62206),h=a(32270),m=a(67359),b=a(30817);const g=JSON.parse('{"slot-id":"VDisk Slot Id","pool-name":"Storage Pool Name","kind":"Kind","guid":"GUID","incarnation-guid":"Incarnation GUID","instance-guid":"Instance GUID","replication-status":"Replicated","state-status":"VDisk State","space-status":"Disk Space","fresh-rank-satisfaction":"Fresh Rank Satisfaction","level-rank-satisfaction":"Level Rank Satisfaction","front-queues":"Front Queues","has-unreadable-blobs":"Has Unreadable Blobs","size":"Size","read-throughput":"Read Throughput","write-throughput":"Write Throughput","links":"Links","vdisk-page":"VDisk Page","developer-ui":"Developer UI","yes":"Yes","no":"No","vdiks-title":"VDisk"}'),x=(0,b.wZ)("ydb-vDisk-info",{en:g});var k=a(75859);const j=(0,l.cn)("ydb-vdisk-info");function y(e){var t,a;let{data:l,withVDiskPageLink:d,withTitle:b,...g}=e;const y=(0,c.ix)(n.VH),{AllocatedSize:f,DiskSpace:D,FrontQueues:I,Guid:S,Replicated:w,VDiskState:T,VDiskSlotId:P,Kind:V,SatisfactionRank:C,AvailableSize:z,HasUnreadableBlobs:A,IncarnationGuid:R,InstanceGuid:q,StoragePoolName:F,ReadThroughput:E,WriteThroughput:L,PDiskId:U,NodeId:B}=l||{},G=[];var _,O;((0,i.D)(P)&&G.push({label:x("slot-id"),value:P}),(0,i.D)(F)&&G.push({label:x("pool-name"),value:F}),(0,i.D)(T)&&G.push({label:x("state-status"),value:T}),Number(f)>=0&&Number(z)>=0&&G.push({label:x("size"),value:(0,k.jsx)(m.y,{value:f,capacity:Number(f)+Number(z),formatValues:r.q3,colorizeProgress:!0})}),(0,i.D)(V)&&G.push({label:x("kind"),value:V}),(0,i.D)(S)&&G.push({label:x("guid"),value:S}),(0,i.D)(R)&&G.push({label:x("incarnation-guid"),value:R}),(0,i.D)(q)&&G.push({label:x("instance-guid"),value:q}),(0,i.D)(w)&&G.push({label:x("replication-status"),value:x(w?"yes":"no")}),(0,i.D)(D)&&G.push({label:x("space-status"),value:(0,k.jsx)(v.A,{status:D})}),(0,i.D)(null===C||void 0===C||null===(t=C.FreshRank)||void 0===t?void 0:t.Flag))&&G.push({label:x("fresh-rank-satisfaction"),value:(0,k.jsx)(v.A,{status:null===C||void 0===C||null===(_=C.FreshRank)||void 0===_?void 0:_.Flag})});(0,i.D)(null===C||void 0===C||null===(a=C.LevelRank)||void 0===a?void 0:a.Flag)&&G.push({label:x("level-rank-satisfaction"),value:(0,k.jsx)(v.A,{status:null===C||void 0===C||null===(O=C.LevelRank)||void 0===O?void 0:O.Flag})});(0,i.D)(I)&&G.push({label:x("front-queues"),value:(0,k.jsx)(v.A,{status:I})}),(0,i.D)(A)&&G.push({label:x("has-unreadable-blobs"),value:x(A?"yes":"no")}),(0,i.D)(E)&&G.push({label:x("read-throughput"),value:(0,u.Qt)(E)}),(0,i.D)(L)&&G.push({label:x("write-throughput"),value:(0,u.Qt)(L)});if((0,i.D)(U)&&(0,i.D)(B)&&(0,i.D)(P)){const e=[];if(d){const t=(0,s.By)(P,U,B);e.push((0,k.jsx)(h.j,{title:x("vdisk-page"),url:t,external:!1},t))}if(y){const t=(0,o.yf)({nodeId:B,pDiskId:U,vDiskSlotId:P});e.push((0,k.jsx)(h.j,{title:x("developer-ui"),url:t},t))}e.length&&G.push({label:x("links"),value:(0,k.jsx)("div",{className:j("links"),children:e})})}const Z=l&&b?(0,k.jsx)(N,{data:l}):null;return(0,k.jsx)(p._P,{info:G,title:Z,...g})}function N(e){let{data:t}=e;return(0,k.jsxs)("div",{className:j("title"),children:[x("vdiks-title"),(0,k.jsx)(v.A,{status:(0,d.b2)(t.Severity),name:(0,r.a2)(t.VDiskId)})]})}},72473:(e,t,a)=>{a.r(t),a.d(t,{Node:()=>ge,STORAGE_ROLE:()=>be});var s=a(68963),n=a(8179),i=a(49352),l=a(86974),r=a(83203),o=a(50422),d=a(39683),c=a(88776),u=a(24362),v=a(48169),p=a(69214),h=a(12199),m=a(75859);const b=(0,u.cn)("basic-node-viewer"),g=e=>{let t,{node:a,additionalNodesProps:n,className:i}=e;return null!==n&&void 0!==n&&n.getNodeRef?t=n.getNodeRef(a)+"internal":a.NodeId&&(t=(0,v.wq)(a.NodeId)+"internal"),(0,m.jsx)("div",{className:b(null,i),children:a?(0,m.jsxs)(s.Fragment,{children:[(0,m.jsx)("div",{className:b("title"),children:"Node"}),(0,m.jsx)(p.A,{status:a.SystemState,name:a.Host}),t&&(0,m.jsx)("a",{rel:"noopener noreferrer",className:b("link",{external:!0}),href:t,target:"_blank",children:(0,m.jsx)(c.J,{data:d.Z})}),(0,m.jsxs)("div",{className:b("id"),children:[(0,m.jsx)("label",{className:b("label"),children:"NodeID"}),(0,m.jsx)("label",{children:a.NodeId})]}),a.DC&&(0,m.jsx)(h.$,{tags:[a.DC]}),a.Roles&&(0,m.jsx)(h.$,{tags:a.Roles,tagsType:"blue"})]}):(0,m.jsx)("div",{className:"error",children:"no data"})})};var x=a(26688),k=a(52317),j=a(23373);const y=(0,u.cn)("ydb-pool-usage"),N=e=>{let t="green";return e>60&&e<=80?t="yellow":e>80&&(t="red"),t},f=e=>{let{data:t={}}=e;const{Threads:a,Name:s="Unknown",Usage:n=0}=t,i=n&&a,l=Math.floor(100*n),r=l>100?100:l;return(0,m.jsxs)("div",{className:y(),children:[(0,m.jsxs)("div",{className:y("info"),children:[(0,m.jsx)("div",{className:y("pool-name"),children:s}),i&&(0,m.jsxs)("div",{className:y("value"),children:[(0,m.jsxs)("div",{className:y("percents"),children:[l<1?"<1":l,"%"]}),(0,m.jsxs)("div",{className:y("threads"),children:["(\xd7",a,")"]})]})]}),(0,m.jsx)("div",{className:y("visual"),children:(0,m.jsx)("div",{className:y("usage-line",{type:N(r)}),style:{width:`${r}%`}})})]})};var D=a(67359);const I=(0,u.cn)("full-node-viewer"),S=e=>{var t,a,s,n;let{node:i,className:l}=e;const r=null===i||void 0===i||null===(t=i.Endpoints)||void 0===t?void 0:t.map((e=>{let{Name:t,Address:a}=e;return{label:t,value:a}})),o=[];null!==i&&void 0!==i&&null!==(a=i.Tenants)&&void 0!==a&&a.length&&o.push({label:"Database",value:i.Tenants[0]}),o.push({label:"Version",value:null===i||void 0===i?void 0:i.Version},{label:"Uptime",value:null===i||void 0===i?void 0:i.Uptime},{label:"DC",value:(null===i||void 0===i?void 0:i.DataCenterDescription)||(null===i||void 0===i?void 0:i.DC)},{label:"Rack",value:null===i||void 0===i?void 0:i.Rack});const d=null===i||void 0===i||null===(s=i.LoadAveragePercents)||void 0===s?void 0:s.map(((e,t)=>({label:k.x5[t],value:(0,m.jsx)(D.y,{value:e,percents:!0,colorizeProgress:!0,capacity:100})})));return(0,m.jsx)("div",{className:`${I()} ${l}`,children:i?(0,m.jsxs)("div",{className:I("common-info"),children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:I("section-title"),children:"Pools"}),(0,m.jsx)("div",{className:I("section",{pools:!0}),children:null===i||void 0===i||null===(n=i.PoolStats)||void 0===n?void 0:n.map(((e,t)=>(0,m.jsx)(f,{data:e},t)))})]}),r&&r.length&&(0,m.jsx)(j._,{title:"Endpoints",className:I("section"),info:r}),(0,m.jsx)(j._,{title:"Common info",className:I("section"),info:o}),(0,m.jsx)(j._,{title:"Load average",className:I("section",{average:!0}),info:d})]}):(0,m.jsx)("div",{className:"error",children:"no data"})})};var w=a(62776),T=a(54665),P=a(17880),V=a(79061),C=a(71698),z=a(17096),A=a(39724),R=a(42635),q=a(92398),F=a(85198),E=a.n(F),L=a(52846),U=a(36313),B=a(34301),G=a(3764);const _=(0,U.P1)((e=>e),(e=>C.N.endpoints.getNodeStructure.select({nodeId:e}))),O=(0,U.P1)((e=>e),((e,t)=>_(t)),((e,t)=>t(e).data)),Z=(0,U.P1)(((e,t)=>Number(t)),((e,t)=>O(e,t)),((e,t)=>{const a=null===t||void 0===t?void 0:t.StoragePools,s={};null===a||void 0===a||a.forEach((t=>{const a=t.Groups;null===a||void 0===a||a.forEach((a=>{var n;const i=null===(n=a.VDisks)||void 0===n?void 0:n.filter((t=>t.NodeId===e)).map(G.w);null===i||void 0===i||i.forEach((a=>{const n=(0,B.a2)(a.VDiskId),i=(0,G.b)(a.PDisk),l=i.PDiskId;s[String(l)]||(s[String(l)]={vDisks:{},...i}),s[String(l)].vDisks[n]={...a,PDiskId:l,NodeId:e,StoragePoolName:t.Name}}))}))}));return Object.keys(s).reduce(((e,t)=>{const a=s[t].vDisks,n=Object.keys(a).reduce(((e,t,s)=>(e.push({...a[t],id:t,order:s}),e)),[]);return e[t]={...s[t],vDisks:n},e}),{})}));var J=a(67585),H=a(19812),$=a(17176),Q=a(68330),K=a(33569),M=a(8659),Y=a(22200),W=a(75850),X=a(17632),ee=a(5922),te=a(30817);const ae=JSON.parse('{"pdisk.developer-ui-button-title":"PDisk Developer UI page","vdisk.developer-ui-button-title":"VDisk Developer UI page"}'),se=JSON.parse('{"pdisk.developer-ui-button-title":"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 PDisk \u0432 Developer UI","vdisk.developer-ui-button-title":"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 VDisk \u0432 Developer UI"}'),ne=(0,te.wZ)("ydb-node-page",{en:ae,ru:se}),ie=(0,u.cn)("kv-node-structure");function le(e){let{label:t,value:a,className:s}=e;return(0,m.jsxs)("span",{className:ie("pdisk-title-item",s),children:[t&&(0,m.jsxs)("span",{className:ie("pdisk-title-item-label"),children:[t,":"]}),(0,m.jsx)("span",{className:ie("pdisk-title-item-value"),children:a})]})}const re=(0,u.cn)("kv-node-structure");var oe;!function(e){e.slotId="VDiskSlotId",e.VDiskState="VDiskState",e.Size="Size",e.Info="Info"}(oe||(oe={}));const de={VDiskSlotId:"Slot id",VDiskState:"Status",Size:"Size",Info:""};function ce(e){let{pDiskId:t,selectedVdiskId:a,nodeId:s}=e;return[{name:oe.slotId,header:de[oe.slotId],width:100,render:e=>{let{row:n}=e;const i=n.VDiskSlotId;let l=null;return(0,ee.D)(s)&&(0,ee.D)(t)&&(0,ee.D)(i)&&(l=(0,v.yf)({nodeId:s,pDiskId:t,vDiskSlotId:i})),(0,m.jsxs)("div",{className:re("vdisk-id",{selected:n.id===a}),children:[(0,m.jsx)("span",{children:i}),l&&(0,m.jsx)($.z,{size:"s",className:re("external-button",{hidden:!0}),href:l,target:"_blank",title:ne("vdisk.developer-ui-button-title"),children:(0,m.jsx)(c.J,{data:d.Z})})]})},align:H.ZP.LEFT},{name:oe.VDiskState,header:de[oe.VDiskState],width:70,render:e=>{let{row:t}=e;return(0,m.jsx)(p.A,{status:t.VDiskState===X.H.OK?W.K.Green:W.K.Red})},sortAccessor:e=>e.VDiskState===X.H.OK?1:0,align:H.ZP.CENTER},{name:oe.Size,header:de[oe.Size],width:100,render:e=>{let{row:t}=e;return(0,m.jsx)(D.y,{value:t.AllocatedSize,capacity:Number(t.AllocatedSize)+Number(t.AvailableSize),formatValues:B.q3,colorizeProgress:!0})},sortAccessor:e=>Number(e.AllocatedSize),align:H.ZP.CENTER},{name:oe.Info,header:de[oe.Info],width:70,render:e=>{let{row:t}=e;return(0,m.jsx)(Q.J,{placement:["right"],content:(0,m.jsx)(Y.K,{data:t,withTitle:!0,withVDiskPageLink:!0}),tooltipContentClassName:re("vdisk-details"),children:(0,m.jsx)($.z,{view:"flat-secondary",className:re("vdisk-details-button",{selected:t.id===a}),children:(0,m.jsx)(c.J,{data:J.Z,size:18})})})},sortable:!1}]}function ue(e){let{id:t,data:a,selectedVdiskId:n,nodeId:i,unfolded:l}=e;const[r,o]=s.useState(null!==l&&void 0!==l&&l),{TotalSize:d=0,AvailableSize:c=0,Device:u,PDiskId:v,Type:h,vDisks:b}=a,g=Number(d),x=Number(c);return(0,m.jsxs)("div",{className:re("pdisk"),id:t,children:[(0,m.jsxs)("div",{className:re("pdisk-header"),children:[(0,m.jsxs)("div",{className:re("pdisk-title-wrapper"),children:[(0,m.jsx)(p.A,{status:u}),(0,m.jsx)(le,{label:"PDiskID",value:v,className:re("pdisk-title-id")}),(0,m.jsx)(le,{value:h,className:re("pdisk-title-type")}),(0,m.jsx)(D.y,{value:g-x,capacity:g,formatValues:B.q3,colorizeProgress:!0,className:re("pdisk-title-size")}),(0,m.jsx)(le,{label:"VDisks",value:b.length})]}),(0,m.jsx)($.z,{onClick:r?()=>{o(!1)}:()=>{o(!0)},view:"flat-secondary",children:(0,m.jsx)(K.F,{direction:r?"top":"bottom"})})]}),r&&(E()(a)?(0,m.jsx)("div",{children:"No information about PDisk"}):(0,m.jsxs)("div",{children:[(0,m.jsx)(M.P,{pDisk:a,nodeId:i,className:re("pdisk-details"),withPDiskPageLink:!0}),(0,m.jsxs)("div",{className:re("vdisks-container"),children:[(0,m.jsx)("div",{className:re("vdisks-header"),children:"VDisks"}),(0,m.jsx)(H.ZP,{theme:"yandex-cloud",data:b,columns:ce({nodeId:i,pDiskId:v,selectedVdiskId:n}),settings:{...k.LE,dynamicRender:!1},rowClassName:e=>e.id===n?re("selected-vdisk"):""})]})]}))]})}const ve=(0,u.cn)("kv-node-structure");function pe(e){let{type:t,id:a}=e;return`${t}-${a}`}const he=function(e){let{nodeId:t,className:a}=e;const n=(0,z.ix)((e=>Z(e,t))),[i]=(0,z.Rj)(),{currentData:l,isFetching:r,error:o}=C.N.useGetNodeStructureQuery({nodeId:t},{pollingInterval:i}),d=r&&void 0===l,[{pdiskId:c,vdiskId:u}]=(0,L.useQueryParams)({pdiskId:L.StringParam,vdiskId:L.StringParam}),v=s.useRef(null),p=s.useRef(!1);return s.useEffect((()=>{if(!E()(n)&&!p.current&&v.current&&c){const t=document.getElementById(pe({type:"pdisk",id:c}));let a=0;if(u){var e;const t=null===(e=n[c])||void 0===e?void 0:e.vDisks,s=null===t||void 0===t?void 0:t.find((e=>e.id===u)),i=s?document.querySelector(".data-table"):void 0,l=(null===s||void 0===s?void 0:s.order)||0;i&&(a+=i.offsetTop+40*l)}t&&(v.current.scrollTo({behavior:"smooth",top:a||t.offsetTop}),p.current=!0)}}),[n,c,u]),(0,m.jsxs)("div",{className:ve(),ref:v,children:[o?(0,m.jsx)(x.V,{error:o,className:ve("error")}):null,(0,m.jsx)("div",{className:a,children:d?(0,m.jsx)(w.a,{size:"m"}):o&&!l?null:(()=>{const e=Object.keys(n);return e.length>0?e.map((e=>(0,m.jsx)(ue,{data:n[e],id:pe({type:"pdisk",id:e}),unfolded:c===e,selectedVdiskId:u,nodeId:t},e))):"There is no information about node structure."})()})]})},me=(0,u.cn)("node"),be="Storage";function ge(e){var t,a;const d=s.useRef(null),c=(0,z.zL)(),u=(0,l.TH)(),v=null!==(t=(0,l.$B)(T.ZP.node))&&void 0!==t?t:Object.create(null),{id:p,activeTab:h}=v.params,{tenantName:b}=(0,T.mB)(u),[k]=(0,z.Rj)(),{currentData:j,isFetching:y,error:N}=C.N.useGetNodeInfoQuery({nodeId:p},{pollingInterval:k}),f=y&&void 0===j,D=j,I=(0,P.rU)(),F=(0,P.X_)(),{activeTabVerified:E,nodeTabs:L}=s.useMemo((()=>{var e;let t=(null===D||void 0===D||null===(e=D.Roles)||void 0===e?void 0:e.find((e=>e===be)))?q.ZJ:q.ZJ.filter((e=>e.id!==q.P_));F&&(t=t.filter((e=>e.id!==q.pV)));const a=t.map((e=>({...e,title:e.name})));let s=a.find((e=>{let{id:t}=e;return t===h}));return s||(s=a[0]),{activeTabVerified:s,nodeTabs:a}}),[h,D,F]),U=(null===D||void 0===D||null===(a=D.Tenants)||void 0===a?void 0:a[0])||(null===b||void 0===b?void 0:b.toString());let B;if(D){var G;const e=!(null!==D&&void 0!==D&&null!==(G=D.Tenants)&&void 0!==G&&G[0]);B=e?"Storage":"Compute"}s.useEffect((()=>{c((0,V.J)("node",{tenantName:U,nodeRole:B,nodeId:p}))}),[c,U,p,B]);const _=()=>{switch(E.id){case q.P_:return(0,m.jsx)("div",{className:me("storage"),children:(0,m.jsx)(A.V,{nodeId:p,parentContainer:d.current})});case q.IA:return(0,m.jsx)(R.J,{nodeId:p,database:U,className:me("node-page-wrapper")});case q.pV:return(0,m.jsx)(he,{className:me("node-page-wrapper"),nodeId:p});case q.mD:return(0,m.jsx)(S,{node:D,className:me("overview-wrapper")});default:return!1}};return f||!I?(0,m.jsx)(w.a,{size:"l"}):D?(0,m.jsxs)("div",{className:me(null,e.className),ref:d,children:[(0,m.jsx)(i.ql,{titleTemplate:`%s \u2014 ${D.Host} \u2014 YDB Monitoring`,defaultTitle:`${D.Host} \u2014 YDB Monitoring`,children:(0,m.jsx)("title",{children:E.title})}),(0,m.jsx)(g,{node:D,additionalNodesProps:e.additionalNodesProps,className:me("header")}),N?(0,m.jsx)(x.V,{error:N,className:me("error")}):null,(0,m.jsxs)("div",{className:me("tabs"),children:[(0,m.jsx)(n.m,{size:"l",items:L,activeTab:E.id,wrapTo:(e,t)=>{let{id:a}=e;return(0,m.jsx)(r.rU,{to:(0,T.ax)(T.ZP.node,{id:p,activeTab:a},{tenantName:U}),className:me("tab"),children:t},a)},allowNotSelected:!0}),(0,m.jsx)(o.q,{})]}),(0,m.jsx)("div",{className:me("content"),children:_()})]}):N?(0,m.jsx)(x.V,{error:N}):(0,m.jsx)("div",{className:"error",children:"no node data"})}},42635:(e,t,a)=>{a.d(t,{J:()=>G});var s=a(66950),n=a(10288),i=a(88776),l=a(17095),r=a(65070),o=a(41919),d=a(69214),c=a(26688),u=a(74170),v=a(2098),p=a(22692),h=a(97482),m=a(54665),b=a(14146),g=a(76386),x=a(36313),k=a(85690),j=a.n(k),y=a(905),N=a(99337);const f=y.h.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{return{data:await window.api.getTabletsInfo(e,{signal:a})}}catch(s){return{error:s}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),D=(0,x.P1)((e=>e),(e=>f.endpoints.getTabletsInfo.select(e)),{argsMemoize:x.PP,argsMemoizeOptions:{equalityCheck:j()}}),I=(0,x.P1)((e=>e),((e,t)=>D(t)),((e,t)=>t(e).data)),S=(0,x.P1)(((e,t)=>I(e,t)),(e=>(0,N.d)(e)),((e,t)=>null!==e&&void 0!==e&&e.TabletStateInfo?t?e.TabletStateInfo.map((e=>{const a=void 0===e.NodeId?void 0:t.get(e.NodeId);return{...e,fqdn:a}})):e.TabletStateInfo:[]));var w=a(28164),T=a(24362),P=a(52317),V=a(34301),C=a(48169),z=a(17096),A=a(92398),R=a(30817);const q=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill-header":"Restart tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet"}'),F=(0,R.wZ)("ydb-tablets",{en:q});var E=a(75859);const L=(0,T.cn)("tablets");function U(e){let{database:t}=e;return[{name:"Type",get header(){return F("Type")},render:e=>{let{row:t}=e;const a=!1===t.Leader;return(0,E.jsxs)("span",{children:[t.Type," ",a?(0,E.jsx)(n.x,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return F("Tablet")},render:e=>{var a;let{row:s}=e;if(!s.TabletId)return P.jX;const n=(0,m.fK)(s.TabletId,{nodeId:s.NodeId,type:s.Type,tenantName:t});return(0,E.jsx)(d.A,{name:null===(a=s.TabletId)||void 0===a?void 0:a.toString(),path:n,hasClipboardButton:!0,showStatus:!1,additionalControls:(0,E.jsx)(o.Q,{href:(0,C.wz)(s.TabletId)})})}},{name:"State",get header(){return F("State")},render:e=>{let{row:t}=e;return(0,E.jsx)(h.f,{state:t.State})}},{name:"NodeId",get header(){return F("Node ID")},render:e=>{let{row:t}=e;const a=void 0===t.NodeId?void 0:(0,A.a3)(t.NodeId);return(0,E.jsx)(u.h,{to:a,children:t.NodeId})},align:"right"},{name:"fqdn",get header(){return F("Node FQDN")},render:e=>{let{row:t}=e;return t.fqdn?(0,E.jsx)(d.A,{name:t.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,E.jsx)("span",{children:"\u2014"})}},{name:"Generation",get header(){return F("Generation")},align:"right"},{name:"Uptime",get header(){return F("Uptime")},render:e=>{let{row:t}=e;return(0,V.fG)(t.ChangeTime)},sortAccessor:e=>-Number(e.ChangeTime),align:"right"},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:e=>{let{row:t}=e;return(0,E.jsx)(B,{...t})}}]}function B(e){const t=e.State===w.g.Stopped,a=(0,z.ix)(b.VH),[n]=g._.useKillTabletMutation(),l=e.TabletId;return l?(0,E.jsx)(r.U,{buttonView:"outlined",dialogHeader:F("dialog.kill-header"),dialogText:F("dialog.kill-text"),onConfirmAction:()=>n({id:l}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:F("controls.kill-not-allowed"),popoverDisabled:a,children:(0,E.jsx)(i.J,{data:s.Z})}):null}function G(e){let{nodeId:t,path:a,database:s,className:n}=e;const[i]=(0,z.Rj)();let r={};const o=void 0===t?void 0:String(t);void 0!==o?r={nodeId:o,database:s}:a&&(r={path:a,database:s});const{currentData:d,isFetching:u,error:h}=f.useGetTabletsInfoQuery(0===Object.keys(r).length?l.CN:r,{pollingInterval:i}),m=u&&void 0===d,b=(0,z.ix)((e=>S(e,r)));return m?(0,E.jsx)(p.h,{}):(0,E.jsxs)("div",{className:L(null,n),children:[h?(0,E.jsx)(c.V,{error:h}):null,d?(0,E.jsx)(v.G,{columns:U({database:s}),data:b,settings:P.LE,emptyDataMessage:F("noTabletsData")}):null]})}},71698:(e,t,a)=>{a.d(t,{N:()=>l});var s=a(905),n=a(51688);const i=e=>{var t;if(null===(t=e.SystemStateInfo)||void 0===t||!t.length)return{};const a=e.SystemStateInfo[0];return(0,n.Ns)(a)},l=s.h.injectEndpoints({endpoints:e=>({getNodeInfo:e.query({queryFn:async(e,t)=>{let{nodeId:a}=e,{signal:s}=t;try{const e=await window.api.getNodeInfo(a,{signal:s});return{data:i(e)}}catch(n){return{error:n}}},providesTags:["All"]}),getNodeStructure:e.query({queryFn:async(e,t)=>{let{nodeId:a}=e,{signal:s}=t;try{return{data:await window.api.getStorageInfo({nodeId:a},{signal:s})}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"})},76386:(e,t,a)=>{a.d(t,{_:()=>n});var s=a(51688);const n=a(905).h.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async(e,t)=>{let{id:a,database:n,nodeId:i}=e,{signal:l}=t;try{const[e,t,r]=await Promise.all([window.api.getTablet({id:a,database:n,nodeId:i},{signal:l}),window.api.getTabletHistory({id:a,database:n,nodeId:i},{signal:l}),window.api.getNodesList({signal:l})]),o=(0,s.dn)(r),d=Object.keys(t).reduce(((e,a)=>{var s;const n=null===(s=t[a])||void 0===s?void 0:s.TabletStateInfo;if(n&&n.length){const t=n.find((e=>e.Leader))||n[0],{ChangeTime:s,Generation:i,State:l,Leader:r,FollowerId:d}=t,c=o&&a?o.get(Number(a)):void 0;"Dead"!==l&&e.push({nodeId:a,generation:i,changeTime:s,state:l,leader:r,followerId:d,fqdn:c})}return e}),[]),{TabletStateInfo:c=[]}=e,[u={}]=c,{TabletId:v}=u;return{data:{id:v,data:u,history:d}}}catch(r){return{error:r}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async(e,t)=>{let{tenantId:a}=e,{signal:s}=t;try{const e=await window.api.getTabletDescribe(a,{signal:s}),{SchemeShard:t,PathId:n}=a;return{data:(null===e||void 0===e?void 0:e.Path)||`${t}:${n}`}}catch(n){return{error:n}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async(e,t)=>{let{id:a,hiveId:s}=e,{signal:n}=t;try{return{data:await window.api.getTabletFromHive({id:a,hiveId:s},{signal:n})}}catch(i){return{error:i}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async e=>{let{id:t}=e;try{return{data:await window.api.killTablet(t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.stopTablet(t,a)}}catch(s){return{error:s}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.resumeTablet(t,a)}}catch(s){return{error:s}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})}}]);