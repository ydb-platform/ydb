"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[5410],{65070:(e,t,s)=>{s.d(t,{U:()=>r});var i=s(68963),a=s(17176),n=s(68330),o=s(86793),l=s(45743),d=s(75859);function r(e){let{children:t,onConfirmAction:s,onConfirmActionSuccess:r,dialogHeader:c,dialogText:u,retryButtonText:v,buttonDisabled:p=!1,buttonView:h="action",buttonClassName:k,withPopover:D=!1,popoverContent:g,popoverPlacement:b="right",popoverDisabled:x=!0}=e;const[m,y]=i.useState(!1),[f,j]=i.useState(!1),[I,N]=i.useState(!1),w=()=>(0,d.jsx)(a.z,{onClick:()=>y(!0),view:h,disabled:p,loading:!p&&f,className:k,children:t});return(0,d.jsxs)(i.Fragment,{children:[(0,d.jsx)(o.g,{visible:m,header:c,text:u,withRetry:I,retryButtonText:v,onConfirm:async e=>{j(!0),await s(e)},onConfirmActionSuccess:async()=>{N(!1);try{await(null===r||void 0===r?void 0:r())}finally{j(!1)}},onConfirmActionError:e=>{N((0,l.q)(e)),j(!1)},onClose:()=>{y(!1)}}),D?(0,d.jsx)(n.J,{content:g,placement:b,disabled:x,children:w()}):w()]})}},86793:(e,t,s)=>{s.d(t,{g:()=>D});var i=s(68963),a=s(76506),n=s(71586),o=s(48897),l=s(25822),d=s(88776),r=s(24362),c=s(30817);const u=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),v=(0,c.wZ)("ydb-critical-action-dialog",{en:u});var p=s(75859);const h=(0,r.cn)("ydb-critical-dialog"),k=e=>403===e.status?v("no-rights-error"):e.statusText?e.statusText:v("default-error");function D(e){let{visible:t,header:s,text:r,withRetry:c,retryButtonText:u,withCheckBox:D,onClose:g,onConfirm:b,onConfirmActionSuccess:x,onConfirmActionError:m}=e;const[y,f]=i.useState(!1),[j,I]=i.useState(),[N,w]=i.useState(!1),S=async e=>(f(!0),b(e).then((()=>{x(),g()})).catch((e=>{m(e),I(e)})).finally((()=>{f(!1)})));return(0,p.jsx)(l.V,{open:t,hasCloseButton:!1,className:h(),size:"s",onClose:g,onTransitionExited:()=>{I(void 0),w(!1)},children:j?(0,p.jsxs)(i.Fragment,{children:[(0,p.jsx)(l.V.Header,{caption:s}),(0,p.jsx)(l.V.Body,{className:h("body"),children:(0,p.jsxs)("div",{className:h("body-message",{error:!0}),children:[(0,p.jsx)("span",{className:h("error-icon"),children:(0,p.jsx)(a.Z,{width:"24",height:"22"})}),k(j)]})}),(0,p.jsx)(l.V.Footer,{loading:!1,preset:"default",textButtonApply:c?u||v("button-retry"):void 0,textButtonCancel:v("button-close"),onClickButtonApply:()=>S(!0),onClickButtonCancel:g})]}):(0,p.jsxs)(i.Fragment,{children:[(0,p.jsx)(l.V.Header,{caption:s}),(0,p.jsxs)(l.V.Body,{className:h("body"),children:[(0,p.jsxs)("div",{className:h("body-message",{warning:!0}),children:[(0,p.jsx)("span",{className:h("warning-icon"),children:(0,p.jsx)(d.J,{data:n.Z,size:24})}),r]}),D?(0,p.jsx)(o.X,{checked:N,onUpdate:w,children:v("checkbox-text")}):null]}),(0,p.jsx)(l.V.Footer,{loading:y,preset:"default",textButtonApply:v("button-confirm"),textButtonCancel:v("button-cancel"),propsButtonApply:{type:"submit",disabled:D&&!N},onClickButtonCancel:g,onClickButtonApply:()=>S()})]})})}},45743:(e,t,s)=>{s.d(t,{q:()=>i});const i=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},30832:(e,t,s)=>{s.d(t,{a:()=>l});var i=s(24362),a=s(98366),n=s(75859);const o=(0,i.cn)("ydb-entity-page-title");function l(e){let{entityName:t,status:s,id:i,className:l}=e;return(0,n.jsxs)("div",{className:o(null,l),children:[(0,n.jsx)("span",{className:o("prefix"),children:t}),(0,n.jsx)(a.J,{className:o("icon"),status:s,size:"s"}),i]})}},91816:(e,t,s)=>{s.d(t,{b:()=>c});var i=s(68963),a=s(56711),n=s(24362),o=s(42587),l=s(75859);const d=(0,n.cn)("ydb-info-viewer-skeleton"),r=()=>(0,l.jsxs)("div",{className:d("label"),children:[(0,l.jsx)(a.O,{className:d("label__text")}),(0,l.jsx)("div",{className:d("label__dots")})]}),c=e=>{let{rows:t=8,className:s,delay:n=600}=e;const[c]=(0,o.$)(n);let u=(0,l.jsxs)(i.Fragment,{children:[(0,l.jsx)(r,{}),(0,l.jsx)(a.O,{className:d("value")})]});return c||(u=null),(0,l.jsx)("div",{className:d(null,s),children:[...new Array(t)].map(((e,t)=>(0,l.jsx)("div",{className:d("row"),children:u},`skeleton-row-${t}`)))})}},27174:(e,t,s)=>{s.d(t,{B:()=>v});var i=s(77796),a=s(24362),n=s(50422),o=s(56711),l=s(42587),d=s(75859);const r=e=>{let{delay:t=600,className:s}=e;const[i]=(0,l.$)(t);return i?(0,d.jsx)(o.O,{className:s}):null},c=(0,a.cn)("ydb-page-meta");function u(e){let{items:t,loading:s}=e;return(0,d.jsx)("div",{className:c("info"),children:s?(0,d.jsx)(r,{className:c("skeleton")}):t.filter((e=>Boolean(e))).join("\xa0\xa0\xb7\xa0\xa0")})}function v(e){let{className:t,...s}=e;return(0,d.jsxs)(i.k,{gap:1,alignItems:"center",justifyContent:"space-between",className:c(null,t),children:[(0,d.jsx)(u,{...s}),(0,d.jsx)(n.q,{})]})}},22200:(e,t,s)=>{s.d(t,{K:()=>y});s(68963);var i=s(54665),a=s(14146),n=s(5922),o=s(24362),l=s(34301),d=s(48169),r=s(92666),c=s(17096),u=s(55850),v=s(69214),p=s(62206),h=s(32270),k=s(67359),D=s(30817);const g=JSON.parse('{"slot-id":"VDisk Slot Id","pool-name":"Storage Pool Name","kind":"Kind","guid":"GUID","incarnation-guid":"Incarnation GUID","instance-guid":"Instance GUID","replication-status":"Replicated","state-status":"VDisk State","space-status":"Disk Space","fresh-rank-satisfaction":"Fresh Rank Satisfaction","level-rank-satisfaction":"Level Rank Satisfaction","front-queues":"Front Queues","has-unreadable-blobs":"Has Unreadable Blobs","size":"Size","read-throughput":"Read Throughput","write-throughput":"Write Throughput","links":"Links","vdisk-page":"VDisk Page","developer-ui":"Developer UI","yes":"Yes","no":"No","vdiks-title":"VDisk"}'),b=(0,D.wZ)("ydb-vDisk-info",{en:g});var x=s(75859);const m=(0,o.cn)("ydb-vdisk-info");function y(e){var t,s;let{data:o,withVDiskPageLink:r,withTitle:D,...g}=e;const y=(0,c.ix)(a.VH),{AllocatedSize:j,DiskSpace:I,FrontQueues:N,Guid:w,Replicated:S,VDiskState:V,VDiskSlotId:C,Kind:P,SatisfactionRank:B,AvailableSize:T,HasUnreadableBlobs:A,IncarnationGuid:F,InstanceGuid:R,StoragePoolName:$,ReadThroughput:q,WriteThroughput:z,PDiskId:G,NodeId:H}=o||{},_=[];var E,U;((0,n.D)(C)&&_.push({label:b("slot-id"),value:C}),(0,n.D)($)&&_.push({label:b("pool-name"),value:$}),(0,n.D)(V)&&_.push({label:b("state-status"),value:V}),Number(j)>=0&&Number(T)>=0&&_.push({label:b("size"),value:(0,x.jsx)(k.y,{value:j,capacity:Number(j)+Number(T),formatValues:l.q3,colorizeProgress:!0})}),(0,n.D)(P)&&_.push({label:b("kind"),value:P}),(0,n.D)(w)&&_.push({label:b("guid"),value:w}),(0,n.D)(F)&&_.push({label:b("incarnation-guid"),value:F}),(0,n.D)(R)&&_.push({label:b("instance-guid"),value:R}),(0,n.D)(S)&&_.push({label:b("replication-status"),value:b(S?"yes":"no")}),(0,n.D)(I)&&_.push({label:b("space-status"),value:(0,x.jsx)(v.A,{status:I})}),(0,n.D)(null===B||void 0===B||null===(t=B.FreshRank)||void 0===t?void 0:t.Flag))&&_.push({label:b("fresh-rank-satisfaction"),value:(0,x.jsx)(v.A,{status:null===B||void 0===B||null===(E=B.FreshRank)||void 0===E?void 0:E.Flag})});(0,n.D)(null===B||void 0===B||null===(s=B.LevelRank)||void 0===s?void 0:s.Flag)&&_.push({label:b("level-rank-satisfaction"),value:(0,x.jsx)(v.A,{status:null===B||void 0===B||null===(U=B.LevelRank)||void 0===U?void 0:U.Flag})});(0,n.D)(N)&&_.push({label:b("front-queues"),value:(0,x.jsx)(v.A,{status:N})}),(0,n.D)(A)&&_.push({label:b("has-unreadable-blobs"),value:b(A?"yes":"no")}),(0,n.D)(q)&&_.push({label:b("read-throughput"),value:(0,u.Qt)(q)}),(0,n.D)(z)&&_.push({label:b("write-throughput"),value:(0,u.Qt)(z)});if((0,n.D)(G)&&(0,n.D)(H)&&(0,n.D)(C)){const e=[];if(r){const t=(0,i.By)(C,G,H);e.push((0,x.jsx)(h.j,{title:b("vdisk-page"),url:t,external:!1},t))}if(y){const t=(0,d.yf)({nodeId:H,pDiskId:G,vDiskSlotId:C});e.push((0,x.jsx)(h.j,{title:b("developer-ui"),url:t},t))}e.length&&_.push({label:b("links"),value:(0,x.jsx)("div",{className:m("links"),children:e})})}const J=o&&D?(0,x.jsx)(f,{data:o}):null;return(0,x.jsx)(p._P,{info:_,title:J,...g})}function f(e){let{data:t}=e;return(0,x.jsxs)("div",{className:m("title"),children:[b("vdiks-title"),(0,x.jsx)(v.A,{status:(0,r.b2)(t.Severity),name:(0,l.a2)(t.VDiskId)})]})}},65410:(e,t,s)=>{s.r(t),s.d(t,{VDiskPage:()=>A});var i=s(68963),a=s(42154),n=s(88776),o=s(17095),l=s(49352),d=s(98994),r=s(65070),c=s(30832),u=s(26688),v=s(91816),p=s(27174),h=s(22200),k=s(905),D=s(14146),g=s(17880),b=s(79061),x=s(92666),m=s(3764),y=s(51688);const f=k.h.injectEndpoints({endpoints:e=>({getVDiskData:e.query({queryFn:async(e,t)=>{let{nodeId:s,pDiskId:i,vDiskSlotId:a}=e,{signal:n}=t;try{const e=function(e){var t,s,i,a,n,o,l;let[d,r,c]=e;const u=null===(t=d.VDiskStateInfo)||void 0===t?void 0:t[0],v=(0,m.w)(u),p=null===(s=r.PDiskStateInfo)||void 0===s?void 0:s[0],h=(0,m.b)(p),k=null===(i=c.SystemStateInfo)||void 0===i?void 0:i[0],D=(0,y.Ns)(k),g=null!==(a=null!==(n=v.NodeId)&&void 0!==n?n:h.NodeId)&&void 0!==a?a:D.NodeId,b=D.Host,x=null===(o=D.Roles)||void 0===o?void 0:o[0],f=D.DC,j=null!==(l=v.PDiskId)&&void 0!==l?l:h.PDiskId,I=h.Type;return{...v,NodeId:g,NodeHost:b,NodeType:x,NodeDC:f,PDiskId:j,PDiskType:I}}(await Promise.all([window.api.getVDiskInfo({nodeId:s,pDiskId:i,vDiskSlotId:a},{signal:n}),window.api.getNodeWhiteboardPDiskInfo({nodeId:s,pDiskId:i},{signal:n}),window.api.getNodeInfo(s,{signal:n})]));return{data:e}}catch(o){return{error:o}}},providesTags:(e,t,s)=>["All",{type:"VDiskData",id:(0,x.FR)(s.nodeId,s.pDiskId,s.vDiskSlotId)}]})}),overrideExisting:"throw"});var j=s(5922),I=s(24362),N=s(34301),w=s(17096),S=s(57180),V=s(30817);const C=JSON.parse('{"fqdn":"FQDN","node":"Node","pdisk":"PDisk","vdisk":"VDisk","storage":"Storage","evict-vdisk-button":"Evict VDisk","force-evict-vdisk-button":"Evict anyway","evict-vdisk-dialog-header":"Evict VDisk","evict-vdisk-dialog-text":"VDisk will be evicted. Do you want to proceed?","evict-vdisk-not-allowed":"You don\'t have enough rights to evict VDisk"}'),P=(0,V.wZ)("ydb-vDisk-page",{en:C});var B=s(75859);const T=(0,I.cn)("ydb-vdisk-page");function A(){const e=(0,w.zL)(),t=(0,w.ix)(D.VH),s=(0,g.X_)(),[{nodeId:m,pDiskId:y,vDiskSlotId:I}]=(0,d.useQueryParams)({nodeId:d.StringParam,pDiskId:d.StringParam,vDiskSlotId:d.StringParam});i.useEffect((()=>{e((0,b.J)("vDisk",{nodeId:m,pDiskId:y,vDiskSlotId:I}))}),[e,m,y,I]);const[V]=(0,w.Rj)(),C=(0,j.D)(m)&&(0,j.D)(y)&&(0,j.D)(I)?{nodeId:m,pDiskId:y,vDiskSlotId:I}:o.CN,{currentData:A={},isFetching:F,error:R}=f.useGetVDiskDataQuery(C,{pollingInterval:V}),$=F&&void 0===A,{NodeHost:q,NodeId:z,NodeType:G,NodeDC:H,PDiskId:_,PDiskType:E,Severity:U,VDiskId:J}=A,{GroupID:O,GroupGeneration:Q,Ring:L,Domain:Z,VDisk:K}=J||{},Y=(0,j.D)(O)&&(0,j.D)(Q)&&(0,j.D)(L)&&(0,j.D)(Z)&&(0,j.D)(K),W=async e=>{if(Y)return window.api[s?"evictVDisk":"evictVDiskOld"]({groupId:O,groupGeneration:Q,failRealmIdx:L,failDomainIdx:Z,vDiskIdx:K,force:e}).then((e=>{if(!1===(null===e||void 0===e?void 0:e.result)){throw{statusText:e.error,retryPossible:e.forceRetryPossible}}}))},M=()=>{e(k.h.util.invalidateTags([{type:"VDiskData",id:(0,x.FR)(m||0,y||0,I||0)},"StorageData"]))};return(0,B.jsxs)("div",{className:T(null),children:[(()=>{const e=I?`${P("vdisk")} ${I}`:P("vdisk"),t=y?`${P("pdisk")} ${y}`:P("pdisk"),s=q||P("node");return(0,B.jsx)(l.ql,{titleTemplate:`%s - ${e} - ${t} \u2014 ${s} \u2014 YDB Monitoring`,defaultTitle:`${e} - ${t} \u2014 ${s} \u2014 YDB Monitoring`})})(),(()=>{const e=q?`${P("fqdn")}: ${q}`:void 0,t=z?`${P("node")}: ${z}`:void 0,s=z?`${P("pdisk")}: ${_}`:void 0;return(0,B.jsx)(p.B,{className:T("meta"),loading:$,items:[e,t,G,H,s,E]})})(),(0,B.jsx)(c.a,{className:T("title"),entityName:P("vdisk"),status:(0,x.b2)(U),id:(0,N.a2)(null===A||void 0===A?void 0:A.VDiskId)}),(0,B.jsx)("div",{className:T("controls"),children:(0,B.jsxs)(r.U,{onConfirmAction:W,onConfirmActionSuccess:M,buttonDisabled:!Y||!t,buttonView:"normal",dialogHeader:P("evict-vdisk-dialog-header"),dialogText:P("evict-vdisk-dialog-text"),retryButtonText:P("force-evict-vdisk-button"),withPopover:!0,popoverContent:P("evict-vdisk-not-allowed"),popoverDisabled:t,children:[(0,B.jsx)(n.J,{data:a.Z}),P("evict-vdisk-button")]})}),$?(0,B.jsx)(v.b,{rows:20}):(0,B.jsxs)(i.Fragment,{children:[R?(0,B.jsx)(u.V,{error:R}):null,(0,B.jsx)(h.K,{data:A,className:T("info")}),(0,j.D)(O)&&(0,j.D)(m)?(0,B.jsxs)(i.Fragment,{children:[(0,B.jsx)("div",{className:T("storage-title"),children:P("storage")}),(0,B.jsx)(S.K,{groupId:O,nodeId:m})]}):null]})]})}}}]);