"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[5426],{21711:(e,s,t)=>{t.d(s,{b:()=>u});var r=t(34706),n=t(5194),l=t(99294),a=t(83658),o=t(10161);const i=(0,l.cn)("ydb-info-viewer-skeleton"),d=()=>(0,o.jsxs)("div",{className:i("label"),children:[(0,o.jsx)(n.O,{className:i("label__text")}),(0,o.jsx)("div",{className:i("label__dots")})]}),u=e=>{let{rows:s=8,className:t,delay:l=600}=e;const[u]=(0,a.$)(l);let c=(0,o.jsxs)(r.Fragment,{children:[(0,o.jsx)(d,{}),(0,o.jsx)(n.O,{className:i("value")})]});return u||(c=null),(0,o.jsx)("div",{className:i(null,t),children:[...new Array(s)].map(((e,s)=>(0,o.jsx)("div",{className:i("row"),children:c},`skeleton-row-${s}`)))})}},26107:(e,s,t)=>{t.d(s,{$:()=>i});t(34706);var r=t(99294),n=t(10161);const l=(0,r.cn)("tag"),a=e=>{let{text:s,type:t}=e;return(0,n.jsx)("div",{className:l({type:t}),children:s})},o=(0,r.cn)("tags"),i=e=>{let{tags:s,tagsType:t,className:r=""}=e;return(0,n.jsx)("div",{className:o(null,r),children:s&&s.map(((e,s)=>(0,n.jsx)(a,{text:e,type:t},s)))})}},26001:(e,s,t)=>{t.r(s),t.d(s,{Cluster:()=>Ye});var r=t(34706),n=t(5194),l=t(72555),a=t(42152),o=t(55783),i=t(99495),d=t(74003),u=t(62508),c=t(67653),v=t(46878),m=t(10730),h=t(85709),p=t(99294),x=t(55842),j=t(80819),N=t(26612),g=t(35120),b=t(72427),y=t(71624),f=t(72616),T=t(34973),C=t(15327),w=t(91538),S=t(31580),P=t(52154),k=t(74116),E=t(17784),O=t(74640),A=t(78276),D=t(32341),L=t(67386),M=t(78171),V=t.n(M),I=t(77468),G=t(27810),z=t(14739);const Z=(0,L.P1)((e=>e),(e=>z.Xv.endpoints.getTenantsInfo.select({clusterName:e}))),F=(0,L.P1)((e=>e),((e,s)=>Z(s)),(e=>(0,D.Cx)(e,G.Zy)),((e,s,t)=>{var r;const n=null!==(r=s(e).data)&&void 0!==r?r:[];return!t&&n.length>1?n.filter((e=>"Domain"!==e.Type)):n})),B=e=>e.tenants.searchValue,R=(0,L.P1)([F,D.qz,B],((e,s,t)=>{let r=((e,s)=>s===D.pu.ALL?e:e.filter((e=>e.Overall&&e.Overall!==I.K.Green)))(e,s);return r=((e,s)=>e.filter((e=>{const t=new RegExp(V()(s),"i");return t.test(e.Name||"")||t.test(e.controlPlaneName)})))(r,t),r}));var $=t(14075),U=t(60064),W=t(10161);const H=(0,p.cn)("tenants"),_=e=>{let{additionalTenantsProps:s}=e;const t=(0,x.zL)(),[n]=(0,x.Rj)(),{currentData:l,isFetching:a,error:o}=z.Xv.useGetTenantsInfoQuery({clusterName:A.qw},{pollingInterval:n}),i=a&&void 0===l,d=(0,x.ix)((e=>F(e,A.qw))),c=(0,x.ix)(B),v=(0,x.ix)((e=>R(e,A.qw))),m=(0,x.ix)(D.qz),h=e=>{t((0,D.M6)(e))},p=e=>{t((0,z.gI)(e))};return(0,W.jsxs)(O.l,{children:[(0,W.jsx)(O.l.Controls,{children:(0,W.jsxs)(r.Fragment,{children:[(0,W.jsx)(E.o,{value:c,onChange:p,placeholder:"Database name",className:H("search")}),(0,W.jsx)(P.T,{value:m,onChange:h}),(0,W.jsx)(T.C,{total:d.length,current:(null===v||void 0===v?void 0:v.length)||0,label:"Databases",loading:i})]})}),o?(0,W.jsx)(C.V,{error:o}):null,(0,W.jsx)(O.l.Table,{loading:i,children:l?(()=>{const e=[{name:"Name",header:"Database",render:e=>{var t;let{row:r}=e;const n=(e=>{var t,r;if("function"!==typeof(null===s||void 0===s?void 0:s.prepareTenantBackend))return;let n=null!==(t=e.MonitoringEndpoint)&&void 0!==t?t:e.backend;const l=null!==(r=e.NodeIds)&&void 0!==r?r:e.sharedNodeIds;!n&&l&&l.length>0&&(n={NodeId:l[Math.floor(Math.random()*l.length)]});return s.prepareTenantBackend(n)})(r),l=Boolean(n);return(0,W.jsx)(u.A,{externalLink:l,className:H("name"),name:r.Name||"unknown database",withLeftTrim:!0,status:r.Overall,hasClipboardButton:!0,path:(0,U.Sj)({name:r.Name,backend:n}),additionalControls:null===s||void 0===s||null===(t=s.getMonitoringLink)||void 0===t?void 0:t.call(s,r.Name,r.Type)})},width:440,sortable:!0,defaultOrder:y.ZP.DESCENDING},{name:"controlPlaneName",header:"Name",render:e=>{let{row:s}=e;return s.controlPlaneName},width:200,sortable:!0,defaultOrder:y.ZP.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:e=>{let{row:s}=e;return"Serverless"!==s.Type?s.Type:(0,W.jsxs)("div",{className:H("type"),children:[(0,W.jsx)("span",{className:H("type-value"),children:s.Type}),(0,W.jsx)(f.z,{className:H("type-button"),onClick:()=>p(s.sharedTenantName||""),children:"Show shared"})]})}},{name:"State",width:90,render:e=>{let{row:s}=e;return s.State?s.State.toLowerCase():"\u2014"},customStyle:()=>({textTransform:"capitalize"})},{name:"cpu",header:"CPU",width:80,render:e=>{let{row:s}=e;return s.cpu&&s.cpu>1e4?(0,$.LO)(s.cpu):"\u2014"},align:y.ZP.RIGHT,defaultOrder:y.ZP.DESCENDING},{name:"memory",header:"Memory",width:120,render:e=>{let{row:s}=e;return s.memory?(0,$.q3)(s.memory):"\u2014"},align:y.ZP.RIGHT,defaultOrder:y.ZP.DESCENDING},{name:"storage",header:"Storage",width:120,render:e=>{let{row:s}=e;return s.storage?(0,$.q3)(s.storage):"\u2014"},align:y.ZP.RIGHT,defaultOrder:y.ZP.DESCENDING},{name:"nodesCount",header:"Nodes",width:100,render:e=>{let{row:s}=e;return s.nodesCount?(0,$.uf)(s.nodesCount):"\u2014"},align:y.ZP.RIGHT,defaultOrder:y.ZP.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:e=>{let{row:s}=e;return s.groupsCount?(0,$.uf)(s.groupsCount):"\u2014"},align:y.ZP.RIGHT,defaultOrder:y.ZP.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:e=>{let{PoolStats:s=[]}=e;return s.reduce(((e,s)=>e+(s.Usage||0)),0)},defaultOrder:y.ZP.DESCENDING,align:y.ZP.LEFT,render:e=>{let{row:s}=e;return(0,W.jsx)(S.m,{pools:s.PoolStats})}}];return 0===v.length&&m!==D.pu.ALL?(0,W.jsx)(w.Q,{name:"thumbsUp",width:"200"}):(0,W.jsx)(k.G,{columnsWidthLSKey:"databasesTableColumnsWidth",data:v,columns:e,settings:G.LE,emptyDataMessage:"No such tenants"})})():null})]})};var q=t(67661),Q=t(19912),Y=t(66498),K=t(88366),X=t(83202),J=t(20760),ee=t(96183),se=t(75544);const te=[{name:"NodeId",header:"#",width:80,resizeMinWidth:80,align:y.ZP.LEFT,render:e=>{let{row:s}=e;return s.NodeId}},{name:"Host",render:e=>{var s;let{row:t}=e;const r=t.Endpoints&&(null===(s=t.Endpoints.find((e=>"http-mon"===e.Name)))||void 0===s?void 0:s.Address),n=t.Host&&`${t.Host}${r||""}`||"unknown",l=!(0,ee.TA)(t)&&t.NodeId?(0,se.a3)(t.NodeId):void 0;return(0,W.jsx)(u.A,{name:n,path:l,hasClipboardButton:!0,showStatus:!1})},width:400,align:y.ZP.LEFT},{name:"Endpoints",sortable:!1,render:e=>{let{row:s}=e;return s.Endpoints?s.Endpoints.map((e=>{let{Name:s,Address:t}=e;return`${s} ${t}`})).join(", "):"-"},width:300,align:y.ZP.LEFT},{name:"Uptime",header:"Uptime",sortAccessor:e=>{let{StartTime:s}=e;return s&&-s},width:120,align:y.ZP.LEFT,render:e=>{let{row:s}=e;return s.Uptime}},{name:"MemoryUsed",header:"Memory used",sortAccessor:e=>{let{MemoryUsed:s=0}=e;return Number(s)},defaultOrder:y.ZP.DESCENDING,render:e=>{let{row:s}=e;return s.MemoryUsed?(0,$.td)(s.MemoryUsed):"\u2014"},width:120,align:y.ZP.RIGHT},{name:"MemoryLimit",header:"Memory limit",sortAccessor:e=>{let{MemoryLimit:s=0}=e;return Number(s)},defaultOrder:y.ZP.DESCENDING,render:e=>{let{row:s}=e;return s.MemoryLimit?(0,$.td)(s.MemoryLimit):"\u2014"},width:120,align:y.ZP.RIGHT},{name:"PoolStats",header:"Pools",sortAccessor:e=>{let{PoolStats:s=[]}=e;return s.reduce(((e,s)=>e+(s.Usage||0)),0)},defaultOrder:y.ZP.DESCENDING,width:80,resizeMinWidth:60,render:e=>{let{row:s}=e;return s.PoolStats?(0,W.jsx)(S.m,{pools:s.PoolStats}):"\u2014"},align:y.ZP.LEFT},{name:"LoadAverage",header:"Load average",sortAccessor:e=>{let{LoadAveragePercents:s=[]}=e;return s[0]},defaultOrder:y.ZP.DESCENDING,width:140,resizeMinWidth:140,render:e=>{let{row:s}=e;return s.LoadAveragePercents&&s.LoadAveragePercents.length>0?(0,W.jsx)(J.y,{value:s.LoadAveragePercents[0],percents:!0,capacity:100,colorizeProgress:!0}):"\u2014"},align:y.ZP.LEFT}],re=e=>{let{nodes:s}=e;return(0,W.jsx)(k.G,{columnsWidthLSKey:"versionsTableColumnsWidth",data:s,columns:te,settings:G.LE})};var ne=t(30963),le=t(47329);const ae=(0,p.cn)("ydb-versions-nodes-tree-title"),oe=e=>{let s,{title:t,nodes:r,items:n,versionColor:l,versionsValues:a}=e;return s=n?n.reduce(((e,s)=>s.nodes?e+s.nodes.length:e),0):r?r.length:0,(0,W.jsxs)("div",{className:ae("overview"),children:[(0,W.jsxs)("div",{className:ae("overview-container"),children:[l?(0,W.jsx)("div",{className:ae("version-color"),style:{background:l}}):null,t?(0,W.jsxs)("span",{className:ae("overview-title"),children:[t,(0,W.jsx)(le.m,{text:t,size:"s",className:ae("clipboard-button")})]}):null]}),(0,W.jsxs)("div",{className:ae("overview-info"),children:[(0,W.jsxs)("div",{children:[(0,W.jsx)("span",{className:ae("info-value"),children:s}),(0,W.jsx)("span",{className:ae("info-label",{margin:"left"}),children:"Nodes"})]}),a?(0,W.jsxs)("div",{className:ae("version-progress"),children:[(0,W.jsx)("span",{className:ae("info-label",{margin:"right"}),children:"Versions"}),(0,W.jsx)(ne.E,{size:"s",value:100,stack:a})]}):null]})]})},ie=(0,p.cn)("ydb-versions-grouped-node-tree"),de=e=>{let{title:s,nodes:t,items:n,expanded:l=!1,versionColor:a,versionsValues:o,level:i=0}=e;const[d,u]=r.useState(!1);r.useEffect((()=>{u(l)}),[l]);const c=(0,W.jsx)(oe,{title:s,nodes:t,items:n,versionColor:a,versionsValues:o}),v=()=>{u((e=>!e))};return n?(0,W.jsx)("div",{className:ie({"first-level":0===i}),children:(0,W.jsx)(X.L,{name:c,collapsed:!d,hasArrow:!0,onClick:v,onArrowClick:v,children:n.map(((e,s)=>(0,W.jsx)(de,{title:e.title,nodes:e.nodes,expanded:l,versionColor:e.versionColor,level:i+1},s)))},s)}):(0,W.jsx)("div",{className:ie({"first-level":0===i}),children:(0,W.jsx)(X.L,{name:c,collapsed:!d,hasArrow:!0,onClick:v,onArrowClick:v,children:(0,W.jsx)("div",{className:ie("dt-wrapper"),children:(0,W.jsx)(re,{nodes:t||[]})})},s)})};var ue=t(69144),ce=t.n(ue),ve=t(58274);const me=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=arguments.length>1?arguments[1]:void 0;const t=e.reduce(((e,s)=>(s.Version&&(e[s.Version]?e[s.Version]=e[s.Version]+1:e[s.Version]=1),e)),{});return Object.keys(t).map((r=>({title:r,version:r,color:null===s||void 0===s?void 0:s.get((0,ve.H)(r)),value:t[r]/e.length*100})))};function he(e,s,t){const r=null!==t&&void 0!==t?t:e.reduce(((e,s)=>e+s.count),0);return e.map((e=>({title:e.name,version:e.name,color:null===s||void 0===s?void 0:s.get(e.name),value:e.count/r*100})))}let pe;!function(e){e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage"}(pe||(pe={}));const xe=(e,s)=>{var t;return(null===(t=e.title)||void 0===t?void 0:t.localeCompare(s.title||""))||-1},je=(0,p.cn)("ydb-versions"),Ne=e=>{let{versionToColor:s}=e;const[t]=(0,x.Rj)(),{currentData:n,isLoading:l}=K.k.useGetNodesQuery({tablets:!1},{pollingInterval:t}),a=null===n||void 0===n?void 0:n.Nodes,[o,i]=r.useState(pe.VERSION),[d,u]=r.useState(!1),c=e=>{i(e)};if(l)return(0,W.jsx)(Y.a,{});const v=((e,s,t)=>{if(e&&e.length){if(t===pe.VERSION){const t=ce()(e,"Version");return Object.keys(t).map((e=>{const r=t[e].filter((e=>{let{Tenants:s}=e;return Boolean(s)})),n=ce()(r,"Tenants"),l=Object.keys(n).map((e=>({title:e,nodes:n[e]}))).sort(xe);return l.length?{title:e,items:l,versionColor:null===s||void 0===s?void 0:s.get((0,ve.H)(e))}:null})).filter((e=>Boolean(e)))}{const t=e.filter((e=>{let{Tenants:s}=e;return Boolean(s)})),r=ce()(t,"Tenants");return Object.keys(r).map((e=>{const t=me(r[e],s),n=ce()(r[e],"Version"),l=Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:null===s||void 0===s?void 0:s.get((0,ve.H)(e))})));return l.length?{title:e,items:l,versionsValues:t}:null})).filter((e=>Boolean(e))).sort(xe)}}})(a,s,o),m=((e,s)=>{if(!e||!e.length)return;const t=e.filter((e=>{let{Roles:s}=e;return null===s||void 0===s?void 0:s.includes("Storage")})),r=ce()(t,"Version");return Object.keys(r).map((e=>({title:e,nodes:r[e],versionColor:null===s||void 0===s?void 0:s.get((0,ve.H)(e))})))})(a,s),h=((e,s)=>{if(!e||!e.length)return;const t=e.filter((e=>{let{Roles:s}=e;return!s})),r=ce()(t,"Version");return Object.keys(r).map((e=>({title:e,nodes:r[e],versionColor:null===s||void 0===s?void 0:s.get((0,ve.H)(e))})))})(a,s),p=null!==m&&void 0!==m&&m.length?(0,W.jsxs)(r.Fragment,{children:[(0,W.jsx)("h3",{children:"Storage nodes"}),m.map((e=>{let{title:s,nodes:t,items:r,versionColor:n}=e;return(0,W.jsx)(de,{title:s,nodes:t,items:r,versionColor:n},`storage-nodes-${s}`)}))]}):null,j=null!==v&&void 0!==v&&v.length?(0,W.jsxs)(r.Fragment,{children:[(0,W.jsx)("h3",{children:"Database nodes"}),(0,W.jsxs)("div",{className:je("controls"),children:[(0,W.jsxs)("div",{className:je("group"),children:[(0,W.jsx)("span",{className:je("label"),children:"Group by:"}),(0,W.jsxs)(q.E,{value:o,onUpdate:c,children:[(0,W.jsx)(q.E.Option,{value:pe.TENANT,children:pe.TENANT}),(0,W.jsx)(q.E.Option,{value:pe.VERSION,children:pe.VERSION})]})]}),(0,W.jsx)(Q.X,{className:je("checkbox"),onChange:()=>u((e=>!e)),checked:d,children:"All expanded"})]}),v.map((e=>{let{title:s,nodes:t,items:r,versionColor:n,versionsValues:l}=e;return(0,W.jsx)(de,{title:s,nodes:t,items:r,expanded:d,versionColor:n,versionsValues:l},`tenant-nodes-${s}`)}))]}):null,N=null!==h&&void 0!==h&&h.length?(0,W.jsxs)(r.Fragment,{children:[(0,W.jsx)("h3",{children:"Other nodes"}),h.map((e=>{let{title:s,nodes:t,items:r,versionColor:n,versionsValues:l}=e;return(0,W.jsx)(de,{title:s,nodes:t,items:r,versionColor:n,versionsValues:l},`other-nodes-${s}`)}))]}):null;return(0,W.jsxs)("div",{className:je("versions"),children:[p,j,N]})};var ge=t(43862),be=t(21711);const ye=(0,p.cn)("cluster-info");var fe=t(64485),Te=t(90808),Ce=t(43926),we=t(56043),Se=t(93060);const Pe=(0,p.cn)("tablet"),ke=e=>{var s;let{tablet:t={},tenantName:r}=e;const{TabletId:n,NodeId:l,Type:a}=t,o=null===(s=t.Overall)||void 0===s?void 0:s.toLowerCase(),i=n&&(0,v.fK)(n,{nodeId:l,tenantName:r,type:a});return(0,W.jsx)(Ce.f,{className:Pe("wrapper"),content:(0,W.jsx)(Se.Fb,{data:t,className:Pe("popup-content")}),children:(0,W.jsx)(c.h,{to:i,children:(0,W.jsx)(we.v,{className:Pe({status:o}),text:(0,G.qV)(t.Type)})})})};var Ee=t(26107),Oe=t(39242),Ae=t(9038);const De=(0,p.cn)("ydb-cluster-versions-bar"),Le=e=>{let{versionsValues:s=[]}=e;return(0,W.jsxs)("div",{className:De(),children:[(0,W.jsx)(ne.E,{value:100,stack:s,size:"s"}),(0,W.jsx)("div",{className:De("versions"),children:s.map(((e,t)=>(0,W.jsx)("div",{className:De("version-title"),style:{color:e.color},title:e.version,children:`${e.version}${t===s.length-1?"":","}`},e.version)))})]})};var Me=t(37711);const Ve=JSON.parse('{"disk-type":"Disk Type","erasure":"Erasure","allocated":"Allocated","available":"Available","usage":"Usage","dc":"DC","tablets":"Tablets","databases":"Databases","nodes":"Nodes","nodes-state":"Nodes state","load":"Load","storage-size":"Storage size","storage-groups":"Storage groups, {{diskType}}","links":"Links","versions":"Versions","quantity":{"one":"{{count}} node","other":"{{count}} nodes","zero":"no nodes"}}'),Ie=(0,Me.wZ)("ydb-cluster",{en:Ve});var Ge=t(41591),ze=t(10142);const Ze=(0,p.cn)("ydb-disk-groups-stats"),Fe=e=>{let{stats:s}=e;return(0,W.jsx)("div",{className:Ze(),children:Object.values(s).map((e=>(0,W.jsx)(Ce.f,{placement:["right"],content:(0,W.jsx)(Be,{stats:e}),children:(0,W.jsx)(J.y,{className:Ze("bar"),value:e.createdGroups,capacity:e.totalGroups})},e.erasure)))})};function Be(e){let{stats:s}=e;const{diskType:t,erasure:r,allocatedSize:n,availableSize:l}=s,a=(0,ze.dT)(Math.max(n,l),2),o=(0,ze.td)({value:n,size:a}),i=(0,ze.td)({value:l,size:a}),d=Math.round(n/(n+l)*100),u=[{label:Ie("disk-type"),value:t},{label:Ie("erasure"),value:r},{label:Ie("allocated"),value:o},{label:Ie("available"),value:i},{label:Ie("usage"),value:d+"%"}];return(0,W.jsx)(Ge._P,{dots:!0,info:u,className:Ze("popup-content"),size:"s"})}const Re=(0,p.cn)("ydb-nodes-state");function $e(e){let{state:s,children:t}=e;return(0,W.jsx)("div",{className:Re({[s.toLowerCase()]:!0}),children:t})}const Ue={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},We=(e,s)=>e.Type===Ae.F.TxAllocator?1:s.Type===Ae.F.TxAllocator?-1:0,He=(e,s,t,n,l)=>{const a=[],o=(e=>{var s;return(0,Oe.j)(e)&&e.MapDataCenters?Object.entries(e.MapDataCenters).map((e=>{let[s,t]=e;return(0,W.jsxs)(r.Fragment,{children:[s,": ",(0,W.jsx)("span",{className:ye("dc-count"),children:Ie("quantity",{count:t})})]},s)})):null===(s=e.DataCenters)||void 0===s?void 0:s.filter(Boolean)})(e);if(null!==o&&void 0!==o&&o.length&&a.push({label:Ie("dc"),value:(0,W.jsx)(Ee.$,{tags:o})}),e.SystemTablets){const s=e.SystemTablets.slice(0).sort(We);a.push({label:Ie("tablets"),value:(0,W.jsx)("div",{className:ye("system-tablets"),children:s.map(((e,s)=>(0,W.jsx)(ke,{tablet:e},s)))})})}if(e.Tenants&&a.push({label:Ie("databases"),value:e.Tenants}),a.push({label:Ie("nodes"),value:(0,W.jsx)(J.y,{value:null===e||void 0===e?void 0:e.NodesAlive,capacity:null===e||void 0===e?void 0:e.NodesTotal})}),(0,Oe.j)(e)&&e.MapNodeStates){const s=Object.entries(e.MapNodeStates);s.sort(((e,s)=>Ue[s[0]]-Ue[e[0]]));const t=s.map((e=>{let[s,t]=e;return(0,W.jsx)($e,{state:s,children:t},s)}));a.push({label:Ie("nodes-state"),value:(0,W.jsx)("div",{className:ye("nodes-states"),children:t})})}a.push({label:Ie("load"),value:(0,W.jsx)(J.y,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null===e||void 0===e?void 0:e.NumberOfCpus})});const i=(e=>{if((0,Oe.j)(e)&&e.MapDataCenters){const{MapStorageTotal:s,MapStorageUsed:t}=e,r=new Set(Object.keys(null!==s&&void 0!==s?s:[]).concat(Object.keys(null!==t&&void 0!==t?t:[])));if(r.size>0)return Array.from(r).reduce(((e,r)=>(e[r]={used:null===t||void 0===t?void 0:t[r],total:null===s||void 0===s?void 0:s[r]},e)),{})}return{_default:{used:null===e||void 0===e?void 0:e.StorageUsed,total:null===e||void 0===e?void 0:e.StorageTotal}}})(e);return Object.entries(i).forEach((e=>{let[s,t]=e,r=Ie("storage-size");"_default"!==s&&(r+=`, ${s}`),a.push({label:r,value:(0,W.jsx)(J.y,{value:t.used,capacity:t.total,formatValues:$.QO})})})),Object.keys(t).length&&a.push(...(e=>Object.keys(e).map((s=>({label:Ie("storage-groups",{diskType:s}),value:(0,W.jsx)(Fe,{stats:e[s]})}))))(t)),a.push(...n,{label:Ie("links"),value:(0,W.jsx)("div",{className:ye("links"),children:l.map((e=>{let{title:s,url:t}=e;return(0,W.jsx)(Te.j,{title:s,url:t},s)}))})},{label:Ie("versions"),value:(0,W.jsx)(Le,{versionsValues:s.filter((e=>"unknown"!==e.title))})}),a},_e=e=>{let{cluster:s,versionToColor:t,groupsStats:n={},loading:l,error:a,additionalClusterProps:o={}}=e;const i=(0,x.ix)((e=>e.singleClusterMode)),d=((e,s)=>{const{currentData:t}=K.k.useGetNodesQuery((0,Oe.j)(e)?fe.CN:{tablets:!1,group:"Version"});return r.useMemo((()=>(0,Oe.j)(e)&&e.MapVersions?he(Object.entries(e.MapVersions).map((e=>{let[s,t]=e;return{name:s,count:t}})),s,e.NodesTotal):t?Array.isArray(t.NodeGroups)?he(t.NodeGroups,s,null===e||void 0===e?void 0:e.NodesTotal):me(t.Nodes,s):[]),[t,s,e])})(s,t);let u=A.y3+"/internal";i&&!A.j4&&(u="/internal");const{info:c=[],links:v=[]}=o,m=He(null!==s&&void 0!==s?s:{},d,n,c,[{title:G.Ah,url:u},...v]);return(0,W.jsxs)("div",{className:ye(),children:[a?(0,W.jsx)(C.V,{error:a,className:ye("error")}):null,(0,W.jsx)("div",{className:ye("info"),children:l?(0,W.jsx)(be.b,{className:ye("skeleton"),rows:9}):a&&!s?null:(0,W.jsx)(ge._,{dots:!0,info:m})})]})};var qe=t(4128);const Qe=(0,p.cn)("cluster");function Ye(e){var s;let{additionalClusterProps:t,additionalTenantsProps:p,additionalNodesProps:y,additionalVersionsProps:f}=e;const T=r.useRef(null),C=(0,x.zL)(),w=function(){const e=(0,x.zL)(),s=(0,x.ix)((e=>e.cluster.defaultClusterTab)),t=(0,o.$B)(v.ZP.cluster),{activeTab:n}=(null===t||void 0===t?void 0:t.params)||{};let l;l=(0,qe.V2)(n)?n:s;return r.useEffect((()=>{l!==s&&e((0,m.LQ)(l))}),[l,s,e]),l}(),[{clusterName:S,backend:P}]=(0,i.useQueryParams)({clusterName:i.StringParam,backend:i.StringParam}),k=(0,x.ix)((e=>(0,m.le)(e,null!==S&&void 0!==S?S:void 0))),{data:{clusterData:E={},groupsStats:O}={},isLoading:A,error:D}=m.UM.useGetClusterInfoQuery(null!==S&&void 0!==S?S:void 0),L=D&&"object"===typeof D?D:void 0;r.useEffect((()=>{C((0,h.J)("cluster",{}))}),[C]);const M=r.useMemo((()=>null!==f&&void 0!==f&&f.getVersionToColorMap?null===f||void 0===f?void 0:f.getVersionToColorMap():(0,j.ZP)(null===E||void 0===E?void 0:E.Versions)),[f,E]),V=r.useMemo((()=>qe._Y.find((e=>{let{id:s}=e;return s===w}))),[w]);return(0,W.jsxs)("div",{className:Qe(),ref:T,children:[(0,W.jsx)(a.ql,{defaultTitle:`${k} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${k} \u2014 YDB Monitoring`,children:V?(0,W.jsx)("title",{children:V.title}):null}),(0,W.jsx)("div",{className:Qe("header"),children:A?(0,W.jsx)(n.O,{className:Qe("title-skeleton")}):(0,W.jsx)(u.A,{size:"m",status:null===E||void 0===E?void 0:E.Overall,name:k,className:Qe("title")})}),(0,W.jsx)("div",{className:Qe("tabs"),children:(0,W.jsx)(l.m,{size:"l",allowNotSelected:!0,activeTab:w,items:qe._Y,wrapTo:(e,s)=>{let{id:t}=e;const r=(0,qe.B7)(t,{clusterName:S,backend:P});return(0,W.jsx)(c.h,{to:r,onClick:()=>{C((0,m.LQ)(t))},children:s},t)}})}),(0,W.jsx)("div",{className:Qe("sticky-wrapper"),children:(0,W.jsx)(d.q,{className:Qe("auto-refresh-control")})}),(0,W.jsxs)(o.rs,{children:[(0,W.jsx)(o.AW,{path:(0,v.Fz)((0,qe.B7)(qe.xu.overview)).pathname,children:(0,W.jsx)(_e,{cluster:E,groupsStats:O,versionToColor:M,loading:A,error:L,additionalClusterProps:t})}),(0,W.jsx)(o.AW,{path:(0,v.Fz)((0,qe.B7)(qe.xu.tablets)).pathname,children:(0,W.jsxs)("div",{className:Qe("tablets"),children:[(0,W.jsx)("div",{className:Qe("fake-block")}),(0,W.jsx)(b.O,{tablets:null!==(s=E.SystemTablets)&&void 0!==s?s:[],className:Qe("tablets-table")})]})}),(0,W.jsx)(o.AW,{path:(0,v.Fz)((0,qe.B7)(qe.xu.tenants)).pathname,children:(0,W.jsx)(_,{additionalTenantsProps:p})}),(0,W.jsx)(o.AW,{path:(0,v.Fz)((0,qe.B7)(qe.xu.nodes)).pathname,children:(0,W.jsx)(N.G,{parentRef:T,additionalNodesProps:y})}),(0,W.jsx)(o.AW,{path:(0,v.Fz)((0,qe.B7)(qe.xu.storage)).pathname,children:(0,W.jsx)(g.V,{parentRef:T})}),(0,W.jsx)(o.AW,{path:(0,v.Fz)((0,qe.B7)(qe.xu.versions)).pathname,children:(0,W.jsx)(Ne,{versionToColor:M})}),(0,W.jsx)(o.AW,{render:()=>(0,W.jsx)(o.l_,{to:(0,v.Fz)((0,qe.B7)(w))})})]})]})}}}]);