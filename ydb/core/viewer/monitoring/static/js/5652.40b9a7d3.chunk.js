"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[5652],{5252:(e,s,n)=>{n.r(s),n.d(s,{Cluster:()=>Os});var t=n(59284),l=n(89169),r=n(23871),a=n(61750),o=n(10755),i=n(67087),d=n(90053),c=n(10508),u=n(44294),v=n(92459),h=n(67028),p=n(67157),m=n(40174),g=n(77506),j=n(90182),x=n(66592),N=n(7117),f=n(99936),b=n(88616),y=n(4557),C=n(84476),k=n(28539),w=n(44508),T=n(78524),_=n(48295),S=n(9252),V=n(17594),E=n(95963),O=n(89073),L=n(40336),M=n(63291),D=n(54309),z=n(12888),A=n(71661),G=n(25196),I=n(48372);const P=JSON.parse('{"field_links":"Links","field_monitoring-link":"Monitoring","context_unknown":"unknown database"}'),R=(0,I.g4)("ydb-tenant-name-wrapper",{en:P});var $=n(60712);function B({tenant:e,additionalTenantsProps:s}){var n;const t=(0,z.X)(),l=((e,s)=>{var n,t;if("function"!==typeof(null===s||void 0===s?void 0:s.prepareTenantBackend))return;let l=null!==(n=e.MonitoringEndpoint)&&void 0!==n?n:e.backend;const r=null!==(t=e.NodeIds)&&void 0!==t?t:e.sharedNodeIds;!l&&r&&r.length>0&&(l={NodeId:r[Math.floor(Math.random()*r.length)]});return s.prepareTenantBackend(l)})(e,s),r=Boolean(l),a=null===s||void 0===s||null===(n=s.getMonitoringLink)||void 0===n?void 0:n.call(s,e.Name,e.Type);return(0,$.jsx)(A.s,{disabled:!t||!a,delayClosing:200,content:a?(0,$.jsx)(L.u,{responsive:!0,children:(0,$.jsx)(L.u.Item,{name:R("field_links"),children:(0,$.jsx)(G.K,{title:R("field_monitoring-link"),url:a})})}):null,placement:["top","bottom"],behavior:M.m.Immediate,children:(0,$.jsx)(c.c,{externalLink:r,name:e.Name||R("context_unknown"),withLeftTrim:!0,status:e.Overall,hasClipboardButton:!0,path:(0,D.YL)({database:e.Name,backend:l})})})}var F=n(58351),U=n(88610),W=n(53850),Z=n(23536),q=n.n(Z),Q=n(54090),Y=n(76086),H=n(56674);const J=(0,W.Mz)((e=>e),(e=>H.GJ.endpoints.getTenantsInfo.select({clusterName:e}))),K=(0,W.Mz)((e=>e),((e,s)=>J(s)),(e=>(0,U.CN)(e,Y.Xm)),((e,s,n)=>{var t;const l=null!==(t=s(e).data)&&void 0!==t?t:[];return!n&&l.length>1?l.filter((e=>"Domain"!==e.Type)):l})),X=e=>e.tenants.searchValue,ee=(0,W.Mz)([K,U.yV,X],((e,s,n)=>{let t=((e,s)=>s===U.s$.ALL?e:e.filter((e=>e.Overall&&e.Overall!==Q.m.Green)))(e,s);return t=((e,s)=>e.filter((e=>{const n=new RegExp(q()(s),"i");return n.test(e.Name||"")||n.test(e.controlPlaneName)})))(t,n),t}));var se=n(56839);const ne=(0,g.cn)("tenants"),te=({additionalTenantsProps:e})=>{const s=(0,j.YQ)(),[n]=(0,j.Nt)(),{currentData:l,isFetching:r,error:a}=H.GJ.useGetTenantsInfoQuery({clusterName:F.SL},{pollingInterval:n}),o=r&&void 0===l,i=(0,j.N4)((e=>K(e,F.SL))),d=(0,j.N4)(X),c=(0,j.N4)((e=>ee(e,F.SL))),u=(0,j.N4)(U.yV),v=e=>{s((0,U.$u)(e))},h=e=>{s((0,H.gB)(e))};return(0,$.jsxs)(O.L,{children:[(0,$.jsx)(O.L.Controls,{children:(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)(E.v,{value:d,onChange:h,placeholder:"Database name",className:ne("search")}),(0,$.jsx)(S.k,{value:u,onChange:v}),(0,$.jsx)(k.T,{total:i.length,current:(null===c||void 0===c?void 0:c.length)||0,label:"Databases",loading:o})]})}),a?(0,$.jsx)(w.o,{error:a}):null,(0,$.jsx)(O.L.Table,{loading:o,children:l?(()=>{const s=[{name:"Name",header:"Database",render:({row:s})=>(0,$.jsx)(B,{tenant:s,additionalTenantsProps:e}),width:440,sortable:!0,defaultOrder:y.Ay.DESCENDING},{name:"controlPlaneName",header:"Name",render:({row:e})=>e.controlPlaneName,width:200,sortable:!0,defaultOrder:y.Ay.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:({row:e})=>"Serverless"!==e.Type?e.Type:(0,$.jsxs)("div",{className:ne("type"),children:[(0,$.jsx)("span",{className:ne("type-value"),children:e.Type}),(0,$.jsx)(C.$,{className:ne("type-button"),onClick:()=>h(e.sharedTenantName||""),children:"Show shared"})]})},{name:"State",width:90,render:({row:e})=>e.State?e.State.toLowerCase():"\u2014",customStyle:()=>({textTransform:"capitalize"})},{name:"cpu",header:"CPU",width:80,render:({row:e})=>e.cpu&&e.cpu>1e4?(0,se.iM)(e.cpu):"\u2014",align:y.Ay.RIGHT,defaultOrder:y.Ay.DESCENDING},{name:"memory",header:"Memory",width:120,render:({row:e})=>e.memory?(0,se.vX)(e.memory):"\u2014",align:y.Ay.RIGHT,defaultOrder:y.Ay.DESCENDING},{name:"storage",header:"Storage",width:120,render:({row:e})=>e.storage?(0,se.vX)(e.storage):"\u2014",align:y.Ay.RIGHT,defaultOrder:y.Ay.DESCENDING},{name:"nodesCount",header:"Nodes",width:100,render:({row:e})=>e.nodesCount?(0,se.ZV)(e.nodesCount):"\u2014",align:y.Ay.RIGHT,defaultOrder:y.Ay.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:({row:e})=>e.groupsCount?(0,se.ZV)(e.groupsCount):"\u2014",align:y.Ay.RIGHT,defaultOrder:y.Ay.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:({PoolStats:e=[]})=>e.reduce(((e,s)=>e+(s.Usage||0)),0),defaultOrder:y.Ay.DESCENDING,align:y.Ay.LEFT,render:({row:e})=>(0,$.jsx)(_._,{pools:e.PoolStats})}];return 0===c.length&&u!==U.s$.ALL?(0,$.jsx)(T.v,{name:"thumbsUp",width:"200"}):(0,$.jsx)(V.l,{columnsWidthLSKey:"databasesTableColumnsWidth",data:c,columns:s,settings:Y.N3,emptyDataMessage:"No such tenants"})})():null})]})};var le=n(44433),re=n(74321),ae=n(52248),oe=n(15298),ie=n(18143);const de=(0,g.cn)("ydb-cluster-versions-bar"),ce=({versionsValues:e=[],size:s="s",progressClassName:n})=>(0,$.jsxs)("div",{className:de(),children:[(0,$.jsx)(ie.k,{value:100,stack:e,size:s,className:n}),(0,$.jsx)("div",{className:de("versions"),children:e.map(((s,n)=>(0,$.jsx)("div",{className:de("version-title"),style:{color:s.color},title:s.version,children:`${s.version}${n===e.length-1?"":","}`},s.version)))})]});var ue=n(63126),ve=n(78762),he=n(88655);function pe(e){return[(0,ve._E)(),(0,ve.Nh)(e),(0,ve.jl)(),(0,ve.pH)(),(0,ve.fr)(),(0,ve.ID)()]}const me=({nodes:e})=>{const s=(0,he.E)(),n=pe({getNodeRef:null===s||void 0===s?void 0:s.getNodeRef});return(0,$.jsx)(V.l,{columnsWidthLSKey:"versionsTableColumnsWidth",data:e,columns:n,settings:Y.N3})};var ge=n(96873);const je=(0,g.cn)("ydb-versions-nodes-tree-title"),xe=({title:e,nodes:s,items:n,versionColor:t,versionsValues:l})=>{let r;return r=n?n.reduce(((e,s)=>s.nodes?e+s.nodes.length:e),0):s?s.length:0,(0,$.jsxs)("div",{className:je("overview"),children:[(0,$.jsxs)("div",{className:je("overview-container"),children:[t?(0,$.jsx)("div",{className:je("version-color"),style:{background:t}}):null,e?(0,$.jsxs)("span",{className:je("overview-title"),children:[e,(0,$.jsx)(ge.b,{text:e,size:"s",className:je("clipboard-button"),view:"normal"})]}):null]}),(0,$.jsxs)("div",{className:je("overview-info"),children:[(0,$.jsxs)("div",{children:[(0,$.jsx)("span",{className:je("info-value"),children:r}),(0,$.jsx)("span",{className:je("info-label",{margin:"left"}),children:"Nodes"})]}),l?(0,$.jsxs)("div",{className:je("version-progress"),children:[(0,$.jsx)("span",{className:je("info-label",{margin:"right"}),children:"Versions"}),(0,$.jsx)(ie.k,{size:"s",value:100,stack:l})]}):null]})]})},Ne=(0,g.cn)("ydb-versions-grouped-node-tree"),fe=({title:e,nodes:s,items:n,expanded:l=!1,versionColor:r,versionsValues:a,level:o=0})=>{const[i,d]=t.useState(!1);t.useEffect((()=>{d(l)}),[l]);const c=(0,$.jsx)(xe,{title:e,nodes:s,items:n,versionColor:r,versionsValues:a}),u=()=>{d((e=>!e))};return n?(0,$.jsx)("div",{className:Ne({"first-level":0===o}),children:(0,$.jsx)(ue.G,{name:c,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:n.map(((e,s)=>(0,$.jsx)(fe,{title:e.title,nodes:e.nodes,expanded:l,versionColor:e.versionColor,level:o+1},s)))},e)}):(0,$.jsx)("div",{className:Ne({"first-level":0===o}),children:(0,$.jsx)(ue.G,{name:c,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:(0,$.jsx)("div",{className:Ne("dt-wrapper"),children:(0,$.jsx)(me,{nodes:s||[]})})},e)})};var be=n(78018),ye=n.n(be),Ce=n(38596);const ke=.5,we=(e=[],s)=>{const n=e.reduce(((e,s)=>(s.Version&&(e[s.Version]?e[s.Version]=e[s.Version]+1:e[s.Version]=1),e)),{});return _e(Object.keys(n).map((t=>{const l=n[t]/e.length*100;return{title:t,version:t,color:null===s||void 0===s?void 0:s.get((0,Ce.U)(t)),value:l<ke?ke:l}})))};function Te(e,s,n){const t=null!==n&&void 0!==n?n:e.reduce(((e,s)=>e+s.count),0);return _e(e.map((e=>{const n=e.count/t*100;return{title:e.name,version:e.name,color:null===s||void 0===s?void 0:s.get(e.name),value:n<ke?ke:n}})))}function _e(e){let s=e[0].value,n=0,t=0;e.forEach(((e,l)=>{t+=e.value,e.value>s&&(s=e.value,n=l)}));const l=[...e];return l[n]={...e[n],value:s+100-t},l}let Se=function(e){return e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage",e}({});const Ve=(e,s)=>{var n;return(null===(n=e.title)||void 0===n?void 0:n.localeCompare(s.title||""))||-1},Ee=JSON.parse('{"title_overall":"Overall","title_storage":"Storage nodes","title_database":"Database nodes","title_other":"Other nodes"}'),Oe=(0,I.g4)("ydb-versions",{en:Ee});var Le=n(44992),Me=n(98730);const De=(0,g.cn)("ydb-versions"),ze=({versionToColor:e,cluster:s})=>{const[n]=(0,j.Nt)(),l=((e,s)=>{const{currentData:n}=oe.s.useGetNodesQuery((0,Me.L)(e)?Le.hT:{tablets:!1,fieldsRequired:["SystemState"],group:"Version"});return t.useMemo((()=>(0,Me.L)(e)&&e.MapVersions?Te(Object.entries(e.MapVersions).map((([e,s])=>({name:e,count:s}))),s,e.NodesTotal):n?Array.isArray(n.NodeGroups)?Te(n.NodeGroups,s,null===e||void 0===e?void 0:e.NodesTotal):we(n.Nodes,s):[]),[n,s,e])})(s,e),{currentData:r,isLoading:a}=oe.s.useGetNodesQuery({tablets:!1,fieldsRequired:["SystemState"]},{pollingInterval:n}),o=null===r||void 0===r?void 0:r.Nodes,[i,d]=t.useState(Se.VERSION),[c,u]=t.useState(!1),v=e=>{d(e)};if(a)return(0,$.jsx)(ae.a,{});const h=((e,s,n)=>{if(e&&e.length){if(n===Se.VERSION){const n=ye()(e,"Version");return Object.keys(n).map((e=>{const t=n[e].filter((({Tenants:e})=>Boolean(e))),l=ye()(t,"Tenants"),r=Object.keys(l).map((e=>({title:e,nodes:l[e]}))).sort(Ve);return r.length?{title:e,items:r,versionColor:null===s||void 0===s?void 0:s.get((0,Ce.U)(e))}:null})).filter((e=>Boolean(e)))}{const n=e.filter((({Tenants:e})=>Boolean(e))),t=ye()(n,"Tenants");return Object.keys(t).map((e=>{const n=we(t[e],s),l=ye()(t[e],"Version"),r=Object.keys(l).map((e=>({title:e,nodes:l[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ce.U)(e))})));return r.length?{title:e,items:r,versionsValues:n}:null})).filter((e=>Boolean(e))).sort(Ve)}}})(o,e,i),p=((e,s)=>{if(!e||!e.length)return;const n=e.filter((({Roles:e})=>null===e||void 0===e?void 0:e.includes("Storage"))),t=ye()(n,"Version");return Object.keys(t).map((e=>({title:e,nodes:t[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ce.U)(e))})))})(o,e),m=((e,s)=>{if(!e||!e.length)return;const n=e.filter((({Roles:e,Version:s})=>!e&&s)),t=ye()(n,"Version");return Object.keys(t).map((e=>({title:e,nodes:t[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ce.U)(e))})))})(o,e),g=null!==p&&void 0!==p&&p.length?(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)("h4",{children:Oe("title_storage")}),p.map((({title:e,nodes:s,items:n,versionColor:t})=>(0,$.jsx)(fe,{title:e,nodes:s,items:n,versionColor:t},`storage-nodes-${e}`)))]}):null,x=null!==h&&void 0!==h&&h.length?(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)("h4",{children:Oe("title_database")}),(0,$.jsxs)("div",{className:De("controls"),children:[(0,$.jsxs)("div",{className:De("group"),children:[(0,$.jsx)("span",{className:De("label"),children:"Group by:"}),(0,$.jsxs)(le.a,{value:i,onUpdate:v,children:[(0,$.jsx)(le.a.Option,{value:Se.TENANT,children:Se.TENANT}),(0,$.jsx)(le.a.Option,{value:Se.VERSION,children:Se.VERSION})]})]}),(0,$.jsx)(re.S,{className:De("checkbox"),onChange:()=>u((e=>!e)),checked:c,children:"All expanded"})]}),h.map((({title:e,nodes:s,items:n,versionColor:t,versionsValues:l})=>(0,$.jsx)(fe,{title:e,nodes:s,items:n,expanded:c,versionColor:t,versionsValues:l},`tenant-nodes-${e}`)))]}):null,N=null!==m&&void 0!==m&&m.length?(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)("h4",{children:Oe("title_other")}),m.map((({title:e,nodes:s,items:n,versionColor:t,versionsValues:l})=>(0,$.jsx)(fe,{title:e,nodes:s,items:n,versionColor:t,versionsValues:l},`other-nodes-${e}`)))]}):null,f=(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)("h4",{children:Oe("title_overall")}),(0,$.jsx)("div",{className:De("overall-wrapper"),children:(0,$.jsx)(ce,{progressClassName:De("overall-progress"),versionsValues:l.filter((e=>"unknown"!==e.title)),size:"m"})})]});return(0,$.jsxs)("div",{className:De(),children:[f,g,x,N]})};var Ae=n(98089),Ge=n(87184);const Ie=(0,g.cn)("tag"),Pe=({text:e,type:s})=>(0,$.jsx)("div",{className:Ie({type:s}),children:e}),Re=({tags:e,tagsType:s,className:n="",gap:t=1})=>(0,$.jsx)(Ge.s,{className:n,gap:t,wrap:"wrap",alignItems:"center",children:e&&e.map(((e,n)=>(0,$.jsx)(Pe,{text:e,type:s},n)))});var $e=n(7435);const Be=JSON.parse('{"disk-type":"Disk Type","erasure":"Erasure","allocated":"Allocated","available":"Available","usage":"Usage","label_nodes-state":"Nodes state","label_dc":"Nodes data centers","storage-size":"Storage size","storage-groups":"Storage groups, {{diskType}}","links":"Links","link_cores":"Coredumps","link_logging":"Logging","link_slo-logs":"SLO Logs","context_cores":"cores","title_cpu":"CPU","title_storage":"Storage","title_memory":"Memory","title_info":"Info","title_links":"Links","label_nodes":"Nodes","label_hosts":"Hosts","label_storage-groups":"Storage groups","label_databases":"Databases","label_load":"Load"}'),Fe=(0,I.g4)("ydb-cluster",{en:Be});var Ue=n(2102);const We=(0,g.cn)("ydb-doughnut-metrics");function Ze({status:e,fillWidth:s,children:n,className:t}){let l="var(--g-color-line-generic-solid)",r=3.6*s-90;s>50&&(l="var(--doughnut-color)",r=3.6*s+90);const a=r;return(0,$.jsx)("div",{className:We(null,t),children:(0,$.jsx)("div",{style:{backgroundImage:`linear-gradient(${a}deg, transparent 50%, ${l} 50%), linear-gradient(-90deg, var(--g-color-line-generic-solid) 50%, transparent 50%)`},className:We("doughnut",{status:e}),children:(0,$.jsx)("div",{className:We("text-wrapper"),children:n})})})}Ze.Legend=function({children:e,variant:s="subheader-3"}){return(0,$.jsx)(Ae.E,{variant:s,color:"secondary",className:We("legend"),children:e})},Ze.Value=function({children:e,variant:s="subheader-2"}){return(0,$.jsx)(Ae.E,{variant:s,color:"secondary",className:We("value"),children:e})};var qe=n(70043);const Qe=(0,g.cn)("ydb-cluster-dashboard");function Ye({children:e,title:s,size:n,className:t}){return(0,$.jsxs)(Ue.A,{className:Qe("card",{size:n},t),size:n,interactive:!1,children:[s?(0,$.jsx)(Ae.E,{variant:"subheader-3",className:Qe("card-title"),children:s}):null,e]})}function He({title:e,children:s,size:n,...t}){return(0,$.jsx)(Ye,{title:e,size:n,children:(0,$.jsx)(Ze,{...t,className:Qe("doughnut"),children:s})})}function Je(){return(0,$.jsx)(Ye,{className:Qe("skeleton-wrapper"),children:(0,$.jsx)(qe.E,{className:Qe("skeleton")})})}function Ke(){return(0,$.jsxs)(t.Fragment,{children:[(0,$.jsx)(Je,{}),(0,$.jsx)(Je,{}),(0,$.jsx)(Je,{})]})}var Xe=n(35736),es=n(57439),ss=n(24543),ns=n(46549);const ts=(0,g.cn)("ydb-disk-groups-stats"),ls=({stats:e,children:s})=>(0,$.jsx)("div",{className:ts(),children:(0,$.jsx)(ss.u,{placement:["right"],pinOnClick:!0,content:(0,$.jsx)(rs,{stats:e}),children:s})});function rs({stats:e}){const{diskType:s,erasure:n,allocatedSize:t,availableSize:l}=e,r=(0,ns.fn)(Math.max(t,l)),a=(0,ns.z3)({value:t,size:r}),o=(0,ns.z3)({value:l,size:r}),i=Math.round(t/(t+l)*100),d=[{name:Fe("disk-type"),content:s},{name:Fe("erasure"),content:n},{name:Fe("allocated"),content:a},{name:Fe("available"),content:o},{name:Fe("usage"),content:i+"%"}];return(0,$.jsx)(es.u,{items:d,className:ts("popup-content"),responsive:!0})}function as({value:e,capacity:s,colorizeProgress:n=!0,warningThreshold:t,dangerThreshold:l,inverseColorize:r=!1,legendFormatter:a}){const o=parseFloat(String(e)),i=parseFloat(String(s));let d=o/i*100||0;d=d>100?100:d;const c=d<1?.5:d;return{status:(0,Xe.w)({fillWidth:d,warningThreshold:t,dangerThreshold:l,colorizeProgress:n,inverseColorize:r}),percents:(0,se.l9)(d/100),legend:a({value:o,capacity:i}),fill:c}}const os=["storage","tenant"];const is=e=>Object.values(e).reduce(((e,s)=>(Object.values(s).forEach((s=>{e+=s.createdGroups})),e)),0);function ds({value:e,capacity:s}){let n=[];return n=s<1e4?[(0,se.ZV)(Math.round(e)),(0,se.ZV)(Math.round(s))]:(0,se.Nd)(e,s,void 0,"",!0),`${n[0]} / ${n[1]}\n${Fe("context_cores")}`}function cs({value:e,capacity:s,...n}){const{status:t,percents:l,legend:r,fill:a}=as({value:e,capacity:s,legendFormatter:ds,...n});return(0,$.jsxs)(He,{status:t,fillWidth:a,title:Fe("title_cpu"),children:[(0,$.jsx)(Ze.Legend,{children:r}),(0,$.jsx)(Ze.Value,{children:l})]})}function us({value:e,capacity:s}){const n=(0,se.j9)(e,s,void 0,"\n");return`${n[0]} / ${n[1]}`}function vs({value:e,capacity:s,...n}){const{status:t,percents:l,legend:r,fill:a}=as({value:e,capacity:s,legendFormatter:us,...n});return(0,$.jsxs)(He,{status:t,fillWidth:a,title:Fe("title_memory"),children:[(0,$.jsx)(Ze.Legend,{children:r}),(0,$.jsx)(Ze.Value,{children:l})]})}function hs({value:e,capacity:s}){const n=(0,se.j9)(e,s,void 0,"\n");return`${n[0]} / ${n[1]}`}function ps({value:e,capacity:s,...n}){const{status:t,percents:l,legend:r,fill:a}=as({value:e,capacity:s,legendFormatter:hs,...n});return(0,$.jsxs)(He,{status:t,fillWidth:a,title:Fe("title_storage"),children:[(0,$.jsx)(Ze.Legend,{children:r}),(0,$.jsx)(Ze.Value,{children:l})]})}function ms({value:e}){return(0,$e.f8)(e)?(0,$.jsx)(Ae.E,{variant:"subheader-3",color:"secondary",children:(0,se.ZV)(e)}):null}function gs({cluster:e,...s}){return s.error?(0,$.jsx)(w.o,{error:s.error,className:Qe("error")}):(0,$.jsx)("div",{className:Qe(),children:(0,$.jsxs)(Ge.s,{gap:4,wrap:!0,children:[(0,$.jsx)(Ge.s,{gap:4,wrap:"nowrap",children:(0,$.jsx)(js,{...s,cluster:e})}),(0,$.jsx)("div",{className:Qe("cards-container"),children:(0,$.jsx)(xs,{...s,cluster:e})})]})})}function js({cluster:e,loading:s}){if(s)return(0,$.jsx)(Ke,{});const n=[];if((0,Me.L)(e)){const{CoresUsed:s,NumberOfCpus:t,CoresTotal:l}=e,r=null!==l&&void 0!==l?l:t;(0,$e.f8)(s)&&(0,$e.f8)(r)&&n.push((0,$.jsx)(cs,{value:s,capacity:r},"cores"))}const{StorageTotal:t,StorageUsed:l}=e;(0,$e.f8)(t)&&(0,$e.f8)(l)&&n.push((0,$.jsx)(ps,{value:l,capacity:t},"storage"));const{MemoryTotal:r,MemoryUsed:a}=e;return(0,$e.f8)(r)&&(0,$e.f8)(a)&&n.push((0,$.jsx)(vs,{value:a,capacity:r},"memory")),n}function xs({cluster:e,groupStats:s={},loading:n}){if(n)return null;const l=[],r=function(e){const s=[];if((0,Me.L)(e)&&e.MapNodeRoles)for(const[n,l]of Object.entries(e.MapNodeRoles))os.includes(n.toLowerCase())&&s.push((0,$.jsxs)(t.Fragment,{children:[n,": ",(0,se.ZV)(l)]},n));return s}(e);if(l.push((0,$.jsx)(Ye,{size:"l",title:Fe("label_nodes"),children:(0,$.jsxs)(Ge.s,{gap:2,direction:"column",children:[(0,$.jsx)(ms,{value:null===e||void 0===e?void 0:e.NodesAlive}),null!==r&&void 0!==r&&r.length?(0,$.jsx)(Re,{tags:r,gap:3}):null]})},"roles")),Object.keys(s).length){const e=function(e){const s=[];return Object.entries(e).forEach((([e,n])=>{Object.values(n).forEach((n=>{s.push((0,$.jsxs)(ls,{stats:n,children:[e,": ",(0,se.ZV)(n.createdGroups)," /"," ",(0,se.ZV)(n.totalGroups)]},`${e}|${n.erasure}`))}))})),s}(s),n=is(s);l.push((0,$.jsx)(Ye,{size:"l",title:Fe("label_storage-groups"),children:(0,$.jsxs)(Ge.s,{gap:2,direction:"column",children:[(0,$.jsx)(ms,{value:n}),(0,$.jsx)(Re,{tags:e,gap:3})]})},"groups"))}const a=function(e){var s;return(0,Me.L)(e)&&e.MapDataCenters?Object.keys(e.MapDataCenters):null===(s=e.DataCenters)||void 0===s?void 0:s.filter(Boolean)}(e);return null!==a&&void 0!==a&&a.length&&l.push((0,$.jsx)(Ye,{size:"l",title:Fe("label_hosts"),children:(0,$.jsxs)(Ge.s,{gap:2,direction:"column",children:[(0,$.jsx)(ms,{value:null===e||void 0===e?void 0:e.Hosts}),(0,$.jsx)(Re,{tags:a,gap:3})]})},"hosts")),e.Tenants&&l.push((0,$.jsx)(Ye,{size:"l",title:Fe("label_databases"),children:(0,$.jsx)(ms,{value:null===e||void 0===e?void 0:e.Tenants})},"tenants")),l}var Ns=n(42655);const fs=(0,g.cn)("cluster-info");var bs=n(41650);function ys(){const{cores:e,logging:s}=(0,p.Zd)();return t.useMemo((()=>{const n=[],t=function(e){try{const s=(0,bs.qF)(e);if(s&&"object"===typeof s&&"url"in s&&"string"===typeof s.url)return s.url}catch{}}(e),{logsUrl:l,sloLogsUrl:r}=function(e){try{const s=(0,bs.qF)(e);if(s&&"object"===typeof s){return{logsUrl:"url"in s&&"string"===typeof s.url?s.url:void 0,sloLogsUrl:"slo_logs_url"in s&&"string"===typeof s.slo_logs_url?s.slo_logs_url:void 0}}}catch{}return{}}(s);return t&&n.push({title:Fe("link_cores"),url:t}),l&&n.push({title:Fe("link_logging"),url:l}),r&&n.push({title:Fe("link_slo-logs"),url:r}),n}),[e,s])}var Cs=n(15132);const ks=(0,g.cn)("ydb-nodes-state");function ws({state:e,children:s}){return(0,$.jsx)("div",{className:ks({[e.toLowerCase()]:!0}),children:s})}const Ts={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},_s=(e,s)=>{const n=[];if((0,Me.L)(e)&&e.MapNodeStates){const s=Object.entries(e.MapNodeStates);s.sort(((e,s)=>Ts[s[0]]-Ts[e[0]]));const t=s.map((([e,s])=>(0,$.jsx)(ws,{state:e,children:(0,se.ZV)(s)},e)));n.push({label:Fe("label_nodes-state"),value:(0,$.jsx)(Ge.s,{gap:2,children:t})})}const l=(e=>{if((0,Me.L)(e)&&e.MapDataCenters)return Object.entries(e.MapDataCenters).map((([e,s])=>(0,$.jsxs)(t.Fragment,{children:[e,": ",(0,se.ZV)(s)]},e)))})(e);return null!==l&&void 0!==l&&l.length&&n.push({label:Fe("label_dc"),value:(0,$.jsx)(Re,{tags:l,gap:2,className:fs("dc")})}),n.push({label:Fe("label_load"),value:(0,$.jsx)(Cs.O,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null===e||void 0===e?void 0:e.NumberOfCpus})}),n.push(...s),n},Ss=({cluster:e,loading:s,error:n,additionalClusterProps:t={}})=>{const{info:l=[],links:r=[]}=t,a=ys(),o=r.concat(a),i=_s(null!==e&&void 0!==e?e:{},l);return(0,$.jsxs)("div",{className:fs(),children:[n?(0,$.jsx)(w.o,{error:n,className:fs("error")}):null,s?(0,$.jsx)(Ns.y,{className:fs("skeleton"),rows:4}):(0,$.jsxs)(Ge.s,{gap:10,wrap:"nowrap",children:[n&&!e?null:(0,$.jsxs)("div",{children:[(0,$.jsx)("div",{className:fs("section-title"),children:Fe("title_info")}),(0,$.jsx)(L.u,{nameMaxWidth:200,children:i.map((({label:e,value:s})=>(0,$.jsx)(L.u.Item,{name:e,children:s},e)))})]}),o.length?(0,$.jsxs)("div",{children:[(0,$.jsx)("div",{className:fs("section-title"),children:Fe("title_links")}),(0,$.jsx)(Ge.s,{direction:"column",gap:4,children:o.map((({title:e,url:s})=>(0,$.jsx)(G.K,{title:e,url:s},e)))})]}):null]})]})};var Vs=n(87842);const Es=(0,g.cn)("ydb-cluster");function Os({additionalClusterProps:e,additionalTenantsProps:s,additionalNodesProps:n,additionalVersionsProps:g}){const y=t.useRef(null),C=(0,h.fp)(),k=(0,j.YQ)(),w=function(){const e=(0,j.YQ)(),s=(0,j.N4)((e=>e.cluster.defaultClusterTab)),n=(0,o.W5)(v.Ay.cluster),{activeTab:l}=(null===n||void 0===n?void 0:n.params)||{};let r;r=(0,Vs.eC)(l)?l:s;return t.useEffect((()=>{r!==s&&e((0,p.Yv)(r))}),[r,s,e]),r}(),[{clusterName:T,backend:_}]=(0,i.useQueryParams)({clusterName:i.StringParam,backend:i.StringParam}),S=(0,j.N4)((e=>(0,p.zR)(e,null!==T&&void 0!==T?T:void 0))),{title:V}=(0,p.Zd)(),E=null!==V&&void 0!==V?V:S,{data:{clusterData:O={},groupsStats:L}={},isLoading:M,error:D}=p.Zh.useGetClusterInfoQuery(null!==T&&void 0!==T?T:void 0),z=D&&"object"===typeof D?D:void 0,A=(0,j.N4)((e=>(0,p.ds)(e,null!==T&&void 0!==T?T:void 0)));t.useEffect((()=>{k((0,m.g)("cluster",{}))}),[k]);const G=t.useMemo((()=>null!==g&&void 0!==g&&g.getVersionToColorMap?null===g||void 0===g?void 0:g.getVersionToColorMap():(0,x._n)(null===O||void 0===O?void 0:O.Versions)),[g,O]),I=t.useMemo((()=>Vs.bn.find((({id:e})=>e===w))),[w]);return(0,$.jsxs)("div",{className:Es(),ref:y,children:[(0,$.jsx)(a.mg,{defaultTitle:`${E} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${E} \u2014 YDB Monitoring`,children:I?(0,$.jsx)("title",{children:I.title}):null}),(0,$.jsx)("div",{className:Es("header"),children:M?(0,$.jsx)(l.E,{className:Es("title-skeleton")}):(0,$.jsx)(c.c,{size:"m",status:null===O||void 0===O?void 0:O.Overall,name:E,className:Es("title")})}),(0,$.jsx)("div",{className:Es("sticky-wrapper"),children:(0,$.jsx)(d.E,{className:Es("auto-refresh-control")})}),C&&(0,$.jsx)(gs,{cluster:O,groupStats:L,loading:M,error:z||(null===O||void 0===O?void 0:O.error)}),(0,$.jsx)("div",{className:Es("tabs-sticky-wrapper"),children:(0,$.jsx)(r.t,{size:"l",allowNotSelected:!0,activeTab:w,items:Vs.bn,wrapTo:({id:e},s)=>{const n=(0,Vs.a)(e,{clusterName:T,backend:_});return(0,$.jsx)(u.E,{to:n,onClick:()=>{k((0,p.Yv)(e))},children:s},e)}})}),(0,$.jsxs)(o.dO,{children:[(0,$.jsx)(o.qh,{path:(0,v.a3)((0,Vs.a)(Vs.Bi.overview)).pathname,children:(0,$.jsx)(Ss,{cluster:O,loading:M,error:z,additionalClusterProps:e})}),(0,$.jsx)(o.qh,{path:(0,v.a3)((0,Vs.a)(Vs.Bi.tablets)).pathname,children:(0,$.jsx)(b.Q,{loading:M,tablets:A})}),(0,$.jsx)(o.qh,{path:(0,v.a3)((0,Vs.a)(Vs.Bi.tenants)).pathname,children:(0,$.jsx)(te,{additionalTenantsProps:s})}),(0,$.jsx)(o.qh,{path:(0,v.a3)((0,Vs.a)(Vs.Bi.nodes)).pathname,children:(0,$.jsx)(N.G,{parentRef:y,additionalNodesProps:n})}),(0,$.jsx)(o.qh,{path:(0,v.a3)((0,Vs.a)(Vs.Bi.storage)).pathname,children:(0,$.jsx)(f.z,{parentRef:y})}),(0,$.jsx)(o.qh,{path:(0,v.a3)((0,Vs.a)(Vs.Bi.versions)).pathname,children:(0,$.jsx)(ze,{versionToColor:G,cluster:O})}),(0,$.jsx)(o.qh,{render:()=>(0,$.jsx)(o.rd,{to:(0,v.a3)((0,Vs.a)(w))})})]})]})}},42655:(e,s,n)=>{n.d(s,{y:()=>c});var t=n(59284),l=n(89169),r=n(77506),a=n(66781),o=n(60712);const i=(0,r.cn)("ydb-info-viewer-skeleton"),d=()=>(0,o.jsxs)("div",{className:i("label"),children:[(0,o.jsx)(l.E,{className:i("label__text")}),(0,o.jsx)("div",{className:i("label__dots")})]}),c=({rows:e=8,className:s,delay:n=600})=>{const[r]=(0,a.y)(n);let c=(0,o.jsxs)(t.Fragment,{children:[(0,o.jsx)(d,{}),(0,o.jsx)(l.E,{className:i("value")})]});return r||(c=null),(0,o.jsx)("div",{className:i(null,s),children:[...new Array(e)].map(((e,s)=>(0,o.jsx)("div",{className:i("row"),children:c},`skeleton-row-${s}`)))})}},70043:(e,s,n)=>{n.d(s,{E:()=>a});var t=n(89169),l=n(66781),r=n(60712);const a=({delay:e=600,className:s})=>{const[n]=(0,l.y)(e);return n?(0,r.jsx)(t.E,{className:s}):null}}}]);