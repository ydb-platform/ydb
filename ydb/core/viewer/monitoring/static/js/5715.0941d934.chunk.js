"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[5715],{22200:(e,a,i)=>{i.d(a,{K:()=>I});var s=i(54665),o=i(5922),t=i(24362),n=i(4119),l=i(48169),d=i(47651),u=i(69214),r=i(62206),c=i(32270),v=i(67359),D=i(30817);const p=JSON.parse('{"slot-id":"VDisk Slot Id","pool-name":"Storage Pool Name","kind":"Kind","guid":"GUID","incarnation-guid":"Incarnation GUID","instance-guid":"Instance GUID","replication-status":"Replicated","state-status":"VDisk State","space-status":"Disk Space","fresh-rank-satisfaction":"Fresh Rank Satisfaction","level-rank-satisfaction":"Level Rank Satisfaction","front-queues":"Front Queues","has-unreadable-blobs":"Has Unreadable Blobs","size":"Size","read-throughput":"Read Throughput","write-throughput":"Write Throughput","links":"Links","vdisk-page":"VDisk Page","developer-ui":"Developer UI","yes":"Yes","no":"No"}'),k=(0,D.wZ)("ydb-vDisk-info",{en:p});var g=i(75859);const h=(0,t.cn)("ydb-vdisk-info");function I(e){var a,i;let{data:t,isVDiskPage:D=!1,...p}=e;const{AllocatedSize:I,DiskSpace:b,FrontQueues:f,Guid:m,Replicated:N,VDiskState:S,VDiskSlotId:w,Kind:x,SatisfactionRank:y,AvailableSize:j,HasUnreadableBlobs:P,IncarnationGuid:V,InstanceGuid:G,StoragePoolName:R,ReadThroughput:F,WriteThroughput:T,PDiskId:C,NodeId:z}=t,q=[];var A,L;((0,o.D)(w)&&q.push({label:k("slot-id"),value:w}),(0,o.D)(R)&&q.push({label:k("pool-name"),value:R}),(0,o.D)(S)&&q.push({label:k("state-status"),value:S}),Number(I)>=0&&Number(j)>=0&&q.push({label:k("size"),value:(0,g.jsx)(v.y,{value:I,capacity:Number(I)+Number(j),formatValues:n.q3,colorizeProgress:!0})}),(0,o.D)(x)&&q.push({label:k("kind"),value:x}),(0,o.D)(m)&&q.push({label:k("guid"),value:m}),(0,o.D)(V)&&q.push({label:k("incarnation-guid"),value:V}),(0,o.D)(G)&&q.push({label:k("instance-guid"),value:G}),(0,o.D)(N)&&q.push({label:k("replication-status"),value:k(N?"yes":"no")}),(0,o.D)(b)&&q.push({label:k("space-status"),value:(0,g.jsx)(u.A,{status:b})}),(0,o.D)(null===y||void 0===y||null===(a=y.FreshRank)||void 0===a?void 0:a.Flag))&&q.push({label:k("fresh-rank-satisfaction"),value:(0,g.jsx)(u.A,{status:null===y||void 0===y||null===(A=y.FreshRank)||void 0===A?void 0:A.Flag})});(0,o.D)(null===y||void 0===y||null===(i=y.LevelRank)||void 0===i?void 0:i.Flag)&&q.push({label:k("level-rank-satisfaction"),value:(0,g.jsx)(u.A,{status:null===y||void 0===y||null===(L=y.LevelRank)||void 0===L?void 0:L.Flag})});if((0,o.D)(f)&&q.push({label:k("front-queues"),value:(0,g.jsx)(u.A,{status:f})}),(0,o.D)(P)&&q.push({label:k("has-unreadable-blobs"),value:k(P?"yes":"no")}),(0,o.D)(F)&&q.push({label:k("read-throughput"),value:(0,d.Qt)(F)}),(0,o.D)(T)&&q.push({label:k("write-throughput"),value:(0,d.Qt)(T)}),(0,o.D)(C)&&(0,o.D)(z)&&(0,o.D)(w)){const e=(0,s.By)(w,C,z),a=(0,l.yf)({nodeId:z,pDiskId:C,vDiskSlotId:w});q.push({label:k("links"),value:(0,g.jsxs)("span",{className:h("links"),children:[!D&&(0,g.jsx)(c.j,{title:k("vdisk-page"),url:e,external:!1}),(0,g.jsx)(c.j,{title:k("developer-ui"),url:a})]})})}return(0,g.jsx)(r._P,{info:q,...p})}},65915:(e,a,i)=>{i.r(a),i.d(a,{VDiskPage:()=>U});var s=i(68963);const o=e=>s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),s.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.28 4.78a.75.75 0 0 0 0-1.06l-2.5-2.5a.75.75 0 1 0-1.06 1.06L6.94 3.5H1.75a.75.75 0 1 0 0 1.5h5.19L5.72 6.22a.75.75 0 1 0 1.06 1.06l2.5-2.5Zm-.06 3.94-2.5 2.5a.75.75 0 0 0 0 1.06l2.5 2.5a.75.75 0 1 0 1.06-1.06L9.06 12.5h5.19a.75.75 0 0 0 0-1.5H9.06l1.22-1.22a.75.75 0 1 0-1.06-1.06ZM14 4.25a1.75 1.75 0 1 1-3.5 0 1.75 1.75 0 0 1 3.5 0ZM3.75 13.5a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5Z",clipRule:"evenodd"}));var t=i(88776),n=i(17095),l=i(49352),d=i(52846),u=i(50422),r=i(14659),c=i(12824),v=i(5922),D=i(4119),p=i(62206),k=i(67359),g=i(30817);const h=JSON.parse('{"group-id":"Group ID","pool-name":"Storage Pool Name","size":"Size","erasure":"Erasure"}'),I=(0,g.wZ)("ydb-group-info",{en:h});var b=i(75859);function f(e){let{data:a,...i}=e;const{GroupID:s,PoolName:o,Used:t,Limit:n,ErasureSpecies:l}=a,d=[];return(0,v.D)(s)&&d.push({label:I("group-id"),value:s}),(0,v.D)(o)&&d.push({label:I("pool-name"),value:o}),(0,v.D)(l)&&d.push({label:I("erasure"),value:l}),Number(t)>=0&&Number(n)>=0&&d.push({label:I("size"),value:(0,b.jsx)(k.y,{value:t,capacity:n,formatValues:D.q3,colorizeProgress:!0})}),(0,b.jsx)(p._P,{info:d,...i})}var m=i(91816),N=i(16084),S=i(79255),w=i(22200),x=i(79061),y=i(99337),j=i(11431),P=i(905),V=i(3764),G=i(51688),R=i(92092);const F=P.h.injectEndpoints({endpoints:e=>({getVDiskData:e.query({queryFn:async e=>{let{nodeId:a,pDiskId:i,vDiskSlotId:s}=e;try{const{vDiskData:e,groupData:o}=await async function(e){let{nodeId:a,pDiskId:i,vDiskSlotId:s}=e,{signal:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=await Promise.all([window.api.getVDiskInfo({nodeId:a,pDiskId:i,vDiskSlotId:s},{signal:o}),window.api.getPDiskInfo({nodeId:a,pDiskId:i},{signal:o}),window.api.getNodeInfo(a,{signal:o})]),n=function(e){var a,i,s,o,t,n,l;let[d,u,r]=e;const c=null===(a=d.VDiskStateInfo)||void 0===a?void 0:a[0],v=(0,V.w)(c),D=null===(i=u.PDiskStateInfo)||void 0===i?void 0:i[0],p=(0,V.b)(D),k=null===(s=r.SystemStateInfo)||void 0===s?void 0:s[0],g=(0,G.Ns)(k),h=null!==(o=null!==(t=v.NodeId)&&void 0!==t?t:p.NodeId)&&void 0!==o?o:g.NodeId,I=g.Host,b=null===(n=g.Roles)||void 0===n?void 0:n[0],f=g.DC,m=null!==(l=v.PDiskId)&&void 0!==l?l:p.PDiskId,N=p.Type;return{...v,NodeId:h,NodeHost:I,NodeType:b,NodeDC:f,PDiskId:m,PDiskType:N}}(t),{StoragePoolName:l,VDiskId:d={}}=n,{GroupID:u}=d;let r;if((0,v.D)(l)&&(0,v.D)(u)){r=function(e,a,i){var s,o;const t=null===(s=e.StoragePools)||void 0===s?void 0:s.find((e=>e.Name===a)),n=null===t||void 0===t||null===(o=t.Groups)||void 0===o?void 0:o.find((e=>e.GroupID===i));if(n&&t)return(0,R.mD)(n,t)}(await window.api.getStorageInfo({nodeId:a,poolName:l,groupId:u,version:j.w.v1},{signal:o}),l,u)}return{vDiskData:n,groupData:r}}({nodeId:a,pDiskId:i,vDiskSlotId:s});return{data:{vDiskData:e,groupData:o}}}catch(o){return{error:o}}},providesTags:["All"]})}),overrideExisting:"throw"});var T=i(24362),C=i(92666),z=i(34051);const q=JSON.parse('{"fqdn":"FQDN","node":"Node","pdisk":"PDisk","vdisk":"VDisk","group":"Group","evict-vdisk-button":"Evict VDisk","evict-vdisk-dialog":"VDisk will be evicted. Do you want to proceed?","evict-vdisk-not-allowed":"You don\'t have enough rights to evict VDisk"}'),A=(0,g.wZ)("ydb-vDisk-page",{en:q}),L=(0,T.cn)("ydb-vdisk-page");function U(){const e=(0,z.zL)(),a=(0,z.ix)(y.d),{isUserAllowedToMakeChanges:i}=(0,z.ix)((e=>e.authentication)),[{nodeId:p,pDiskId:k,vDiskSlotId:g}]=(0,d.useQueryParams)({nodeId:d.StringParam,pDiskId:d.StringParam,vDiskSlotId:d.StringParam});s.useEffect((()=>{e((0,x.J)("vDisk",{nodeId:p,pDiskId:k,vDiskSlotId:g}))}),[e,p,k,g]);const[h]=(0,z.Rj)(),I=(0,v.D)(p)&&(0,v.D)(k)&&(0,v.D)(g)?{nodeId:p,pDiskId:k,vDiskSlotId:g}:n.CN,{currentData:j,isFetching:P,refetch:V}=F.useGetVDiskDataQuery(I,{pollingInterval:h}),G=P&&void 0===j,{vDiskData:R={},groupData:T}=j||{},{NodeHost:q,NodeId:U,NodeType:E,NodeDC:H,PDiskId:Q,PDiskType:Z,Severity:B,VDiskId:M}=R,_=async()=>{const{GroupID:e,GroupGeneration:a,Ring:i,Domain:s,VDisk:o}=M||{};if((0,v.D)(e)&&(0,v.D)(a)&&(0,v.D)(i)&&(0,v.D)(s)&&(0,v.D)(o))return window.api.evictVDisk({groupId:e,groupGeneration:a,failRealmIdx:i,failDomainIdx:s,vDiskIdx:o})},J=async()=>V(),K=()=>{var e;return T?(0,b.jsxs)(s.Fragment,{children:[(0,b.jsx)("div",{className:L("group-title"),children:A("group")}),(0,b.jsx)(f,{data:T}),(0,b.jsx)("div",{className:L("group-disks"),children:null===(e=T.VDisks)||void 0===e?void 0:e.map((e=>(0,b.jsx)(S.c,{data:e,nodes:a,className:L("group-disk")},(0,D.a2)(e.VDiskId))))})]}):null};return(0,b.jsxs)("div",{className:L(null),children:[(()=>{const e=g?"".concat(A("vdisk")," ").concat(g):A("vdisk"),a=k?"".concat(A("pdisk")," ").concat(k):A("pdisk"),i=q||A("node");return(0,b.jsx)(l.ql,{titleTemplate:"%s - ".concat(e," - ").concat(a," \u2014 ").concat(i," \u2014 YDB Monitoring"),defaultTitle:"".concat(e," - ").concat(a," \u2014 ").concat(i," \u2014 YDB Monitoring")})})(),(()=>{const e=q?"".concat(A("fqdn"),": ").concat(q):void 0,a=U?"".concat(A("node"),": ").concat(U):void 0,i=U?"".concat(A("pdisk"),": ").concat(Q):void 0;return(0,b.jsx)(N.V,{loading:G,items:[e,a,E,H,i,Z]})})(),(0,b.jsx)(c.b,{entityName:A("vdisk"),status:(0,C.b)(B),id:(0,D.a2)(null===R||void 0===R?void 0:R.VDiskId)}),(0,b.jsxs)("div",{className:L("controls"),children:[(0,b.jsxs)(r.U,{onConfirmAction:_,onConfirmActionSuccess:J,buttonDisabled:!M||!i,buttonView:"normal",dialogContent:A("evict-vdisk-dialog"),withPopover:!0,popoverContent:A("evict-vdisk-not-allowed"),popoverDisabled:i,children:[(0,b.jsx)(t.J,{data:o}),A("evict-vdisk-button")]}),(0,b.jsx)(u.q,{className:L("auto-refresh-control")})]}),G?(0,b.jsx)(m.b,{rows:20}):(0,b.jsxs)(s.Fragment,{children:[(0,b.jsx)(w.K,{data:R,isVDiskPage:!0}),K()]})]})}}}]);