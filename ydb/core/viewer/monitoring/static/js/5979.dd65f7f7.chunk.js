"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[5979],{81255:(e,i,o)=>{o.r(i),o.d(i,{VDiskGroup:()=>L,VDiskPage:()=>M});var t=o(68963);const d=e=>t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),t.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.28 4.78a.75.75 0 0 0 0-1.06l-2.5-2.5a.75.75 0 1 0-1.06 1.06L6.94 3.5H1.75a.75.75 0 1 0 0 1.5h5.19L5.72 6.22a.75.75 0 1 0 1.06 1.06l2.5-2.5Zm-.06 3.94-2.5 2.5a.75.75 0 0 0 0 1.06l2.5 2.5a.75.75 0 1 0 1.06-1.06L9.06 12.5h5.19a.75.75 0 0 0 0-1.5H9.06l1.22-1.22a.75.75 0 1 0-1.06-1.06ZM14 4.25a1.75 1.75 0 1 1-3.5 0 1.75 1.75 0 0 1 3.5 0ZM3.75 13.5a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5Z",clipRule:"evenodd"}));var n=o(88776),s=o(17095),a=o(49352),r=o(52846),l=o(65070),c=o(30832),v=o(26688),u=o(91816),D=o(27174),k=o(2098),p=o(22200),I=o(905),g=o(14146),m=o(17880),f=o(79061),h=o(33058),y=o(92666),w=o(3764),x=o(51688);const N=I.h.injectEndpoints({endpoints:e=>({getVDiskData:e.query({queryFn:async(e,i)=>{let{nodeId:o,pDiskId:t,vDiskSlotId:d}=e,{signal:n}=i;try{const e=function(e){var i,o,t,d,n,s,a;let[r,l,c]=e;const v=null===(i=r.VDiskStateInfo)||void 0===i?void 0:i[0],u=(0,w.w)(v),D=null===(o=l.PDiskStateInfo)||void 0===o?void 0:o[0],k=(0,w.b)(D),p=null===(t=c.SystemStateInfo)||void 0===t?void 0:t[0],I=(0,x.Ns)(p),g=null!==(d=null!==(n=u.NodeId)&&void 0!==n?n:k.NodeId)&&void 0!==d?d:I.NodeId,m=I.Host,f=null===(s=I.Roles)||void 0===s?void 0:s[0],h=I.DC,y=null!==(a=u.PDiskId)&&void 0!==a?a:k.PDiskId,N=k.Type;return{...u,NodeId:g,NodeHost:m,NodeType:f,NodeDC:h,PDiskId:y,PDiskType:N}}(await Promise.all([window.api.getVDiskInfo({nodeId:o,pDiskId:t,vDiskSlotId:d},{signal:n}),window.api.getNodeWhiteboardPDiskInfo({nodeId:o,pDiskId:t},{signal:n}),window.api.getNodeInfo(o,{signal:n})]));return{data:e}}catch(s){return{error:s}}},providesTags:(e,i,o)=>["All",{type:"VDiskData",id:(0,y.FR)(o.nodeId,o.pDiskId,o.vDiskSlotId)}]})}),overrideExisting:"throw"});var b=o(5922),S=o(24362),V=o(52317),j=o(34301),P=o(17096),T=o(77382),G=o(46393),C=o(30817);const R=JSON.parse('{"fqdn":"FQDN","node":"Node","pdisk":"PDisk","vdisk":"VDisk","group":"Group","evict-vdisk-button":"Evict VDisk","force-evict-vdisk-button":"Evict anyway","evict-vdisk-dialog-header":"Evict VDisk","evict-vdisk-dialog-text":"VDisk will be evicted. Do you want to proceed?","evict-vdisk-not-allowed":"You don\'t have enough rights to evict VDisk"}'),E=(0,C.wZ)("ydb-vDisk-page",{en:R});var H=o(75859);const F=(0,S.cn)("ydb-vdisk-page");function M(){const e=(0,P.zL)(),i=(0,P.ix)(g.VH),[{nodeId:o,pDiskId:k,vDiskSlotId:m}]=(0,r.useQueryParams)({nodeId:r.StringParam,pDiskId:r.StringParam,vDiskSlotId:r.StringParam});t.useEffect((()=>{e((0,f.J)("vDisk",{nodeId:o,pDiskId:k,vDiskSlotId:m}))}),[e,o,k,m]);const[h]=(0,P.Rj)(),w=(0,b.D)(o)&&(0,b.D)(k)&&(0,b.D)(m)?{nodeId:o,pDiskId:k,vDiskSlotId:m}:s.CN,{currentData:x={},isFetching:S,error:V}=N.useGetVDiskDataQuery(w,{pollingInterval:h}),T=S&&void 0===x,{NodeHost:G,NodeId:C,NodeType:R,NodeDC:M,PDiskId:q,PDiskType:B,Severity:Z,VDiskId:Q}=x,{GroupID:_,GroupGeneration:A,Ring:J,Domain:U,VDisk:Y}=Q||{},K=(0,b.D)(_)&&(0,b.D)(A)&&(0,b.D)(J)&&(0,b.D)(U)&&(0,b.D)(Y),O=async e=>{if(K)return window.api.evictVDisk({groupId:_,groupGeneration:A,failRealmIdx:J,failDomainIdx:U,vDiskIdx:Y,force:e}).then((e=>{if(!1===(null===e||void 0===e?void 0:e.result)){throw{statusText:e.error,retryPossible:e.forceRetryPossible}}}))},W=()=>{e(I.h.util.invalidateTags([{type:"VDiskData",id:(0,y.FR)(o||0,k||0,m||0)},"StorageData"]))};return(0,H.jsxs)("div",{className:F(null),children:[(()=>{const e=m?"".concat(E("vdisk")," ").concat(m):E("vdisk"),i=k?"".concat(E("pdisk")," ").concat(k):E("pdisk"),o=G||E("node");return(0,H.jsx)(a.ql,{titleTemplate:"%s - ".concat(e," - ").concat(i," \u2014 ").concat(o," \u2014 YDB Monitoring"),defaultTitle:"".concat(e," - ").concat(i," \u2014 ").concat(o," \u2014 YDB Monitoring")})})(),(()=>{const e=G?"".concat(E("fqdn"),": ").concat(G):void 0,i=C?"".concat(E("node"),": ").concat(C):void 0,o=C?"".concat(E("pdisk"),": ").concat(q):void 0;return(0,H.jsx)(D.B,{className:F("meta"),loading:T,items:[e,i,R,M,o,B]})})(),(0,H.jsx)(c.a,{className:F("title"),entityName:E("vdisk"),status:(0,y.b2)(Z),id:(0,j.a2)(null===x||void 0===x?void 0:x.VDiskId)}),(0,H.jsx)("div",{className:F("controls"),children:(0,H.jsxs)(l.U,{onConfirmAction:O,onConfirmActionSuccess:W,buttonDisabled:!K||!i,buttonView:"normal",dialogHeader:E("evict-vdisk-dialog-header"),dialogText:E("evict-vdisk-dialog-text"),retryButtonText:E("force-evict-vdisk-button"),withPopover:!0,popoverContent:E("evict-vdisk-not-allowed"),popoverDisabled:i,children:[(0,H.jsx)(n.J,{data:d}),E("evict-vdisk-button")]})}),T?(0,H.jsx)(u.b,{rows:20}):(0,H.jsxs)(t.Fragment,{children:[V?(0,H.jsx)(v.V,{error:V}):null,(0,H.jsx)(p.K,{data:x,className:F("info")}),(0,b.D)(_)?(0,H.jsx)(L,{groupId:_}):null]})]})}function L(e){let{groupId:i}=e;const o=(0,m.rU)(),d=(0,m.tS)(),[n]=(0,P.Rj)(),{currentData:s}=h.y.useGetStorageGroupsInfoQuery({groupId:i,shouldUseGroupsHandler:d},{pollingInterval:n,skip:!o}),a=t.useMemo((()=>{const e=function(e,i){var o;return null===e||void 0===e||null===(o=e.groups)||void 0===o?void 0:o.find((e=>Number(e.GroupId)===Number(i)))}(s,i);return e?[e]:void 0}),[s,i]),r=(0,G.M)();return a?(0,H.jsxs)(t.Fragment,{children:[(0,H.jsx)("div",{className:F("group-title"),children:E("group")}),(0,H.jsx)(k.G,{columnsWidthLSKey:T.Ty,data:a,columns:r,settings:V.LE})]}):null}}}]);