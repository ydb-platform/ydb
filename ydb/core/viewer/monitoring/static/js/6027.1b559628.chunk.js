"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[6027],{94790:(e,t,a)=>{a.d(t,{f:()=>o});var r=a(68963),n=a(44920),s=a(75859);const o=e=>{let{children:t,content:a,className:o,pinOnClick:l,hasArrow:d=!0,placement:i=["top","bottom"],...u}=e;const[c,m]=r.useState(!1),[h,p]=r.useState(!1),v=r.useRef(null);return(0,s.jsxs)(r.Fragment,{children:[(0,s.jsx)(n.G,{anchorRef:v,open:h||c,placement:i,hasArrow:d,onOutsideClick:()=>{p(!1)},...u,children:a}),(0,s.jsx)("span",{className:o,ref:v,onClick:l?()=>{p(!0)}:void 0,onMouseEnter:()=>{m(!0)},onMouseLeave:()=>{m(!1)},children:t})]})}},36985:(e,t,a)=>{a.d(t,{C:()=>r.C});var r=a(49201)},68242:(e,t,a)=>{a.d(t,{m:()=>u});var r=a(24362),n=a(94790),s=a(27506),o=a(75859);const l=(0,r.cn)("ydb-pool-bar"),d=e=>{let{data:t={}}=e;const{Usage:a=0}=t,r=Math.min(100*a,100),d=(e=>e>=75?"danger":e>=50&&e<75?"warning":"normal")(r);return(0,o.jsx)(n.f,{className:l({type:d}),content:(0,o.jsx)(s.A8,{data:t,className:l("popup-content")}),children:(0,o.jsx)("div",{style:{height:"".concat(r,"%")},className:l("value",{type:d})})})},i=(0,r.cn)("ydb-pools-graph"),u=e=>{let{pools:t=[]}=e;return(0,o.jsx)("div",{className:i(),children:t.map(((e,t)=>(0,o.jsx)(d,{data:e},t)))})}},74221:(e,t,a)=>{a.d(t,{T:()=>o});var r=a(79734),n=a(80839),s=a(75859);const o=e=>{let{value:t,onChange:a,className:o}=e;return(0,s.jsxs)(r.E,{value:t,onUpdate:a,className:o,children:[(0,s.jsx)(r.E.Option,{value:n.pu.ALL,children:n.pu.ALL}),(0,s.jsx)(r.E.Option,{value:n.pu.PROBLEMS,children:n.pu.PROBLEMS})]})}},11551:(e,t,a)=>{a.d(t,{o:()=>r.o});var r=a(30629)},96027:(e,t,a)=>{a.d(t,{G:()=>G});var r=a(52317),n=a(17096),s=a(68963),o=a(81413),l=a(17095),d=a(52846),i=a(36985),u=a(86969),c=a(1440),m=a(26688),h=a(56350),p=a(74221),v=a(2098),g=a(11551),N=a(47101),b=a(43989),y=a(89256),C=a(14223),w=a(80839),f=a(24362),x=a(51688),j=a(96939),T=a(30817);const P=JSON.parse('{"empty.default":"No such nodes"}'),L=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432"}'),S=(0,T.wZ)("ydb-nodes",{ru:L,en:P});var F=a(75859);const E=(0,f.cn)("ydb-nodes"),A=e=>{var t;let{path:a,database:f,additionalNodesProps:T={}}=e;const[P,L]=(0,d.useQueryParams)({uptimeFilter:d.StringParam,search:d.StringParam}),A=x.U8.parse(P.uptimeFilter),M=null!==(t=P.search)&&void 0!==t?t:"",I=(0,n.zL)(),U=(0,n.ix)(w.qz),[R]=(0,n.Rj)(),[Z]=(0,n.yu)(r.UF),k=a&&!Z,G=y.k.useGetNodesQuery(k?l.CN:{path:a,database:f},{pollingInterval:R}),O=y.k.useGetComputeNodesQuery(k?{path:a}:l.CN,{pollingInterval:R}),{currentData:z,isLoading:D,error:V}=k?O:G,[W,q]=s.useState({sortValue:"NodeId",sortOrder:o.zE}),[H,Q]=(0,n.sC)(W,(e=>{q(e)})),_=e=>{L({search:e||void 0},"replaceIn")},B=e=>{I((0,w.M6)(e))},J=e=>{L({uptimeFilter:e},"replaceIn")},X=s.useMemo((()=>(0,C.A)(null===z||void 0===z?void 0:z.Nodes,{searchValue:M,uptimeFilter:A,problemFilter:U})),[z,M,A,U]),K=(null===z||void 0===z?void 0:z.TotalNodes)||0;return(0,c.u)(V)?(0,F.jsx)(u.J,{}):(0,F.jsxs)(N.l,{children:[(0,F.jsx)(N.l.Controls,{children:(0,F.jsxs)(s.Fragment,{children:[(0,F.jsx)(g.o,{onChange:_,placeholder:"Host name",className:E("search"),value:M}),(0,F.jsx)(p.T,{value:U,onChange:B}),(0,F.jsx)(b.X,{value:A,onChange:J}),(0,F.jsx)(i.C,{total:K,current:X.length,label:"Nodes",loading:D})]})}),V?(0,F.jsx)(m.V,{error:V}):null,(0,F.jsx)(N.l.Table,{loading:D,children:z?(()=>{const e=(0,j.gM)({getNodeRef:T.getNodeRef,database:f}).map((e=>({...e,sortable:(0,x.oh)(e.name)})));return 0!==X.length||U===w.pu.ALL&&A===x.Uu.All?(0,F.jsx)(v.G,{columnsWidthLSKey:j.t5,data:X||[],columns:e,settings:r.LE,sortOrder:H,onSort:Q,emptyDataMessage:S("empty.default"),rowClassName:e=>E("node",{unavailable:(0,x.TA)(e)})}):(0,F.jsx)(h.Q,{name:"thumbsUp",width:"200"})})():null})]})};var M=a(11635),I=a(46925);const U=(e,t)=>"getNodes|offset".concat(t,"|limit").concat(e),R=async e=>{const{type:t="any",storage:a=!1,tablets:r=!0,limit:n,offset:s,sortParams:o,filters:l}=e,{sortOrder:d,columnId:i}=null!==o&&void 0!==o?o:{},{path:u,database:c,searchValue:m,problemFilter:h,uptimeFilter:p}=null!==l&&void 0!==l?l:{},v=await window.api.getNodes({type:t,storage:a,tablets:r,limit:n,offset:s,sortOrder:d,sortValue:i,path:u,database:c,filter:m,problems_only:(0,x.eV)(h),uptime:(0,x.RW)(p)},{concurrentId:U(n,s),signal:e.signal}),g=(0,I.nH)(v);return{data:g.Nodes||[],found:g.FoundNodes||0,total:g.TotalNodes||0}},Z=(0,f.cn)("ydb-nodes"),k=e=>{var t;let{path:a,database:r,parentContainer:o,additionalNodesProps:l}=e;const[c,v]=(0,d.useQueryParams)({uptimeFilter:d.StringParam,search:d.StringParam}),N=x.U8.parse(c.uptimeFilter),y=null!==(t=c.search)&&void 0!==t?t:"",C=(0,n.zL)(),f=(0,n.ix)(w.qz),T=s.useMemo((()=>({path:a,database:r,searchValue:y,problemFilter:f,uptimeFilter:N})),[a,r,y,f,N]),P=(0,j.gM)({getNodeRef:null===l||void 0===l?void 0:l.getNodeRef,database:r}).map((e=>({...e,sortable:(0,x.oh)(e.name)})));return(0,F.jsx)(M.WQ,{columnsWidthLSKey:j.t5,parentContainer:o,columns:P,fetchData:R,limit:50,renderControls:e=>{let{totalEntities:t,foundEntities:a,inited:r}=e;return(0,F.jsxs)(s.Fragment,{children:[(0,F.jsx)(g.o,{onChange:e=>{v({search:e||void 0},"replaceIn")},placeholder:"Host name",className:Z("search"),value:y}),(0,F.jsx)(p.T,{value:f,onChange:e=>{C((0,w.M6)(e))}}),(0,F.jsx)(b.X,{value:N,onChange:e=>{v({uptimeFilter:e},"replaceIn")}}),(0,F.jsx)(i.C,{total:t,current:a,label:"Nodes",loading:!r})]})},renderErrorMessage:e=>e&&403===e.status?(0,F.jsx)(u.J,{position:"left"}):(0,F.jsx)(m.V,{error:e}),renderEmptyDataMessage:()=>f!==w.pu.ALL||N!==x.Uu.All?(0,F.jsx)(h.Q,{name:"thumbsUp",width:"200"}):S("empty.default"),getRowClassName:e=>Z("node",{unavailable:(0,x.TA)(e)}),filters:T,tableName:"nodes"})},G=e=>{let{parentContainer:t,...a}=e;const[s]=(0,n.yu)(r.Qy);return s?(0,F.jsx)(k,{parentContainer:t,...a}):(0,F.jsx)(A,{...a})}},96939:(e,t,a)=>{a.d(t,{t5:()=>C,gM:()=>J,LF:()=>K,sQ:()=>X,Cj:()=>$});var r=a(19812),n=a(99683),s=a(89778),o=a(68242),l=a(67359),d=a(83203),i=a(92398),u=a(54665),c=a(24362),m=a(52317),h=a(83496),p=a(75859);const v=(0,c.cn)("tablets-statistic"),g=e=>{let{tablets:t=[],path:a,nodeId:r,backend:n}=e;const s=(e=>e.map((e=>({label:(0,m.qV)(e.Type),type:e.Type,count:e.Count,state:(0,h.FW)(e.State)}))).sort(((e,t)=>String(e.label).localeCompare(String(t.label)))))(t);return(0,p.jsx)("div",{className:v(),children:s.map(((e,t)=>{var s;const o=(0,u.ax)(u.ZP.node,{id:r,activeTab:i.IA},{tenantName:a,backend:n}),l="".concat(e.label,": ").concat(e.count),c=v("tablet",{state:null===(s=e.state)||void 0===s?void 0:s.toLowerCase()});return n?(0,p.jsx)("a",{href:o,className:c,children:l},t):(0,p.jsx)(d.rU,{to:o,className:c,children:l},t)}))})};var N=a(80816),b=a(46925),y=a(34301);const C="nodesTableColumnsWidth",w="Host",f="DC",x="Rack",j="Version",T="Uptime",P="Memory",L="CPU",S="LoadAverage",F="Tablets",E="TopNodesLoadAverage",A="TopNodesMemory",M="SharedCacheUsage",I="TotalSessions",U={name:"NodeId",header:"#",width:80,render:e=>{let{row:t}=e;return t.NodeId},align:r.ZP.RIGHT,sortable:!1},R=(e,t)=>({name:w,render:a=>{let{row:r}=a;return(0,p.jsx)(s.k,{node:r,getNodeRef:e,database:t})},width:350,align:r.ZP.LEFT,sortable:!1}),Z=e=>({...R(e),width:void 0}),k={name:f,header:"DC",align:r.ZP.LEFT,render:e=>{let{row:t}=e;return t.DC||m.jX},width:60},G={name:x,header:"Rack",align:r.ZP.LEFT,render:e=>{let{row:t}=e;return t.Rack?t.Rack:"\u2014"},width:80},O={name:j,width:200,align:r.ZP.LEFT,render:e=>{let{row:t}=e;return(0,p.jsx)(n.l,{content:t.Version,children:t.Version})},sortable:!1},z={name:T,header:"Uptime",sortAccessor:e=>{let{StartTime:t}=e;return t&&-t},render:e=>{let{row:t}=e;return t.Uptime},align:r.ZP.RIGHT,width:110,sortable:!1},D={name:P,header:"Memory",sortAccessor:e=>{let{MemoryUsed:t=0}=e;return Number(t)},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.MemoryUsed,capacity:t.MemoryLimit,formatValues:y.q3,colorizeProgress:!0})},align:r.ZP.RIGHT,width:120},V={name:L,header:"CPU",sortAccessor:e=>{let{PoolStats:t=[]}=e;return Math.max(...t.map((e=>{let{Usage:t}=e;return Number(t)})))},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.PoolStats?(0,p.jsx)(o.m,{pools:t.PoolStats}):"\u2014"},align:r.ZP.LEFT,width:80,resizeMinWidth:60,sortable:!1},W={name:S,header:"Load average",sortAccessor:e=>{let{LoadAveragePercents:t=[]}=e;return t[0]},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.LoadAveragePercents&&t.LoadAveragePercents.length>0?t.LoadAveragePercents[0]:void 0,percents:!0,colorizeProgress:!0,capacity:100})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},q=e=>({name:F,width:500,resizeMinWidth:500,render:t=>{let{row:a}=t;return a.Tablets?(0,p.jsx)(g,{path:null!==e&&void 0!==e?e:a.TenantName,nodeId:a.NodeId,tablets:a.Tablets}):"\u2014"},align:r.ZP.LEFT,sortable:!1}),H={name:E,header:"Load",render:e=>{let{row:t}=e;return t.LoadAveragePercents&&t.LoadAveragePercents.length>0?(0,p.jsx)(N.a,{value:t.LoadAveragePercents[0].toFixed(),theme:(0,b.w6)(t.LoadAveragePercents[0])}):"\u2014"},align:r.ZP.LEFT,width:80,resizeMinWidth:70,sortable:!1},Q={name:A,header:"Process",render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.MemoryUsed,capacity:t.MemoryLimit,formatValues:y.q3,colorizeProgress:!0})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},_={name:M,header:"Caches",render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.SharedCacheUsed,capacity:t.SharedCacheLimit,formatValues:y.q3,colorizeProgress:!0})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},B={name:I,header:"Sessions",render:e=>{var t;let{row:a}=e;return null!==(t=a.TotalSessions)&&void 0!==t?t:"\u2014"},align:r.ZP.RIGHT,width:100,sortable:!1};function J(e){let{database:t,getNodeRef:a}=e;return[U,R(a,t),k,G,O,z,D,V,W,q(t)]}function X(e){return[H,U,Z(e),O]}function K(e){return[V,U,Z(e)]}function $(e){let{database:t,getNodeRef:a}=e;return[U,R(a,t),z,H,Q,_,B,q(t)]}},89256:(e,t,a)=>{let r;a.d(t,{k:()=>o}),function(e){e.v1="v1",e.v2="v2"}(r||(r={}));var n=a(905),s=a(46925);const o=n.h.injectEndpoints({endpoints:e=>({getNodes:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getNodes({type:"any",storage:!1,tablets:!0,...e},{signal:a});return{data:(0,s.nH)(t)}}catch(r){return{error:r}}},providesTags:["All"]}),getComputeNodes:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getCompute({version:r.v2,...e},{signal:a});return{data:(0,s.Zf)(t)}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"})},46925:(e,t,a)=>{a.d(t,{Zf:()=>l,nH:()=>d,w6:()=>i});var r=a(34301),n=a(99106),s=a(51688);const o=(e,t)=>{var a;return{...e,TenantName:null!==(a=e.Tenant)&&void 0!==a?a:t,SystemState:null===e||void 0===e?void 0:e.Overall,Uptime:(0,r.fG)(null===e||void 0===e?void 0:e.StartTime),LoadAveragePercents:(0,s.y$)(e),DC:e.DataCenter}},l=e=>{const t=((e,t)=>{const a=[];if(e)e.forEach((e=>{a.push(o(e))}));else if(t)for(const n of t){var r;null===(r=n.Nodes)||void 0===r||r.forEach((e=>{a.push(o(e,n.Name))}))}return a})(e.Nodes,e.Tenants);return{Nodes:t,TotalNodes:Number(e.TotalNodes)||t.length,FoundNodes:Number(e.FoundNodes)}},d=e=>{var t;const a=(e.Nodes||[]).map((e=>{var t,a,r,n;const o=Number(null===(t=e.SystemState.SharedCacheStats)||void 0===t?void 0:t.LimitBytes)||void 0;return{...(0,s.Ns)(e.SystemState),Tablets:e.Tablets,NodeId:e.NodeId,TenantName:null===(a=e.SystemState)||void 0===a||null===(r=a.Tenants)||void 0===r?void 0:r[0],SharedCacheUsed:null===(n=e.SystemState.SharedCacheStats)||void 0===n?void 0:n.UsedBytes,SharedCacheLimit:o}}));return{Nodes:a,NodeGroups:null===(t=e.NodeGroups)||void 0===t?void 0:t.map((e=>({name:e.GroupName,count:e.NodeCount}))),TotalNodes:Number(e.TotalNodes)||a.length,FoundNodes:Number(e.FoundNodes)}},i=(0,n.p)(60,80,["success","warning","danger"])}}]);