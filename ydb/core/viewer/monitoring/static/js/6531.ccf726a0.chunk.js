"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[6531],{16531:(t,e,n)=>{n.r(e),n.d(e,{registerYQLCompletionItemProvider:()=>I});var s=n(88424),i=n(62729),a=n(41551);const r={Method:0,Function:1,Constructor:2,Field:3,Variable:4,Class:5,Struct:6,Interface:7,Module:8,Property:9,Event:10,Operator:11,Unit:12,Value:13,Constant:14,Enum:15,EnumMember:16,Keyword:17,Text:18,Color:19,File:20,Reference:21,Customcolor:22,Folder:23,TypeParameter:24,User:25,Issue:26,Snippet:27},u=/[\s'"-/@]/,o={externalDataSource:["external_data_source"],externalTable:["external_table"],replication:["replication"],table:["table","column_table"],tableStore:["column_store"],topic:["pers_queue_group"],view:["view"],tableIndex:["table_index","index"]},l=["dir","unknown"];function c(t){let e=t;return t.match(u)&&(e="`".concat(t,"`")),e}function g(t){let e=0,n=t.length;return t.startsWith("`")&&(e=1),t.endsWith("`")&&(n=-1),t.slice(e,n)}function d(t){return t.startsWith("/")?t.slice(1):t}function m(){let t=arguments.length>1?arguments[1]:void 0,e=d(g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""));const n=d(t);return e.startsWith(n)&&(e=e.slice(n.length)),d(e)}const f={suggestTemplates:0,suggestPragmas:1,suggestEntity:2,suggestColumns:3,suggestColumnAliases:4,suggestTableIndexes:5,suggestTableHints:6,suggestEntitySettings:7,suggestKeywords:8,suggestAggregateFunctions:9,suggestTableFunctions:10,suggestWindowFunctions:11,suggestFunctions:12,suggestSimpleTypes:13,suggestUdfs:14};function p(t){return f[t]}async function y(t,e,n,s){const i=m(s,n),u=await window.api.autocomplete({database:n,prefix:i,limit:1e3}),c=null===s||void 0===s?void 0:s.startsWith("`");if(u.Success){return function(t,e){const n=e.reduce(((t,e)=>{const n=o[e];return n&&n.forEach((e=>t.add(e))),t}),new Set(l));return t.filter((t=>{let{Type:e}=t;return n.has(e)}))}(u.Result.Entities,e).reduce(((e,n)=>{var s;let{Name:i,Type:u}=n;const o="dir"===u,l=o?"".concat(i,"/"):i;let g;return o&&!c&&(g="`".concat(l,"$0`")),e.push({label:l,insertText:null!==(s=g)&&void 0!==s?s:l,kind:o?r.Folder:r.Text,insertTextRules:g?a.languages.CompletionItemInsertTextRule.InsertAsSnippet:a.languages.CompletionItemInsertTextRule.None,detail:u,range:t,command:l.endsWith("/")?{id:"editor.action.triggerSuggest",title:""}:void 0,sortText:S(p("suggestEntity"))}),e}),[])}return[]}async function b(t){return(await async function(){return i.j}()).map((e=>({label:e,insertText:e,kind:r.Function,detail:"Function",range:t,sortText:S(p("suggestFunctions"))})))}async function T(t){return(await async function(){return i.vy}()).map((e=>({label:e,insertText:e,kind:r.TypeParameter,detail:"Type",range:t,sortText:S(p("suggestSimpleTypes"))})))}async function w(t){return(await async function(){return i.t6}()).map((e=>({label:e,insertText:e,kind:r.Function,detail:"UDF",range:t,sortText:S(p("suggestUdfs"))})))}async function v(t){return(await async function(){return i.JX}()).map((e=>({label:e,insertText:e,kind:r.Function,detail:"Window function",range:t,sortText:S(p("suggestWindowFunctions"))})))}async function x(t){return(await async function(){return i.yJ}()).map((e=>({label:e,insertText:e,kind:r.Function,detail:"Table function",range:t,sortText:S(p("suggestTableFunctions"))})))}async function h(t){return(await async function(){return i.Ot}()).map((e=>({label:e,insertText:e,kind:r.Function,detail:"Aggregate function",range:t,sortText:S(p("suggestAggregateFunctions"))})))}async function C(t){return(await async function(){return i.EQ}()).map((e=>({label:e,insertText:e,kind:r.Module,detail:"Pragma",range:t,sortText:S(p("suggestPragmas"))})))}async function F(t,e){const n=await async function(t){return i.S8[t]}(e);return n.map((e=>({label:e,insertText:e,kind:r.Property,detail:"Setting",range:t,sortText:S(p("suggestEntitySettings"))})))}const k="abcdefghijklmnopqrstuvwxyz";function S(t){const e=k[t];if(e)return e;const n=Math.floor(t/k.length),s=t%k.length;return k.slice(-1).repeat(n)+k[s]}function E(t){return async(e,s,i,a)=>{const u=function(t,e){const{startColumn:n,endColumn:s}=t.getWordUntilPosition(e),i="$"===t.getLineContent(e.lineNumber)[n-2]?1:0;return{startColumn:n-i,startLineNumber:e.lineNumber,endColumn:s,endLineNumber:e.lineNumber}}(e,s),o=await async function(t,e,s,i){const{parseYqlQuery:a}=await n.e(8607).then(n.bind(n,68607)),u={line:e.lineNumber,column:e.column},o=a(t.getValue(),u);let l=[],d=[],f=[],k=[],E=[],P=[],I=[],W=[],_=[];if(o.suggestEntity){const n=function(t,e){var n,s,i,a;const r=t.findPreviousMatch("\\s(`?[^\\s]*)",e,!0,!1,null,!0),u=t.findNextMatch("([^\\s]*)`?",e,!0,!1,null,!0);return"".concat(null!==(n=null===r||void 0===r||null===(s=r.matches)||void 0===s?void 0:s[1])&&void 0!==n?n:"").concat(null!==(i=null===u||void 0===u||null===(a=u.matches)||void 0===a?void 0:a[1])&&void 0!==i?i:"")}(t,e);l=await y(s,o.suggestEntity,i,n)}o.suggestFunctions&&(d=await b(s));o.suggestAggregateFunctions&&(f=await h(s));o.suggestWindowFunctions&&(k=await v(s));o.suggestTableFunctions&&(E=await x(s));o.suggestSimpleTypes&&(I=await T(s));o.suggestUdfs&&(P=await w(s));o.suggestPragmas&&(W=await C(s));o.suggestEntitySettings&&(_=await F(s,o.suggestEntitySettings));const N=await function(t,e){return e?null===e||void 0===e?void 0:e.map((e=>({label:e.name,insertText:e.name,kind:r.Field,detail:"Column alias",range:t,sortText:S(p("suggestColumnAliases"))}))):[]}(s,o.suggestColumnAliases),A=await async function(t,e,n){var s,i,a;if(null===e||void 0===e||!e.tables)return[];const u=[],o=e.tables.length>1,l=null!==(s=null===(i=e.tables)||void 0===i?void 0:i.map((t=>{let e=g(t.name);return e.endsWith("/")||(e="".concat(e,"/")),m(e,n)})))&&void 0!==s?s:[],d=Array.from(new Set(l)),f=await window.api.autocomplete({database:n,table:d,limit:1e3});if(!f.Success)return[];const y=null===(a=e.tables)||void 0===a?void 0:a.reduce(((t,e)=>{var s;const i=m(g(e.name),n),a=null!==(s=t[i])&&void 0!==s?s:[];return e.alias&&a.push(e.alias),t[i]=a,t}),{});return f.Result.Entities.forEach((e=>{if("column"!==e.Type)return;const s=c(e.Name),i=m(e.Parent,n),a=y[i];if(null!==a&&void 0!==a&&a.length)a.forEach((e=>{const n="".concat(e,".").concat(s);u.push({label:n,insertText:n,kind:r.Field,detail:"Column",range:t,sortText:S(p("suggestColumns"))})}));else{let e=s;o&&(e="".concat(c(i),".").concat(s)),u.push({label:e,insertText:e,kind:r.Field,detail:"Column",range:t,sortText:S(p("suggestColumns"))})}})),u}(s,o.suggestColumns,i),M=function(t,e){return e?null===e||void 0===e?void 0:e.map((e=>({label:e.value,insertText:e.value,kind:r.Keyword,detail:"Keyword",range:t,sortText:S(p("suggestKeywords"))}))):[]}(s,o.suggestKeywords),U=[...l,...d,...k,...E,...P,...I,...W,...N,...A,...M,...f,..._];return U}(e,s,u,t);return{suggestions:o}}}let P;function I(t){P&&P.dispose(),P=s.Mj.registerCompletionItemProvider(i.Oo,{triggerCharacters:[" ","",",",".","`","(","/"],provideCompletionItems:E(t)})}}}]);