"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[6581],{62776:(e,t,r)=>{r.d(t,{a:()=>n.a});var n=r(91173)},11635:(e,t,r)=>{r.d(t,{WQ:()=>O});var n=r(68963),s=r(5922),l=r(47101);const a=r(905).h.injectEndpoints({endpoints:function(e){return{fetchTableChunk:e.query({queryFn:async(e,t)=>{let{offset:r,limit:n,sortParams:s,filters:l,fetchData:a}=e,{signal:o}=t;try{return{data:await a({limit:n,offset:r,filters:l,sortParams:s,signal:o})}}catch(i){return{error:i}}},providesTags:["All"]})}}});var o=r(17096),i=r(26688),d=r(56711);const u="left",c=!0,m=-1,h=40;const g=(0,r(24362).cn)("ydb-paginated-table");var v=r(75859);const p=e=>{let{children:t,className:r,height:n,width:s,align:l=u,resizeable:a}=e;return(0,v.jsx)("td",{className:g("row-cell",{align:l},r),style:{height:`${n}px`,width:`${s}px`,maxWidth:a?`${s}px`:void 0},children:t})},f=e=>{let{index:t,columns:r,height:n}=e;return(0,v.jsx)("tr",{className:g("row",{loading:!0}),children:r.map((e=>{var r;const s=null!==(r=e.resizeable)&&void 0!==r?r:c;return(0,v.jsx)(p,{height:n,width:e.width,align:e.align,className:e.className,resizeable:s,children:(0,v.jsx)(d.O,{className:g("row-skeleton"),style:{width:"80%",height:"50%"}})},`${e.name}${t}`)}))})},b=e=>{let{row:t,index:r,columns:n,getRowClassName:s,height:l}=e;const a=null===s||void 0===s?void 0:s(t);return(0,v.jsx)("tr",{className:g("row",a),children:n.map((e=>{var n;const s=null!==(n=e.resizeable)&&void 0!==n?n:c;return(0,v.jsx)(p,{height:l,width:e.width,align:e.align,className:e.className,resizeable:s,children:e.render({row:t,index:r})},`${e.name}${r}`)}))})},w=e=>{let{columns:t,children:r}=e;return(0,v.jsx)("tr",{className:g("row",{empty:!0}),children:(0,v.jsx)("td",{colSpan:t.length,className:g("td"),children:r})})},x=(0,n.memo)((function(e){var t;let{id:r,limit:l,rowHeight:d,columns:u,fetchData:c,tableName:m,filters:h,sortParams:g,observer:p,getRowClassName:x,renderErrorMessage:C,onDataFetched:j,isActive:y}=e;const S=n.useRef(null),[E,N]=n.useState(!0),[R]=(0,o.Rj)(),k={offset:r*l,limit:l,fetchData:c,filters:h,sortParams:g,tableName:m};a.useFetchTableChunkQuery(k,{skip:E||!y,pollingInterval:R});const{currentData:I,error:M}=a.endpoints.fetchTableChunk.useQueryState(k);n.useEffect((()=>{let e=0;return y&&E&&(e=window.setTimeout((()=>{N(!1)}),200)),()=>{window.clearTimeout(e)}}),[y,E]),n.useEffect((()=>{const e=S.current;return e&&p.observe(e),()=>{e&&p.unobserve(e)}}),[p]),n.useEffect((()=>{if(I&&y){const{total:e=0,found:t=0}=I;j(e,t)}}),[I,y,j]);const z=(null===I||void 0===I||null===(t=I.data)||void 0===t?void 0:t.length)||l,O=z?z*d:l*d;return(0,v.jsx)("tbody",{ref:S,id:r.toString(),style:{height:`${O}px`,display:y?"table-row-group":"block"},children:(()=>{if(!y)return null;if(!I){if(M){const e=M;return(0,v.jsx)(w,{columns:u,children:C?C(e):(0,v.jsx)(i.V,{error:e})})}return(0,s.c$)(z).map((e=>(0,v.jsx)(f,{columns:u,height:d,index:e},e)))}return I.data.map(((e,t)=>(0,v.jsx)(b,{index:t,row:e,columns:u,height:d,getRowClassName:x},t)))})()})}));function C(e){let{minWidth:t,maxWidth:r,getCurrentColumnWidth:s,onResize:l}=e;const a=n.useRef(null),[o,i]=n.useState(!1);return n.useEffect((()=>{const e=a.current;if(!e)return;let n,o,d;const u=function(e){let t,r=null;return function(){for(var n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];t=s,"number"!==typeof r&&(r=requestAnimationFrame((()=>{e(...t),r=null})))}}((e=>{if(j(e),"number"!==typeof n||"number"!==typeof o)return;const s=e.clientX-n,a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return Math.max(t,Math.min(e,r))}(o+s,t,r);a!==d&&(d=a,null===l||void 0===l||l(d))})),c=e=>{j(e),void 0!==d&&(null===l||void 0===l||l(d)),i(!1),n=void 0,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)},m=e=>{o=s(),j(e),n=e.clientX,i(!0),document.addEventListener("mousemove",u),document.addEventListener("mouseup",c)};return e.addEventListener("mousedown",m),()=>{e.removeEventListener("mousedown",m),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)}}),[l,t,r,s]),(0,v.jsx)("span",{ref:a,className:g("resize-handler",{resizing:o}),onClick:e=>j(e)})}function j(e){e.preventDefault(),e.stopPropagation()}const y=e=>{let{order:t}=e;return(0,v.jsx)("svg",{className:g("sort-icon",{desc:-1===t}),viewBox:"0 0 10 6",width:"10",height:"6",children:(0,v.jsx)("path",{fill:"currentColor",d:"M0 5h10l-5 -5z"})})},S=e=>{let{sortOrder:t,sortable:r,defaultSortOrder:n}=e;return r?(0,v.jsx)("span",{className:g("sort-icon-container",{shadow:!t}),children:(0,v.jsx)(y,{order:t||n})}):null},E=e=>{var t;let{column:r,resizeable:s,sortOrder:l,defaultSortOrder:a,onSort:o,rowHeight:i,onCellMount:d,onCellUnMount:u,onColumnsResize:c}=e;const m=n.useRef(null);n.useEffect((()=>{const e=m.current;return e&&(null===d||void 0===d||d(e)),()=>{e&&(null===u||void 0===u||u(e))}}),[d,u]);const h=n.useCallback((()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.getBoundingClientRect().width}),[]),p=n.useCallback((e=>{null===c||void 0===c||c(r.name,e)}),[c,r.name]),f=null!==(t=r.header)&&void 0!==t?t:r.name,b={height:`${i}px`,width:`${r.width}px`,minWidth:s?`${r.width}px`:void 0,maxWidth:s?`${r.width}px`:void 0};return(0,v.jsxs)("th",{ref:m,className:g("head-cell-wrapper"),style:b,children:[(0,v.jsxs)("div",{className:g("head-cell",{align:r.align,sortable:r.sortable},r.className),onClick:()=>{r.sortable&&(null===o||void 0===o||o(r.name))},children:[(0,v.jsx)("div",{className:g("head-cell-content"),children:f}),(0,v.jsx)(S,{sortOrder:l,sortable:r.sortable,defaultSortOrder:a})]}),s?(0,v.jsx)(C,{maxWidth:r.resizeMaxWidth,minWidth:r.resizeMinWidth,getCurrentColumnWidth:h,onResize:p}):null]})},N=e=>{let{columns:t,onSort:r,onColumnsResize:s,defaultSortOrder:l=m,rowHeight:a=h}=e;const[o,i]=n.useState({}),d=e=>{let t={};if(e===o.columnId){if(o.sortOrder&&o.sortOrder!==l)return i(t),void(null===r||void 0===r||r(t));t={sortOrder:1===o.sortOrder?-1:1,columnId:e}}else t={sortOrder:l,columnId:e};null===r||void 0===r||r(t),i(t)};return(0,v.jsxs)(n.Fragment,{children:[(0,v.jsx)("colgroup",{children:t.map((e=>(0,v.jsx)("col",{style:{width:`${e.width}px`}},e.name)))}),(0,v.jsx)("thead",{className:g("head"),children:(0,v.jsx)("tr",{children:t.map((e=>{var t;const r=o.columnId===e.name?o.sortOrder:void 0,n=s&&(null!==(t=e.resizeable)&&void 0!==t?t:c);return(0,v.jsx)(E,{column:e,resizeable:n,sortOrder:r,defaultSortOrder:l,onSort:d,rowHeight:a,onColumnsResize:s},e.name)}))})})]})};var R=r(30817);const k=JSON.parse('{"empty":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"}'),I=(0,R.wZ)("ydb-paginated-table",{ru:k,en:{empty:"No data"}}),M=e=>{let{limit:t,fetchData:r,filters:a,tableName:o,columns:i,getRowClassName:d,rowHeight:u=h,parentContainer:c,initialSortParams:m,onColumnsResize:p,renderControls:f,renderErrorMessage:b,renderEmptyDataMessage:C,containerClassName:j}=e;const[y,S]=n.useState(m),[E,R]=n.useState(t),[k,M]=n.useState(0),[z,O]=n.useState([]),[W,K]=n.useState(!0),D=n.useRef(null),F=n.useCallback(((e,t)=>{R(e),M(t),K(!1)}),[]),T=(e=>{let{onEntry:t,onLeave:r,parentContainer:s}=e;const l=n.useRef();return n.useEffect((()=>(l.current=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?t(e.target.id):r(e.target.id)}))}),{root:s,rootMargin:"100%"}),()=>{var e;null===(e=l.current)||void 0===e||e.disconnect(),l.current=void 0})),[s,t,r]),l.current})({onEntry:n.useCallback((e=>{O((t=>[...new Set([...t,Number(e)])]))}),[]),onLeave:n.useCallback((e=>{O((t=>t.filter((t=>t!==Number(e)))))}),[]),parentContainer:c});n.useLayoutEffect((()=>{var e;(R(t),M(0),K(!0),c)?c.scrollTo(0,0):null===(e=D.current)||void 0===e||e.scrollTo(0,0);O([0])}),[a,t,c]);const $=()=>{if(!T)return null;if(!W&&0===k)return(0,v.jsx)("tbody",{children:(0,v.jsx)(w,{columns:i,children:C?C():I("empty")})});const e=k||t,n=Math.ceil(e/t);return(0,s.c$)(n).map((e=>(0,v.jsx)(x,{id:e,limit:t,rowHeight:u,columns:i,fetchData:r,filters:a,tableName:o,sortParams:y,getRowClassName:d,renderErrorMessage:b,onDataFetched:F,isActive:z.includes(e),observer:T},e)))},A=()=>(0,v.jsxs)("table",{className:g("table"),children:[(0,v.jsx)(N,{columns:i,onSort:S,onColumnsResize:p}),$()]});return(0,v.jsx)("div",{ref:D,className:g(null,j),children:f?(0,v.jsxs)(l.l,{children:[(0,v.jsx)(l.l.Controls,{children:f({inited:!W,totalEntities:E,foundEntities:k})}),(0,v.jsx)(l.l.Table,{children:A()})]}):A()})};var z=r(89712);function O(e){let{columnsWidthLSKey:t,columns:r,...n}=e;const[s,l]=(0,z.M)(t),a=function(e,t){return e.map((e=>{var r;return{...e,width:null!==(r=t[e.name])&&void 0!==r?r:e.width}}))}(r,s);return(0,v.jsx)(M,{columns:a,onColumnsResize:l,containerClassName:g("resizeable-table-container"),...n})}},39724:(e,t,r)=>{r.d(t,{V:()=>A});var n=r(52317),s=r(17096),l=r(52846),a=r(82073),o=r(8747),i=r(77915),d=r(95829),u=r(30553),c=r(51688),m=r(41616),h=r(93856),g=r(68963),v=r(96409),p=r(11635),f=r(17880),b=r(64782),w=r(51323),x=r(26491),C=r(27070),j=r(15106);const y=(e,t)=>`getStorageGroups|offset${t}|limit${e}`;var S=r(43817),E=r(75859);const N=e=>{let{columns:t,searchValue:r,visibleEntities:n,database:s,nodeId:l,onShowAll:a,parentContainer:o,renderControls:i,renderErrorMessage:u}=e;const c=(0,f.rU)(),m=(0,f.tS)(),h=(N=m,g.useCallback((async e=>{const{limit:t,offset:r,sortParams:n,filters:s}=e,{sortOrder:l,columnId:a}=null!==n&&void 0!==n?n:{},{searchValue:o,visibleEntities:i,database:d,nodeId:u}=null!==s&&void 0!==s?s:{},c=(0,j.P)(a)?(0,C.A)(a,l):void 0,{groups:m,found:h,total:g}=await(0,x.R)({limit:t,offset:r,sort:c,filter:o,with:i,database:d,nodeId:u,shouldUseGroupsHandler:N},{concurrentId:y(t,r)});return{data:m||[],found:h||0,total:g||0}}),[N]));var N;const R=g.useMemo((()=>({searchValue:r,visibleEntities:n,database:s,nodeId:l})),[r,n,s,l]);return(0,E.jsx)(v.s,{loading:!c,children:(0,E.jsx)(p.WQ,{columnsWidthLSKey:w.Ty,parentContainer:o,columns:t,fetchData:h,limit:50,renderControls:i,renderErrorMessage:u,renderEmptyDataMessage:()=>n!==d.G.all?(0,E.jsx)(b.a,{onShowAll:a,visibleEntities:n}):(0,S.Z)("empty.default"),filters:R,tableName:"storage-groups"})})};var R=r(46393),k=r(64682),I=r(55434),M=r(92092);const z=(e,t)=>`getStorageNodes|offset${t}|limit${e}`,O=async e=>{const{type:t="static",storage:r=!0,limit:n,offset:s,sortParams:l,filters:a}=e,{searchValue:o,nodesUptimeFilter:i,visibleEntities:d,database:u}=null!==a&&void 0!==a?a:{},{sortOrder:m,columnId:h}=null!==l&&void 0!==l?l:{},g=(0,c.oh)(h)?(0,C.A)(h,m):void 0,v=await window.api.getNodes({type:t,storage:r,limit:n,offset:s,sort:g,filter:o,uptime:(0,c.RW)(i),with:d,database:u},{concurrentId:z(n,s)}),p=(0,M.Y2)(v);return{data:p.nodes||[],found:p.found||0,total:p.total||0}};var W=r(73790),K=r(20108);const D=e=>{let{columns:t,searchValue:r,visibleEntities:n,nodesUptimeFilter:s,database:l,onShowAll:a,parentContainer:o,renderControls:i,renderErrorMessage:u}=e;const m=g.useMemo((()=>({searchValue:r,visibleEntities:n,nodesUptimeFilter:s,database:l})),[r,n,s,l]);return(0,E.jsx)(p.WQ,{columnsWidthLSKey:I.Wj,parentContainer:o,columns:t,fetchData:O,rowHeight:51,limit:50,renderControls:i,renderErrorMessage:u,renderEmptyDataMessage:()=>n!==d.G.all||s!==c.Uu.All?(0,E.jsx)(k.r,{onShowAll:a,nodesUptimeFilter:s,visibleEntities:n}):(0,W.Z)("empty.default"),getRowClassName:K.q,filters:m,tableName:"storage-nodes"})};var F=r(24733);const T=e=>{var t;let{database:r,nodeId:n,groupId:s,parentContainer:g}=e;const{balancer:v}=(0,i.kW)(),{additionalNodesProps:p}=(0,m.f)({balancer:v}),[f,b]=(0,l.useQueryParams)({type:l.StringParam,visible:l.StringParam,search:l.StringParam,uptimeFilter:l.StringParam}),w=u.Y.parse(f.type),x="groups"===w,C="nodes"===w,j=u.z.parse(f.visible),y=null!==(t=f.search)&&void 0!==t?t:"",S=c.U8.parse(f.uptimeFilter),{columnsToShow:k,columnsToSelect:I,setColumns:M}=(0,F.i)({additionalNodesProps:p,visibleEntities:j,database:r,groupId:s}),{columnsToShow:z,columnsToSelect:O,setColumns:W}=(0,R.k)(j),K=e=>{b({search:e||void 0},"replaceIn")},T=e=>{b({visible:e},"replaceIn")},$=e=>{b({type:e},"replaceIn")},A=e=>{b({uptimeFilter:e},"replaceIn")},L=()=>{b({visible:d.G.all,uptimeFilter:c.Uu.All},"replaceIn")},P=e=>{let{totalEntities:t,foundEntities:r,inited:n}=e;const s=x?O:I,l=x?W:M;return(0,E.jsx)(h.m,{searchValue:y,handleSearchValueChange:K,withTypeSelector:!0,storageType:w,handleStorageTypeChange:$,visibleEntities:j,handleVisibleEntitiesChange:T,nodesUptimeFilter:S,handleNodesUptimeFilterChange:A,withGroupsUsageFilter:!1,entitiesCountCurrent:r,entitiesCountTotal:t,entitiesLoading:!n,columnsToSelect:s,handleSelectedColumnsUpdate:l})},U=e=>403===e.status?(0,E.jsx)(a.J,{position:"left"}):(0,E.jsx)(o.V,{error:e});return C?(0,E.jsx)(D,{searchValue:y,visibleEntities:j,nodesUptimeFilter:S,database:r,onShowAll:L,parentContainer:g,renderControls:P,renderErrorMessage:U,columns:k}):(0,E.jsx)(N,{searchValue:y,visibleEntities:j,database:r,nodeId:n,onShowAll:()=>{T(d.G.all)},parentContainer:g,renderControls:P,renderErrorMessage:U,columns:z})};var $=r(45578);const A=e=>{let{parentContainer:t,...r}=e;const[l]=(0,s.yu)(n.Qy);return l?(0,E.jsx)(T,{parentContainer:t,...r}):(0,E.jsx)($.K,{...r})}},83496:(e,t,r)=>{r.d(t,{FW:()=>a,KR:()=>o});var n=r(75850),s=r(28164);const l={[s.g.Dead]:n.K.Red,[s.g.Created]:n.K.Yellow,[s.g.ResolveStateStorage]:n.K.Yellow,[s.g.Candidate]:n.K.Yellow,[s.g.BlockBlobStorage]:n.K.Yellow,[s.g.WriteZeroEntry]:n.K.Yellow,[s.g.Restored]:n.K.Yellow,[s.g.Discover]:n.K.Yellow,[s.g.Lock]:n.K.Yellow,[s.g.Stopped]:n.K.Yellow,[s.g.ResolveLeader]:n.K.Yellow,[s.g.RebuildGraph]:n.K.Yellow,[s.g.Deleted]:n.K.Green,[s.g.Active]:n.K.Green},a=(Object.keys(s.g),Object.entries(l).reduce(((e,t)=>{let[r,n]=t;return e[n]?e[n].push(r):e[n]=[r],e}),{}),e=>{if(!e)return n.K.Grey;return t=e,Object.values(n.K).includes(t)?e:l[e];var t});function o(e){if(!e)return"unknown";switch(e){case s.g.Dead:return"danger";case s.g.Active:case s.g.Deleted:return"success";default:return"warning"}}}}]);