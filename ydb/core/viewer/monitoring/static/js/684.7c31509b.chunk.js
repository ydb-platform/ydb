"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[684],{22983:(e,t,s)=>{s.d(t,{B:()=>d});var i=s(59284),n=s(84476),o=s(84375),a=s(55974),l=s(42829),r=s(60712);function d({children:e,onConfirmAction:t,onConfirmActionSuccess:s,dialogHeader:d,dialogText:c,retryButtonText:u,buttonDisabled:m=!1,buttonView:p="action",buttonTitle:h,buttonClassName:v,withPopover:g=!1,popoverContent:f,popoverPlacement:b="right",popoverDisabled:x=!0}){const[k,y]=i.useState(!1),[j,N]=i.useState(!1),[S,w]=i.useState(!1),D=()=>(0,r.jsx)(n.$,{onClick:()=>y(!0),view:p,disabled:m,loading:!m&&j,className:v,title:h,children:e});return(0,r.jsxs)(i.Fragment,{children:[(0,r.jsx)(a.g,{visible:k,header:d,text:c,withRetry:S,retryButtonText:u,onConfirm:async e=>{N(!0),await t(e)},onConfirmActionSuccess:async()=>{w(!1);try{await(null===s||void 0===s?void 0:s())}finally{N(!1)}},onConfirmActionError:e=>{w((0,l.D)(e)),N(!1)},onClose:()=>{y(!1)}}),g?(0,r.jsx)(o.A,{content:f,placement:b,disabled:x,children:D()}):D()]})}},55974:(e,t,s)=>{s.d(t,{g:()=>f});var i=s(59284),n=s(18677),o=s(71153),a=s(74321),l=s(2198),r=s(99991),d=s(89954),c=s(77506),u=s(48372);const m=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),p=(0,u.g4)("ydb-critical-action-dialog",{en:m});var h=s(60712);const v=(0,c.cn)("ydb-critical-dialog"),g=e=>e.data&&"issues"in e.data&&e.data.issues?(0,h.jsx)(d.O,{hideSeverity:!0,data:e.data}):403===e.status?p("no-rights-error"):e.statusText?e.statusText:p("default-error");function f({visible:e,header:t,text:s,withRetry:d,retryButtonText:c,withCheckBox:u,onClose:m,onConfirm:f,onConfirmActionSuccess:b,onConfirmActionError:x}){const[k,y]=i.useState(!1),[j,N]=i.useState(),[S,w]=i.useState(!1),D=async e=>(y(!0),f(e).then((()=>{b(),m()})).catch((e=>{x(e),N(e)})).finally((()=>{y(!1)})));return(0,h.jsx)(l.l,{open:e,hasCloseButton:!1,className:v(),size:"s",onClose:m,onTransitionExited:()=>{N(void 0),w(!1)},children:j?(0,h.jsxs)(i.Fragment,{children:[(0,h.jsx)(l.l.Header,{caption:t}),(0,h.jsx)(l.l.Body,{className:v("body"),children:(0,h.jsxs)("div",{className:v("body-message",{error:!0}),children:[(0,h.jsx)("span",{className:v("error-icon"),children:(0,h.jsx)(n.A,{width:"24",height:"22"})}),g(j)]})}),(0,h.jsx)(l.l.Footer,{loading:!1,preset:"default",textButtonApply:d?c||p("button-retry"):void 0,textButtonCancel:p("button-close"),onClickButtonApply:()=>D(!0),onClickButtonCancel:m})]}):(0,h.jsxs)(i.Fragment,{children:[(0,h.jsx)(l.l.Header,{caption:t}),(0,h.jsxs)(l.l.Body,{className:v("body"),children:[(0,h.jsxs)("div",{className:v("body-message",{warning:!0}),children:[(0,h.jsx)("span",{className:v("warning-icon"),children:(0,h.jsx)(r.I,{data:o.A,size:24})}),s]}),u?(0,h.jsx)(a.S,{checked:S,onUpdate:w,children:p("checkbox-text")}):null]}),(0,h.jsx)(l.l.Footer,{loading:k,preset:"default",textButtonApply:p("button-confirm"),textButtonCancel:p("button-cancel"),propsButtonApply:{type:"submit",disabled:u&&!S},onClickButtonCancel:m,onClickButtonApply:()=>D()})]})})}},42829:(e,t,s)=>{s.d(t,{D:()=>i});const i=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},3685:(e,t,s)=>{s.d(t,{$:()=>l});var i=s(77506),n=s(33775),o=s(60712);const a=(0,i.cn)("ydb-entity-page-title");function l({entityName:e,status:t,id:s,className:i}){return(0,o.jsxs)("div",{className:a(null,i),children:[(0,o.jsx)("span",{className:a("prefix"),children:e}),(0,o.jsx)(n.k,{className:a("icon"),status:t,size:"s"}),s]})}},42655:(e,t,s)=>{s.d(t,{y:()=>c});var i=s(59284),n=s(89169),o=s(77506),a=s(66781),l=s(60712);const r=(0,o.cn)("ydb-info-viewer-skeleton"),d=()=>(0,l.jsxs)("div",{className:r("label"),children:[(0,l.jsx)(n.E,{className:r("label__text")}),(0,l.jsx)("div",{className:r("label__dots")})]}),c=({rows:e=8,className:t,delay:s=600})=>{const[o]=(0,a.y)(s);let c=(0,l.jsxs)(i.Fragment,{children:[(0,l.jsx)(d,{}),(0,l.jsx)(n.E,{className:r("value")})]});return o||(c=null),(0,l.jsx)("div",{className:r(null,t),children:[...new Array(e)].map(((e,t)=>(0,l.jsx)("div",{className:r("row"),children:c},`skeleton-row-${t}`)))})}},56735:(e,t,s)=>{s.d(t,{Q:()=>y});var i=s(87184),n=s(92459),o=s(78668),a=s(7435),l=s(46549),r=s(77506),d=s(56839),c=s(31684),u=s(90182),m=s(18863),p=s(25196),h=s(15132),v=s(33775),g=s(48372);const f=JSON.parse('{"type":"Type","path":"Path","guid":"GUID","serial-number":"Serial Number","shared-with-os":"SharedWithOs","drive-status":"Drive Status","state":"State","device":"Device","realtime":"Realtime","space":"Space","slots":"Slots","log-size":"Log Size","system-size":"System Size","links":"Links","developer-ui":"Developer UI","pdisk-page":"PDisk page","yes":"Yes"}'),b=(0,g.g4)("ydb-pDisk-info",{en:f});var x=s(60712);const k=(0,r.cn)("ydb-pdisk-info");function y({pDisk:e,nodeId:t,withPDiskPageLink:s,className:r}){const g=(0,u.N4)(o._5),[f,y,j,N]=function({pDisk:e,nodeId:t,withPDiskPageLink:s,isUserAllowedToMakeChanges:i}){const{PDiskId:o,Path:r,Guid:u,Category:m,Type:g,Device:f,Realtime:y,State:j,SerialNumber:N,TotalSize:S,AllocatedSize:w,StatusV2:D,NumActiveSlots:I,ExpectedSlotCount:C,LogUsedSize:T,LogTotalSize:E,SystemSize:P,SharedWithOs:z}=e||{},A=[];(0,a.f8)(m)&&A.push({label:b("type"),value:g}),(0,a.f8)(r)&&A.push({label:b("path"),value:r}),(0,a.f8)(u)&&A.push({label:b("guid"),value:u}),N&&A.push({label:b("serial-number"),value:N}),(0,a.f8)(z)&&A.push({label:b("shared-with-os"),value:b("yes")});const _=[];(0,a.f8)(D)&&_.push({label:b("drive-status"),value:D}),(0,a.f8)(j)&&_.push({label:b("state"),value:j}),(0,a.f8)(f)&&_.push({label:b("device"),value:(0,x.jsx)(v.k,{status:f})}),(0,a.f8)(y)&&_.push({label:b("realtime"),value:(0,x.jsx)(v.k,{status:y})});const M=[];M.push({label:b("space"),value:(0,x.jsx)(h.O,{value:w,capacity:S,formatValues:d.vX,colorizeProgress:!0})}),(0,a.f8)(I)&&(0,a.f8)(C)&&M.push({label:b("slots"),value:(0,x.jsx)(h.O,{value:I,capacity:C})}),(0,a.f8)(T)&&(0,a.f8)(E)&&M.push({label:b("log-size"),value:(0,x.jsx)(h.O,{value:T,capacity:E,formatValues:d.vX})}),(0,a.f8)(P)&&M.push({label:b("system-size"),value:(0,l.z3)({value:P})});const O=[];if((s||i)&&(0,a.f8)(o)&&(0,a.f8)(t)){const e=(0,n.Ck)(o,t),a=(0,c.ar)({nodeId:t,pDiskId:o});O.push({label:b("links"),value:(0,x.jsxs)("span",{className:k("links"),children:[s&&(0,x.jsx)(p.K,{title:b("pdisk-page"),url:e,external:!1}),i&&(0,x.jsx)(p.K,{title:b("developer-ui"),url:a})]})})}return[A,_,M,O]}({pDisk:e,nodeId:t,withPDiskPageLink:s,isUserAllowedToMakeChanges:g});return(0,x.jsxs)(i.s,{className:r,gap:2,direction:"row",wrap:!0,children:[(0,x.jsxs)(i.s,{direction:"column",gap:2,width:500,children:[(0,x.jsx)(m.z,{info:f,renderEmptyState:()=>null}),(0,x.jsx)(m.z,{info:j,renderEmptyState:()=>null})]}),(0,x.jsxs)(i.s,{direction:"column",gap:2,width:500,children:[(0,x.jsx)(m.z,{info:y,renderEmptyState:()=>null}),(0,x.jsx)(m.z,{info:N,renderEmptyState:()=>null})]})]})}},58389:(e,t,s)=>{s.d(t,{B:()=>c});var i=s(87184),n=s(77506),o=s(90053),a=s(70043),l=s(60712);const r=(0,n.cn)("ydb-page-meta");function d({items:e,loading:t}){return(0,l.jsx)("div",{className:r("info"),children:t?(0,l.jsx)(a.E,{className:r("skeleton")}):e.filter((e=>Boolean(e))).join("\xa0\xa0\xb7\xa0\xa0")})}function c({className:e,...t}){return(0,l.jsxs)(i.s,{gap:1,alignItems:"center",justifyContent:"space-between",className:r(null,e),children:[(0,l.jsx)(d,{...t}),(0,l.jsx)(o.E,{})]})}},70043:(e,t,s)=>{s.d(t,{E:()=>a});var i=s(89169),n=s(66781),o=s(60712);const a=({delay:e=600,className:t})=>{const[s]=(0,n.y)(e);return s?(0,o.jsx)(i.E,{className:t}):null}},67440:(e,t,s)=>{s.d(t,{E:()=>y});s(59284);var i=s(92459),n=s(78668),o=s(7435),a=s(77506),l=s(56839),r=s(31684),d=s(7187),c=s(90182),u=s(41650),m=s(60073),p=s(25196),h=s(15132),v=s(33775),g=s(48372);const f=JSON.parse('{"slot-id":"VDisk Slot Id","pool-name":"Storage Pool Name","kind":"Kind","guid":"GUID","incarnation-guid":"Incarnation GUID","instance-guid":"Instance GUID","replication-status":"Replicated","state-status":"VDisk State","space-status":"Disk Space","fresh-rank-satisfaction":"Fresh Rank Satisfaction","level-rank-satisfaction":"Level Rank Satisfaction","front-queues":"Front Queues","has-unreadable-blobs":"Has Unreadable Blobs","size":"Size","read-throughput":"Read Throughput","write-throughput":"Write Throughput","links":"Links","vdisk-page":"VDisk Page","developer-ui":"Developer UI","yes":"Yes","no":"No","vdiks-title":"VDisk"}'),b=(0,g.g4)("ydb-vDisk-info",{en:f});var x=s(60712);const k=(0,a.cn)("ydb-vdisk-info");function y({data:e,withVDiskPageLink:t,withTitle:s,...a}){var d,g;const f=(0,c.N4)(n._5),{AllocatedSize:y,DiskSpace:N,FrontQueues:S,Guid:w,Replicated:D,VDiskState:I,VDiskSlotId:C,Kind:T,SatisfactionRank:E,AvailableSize:P,HasUnreadableBlobs:z,IncarnationGuid:A,InstanceGuid:_,StoragePoolName:M,ReadThroughput:O,WriteThroughput:R,PDiskId:L,NodeId:B}=e||{},F=[];var V,$;((0,o.f8)(C)&&F.push({label:b("slot-id"),value:C}),(0,o.f8)(M)&&F.push({label:b("pool-name"),value:M}),(0,o.f8)(I)&&F.push({label:b("state-status"),value:I}),Number(y)>=0&&Number(P)>=0&&F.push({label:b("size"),value:(0,x.jsx)(h.O,{value:y,capacity:Number(y)+Number(P),formatValues:l.vX,colorizeProgress:!0})}),(0,o.f8)(T)&&F.push({label:b("kind"),value:T}),(0,o.f8)(w)&&F.push({label:b("guid"),value:w}),(0,o.f8)(A)&&F.push({label:b("incarnation-guid"),value:A}),(0,o.f8)(_)&&F.push({label:b("instance-guid"),value:_}),(0,o.f8)(D)&&F.push({label:b("replication-status"),value:b(D?"yes":"no")}),(0,o.f8)(N)&&F.push({label:b("space-status"),value:(0,x.jsx)(v.k,{status:N})}),(0,o.f8)(null===E||void 0===E||null===(d=E.FreshRank)||void 0===d?void 0:d.Flag))&&F.push({label:b("fresh-rank-satisfaction"),value:(0,x.jsx)(v.k,{status:null===E||void 0===E||null===(V=E.FreshRank)||void 0===V?void 0:V.Flag})});(0,o.f8)(null===E||void 0===E||null===(g=E.LevelRank)||void 0===g?void 0:g.Flag)&&F.push({label:b("level-rank-satisfaction"),value:(0,x.jsx)(v.k,{status:null===E||void 0===E||null===($=E.LevelRank)||void 0===$?void 0:$.Flag})});(0,o.f8)(S)&&F.push({label:b("front-queues"),value:(0,x.jsx)(v.k,{status:S})}),(0,o.f8)(z)&&F.push({label:b("has-unreadable-blobs"),value:b(z?"yes":"no")}),(0,o.f8)(O)&&F.push({label:b("read-throughput"),value:(0,u.O4)(O)}),(0,o.f8)(R)&&F.push({label:b("write-throughput"),value:(0,u.O4)(R)});if((0,o.f8)(L)&&(0,o.f8)(B)&&(0,o.f8)(C)){const e=[];if(t){const t=(0,i.yX)(C,L,B);e.push((0,x.jsx)(p.K,{title:b("vdisk-page"),url:t,external:!1},t))}if(f){const t=(0,r.Wg)({nodeId:B,pDiskId:L,vDiskSlotId:C});e.push((0,x.jsx)(p.K,{title:b("developer-ui"),url:t},t))}e.length&&F.push({label:b("links"),value:(0,x.jsx)("div",{className:k("links"),children:e})})}const U=e&&s?(0,x.jsx)(j,{data:e}):null;return(0,x.jsx)(m.z_,{info:F,title:U,...a})}function j({data:e}){return(0,x.jsxs)("div",{className:k("title"),children:[b("vdiks-title"),(0,x.jsx)(v.k,{status:(0,d.XY)(e.Severity)}),e.StringifiedId]})}},69134:(e,t,s)=>{s.r(t),s.d(t,{PDiskPage:()=>ke});var i=s(59284),n=s(76938),o=s(99991),a=s(23871),l=s(44992),r=s(61750),d=s(67087),c=s(370),u=s(22983),m=s(3685),p=s(44508),h=s(42655),v=s(82015),g=s(56735),f=s(58389),b=s(92459),x=s(21334),k=s(78668),y=s(67028),j=s(40174),N=s(7187),S=s(68712),w=s(7435),D=s(27295),I=s(78034);const C=x.F.injectEndpoints({endpoints:e=>({getPdiskInfo:e.query({queryFn:async({nodeId:e,pDiskId:t},{signal:s,getState:i,dispatch:n})=>{let o;o=await(0,S.FC)("/pdisk/info",void 0,{getState:i,dispatch:n})>0?window.api.pdisk.getPDiskInfo({nodeId:e,pDiskId:t},{signal:s}):window.api.viewer.getNodeWhiteboardPDiskInfo({nodeId:e,pDiskId:t},{signal:s}).then((e=>e.PDiskStateInfo?{Whiteboard:{PDisk:{...e.PDiskStateInfo[0],ExpectedSlotCount:void 0}}}:{}));try{const t=await Promise.all([o,window.api.viewer.getNodeInfo(e,{signal:s})]);return{data:function([e={},t]){var s,i,n;const o=null===(s=t.SystemStateInfo)||void 0===s?void 0:s[0],a=(0,I.q1)(o),{BSC:l={},Whiteboard:r={}}=e||{},{PDisk:d={},VDisks:c=[]}=r,{PDisk:u={}}=l,m=(0,D.or)({...u,...d}),p=null!==(i=m.NodeId)&&void 0!==i?i:a.NodeId,{LogUsedSize:h,LogTotalSize:v,TotalSize:g,SystemSize:f,ExpectedSlotCount:b,EnforcedDynamicSlotSize:x}=m;let k;(0,w.f8)(v)&&(k={SlotType:"log",Used:Number(h),Total:Number(v),UsagePercent:100*Number(h)/Number(v),Severity:1,SlotData:{LogUsedSize:h,LogTotalSize:v,SystemSize:f}});const y=c.map((e=>(0,D.WT)({...e,NodeId:p})));y.sort(((e,t)=>Number(t.VDiskSlotId)-Number(e.VDiskSlotId)));const j=y.map((e=>{var t;return{SlotType:"vDisk",Id:null===(t=e.VDiskId)||void 0===t?void 0:t.GroupID,Title:e.StoragePoolName,Severity:e.Severity,Used:Number(e.AllocatedSize),Total:Number(e.TotalSize),UsagePercent:e.AllocatedPercent,SlotData:e}}));let N=[];if(b&&b>j.length){const e=b-j.length;let t=Number(x);if(isNaN(t)){const s=j.reduce(((e,t)=>t.Total?e+t.Total:e),0);t=(Number(g)-s-Number(v))/e}N=(0,w._e)(e).map((()=>({SlotType:"empty",Total:t,Severity:1,SlotData:{Size:t}})))}const S=[...j,...N];return k&&S.length>0&&S.unshift(k),{...m,NodeId:p,NodeHost:a.Host,NodeType:null===(n=a.Roles)||void 0===n?void 0:n[0],NodeDC:a.DC,SlotItems:S}}(t)}}catch(a){return{error:a}}},providesTags:(e,t,s)=>["All",{type:"PDiskData",id:(0,N.r$)(s.nodeId,s.pDiskId)}]})}),overrideExisting:"throw"});var T=s(77506),E=s(90182),P=s(99936),z=s(13066),A=s(40569),_=s(84375),M=s(84476),O=s(55974),R=s(42829),L=s(48372);const B=JSON.parse('{"fqdn":"FQDN","pdisk":"PDisk","node":"Node","storage":"Storage","disk-distribution":"Disk distribution","empty-slot":"Empty slot","log":"Log","label.log-size":"Log Size","label.system-size":"System Size","label.slot-size":"Slot Size","no-slots-data":"No slots data","restart-pdisk-button":"Restart PDisk","force-restart-pdisk-button":"Restart anyway","restart-pdisk-not-allowed":"You don\'t have enough rights to restart PDisk","restart-pdisk-dialog-header":"Restart PDisk","restart-pdisk-dialog-text":"PDisk will be restarted. Do you want to proceed?","decommission-none":"None","decommission-imminent":"Imminent","decommission-pending":"Pending","decommission-rejected":"Rejected","decommission-label":"{{decommission}} decommission","decommission-button":"Decommission","decommission-change-not-allowed":"You don\'t have enough rights to change PDisk decommission","decommission-dialog-title":"Change decommission status","decommission-dialog-force-change":"Change anyway","decommission-dialog-imminent-warning":"This will start imminent decommission. Existing slots will be moved from the disk","decommission-dialog-pending-warning":"This will start pending decommission. Decommission will be planned for this disk, but will not start immediatelly. Existing slots will not be moved from the disk, but no new slots will be allocated on it","decommission-dialog-rejected-warning":"This will start rejected decommission. No slots from other disks are placed on this disk in the process of decommission","decommission-dialog-none-warning":"This will reset decommission mode, allowing the disk to  be used by the storage"}'),F=(0,L.g4)("ydb-pDisk-page",{en:B});var V,$,U,G;function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)({}).hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},H.apply(null,arguments)}const J=function(e){return i.createElement("svg",H({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 17 17",fill:"none"},e),V||(V=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.378 7.771c.717 0 1.298.614 1.298 1.372v.914c0 .758-.581 1.372-1.298 1.372H3.46c-.716 0-1.297-.614-1.297-1.372v-.914c0-.758.58-1.372 1.297-1.372h6.92zm.77-1.248L9.935 3.958a1.292 1.292 0 00-1.16-.758H5.063c-.491 0-.94.294-1.16.758L2.69 6.523c.243-.08.501-.123.77-.123h6.918c.268 0 .527.043.77.123zm1.825 1.87V10.057c0 1.515-1.162 2.743-2.595 2.743H3.46c-1.433 0-2.594-1.228-2.594-2.743V8.393c0-.71.156-1.41.456-2.044l1.421-3.004c.44-.93 1.338-1.516 2.32-1.516h3.713c.982 0 1.88.587 2.32 1.516l1.421 3.004c.3.635.457 1.335.457 2.044zm-5.19.521c-.358 0-.648.307-.648.686 0 .379.29.686.649.686h2.162c.358 0 .649-.307.649-.686 0-.379-.29-.686-.65-.686H7.785z",fill:"currentColor",fillOpacity:.85})),$||($=i.createElement("path",{d:"M15.25 11.428c0 2.15-1.639 3.822-3.574 3.822-1.935 0-3.574-1.671-3.574-3.822 0-2.15 1.639-3.821 3.574-3.821 1.935 0 3.574 1.671 3.574 3.821z",fill:"var(--g-color-base-background)",stroke:"currentColor",strokeWidth:1.5})),U||(U=i.createElement("path",{d:"M11.676 16.5c2.69 0 4.824-2.297 4.824-5.072 0-2.774-2.134-5.071-4.824-5.071s-4.824 2.297-4.824 5.071c0 2.775 2.134 5.072 4.824 5.072z",stroke:"var(--g-color-base-background)"})),G||(G=i.createElement("path",{d:"M12.973 10.057L10.378 12.8m0-2.743l2.595 2.743",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))};var W=s(60712);const q=(0,T.cn)("ydb-pdisk-decommission-button");function Y(e){return"DECOMMIT_IMMINENT"===e?F("decommission-dialog-imminent-warning"):"DECOMMIT_PENDING"===e?F("decommission-dialog-pending-warning"):"DECOMMIT_REJECTED"===e?F("decommission-dialog-rejected-warning"):"DECOMMIT_NONE"===e?F("decommission-dialog-none-warning"):void 0}function X({decommission:e,onConfirmAction:t,onConfirmActionSuccess:s,buttonDisabled:n,popoverDisabled:o}){const[a,l]=i.useState(),[r,d]=i.useState(!1),[c,u]=i.useState(!1),m=function(e,t){return[{text:F("decommission-none"),action:()=>t("DECOMMIT_NONE"),hidden:!e||"DECOMMIT_NONE"===e||"DECOMMIT_UNSET"===e},{text:F("decommission-pending"),action:()=>t("DECOMMIT_PENDING"),hidden:"DECOMMIT_PENDING"===e},{text:F("decommission-rejected"),action:()=>t("DECOMMIT_REJECTED"),hidden:"DECOMMIT_REJECTED"===e},{text:F("decommission-imminent"),theme:"danger",action:()=>t("DECOMMIT_IMMINENT"),hidden:"DECOMMIT_IMMINENT"===e}]}(e,l);return(0,W.jsxs)(i.Fragment,{children:[(0,W.jsx)(A.r,{renderSwitcher:e=>(0,W.jsx)(Q,{popoverDisabled:o,loading:r,disabled:n,...e}),items:m,popupProps:{className:q("popup")}}),(0,W.jsx)(O.g,{visible:Boolean(a),header:F("decommission-dialog-title"),text:Y(a),withRetry:c,withCheckBox:!0,retryButtonText:F("decommission-dialog-force-change"),onConfirm:async e=>{d(!0),await t(a,e)},onConfirmActionSuccess:async()=>{u(!1),await(0,w.uk)(5e3);try{await s()}finally{d(!1)}},onConfirmActionError:e=>{u((0,R.D)(e)),d(!1)},onClose:()=>{l(void 0)}})]})}function Q({popoverDisabled:e,...t}){return(0,W.jsx)(_.A,{content:F("decommission-change-not-allowed"),placement:"right",disabled:e,children:(0,W.jsxs)(M.$,{view:"normal",className:q("button"),...t,children:[(0,W.jsx)(o.I,{data:J}),F("decommission-button"),(0,W.jsx)(o.I,{data:z.A})]})})}var K=s(47665);function Z(e){return F("decommission-label",{decommission:e})}function ee({decommission:e}){return"DECOMMIT_IMMINENT"===e?(0,W.jsx)(K.J,{theme:"danger",size:"m",children:Z(F("decommission-imminent"))}):"DECOMMIT_PENDING"===e?(0,W.jsx)(K.J,{theme:"warning",size:"m",children:Z(F("decommission-pending"))}):"DECOMMIT_REJECTED"===e?(0,W.jsx)(K.J,{theme:"normal",size:"m",children:Z(F("decommission-rejected"))}):null}var te=s(88226),se=s(13096),ie=s(60073),ne=s(44294),oe=s(15132),ae=s(67440),le=s(46549),re=s(56839);const de=(0,T.cn)("ydb-pdisk-space-distribution"),ce=40;function ue({data:e}){const{SlotItems:t}=e,{PDiskId:s,NodeId:i}=e,n=ce*((null===t||void 0===t?void 0:t.length)||1);return null!==t&&void 0!==t&&t.length?(0,W.jsx)("div",{className:de(null),style:{height:n,minHeight:n},children:(0,W.jsx)(te.V,{className:de("pdisk-bar"),severity:e.Severity,diskAllocatedPercent:e.AllocatedPercent,content:null===t||void 0===t?void 0:t.map(((e,t)=>(0,W.jsx)(me,{item:e,pDiskId:s,nodeId:i},t))),faded:!0})}):F("no-slots-data")}function me({item:e,pDiskId:t,nodeId:s}){return(0,W.jsx)("div",{className:de("slot-wrapper"),style:{flexGrow:Number(e.Total)||1},children:(()=>{if("vDisk"===e.SlotType){var i;const n=(0,w.f8)(null===(i=e.SlotData)||void 0===i?void 0:i.VDiskSlotId)&&(0,w.f8)(t)&&(0,w.f8)(s)?(0,b.yX)(e.SlotData.VDiskSlotId,t,s):void 0;return(0,W.jsx)(se.P,{popupContent:(0,W.jsx)(ae.E,{data:e.SlotData,withTitle:!0}),contentClassName:de("vdisk-popup"),placement:["right","top"],children:(0,W.jsx)(ne.E,{to:n,children:(0,W.jsx)(te.V,{className:de("slot"),severity:e.Severity,diskAllocatedPercent:e.UsagePercent,content:(0,W.jsx)(pe,{id:e.Id,title:e.Title,used:e.Used,total:e.Total})})})})}return function(e){return"log"===e.SlotType}(e)?(0,W.jsx)(se.P,{popupContent:(0,W.jsx)(he,{data:e.SlotData}),contentClassName:de("vdisk-popup"),placement:["right","top"],children:(0,W.jsx)(te.V,{className:de("slot"),severity:e.Severity,diskAllocatedPercent:e.UsagePercent,content:(0,W.jsx)(pe,{title:F("log"),used:e.Used,total:e.Total})})}):function(e){return"empty"===e.SlotType}(e)?(0,W.jsx)(se.P,{popupContent:(0,W.jsx)(ve,{data:e.SlotData}),contentClassName:de("vdisk-popup"),placement:["right","top"],children:(0,W.jsx)(te.V,{className:de("slot"),severity:e.Severity,empty:!0,content:(0,W.jsx)(pe,{title:F("empty-slot"),used:e.Total})})}):null})()})}function pe({id:e,title:t,used:s,total:i}){return(0,W.jsxs)("div",{className:de("slot-content"),children:[(0,W.jsxs)("span",{children:[(0,w.f8)(e)?(0,W.jsx)("span",{className:de("slot-id"),children:e}):null,t]}),(0,W.jsx)("span",{className:de("slot-size"),children:(()=>{const[e,t]=(0,re.vX)(s,i);return i?`${e} / ${t}`:e})()})]})}function he({data:e}){const{LogTotalSize:t,LogUsedSize:s,SystemSize:i}=e,n=[{label:F("label.log-size"),value:(0,W.jsx)(oe.O,{value:s,capacity:t,formatValues:re.vX})}];return(0,w.f8)(i)&&n.push({label:F("label.system-size"),value:(0,le.z3)({value:i})}),(0,W.jsx)(ie.z_,{title:F("log"),info:n})}function ve({data:e}){const{Size:t}=e,s=[{label:F("label.slot-size"),value:(0,le.z3)({value:t})}];return(0,W.jsx)(ie.z_,{title:F("empty-slot"),info:s})}const ge=(0,T.cn)("ydb-pdisk-page"),fe={diskDistribution:"diskDistribution",storage:"storage"},be=[{id:fe.diskDistribution,get title(){return F("disk-distribution")}},{id:fe.storage,get title(){return F("storage")}}],xe=c.z.nativeEnum(fe).catch(fe.diskDistribution);function ke(){const e=(0,E.YQ)(),t=(0,E.N4)(k._5),s=(0,y.c2)(),c=i.useRef(null),[{nodeId:S,pDiskId:D,activeTab:I}]=(0,d.useQueryParams)({activeTab:d.StringParam,nodeId:d.StringParam,pDiskId:d.StringParam}),T=(0,w.f8)(S)&&(0,w.f8)(D),z=xe.parse(I);i.useEffect((()=>{e((0,j.g)("pDisk",{nodeId:S,pDiskId:D}))}),[e,S,D]);const[A]=(0,E.Nt)(),_=T?{nodeId:S,pDiskId:D}:l.hT,M=C.useGetPdiskInfoQuery(_,{pollingInterval:A}),O=M.isFetching&&void 0===M.currentData,R=M.currentData,{NodeHost:L,NodeId:B,NodeType:V,NodeDC:$,Severity:U,DecommitStatus:G}=R||{},H=async e=>{if(T){const t=await window.api.pdisk[s?"restartPDisk":"restartPDiskOld"]({nodeId:S,pDiskId:D,force:e});if(!1===(null===t||void 0===t?void 0:t.result)){throw{statusText:t.error,retryPossible:t.forceRetryPossible}}}},J=async(e,t)=>{if(T){const s=await window.api.pdisk.changePDiskStatus({nodeId:S,pDiskId:D,force:t,decommissionStatus:e});if(!1===(null===s||void 0===s?void 0:s.result)){throw{statusText:s.error,retryPossible:s.forceRetryPossible}}}},q=()=>{T&&e(x.F.util.invalidateTags([{type:"PDiskData",id:(0,N.r$)(S,D)}]),"StorageData")};return(0,W.jsxs)("div",{className:ge(null),ref:c,children:[(()=>{const e=D?`${F("pdisk")} ${D}`:F("pdisk"),t=L||F("node");return(0,W.jsx)(r.mg,{titleTemplate:`%s - ${e} \u2014 ${t} \u2014 YDB Monitoring`,defaultTitle:`${e} \u2014 ${t} \u2014 YDB Monitoring`})})(),(()=>{const e=L?`${F("fqdn")}: ${L}`:void 0,t=B?`${F("node")}: ${B}`:void 0;return(0,W.jsx)(f.B,{loading:O,items:[e,t,V,$],className:ge("meta")})})(),(0,W.jsxs)("div",{className:ge("title"),children:[(0,W.jsx)(m.$,{entityName:F("pdisk"),status:(0,N.XY)(U),id:(0,N.r$)(S,D)}),(0,W.jsx)(ee,{decommission:G})]}),(0,W.jsxs)("div",{className:ge("controls"),children:[(0,W.jsxs)(u.B,{onConfirmAction:H,onConfirmActionSuccess:q,buttonDisabled:!T||!t,buttonView:"normal",dialogHeader:F("restart-pdisk-dialog-header"),dialogText:F("restart-pdisk-dialog-text"),retryButtonText:F("force-restart-pdisk-button"),withPopover:!0,popoverContent:F("restart-pdisk-not-allowed"),popoverDisabled:t,children:[(0,W.jsx)(o.I,{data:n.A}),F("restart-pdisk-button")]}),s?(0,W.jsx)(X,{decommission:G,onConfirmAction:J,onConfirmActionSuccess:q,buttonDisabled:!T||!t,popoverDisabled:t}):null]}),M.error?(0,W.jsx)(p.o,{error:M.error}):null,O?(0,W.jsx)(h.y,{className:ge("info"),rows:10}):(0,W.jsx)(g.Q,{pDisk:R,nodeId:S,className:ge("info")}),(0,W.jsx)("div",{className:ge("tabs"),children:(0,W.jsx)(a.t,{size:"l",items:be,activeTab:z,wrapTo:({id:e},t)=>{const s=T?(0,b.Ck)(D,S,{activeTab:e}):void 0;return(0,W.jsx)(v.E,{to:s,children:t},e)}})}),(()=>{switch(z){case"diskDistribution":return R?(0,W.jsx)("div",{className:ge("disk-distribution"),children:(0,W.jsx)(ue,{data:R})}):null;case"storage":return T?(0,W.jsx)(P.z,{nodeId:S,pDiskId:D,parentRef:c,viewContext:{nodeId:null===S||void 0===S?void 0:S.toString(),pDiskId:null===D||void 0===D?void 0:D.toString()}}):null;default:return null}})()]})}},89954:(e,t,s)=>{s.d(t,{O:()=>D});var i=s(59284),n=s(45720),o=s(16929),a=s(71153),l=s(18677),r=s(84476),d=s(33705),c=s(67884),u=s(99991),m=s(77506),p=s(48372);const h=JSON.parse('{"default_collapse_label":"Show less","default_expand_label":"Show more","chars_count":[" ({{count}} symbol)"," ({{count}} symbols)"," ({{count}} symbols)"," ({{count}} symbols)"]}'),v=JSON.parse('{"default_collapse_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435","default_expand_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0435\u0449\u0451","chars_count":[" ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u0430)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"," ({{count}} \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)"]}'),g=(0,p.g4)("ydb-shorty-string",{ru:v,en:h});var f=s(60712);const b=(0,m.cn)("kv-shorty-string");function x({value:e="",limit:t=200,strict:s=!1,displayLength:n=!0,render:o=e=>e,onToggle:a,expandLabel:l=g("default_expand_label"),collapseLabel:r=g("default_collapse_label")}){const[d,u]=i.useState(!1),m=(d?r:l)+(n&&!d?g("chars_count",{count:e.length}):""),p=e.length>t+(s?0:m.length),h=d||!p?e:e.slice(0,t-4)+"\xa0...";return(0,f.jsxs)("div",{className:b(),children:[o(h),p?(0,f.jsx)(c.N,{className:b("toggle"),href:"#",onClick:e=>{e.stopPropagation(),e.preventDefault(),u((e=>!e)),null===a||void 0===a||a()},children:m}):null]})}var k=s(41650);const y=["S_FATAL","S_ERROR","S_WARNING","S_INFO"];function j(e){return function(e){return!!e&&void 0!==y[e]}(e)?y[e]:"S_INFO"}const N=(0,m.cn)("kv-result-issues"),S=(0,m.cn)("kv-issues"),w=(0,m.cn)("kv-issue");function D({data:e,hideSeverity:t}){const[s,n]=i.useState(!1),o="string"===typeof e||null===e||void 0===e?void 0:e.issues,a=Array.isArray(o)&&o.length>0;return(0,f.jsxs)("div",{className:N(),children:[(0,f.jsxs)("div",{className:N("error-message"),children:[(()=>{let s;if("string"===typeof e)s=e;else{var n,o;const a=j(null===e||void 0===e||null===(n=e.error)||void 0===n?void 0:n.severity);s=(0,f.jsxs)(i.Fragment,{children:[t?null:(0,f.jsxs)(i.Fragment,{children:[(0,f.jsx)(A,{severity:a})," "]}),(0,f.jsx)("span",{className:N("error-message-text"),children:null===e||void 0===e||null===(o=e.error)||void 0===o?void 0:o.message})]})}return s})(),a&&(0,f.jsx)(r.$,{view:"normal",onClick:()=>n(!s),children:s?"Hide details":"Show details"})]}),a&&s&&(0,f.jsx)(I,{hideSeverity:t,issues:o})]})}function I({issues:e,hideSeverity:t}){const s=null===e||void 0===e?void 0:e.reduce(((e,t)=>{var s;const i=null!==(s=t.severity)&&void 0!==s?s:10;return Math.min(e,i)}),10);return(0,f.jsx)("div",{className:S(null),children:null===e||void 0===e?void 0:e.map(((e,i)=>(0,f.jsx)(C,{hideSeverity:t,issue:e,expanded:e===s},i)))})}function C({issue:e,hideSeverity:t,level:s=0}){const[n,o]=i.useState(!0),a=j(e.severity),l=e.issues,c=Array.isArray(l)&&l.length>0,u=n?"bottom":"right";return(0,f.jsxs)("div",{className:w({leaf:!c,"has-issues":c}),children:[(0,f.jsxs)("div",{className:w("line"),children:[c&&(0,f.jsx)(r.$,{view:"flat-secondary",onClick:()=>o(!n),className:w("arrow-toggle"),children:(0,f.jsx)(d.I,{direction:u,size:16})}),t?null:(0,f.jsx)(A,{severity:a}),(0,f.jsx)(T,{issue:e}),e.issue_code?(0,f.jsxs)("span",{className:w("code"),children:["Code: ",e.issue_code]}):null]}),c&&n&&(0,f.jsx)("div",{className:w("issues"),children:(0,f.jsx)(E,{issues:l,level:s+1,expanded:n})})]})}function T({issue:e}){var t;const s=function(e){const{position:t}=e;if("object"!==typeof t||null===t||!(0,k.kf)(t.row))return"";const{row:s,column:i}=t;return(0,k.kf)(i)?`${s}:${i}`:`line ${s}`}(e),i=window.ydbEditor,n=()=>(0,f.jsxs)("span",{className:w("message"),children:[s&&(0,f.jsx)("span",{className:w("place-text"),title:"Position",children:s}),(0,f.jsx)("div",{className:w("message-text"),children:(0,f.jsx)(x,{value:e.message,expandLabel:"Show full message"})})]}),{row:o,column:a}=null!==(t=e.position)&&void 0!==t?t:{};if(!((0,k.kf)(o)&&i))return n();return(0,f.jsx)(c.N,{href:"#",extraProps:{draggable:!1},onClick:()=>{const e={lineNumber:o,column:null!==a&&void 0!==a?a:0};i.setPosition(e),i.revealPositionInCenterIfOutsideViewport(e),i.focus()},view:"primary",children:n()})}function E(e){const{issues:t,level:s,expanded:i}=e;return(0,f.jsx)("div",{className:w("list"),children:t.map(((e,t)=>(0,f.jsx)(C,{issue:e,level:s,expanded:i},t)))})}const P={S_INFO:n.A,S_WARNING:o.A,S_ERROR:a.A,S_FATAL:l.A},z=(0,m.cn)("yql-issue-severity");function A({severity:e}){const t=e.slice(2).toLowerCase();return(0,f.jsxs)("span",{className:z({severity:t}),children:[(0,f.jsx)(u.I,{className:z("icon"),data:P[e]}),(0,f.jsx)("span",{className:z("title"),children:t})]})}},76938:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(59284);const n=e=>i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),i.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 1.5a6.5 6.5 0 1 1-6.445 7.348.75.75 0 1 1 1.487-.194A5.001 5.001 0 1 0 4.43 4.5h1.32a.75.75 0 0 1 0 1.5h-3A.75.75 0 0 1 2 5.25v-3a.75.75 0 0 1 1.5 0v1.06A6.48 6.48 0 0 1 8 1.5",clipRule:"evenodd"}))},18677:(e,t,s)=>{s.d(t,{A:()=>n});var i=s(59284);const n=e=>i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),i.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14M6.53 5.47a.75.75 0 0 0-1.06 1.06L6.94 8 5.47 9.47a.75.75 0 1 0 1.06 1.06L8 9.06l1.47 1.47a.75.75 0 1 0 1.06-1.06L9.06 8l1.47-1.47a.75.75 0 1 0-1.06-1.06L8 6.94z",clipRule:"evenodd"}))},74321:(e,t,s)=>{s.d(t,{S:()=>d});var i=s(59284),n=s(64222),o=s(46898);function a(e){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 17 17",width:"16",height:"16",fill:"currentColor"},e),i.createElement("path",{d:"M4 7h9v3H4z"}))}function l(e){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 10",width:"16",height:"16",fill:"currentColor"},e),i.createElement("path",{d:"M.49 5.385l1.644-1.644 4.385 4.385L4.874 9.77.49 5.385zm4.384 1.096L10.356 1 12 2.644 6.519 8.126 4.874 6.48v.001z"}))}const r=(0,s(69220).om)("checkbox"),d=i.forwardRef((function(e,t){const{size:s="m",indeterminate:d,disabled:c=!1,content:u,children:m,title:p,style:h,className:v,qa:g}=e,{checked:f,inputProps:b}=(0,n.v)(e),x=u||m,k=i.createElement("span",{className:r("indicator")},i.createElement("span",{className:r("icon"),"aria-hidden":!0},d?i.createElement(a,{className:r("icon-svg",{type:"dash"})}):i.createElement(l,{className:r("icon-svg",{type:"tick"})})),i.createElement("input",Object.assign({},b,{className:r("control")})),i.createElement("span",{className:r("outline")}));return i.createElement(o.m,{ref:t,title:p,style:h,size:s,disabled:c,className:r({size:s,disabled:c,indeterminate:d,checked:f},v),qa:g,control:k},x)}))}}]);