"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[6894],{21711:(e,t,s)=>{s.d(t,{b:()=>c});var r=s(34706),n=s(5194),l=s(99294),a=s(83658),o=s(10161);const i=(0,l.cn)("ydb-info-viewer-skeleton"),d=()=>(0,o.jsxs)("div",{className:i("label"),children:[(0,o.jsx)(n.O,{className:i("label__text")}),(0,o.jsx)("div",{className:i("label__dots")})]}),c=e=>{let{rows:t=8,className:s,delay:l=600}=e;const[c]=(0,a.$)(l);let u=(0,o.jsxs)(r.Fragment,{children:[(0,o.jsx)(d,{}),(0,o.jsx)(n.O,{className:i("value")})]});return c||(u=null),(0,o.jsx)("div",{className:i(null,s),children:[...new Array(t)].map(((e,t)=>(0,o.jsx)("div",{className:i("row"),children:u},`skeleton-row-${t}`)))})}},43464:(e,t,s)=>{s.d(t,{O:()=>a});var r=s(5194),n=s(83658),l=s(10161);const a=e=>{let{delay:t=600,className:s}=e;const[a]=(0,n.$)(t);return a?(0,l.jsx)(r.O,{className:s}):null}},13618:(e,t,s)=>{s.d(t,{$:()=>i});s(34706);var r=s(79777),n=s(99294),l=s(10161);const a=(0,n.cn)("tag"),o=e=>{let{text:t,type:s}=e;return(0,l.jsx)("div",{className:a({type:s}),children:t})},i=e=>{let{tags:t,tagsType:s,className:n="",gap:a=1}=e;return(0,l.jsx)(r.k,{className:n,gap:a,wrap:"wrap",alignItems:"center",children:t&&t.map(((e,t)=>(0,l.jsx)(o,{text:e,type:s},t)))})}},62787:(e,t,s)=>{s.r(t),s.d(t,{Cluster:()=>Et});var r=s(34706),n=s(5194),l=s(72555),a=s(42152),o=s(55783),i=s(99495),d=s(74003),c=s(62508),u=s(67653),v=s(46878),h=s(39202),m=s(10730),p=s(85709),x=s(99294),g=s(55842),j=s(80819),N=s(78294),f=s(58095),b=s(72427),y=s(71624),w=s(72616),C=s(34973),T=s(15327),k=s(91538),S=s(31580),P=s(52154),E=s(74116),O=s(17784),D=s(74640),L=s(83797),M=s(2194),_=s(60064),z=s(65e3),V=s(61168),A=s(90808),I=s(37711);const G=JSON.parse('{"field_links":"Links","field_monitoring-link":"Monitoring","context_unknown":"unknown database"}'),Z=(0,I.wZ)("ydb-tenant-name-wrapper",{en:G});var $=s(10161);const F=(e,t)=>{var s,r;if("function"!==typeof(null===t||void 0===t?void 0:t.prepareTenantBackend))return;let n=null!==(s=e.MonitoringEndpoint)&&void 0!==s?s:e.backend;const l=null!==(r=e.NodeIds)&&void 0!==r?r:e.sharedNodeIds;if(!n&&l&&l.length>0){n={NodeId:l[Math.floor(Math.random()*l.length)]}}return t.prepareTenantBackend(n)};function R(e){var t;let{tenant:s,additionalTenantsProps:r}=e;const n=(0,g.ix)(z.VH),l=F(s,r),a=Boolean(l),o=null===r||void 0===r||null===(t=r.getMonitoringLink)||void 0===t?void 0:t.call(r,s.Name,s.Type);return(0,$.jsx)(V.l,{disabled:!n||!o,delayClosing:200,content:o?(0,$.jsx)(L.w,{responsive:!0,children:(0,$.jsx)(L.w.Item,{name:Z("field_links"),children:(0,$.jsx)(A.j,{title:Z("field_monitoring-link"),url:o})})}):null,placement:["top","bottom"],behavior:M.x.Immediate,children:(0,$.jsx)(c.A,{externalLink:a,name:s.Name||Z("context_unknown"),withLeftTrim:!0,status:s.Overall,hasClipboardButton:!0,path:(0,_.Sj)({database:s.Name,backend:l})})})}var B=s(78276),W=s(32341),H=s(67386),U=s(78171),q=s.n(U),Q=s(77468),Y=s(27810),J=s(14739);const K=(0,H.P1)((e=>e),(e=>J.Xv.endpoints.getTenantsInfo.select({clusterName:e}))),X=(0,H.P1)((e=>e),((e,t)=>K(t)),(e=>(0,W.Cx)(e,Y.Zy)),((e,t,s)=>{var r;const n=null!==(r=t(e).data)&&void 0!==r?r:[];return!s&&n.length>1?n.filter((e=>"Domain"!==e.Type)):n})),ee=e=>e.tenants.searchValue,te=(0,H.P1)([X,W.qz,ee],((e,t,s)=>{let r=((e,t)=>t===W.pu.ALL?e:e.filter((e=>e.Overall&&e.Overall!==Q.K.Green)))(e,t);return r=((e,t)=>e.filter((e=>{const s=new RegExp(q()(t),"i");return s.test(e.Name||"")||s.test(e.controlPlaneName)})))(r,s),r}));var se=s(38980);const re=(0,x.cn)("tenants"),ne=e=>{let{additionalTenantsProps:t}=e;const s=(0,g.zL)(),[n]=(0,g.Rj)(),{currentData:l,isFetching:a,error:o}=J.Xv.useGetTenantsInfoQuery({clusterName:B.qw},{pollingInterval:n}),i=a&&void 0===l,d=(0,g.ix)((e=>X(e,B.qw))),c=(0,g.ix)(ee),u=(0,g.ix)((e=>te(e,B.qw))),v=(0,g.ix)(W.qz),h=e=>{s((0,W.M6)(e))},m=e=>{s((0,J.gI)(e))};return(0,$.jsxs)(D.l,{children:[(0,$.jsx)(D.l.Controls,{children:(0,$.jsxs)(r.Fragment,{children:[(0,$.jsx)(O.o,{value:c,onChange:m,placeholder:"Database name",className:re("search")}),(0,$.jsx)(P.T,{value:v,onChange:h}),(0,$.jsx)(C.C,{total:d.length,current:(null===u||void 0===u?void 0:u.length)||0,label:"Databases",loading:i})]})}),o?(0,$.jsx)(T.V,{error:o}):null,(0,$.jsx)(D.l.Table,{loading:i,children:l?(()=>{const e=[{name:"Name",header:"Database",render:e=>{let{row:s}=e;return(0,$.jsx)(R,{tenant:s,additionalTenantsProps:t})},width:440,sortable:!0,defaultOrder:y.ZP.DESCENDING},{name:"controlPlaneName",header:"Name",render:e=>{let{row:t}=e;return t.controlPlaneName},width:200,sortable:!0,defaultOrder:y.ZP.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:e=>{let{row:t}=e;return"Serverless"!==t.Type?t.Type:(0,$.jsxs)("div",{className:re("type"),children:[(0,$.jsx)("span",{className:re("type-value"),children:t.Type}),(0,$.jsx)(w.z,{className:re("type-button"),onClick:()=>m(t.sharedTenantName||""),children:"Show shared"})]})}},{name:"State",width:90,render:e=>{let{row:t}=e;return t.State?t.State.toLowerCase():"\u2014"},customStyle:()=>({textTransform:"capitalize"})},{name:"cpu",header:"CPU",width:80,render:e=>{let{row:t}=e;return t.cpu&&t.cpu>1e4?(0,se.LO)(t.cpu):"\u2014"},align:y.ZP.RIGHT,defaultOrder:y.ZP.DESCENDING},{name:"memory",header:"Memory",width:120,render:e=>{let{row:t}=e;return t.memory?(0,se.q3)(t.memory):"\u2014"},align:y.ZP.RIGHT,defaultOrder:y.ZP.DESCENDING},{name:"storage",header:"Storage",width:120,render:e=>{let{row:t}=e;return t.storage?(0,se.q3)(t.storage):"\u2014"},align:y.ZP.RIGHT,defaultOrder:y.ZP.DESCENDING},{name:"nodesCount",header:"Nodes",width:100,render:e=>{let{row:t}=e;return t.nodesCount?(0,se.uf)(t.nodesCount):"\u2014"},align:y.ZP.RIGHT,defaultOrder:y.ZP.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:e=>{let{row:t}=e;return t.groupsCount?(0,se.uf)(t.groupsCount):"\u2014"},align:y.ZP.RIGHT,defaultOrder:y.ZP.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:e=>{let{PoolStats:t=[]}=e;return t.reduce(((e,t)=>e+(t.Usage||0)),0)},defaultOrder:y.ZP.DESCENDING,align:y.ZP.LEFT,render:e=>{let{row:t}=e;return(0,$.jsx)(S.m,{pools:t.PoolStats})}}];return 0===u.length&&v!==W.pu.ALL?(0,$.jsx)(k.Q,{name:"thumbsUp",width:"200"}):(0,$.jsx)(E.G,{columnsWidthLSKey:"databasesTableColumnsWidth",data:u,columns:e,settings:Y.LE,emptyDataMessage:"No such tenants"})})():null})]})};var le=s(67661),ae=s(19912),oe=s(66498),ie=s(88366),de=s(30963);const ce=(0,x.cn)("ydb-cluster-versions-bar"),ue=e=>{let{versionsValues:t=[],size:s="s",progressClassName:r}=e;return(0,$.jsxs)("div",{className:ce(),children:[(0,$.jsx)(de.E,{value:100,stack:t,size:s,className:r}),(0,$.jsx)("div",{className:ce("versions"),children:t.map(((e,s)=>(0,$.jsx)("div",{className:ce("version-title"),style:{color:e.color},title:e.version,children:`${e.version}${s===t.length-1?"":","}`},e.version)))})]})};var ve=s(83202),he=s(20760),me=s(96183),pe=s(75544);const xe=[{name:"NodeId",header:"#",width:80,resizeMinWidth:80,align:y.ZP.LEFT,render:e=>{let{row:t}=e;return t.NodeId}},{name:"Host",render:e=>{var t;let{row:s}=e;const r=s.Endpoints&&(null===(t=s.Endpoints.find((e=>"http-mon"===e.Name)))||void 0===t?void 0:t.Address),n=s.Host&&`${s.Host}${r||""}`||"unknown",l=!(0,me.TA)(s)&&s.NodeId?(0,pe.a3)(s.NodeId):void 0;return(0,$.jsx)(c.A,{name:n,path:l,hasClipboardButton:!0,showStatus:!1})},width:400,align:y.ZP.LEFT},{name:"Endpoints",sortable:!1,render:e=>{let{row:t}=e;return t.Endpoints?t.Endpoints.map((e=>{let{Name:t,Address:s}=e;return`${t} ${s}`})).join(", "):"-"},width:300,align:y.ZP.LEFT},{name:"Uptime",header:"Uptime",sortAccessor:e=>{let{StartTime:t}=e;return t&&-t},width:120,align:y.ZP.LEFT,render:e=>{let{row:t}=e;return t.Uptime}},{name:"MemoryUsed",header:"Memory used",sortAccessor:e=>{let{MemoryUsed:t=0}=e;return Number(t)},defaultOrder:y.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.MemoryUsed?(0,se.td)(t.MemoryUsed):"\u2014"},width:120,align:y.ZP.RIGHT},{name:"MemoryLimit",header:"Memory limit",sortAccessor:e=>{let{MemoryLimit:t=0}=e;return Number(t)},defaultOrder:y.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.MemoryLimit?(0,se.td)(t.MemoryLimit):"\u2014"},width:120,align:y.ZP.RIGHT},{name:"PoolStats",header:"Pools",sortAccessor:e=>{let{PoolStats:t=[]}=e;return t.reduce(((e,t)=>e+(t.Usage||0)),0)},defaultOrder:y.ZP.DESCENDING,width:80,resizeMinWidth:60,render:e=>{let{row:t}=e;return t.PoolStats?(0,$.jsx)(S.m,{pools:t.PoolStats}):"\u2014"},align:y.ZP.LEFT},{name:"LoadAverage",header:"Load average",sortAccessor:e=>{let{LoadAveragePercents:t=[]}=e;return t[0]},defaultOrder:y.ZP.DESCENDING,width:170,resizeMinWidth:170,render:e=>{let{row:t}=e;return t.LoadAveragePercents&&t.LoadAveragePercents.length>0?(0,$.jsx)(he.y,{value:t.LoadAveragePercents[0],percents:!0,capacity:100,colorizeProgress:!0}):"\u2014"},align:y.ZP.LEFT}],ge=e=>{let{nodes:t}=e;return(0,$.jsx)(E.G,{columnsWidthLSKey:"versionsTableColumnsWidth",data:t,columns:xe,settings:Y.LE})};var je=s(99175);const Ne=(0,x.cn)("ydb-versions-nodes-tree-title"),fe=e=>{let t,{title:s,nodes:r,items:n,versionColor:l,versionsValues:a}=e;return t=n?n.reduce(((e,t)=>t.nodes?e+t.nodes.length:e),0):r?r.length:0,(0,$.jsxs)("div",{className:Ne("overview"),children:[(0,$.jsxs)("div",{className:Ne("overview-container"),children:[l?(0,$.jsx)("div",{className:Ne("version-color"),style:{background:l}}):null,s?(0,$.jsxs)("span",{className:Ne("overview-title"),children:[s,(0,$.jsx)(je.m,{text:s,size:"s",className:Ne("clipboard-button"),view:"normal"})]}):null]}),(0,$.jsxs)("div",{className:Ne("overview-info"),children:[(0,$.jsxs)("div",{children:[(0,$.jsx)("span",{className:Ne("info-value"),children:t}),(0,$.jsx)("span",{className:Ne("info-label",{margin:"left"}),children:"Nodes"})]}),a?(0,$.jsxs)("div",{className:Ne("version-progress"),children:[(0,$.jsx)("span",{className:Ne("info-label",{margin:"right"}),children:"Versions"}),(0,$.jsx)(de.E,{size:"s",value:100,stack:a})]}):null]})]})},be=(0,x.cn)("ydb-versions-grouped-node-tree"),ye=e=>{let{title:t,nodes:s,items:n,expanded:l=!1,versionColor:a,versionsValues:o,level:i=0}=e;const[d,c]=r.useState(!1);r.useEffect((()=>{c(l)}),[l]);const u=(0,$.jsx)(fe,{title:t,nodes:s,items:n,versionColor:a,versionsValues:o}),v=()=>{c((e=>!e))};return n?(0,$.jsx)("div",{className:be({"first-level":0===i}),children:(0,$.jsx)(ve.L,{name:u,collapsed:!d,hasArrow:!0,onClick:v,onArrowClick:v,children:n.map(((e,t)=>(0,$.jsx)(ye,{title:e.title,nodes:e.nodes,expanded:l,versionColor:e.versionColor,level:i+1},t)))},t)}):(0,$.jsx)("div",{className:be({"first-level":0===i}),children:(0,$.jsx)(ve.L,{name:u,collapsed:!d,hasArrow:!0,onClick:v,onArrowClick:v,children:(0,$.jsx)("div",{className:be("dt-wrapper"),children:(0,$.jsx)(ge,{nodes:s||[]})})},t)})};var we=s(69144),Ce=s.n(we),Te=s(58274);const ke=.5,Se=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const s=e.reduce(((e,t)=>(t.Version&&(e[t.Version]?e[t.Version]=e[t.Version]+1:e[t.Version]=1),e)),{});return Ee(Object.keys(s).map((r=>{const n=s[r]/e.length*100;return{title:r,version:r,color:null===t||void 0===t?void 0:t.get((0,Te.H)(r)),value:n<ke?ke:n}})))};function Pe(e,t,s){const r=null!==s&&void 0!==s?s:e.reduce(((e,t)=>e+t.count),0);return Ee(e.map((e=>{const s=e.count/r*100;return{title:e.name,version:e.name,color:null===t||void 0===t?void 0:t.get(e.name),value:s<ke?ke:s}})))}function Ee(e){let t=e[0].value,s=0,r=0;e.forEach(((e,n)=>{r+=e.value,e.value>t&&(t=e.value,s=n)}));const n=[...e];return n[s]={...e[s],value:t+100-r},n}let Oe;!function(e){e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage"}(Oe||(Oe={}));const De=(e,t)=>{var s;return(null===(s=e.title)||void 0===s?void 0:s.localeCompare(t.title||""))||-1},Le=JSON.parse('{"title_overall":"Overall","title_storage":"Storage nodes","title_database":"Database nodes","title_other":"Other nodes"}'),Me=(0,I.wZ)("ydb-versions",{en:Le});var _e=s(64485),ze=s(39242);const Ve=(0,x.cn)("ydb-versions"),Ae=e=>{let{versionToColor:t,cluster:s}=e;const[n]=(0,g.Rj)(),l=((e,t)=>{const{currentData:s}=ie.k.useGetNodesQuery((0,ze.j)(e)?_e.CN:{tablets:!1,fieldsRequired:["SystemState"],group:"Version"});return r.useMemo((()=>(0,ze.j)(e)&&e.MapVersions?Pe(Object.entries(e.MapVersions).map((e=>{let[t,s]=e;return{name:t,count:s}})),t,e.NodesTotal):s?Array.isArray(s.NodeGroups)?Pe(s.NodeGroups,t,null===e||void 0===e?void 0:e.NodesTotal):Se(s.Nodes,t):[]),[s,t,e])})(s,t),{currentData:a,isLoading:o}=ie.k.useGetNodesQuery({tablets:!1,fieldsRequired:["SystemState"]},{pollingInterval:n}),i=null===a||void 0===a?void 0:a.Nodes,[d,c]=r.useState(Oe.VERSION),[u,v]=r.useState(!1),h=e=>{c(e)};if(o)return(0,$.jsx)(oe.a,{});const m=((e,t,s)=>{if(e&&e.length){if(s===Oe.VERSION){const s=Ce()(e,"Version");return Object.keys(s).map((e=>{const r=s[e].filter((e=>{let{Tenants:t}=e;return Boolean(t)})),n=Ce()(r,"Tenants"),l=Object.keys(n).map((e=>({title:e,nodes:n[e]}))).sort(De);return l.length?{title:e,items:l,versionColor:null===t||void 0===t?void 0:t.get((0,Te.H)(e))}:null})).filter((e=>Boolean(e)))}{const s=e.filter((e=>{let{Tenants:t}=e;return Boolean(t)})),r=Ce()(s,"Tenants");return Object.keys(r).map((e=>{const s=Se(r[e],t),n=Ce()(r[e],"Version"),l=Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:null===t||void 0===t?void 0:t.get((0,Te.H)(e))})));return l.length?{title:e,items:l,versionsValues:s}:null})).filter((e=>Boolean(e))).sort(De)}}})(i,t,d),p=((e,t)=>{if(!e||!e.length)return;const s=e.filter((e=>{let{Roles:t}=e;return null===t||void 0===t?void 0:t.includes("Storage")})),r=Ce()(s,"Version");return Object.keys(r).map((e=>({title:e,nodes:r[e],versionColor:null===t||void 0===t?void 0:t.get((0,Te.H)(e))})))})(i,t),x=((e,t)=>{if(!e||!e.length)return;const s=e.filter((e=>{let{Roles:t,Version:s}=e;return!t&&s})),r=Ce()(s,"Version");return Object.keys(r).map((e=>({title:e,nodes:r[e],versionColor:null===t||void 0===t?void 0:t.get((0,Te.H)(e))})))})(i,t),j=null!==p&&void 0!==p&&p.length?(0,$.jsxs)(r.Fragment,{children:[(0,$.jsx)("h4",{children:Me("title_storage")}),p.map((e=>{let{title:t,nodes:s,items:r,versionColor:n}=e;return(0,$.jsx)(ye,{title:t,nodes:s,items:r,versionColor:n},`storage-nodes-${t}`)}))]}):null,N=null!==m&&void 0!==m&&m.length?(0,$.jsxs)(r.Fragment,{children:[(0,$.jsx)("h4",{children:Me("title_database")}),(0,$.jsxs)("div",{className:Ve("controls"),children:[(0,$.jsxs)("div",{className:Ve("group"),children:[(0,$.jsx)("span",{className:Ve("label"),children:"Group by:"}),(0,$.jsxs)(le.E,{value:d,onUpdate:h,children:[(0,$.jsx)(le.E.Option,{value:Oe.TENANT,children:Oe.TENANT}),(0,$.jsx)(le.E.Option,{value:Oe.VERSION,children:Oe.VERSION})]})]}),(0,$.jsx)(ae.X,{className:Ve("checkbox"),onChange:()=>v((e=>!e)),checked:u,children:"All expanded"})]}),m.map((e=>{let{title:t,nodes:s,items:r,versionColor:n,versionsValues:l}=e;return(0,$.jsx)(ye,{title:t,nodes:s,items:r,expanded:u,versionColor:n,versionsValues:l},`tenant-nodes-${t}`)}))]}):null,f=null!==x&&void 0!==x&&x.length?(0,$.jsxs)(r.Fragment,{children:[(0,$.jsx)("h4",{children:Me("title_other")}),x.map((e=>{let{title:t,nodes:s,items:r,versionColor:n,versionsValues:l}=e;return(0,$.jsx)(ye,{title:t,nodes:s,items:r,versionColor:n,versionsValues:l},`other-nodes-${t}`)}))]}):null,b=(0,$.jsxs)(r.Fragment,{children:[(0,$.jsx)("h4",{children:Me("title_overall")}),(0,$.jsx)("div",{className:Ve("overall-wrapper"),children:(0,$.jsx)(ue,{progressClassName:Ve("overall-progress"),versionsValues:l.filter((e=>"unknown"!==e.title)),size:"m"})})]});return(0,$.jsxs)("div",{className:Ve(),children:[b,j,N,f]})};var Ie=s(23795),Ge=s(79777),Ze=s(13618),$e=s(25665);const Fe=JSON.parse('{"disk-type":"Disk Type","erasure":"Erasure","allocated":"Allocated","available":"Available","usage":"Usage","label_nodes-state":"Nodes state","label_dc":"Nodes data centers","storage-size":"Storage size","storage-groups":"Storage groups, {{diskType}}","links":"Links","context_cores":"cores","title_cpu":"CPU","title_storage":"Storage","title_memory":"Memory","label_nodes":"Nodes","label_hosts":"Hosts","label_storage-groups":"Storage groups","label_databases":"Databases","label_load":"Load"}'),Re=(0,I.wZ)("ydb-cluster",{en:Fe});var Be=s(29331);const We=(0,x.cn)("ydb-doughnut-metrics");function He(e){let{status:t,fillWidth:s,children:r,className:n}=e,l="var(--g-color-line-generic-solid)",a=3.6*s-90;s>50&&(l="var(--doughnut-color)",a=3.6*s+90);const o=a;return(0,$.jsx)("div",{className:We(null,n),children:(0,$.jsx)("div",{style:{backgroundImage:`linear-gradient(${o}deg, transparent 50%, ${l} 50%), linear-gradient(-90deg, var(--g-color-line-generic-solid) 50%, transparent 50%)`},className:We("doughnut",{status:t}),children:(0,$.jsx)("div",{className:We("text-wrapper"),children:r})})})}He.Legend=function(e){let{children:t,variant:s="subheader-3"}=e;return(0,$.jsx)(Ie.x,{variant:s,color:"secondary",className:We("legend"),children:t})},He.Value=function(e){let{children:t,variant:s="subheader-2"}=e;return(0,$.jsx)(Ie.x,{variant:s,color:"secondary",className:We("value"),children:t})};var Ue=s(43464);const qe=(0,x.cn)("ydb-cluster-dashboard");function Qe(e){let{children:t,title:s,size:r,className:n}=e;return(0,$.jsxs)(Be.Q,{className:qe("card",{size:r},n),size:r,interactive:!1,children:[s?(0,$.jsx)(Ie.x,{variant:"subheader-3",className:qe("card-title"),children:s}):null,t]})}function Ye(e){let{title:t,children:s,size:r,...n}=e;return(0,$.jsx)(Qe,{title:t,size:r,children:(0,$.jsx)(He,{...n,className:qe("doughnut"),children:s})})}function Je(){return(0,$.jsx)(Qe,{className:qe("skeleton-wrapper"),children:(0,$.jsx)(Ue.O,{className:qe("skeleton")})})}function Ke(){return(0,$.jsxs)(r.Fragment,{children:[(0,$.jsx)(Je,{}),(0,$.jsx)(Je,{}),(0,$.jsx)(Je,{})]})}var Xe=s(95440),et=s(20134),tt=s(43926),st=s(10142);const rt=(0,x.cn)("ydb-disk-groups-stats"),nt=e=>{let{stats:t,children:s}=e;return(0,$.jsx)("div",{className:rt(),children:(0,$.jsx)(tt.f,{placement:["right"],pinOnClick:!0,content:(0,$.jsx)(lt,{stats:t}),children:s})})};function lt(e){let{stats:t}=e;const{diskType:s,erasure:r,allocatedSize:n,availableSize:l}=t,a=(0,st.dT)(Math.max(n,l),2),o=(0,st.td)({value:n,size:a}),i=(0,st.td)({value:l,size:a}),d=Math.round(n/(n+l)*100),c=[{name:Re("disk-type"),content:s},{name:Re("erasure"),content:r},{name:Re("allocated"),content:o},{name:Re("available"),content:i},{name:Re("usage"),content:d+"%"}];return(0,$.jsx)(et.w,{items:c,className:rt("popup-content"),responsive:!0})}function at(e){let{value:t,capacity:s,colorizeProgress:r=!0,warningThreshold:n=60,dangerThreshold:l=80,inverseColorize:a=!1,legendFormatter:o}=e;const i=parseFloat(String(t)),d=parseFloat(String(s));let c=i/d*100||0;c=c>100?100:c;const u=c<1?.5:c;return{status:(0,Xe.S)({fillWidth:c,warningThreshold:n,dangerThreshold:l,colorizeProgress:r,inverseColorize:a}),percents:(0,se.T3)(c/100),legend:o({value:i,capacity:d}),fill:u}}const ot=["storage","tenant"];const it=e=>Object.values(e).reduce(((e,t)=>(Object.values(t).forEach((t=>{e+=t.createdGroups})),e)),0);function dt(e){let{value:t,capacity:s}=e,r=[];return r=s<1e4?[(0,se.uf)(Math.round(t)),(0,se.uf)(Math.round(s))]:(0,se.cN)(t,s,void 0,"",!0),`${r[0]} / ${r[1]}\n${Re("context_cores")}`}function ct(e){let{value:t,capacity:s,...r}=e;const{status:n,percents:l,legend:a,fill:o}=at({value:t,capacity:s,legendFormatter:dt,...r});return(0,$.jsxs)(Ye,{status:n,fillWidth:o,title:Re("title_cpu"),children:[(0,$.jsx)(He.Legend,{children:a}),(0,$.jsx)(He.Value,{children:l})]})}function ut(e){let{value:t,capacity:s}=e;const r=(0,se.QO)(t,s,void 0,"\n");return`${r[0]} / ${r[1]}`}function vt(e){let{value:t,capacity:s,...r}=e;const{status:n,percents:l,legend:a,fill:o}=at({value:t,capacity:s,legendFormatter:ut,...r});return(0,$.jsxs)(Ye,{status:n,fillWidth:o,title:Re("title_memory"),children:[(0,$.jsx)(He.Legend,{children:a}),(0,$.jsx)(He.Value,{children:l})]})}function ht(e){let{value:t,capacity:s}=e;const r=(0,se.QO)(t,s,void 0,"\n");return`${r[0]} / ${r[1]}`}function mt(e){let{value:t,capacity:s,...r}=e;const{status:n,percents:l,legend:a,fill:o}=at({value:t,capacity:s,legendFormatter:ht,...r});return(0,$.jsxs)(Ye,{status:n,fillWidth:o,title:Re("title_storage"),children:[(0,$.jsx)(He.Legend,{children:a}),(0,$.jsx)(He.Value,{children:l})]})}function pt(e){let{value:t}=e;return(0,$e.D)(t)?(0,$.jsx)(Ie.x,{variant:"subheader-3",color:"secondary",children:(0,se.uf)(t)}):null}function xt(e){let{cluster:t,...s}=e;return s.error?(0,$.jsx)(T.V,{error:s.error,className:qe("error")}):(0,$.jsx)("div",{className:qe(),children:(0,$.jsxs)(Ge.k,{gap:4,wrap:!0,children:[(0,$.jsx)(Ge.k,{gap:4,wrap:"nowrap",children:(0,$.jsx)(gt,{...s,cluster:t})}),(0,$.jsx)("div",{className:qe("cards-container"),children:(0,$.jsx)(jt,{...s,cluster:t})})]})})}function gt(e){let{cluster:t,loading:s}=e;if(s)return(0,$.jsx)(Ke,{});const r=[];if((0,ze.j)(t)){const{CoresUsed:e,NumberOfCpus:s,CoresTotal:n}=t,l=null!==n&&void 0!==n?n:s;(0,$e.D)(e)&&(0,$e.D)(l)&&r.push((0,$.jsx)(ct,{value:e,capacity:l},"cores"))}const{StorageTotal:n,StorageUsed:l}=t;(0,$e.D)(n)&&(0,$e.D)(l)&&r.push((0,$.jsx)(mt,{value:l,capacity:n},"storage"));const{MemoryTotal:a,MemoryUsed:o}=t;return(0,$e.D)(a)&&(0,$e.D)(o)&&r.push((0,$.jsx)(vt,{value:o,capacity:a},"memory")),r}function jt(e){let{cluster:t,groupStats:s={},loading:n}=e;if(n)return null;const l=[],a=function(e){const t=[];if((0,ze.j)(e)&&e.MapNodeRoles)for(const[s,n]of Object.entries(e.MapNodeRoles))ot.includes(s.toLowerCase())&&t.push((0,$.jsxs)(r.Fragment,{children:[s,": ",(0,se.uf)(n)]},s));return t}(t);if(l.push((0,$.jsx)(Qe,{size:"l",title:Re("label_nodes"),children:(0,$.jsxs)(Ge.k,{gap:2,direction:"column",children:[(0,$.jsx)(pt,{value:null===t||void 0===t?void 0:t.NodesAlive}),null!==a&&void 0!==a&&a.length?(0,$.jsx)(Ze.$,{tags:a,gap:3}):null]})},"roles")),Object.keys(s).length){const e=function(e){const t=[];return Object.entries(e).forEach((e=>{let[s,r]=e;Object.values(r).forEach((e=>{t.push((0,$.jsxs)(nt,{stats:e,children:[s,": ",(0,se.uf)(e.createdGroups)," /"," ",(0,se.uf)(e.totalGroups)]},`${s}|${e.erasure}`))}))})),t}(s),t=it(s);l.push((0,$.jsx)(Qe,{size:"l",title:Re("label_storage-groups"),children:(0,$.jsxs)(Ge.k,{gap:2,direction:"column",children:[(0,$.jsx)(pt,{value:t}),(0,$.jsx)(Ze.$,{tags:e,gap:3})]})},"groups"))}const o=function(e){var t;return(0,ze.j)(e)&&e.MapDataCenters?Object.keys(e.MapDataCenters):null===(t=e.DataCenters)||void 0===t?void 0:t.filter(Boolean)}(t);return null!==o&&void 0!==o&&o.length&&l.push((0,$.jsx)(Qe,{size:"l",title:Re("label_hosts"),children:(0,$.jsxs)(Ge.k,{gap:2,direction:"column",children:[(0,$.jsx)(pt,{value:null===t||void 0===t?void 0:t.Hosts}),(0,$.jsx)(Ze.$,{tags:o,gap:3})]})},"hosts")),t.Tenants&&l.push((0,$.jsx)(Qe,{size:"l",title:Re("label_databases"),children:(0,$.jsx)(pt,{value:null===t||void 0===t?void 0:t.Tenants})},"tenants")),l}var Nt=s(43862),ft=s(21711);const bt=(0,x.cn)("cluster-info");s(9038);const yt=(0,x.cn)("ydb-nodes-state");function wt(e){let{state:t,children:s}=e;return(0,$.jsx)("div",{className:yt({[t.toLowerCase()]:!0}),children:s})}const Ct={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},Tt=(e,t,s)=>{const n=[];if((0,ze.j)(e)&&e.MapNodeStates){const t=Object.entries(e.MapNodeStates);t.sort(((e,t)=>Ct[t[0]]-Ct[e[0]]));const s=t.map((e=>{let[t,s]=e;return(0,$.jsx)(wt,{state:t,children:(0,se.uf)(s)},t)}));n.push({label:Re("label_nodes-state"),value:(0,$.jsx)(Ge.k,{gap:2,children:s})})}const l=(e=>{if((0,ze.j)(e)&&e.MapDataCenters)return Object.entries(e.MapDataCenters).map((e=>{let[t,s]=e;return(0,$.jsxs)(r.Fragment,{children:[t,": ",(0,se.uf)(s)]},t)}))})(e);return null!==l&&void 0!==l&&l.length&&n.push({label:Re("label_dc"),value:(0,$.jsx)(Ze.$,{tags:l,gap:2})}),n.push({label:Re("label_load"),value:(0,$.jsx)(he.y,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null===e||void 0===e?void 0:e.NumberOfCpus})}),n.push(...t),s.length&&n.push({label:Re("links"),value:(0,$.jsx)("div",{className:bt("links"),children:s.map((e=>{let{title:t,url:s}=e;return(0,$.jsx)(A.j,{title:t,url:s},t)}))})}),n},kt=e=>{let{cluster:t,loading:s,error:r,additionalClusterProps:n={}}=e;const{info:l=[],links:a=[]}=n,o=Tt(null!==t&&void 0!==t?t:{},l,a);return(0,$.jsxs)("div",{className:bt(),children:[r?(0,$.jsx)(T.V,{error:r,className:bt("error")}):null,(0,$.jsx)("div",{className:bt("info"),children:s?(0,$.jsx)(ft.b,{className:bt("skeleton"),rows:9}):r&&!t?null:(0,$.jsx)(Nt._,{dots:!0,info:o})})]})};var St=s(4128);const Pt=(0,x.cn)("ydb-cluster");function Et(e){let{additionalClusterProps:t,additionalTenantsProps:s,additionalNodesProps:x,additionalVersionsProps:y}=e;const w=r.useRef(null),C=(0,h.I8)(),T=(0,g.zL)(),k=function(){const e=(0,g.zL)(),t=(0,g.ix)((e=>e.cluster.defaultClusterTab)),s=(0,o.$B)(v.ZP.cluster),{activeTab:n}=(null===s||void 0===s?void 0:s.params)||{};let l;l=(0,St.V2)(n)?n:t;return r.useEffect((()=>{l!==t&&e((0,m.LQ)(l))}),[l,t,e]),l}(),[{clusterName:S,backend:P}]=(0,i.useQueryParams)({clusterName:i.StringParam,backend:i.StringParam}),E=(0,g.ix)((e=>(0,m.le)(e,null!==S&&void 0!==S?S:void 0))),{data:{clusterData:O={},groupsStats:D}={},isLoading:L,error:M}=m.UM.useGetClusterInfoQuery(null!==S&&void 0!==S?S:void 0),_=M&&"object"===typeof M?M:void 0,z=(0,g.ix)((e=>(0,m.DS)(e,null!==S&&void 0!==S?S:void 0)));r.useEffect((()=>{T((0,p.J)("cluster",{}))}),[T]);const V=r.useMemo((()=>null!==y&&void 0!==y&&y.getVersionToColorMap?null===y||void 0===y?void 0:y.getVersionToColorMap():(0,j.ZP)(null===O||void 0===O?void 0:O.Versions)),[y,O]),A=r.useMemo((()=>St._Y.find((e=>{let{id:t}=e;return t===k}))),[k]);return(0,$.jsxs)("div",{className:Pt(),ref:w,children:[(0,$.jsx)(a.ql,{defaultTitle:`${E} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${E} \u2014 YDB Monitoring`,children:A?(0,$.jsx)("title",{children:A.title}):null}),(0,$.jsx)("div",{className:Pt("header"),children:L?(0,$.jsx)(n.O,{className:Pt("title-skeleton")}):(0,$.jsx)(c.A,{size:"m",status:null===O||void 0===O?void 0:O.Overall,name:E,className:Pt("title")})}),(0,$.jsx)("div",{className:Pt("sticky-wrapper"),children:(0,$.jsx)(d.q,{className:Pt("auto-refresh-control")})}),C&&(0,$.jsx)(xt,{cluster:O,groupStats:D,loading:L,error:_||(null===O||void 0===O?void 0:O.error)}),(0,$.jsx)("div",{className:Pt("tabs-sticky-wrapper"),children:(0,$.jsx)(l.m,{size:"l",allowNotSelected:!0,activeTab:k,items:St._Y,wrapTo:(e,t)=>{let{id:s}=e;const r=(0,St.B7)(s,{clusterName:S,backend:P});return(0,$.jsx)(u.h,{to:r,onClick:()=>{T((0,m.LQ)(s))},children:t},s)}})}),(0,$.jsxs)(o.rs,{children:[(0,$.jsx)(o.AW,{path:(0,v.Fz)((0,St.B7)(St.xu.overview)).pathname,children:(0,$.jsx)(kt,{cluster:O,versionToColor:V,loading:L,error:_,additionalClusterProps:t})}),(0,$.jsx)(o.AW,{path:(0,v.Fz)((0,St.B7)(St.xu.tablets)).pathname,children:(0,$.jsx)("div",{className:Pt("tablets"),children:(0,$.jsx)(b.O,{loading:L,tablets:z,className:Pt("tablets-table")})})}),(0,$.jsx)(o.AW,{path:(0,v.Fz)((0,St.B7)(St.xu.tenants)).pathname,children:(0,$.jsx)(ne,{additionalTenantsProps:s})}),(0,$.jsx)(o.AW,{path:(0,v.Fz)((0,St.B7)(St.xu.nodes)).pathname,children:(0,$.jsx)(N.G,{parentRef:w,additionalNodesProps:x})}),(0,$.jsx)(o.AW,{path:(0,v.Fz)((0,St.B7)(St.xu.storage)).pathname,children:(0,$.jsx)(f.V,{parentRef:w})}),(0,$.jsx)(o.AW,{path:(0,v.Fz)((0,St.B7)(St.xu.versions)).pathname,children:(0,$.jsx)(Ae,{versionToColor:V,cluster:O})}),(0,$.jsx)(o.AW,{render:()=>(0,$.jsx)(o.l_,{to:(0,v.Fz)((0,St.B7)(k))})})]})]})}}}]);