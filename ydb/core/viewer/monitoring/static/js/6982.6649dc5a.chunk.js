"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[6982],{94790:(e,t,s)=>{s.d(t,{f:()=>o});var a=s(68963),l=s(44920),i=s(75859);const o=e=>{let{children:t,content:s,className:o,pinOnClick:n,hasArrow:r=!0,placement:d=["top","bottom"],...c}=e;const[u,p]=a.useState(!1),[m,v]=a.useState(!1),D=a.useRef(null);return(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)(l.G,{anchorRef:D,open:m||u,placement:d,hasArrow:r,onOutsideClick:()=>{v(!1)},...c,children:s}),(0,i.jsx)("span",{className:o,ref:D,onClick:n?()=>{v(!0)}:void 0,onMouseEnter:()=>{p(!0)},onMouseLeave:()=>{p(!1)},children:t})]})}},30832:(e,t,s)=>{s.d(t,{a:()=>n});var a=s(24362),l=s(98366),i=s(75859);const o=(0,a.cn)("ydb-entity-page-title");function n(e){let{entityName:t,status:s,id:a,className:n,children:r}=e;return(0,i.jsxs)("div",{className:o(null,n),children:[(0,i.jsx)("span",{className:o("prefix"),children:t}),(0,i.jsx)(l.J,{className:o("icon"),status:s,size:"s"}),a,r]})}},91816:(e,t,s)=>{s.d(t,{b:()=>c});var a=s(68963),l=s(56711),i=s(24362),o=s(42587),n=s(75859);const r=(0,i.cn)("ydb-info-viewer-skeleton"),d=()=>(0,n.jsxs)("div",{className:r("label"),children:[(0,n.jsx)(l.O,{className:r("label__text")}),(0,n.jsx)("div",{className:r("label__dots")})]}),c=e=>{let{rows:t=8,className:s,delay:i=600}=e;const c=(0,o.$)(i);let u=(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)(d,{}),(0,n.jsx)(l.O,{className:r("value")})]});return c||(u=null),(0,n.jsx)("div",{className:r(null,s),children:[...new Array(t)].map(((e,t)=>(0,n.jsx)("div",{className:r("row"),children:u},"skeleton-row-".concat(t))))})}},8659:(e,t,s)=>{s.d(t,{P:()=>S});var a=s(54665),l=s(14146),i=s(17880),o=s(5922),n=s(81854),r=s(24362),d=s(34301),c=s(48169),u=s(17096),p=s(69214),m=s(23373),v=s(32270),D=s(67359),h=s(30817);const k=JSON.parse('{"decomission-status":"Decomission Status","type":"Type","path":"Path","guid":"GUID","serial-number":"Serial Number","shared-with-os":"SharedWithOs","drive-status":"Drive Status","state":"State","device":"Device","realtime":"Realtime","space":"Space","slots":"Slots","log-size":"Log Size","system-size":"System Size","links":"Links","developer-ui":"Developer UI","pdisk-page":"PDisk page","yes":"Yes"}'),g=(0,h.wZ)("ydb-pDisk-info",{en:k});var y=s(75859);const x=(0,r.cn)("ydb-pdisk-info");function S(e){let{pDisk:t,nodeId:s,withPDiskPageLink:r,className:h}=e;const k=(0,u.ix)(l.VH),S=(0,i.X_)(),[N,b,j,f]=function(e){let{pDisk:t,nodeId:s,withPDiskPageLink:l,isUserAllowedToMakeChanges:i}=e;const{PDiskId:r,Path:u,Guid:m,Category:h,Type:k,Device:S,Realtime:N,State:b,SerialNumber:j,TotalSize:f,AllocatedSize:I,DecommitStatus:w,StatusV2:P,NumActiveSlots:T,ExpectedSlotCount:z,LogUsedSize:C,LogTotalSize:A,SystemSize:E,SharedWithOs:L}=t||{},O=[];(0,o.D)(w)&&O.push({label:g("decomission-status"),value:w.replace("DECOMMIT_","")}),(0,o.D)(h)&&O.push({label:g("type"),value:k}),(0,o.D)(u)&&O.push({label:g("path"),value:u}),(0,o.D)(m)&&O.push({label:g("guid"),value:m}),j&&O.push({label:g("serial-number"),value:j}),(0,o.D)(L)&&O.push({label:g("shared-with-os"),value:g("yes")});const U=[];(0,o.D)(P)&&U.push({label:g("drive-status"),value:P}),(0,o.D)(b)&&U.push({label:g("state"),value:b}),(0,o.D)(S)&&U.push({label:g("device"),value:(0,y.jsx)(p.A,{status:S})}),(0,o.D)(N)&&U.push({label:g("realtime"),value:(0,y.jsx)(p.A,{status:N})});const _=[];_.push({label:g("space"),value:(0,y.jsx)(D.y,{value:I,capacity:f,formatValues:d.q3,colorizeProgress:!0})}),(0,o.D)(T)&&(0,o.D)(z)&&_.push({label:g("slots"),value:(0,y.jsx)(D.y,{value:T,capacity:z})}),(0,o.D)(C)&&(0,o.D)(A)&&_.push({label:g("log-size"),value:(0,y.jsx)(D.y,{value:C,capacity:A,formatValues:d.q3})}),(0,o.D)(E)&&_.push({label:g("system-size"),value:(0,n.td)({value:E})});const V=[];if((l||i)&&(0,o.D)(r)&&(0,o.D)(s)){const e=(0,a.ds)(r,s),t=(0,c.ok)({nodeId:s,pDiskId:r});V.push({label:g("links"),value:(0,y.jsxs)("span",{className:x("links"),children:[l&&(0,y.jsx)(v.j,{title:g("pdisk-page"),url:e,external:!1}),i&&(0,y.jsx)(v.j,{title:g("developer-ui"),url:t})]})})}return[O,U,_,V]}({pDisk:t,nodeId:s,withPDiskPageLink:r&&S,isUserAllowedToMakeChanges:k});return(0,y.jsxs)("div",{className:x("wrapper",h),children:[(0,y.jsxs)("div",{className:x("col"),children:[(0,y.jsx)(m._,{info:N,renderEmptyState:()=>null}),(0,y.jsx)(m._,{info:j,renderEmptyState:()=>null})]}),(0,y.jsxs)("div",{className:x("col"),children:[(0,y.jsx)(m._,{info:b,renderEmptyState:()=>null}),(0,y.jsx)(m._,{info:f,renderEmptyState:()=>null})]})]})}},27174:(e,t,s)=>{s.d(t,{B:()=>p});var a=s(77796),l=s(24362),i=s(50422),o=s(56711),n=s(42587),r=s(75859);const d=e=>{let{delay:t=600,className:s}=e;return(0,n.$)(t)?(0,r.jsx)(o.O,{className:s}):null},c=(0,l.cn)("ydb-page-meta");function u(e){let{items:t,loading:s}=e;return(0,r.jsx)("div",{className:c("info"),children:s?(0,r.jsx)(d,{className:c("skeleton")}):t.filter((e=>Boolean(e))).join("\xa0\xa0\xb7\xa0\xa0")})}function p(e){let{className:t,...s}=e;return(0,r.jsxs)(a.k,{gap:1,alignItems:"center",justifyContent:"space-between",className:c(null,t),children:[(0,r.jsx)(u,{...s}),(0,r.jsx)(i.q,{})]})}},22692:(e,t,s)=>{s.d(t,{h:()=>n});var a=s(56711),l=s(24362),i=s(75859);const o=(0,l.cn)("table-skeleton"),n=e=>{let{rows:t=2,className:s}=e;return(0,i.jsxs)("div",{className:o(null,s),children:[(0,i.jsxs)("div",{className:o("row"),children:[(0,i.jsx)(a.O,{className:o("col-1")}),(0,i.jsx)(a.O,{className:o("col-2")}),(0,i.jsx)(a.O,{className:o("col-3")}),(0,i.jsx)(a.O,{className:o("col-4")}),(0,i.jsx)(a.O,{className:o("col-5")})]}),[...new Array(t)].map(((e,t)=>(0,i.jsx)("div",{className:o("row"),children:(0,i.jsx)(a.O,{className:o("col-full")})},"skeleton-row-".concat(t))))]})}},71749:(e,t,s)=>{s.r(t),s.d(t,{PDiskPage:()=>oe});var a=s(68963),l=s(3475),i=s(88776),o=s(8179),n=s(17095),r=s(49352),d=s(52846),c=s(95408),u=s(14659),p=s(30832),m=s(26688),v=s(91816),D=s(68036),h=s(8659),k=s(27174),g=s(54665),y=s(905),x=s(14146),S=s(79061),N=s(11431),b=s(92666),j=s(5922),f=s(3764),I=s(51688),w=s(92092);const P=y.h.injectEndpoints({endpoints:e=>({getPdiskInfo:e.query({queryFn:async(e,t)=>{let{nodeId:s,pDiskId:a}=e,{signal:l}=t;try{const e=function(e){var t,s,a;let[l={},i]=e;const{BSC:o={},Whiteboard:n={}}=l||{},{PDisk:r={},VDisks:d=[]}=n,{PDisk:c={}}=o,u=(0,f.b)(r,c),{LogUsedSize:p,LogTotalSize:m,TotalSize:v,SystemSize:D,ExpectedSlotCount:h,EnforcedDynamicSlotSize:k}=u;let g;(0,j.D)(m)&&(g={SlotType:"log",Used:Number(p),Total:Number(m),UsagePercent:100*Number(p)/Number(m),Severity:1,SlotData:{LogUsedSize:p,LogTotalSize:m,SystemSize:D}});const y=d.map(f.w).sort(((e,t)=>Number(t.VDiskSlotId)-Number(e.VDiskSlotId))).map((e=>{var t;return{SlotType:"vDisk",Id:null===(t=e.VDiskId)||void 0===t?void 0:t.GroupID,Title:e.StoragePoolName,Severity:e.Severity,Used:Number(e.AllocatedSize),Total:Number(e.TotalSize),UsagePercent:e.AllocatedPercent,SlotData:e}}));let x=[];if(h&&h>y.length){const e=h-y.length;let t=Number(k);if(isNaN(t)){const s=y.reduce(((e,t)=>t.Total?e+t.Total:e),0);t=(Number(v)-s-Number(m))/e}x=(0,j.c)(e).map((()=>({SlotType:"empty",Total:t,Severity:1,SlotData:{Size:t}})))}const S=[...y,...x];g&&S.unshift(g);const N=null===(t=i.SystemStateInfo)||void 0===t?void 0:t[0],b=(0,I.Ns)(N);return{...u,NodeId:null!==(s=u.NodeId)&&void 0!==s?s:b.NodeId,NodeHost:b.Host,NodeType:null===(a=b.Roles)||void 0===a?void 0:a[0],NodeDC:b.DC,SlotItems:S}}(await Promise.all([window.api.getPDiskInfo({nodeId:s,pDiskId:a},{signal:l}),window.api.getNodeInfo(s,{signal:l})]));return{data:e}}catch(i){return{error:i}}},providesTags:(e,t,s)=>["All",{type:"PDiskData",id:(0,b.CH)(s.nodeId,s.pDiskId)}]}),getStorageInfo:e.query({queryFn:async(e,t)=>{let{nodeId:s,pDiskId:a}=e,{signal:l}=t;try{const e=function(e,t,s){var a;const l=[];return null===(a=e.StoragePools)||void 0===a||a.forEach((e=>{var a;return null===(a=e.Groups)||void 0===a?void 0:a.forEach((a=>{var i;(null===(i=a.VDisks)||void 0===i?void 0:i.some((e=>{var a,l,i,o;const n=null!==(a=e.PDiskId)&&void 0!==a?a:null===(l=e.PDisk)||void 0===l?void 0:l.PDiskId,r=null!==(i=e.NodeId)&&void 0!==i?i:null===(o=e.PDisk)||void 0===o?void 0:o.NodeId;return n===Number(t)&&r===Number(s)})))&&l.push((0,w.mD)(a,e))}))})),l}(await window.api.getStorageInfo({nodeId:s,version:N.w.v1},{signal:l}),a,s);return{data:e}}catch(i){return{error:i}}},providesTags:(e,t,s)=>["All",{type:"PDiskData",id:(0,b.CH)(s.nodeId,s.pDiskId)}]})}),overrideExisting:"throw"});var T=s(17096),z=s(2098),C=s(22692),A=s(99337),E=s(52317),L=s(92076),O=s(75859);function U(e){var t;let{pDiskId:s,nodeId:l}=e;const i=(0,T.ix)(A.d),[o]=(0,T.Rj)(),n=P.useGetStorageInfoQuery({pDiskId:s,nodeId:l},{pollingInterval:o}),r=n.isFetching&&void 0===n.currentData,d=null!==(t=n.currentData)&&void 0!==t?t:[],c=a.useMemo((()=>(0,L.AH)(i)),[i]);return r?(0,O.jsx)(C.h,{}):(0,O.jsx)(z.G,{columnsWidthLSKey:L.Ty,data:d,columns:c,settings:E.LE})}var _=s(94790),V=s(1796),q=s(62206),R=s(74170),H=s(67359),G=s(22200),M=s(81854),B=s(24362),F=s(34301),J=s(30817);const Z=JSON.parse('{"fqdn":"FQDN","pdisk":"PDisk","node":"Node","groups":"Groups","disk-distribution":"Disk distribution","empty-slot":"Empty slot","log":"Log","label.log-size":"Log Size","label.system-size":"System Size","label.slot-size":"Slot Size","no-slots-data":"No slots data","restart-pdisk-button":"Restart PDisk","force-restart-pdisk-button":"Restart anyway","restart-pdisk-dialog":"PDisk will be restarted. Do you want to proceed?","restart-pdisk-not-allowed":"You don\'t have enough rights to restart PDisk"}'),Q=(0,J.wZ)("ydb-pDisk-page",{en:Z});const W=(0,B.cn)("ydb-pdisk-space-distribution"),Y=40;function K(e){let{data:t}=e;const{SlotItems:s}=t,{PDiskId:a,NodeId:l}=t,i=Y*((null===s||void 0===s?void 0:s.length)||1);return null!==s&&void 0!==s&&s.length?(0,O.jsx)("div",{className:W(null),style:{height:i,minHeight:i},children:(0,O.jsx)(V.p,{className:W("pdisk-bar"),severity:t.Severity,diskAllocatedPercent:t.AllocatedPercent,content:null===s||void 0===s?void 0:s.map(((e,t)=>(0,O.jsx)($,{item:e,pDiskId:a,nodeId:l},t))),faded:!0})}):Q("no-slots-data")}function $(e){let{item:t,pDiskId:s,nodeId:a}=e;return(0,O.jsx)("div",{className:W("slot-wrapper"),style:{flexGrow:Number(t.Total)||1},children:(()=>{if("vDisk"===t.SlotType){var e;const l=(0,j.D)(null===(e=t.SlotData)||void 0===e?void 0:e.VDiskSlotId)&&(0,j.D)(s)&&(0,j.D)(a)?(0,g.By)(t.SlotData.VDiskSlotId,s,a):void 0;return(0,O.jsx)(_.f,{content:(0,O.jsx)(G.K,{data:t.SlotData,withTitle:!0}),contentClassName:W("vdisk-popup"),placement:["right","top"],children:(0,O.jsx)(R.h,{to:l,children:(0,O.jsx)(V.p,{className:W("slot"),severity:t.Severity,diskAllocatedPercent:t.UsagePercent,content:(0,O.jsx)(X,{id:t.Id,title:t.Title,used:t.Used,total:t.Total})})})})}return function(e){return"log"===e.SlotType}(t)?(0,O.jsx)(_.f,{content:(0,O.jsx)(ee,{data:t.SlotData}),contentClassName:W("vdisk-popup"),placement:["right","top"],children:(0,O.jsx)(V.p,{className:W("slot"),severity:t.Severity,diskAllocatedPercent:t.UsagePercent,content:(0,O.jsx)(X,{title:Q("log"),used:t.Used,total:t.Total})})}):function(e){return"empty"===e.SlotType}(t)?(0,O.jsx)(_.f,{content:(0,O.jsx)(te,{data:t.SlotData}),contentClassName:W("vdisk-popup"),placement:["right","top"],children:(0,O.jsx)(V.p,{className:W("slot"),severity:t.Severity,empty:!0,content:(0,O.jsx)(X,{title:Q("empty-slot"),used:t.Total})})}):null})()})}function X(e){let{id:t,title:s,used:a,total:l}=e;return(0,O.jsxs)("div",{className:W("slot-content"),children:[(0,O.jsxs)("span",{children:[(0,j.D)(t)?(0,O.jsx)("span",{className:W("slot-id"),children:t}):null,s]}),(0,O.jsx)("span",{className:W("slot-size"),children:(()=>{const[e,t]=(0,F.q3)(a,l);return l?"".concat(e," / ").concat(t):e})()})]})}function ee(e){let{data:t}=e;const{LogTotalSize:s,LogUsedSize:a,SystemSize:l}=t,i=[{label:Q("label.log-size"),value:(0,O.jsx)(H.y,{value:a,capacity:s,formatValues:F.q3})}];return(0,j.D)(l)&&i.push({label:Q("label.system-size"),value:(0,M.td)({value:l})}),(0,O.jsx)(q._P,{title:Q("log"),info:i})}function te(e){let{data:t}=e;const{Size:s}=t,a=[{label:Q("label.slot-size"),value:(0,M.td)({value:s})}];return(0,O.jsx)(q._P,{title:Q("empty-slot"),info:a})}const se=(0,B.cn)("ydb-pdisk-page"),ae={diskDistribution:"diskDistribution",groups:"groups"},le=[{id:ae.diskDistribution,get title(){return Q("disk-distribution")}},{id:ae.groups,get title(){return Q("groups")}}],ie=c.z.nativeEnum(ae).catch(ae.diskDistribution);function oe(){const e=(0,T.zL)(),t=(0,T.ix)(x.VH),[{nodeId:s,pDiskId:c,activeTab:N}]=(0,d.useQueryParams)({activeTab:d.StringParam,nodeId:d.StringParam,pDiskId:d.StringParam}),f=(0,j.D)(s)&&(0,j.D)(c),I=ie.parse(N);a.useEffect((()=>{e((0,S.J)("pDisk",{nodeId:s,pDiskId:c}))}),[e,s,c]);const[w]=(0,T.Rj)(),z=f?{nodeId:s,pDiskId:c}:n.CN,C=P.useGetPdiskInfoQuery(z,{pollingInterval:w}),A=C.isFetching&&void 0===C.currentData,E=C.currentData,{NodeHost:L,NodeId:_,NodeType:V,NodeDC:q,Severity:R}=E||{},H=async e=>{if(f)return window.api.restartPDisk({nodeId:s,pDiskId:c,force:e}).then((e=>{if(!1===(null===e||void 0===e?void 0:e.result)){throw{statusText:e.error,retryPossible:e.forceRetryPossible}}}))},G=()=>{f&&e(y.h.util.invalidateTags([{type:"PDiskData",id:(0,b.CH)(s,c)}]))};return(0,O.jsxs)("div",{className:se(null),children:[(()=>{const e=c?"".concat(Q("pdisk")," ").concat(c):Q("pdisk"),t=L||Q("node");return(0,O.jsx)(r.ql,{titleTemplate:"%s - ".concat(e," \u2014 ").concat(t," \u2014 YDB Monitoring"),defaultTitle:"".concat(e," \u2014 ").concat(t," \u2014 YDB Monitoring")})})(),(()=>{const e=L?"".concat(Q("fqdn"),": ").concat(L):void 0,t=_?"".concat(Q("node"),": ").concat(_):void 0;return(0,O.jsx)(k.B,{loading:A,items:[e,t,V,q],className:se("meta")})})(),(0,O.jsx)(p.a,{entityName:Q("pdisk"),status:(0,b.b2)(R),id:f?(0,b.CH)(s,c):null,className:se("title")}),(0,O.jsx)("div",{className:se("controls"),children:(0,O.jsxs)(u.U,{onConfirmAction:H,onConfirmActionSuccess:G,buttonDisabled:!s||!c||!t,buttonView:"normal",dialogContent:Q("restart-pdisk-dialog"),retryButtonText:Q("force-restart-pdisk-button"),withPopover:!0,popoverContent:Q("restart-pdisk-not-allowed"),popoverDisabled:t,children:[(0,O.jsx)(i.J,{data:l.Z}),Q("restart-pdisk-button")]})}),C.error?(0,O.jsx)(m.V,{error:C.error}):null,A?(0,O.jsx)(v.b,{className:se("info"),rows:10}):(0,O.jsx)(h.P,{pDisk:E,nodeId:s,className:se("info")}),(0,O.jsx)("div",{className:se("tabs"),children:(0,O.jsx)(o.m,{size:"l",items:le,activeTab:I,wrapTo:(e,t)=>{let{id:a}=e;const l=f?(0,g.ds)(c,s,{activeTab:a}):void 0;return(0,O.jsx)(D.h,{to:l,children:t},a)}})}),(()=>{switch(I){case"diskDistribution":return E?(0,O.jsx)(K,{data:E}):null;case"groups":return f?(0,O.jsx)(U,{nodeId:s,pDiskId:c}):null;default:return null}})()]})}},3475:(e,t,s)=>{s.d(t,{Z:()=>l});var a=s(68963);const l=e=>a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 1.5a6.5 6.5 0 1 1-6.445 7.348.75.75 0 1 1 1.487-.194A5.001 5.001 0 1 0 4.43 4.5h1.32a.75.75 0 0 1 0 1.5h-3A.75.75 0 0 1 2 5.25v-3a.75.75 0 0 1 1.5 0v1.06A6.48 6.48 0 0 1 8 1.5Z",clipRule:"evenodd"}))}}]);