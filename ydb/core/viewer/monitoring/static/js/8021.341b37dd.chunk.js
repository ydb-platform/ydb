"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[8021],{55982:(e,t,a)=>{a.d(t,{U:()=>d});var n=a(34706),r=a(72616),o=a(16318),s=a(47945),l=a(51403),i=a(10161);function d(e){let{children:t,onConfirmAction:a,onConfirmActionSuccess:d,dialogHeader:u,dialogText:c,retryButtonText:p,buttonDisabled:h=!1,buttonView:m="action",buttonClassName:b,withPopover:g=!1,popoverContent:y,popoverPlacement:v="right",popoverDisabled:x=!0}=e;const[w,T]=n.useState(!1),[f,j]=n.useState(!1),[N,C]=n.useState(!1),S=()=>(0,i.jsx)(r.z,{onClick:()=>T(!0),view:m,disabled:h,loading:!h&&f,className:b,children:t});return(0,i.jsxs)(n.Fragment,{children:[(0,i.jsx)(s.g,{visible:w,header:u,text:c,withRetry:N,retryButtonText:p,onConfirm:async e=>{j(!0),await a(e)},onConfirmActionSuccess:async()=>{C(!1);try{await(null===d||void 0===d?void 0:d())}finally{j(!1)}},onConfirmActionError:e=>{C((0,l.q)(e)),j(!1)},onClose:()=>{T(!1)}}),g?(0,i.jsx)(o.J,{content:y,placement:v,disabled:x,children:S()}):S()]})}},47945:(e,t,a)=>{a.d(t,{g:()=>g});var n=a(34706),r=a(3948),o=a(15268),s=a(19912),l=a(68585),i=a(14561),d=a(99294),u=a(37711);const c=JSON.parse('{"default-error":"Something went wrong, action cannot be completed","no-rights-error":"You don\'t have enough rights to complete the operation","button-confirm":"Confirm","button-retry":"Retry","button-cancel":"Cancel","button-close":"Close","checkbox-text":"I understand what I\'m doing"}'),p=(0,u.wZ)("ydb-critical-action-dialog",{en:c});var h=a(10161);const m=(0,d.cn)("ydb-critical-dialog"),b=e=>403===e.status?p("no-rights-error"):e.statusText?e.statusText:p("default-error");function g(e){let{visible:t,header:a,text:d,withRetry:u,retryButtonText:c,withCheckBox:g,onClose:y,onConfirm:v,onConfirmActionSuccess:x,onConfirmActionError:w}=e;const[T,f]=n.useState(!1),[j,N]=n.useState(),[C,S]=n.useState(!1),I=async e=>(f(!0),v(e).then((()=>{x(),y()})).catch((e=>{w(e),N(e)})).finally((()=>{f(!1)})));return(0,h.jsx)(l.V,{open:t,hasCloseButton:!1,className:m(),size:"s",onClose:y,onTransitionExited:()=>{N(void 0),S(!1)},children:j?(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)(l.V.Header,{caption:a}),(0,h.jsx)(l.V.Body,{className:m("body"),children:(0,h.jsxs)("div",{className:m("body-message",{error:!0}),children:[(0,h.jsx)("span",{className:m("error-icon"),children:(0,h.jsx)(r.Z,{width:"24",height:"22"})}),b(j)]})}),(0,h.jsx)(l.V.Footer,{loading:!1,preset:"default",textButtonApply:u?c||p("button-retry"):void 0,textButtonCancel:p("button-close"),onClickButtonApply:()=>I(!0),onClickButtonCancel:y})]}):(0,h.jsxs)(n.Fragment,{children:[(0,h.jsx)(l.V.Header,{caption:a}),(0,h.jsxs)(l.V.Body,{className:m("body"),children:[(0,h.jsxs)("div",{className:m("body-message",{warning:!0}),children:[(0,h.jsx)("span",{className:m("warning-icon"),children:(0,h.jsx)(i.J,{data:o.Z,size:24})}),d]}),g?(0,h.jsx)(s.X,{checked:C,onUpdate:S,children:p("checkbox-text")}):null]}),(0,h.jsx)(l.V.Footer,{loading:T,preset:"default",textButtonApply:p("button-confirm"),textButtonCancel:p("button-cancel"),propsButtonApply:{type:"submit",disabled:g&&!C},onClickButtonCancel:y,onClickButtonApply:()=>I()})]})})}},51403:(e,t,a)=>{a.d(t,{q:()=>n});const n=e=>Boolean(e&&"object"===typeof e&&"retryPossible"in e&&e.retryPossible)},34973:(e,t,a)=>{a.d(t,{C:()=>n.C});var n=a(14325)},66498:(e,t,a)=>{a.d(t,{a:()=>n.a});var n=a(41989)},52154:(e,t,a)=>{a.d(t,{T:()=>s});var n=a(67661),r=a(32341),o=a(10161);const s=e=>{let{value:t,onChange:a,className:s}=e;return(0,o.jsxs)(n.E,{value:t,onUpdate:a,className:s,children:[(0,o.jsx)(n.E.Option,{value:r.pu.ALL,children:r.pu.ALL}),(0,o.jsx)(n.E.Option,{value:r.pu.PROBLEMS,children:r.pu.PROBLEMS})]})}},17784:(e,t,a)=>{a.d(t,{o:()=>n.o});var n=a(76485)},59907:(e,t,a)=>{a.d(t,{f:()=>s});var n=a(2634),r=a(55973),o=a(10161);function s(e){let{state:t}=e;return(0,o.jsx)(n._,{theme:(0,r.KR)(t),children:t})}},26612:(e,t,a)=>{a.d(t,{G:()=>H});var n=a(27810),r=a(55842),o=a(34706),s=a(20560),l=a(38471),i=a(99495),d=a(34973),u=a(71037),c=a(93225),p=a(15327),h=a(91538),m=a(52154),b=a(74116),g=a(17784),y=a(74640),v=a(56065),x=a(27660),w=a(88366),T=a(82114),f=a(32341),j=a(99294),N=a(96183),C=a(97485),S=a(9796);const I="nodesTableSelectedColumns",A=["NodeId","Host","DC","Rack","Version","Uptime","Memory","CPU","LoadAverage","Tablets"],F=["NodeId"];function k(e){const t=o.useMemo((()=>function(e){return[(0,S.A6)(),(0,S.Up)(e),(0,S.iJ)(),(0,S.EF)(),(0,S.KO)(),(0,S.Zi)(),(0,S.VQ)(),(0,S.rh)(),(0,S.eb)(),(0,S.gs)(),(0,S.TX)(e)].map((e=>({...e,sortable:(0,N.oh)(e.name)})))}(e)),[e]);return(0,C.N)(t,I,x.Pr,A,F)}var L=a(37711);const D=JSON.parse('{"empty.default":"No such nodes"}'),B=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432"}'),P=(0,L.wZ)("ydb-nodes",{ru:B,en:D});var E=a(10161);const q=(0,j.cn)("ydb-nodes"),R=e=>{var t;let{path:a,database:j,additionalNodesProps:C={}}=e;const[S,I]=(0,i.useQueryParams)({uptimeFilter:i.StringParam,search:i.StringParam}),A=N.U8.parse(S.uptimeFilter),F=null!==(t=S.search)&&void 0!==t?t:"",L=(0,r.zL)(),D=(0,r.ix)(f.qz),[B]=(0,r.Rj)(),{columnsToShow:R,columnsToSelect:U,setColumns:V}=k({getNodeRef:C.getNodeRef,database:j}),{currentData:O,isLoading:M,error:Q}=w.k.useGetNodesQuery({path:a,database:j},{pollingInterval:B}),[z,G]=o.useState({sortValue:"NodeId",sortOrder:s.zE}),[H,J]=(0,r.sC)(z,(e=>{G(e)})),_=e=>{I({search:e||void 0},"replaceIn")},Z=e=>{L((0,f.M6)(e))},K=e=>{I({uptimeFilter:e},"replaceIn")},W=o.useMemo((()=>(0,T.A)(null===O||void 0===O?void 0:O.Nodes,{searchValue:F,uptimeFilter:A,problemFilter:D})),[O,F,A,D]),X=(null===O||void 0===O?void 0:O.TotalNodes)||0;return(0,c.u)(Q)?(0,E.jsx)(u.J,{}):(0,E.jsxs)(y.l,{children:[(0,E.jsx)(y.l.Controls,{children:(0,E.jsxs)(o.Fragment,{children:[(0,E.jsx)(g.o,{onChange:_,placeholder:"Host name",className:q("search"),value:F}),(0,E.jsx)(m.T,{value:D,onChange:Z}),(0,E.jsx)(v.X,{value:A,onChange:K}),(0,E.jsx)(d.C,{total:X,current:W.length,label:"Nodes",loading:M}),(0,E.jsx)(l.N,{popupWidth:200,items:U,showStatus:!0,onUpdate:V,sortable:!1})]})}),Q?(0,E.jsx)(p.V,{error:Q}):null,(0,E.jsx)(y.l.Table,{loading:M,children:O?0!==W.length||D===f.pu.ALL&&A===N.Uu.All?(0,E.jsx)(b.G,{columnsWidthLSKey:x.t5,data:W||[],columns:R,settings:n.LE,sortOrder:H,onSort:J,emptyDataMessage:P("empty.default"),rowClassName:e=>q("node",{unavailable:(0,N.TA)(e)})}):(0,E.jsx)(h.Q,{name:"thumbsUp",width:"200"}):null})]})};var U=a(79317),V=a(16124),O=a(89991);const M=(e,t)=>`getNodes|offset${t}|limit${e}`,Q=async e=>{const{type:t="any",storage:a=!1,tablets:n=!0,limit:r,offset:o,sortParams:s,filters:l}=e,{sortOrder:i,columnId:d}=null!==s&&void 0!==s?s:{},{path:u,database:c,searchValue:p,problemFilter:h,uptimeFilter:m}=null!==l&&void 0!==l?l:{},b=(0,N.oh)(d)?(0,O.A)(d,i):void 0,g=await window.api.getNodes({type:t,storage:a,tablets:n,limit:r,offset:o,sort:b,path:u,database:c,filter:p,problems_only:(0,N.eV)(h),uptime:(0,N.RW)(m)},{concurrentId:M(r,o),signal:e.signal}),y=(0,V.n)(g);return{data:y.Nodes||[],found:y.FoundNodes||0,total:y.TotalNodes||0}},z=(0,j.cn)("ydb-nodes"),G=e=>{var t;let{path:a,database:n,parentRef:s,additionalNodesProps:c}=e;const[b,y]=(0,i.useQueryParams)({uptimeFilter:i.StringParam,search:i.StringParam}),w=N.U8.parse(b.uptimeFilter),T=null!==(t=b.search)&&void 0!==t?t:"",j=(0,r.zL)(),C=(0,r.ix)(f.qz),S=o.useMemo((()=>({path:a,database:n,searchValue:T,problemFilter:C,uptimeFilter:w})),[a,n,T,C,w]),{columnsToShow:I,columnsToSelect:A,setColumns:F}=k({getNodeRef:null===c||void 0===c?void 0:c.getNodeRef,database:n});return(0,E.jsx)(U.WQ,{columnsWidthLSKey:x.t5,parentRef:s,columns:I,fetchData:Q,limit:50,renderControls:e=>{let{totalEntities:t,foundEntities:a,inited:n}=e;return(0,E.jsxs)(o.Fragment,{children:[(0,E.jsx)(g.o,{onChange:e=>{y({search:e||void 0},"replaceIn")},placeholder:"Host name",className:z("search"),value:T}),(0,E.jsx)(m.T,{value:C,onChange:e=>{j((0,f.M6)(e))}}),(0,E.jsx)(v.X,{value:w,onChange:e=>{y({uptimeFilter:e},"replaceIn")}}),(0,E.jsx)(d.C,{total:t,current:a,label:"Nodes",loading:!n}),(0,E.jsx)(l.N,{popupWidth:200,items:A,showStatus:!0,onUpdate:F,sortable:!1})]})},renderErrorMessage:e=>e&&403===e.status?(0,E.jsx)(u.J,{position:"left"}):(0,E.jsx)(p.V,{error:e}),renderEmptyDataMessage:()=>C!==f.pu.ALL||w!==N.Uu.All?(0,E.jsx)(h.Q,{name:"thumbsUp",width:"200"}):P("empty.default"),getRowClassName:e=>z("node",{unavailable:(0,N.TA)(e)}),filters:S,tableName:"nodes"})},H=e=>{let{parentRef:t,...a}=e;const[o]=(0,r.yu)(n.Qy);return o?(0,E.jsx)(G,{parentRef:t,...a}):(0,E.jsx)(R,{...a})}},72427:(e,t,a)=>{a.d(t,{O:()=>I});var n=a(73878),r=a(23795),o=a(14561),s=a(55982),l=a(98779),i=a(62508),d=a(67653),u=a(74116),c=a(59907),p=a(46878),h=a(65e3),m=a(6215),b=a(9038),g=a(27810),y=a(14075),v=a(70340),x=a(55842),w=a(75544),T=a(37711);const f=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill-header":"Restart tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet"}'),j=(0,T.wZ)("ydb-tablets",{en:f});var N=a(10161);function C(e){let{database:t}=e;return[{name:"Type",width:150,get header(){return j("Type")},render:e=>{let{row:t}=e;const a=!1===t.Leader;return(0,N.jsxs)("span",{children:[t.Type," ",a?(0,N.jsx)(r.x,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return j("Tablet")},render:e=>{var a;let{row:n}=e;if(!n.TabletId)return g.jX;const r=(0,p.fK)(n.TabletId,{nodeId:n.NodeId,type:n.Type,tenantName:t});return(0,N.jsx)(i.A,{name:null===(a=n.TabletId)||void 0===a?void 0:a.toString(),path:r,hasClipboardButton:!0,showStatus:!1,additionalControls:(0,N.jsx)(l.Q,{href:(0,v.wz)(n.TabletId)})})}},{name:"State",get header(){return j("State")},render:e=>{let{row:t}=e;return(0,N.jsx)(c.f,{state:t.State})}},{name:"NodeId",get header(){return j("Node ID")},render:e=>{let{row:t}=e;const a=void 0===t.NodeId?void 0:(0,w.a3)(t.NodeId);return(0,N.jsx)(d.h,{to:a,children:t.NodeId})},align:"right"},{name:"fqdn",get header(){return j("Node FQDN")},render:e=>{let{row:t}=e;return t.fqdn?(0,N.jsx)(i.A,{name:t.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,N.jsx)("span",{children:"\u2014"})}},{name:"Generation",get header(){return j("Generation")},align:"right"},{name:"Uptime",get header(){return j("Uptime")},render:e=>{let{row:t}=e;return(0,y.fG)(t.ChangeTime)},sortAccessor:e=>-Number(e.ChangeTime),align:"right"},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:e=>{let{row:t}=e;return(0,N.jsx)(S,{...t})}}]}function S(e){const t=e.State===b.g.Stopped,a=(0,x.ix)(h.VH),[r]=m._.useKillTabletMutation(),l=e.TabletId;return l?(0,N.jsx)(s.U,{buttonView:"outlined",dialogHeader:j("dialog.kill-header"),dialogText:j("dialog.kill-text"),onConfirmAction:()=>r({id:l}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:j("controls.kill-not-allowed"),popoverDisabled:a,children:(0,N.jsx)(o.J,{data:n.Z})}):null}function I(e){let{database:t,tablets:a,className:n}=e;return(0,N.jsx)(u.G,{wrapperClassName:n,columns:C({database:t}),data:a,settings:g.LE,emptyDataMessage:j("noTabletsData")})}},88366:(e,t,a)=>{a.d(t,{k:()=>o});var n=a(78759),r=a(16124);const o=n.h.injectEndpoints({endpoints:e=>({getNodes:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getNodes({type:"any",storage:!1,tablets:!0,...e},{signal:a});return{data:(0,r.n)(t)}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"})},6215:(e,t,a)=>{a.d(t,{_:()=>r});var n=a(96183);const r=a(78759).h.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async(e,t)=>{let{id:a,database:r,nodeId:o}=e,{signal:s}=t;try{const[e,t,l]=await Promise.all([window.api.getTablet({id:a,database:r,nodeId:o},{signal:s}),window.api.getTabletHistory({id:a,database:r,nodeId:o},{signal:s}),window.api.getNodesList({signal:s})]),i=(0,n.Xs)(l),d=Object.keys(t).reduce(((e,a)=>{var n;const r=null===(n=t[a])||void 0===n?void 0:n.TabletStateInfo;if(r&&r.length){const t=r.find((e=>e.Leader))||r[0],{ChangeTime:n,Generation:o,State:s,Leader:l,FollowerId:d}=t,u=i&&a?i.get(Number(a)):void 0;"Dead"!==s&&e.push({nodeId:a,generation:o,changeTime:n,state:s,leader:l,followerId:d,fqdn:u})}return e}),[]),{TabletStateInfo:u=[]}=e,[c={}]=u,{TabletId:p}=c;return{data:{id:p,data:c,history:d}}}catch(l){return{error:l}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async(e,t)=>{let{tenantId:a}=e,{signal:n}=t;try{const e=await window.api.getTabletDescribe(a,{signal:n}),{SchemeShard:t,PathId:r}=a;return{data:(null===e||void 0===e?void 0:e.Path)||`${t}:${r}`}}catch(r){return{error:r}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async(e,t)=>{let{id:a,hiveId:n}=e,{signal:r}=t;try{return{data:await window.api.getTabletFromHive({id:a,hiveId:n},{signal:r})}}catch(o){return{error:o}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async e=>{let{id:t}=e;try{return{data:await window.api.killTablet(t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.stopTablet(t,a)}}catch(n){return{error:n}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async e=>{let{id:t,hiveId:a}=e;try{return{data:await window.api.resumeTablet(t,a)}}catch(n){return{error:n}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})}}]);