(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[80698],{2680:(e,n,s)=>{var t=s(43665),a=s(81061),r=s(28293),o=s(19305);e.exports=function(e,n){return function(s,l){var i=o(s)?t:a,c=n?n():{};return i(s,e,r(l,2),c)}}},2796:(e,n,s)=>{"use strict";s.d(n,{A:()=>a});var t=s(59284);const a=e=>t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),t.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M1.25 8A.75.75 0 0 1 2 7.25h10.19L9.47 4.53a.75.75 0 0 1 1.06-1.06l4 4a.75.75 0 0 1 0 1.06l-4 4a.75.75 0 1 1-1.06-1.06l2.72-2.72H2A.75.75 0 0 1 1.25 8",clipRule:"evenodd"}))},36388:(e,n,s)=>{"use strict";s.d(n,{A:()=>a});var t=s(59284);const a=e=>t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),t.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 13.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14m1-4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0M8.75 5a.75.75 0 0 0-1.5 0v2.5a.75.75 0 0 0 1.5 0z",clipRule:"evenodd"}))},42655:(e,n,s)=>{"use strict";s.d(n,{y:()=>d});var t=s(59284),a=s(1608),r=s(77506),o=s(66781),l=s(60712);const i=(0,r.cn)("ydb-info-viewer-skeleton"),c=()=>(0,l.jsxs)("div",{className:i("label"),children:[(0,l.jsx)(a.E,{className:i("label__text")}),(0,l.jsx)("div",{className:i("label__dots")})]}),d=({rows:e=8,className:n,delay:s=600})=>{const[r]=(0,o.y)(s);let d=(0,l.jsxs)(t.Fragment,{children:[(0,l.jsx)(c,{}),(0,l.jsx)(a.E,{className:i("value")})]});return r||(d=null),(0,l.jsx)("div",{className:i(null,n),children:[...new Array(e)].map(((e,n)=>(0,l.jsx)("div",{className:i("row"),children:d},`skeleton-row-${n}`)))})}},43665:e=>{e.exports=function(e,n,s,t){for(var a=-1,r=null==e?0:e.length;++a<r;){var o=e[a];n(t,o,s(o),e)}return t}},44520:(e,n,s)=>{"use strict";s.d(n,{E:()=>C});var t=s(60712),a=s(59284),r=s(62609),o=s(79411);const l=a.createContext(void 0),i=a.createContext(void 0);function c(e){const{size:n,disabled:s,defaultExpanded:r,arrowPosition:c,summary:d,keepMounted:u,onUpdate:m,onSummaryKeyDown:h,expanded:p}=e,[v,x]=a.useState((()=>Boolean(r))),g=void 0!==p,j=(0,o.u)(),f=`disclosure${j}`;return(0,t.jsx)(l.Provider,{value:{size:n,disabled:s,summary:d,arrowPosition:c,keepMounted:u,expanded:g?p:v,ariaControls:j,ariaLabelledby:f,onSummaryKeyDown:h},children:(0,t.jsx)(i.Provider,{value:()=>{x((e=>!e));m(g?!p:!v)},children:e.children})})}function d(){const e=a.useContext(l);if(void 0===e)throw new Error("useDisclosureAttributes must be used within DisclosureProvider");return e}var u=s(72630),m=s(6871);const h=(0,s(10417).om)("disclosure"),p="disclosure-summary",v="disclosure-details";function x({children:e,qa:n,className:s}){const r=a.useRef(null),{ariaControls:o,ariaLabelledby:l,keepMounted:i,expanded:c}=d();return(0,t.jsx)(u.A,{nodeRef:r,in:c,addEndListener:e=>r.current?.addEventListener("animationend",e),classNames:(0,m.L)(h),mountOnEnter:!i,unmountOnExit:!i,appear:!0,children:(0,t.jsx)("div",{ref:r,id:o,role:"region","aria-labelledby":l,className:h("content",{visible:c},s),"data-qa":n||v,children:e})})}x.displayName="DisclosureDetails";var g=s(60461),j=s(52140);const f={m:14,l:16,xl:20};function b(){(0,j.m)('[Disclosure] Physical values (left, right) of "arrowPosition" property are deprecated. Use logical values (start, end) instead.')}function N({children:e,qa:n}){const s=function(){const e=a.useContext(i);if(void 0===e)throw new Error("useToggleDisclosure must be used within DisclosureProvider");return e}(),{ariaControls:r,ariaLabelledby:o,expanded:l,disabled:c,onSummaryKeyDown:u}=d(),m={onClick:s,ariaControls:r,id:o,expanded:l,disabled:c,qa:n,onKeyDown:u};return e(m,(0,t.jsx)(w,{...m}))}const w=a.forwardRef((function({onClick:e,ariaControls:n,id:s,expanded:a,disabled:r,qa:o,onKeyDown:l,className:i},c){const{size:u,summary:m,arrowPosition:v}=d();let x=v;return"left"===x&&(b(),x="start"),"right"===x&&(b(),x="end"),(0,t.jsxs)("button",{type:"button","aria-expanded":a,className:h("trigger",{disabled:r,arrow:x},i),"aria-controls":n,id:s,onClick:e,disabled:r,"data-qa":o||p,onKeyDown:l,ref:c,children:[(0,t.jsx)(g.I,{size:f[u],direction:a?"top":"bottom"}),m]})}));N.displayName="DisclosureSummary";const y=(0,r.g)(N),C=a.forwardRef((function(e,n){const{size:s="m",disabled:r=!1,defaultExpanded:o=!1,arrowPosition:l="start",summary:i="",className:d,keepMounted:u=!0,children:m,onUpdate:p=()=>{},onSummaryKeyDown:v,expanded:g,qa:j}=e,[f,b]=function(e,{disclosureQa:n}){const s=a.Children.toArray(e);let r,o;const l=[];for(const t of s){if(y(t)){if(r)throw new Error("Only one <Disclosure.Summary> component is allowed");r=t}else l.push(t)}l.length>0&&(o=(0,t.jsx)(x,{qa:n&&`${n}-details`,children:l}));r||(r=(0,t.jsx)(N,{qa:n&&`${n}-summary`,children:e=>(0,t.jsx)(w,{...e})}));return[r,o]}(m,{disclosureQa:j});return(0,t.jsx)(c,{disabled:r,defaultExpanded:o,expanded:g,keepMounted:u,size:s,summary:i,arrowPosition:l,onUpdate:p,onSummaryKeyDown:v,children:(0,t.jsxs)("section",{ref:n,className:h({size:s},d),"data-qa":j,children:[f,b]})})}));C.Summary=N,C.Details=x,C.displayName="Disclosure"},45923:(e,n,s)=>{"use strict";s.d(n,{A:()=>a});var t=s(59284);const a=e=>t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),t.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M13.03 10.53a.75.75 0 0 1-1.06 0L8 6.56l-3.97 3.97a.75.75 0 1 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1 0 1.06",clipRule:"evenodd"}))},60448:(e,n,s)=>{"use strict";s.d(n,{p:()=>j});var t=s(59284),a=s(80136),r=s(32752),o=s(24342),l=s(13847),i=s(77506),c=s(48372);const d=JSON.parse('{"action_show_more":"Show {{count}} more","action_hide":"Hide {{count}}","tooltip_nodes":{"one":"{{count}} Node","other":"{{count}} Nodes"}}'),u=(0,c.g4)("ydb-versions-bar",{en:d});var m=s(60712);const h=(0,i.cn)("ydb-versions-bar"),p=4,v=p-1,x=200,g=200;function j({preparedVersions:e,withTitles:n=!0,size:s="s"}){const i=e.length>p&&"s"===s,[c,d]=t.useState(),[j,b]=t.useState(!1),N=t.useMemo((()=>{const n=e.reduce(((e,n)=>e+(n.count||0)),0);return e.map((e=>({value:(e.count||0)/n*100,color:e.color,version:e.version,count:e.count})))}),[e]),w=t.useMemo((()=>j?e:i?e.slice(0,v):e),[j,e,i]),y=e=>{e.preventDefault(),e.stopPropagation(),b(!0)},C=e=>{e.preventDefault(),e.stopPropagation(),b(!1)},E=t.useMemo((()=>(0,l.debounce)((e=>{d(e)}),x)),[]),A=t.useMemo((()=>(E.cancel(),(0,l.debounce)((()=>{d(void 0)}),x))),[E]),D=e=>Boolean(c&&c!==e);return(0,m.jsxs)(r.s,{direction:"column",className:h("bar-wrapper",{size:s}),wrap:!0,children:[(0,m.jsx)(r.s,{className:h("bar",{size:s}),grow:1,children:N.map((e=>(0,m.jsx)(o.m,{content:(0,m.jsxs)(t.Fragment,{children:[u("tooltip_nodes",{count:e.count}),(0,m.jsx)("br",{}),e.version]}),placement:"m"===s?"auto":"top-start",openDelay:g,children:(0,m.jsx)("span",{onMouseEnter:()=>{E(e.version)},onMouseLeave:A,className:h("version",{dimmed:D(e.version),size:s}),style:{backgroundColor:e.color,width:`${e.value}%`}})},e.version)))}),n&&(0,m.jsxs)(r.s,{className:h("titles-wrapper",{size:s}),children:[w.map((e=>(0,m.jsx)(f,{version:e.version,color:e.color||"",count:e.count,isDimmed:D(e.version),onMouseEnter:()=>{E(e.version)},onMouseLeave:A,size:s},e.version))),(()=>{if(!i)return null;const n=e.length-v;return j?(0,m.jsx)(a.$,{view:"flat-secondary",size:"s",onClick:C,className:h("button"),children:u("action_hide",{count:n})}):(0,m.jsx)(a.$,{view:"flat-secondary",size:"s",onClick:y,className:h("button"),children:u("action_show_more",{count:n})})})()]})]})}function f({version:e,color:n,count:s,isDimmed:t,onMouseEnter:a,onMouseLeave:l,size:i}){return(0,m.jsx)(o.m,{content:u("tooltip_nodes",{count:s}),placement:"bottom-end",openDelay:g,children:(0,m.jsxs)(r.s,{alignItems:"center",className:h("title",{size:i}),children:[(0,m.jsx)(b,{size:i,dimmed:t,color:n}),(0,m.jsx)("div",{className:h("title-text",{dimmed:t,size:i}),onMouseEnter:a,onMouseLeave:l,children:e})]})})}function b({size:e,dimmed:n,color:s}){const t="m"===e?8:6,a=t/2;return(0,m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:`0 0 ${t} ${t}`,fill:"none",className:h("version-icon",{dimmed:n}),children:(0,m.jsx)("circle",{cx:a,cy:a,r:a,fill:s})})}},65318:(e,n,s)=>{"use strict";s.r(n),s.d(n,{Cluster:()=>as});var t=s(59284),a=s(1608),r=s(96727),o=s(29859),l=s(66212),i=s(61750),c=s(10755),d=s(80987),u=s(90053),m=s(89898),h=s(37477),p=s(97677),v=s(44294),x=s(55340),g=s(78321),j=s(92459),f=s(67028),b=s(67298),N=s(40174),w=s(54090),y=s(51114),C=s(77506),E=s(47779),A=s(12888),D=s(81188),S=s(61323),T=s(49348),I=s(1349),k=s(88616),_=s(93381),P=s(65872),M=s(64470),O=s(4557),V=s(80136),z=s(47653),R=s(15151),L=s(28539),B=s(44508),G=s(19280),H=s(48295),U=s(32935),W=s(35400),q=s(95963),$=s(69326),J=s(90101),K=s(32752),Z=s(44526),F=s(17253),Q=s(10508),Y=s(25196),X=s(63719),ee=s(60712);function ne({tenant:e,additionalTenantsProps:n}){const s=(0,A.X)(),t=((e,n)=>{var s;if("function"!==typeof(null===n||void 0===n?void 0:n.prepareTenantBackend))return;let t;const a=null!==(s=e.NodeIds)&&void 0!==s?s:e.sharedNodeIds;a&&a.length>0&&(t=a[Math.floor(Math.random()*a.length)].toString());return n.prepareTenantBackend(t)})(e,n),a=Boolean(t),r=(0,Z.f)(n,null===e||void 0===e?void 0:e.Name,null===e||void 0===e?void 0:e.Type),{monitoring:o}=(0,b.Zd)(),l=(0,F.A)(null===e||void 0===e?void 0:e.ControlPlane,o)?r:r.filter((({title:e})=>e!==(0,X.A)("field_monitoring-link"))),i=l.length>0&&s?(0,ee.jsx)(J.u,{responsive:!0,children:(0,ee.jsx)(J.u.Item,{name:(0,X.A)("field_links"),children:(0,ee.jsx)(K.s,{gap:2,wrap:"wrap",children:l.map((({title:e,url:n})=>(0,ee.jsx)(Y.K,{title:e,url:n},e)))})})}):null;return(0,ee.jsx)(Q.c,{externalLink:a,name:e.Name||(0,X.A)("context_unknown"),withLeftTrim:!0,status:e.Overall,infoPopoverContent:i,hasClipboardButton:!0,path:(0,j.YL)({database:y.J.useDatabaseId?e.Id:e.Name,backend:t},{withBasename:a})})}var se=s(17270),te=s(23536),ae=s.n(te);var re=s(21334),oe=s(42214);const le=re.F.injectEndpoints({endpoints:e=>({getTenantsInfo:e.query({queryFn:async({clusterName:e,isMetaDatabasesAvailable:n},{signal:s})=>{try{let t,a;return t=n&&window.api.meta?await window.api.meta.getTenantsV2({clusterName:e},{signal:s}):window.api.meta?await window.api.meta.getTenants({clusterName:e},{signal:s}):await window.api.viewer.getTenants({clusterName:e},{signal:s}),a=Array.isArray(t.TenantInfo)?(0,oe.T3)(t.TenantInfo):[],{data:a}}catch(t){return{error:t}}},serializeQueryArgs:({queryArgs:e})=>{const{clusterName:n}=e;return{clusterName:n}},providesTags:["All"]})}),overrideExisting:"throw"});var ie=s(12506),ce=s(46549),de=s(76086),ue=s(56839),me=s(28232),he=s(41650),pe=s(48372);const ve=JSON.parse('{"create-database":"Create database","remove":"Remove","edit":"Edit"}'),xe=(0,pe.g4)("ydb-tenants-table",{en:ve});const ge=(0,C.cn)("tenants");const je=({additionalTenantsProps:e,scrollContainerRef:n})=>{const s=(0,me.H)(),a=(0,f.$h)(),[r]=(0,E.Nt)(),{currentData:o,isFetching:l,error:i}=le.useGetTenantsInfoQuery({clusterName:s,isMetaDatabasesAvailable:a},{pollingInterval:r}),c=l&&void 0===o,[u,m]=t.useState(),h=(0,f.sH)()&&void 0!==y.J.onCreateDB,p=(0,f.g7)()&&void 0!==y.J.onEditDB,v=(0,f.TW)()&&void 0!==y.J.onDeleteDB,{search:x,withProblems:g,handleSearchChange:j,handleWithProblemsChange:b}=function(){const[{withProblems:e,search:n},s]=(0,d.useQueryParams)({withProblems:d.BooleanParam,search:d.StringParam}),a=t.useCallback((e=>{s({withProblems:e||void 0},"replaceIn")}),[s]),r=t.useCallback((e=>{s({search:e||void 0},"replaceIn")}),[s]);return{withProblems:Boolean(e),search:n||"",handleWithProblemsChange:a,handleSearchChange:r}}(),[N]=(0,E.iK)(se.GS.SHOW_NETWORK_UTILIZATION),[C]=(0,E.iK)(se.GS.SHOW_DOMAIN_DATABASE),A=t.useMemo((()=>function(e,n){return!n&&e.length>1?e.filter((e=>"Domain"!==e.Type)):e}(null!==o&&void 0!==o?o:[],C)),[o,C]),D=t.useMemo((()=>{const e=function(e,n){return n?e.filter((e=>e.Overall&&e.Overall!==w.m.Green)):e}(A,g),n=function(e,n){return e.filter((e=>{const s=new RegExp(ae()(n),"i");return s.test(e.Name||"")||s.test(e.controlPlaneName)}))}(e,x);return n}),[A,g,x]);return(0,ee.jsx)("div",{className:ge("table-wrapper"),children:(0,ee.jsxs)($.L,{fullHeight:!0,children:[(0,ee.jsx)($.L.Controls,{renderExtraControls:()=>h&&s&&!c?(0,ee.jsxs)(V.$,{view:"action",onClick:()=>{var e;return null===(e=y.J.onCreateDB)||void 0===e?void 0:e.call(y.J,{clusterName:s})},children:[(0,ee.jsx)(z.I,{data:_.A}),xe("create-database")]}):null,children:(0,ee.jsxs)(t.Fragment,{children:[(0,ee.jsx)(q.v,{value:x,onChange:j,placeholder:"Database name",className:ge("search")}),(0,ee.jsx)(U.k,{value:g,onChange:b}),(0,ee.jsx)(L.T,{total:null===A||void 0===A?void 0:A.length,current:(null===D||void 0===D?void 0:D.length)||0,label:"Databases",loading:c})]})}),i?(0,ee.jsx)(B.o,{error:i}):null,(0,ee.jsx)($.L.Table,{scrollContainerRef:n,loading:c,scrollDependencies:[x,g,u],children:o?(()=>{const n=[{name:"Name",header:"Database",render:({row:n})=>(0,ee.jsx)(ne,{tenant:n,additionalTenantsProps:e}),width:440,sortable:!0,defaultOrder:O.Ay.DESCENDING},{name:"controlPlaneName",header:"Name",render:({row:e})=>e.controlPlaneName,width:200,sortable:!0,defaultOrder:O.Ay.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:({row:e})=>"Serverless"!==e.Type?e.Type:(0,ee.jsxs)("div",{className:ge("type"),children:[(0,ee.jsx)("span",{className:ge("type-value"),children:e.Type}),(0,ee.jsx)(V.$,{className:ge("type-button"),onClick:()=>j(e.sharedTenantName||""),children:"Show shared"})]})},{name:"State",width:150,render:({row:e})=>function(e){if(!e)return de.Pd;switch(e){case ie.Uw.STATE_UNSPECIFIED:return"Unspecified";case ie.Uw.PENDING_RESOURCES:return"Pending";default:return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}}(e.State)},{name:"cpu",header:"CPU",width:80,render:({row:e})=>e.cpu&&e.cpu>1e4?(0,ue.iM)(e.cpu):de.Pd,align:O.Ay.RIGHT,defaultOrder:O.Ay.DESCENDING},{name:"memory",header:"Memory",width:120,render:({row:e})=>e.memory?(0,ue.vX)(e.memory):de.Pd,align:O.Ay.RIGHT,defaultOrder:O.Ay.DESCENDING},{name:"storage",header:"Storage",width:120,render:({row:e})=>e.storage?(0,ue.vX)(e.storage):de.Pd,align:O.Ay.RIGHT,defaultOrder:O.Ay.DESCENDING}];if(N&&n.push({name:"Network",header:"Network",width:120,align:O.Ay.RIGHT,defaultOrder:O.Ay.DESCENDING,sortAccessor:({NetworkWriteThroughput:e=0})=>Number(e),render:({row:e})=>{const{NetworkWriteThroughput:n}=e;return(0,he.kf)(n)?(0,ce.z3)({value:n,size:"mb",withSpeedLabel:!0,precision:2}):de.Pd}}),n.push({name:"nodesCount",header:"Nodes",width:100,render:({row:e})=>e.nodesCount?(0,ue.ZV)(e.nodesCount):de.Pd,align:O.Ay.RIGHT,defaultOrder:O.Ay.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:({row:e})=>e.groupsCount?(0,ue.ZV)(e.groupsCount):de.Pd,align:O.Ay.RIGHT,defaultOrder:O.Ay.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:({PoolStats:e=[]})=>e.reduce(((e,n)=>e+(n.Usage||0)),0),defaultOrder:O.Ay.DESCENDING,align:O.Ay.LEFT,render:({row:e})=>(0,ee.jsx)(H._,{pools:e.PoolStats})}),s&&(v||p)){const e=function({clusterName:e,isEditDBAvailable:n,isDeleteDBAvailable:s}){return{name:"actions",header:"",width:40,resizeable:!1,align:O.Ay.CENTER,render:({row:t})=>{const a=[];return"Domain"===t.Type?null:(n&&a.push({text:xe("edit"),iconStart:(0,ee.jsx)(P.A,{}),action:()=>{var n;null===(n=y.J.onEditDB)||void 0===n||n.call(y.J,{clusterName:e,databaseData:t})}}),s&&a.push({text:xe("remove"),iconStart:(0,ee.jsx)(M.A,{}),action:()=>{var n;null===(n=y.J.onDeleteDB)||void 0===n||n.call(y.J,{clusterName:e,databaseData:t})},theme:"danger"}),a.length?(0,ee.jsx)(R.r,{items:a}):null)}}}({clusterName:s,isDeleteDBAvailable:v,isEditDBAvailable:p});n.push(e)}return 0===D.length&&g?(0,ee.jsx)(G.v,{name:"thumbsUp",width:200}):(0,ee.jsx)(W.l,{columnsWidthLSKey:"databasesTableColumnsWidth",data:D,columns:n,settings:de.N3,emptyDataMessage:"No such tenants",onSortChange:m})})():null})]})})};var fe=s(2468),be=s(55111),Ne=s(12207),we=s(88908),ye=s(370),Ce=s(98167),Ee=s(60448),Ae=s(15298),De=s(95109),Se=s(86782);function Te(e){return[(0,De._E)(),(0,De.Nh)(e),(0,De.OV)(),(0,De.jl)(),(0,De.pH)(),(0,De.fr)(),(0,De.ID)()]}const Ie=({nodes:e})=>{const n=(0,f.Z9)(),s=Te({}),t=n?s:s.filter((e=>e.name!==Se.vg.PileName));return(0,ee.jsx)(W.l,{columnsWidthLSKey:"versionsTableColumnsWidth",data:e,columns:t,settings:de.N3})};var ke=s(2796),_e=s(69448),Pe=s(45923),Me=s(13066),Oe=s(49461);const Ve=JSON.parse('{"title_overall":"Overall","title_storage-nodes":"Storage Nodes","title_database-nodes":"Database Nodes","title_other-nodes":"Other Nodes","title_database":"Database","title_version":"Version","nodes-count":{"one":"{{count}} node","other":"{{count}} nodes"},"group-by":"Group by:","action_expand":"Expand all","action_collapse":"Collapse all"}'),ze=(0,pe.g4)("ydb-versions",{en:Ve}),Re=(0,C.cn)("ydb-versions-nodes-tree-title"),Le=({title:e,isDatabase:n,expanded:s,nodes:a,items:r,versionColor:o,preparedVersions:l,onClick:i})=>{const d=(0,c.W6)(),u=t.useCallback((e=>{e.nativeEvent.composedPath().some(Be)||null===i||void 0===i||i()}),[i]),m=t.useMemo((()=>r?r.reduce(((e,n)=>n.nodes?e+n.nodes.length:e),0):a?a.length:0),[r,a]);return(0,ee.jsxs)("div",{className:Re("overview"),onClick:u,children:[(0,ee.jsxs)(K.s,{gap:2,alignItems:"center",children:[o&&!n?(0,ee.jsx)("div",{className:Re("version-color"),style:{background:o}}):null,n?(0,ee.jsx)(z.I,{data:_e.A}):null,e?(0,ee.jsxs)(t.Fragment,{children:[e,(0,ee.jsx)(Oe.b,{text:e,size:"s",className:Re("clipboard-button"),view:"flat"})]}):null,n?(0,ee.jsxs)(V.$,{size:"s",onClick:()=>d.push((0,j.YL)({database:e,diagnosticsTab:"nodes"})),children:[ze("nodes-count",{count:m}),(0,ee.jsx)(z.I,{data:ke.A})]}):(0,ee.jsx)(we.E,{variant:"body-2",color:"hint",children:ze("nodes-count",{count:m})})]}),(0,ee.jsxs)(K.s,{alignItems:"center",gap:4,children:[n&&l?(0,ee.jsx)("div",{className:Re("version-progress"),children:(0,ee.jsx)(Ee.p,{preparedVersions:l,withTitles:!1})}):null,(0,ee.jsx)(z.I,{className:Re("icon"),data:s?Pe.A:Me.A})]})]})};function Be(e){return e instanceof HTMLElement&&("BUTTON"===e.nodeName&&!e.hasAttribute("disabled")&&"true"!==e.getAttribute("aria-disabled")||e.hasAttribute("tabindex")&&e.tabIndex>-1)}const Ge=(0,C.cn)("ydb-versions-block"),He=({expanded:e,renderHeader:n,renderContent:s})=>(0,ee.jsxs)("div",{className:Ge(null),children:[n(),e?(0,ee.jsx)(K.s,{direction:"column",className:Ge("content"),children:s()}):null]}),Ue=(0,C.cn)("ydb-versions-grouped-node-tree"),We=({title:e,isDatabase:n,nodes:s,items:a,expanded:r=!1,versionColor:o,preparedVersions:l})=>{const[i,c]=t.useState(!1);t.useEffect((()=>{c(r)}),[r]);const d=()=>{c((e=>!e))};return(0,ee.jsx)("div",{className:Ue("wrapper"),children:(0,ee.jsx)(He,{expanded:i,renderHeader:()=>(0,ee.jsx)(Le,{title:e,isDatabase:n,expanded:i,nodes:s,items:a,versionColor:o,preparedVersions:l,onClick:d}),renderContent:()=>a?null===a||void 0===a?void 0:a.map(((e,n)=>(0,ee.jsx)(We,{title:e.title,isDatabase:e.isDatabase,nodes:e.nodes,expanded:r,versionColor:e.versionColor,preparedVersions:e.preparedVersions},n))):(0,ee.jsx)(Ie,{nodes:s||[]})})})};var qe=s(78018),$e=s.n(qe),Je=s(78034),Ke=s(66592),Ze=s(38596),Fe=s(20564);const Qe=(e=[],n)=>{const s=e.reduce(((e,n)=>(n.Version&&(e[n.Version]?e[n.Version]=e[n.Version]+1:e[n.Version]=1),e)),{}),t=Object.keys(s).map((e=>{const t=(0,Ze.U)(e),a=null===n||void 0===n?void 0:n.get(t);return{title:e,version:e,count:s[e],minorVersion:t,...a}}));return(0,Fe.M)(t)};function Ye(e,n){const s=e.map((e=>{const s=(0,Ze.U)(e.name),t=null===n||void 0===n?void 0:n.get(s);return{title:e.name,version:e.name,count:e.count,minorVersion:s,...t}}));return(0,Fe.M)(s)}let Xe=function(e){return e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage",e}({});const en=(e,n)=>{var s;return(null===(s=e.title)||void 0===s?void 0:s.localeCompare(n.title||""))||-1},nn=(e,n,s)=>{if(e&&e.length){if(s===Xe.VERSION){const s=$e()(e,"Version");return Object.keys(s).map((e=>{const t=s[e].filter(Je.lv),a=$e()(t,"Tenants"),r=Object.keys(a).map((e=>({title:e,isDatabase:!0,nodes:a[e]}))).sort(en);return r.length?{title:e,items:r,versionColor:(0,Ke.xH)(e,n)}:null})).filter((e=>Boolean(e)))}{const s=e.filter(Je.lv),t=$e()(s,"Tenants");return Object.keys(t).map((e=>{const s=Qe(t[e],n),a=$e()(t[e],"Version"),r=Object.keys(a).map((e=>({title:e,nodes:a[e],versionColor:(0,Ke.xH)(e,n)})));return r.length?{title:e,isDatabase:!0,items:r,preparedVersions:s}:null})).filter((e=>Boolean(e))).sort(en)}}},sn=(e,n)=>{if(!e||!e.length)return;const s=e.filter(Je.wH),t=$e()(s,"Version");return Object.keys(t).map((e=>({title:e,nodes:t[e],versionColor:(0,Ke.xH)(e,n)})))},tn=(e,n)=>{if(!e||!e.length)return;const s=e.filter((e=>!(0,Je.wH)(e)&&!(0,Je.lv)(e)&&e.Version)),t=$e()(s,"Version");return Object.keys(t).map((e=>({title:e,nodes:t[e],versionColor:(0,Ke.xH)(e,n)})))};var an=s(4980),rn=s(39567),on=s(98730),ln=s(21691);function cn(e){const n=function(){const[e]=(0,d.useQueryParam)("clusterName",d.StringParam),n=(0,E.N4)((e=>e.singleClusterMode)),{data:s}=rn.ub.useGetClustersListQuery(void 0,{skip:n});return t.useMemo((()=>{if(n)return;const t=(s||[]).find((n=>n.name===e)),a=(null===t||void 0===t?void 0:t.versions)||[];return()=>(0,ln.kG)((0,ln.HD)(a))}),[n,s,e])}();return t.useMemo((()=>n?n():(0,Ke.jh)(null===e||void 0===e?void 0:e.Versions)),[null===e||void 0===e?void 0:e.Versions,n])}const dn=(0,C.cn)("ydb-versions");function un({cluster:e,loading:n}){const[s]=(0,E.Nt)(),{currentData:a,isLoading:r}=Ae.s.useGetNodesQuery({tablets:!1,fieldsRequired:["SystemState","SubDomainKey"]},{pollingInterval:s}),o=cn(e),l=function({cluster:e,versionsDataMap:n,clusterLoading:s}){const{currentData:a}=Ae.s.useGetNodesQuery((0,on.LH)(e)||s?an.hT:{tablets:!1,fieldsRequired:["SystemState","SubDomainKey"],group:"Version"});return t.useMemo((()=>(0,on.LH)(e)&&e.MapVersions?Ye(Object.entries(e.MapVersions).map((([e,n])=>({name:e,count:n}))),n):a?Array.isArray(a.tableGroups)?Ye(a.tableGroups,n):Qe(a.nodes,n):[]),[a,n,e])}({cluster:e,versionsDataMap:o,clusterLoading:n});return(0,ee.jsx)(Ce.r,{loading:n||r,children:(0,ee.jsx)(hn,{preparedVersions:l,nodes:null===a||void 0===a?void 0:a.nodes,versionsDataMap:o})})}const mn=ye.z.nativeEnum(Xe).catch(Xe.VERSION);function hn({preparedVersions:e,nodes:n,versionsDataMap:s}){const[{groupBy:a},r]=(0,d.useQueryParams)({groupBy:d.StringParam}),o=mn.parse(a),l=t.useMemo((()=>nn(n,s,o)),[o,n,s]),i=t.useMemo((()=>sn(n,s)),[n,s]),c=t.useMemo((()=>tn(n,s)),[n,s]);return(0,ee.jsxs)(K.s,{className:dn(),direction:"column",gap:6,children:[(0,ee.jsxs)(K.s,{gap:3,direction:"column",className:dn("overall"),children:[(0,ee.jsx)(we.E,{variant:"subheader-3",children:ze("title_overall")}),(0,ee.jsx)(Ee.p,{preparedVersions:e,size:"m"})]}),(0,ee.jsx)(pn,{sectionTitle:ze("title_storage-nodes"),nodes:i}),(0,ee.jsx)(pn,{sectionTitle:ze("title_database-nodes"),nodes:l,renderControls:()=>{const e=[{value:Xe.TENANT,content:ze("title_database")},{value:Xe.VERSION,content:ze("title_version")}];return(0,ee.jsx)(Ne.l,{label:ze("group-by"),value:[o],options:e,onUpdate:e=>{return n=e[0],void r({groupBy:n},"replaceIn");var n},width:200,size:"m"})}}),(0,ee.jsx)(pn,{sectionTitle:ze("title_other-nodes"),nodes:c})]})}function pn({sectionTitle:e,renderControls:n,nodes:s}){const[a,r]=t.useState(!1);if(null===s||void 0===s||!s.length)return null;return(0,ee.jsxs)(K.s,{gap:3,direction:"column",children:[(0,ee.jsxs)(K.s,{justifyContent:"space-between",children:[(0,ee.jsxs)(K.s,{gap:3,children:[(0,ee.jsx)(we.E,{variant:"subheader-3",children:e}),null===n||void 0===n?void 0:n()]}),(0,ee.jsxs)(V.$,{onClick:()=>r((e=>!e)),children:[(0,ee.jsx)(z.I,{data:a?fe.A:be.A}),ze(a?"action_collapse":"action_expand")]})]}),s.map((({title:e,isDatabase:n,nodes:s,items:t,versionColor:r,preparedVersions:o})=>(0,ee.jsx)(We,{title:e,isDatabase:n,nodes:s,items:t,versionColor:r,expanded:a,preparedVersions:o},e)))]})}var vn=s(44520),xn=s(7435),gn=s(80967),jn=s(42655),fn=s(52443),bn=s(91611);const Nn=(0,C.cn)("bridge-info-table");const wn=t.memo((function({pile:e}){const n=t.useCallback((()=>{if(!e.State)return de.Pd;const n=function(e){if(!e)return"unknown";switch(e.toUpperCase()){case on.tI.PRIMARY:case on.tI.PROMOTED:case on.tI.SYNCHRONIZED:return"success";case on.tI.NOT_SYNCHRONIZED:return"warning";case on.tI.SUSPENDED:case on.tI.DISCONNECTED:return"danger";case on.tI.UNSPECIFIED:default:return"unknown"}}(e.State);return(0,ee.jsx)(fn.J,{theme:n,children:e.State})}),[e.State]),s=t.useMemo((()=>[{name:(0,bn.A)("field_state"),content:n()},{name:(0,bn.A)("field_nodes"),content:void 0===e.Nodes?de.Pd:(0,ue.ZV)(e.Nodes)}]),[n,e.Nodes]);return(0,ee.jsxs)(K.s,{direction:"column",gap:3,className:Nn("pile-card"),children:[(0,ee.jsx)(we.E,{variant:"body-2",children:e.Name||de.Pd}),(0,ee.jsx)(J.u,{nameMaxWidth:160,children:s.map((({name:e,content:n})=>(0,ee.jsx)(J.u.Item,{name:e,children:n},e)))})]})})),yn=t.memo((function({piles:e}){const n=t.useMemo((()=>e.map(((e,n)=>{var s;return(0,ee.jsx)(wn,{pile:e},null!==(s=e.PileId)&&void 0!==s?s:n)}))),[e]);return(0,ee.jsx)(K.s,{gap:2,className:Nn(),children:n})}));var Cn=s(87842);const En=(0,C.cn)("cluster-info");var An=s(15132);const Dn=({tags:e,className:n="",gap:s=1})=>(0,ee.jsx)(K.s,{className:n,gap:s,wrap:"wrap",alignItems:"center",children:e&&e.map(((e,n)=>(0,ee.jsx)(fn.J,{size:"s",children:e},n)))});var Sn=s(96344),Tn=s(35736);const In=(0,C.cn)("ydb-disk-groups-stats"),kn={good:"success",warning:"warning",danger:"danger"};function _n({stats:e,storageType:n}){const{erasure:s,allocatedSize:t,availableSize:a}=e,r=(0,ce.fn)(Math.max(t,a)),o=(0,ce.z3)({value:t,size:r}),l=(0,ce.z3)({value:a,size:r}),i=Math.floor(t/(t+a)*100),c=[{name:(0,bn.A)("erasure"),content:s},{name:(0,bn.A)("allocated"),content:o},{name:(0,bn.A)("available"),content:l},{name:(0,bn.A)("usage"),content:(0,ee.jsxs)(K.s,{gap:2,alignItems:"center",children:[(0,ee.jsx)(Sn.k,{theme:kn[(0,Tn.w)({fillWidth:i})],className:In("progress"),value:i,size:"s"}),(0,ee.jsxs)(we.E,{color:"secondary",children:[i,"%"]})]})}];return(0,ee.jsxs)(K.s,{direction:"column",gap:3,className:In(),children:[(0,ee.jsxs)(we.E,{variant:"body-2",children:[n," ",(0,ee.jsx)(we.E,{color:"secondary",variant:"body-2",children:`${(0,ue.ZV)(e.createdGroups)} ${(0,bn.A)("context_of")} ${(0,ue.ZV)(e.totalGroups)}`})]}),(0,ee.jsx)(J.u,{nameMaxWidth:160,children:c.map((({name:e,content:n})=>(0,ee.jsx)(J.u.Item,{name:e,children:n},e)))})]})}const Pn={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},Mn=(e,n)=>{var s;const a=[],r=(e=>{if((0,on.LH)(e)&&e.MapDataCenters)return Object.entries(e.MapDataCenters).map((([e,n])=>(0,ee.jsxs)(t.Fragment,{children:[e," : ",(0,ue.ZV)(n)]},e)))})(e);if(null!==r&&void 0!==r&&r.length&&a.push({label:(0,bn.A)("label_dc"),value:(0,ee.jsx)(Dn,{tags:r,gap:2,className:En("dc")})}),(0,on.LH)(e)&&e.MapNodeStates){const n=Object.entries(e.MapNodeStates);n.sort(((e,n)=>Pn[n[0]]-Pn[e[0]]));const s=n.map((([e,n])=>(0,ee.jsx)(h.c.Label,{withStatusName:!1,status:e,size:"s",iconSize:12,children:(0,ue.ZV)(n)},e)));a.push({label:(0,bn.A)("label_nodes-state"),value:(0,ee.jsx)(K.s,{gap:2,children:s})})}return a.push({label:(0,bn.A)("label_load"),value:(0,ee.jsx)(An.O,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null!==(s=null===e||void 0===e?void 0:e.RealNumberOfCpus)&&void 0!==s?s:null===e||void 0===e?void 0:e.NumberOfCpus})}),a.push(...n),a};const On=({cluster:e,loading:n,error:s,additionalClusterProps:a={},groupStats:r={},bridgePiles:o})=>{const{info:l=[],links:i=[]}=a,c=function(){const{cores:e,logging:n}=(0,b.Zd)();return t.useMemo((()=>{const s=[];return null!==e&&void 0!==e&&e.url&&s.push({title:(0,bn.A)("link_cores"),url:null===e||void 0===e?void 0:e.url}),null!==n&&void 0!==n&&n.url&&s.push({title:(0,bn.A)("link_logging"),url:null===n||void 0===n?void 0:n.url}),null!==n&&void 0!==n&&n.slo_logs_url&&s.push({title:(0,bn.A)("link_slo-logs"),url:n.slo_logs_url}),s}),[e,n])}(),d=i.concat(c),u=Mn(null!==e&&void 0!==e?e:{},l),m=()=>n?(0,ee.jsx)(jn.y,{className:En("skeleton"),rows:4}):s&&!e?null:(0,ee.jsxs)(J.u,{nameMaxWidth:200,children:[u.map((({label:e,value:n})=>(0,ee.jsx)(J.u.Item,{name:e,children:n},e))),d.length>0&&(0,ee.jsx)(J.u.Item,{name:(0,bn.A)("title_links"),children:(0,ee.jsx)(K.s,{direction:"column",gap:2,children:d.map((({title:e,url:n})=>(0,ee.jsx)(Y.K,{title:e,url:n},e)))})})]}),h=(0,Cn.lq)(r);return(0,ee.jsxs)(K.s,{gap:4,direction:"column",className:En(),children:[s?(0,ee.jsx)(B.o,{error:s,className:En("error")}):null,(0,ee.jsxs)(Vn,{children:[(0,ee.jsx)(we.E,{as:"div",variant:"subheader-2",className:En("section-title"),children:(0,bn.A)("title_details")}),m()]}),(()=>{const e=function(e){const n=[];return Object.entries(e).forEach((([e,s])=>{Object.values(s).forEach((s=>{n.push((0,ee.jsx)(_n,{stats:s,storageType:e},`${e}|${s.erasure}`))}))})),n}(r);return n?null:(0,ee.jsx)(Vn,{children:(0,ee.jsxs)(K.s,{gap:6,width:"full",children:[(0,ee.jsxs)(K.s,{direction:"column",gap:2,children:[(0,ee.jsxs)(we.E,{as:"div",variant:"subheader-2",className:En("section-title"),children:[(0,bn.A)("title_storage-groups")," ",(0,ee.jsx)(we.E,{variant:"subheader-2",color:"secondary",children:(0,ue.ZV)(h)})]}),(0,ee.jsx)(K.s,{gap:2,children:e})]}),null!==o&&void 0!==o&&o.length?(0,ee.jsxs)(K.s,{direction:"column",gap:2,className:En("bridge-table"),children:[(0,ee.jsxs)(we.E,{as:"div",variant:"subheader-2",className:En("section-title"),children:[(0,bn.A)("title_bridge")," ",(0,ee.jsx)(we.E,{variant:"subheader-2",color:"secondary",children:(0,ue.ZV)(o.length)})]}),(0,ee.jsx)(yn,{piles:o})]}):null]})})})()]})};function Vn({children:e}){return(0,ee.jsx)(K.s,{direction:"column",gap:3,children:e})}var zn=s(21049),Rn=s(70043);const Ln=(0,C.cn)("ydb-cluster-dashboard"),Bn={good:w.m.Green,warning:w.m.Yellow,danger:w.m.Red};function Gn({children:e,className:n,collapsed:s}){return(0,ee.jsx)(K.s,{gap:"6",alignItems:"center",className:Ln("card",{collapsed:s},n),children:e})}function Hn({title:e,children:n,legend:s,collapsed:t,...a}){const{main:r,secondary:o,note:l}=s;if(t){const{status:n,fillWidth:s}=a,t=s.toFixed(s>0?0:1);return(0,ee.jsx)(h.c.Label,{withStatusName:!1,status:Bn[n],children:`${e} : ${t}%`})}return(0,ee.jsxs)(Gn,{children:[(0,ee.jsx)(zn.e,{...a,children:n}),(0,ee.jsxs)("div",{className:Ln("legend-wrapper"),children:[r&&(0,ee.jsx)(zn.e.Legend,{children:r}),o&&(0,ee.jsx)(zn.e.Legend,{color:"secondary",note:l,variant:"body-1",children:o})]})]})}function Un({collapsed:e}){return(0,ee.jsx)(Gn,{className:Ln("skeleton-wrapper"),collapsed:e,children:(0,ee.jsx)(Rn.E,{className:Ln("skeleton")})})}function Wn({collapsed:e}){return(0,ee.jsxs)(t.Fragment,{children:[(0,ee.jsx)(Un,{collapsed:e}),(0,ee.jsx)(Un,{collapsed:e}),(0,ee.jsx)(Un,{collapsed:e})]})}var qn,$n=s(57428),Jn=s(18836);function Kn({collapsed:e,value:n,capacity:s,...t}){const{status:a,percents:r,legend:o,fill:l}=(0,Jn.s)({value:n,capacity:s,legendFormatter:$n.vs,...t});return(0,ee.jsx)(Hn,{collapsed:e,status:a,fillWidth:l,title:(0,bn.A)("title_cpu"),legend:{main:o,secondary:(0,bn.A)("context_cpu"),note:(0,bn.A)("context_cpu-description")},children:(0,ee.jsx)(zn.e.Value,{children:r})})}function Zn({value:e,capacity:n,collapsed:s,...t}){const{status:a,percents:r,legend:o,fill:l}=(0,Jn.s)({value:e,capacity:n,legendFormatter:$n.cO,...t});return(0,ee.jsx)(Hn,{status:a,fillWidth:l,title:(0,bn.A)("title_memory"),collapsed:s,legend:{main:o,secondary:(0,bn.A)("context_memory"),note:(0,bn.A)("context_memory-description")},children:(0,ee.jsx)(zn.e.Value,{children:r})})}function Fn({percentsValue:e,throughput:n,collapsed:s,...t}){const[a]=(0,gn.i)(se.GS.SHOW_NETWORK_UTILIZATION);if(!a)return null;const{status:r,percents:o,fill:l}=(0,Jn.v)({fillWidth:100*e,...t}),i=(c=n,(0,ce.z3)({value:c,withSpeedLabel:!0}));var c;return(0,ee.jsx)(Hn,{status:r,fillWidth:l,title:(0,bn.A)("title_network"),collapsed:s,legend:{main:i,secondary:(0,bn.A)("context_network"),note:(0,bn.A)("context_network-description")},children:(0,ee.jsx)(zn.e.Value,{children:o})})}function Qn({value:e,capacity:n,groups:s,collapsed:t,...a}){const{status:r,percents:o,legend:l,fill:i}=(0,Jn.s)({value:e,capacity:n,legendFormatter:$n.cO,...a});return(0,ee.jsx)(Hn,{status:r,fillWidth:i,title:(0,bn.A)("title_storage"),collapsed:t,legend:{main:l,secondary:(0,bn.A)("context_storage",{count:s}),note:(0,bn.A)("context_storage-description")},children:(0,ee.jsx)(zn.e.Value,{children:o})})}function Yn(){return Yn=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var t in s)({}).hasOwnProperty.call(s,t)&&(e[t]=s[t])}return e},Yn.apply(null,arguments)}const Xn=function(e){return t.createElement("svg",Yn({viewBox:"0 0 16 15"},e),qn||(qn=t.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.98 1.826a.75.75 0 00-.96-1.152L10.376 3.71a1.25 1.25 0 01-1.196.225l-2.155-.718a2.75 2.75 0 00-2.973.837L.926 7.767a.75.75 0 101.148.966l3.125-3.712a1.25 1.25 0 011.352-.38l2.155.718a2.75 2.75 0 002.63-.496l3.644-3.037zM13.5 8h-2a.5.5 0 00-.5.5V13a.5.5 0 00.5.5h2a.5.5 0 00.5-.5V8.5a.5.5 0 00-.5-.5zm-4 5a.5.5 0 01-.5.5H7a.5.5 0 01-.5-.5v-2.5A.5.5 0 017 10h2a.5.5 0 01.5.5V13zM5 13a.5.5 0 01-.5.5h-2A.5.5 0 012 13v-.5a.5.5 0 01.5-.5h2a.5.5 0 01.5.5v.5zm-2.5 2h11a2 2 0 002-2V8.5a2 2 0 00-2-2h-2a2 2 0 00-2 2v.063A2.004 2.004 0 009 8.5H7a2 2 0 00-2 2v.063a2.005 2.005 0 00-.5-.063h-2a2 2 0 00-2 2v.5a2 2 0 002 2z",fill:"currentColor"})))};function es(e){const[n,s]=(0,gn.i)(se.GS.EXPAND_CLUSTER_DASHBOARD),a=(0,f.Z9)(),r=t.useMemo((()=>{var n;if(!a||!(0,on.E5)(e.cluster))return;const{BridgeInfo:s}=e.cluster;return null!==s&&void 0!==s&&null!==(n=s.Piles)&&void 0!==n&&n.length?s.Piles:void 0}),[e.cluster,a]);return e.error?(0,ee.jsx)(B.o,{error:e.error,className:Ln("error")}):(0,ee.jsx)(vn.E,{arrowPosition:"end",size:"l",expanded:n,onUpdate:()=>s(!n),className:Ln("overview-wrapper",{collapsed:!n}),summary:(0,ee.jsxs)(K.s,{alignItems:"center",justifyContent:"space-between",width:"100%",className:Ln("disclosure-summary"),children:[(0,ee.jsxs)(K.s,{gap:2,alignItems:"center",children:[(0,ee.jsx)(z.I,{data:Xn,size:16}),(0,ee.jsx)(we.E,{variant:"body-2",color:"primary",className:Ln("title"),children:(0,bn.A)("label_overview")})]}),!n&&(0,ee.jsx)(ns,{...e,collapsed:!0})]}),children:(0,ee.jsxs)("div",{className:Ln("disclosure-content"),children:[(0,ee.jsx)(ns,{...e}),(0,ee.jsx)(On,{...e,bridgePiles:r})]})})}function ns({collapsed:e,...n}){return(0,f.fp)()?(0,ee.jsx)(K.s,{wrap:!0,className:Ln("dashboard-wrapper",{collapsed:e}),children:(0,ee.jsx)(ss,{...n,collapsed:e})}):null}function ss({cluster:e,groupStats:n={},loading:s,collapsed:t}){if(s)return(0,ee.jsx)(Wn,{collapsed:t});const a=[];if((0,on.LH)(e)){const{CoresUsed:n,NumberOfCpus:s,CoresTotal:r}=e,o=null!==r&&void 0!==r?r:s;(0,xn.f8)(n)&&(0,xn.f8)(o)&&a.push((0,ee.jsx)(Kn,{value:n,capacity:o,collapsed:t},"cores"))}const{StorageTotal:r,StorageUsed:o}=e;if((0,xn.f8)(r)&&(0,xn.f8)(o)){const e=(0,Cn.lq)(n);a.push((0,ee.jsx)(Qn,{value:o,capacity:r,groups:e,collapsed:t},"storage"))}const{MemoryTotal:l,MemoryUsed:i}=e;if((0,xn.f8)(l)&&(0,xn.f8)(i)&&a.push((0,ee.jsx)(Zn,{value:i,capacity:l,collapsed:t},"memory")),(0,on.E5)(e)){const{NetworkUtilization:n,NetworkWriteThroughput:s}=e;(0,xn.f8)(n)&&a.push((0,ee.jsx)(Fn,{percentsValue:n,throughput:s,collapsed:t},"network"))}return a}const ts=(0,C.cn)("ydb-cluster");function as({additionalClusterProps:e,additionalTenantsProps:n}){var s;const C=t.useRef(null),_=(0,f.fp)(),P=(0,g.s)(),M=(0,Cn.iJ)(),O=(0,A.b)(),V=(0,f.RK)(),z=O&&V,[R]=(0,E.Nt)(),L=(0,E.YQ)(),B=function(){const e=(0,E.YQ)(),n=(0,E.N4)((e=>e.cluster.defaultClusterTab)),s=(0,g.s)(),a=(0,Cn.iJ)(),r=(0,c.W5)(j.Ay.cluster),{activeTab:o}=(null===r||void 0===r?void 0:r.params)||{};let l;const i=!s&&o===Cn.Bi.network,d=!a&&o===Cn.Bi.events;l=i||d?b.Oy:(0,Cn.eC)(o)?o:n;return t.useEffect((()=>{l!==n&&e((0,b.Yv)(l))}),[l,n,e]),l}(),[{clusterName:G,backend:H}]=(0,d.useQueryParams)({clusterName:d.StringParam,backend:d.StringParam}),U=(0,E.N4)((e=>(0,b.zR)(e,null!==G&&void 0!==G?G:void 0))),{title:W}=(0,b.Zd)(),q=null!==W&&void 0!==W?W:U,{data:{clusterData:$,groupsStats:J}={},isLoading:K,error:Z}=b.Zh.useGetClusterInfoQuery(null!==G&&void 0!==G?G:void 0,{pollingInterval:R}),F=Z&&"object"===typeof Z?Z:void 0,Q=(0,E.N4)((e=>(0,b.ds)(e,null!==G&&void 0!==G?G:void 0)));t.useEffect((()=>{L((0,N.g)("cluster",{}))}),[L]);const Y=t.useMemo((()=>{const e=[];return P||e.push(Cn.Bi.network),M||e.push(Cn.Bi.events),z||e.push(Cn.Bi.configs),Cn.bn.filter((n=>!e.includes(n.id)))}),[M,P,z]),X=t.useMemo((()=>Y.find((({id:e})=>e===B))),[B,Y]),{appTitle:ne}=(0,D.J)();return(0,ee.jsx)(m.e,{children:(0,ee.jsxs)("div",{className:ts(),ref:C,children:[(0,ee.jsx)(i.mg,{defaultTitle:`${q} \u2014 ${ne}`,titleTemplate:`%s \u2014 ${q} \u2014 ${ne}`,children:X?(0,ee.jsx)("title",{children:X.title}):null}),(0,ee.jsx)("div",{className:ts("header"),children:(()=>{if(K)return(0,ee.jsx)(a.E,{className:ts("title-skeleton")});const e=(null===$||void 0===$?void 0:$.Overall)||w.m.Grey;return(0,ee.jsxs)(h.c,{className:ts("title"),children:[q,(0,ee.jsx)(h.c.Label,{status:e,note:p.D[e]})]})})()}),(0,ee.jsx)("div",{className:ts("sticky-wrapper"),children:(0,ee.jsx)(u.E,{className:ts("auto-refresh-control")})}),_&&(0,ee.jsx)("div",{className:ts("dashboard"),children:(0,ee.jsx)(es,{cluster:null!==$&&void 0!==$?$:{},groupStats:J,loading:K,error:F||(null===$||void 0===$?void 0:$.error),additionalClusterProps:e})}),(0,ee.jsx)("div",{className:ts("tabs-sticky-wrapper"),children:(0,ee.jsx)(r.f,{value:B,children:(0,ee.jsx)(o.w,{size:"l",children:Y.map((({id:e,title:n})=>{const s=(0,j.a)({activeTab:e},{clusterName:G,backend:H});return(0,ee.jsx)(l.o,{value:e,children:(0,ee.jsx)(v.E,{view:"primary",as:"tab",to:s,onClick:()=>{L((0,b.Yv)(e))},children:n})},e)}))})})}),(0,ee.jsx)("div",{className:ts("content"),children:(0,ee.jsxs)(c.dO,{children:[(0,ee.jsx)(c.qh,{path:(0,j.a3)((0,j.a)({activeTab:Cn.Bi.tablets})).pathname,children:(0,ee.jsx)(k.Q,{loading:K,tablets:Q,scrollContainerRef:C})}),(0,ee.jsx)(c.qh,{path:(0,j.a3)((0,j.a)({activeTab:Cn.Bi.tenants})).pathname,children:(0,ee.jsx)(je,{additionalTenantsProps:n,scrollContainerRef:C})}),(0,ee.jsx)(c.qh,{path:(0,j.a3)((0,j.a)({activeTab:Cn.Bi.nodes})).pathname,children:(0,ee.jsx)(T.G,{scrollContainerRef:C})}),(0,ee.jsx)(c.qh,{path:(0,j.a3)((0,j.a)({activeTab:Cn.Bi.storage})).pathname,children:(0,ee.jsx)(I.z,{scrollContainerRef:C})}),P&&(0,ee.jsx)(c.qh,{path:(0,j.a3)((0,j.a)({activeTab:Cn.Bi.network})).pathname,children:(0,ee.jsx)(x.x,{scrollContainerRef:C})}),(0,ee.jsx)(c.qh,{path:(0,j.a3)((0,j.a)({activeTab:Cn.Bi.versions})).pathname,children:(0,ee.jsx)(un,{cluster:$,loading:K})}),M&&(0,ee.jsx)(c.qh,{path:(0,j.a3)((0,j.a)({activeTab:Cn.Bi.events})).pathname,children:null===(s=y.J.renderEvents)||void 0===s?void 0:s.call(y.J,{scrollContainerRef:C})}),z&&(0,ee.jsx)(c.qh,{path:(0,j.a3)((0,j.a)({activeTab:Cn.Bi.configs})).pathname,children:(0,ee.jsx)(S.U,{className:ts("cluster-configs"),scrollContainerRef:C})}),(0,ee.jsx)(c.qh,{render:()=>(0,ee.jsx)(c.rd,{to:(0,j.a3)((0,j.a)({activeTab:B}))})})]})})]})})}},70043:(e,n,s)=>{"use strict";s.d(n,{E:()=>o});var t=s(1608),a=s(66781),r=s(60712);const o=({delay:e=600,className:n})=>{const[s]=(0,a.y)(e);return s?(0,r.jsx)(t.E,{className:n}):null}},78018:(e,n,s)=>{var t=s(80472),a=s(2680),r=Object.prototype.hasOwnProperty,o=a((function(e,n,s){r.call(e,s)?e[s].push(n):t(e,s,[n])}));e.exports=o},81061:(e,n,s)=>{var t=s(75125);e.exports=function(e,n,s,a){return t(e,(function(e,t,r){n(a,e,s(e),r)})),a}},91364:(e,n,s)=>{"use strict";s.d(n,{A:()=>a});var t=s(59284);const a=e=>t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),t.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M5 13.5h6a1.5 1.5 0 0 0 1.5-1.5V7.243a1.5 1.5 0 0 0-.44-1.061L8.819 2.939a1.5 1.5 0 0 0-1.06-.439H5A1.5 1.5 0 0 0 3.5 4v8A1.5 1.5 0 0 0 5 13.5m9-6.257a3 3 0 0 0-.879-2.122L9.88 1.88A3 3 0 0 0 7.757 1H5a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h6a3 3 0 0 0 3-3zM5 8.25a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5A.75.75 0 0 1 5 8.25m.75 2.25a.75.75 0 0 0 0 1.5h2.5a.75.75 0 0 0 0-1.5z",clipRule:"evenodd"}))}}]);