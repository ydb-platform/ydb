"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[8076],{99683:(e,s,a)=>{a.d(s,{l:()=>i});var r=a(68330),t=a(24362),n=a(75859);const o=(0,t.cn)("ydb-cell-with-popover");function i(e){let{children:s,className:a,wrapperClassName:t,...i}=e;return(0,n.jsx)("div",{className:o(null,t),children:(0,n.jsx)(r.J,{className:o("popover",a),...i,children:s})})}},8659:(e,s,a)=>{a.d(s,{P:()=>D});var r=a(54665),t=a(5922),n=a(24362),o=a(52317),i=a(4119),l=a(48169),d=a(69214),c=a(23373),u=a(32270),p=a(67359),m=a(30817);const g=JSON.parse('{"path":"Path","guid":"GUID","category":"Category","type":"Type","size":"Size","state":"State","device":"Device","realtime":"Realtime","serial-number":"SerialNumber","links":"Links","developer-ui":"Developer UI","pdisk-page":"PDisk page"}'),h=(0,m.wZ)("ydb-pDisk-info",{en:g});var v=a(75859);const w=(0,n.cn)("ydb-pdisk-info");function D(e){let{pDisk:s,nodeId:a,isPDiskPage:n=!1,...m}=e;const{PDiskId:g,Path:D,Guid:b,Category:N,Type:k,Device:x,Realtime:f,State:j,SerialNumber:y,TotalSize:I,AvailableSize:P}=s,S=Number(I),E=Number(P),T=[];if((0,t.D)(D)&&T.push({label:h("path"),value:D}),(0,t.D)(b)&&T.push({label:h("guid"),value:b}),(0,t.D)(N)&&(T.push({label:h("category"),value:N}),T.push({label:h("type"),value:k})),S>=0&&E>=0&&T.push({label:h("size"),value:(0,v.jsx)(p.y,{value:S-E,capacity:S,formatValues:i.q3,colorizeProgress:!0})}),(0,t.D)(j)&&T.push({label:h("state"),value:j}),(0,t.D)(x)&&T.push({label:h("device"),value:(0,v.jsx)(d.A,{status:x})}),(0,t.D)(f)&&T.push({label:h("realtime"),value:(0,v.jsx)(d.A,{status:f})}),(0,t.D)(y)&&T.push({label:h("serial-number"),value:y||o.jX}),(0,t.D)(g)&&(0,t.D)(a)){const e=(0,r.ds)(g,a),s=(0,l.ok)({nodeId:a,pDiskId:g});T.push({label:h("links"),value:(0,v.jsxs)("span",{className:w("links"),children:[!n&&(0,v.jsx)(u.j,{title:h("pdisk-page"),url:e,external:!1}),(0,v.jsx)(u.j,{title:h("developer-ui"),url:s})]})})}return(0,v.jsx)(c._,{info:T,...m})}},2098:(e,s,a)=>{a.d(s,{G:()=>d});var r=a(2639),t=a(19812),n=a(24362),o=a(89712),i=a(75859);const l=(0,n.cn)("ydb-resizeable-data-table");function d(e){let{columnsWidthLSKey:s,columns:a,settings:n,wrapperClassName:d,...c}=e;const[u,p]=(0,o.M)(s),m=(0,r.B)(a,u),g={...n,defaultResizeable:!0};return(0,i.jsx)("div",{className:l(null,d),children:(0,i.jsx)(t.ZP,{theme:"yandex-cloud",columns:m,onResize:p,settings:g,...c})})}},22692:(e,s,a)=>{a.d(s,{h:()=>i});var r=a(56711),t=a(24362),n=a(75859);const o=(0,t.cn)("table-skeleton"),i=e=>{let{rows:s=2,className:a}=e;return(0,n.jsxs)("div",{className:o(null,a),children:[(0,n.jsxs)("div",{className:o("row"),children:[(0,n.jsx)(r.O,{className:o("col-1")}),(0,n.jsx)(r.O,{className:o("col-2")}),(0,n.jsx)(r.O,{className:o("col-3")}),(0,n.jsx)(r.O,{className:o("col-4")}),(0,n.jsx)(r.O,{className:o("col-5")})]}),[...new Array(s)].map(((e,s)=>(0,n.jsx)("div",{className:o("row"),children:(0,n.jsx)(r.O,{className:o("col-full")})},"skeleton-row-".concat(s))))]})}},80816:(e,s,a)=>{a.d(s,{a:()=>i});var r=a(14979),t=a(24362),n=a(75859);const o=(0,t.cn)("ydb-usage-label");function i(e){let{value:s,overloadThreshold:a=90,theme:t,...i}=e;return(0,n.jsxs)(r._,{theme:t,className:o({overload:Number(s)>=a}),...i,children:[s||0,"%"]})}},25747:(e,s,a)=>{a.r(s),a.d(s,{PDiskPage:()=>z});var r=a(68963);const t=e=>r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),r.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 1.5a6.5 6.5 0 1 1-6.445 7.348.75.75 0 1 1 1.487-.194A5.001 5.001 0 1 0 4.43 4.5h1.32a.75.75 0 0 1 0 1.5h-3A.75.75 0 0 1 2 5.25v-3a.75.75 0 0 1 1.5 0v1.06A6.48 6.48 0 0 1 8 1.5Z",clipRule:"evenodd"}));var n=a(88776),o=a(17095),i=a(49352),l=a(52846),d=a(50422),c=a(14659),u=a(12824),p=a(91816),m=a(8659),g=a(16084),h=a(79061),v=a(99337),w=a(11431),D=a(905),b=a(3764),N=a(51688),k=a(92092);const x=D.h.injectEndpoints({endpoints:e=>({getPdiskInfo:e.query({queryFn:async(e,s)=>{let{nodeId:a,pDiskId:r}=e,{signal:t}=s;try{const e=function(e){var s,a,r,t;let[n,o]=e;const i=null===(s=n.PDiskStateInfo)||void 0===s?void 0:s[0],l=(0,b.b)(i),d=null===(a=o.SystemStateInfo)||void 0===a?void 0:a[0],c=(0,N.Ns)(d);return{...l,NodeId:null!==(r=l.NodeId)&&void 0!==r?r:c.NodeId,NodeHost:c.Host,NodeType:null===(t=c.Roles)||void 0===t?void 0:t[0],NodeDC:c.DC}}(await Promise.all([window.api.getPDiskInfo({nodeId:a,pDiskId:r},{signal:t}),window.api.getNodeInfo(a,{signal:t})]));return{data:e}}catch(n){return{error:n}}},providesTags:["All"]}),getStorageInfo:e.query({queryFn:async(e,s)=>{let{nodeId:a,pDiskId:r}=e,{signal:t}=s;try{const e=function(e,s,a){var r;const t=[];return null===(r=e.StoragePools)||void 0===r||r.forEach((e=>{var r;return null===(r=e.Groups)||void 0===r?void 0:r.forEach((r=>{var n;(null===(n=r.VDisks)||void 0===n?void 0:n.some((e=>{var r,t,n,o;const i=null!==(r=e.PDiskId)&&void 0!==r?r:null===(t=e.PDisk)||void 0===t?void 0:t.PDiskId,l=null!==(n=e.NodeId)&&void 0!==n?n:null===(o=e.PDisk)||void 0===o?void 0:o.NodeId;return i===Number(s)&&l===Number(a)})))&&t.push((0,k.mD)(r,e))}))})),t}(await window.api.getStorageInfo({nodeId:a,version:w.w.v1},{signal:t}),r,a);return{data:e}}catch(n){return{error:n}}},providesTags:["All"]})}),overrideExisting:"throw"});var f=a(5922),j=a(92666),y=a(34051),I=a(2098),P=a(22692),S=a(52317),E=a(92076),T=a(30817);const C=JSON.parse('{"fqdn":"FQDN","pdisk":"PDisk","groups":"Groups","node":"Node","restart-pdisk-button":"Restart PDisk","restart-pdisk-dialog":"PDisk will be restarted. Do you want to proceed?","restart-pdisk-not-allowed":"You don\'t have enough rights to restart PDisk"}'),G=(0,T.wZ)("ydb-pDisk-page",{en:C});const Z=(0,a(24362).cn)("ydb-pdisk-page");var O=a(75859);function R(e){let{data:s,nodesMap:a,loading:t}=e;const n=r.useMemo((()=>(0,E.HI)(a)),[a]);return(0,O.jsxs)(r.Fragment,{children:[(0,O.jsx)("div",{className:Z("groups-title"),children:G("groups")}),(0,O.jsx)("div",{children:t?(0,O.jsx)(P.h,{}):(0,O.jsx)(I.G,{columnsWidthLSKey:E.Ty,data:s,columns:n,settings:S.LE})})]})}function z(){var e;const s=(0,y.zL)(),a=(0,y.ix)(v.d),{isUserAllowedToMakeChanges:w}=(0,y.ix)((e=>e.authentication)),[{nodeId:D,pDiskId:b}]=(0,l.useQueryParams)({nodeId:l.StringParam,pDiskId:l.StringParam});r.useEffect((()=>{s((0,h.J)("pDisk",{nodeId:D,pDiskId:b}))}),[s,D,b]);const[N]=(0,y.Rj)(),k=(0,f.D)(D)&&(0,f.D)(b)?{nodeId:D,pDiskId:b}:o.CN,I=x.useGetPdiskInfoQuery(k,{pollingInterval:N}),P=I.isFetching&&void 0===I.currentData,S=I.currentData||{},{NodeHost:E,NodeId:T,NodeType:C,NodeDC:z,Severity:A}=S,U=x.useGetStorageInfoQuery(k,{pollingInterval:N}),_=U.isFetching&&void 0===U.currentData,M=null!==(e=U.currentData)&&void 0!==e?e:[],V=async()=>{if((0,f.D)(D)&&(0,f.D)(b))return window.api.restartPDisk(D,b).then((e=>{if(!1===(null===e||void 0===e?void 0:e.result)){throw{statusText:e.error}}}))},L=async()=>Promise.all([I.refetch(),U.refetch()]);return(0,O.jsxs)("div",{className:Z(null),children:[(()=>{const e=b?"".concat(G("pdisk")," ").concat(b):G("pdisk"),s=E||G("node");return(0,O.jsx)(i.ql,{titleTemplate:"%s - ".concat(e," \u2014 ").concat(s," \u2014 YDB Monitoring"),defaultTitle:"".concat(e," \u2014 ").concat(s," \u2014 YDB Monitoring")})})(),(()=>{const e=E?"".concat(G("fqdn"),": ").concat(E):void 0,s=T?"".concat(G("node"),": ").concat(T):void 0;return(0,O.jsx)(g.V,{className:Z("meta"),loading:P,items:[e,s,C,z]})})(),(0,O.jsx)(u.b,{entityName:G("pdisk"),status:(0,j.b)(A),id:b,className:Z("title")}),(0,O.jsxs)("div",{className:Z("controls"),children:[(0,O.jsxs)(c.U,{onConfirmAction:V,onConfirmActionSuccess:L,buttonDisabled:!D||!b||!w,buttonView:"normal",dialogContent:G("restart-pdisk-dialog"),withPopover:!0,popoverContent:G("restart-pdisk-not-allowed"),popoverDisabled:w,children:[(0,O.jsx)(n.J,{data:t}),G("restart-pdisk-button")]}),(0,O.jsx)(d.q,{className:Z("auto-refresh-control")})]}),P?(0,O.jsx)(p.b,{className:Z("info"),rows:10}):(0,O.jsx)(m.P,{pDisk:S,nodeId:D,className:Z("info"),isPDiskPage:!0}),(0,O.jsx)(R,{data:M,nodesMap:a,loading:_})]})}},92076:(e,s,a)=>{a.d(s,{HI:()=>Y,Ty:()=>j,k8:()=>B,mk:()=>K});var r=a(68963),t=a(71549),n=a(19812),o=a(10502),i=a(14979),l=a(68330),d=a(88776),c=a(99683),u=a(69214),p=a(80816),m=a(79255),g=a(95829),h=a(75850),v=a(24362),w=a(4119),D=a(15106),b=a(47651),N=a(10703),k=a(43817),x=(a(5384),a(75859));const f=(0,v.cn)("global-storage-groups"),j="storageGroupsColumnsWidth",y="MediaType",I="Erasure",P="GroupId",S="Used",E="Limit",T="Usage",C="UsedSpaceFlag",G="Read",Z="Write",O="VDisks",R="Degraded",z={name:"PoolName",header:"Pool Name",width:250,render:e=>{var s;let{row:a}=e;const r=null===(s=a.PoolName)||void 0===s?void 0:s.split("/");return r&&(0,x.jsx)(c.l,{wrapperClassName:f("pool-name-wrapper"),content:a.PoolName,placement:["right"],behavior:o.x.Immediate,children:r[r.length-1]})},align:n.ZP.LEFT},A={name:y,header:"Type",width:100,resizeMinWidth:100,align:n.ZP.LEFT,render:e=>{let{row:s}=e;return(0,x.jsxs)(r.Fragment,{children:[(0,x.jsx)(i._,{children:s.MediaType||"\u2014"}),"\xa0",s.Encryption&&(0,x.jsx)(l.J,{content:(0,k.Z)("encrypted"),placement:"right",behavior:o.x.Immediate,children:(0,x.jsx)(i._,{children:(0,x.jsx)(d.J,{data:t.Z,size:18})})})]})},sortable:!1},U={name:I,header:"Erasure",width:100,render:e=>{let{row:s}=e;return s.ErasureSpecies?s.ErasureSpecies:"-"},align:n.ZP.LEFT,sortable:!1},_={name:R,header:"Degraded",width:110,resizeMinWidth:110,render:e=>{let{row:s}=e;return s.Degraded?(0,x.jsxs)(i._,{theme:(0,N._O)(s),children:["Degraded: ",s.Degraded]}):"-"},align:n.ZP.LEFT,defaultOrder:n.ZP.DESCENDING},M={name:T,header:"Usage",width:75,resizeMinWidth:75,render:e=>{let{row:s}=e;return s.Limit?(0,x.jsx)(p.a,{value:s.Usage,theme:(0,N.YC)(s.Usage)}):"-"},sortAccessor:e=>e.Limit?e.Usage:null,align:n.ZP.LEFT,sortable:!1},V={name:P,header:"Group ID",width:130,render:e=>{let{row:s}=e;return(0,x.jsx)("span",{className:f("group-id"),children:s.GroupID})},sortAccessor:e=>Number(e.GroupID),align:n.ZP.RIGHT,sortable:!1},L={name:S,header:"Used",width:100,render:e=>{let{row:s}=e;return(0,b.Uz)(s.Used,!0)},align:n.ZP.RIGHT,sortable:!1},F={name:E,header:"Limit",width:100,render:e=>{let{row:s}=e;return(0,b.Uz)(s.Limit)},align:n.ZP.RIGHT,sortable:!1},H={name:C,header:"Space",width:110,render:e=>{let{row:s}=e;const a=s.UsedSpaceFlag;let r=h.K.Red;return a<100?r=h.K.Green:a<1e4?r=h.K.Yellow:a<1e6&&(r=h.K.Orange),(0,x.jsx)(u.A,{status:r})},align:n.ZP.CENTER},W={name:G,header:"Read",width:100,render:e=>{let{row:s}=e;return s.Read?(0,b.Qt)(s.Read):"-"},align:n.ZP.RIGHT},q={name:Z,header:"Write",width:100,render:e=>{let{row:s}=e;return s.Write?(0,b.Qt)(s.Write):"-"},align:n.ZP.RIGHT},J=e=>({name:O,className:f("vdisks-column"),header:"VDisks",render:s=>{var a;let{row:r}=s;return(0,x.jsx)("div",{className:f("vdisks-wrapper"),children:null===(a=r.VDisks)||void 0===a?void 0:a.map((s=>(0,x.jsx)(m.c,{data:s,nodes:e,className:f("vdisks-item")},(0,w.a2)(s.VDiskId))))})},align:n.ZP.CENTER,width:900,resizeable:!1}),K=()=>[V,A,U,M,L,F],Y=e=>[z,A,U,_,V,M,L,J(e)],B=(e,s)=>{const a=((e,s)=>s===g.G.space?e.filter((e=>e.name!==R)):s===g.G.missing?e.filter((e=>e.name!==C)):e.filter((e=>e.name!==R&&e.name!==C)))([z,A,U,_,M,V,L,F,H,W,q,J(e)],s);return a.map((e=>({...e,sortable:(0,D.P7)(e.name)})))}},43817:(e,s,a)=>{a.d(s,{Z:()=>o});var r=a(30817);const t=JSON.parse('{"empty.default":"No such groups","empty.out_of_space":"No groups with out of space errors","empty.degraded":"No degraded groups","show_all":"Show all groups","encrypted":"Encrypted group"}'),n=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0433\u0440\u0443\u043f\u043f","empty.out_of_space":"\u041d\u0435\u0442 \u0433\u0440\u0443\u043f\u043f, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043a\u043e\u043d\u0447\u0430\u0435\u0442\u0441\u044f \u043c\u0435\u0441\u0442\u043e","empty.degraded":"\u041d\u0435\u0442 \u0434\u0435\u0433\u0440\u0430\u0434\u0438\u0440\u043e\u0432\u0430\u0432\u0448\u0438\u0445 \u0433\u0440\u0443\u043f\u043f","show_all":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435 \u0433\u0440\u0443\u043f\u043f\u044b","encrypted":"\u0417\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u0433\u0440\u0443\u043f\u043f\u0430"}'),o=(0,r.wZ)("ydb-storage-groups",{ru:n,en:t})},10703:(e,s,a)=>{a.d(s,{CZ:()=>m,TP:()=>g,YC:()=>p,_O:()=>u,_r:()=>D});var r=a(81413),t=a(95829),n=a(75850),o=a(99106),i=a(51688),l=a(15106);const d=(0,o.p)(1,2,["success","warning","danger"]),c={"block-4-2":(0,o.p)(1,2,["success","warning","danger"]),"mirror-3-dc":(0,o.p)(1,3,["success","warning","danger"])},u=e=>{var s;return(void 0!==(s=e.ErasureSpecies)&&s in c?c[e.ErasureSpecies]:d)(e.Degraded)},p=(0,o.p)(80,85,["success","warning","danger"]),m=(0,o.p)(80,85,[n.K.Green,n.K.Yellow,n.K.Red]),g={sortValue:i.Hk.NodeId,sortOrder:r.zE},h={sortValue:l.t5.PoolName,sortOrder:r.zE},v={sortValue:l.t5.Degraded,sortOrder:r.hr},w={sortValue:l.t5.Usage,sortOrder:r.hr};function D(e){return e===t.G.missing?v:e===t.G.space?w:h}},95829:(e,s,a)=>{a.d(s,{G:()=>r,d:()=>t});const r={all:"all",missing:"missing",space:"space"},t={groups:"groups",nodes:"nodes"}},89712:(e,s,a)=>{a.d(s,{M:()=>o});var r=a(68963),t=a(2639),n=a(18193);const o=e=>{const s=r.useCallback((()=>e?n.r.readUserSettingsValue(e,{}):{}),[e]),a=r.useCallback((s=>{e&&n.r.setUserSettingsValue(e,s)}),[e]);return(0,t.M)({saveSizes:a,getSizes:s})}},71549:(e,s,a)=>{a.d(s,{Z:()=>t});var r=a(68963);const t=e=>r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),r.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"m3.003 4.702 4.22-2.025a1.796 1.796 0 0 1 1.554 0l4.22 2.025a.886.886 0 0 1 .503.8V6a8.55 8.55 0 0 1-3.941 7.201l-.986.631a1.063 1.063 0 0 1-1.146 0l-.986-.63A8.55 8.55 0 0 1 2.5 6v-.498c0-.341.196-.652.503-.8Zm3.57-3.377L2.354 3.35A2.387 2.387 0 0 0 1 5.502V6a10.05 10.05 0 0 0 4.632 8.465l.986.63a2.563 2.563 0 0 0 2.764 0l.986-.63A10.05 10.05 0 0 0 15 6v-.498c0-.918-.526-1.755-1.354-2.152l-4.22-2.025a3.296 3.296 0 0 0-2.852 0ZM9.5 7a1.5 1.5 0 0 1-.75 1.3v1.95a.75.75 0 0 1-1.5 0V8.3A1.5 1.5 0 1 1 9.5 7Z",clipRule:"evenodd"}))},2639:(e,s,a)=>{a.d(s,{B:()=>t,M:()=>n});var r=a(68963);function t(e,s){return e.map((e=>{var a;let r;e.sub&&(r=t(e.sub,s));const n=null!==(a=s[e.name])&&void 0!==a?a:e.width;return Object.assign(Object.assign({},e),{width:n,sub:r})}))}function n(e){let{saveSizes:s,getSizes:a}=e;const[t,n]=r.useState((()=>a()));return[t,r.useCallback(((e,a)=>{n((r=>{const t=Object.assign(Object.assign({},r),{[e]:a});return s(t),t}))}),[s])]}},5384:()=>{}}]);