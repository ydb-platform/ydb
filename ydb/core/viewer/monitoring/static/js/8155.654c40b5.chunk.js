"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[8155],{80208:(i,e,o)=>{o.r(e),o.d(e,{VDiskPage:()=>C});var t=o(59284);const d=i=>t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},i),t.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.28 4.78a.75.75 0 0 0 0-1.06l-2.5-2.5a.75.75 0 1 0-1.06 1.06L6.94 3.5H1.75a.75.75 0 1 0 0 1.5h5.19L5.72 6.22a.75.75 0 1 0 1.06 1.06zm-.06 3.94-2.5 2.5a.75.75 0 0 0 0 1.06l2.5 2.5a.75.75 0 1 0 1.06-1.06L9.06 12.5h5.19a.75.75 0 0 0 0-1.5H9.06l1.22-1.22a.75.75 0 1 0-1.06-1.06M14 4.25a1.75 1.75 0 1 1-3.5 0 1.75 1.75 0 0 1 3.5 0M3.75 13.5a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5",clipRule:"evenodd"}));var s=o(99991),n=o(44992),a=o(61750),l=o(67087),r=o(22983),v=o(3685),c=o(44508),k=o(42655),u=o(58389),D=o(67440),g=o(21334),I=o(67028),p=o(40174),f=o(7187),w=o(27295),h=o(78034);const m=g.F.injectEndpoints({endpoints:i=>({getVDiskData:i.query({queryFn:async({nodeId:i,pDiskId:e,vDiskSlotId:o},{signal:t})=>{try{const d=await Promise.all([window.api.viewer.getVDiskInfo({nodeId:i,pDiskId:e,vDiskSlotId:o},{signal:t}),window.api.viewer.getNodeWhiteboardPDiskInfo({nodeId:i,pDiskId:e},{signal:t}),window.api.viewer.getNodeInfo(i,{signal:t})]);return{data:function([i,e,o]){var t,d,s,n,a,l,r;const v=null===(t=i.VDiskStateInfo)||void 0===t?void 0:t[0],c=(0,w.WT)(v),k=null===(d=e.PDiskStateInfo)||void 0===d?void 0:d[0],u=(0,w.or)(k),D=null===(s=o.SystemStateInfo)||void 0===s?void 0:s[0],g=(0,h.q1)(D),I=null!==(n=null!==(a=c.NodeId)&&void 0!==a?a:u.NodeId)&&void 0!==n?n:g.NodeId,p=g.Host,f=null===(l=g.Roles)||void 0===l?void 0:l[0],m=g.DC,y=null!==(r=c.PDiskId)&&void 0!==r?r:u.PDiskId,x=u.Type;return{...c,NodeId:I,NodeHost:p,NodeType:f,NodeDC:m,PDiskId:y,PDiskType:x}}(d)}}catch(d){return{error:d}}},providesTags:(i,e,o)=>["All",{type:"VDiskData",id:(0,f.gh)(o.nodeId,o.pDiskId,o.vDiskSlotId)}]})}),overrideExisting:"throw"});var y=o(7435),x=o(77506),S=o(90182),b=o(12888),N=o(99936),P=o(48372);const V=JSON.parse('{"fqdn":"FQDN","node":"Node","pdisk":"PDisk","vdisk":"VDisk","storage":"Storage","evict-vdisk-button":"Evict VDisk","force-evict-vdisk-button":"Evict anyway","evict-vdisk-dialog-header":"Evict VDisk","evict-vdisk-dialog-text":"VDisk will be evicted. Do you want to proceed?","evict-vdisk-not-allowed":"You don\'t have enough rights to evict VDisk"}'),$=(0,P.g4)("ydb-vDisk-page",{en:V});var j=o(60712);const T=(0,x.cn)("ydb-vdisk-page");function C(){const i=(0,S.YQ)(),e=t.useRef(null),o=(0,b.X)(),w=(0,I.c2)(),[{nodeId:h,pDiskId:x,vDiskSlotId:P}]=(0,l.useQueryParams)({nodeId:l.StringParam,pDiskId:l.StringParam,vDiskSlotId:l.StringParam});t.useEffect((()=>{i((0,p.g)("vDisk",{nodeId:h,pDiskId:x,vDiskSlotId:P}))}),[i,h,x,P]);const[V]=(0,S.Nt)(),C=(0,y.f8)(h)&&(0,y.f8)(x)&&(0,y.f8)(P)?{nodeId:h,pDiskId:x,vDiskSlotId:P}:n.hT,{currentData:E={},isFetching:R,error:F}=m.useGetVDiskDataQuery(C,{pollingInterval:V}),B=R&&void 0===E,{NodeHost:H,NodeId:q,NodeType:G,NodeDC:M,PDiskId:Y,PDiskType:Q,Severity:_,VDiskId:A}=E,{GroupID:L,GroupGeneration:O,Ring:z,Domain:W,VDisk:X}=A||{},J=(0,y.f8)(L)&&(0,y.f8)(O)&&(0,y.f8)(z)&&(0,y.f8)(W)&&(0,y.f8)(X),K=async i=>{if(J){var e;const o={groupId:L,groupGeneration:O,failRealmIdx:z,failDomainIdx:W,vDiskIdx:X,force:i};let t;if(t=w?await window.api.vdisk.evictVDisk(o):await window.api.tablets.evictVDiskOld(o),!1===(null===(e=t)||void 0===e?void 0:e.result)){throw{statusText:t.error,retryPossible:t.forceRetryPossible}}}},U=()=>{i(g.F.util.invalidateTags([{type:"VDiskData",id:(0,f.gh)(h||0,x||0,P||0)},"StorageData"]))};return(0,j.jsxs)("div",{className:T(null),ref:e,children:[(()=>{const i=P?`${$("vdisk")} ${P}`:$("vdisk"),e=x?`${$("pdisk")} ${x}`:$("pdisk"),o=H||$("node");return(0,j.jsx)(a.mg,{titleTemplate:`%s - ${i} - ${e} \u2014 ${o} \u2014 YDB Monitoring`,defaultTitle:`${i} - ${e} \u2014 ${o} \u2014 YDB Monitoring`})})(),(()=>{const i=H?`${$("fqdn")}: ${H}`:void 0,e=q?`${$("node")}: ${q}`:void 0,o=q?`${$("pdisk")}: ${Y}`:void 0;return(0,j.jsx)(u.B,{className:T("meta"),loading:B,items:[i,e,G,M,o,Q]})})(),(0,j.jsx)(v.$,{className:T("title"),entityName:$("vdisk"),status:(0,f.XY)(_),id:null===E||void 0===E?void 0:E.StringifiedId}),(0,j.jsx)("div",{className:T("controls"),children:(0,j.jsxs)(r.B,{onConfirmAction:K,onConfirmActionSuccess:U,buttonDisabled:!J||!o,buttonView:"normal",dialogHeader:$("evict-vdisk-dialog-header"),dialogText:$("evict-vdisk-dialog-text"),retryButtonText:$("force-evict-vdisk-button"),withPopover:!0,popoverContent:$("evict-vdisk-not-allowed"),popoverDisabled:o,children:[(0,j.jsx)(s.I,{data:d}),$("evict-vdisk-button")]})}),B?(0,j.jsx)(k.y,{rows:20}):(0,j.jsxs)(t.Fragment,{children:[F?(0,j.jsx)(c.o,{error:F}):null,(0,j.jsx)(D.E,{data:E,className:T("info")}),(0,y.f8)(L)&&(0,y.f8)(h)?(0,j.jsxs)(t.Fragment,{children:[(0,j.jsx)("div",{className:T("storage-title"),children:$("storage")}),(0,j.jsx)(N.z,{groupId:L,nodeId:h,pDiskId:null!==x&&void 0!==x?x:void 0,parentRef:e,viewContext:{groupId:null===L||void 0===L?void 0:L.toString(),nodeId:null===h||void 0===h?void 0:h.toString(),pDiskId:null===x||void 0===x?void 0:x.toString(),vDiskSlotId:null===P||void 0===P?void 0:P.toString()}})]}):null]})]})}}}]);