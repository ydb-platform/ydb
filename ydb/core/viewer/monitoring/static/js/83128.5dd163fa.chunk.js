"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[83128],{28419:(e,s,t)=>{t.r(s),t.d(s,{Cluster:()=>Xs});var n=t(59284),r=t(89169),a=t(23871),l=t(61750),o=t(10755),i=t(80987),c=t(90053),d=t(37477),u=t(97677),h=t(44294),v=t(55340),m=t(78321),p=t(92459),g=t(67028),x=t(67157),j=t(40174),N=t(54090),f=t(77506),y=t(69063),b=t(11363),w=t(47199),C=t(88616),k=t(93381),_=t(65872),S=t(64470),E=t(4557),T=t(84476),V=t(99991),D=t(40569),O=t(28539),A=t(44508),L=t(78524),I=t(48295),z=t(9252),M=t(17594),G=t(95963),R=t(69326),$=t(23900),P=t(87184),B=t(54309),U=t(581),W=t(12888),F=t(10508),J=t(25196),H=t(63719),q=t(60712);function Z({tenant:e,additionalTenantsProps:s}){const t=(0,W.X)(),n=((e,s)=>{var t;if("function"!==typeof(null===s||void 0===s?void 0:s.prepareTenantBackend))return;let n;const r=null!==(t=e.NodeIds)&&void 0!==t?t:e.sharedNodeIds;r&&r.length>0&&(n=r[Math.floor(Math.random()*r.length)].toString());return s.prepareTenantBackend(n)})(e,s),r=Boolean(n),a=(0,U.f)(s,null===e||void 0===e?void 0:e.Name,null===e||void 0===e?void 0:e.Type),l=a.length>0&&t?(0,q.jsx)($.u,{responsive:!0,children:(0,q.jsx)($.u.Item,{name:(0,H.A)("field_links"),children:(0,q.jsx)(P.s,{gap:2,wrap:"wrap",children:a.map((({title:e,url:s})=>(0,q.jsx)(J.K,{title:e,url:s},e)))})})}):null;return(0,q.jsx)(F.c,{externalLink:r,name:e.Name||(0,H.A)("context_unknown"),withLeftTrim:!0,status:e.Overall,infoPopoverContent:l,hasClipboardButton:!0,path:(0,B.YL)({database:e.Name,backend:n},{withBasename:r})})}var Q=t(88610),Y=t(53850),K=t(23536),X=t.n(K),ee=t(76086),se=t(56674);const te=(0,Y.Mz)((e=>e),(e=>se.GJ.endpoints.getTenantsInfo.select({clusterName:e}))),ne=(0,Y.Mz)((e=>e),((e,s)=>te(s)),(e=>(0,Q.CN)(e,ee.Xm)),((e,s,t)=>{var n;const r=null!==(n=s(e).data)&&void 0!==n?n:[];return!t&&r.length>1?r.filter((e=>"Domain"!==e.Type)):r})),re=e=>e.tenants.searchValue,ae=(0,Y.Mz)([ne,Q.yV,re],((e,s,t)=>{let n=((e,s)=>s===Q.s$.ALL?e:e.filter((e=>e.Overall&&e.Overall!==N.m.Green)))(e,s);return n=((e,s)=>e.filter((e=>{const t=new RegExp(X()(s),"i");return t.test(e.Name||"")||t.test(e.controlPlaneName)})))(n,t),n}));var le=t(51114),oe=t(46549),ie=t(56839),ce=t(28232),de=t(41650),ue=t(48372);const he=JSON.parse('{"create-database":"Create database","remove":"Remove","edit":"Edit"}'),ve=(0,ue.g4)("ydb-tenants-table",{en:he}),me=(0,f.cn)("tenants"),pe=({additionalTenantsProps:e,scrollContainerRef:s})=>{const t=(0,y.YQ)(),r=(0,ce.H)(),[a]=(0,y.Nt)(),{currentData:l,isFetching:o,error:i}=se.GJ.useGetTenantsInfoQuery({clusterName:r},{pollingInterval:a}),c=o&&void 0===l,[d,u]=n.useState(),h=(0,g.sH)()&&void 0!==le.J.onCreateDB,v=(0,g.g7)()&&void 0!==le.J.onEditDB,m=(0,g.TW)()&&void 0!==le.J.onDeleteDB,p=(0,y.N4)((e=>ne(e,r))),x=(0,y.N4)(re),j=(0,y.N4)((e=>ae(e,r))),N=(0,y.N4)(Q.yV),[f]=(0,y.iK)(ee._X),b=e=>{t((0,Q.$u)(e))},w=e=>{t((0,se.gB)(e))};return(0,q.jsx)("div",{className:me("table-wrapper"),children:(0,q.jsxs)(R.L,{fullHeight:!0,children:[(0,q.jsx)(R.L.Controls,{renderExtraControls:()=>h&&r&&!c?(0,q.jsxs)(T.$,{view:"action",onClick:()=>{var e;return null===(e=le.J.onCreateDB)||void 0===e?void 0:e.call(le.J,{clusterName:r})},className:me("create-database"),children:[(0,q.jsx)(V.I,{data:k.A}),ve("create-database")]}):null,children:(0,q.jsxs)(n.Fragment,{children:[(0,q.jsx)(G.v,{value:x,onChange:w,placeholder:"Database name",className:me("search")}),(0,q.jsx)(z.k,{value:N,onChange:b}),(0,q.jsx)(O.T,{total:p.length,current:(null===j||void 0===j?void 0:j.length)||0,label:"Databases",loading:c})]})}),i?(0,q.jsx)(A.o,{error:i}):null,(0,q.jsx)(R.L.Table,{scrollContainerRef:s,loading:c,scrollDependencies:[x,N,d],children:l?(()=>{const s=[{name:"Name",header:"Database",render:({row:s})=>(0,q.jsx)(Z,{tenant:s,additionalTenantsProps:e}),width:440,sortable:!0,defaultOrder:E.Ay.DESCENDING},{name:"controlPlaneName",header:"Name",render:({row:e})=>e.controlPlaneName,width:200,sortable:!0,defaultOrder:E.Ay.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:({row:e})=>"Serverless"!==e.Type?e.Type:(0,q.jsxs)("div",{className:me("type"),children:[(0,q.jsx)("span",{className:me("type-value"),children:e.Type}),(0,q.jsx)(T.$,{className:me("type-button"),onClick:()=>w(e.sharedTenantName||""),children:"Show shared"})]})},{name:"State",width:150,render:({row:e})=>e.State?e.State.toLowerCase():"\u2014",customStyle:()=>({textTransform:"capitalize"})},{name:"cpu",header:"CPU",width:80,render:({row:e})=>e.cpu&&e.cpu>1e4?(0,ie.iM)(e.cpu):"\u2014",align:E.Ay.RIGHT,defaultOrder:E.Ay.DESCENDING},{name:"memory",header:"Memory",width:120,render:({row:e})=>e.memory?(0,ie.vX)(e.memory):"\u2014",align:E.Ay.RIGHT,defaultOrder:E.Ay.DESCENDING},{name:"storage",header:"Storage",width:120,render:({row:e})=>e.storage?(0,ie.vX)(e.storage):"\u2014",align:E.Ay.RIGHT,defaultOrder:E.Ay.DESCENDING}];if(f&&s.push({name:"Network",header:"Network",width:120,align:E.Ay.RIGHT,defaultOrder:E.Ay.DESCENDING,sortAccessor:({NetworkWriteThroughput:e=0})=>Number(e),render:({row:e})=>{const{NetworkWriteThroughput:s}=e;return(0,de.kf)(s)?(0,oe.z3)({value:s,size:"mb",withSpeedLabel:!0,precision:2}):ee.Pd}}),s.push({name:"nodesCount",header:"Nodes",width:100,render:({row:e})=>e.nodesCount?(0,ie.ZV)(e.nodesCount):"\u2014",align:E.Ay.RIGHT,defaultOrder:E.Ay.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:({row:e})=>e.groupsCount?(0,ie.ZV)(e.groupsCount):"\u2014",align:E.Ay.RIGHT,defaultOrder:E.Ay.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:({PoolStats:e=[]})=>e.reduce(((e,s)=>e+(s.Usage||0)),0),defaultOrder:E.Ay.DESCENDING,align:E.Ay.LEFT,render:({row:e})=>(0,q.jsx)(I._,{pools:e.PoolStats})}),r&&(m||v)){const e=function({clusterName:e,isEditDBAvailable:s,isDeleteDBAvailable:t}){return{name:"actions",header:"",width:40,resizeable:!1,align:E.Ay.CENTER,render:({row:n})=>{const r=[];return"Domain"===n.Type?null:(s&&r.push({text:ve("edit"),iconStart:(0,q.jsx)(_.A,{}),action:()=>{var s;null===(s=le.J.onEditDB)||void 0===s||s.call(le.J,{clusterName:e,databaseData:n})}}),t&&r.push({text:ve("remove"),iconStart:(0,q.jsx)(S.A,{}),action:()=>{var s;null===(s=le.J.onDeleteDB)||void 0===s||s.call(le.J,{clusterName:e,databaseData:n})},className:me("remove-db")}),r.length?(0,q.jsx)(D.r,{items:r}):null)}}}({clusterName:r,isDeleteDBAvailable:m,isEditDBAvailable:v});s.push(e)}return 0===j.length&&N!==Q.s$.ALL?(0,q.jsx)(L.v,{name:"thumbsUp",width:"200"}):(0,q.jsx)(M.l,{columnsWidthLSKey:"databasesTableColumnsWidth",data:j,columns:s,settings:ee.N3,emptyDataMessage:"No such tenants",onSortChange:u})})():null})]})})};var ge=t(44433),xe=t(74321),je=t(98167),Ne=t(15298),fe=t(18143);const ye=(0,f.cn)("ydb-cluster-versions-bar"),be=({versionsValues:e=[],size:s="s",progressClassName:t})=>(0,q.jsxs)("div",{className:ye(),children:[(0,q.jsx)(fe.k,{value:100,stack:e,size:s,className:t}),(0,q.jsx)("div",{className:ye("versions"),children:e.map(((s,t)=>(0,q.jsx)("div",{className:ye("version-title"),style:{color:s.color},title:s.version,children:`${s.version}${t===e.length-1?"":","}`},s.version)))})]});var we=t(63126),Ce=t(78762),ke=t(52075);function _e(e){return[(0,Ce._E)(),(0,Ce.Nh)(e),(0,Ce.jl)(),(0,Ce.pH)(),(0,Ce.fr)(),(0,Ce.ID)()]}const Se=({nodes:e})=>{const s=(0,ke.E)(),t=_e({getNodeRef:null===s||void 0===s?void 0:s.getNodeRef});return(0,q.jsx)(M.l,{columnsWidthLSKey:"versionsTableColumnsWidth",data:e,columns:t,settings:ee.N3})};var Ee=t(96873);const Te=(0,f.cn)("ydb-versions-nodes-tree-title"),Ve=({title:e,nodes:s,items:t,versionColor:n,versionsValues:r})=>{let a;return a=t?t.reduce(((e,s)=>s.nodes?e+s.nodes.length:e),0):s?s.length:0,(0,q.jsxs)("div",{className:Te("overview"),children:[(0,q.jsxs)("div",{className:Te("overview-container"),children:[n?(0,q.jsx)("div",{className:Te("version-color"),style:{background:n}}):null,e?(0,q.jsxs)("span",{className:Te("overview-title"),children:[e,(0,q.jsx)(Ee.b,{text:e,size:"s",className:Te("clipboard-button"),view:"normal"})]}):null]}),(0,q.jsxs)("div",{className:Te("overview-info"),children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("span",{className:Te("info-value"),children:a}),(0,q.jsx)("span",{className:Te("info-label",{margin:"left"}),children:"Nodes"})]}),r?(0,q.jsxs)("div",{className:Te("version-progress"),children:[(0,q.jsx)("span",{className:Te("info-label",{margin:"right"}),children:"Versions"}),(0,q.jsx)(fe.k,{size:"s",value:100,stack:r})]}):null]})]})},De=(0,f.cn)("ydb-versions-grouped-node-tree"),Oe=({title:e,nodes:s,items:t,expanded:r=!1,versionColor:a,versionsValues:l,level:o=0})=>{const[i,c]=n.useState(!1);n.useEffect((()=>{c(r)}),[r]);const d=(0,q.jsx)(Ve,{title:e,nodes:s,items:t,versionColor:a,versionsValues:l}),u=()=>{c((e=>!e))};return t?(0,q.jsx)("div",{className:De({"first-level":0===o}),children:(0,q.jsx)(we.G,{name:d,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:t.map(((e,s)=>(0,q.jsx)(Oe,{title:e.title,nodes:e.nodes,expanded:r,versionColor:e.versionColor,level:o+1},s)))},e)}):(0,q.jsx)("div",{className:De({"first-level":0===o}),children:(0,q.jsx)(we.G,{name:d,collapsed:!i,hasArrow:!0,onClick:u,onArrowClick:u,children:(0,q.jsx)("div",{className:De("dt-wrapper"),children:(0,q.jsx)(Se,{nodes:s||[]})})},e)})};var Ae=t(78018),Le=t.n(Ae),Ie=t(38596);const ze=.5,Me=(e=[],s)=>{const t=e.reduce(((e,s)=>(s.Version&&(e[s.Version]?e[s.Version]=e[s.Version]+1:e[s.Version]=1),e)),{});return Re(Object.keys(t).map((n=>{const r=t[n]/e.length*100;return{title:n,version:n,color:null===s||void 0===s?void 0:s.get((0,Ie.U)(n)),value:r<ze?ze:r}})))};function Ge(e,s,t){const n=null!==t&&void 0!==t?t:e.reduce(((e,s)=>e+s.count),0);return Re(e.map((e=>{const t=e.count/n*100;return{title:e.name,version:e.name,color:null===s||void 0===s?void 0:s.get((0,Ie.U)(e.name)),value:t<ze?ze:t}})))}function Re(e){let s=e[0].value,t=0,n=0;e.forEach(((e,r)=>{n+=e.value,e.value>s&&(s=e.value,t=r)}));const r=[...e];return r[t]={...e[t],value:s+100-n},r}let $e=function(e){return e.VERSION="Version",e.TENANT="Database",e.STORAGE="Storage",e}({});const Pe=(e,s)=>{var t;return(null===(t=e.title)||void 0===t?void 0:t.localeCompare(s.title||""))||-1},Be=(e,s,t)=>{if(e&&e.length){if(t===$e.VERSION){const t=Le()(e,"Version");return Object.keys(t).map((e=>{const n=t[e].filter(Je),r=Le()(n,"Tenants"),a=Object.keys(r).map((e=>({title:e,nodes:r[e]}))).sort(Pe);return a.length?{title:e,items:a,versionColor:null===s||void 0===s?void 0:s.get((0,Ie.U)(e))}:null})).filter((e=>Boolean(e)))}{const t=e.filter(Je),n=Le()(t,"Tenants");return Object.keys(n).map((e=>{const t=Me(n[e],s),r=Le()(n[e],"Version"),a=Object.keys(r).map((e=>({title:e,nodes:r[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ie.U)(e))})));return a.length?{title:e,items:a,versionsValues:t}:null})).filter((e=>Boolean(e))).sort(Pe)}}},Ue=(e,s)=>{if(!e||!e.length)return;const t=e.filter(Fe),n=Le()(t,"Version");return Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ie.U)(e))})))},We=(e,s)=>{if(!e||!e.length)return;const t=e.filter((e=>!Fe(e)&&!Je(e)&&e.Version)),n=Le()(t,"Version");return Object.keys(n).map((e=>({title:e,nodes:n[e],versionColor:null===s||void 0===s?void 0:s.get((0,Ie.U)(e))})))};function Fe(e){var s;return Boolean(null===(s=e.Roles)||void 0===s?void 0:s.includes("Storage"))}function Je(e){return Boolean(e.Tenants)}const He=JSON.parse('{"title_overall":"Overall","title_storage":"Storage nodes","title_database":"Database nodes","title_other":"Other nodes"}'),qe=(0,ue.g4)("ydb-versions",{en:He});var Ze=t(4980),Qe=t(39567),Ye=t(98730),Ke=t(40537),Xe=t(66592);const es=({cluster:e,versionToColor:s,clusterLoading:t})=>{const{currentData:r}=Ne.s.useGetNodesQuery((0,Ye.L)(e)||t?Ze.hT:{tablets:!1,fieldsRequired:["SystemState","SubDomainKey"],group:"Version"});return n.useMemo((()=>{if((0,Ye.L)(e)&&e.MapVersions){return Ge(Object.entries(e.MapVersions).map((([e,s])=>({name:e,count:s}))),s,e.NodesTotal)}return r?Array.isArray(r.NodeGroups)?Ge(r.NodeGroups,s,null===e||void 0===e?void 0:e.NodesTotal):Me(r.Nodes,s):[]}),[r,s,e])};function ss(e){const s=function(){const[e]=(0,i.useQueryParam)("clusterName",i.StringParam),s=(0,y.N4)((e=>e.singleClusterMode)),{data:t}=Qe.ub.useGetClustersListQuery(void 0,{skip:s});return n.useMemo((()=>{if(s)return;const n=(t||[]).find((s=>s.name===e)),r=(null===n||void 0===n?void 0:n.versions)||[];return()=>(0,Ke.Vm)((0,Ke.HD)(r))}),[s,t,e])}();return n.useMemo((()=>s?s():(0,Xe._n)(null===e||void 0===e?void 0:e.Versions)),[null===e||void 0===e?void 0:e.Versions,s])}const ts=(0,f.cn)("ydb-versions");function ns({cluster:e,loading:s}){const[t]=(0,y.Nt)(),{currentData:n,isLoading:r}=Ne.s.useGetNodesQuery({tablets:!1,fieldsRequired:["SystemState","SubDomainKey"]},{pollingInterval:t}),a=ss(),l=es({cluster:e,versionToColor:a,clusterLoading:s});return(0,q.jsx)(je.r,{loading:s||r,children:(0,q.jsx)(rs,{versionsValues:l,nodes:null===n||void 0===n?void 0:n.Nodes,versionToColor:a})})}function rs({versionsValues:e,nodes:s,versionToColor:t}){const[r,a]=n.useState($e.VERSION),[l,o]=n.useState(!1),i=e=>{a(e)},c=Be(s,t,r),d=Ue(s,t),u=We(s,t),h=null!==d&&void 0!==d&&d.length?(0,q.jsxs)(n.Fragment,{children:[(0,q.jsx)("h4",{children:qe("title_storage")}),d.map((({title:e,nodes:s,items:t,versionColor:n})=>(0,q.jsx)(Oe,{title:e,nodes:s,items:t,versionColor:n},`storage-nodes-${e}`)))]}):null,v=null!==c&&void 0!==c&&c.length?(0,q.jsxs)(n.Fragment,{children:[(0,q.jsx)("h4",{children:qe("title_database")}),(0,q.jsxs)("div",{className:ts("controls"),children:[(0,q.jsxs)("div",{className:ts("group"),children:[(0,q.jsx)("span",{className:ts("label"),children:"Group by:"}),(0,q.jsxs)(ge.a,{value:r,onUpdate:i,children:[(0,q.jsx)(ge.a.Option,{value:$e.TENANT,children:$e.TENANT}),(0,q.jsx)(ge.a.Option,{value:$e.VERSION,children:$e.VERSION})]})]}),(0,q.jsx)(xe.S,{className:ts("checkbox"),onChange:()=>o((e=>!e)),checked:l,children:"All expanded"})]}),c.map((({title:e,nodes:s,items:t,versionColor:n,versionsValues:r})=>(0,q.jsx)(Oe,{title:e,nodes:s,items:t,expanded:l,versionColor:n,versionsValues:r},`tenant-nodes-${e}`)))]}):null,m=null!==u&&void 0!==u&&u.length?(0,q.jsxs)(n.Fragment,{children:[(0,q.jsx)("h4",{children:qe("title_other")}),u.map((({title:e,nodes:s,items:t,versionColor:n,versionsValues:r})=>(0,q.jsx)(Oe,{title:e,nodes:s,items:t,versionColor:n,versionsValues:r},`other-nodes-${e}`)))]}):null,p=(0,q.jsxs)(n.Fragment,{children:[(0,q.jsx)("h4",{children:qe("title_overall")}),(0,q.jsx)("div",{className:ts("overall-wrapper"),children:(0,q.jsx)(be,{progressClassName:ts("overall-progress"),versionsValues:e.filter((e=>"unknown"!==e.title)),size:"m"})})]});return(0,q.jsxs)("div",{className:ts(),children:[p,h,v,m]})}var as=t(79522),ls=t(98089),os=t(33705),is=t(7435),cs=t(80967),ds=t(42655);const us=JSON.parse('{"erasure":"Erasure","allocated":"Allocated","available":"Available","usage":"Usage","label_nodes-state":"Nodes state","label_dc":"Nodes data centers","links":"Links","link_cores":"Coredumps","link_logging":"Logging","link_slo-logs":"SLO Logs","context_cores":"cores","title_cpu":"CPU","title_storage":"Storage","title_storage-groups":"Storage Groups","title_memory":"Memory","title_network":"Network","title_links":"Links","title_details":"Details","label_overview":"Overview","label_load":"Load","context_of":"of","context_cpu":"CPU load","context_memory":"Memory used","context_storage":["Storage: {{count}} group","Storage: {{count}} groups","Storage: {{count}} groups","Storage: {{count}} groups"],"context_network":"Network Evaluation","context_cpu-description":"CPU load is calculated as the cumulative usage across all actor system pools on all nodes in the cluster","context_memory-description":"Memory usage is the total memory consumed by all nodes in the cluster","context_storage-description":"Storage usage is a cumulative usage of raw disk space of all media types","context_network-description":"Network usage is the average outgoing bandwidth usage across all nodes in the cluster"}'),hs=(0,ue.g4)("ydb-cluster",{en:us});var vs=t(87842);const ms=(0,f.cn)("cluster-info");function ps(){const{cores:e,logging:s}=(0,x.Zd)();return n.useMemo((()=>{const t=[],n=function(e){try{const s=(0,de.qF)(e);if(s&&"object"===typeof s&&"url"in s&&"string"===typeof s.url)return s.url}catch{}}(e),{logsUrl:r,sloLogsUrl:a}=function(e){try{const s=(0,de.qF)(e);if(s&&"object"===typeof s){return{logsUrl:"url"in s&&"string"===typeof s.url?s.url:void 0,sloLogsUrl:"slo_logs_url"in s&&"string"===typeof s.slo_logs_url?s.slo_logs_url:void 0}}}catch{}return{}}(s);return n&&t.push({title:hs("link_cores"),url:n}),r&&t.push({title:hs("link_logging"),url:r}),a&&t.push({title:hs("link_slo-logs"),url:a}),t}),[e,s])}var gs=t(15132),xs=t(47665);const js=({tags:e,className:s="",gap:t=1})=>(0,q.jsx)(P.s,{className:s,gap:t,wrap:"wrap",alignItems:"center",children:e&&e.map(((e,s)=>(0,q.jsx)(xs.J,{size:"s",children:e},s)))});var Ns=t(35736);const fs=(0,f.cn)("ydb-disk-groups-stats"),ys={good:"success",warning:"warning",danger:"danger"};function bs({stats:e,storageType:s}){const{erasure:t,allocatedSize:n,availableSize:r}=e,a=(0,oe.fn)(Math.max(n,r)),l=(0,oe.z3)({value:n,size:a}),o=(0,oe.z3)({value:r,size:a}),i=Math.floor(n/(n+r)*100),c=[{name:hs("erasure"),content:t},{name:hs("allocated"),content:l},{name:hs("available"),content:o},{name:hs("usage"),content:(0,q.jsxs)(P.s,{gap:2,alignItems:"center",children:[(0,q.jsx)(fe.k,{theme:ys[(0,Ns.w)({fillWidth:i})],className:fs("progress"),value:i,size:"s"}),(0,q.jsxs)(ls.E,{color:"secondary",children:[i,"%"]})]})}];return(0,q.jsxs)(P.s,{direction:"column",gap:3,className:fs(),children:[(0,q.jsxs)(ls.E,{variant:"body-2",children:[s," ",(0,q.jsx)(ls.E,{color:"secondary",variant:"body-2",children:`${(0,ie.ZV)(e.createdGroups)} ${hs("context_of")} ${(0,ie.ZV)(e.totalGroups)}`})]}),(0,q.jsx)($.u,{nameMaxWidth:160,children:c.map((({name:e,content:s})=>(0,q.jsx)($.u.Item,{name:e,children:s},e)))})]})}const ws={Green:5,Blue:4,Yellow:3,Orange:2,Red:1,Grey:0},Cs=(e,s)=>{var t;const r=[],a=(e=>{if((0,Ye.L)(e)&&e.MapDataCenters)return Object.entries(e.MapDataCenters).map((([e,s])=>(0,q.jsxs)(n.Fragment,{children:[e," : ",(0,ie.ZV)(s)]},e)))})(e);if(null!==a&&void 0!==a&&a.length&&r.push({label:hs("label_dc"),value:(0,q.jsx)(js,{tags:a,gap:2,className:ms("dc")})}),(0,Ye.L)(e)&&e.MapNodeStates){const s=Object.entries(e.MapNodeStates);s.sort(((e,s)=>ws[s[0]]-ws[e[0]]));const t=s.map((([e,s])=>(0,q.jsx)(d.c.Label,{withStatusName:!1,status:e,size:"s",iconSize:12,children:(0,ie.ZV)(s)},e)));r.push({label:hs("label_nodes-state"),value:(0,q.jsx)(P.s,{gap:2,children:t})})}return r.push({label:hs("label_load"),value:(0,q.jsx)(gs.O,{value:null===e||void 0===e?void 0:e.LoadAverage,capacity:null!==(t=null===e||void 0===e?void 0:e.RealNumberOfCpus)&&void 0!==t?t:null===e||void 0===e?void 0:e.NumberOfCpus})}),r.push(...s),r};const ks=({cluster:e,loading:s,error:t,additionalClusterProps:n={},groupStats:r={}})=>{const{info:a=[],links:l=[]}=n,o=ps(),i=l.concat(o),c=Cs(null!==e&&void 0!==e?e:{},a),d=()=>s?(0,q.jsx)(ds.y,{className:ms("skeleton"),rows:4}):t&&!e?null:(0,q.jsxs)($.u,{nameMaxWidth:200,children:[c.map((({label:e,value:s})=>(0,q.jsx)($.u.Item,{name:e,children:s},e))),i.length>0&&(0,q.jsx)($.u.Item,{name:hs("title_links"),children:(0,q.jsx)(P.s,{direction:"column",gap:2,children:i.map((({title:e,url:s})=>(0,q.jsx)(J.K,{title:e,url:s},e)))})})]}),u=(0,vs.lq)(r);return(0,q.jsxs)(P.s,{gap:4,direction:"column",className:ms(),children:[t?(0,q.jsx)(A.o,{error:t,className:ms("error")}):null,(0,q.jsxs)(_s,{children:[(0,q.jsx)(ls.E,{as:"div",variant:"subheader-2",className:ms("section-title"),children:hs("title_details")}),d()]}),(()=>{const e=function(e){const s=[];return Object.entries(e).forEach((([e,t])=>{Object.values(t).forEach((t=>{s.push((0,q.jsx)(bs,{stats:t,storageType:e},`${e}|${t.erasure}`))}))})),s}(r);return s?null:(0,q.jsxs)(_s,{children:[(0,q.jsxs)(ls.E,{as:"div",variant:"subheader-2",className:ms("section-title"),children:[hs("title_storage-groups")," ",(0,q.jsx)(ls.E,{variant:"subheader-2",color:"secondary",children:(0,ie.ZV)(u)})]}),(0,q.jsx)(P.s,{gap:2,children:e})]})})()]})};function _s({children:e}){return(0,q.jsx)(P.s,{direction:"column",gap:3,children:e})}var Ss=t(98934);const Es=(0,f.cn)("ydb-doughnut-metrics");function Ts({status:e,fillWidth:s,children:t,className:n}){let r=3.6*s,a="var(--doughnut-color)",l="var(--doughnut-backdrop-color)";return r>360&&(r-=360,l="var(--doughnut-color)",a="var(--doughnut-overlap-color)"),(0,q.jsx)("div",{className:Es(null,n),children:(0,q.jsx)("div",{style:{background:`conic-gradient(${a} 0deg ${r}deg, ${l} ${r}deg 360deg)`},className:Es("doughnut",{status:e}),children:(0,q.jsx)("div",{className:Es("text-wrapper"),children:t})})})}Ts.Legend=function({children:e,variant:s="subheader-3",color:t="primary",note:n}){return(0,q.jsxs)(P.s,{gap:1,alignItems:"center",children:[(0,q.jsx)(ls.E,{variant:s,color:t,className:Es("legend"),as:"div",children:e}),n&&(0,q.jsx)(Ss.H,{className:Es("legend-note"),children:n})]})},Ts.Value=function({children:e,variant:s="subheader-2"}){return(0,q.jsx)(ls.E,{variant:s,className:Es("value"),children:e})};var Vs=t(70043);const Ds=(0,f.cn)("ydb-cluster-dashboard"),Os={good:N.m.Green,warning:N.m.Yellow,danger:N.m.Red};function As({children:e,className:s,collapsed:t}){return(0,q.jsx)(P.s,{gap:"6",alignItems:"center",className:Ds("card",{collapsed:t},s),children:e})}function Ls({title:e,children:s,legend:t,collapsed:n,...r}){const{main:a,secondary:l,note:o}=t;if(n){const{status:s,fillWidth:t}=r,n=t.toFixed(t>0?0:1);return(0,q.jsx)(d.c.Label,{withStatusName:!1,status:Os[s],children:`${e} : ${n}%`})}return(0,q.jsxs)(As,{children:[(0,q.jsx)(Ts,{...r,children:s}),(0,q.jsxs)("div",{className:Ds("legend-wrapper"),children:[a&&(0,q.jsx)(Ts.Legend,{children:a}),l&&(0,q.jsx)(Ts.Legend,{color:"secondary",note:o,variant:"body-1",children:l})]})]})}function Is({collapsed:e}){return(0,q.jsx)(As,{className:Ds("skeleton-wrapper"),collapsed:e,children:(0,q.jsx)(Vs.E,{className:Ds("skeleton")})})}function zs({collapsed:e}){return(0,q.jsxs)(n.Fragment,{children:[(0,q.jsx)(Is,{collapsed:e}),(0,q.jsx)(Is,{collapsed:e}),(0,q.jsx)(Is,{collapsed:e})]})}function Ms({colorizeProgress:e=!0,warningThreshold:s,dangerThreshold:t,inverseColorize:n=!1,fillWidth:r}){const a=Math.max(r,.5);return{status:(0,Ns.w)({fillWidth:r,warningThreshold:s,dangerThreshold:t,colorizeProgress:e,inverseColorize:n}),percents:(0,ie.l9)(r/100),fill:a}}function Gs({value:e,capacity:s,legendFormatter:t,...n}){const r=parseFloat(String(e)),a=parseFloat(String(s));let l=r/a*100||0;l=l>100?100:l;const o=t({value:r,capacity:a});return{...Ms({fillWidth:l,...n}),legend:o}}function Rs({value:e,capacity:s}){let t=[];return t=s<1e4?[(0,ie.ZV)(Math.round(e)),(0,ie.ZV)(Math.round(s))]:(0,ie.Nd)(e,s,void 0,"",!0),`${t[0]} ${hs("context_of")} ${t[1]} ${hs("context_cores")}`}function $s({collapsed:e,value:s,capacity:t,...n}){const{status:r,percents:a,legend:l,fill:o}=Gs({value:s,capacity:t,legendFormatter:Rs,...n});return(0,q.jsx)(Ls,{collapsed:e,status:r,fillWidth:o,title:hs("title_cpu"),legend:{main:l,secondary:hs("context_cpu"),note:hs("context_cpu-description")},children:(0,q.jsx)(Ts.Value,{children:a})})}function Ps({value:e,capacity:s}){const t=(0,ie.j9)(e,s,void 0,"\n");return`${t[0]} ${hs("context_of")} ${t[1]}`}function Bs({value:e,capacity:s,collapsed:t,...n}){const{status:r,percents:a,legend:l,fill:o}=Gs({value:e,capacity:s,legendFormatter:Ps,...n});return(0,q.jsx)(Ls,{status:r,fillWidth:o,title:hs("title_memory"),collapsed:t,legend:{main:l,secondary:hs("context_memory"),note:hs("context_memory-description")},children:(0,q.jsx)(Ts.Value,{children:a})})}function Us({percentsValue:e,throughput:s,collapsed:t,...n}){const[r]=(0,cs.i)(ee._X);if(!r)return null;const{status:a,percents:l,fill:o}=Ms({fillWidth:100*e,...n}),i=(c=s,(0,oe.z3)({value:c,withSpeedLabel:!0}));var c;return(0,q.jsx)(Ls,{status:a,fillWidth:o,title:hs("title_network"),collapsed:t,legend:{main:i,secondary:hs("context_network"),note:hs("context_network-description")},children:(0,q.jsx)(Ts.Value,{children:l})})}function Ws({value:e,capacity:s}){const t=(0,ie.j9)(e,s,void 0,"\n");return`${t[0]} ${hs("context_of")} ${t[1]}`}function Fs({value:e,capacity:s,groups:t,collapsed:n,...r}){const{status:a,percents:l,legend:o,fill:i}=Gs({value:e,capacity:s,legendFormatter:Ws,...r});return(0,q.jsx)(Ls,{status:a,fillWidth:i,title:hs("title_storage"),collapsed:n,legend:{main:o,secondary:hs("context_storage",{count:t}),note:hs("context_storage-description")},children:(0,q.jsx)(Ts.Value,{children:l})})}var Js;function Hs(){return Hs=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Hs.apply(null,arguments)}const qs=function(e){return n.createElement("svg",Hs({viewBox:"0 0 16 15"},e),Js||(Js=n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.98 1.826a.75.75 0 00-.96-1.152L10.376 3.71a1.25 1.25 0 01-1.196.225l-2.155-.718a2.75 2.75 0 00-2.973.837L.926 7.767a.75.75 0 101.148.966l3.125-3.712a1.25 1.25 0 011.352-.38l2.155.718a2.75 2.75 0 002.63-.496l3.644-3.037zM13.5 8h-2a.5.5 0 00-.5.5V13a.5.5 0 00.5.5h2a.5.5 0 00.5-.5V8.5a.5.5 0 00-.5-.5zm-4 5a.5.5 0 01-.5.5H7a.5.5 0 01-.5-.5v-2.5A.5.5 0 017 10h2a.5.5 0 01.5.5V13zM5 13a.5.5 0 01-.5.5h-2A.5.5 0 012 13v-.5a.5.5 0 01.5-.5h2a.5.5 0 01.5.5v.5zm-2.5 2h11a2 2 0 002-2V8.5a2 2 0 00-2-2h-2a2 2 0 00-2 2v.063A2.004 2.004 0 009 8.5H7a2 2 0 00-2 2v.063a2.005 2.005 0 00-.5-.063h-2a2 2 0 00-2 2v.5a2 2 0 002 2z",fill:"currentColor"})))};function Zs(e){const[s,t]=(0,cs.i)(ee.zU);return e.error?(0,q.jsx)(A.o,{error:e.error,className:Ds("error")}):(0,q.jsx)(P.s,{direction:"column",className:Ds("overview-wrapper",{collapsed:!s}),children:(0,q.jsxs)(as.E,{arrowPosition:"end",expanded:s,onUpdate:()=>t(!s),children:[(0,q.jsx)(as.E.Summary,{children:t=>(0,q.jsxs)("div",{...t,className:Ds("disclosure-summary"),children:[(0,q.jsxs)(P.s,{alignItems:"center",justifyContent:"space-between",width:"100%",children:[(0,q.jsxs)(P.s,{gap:2,alignItems:"center",children:[(0,q.jsx)(V.I,{data:qs,size:16}),(0,q.jsx)(ls.E,{variant:"body-2",color:"primary",className:Ds("title"),children:hs("label_overview")})]}),!s&&(0,q.jsx)(Qs,{...e,collapsed:!0})]}),(0,q.jsx)(os.I,{size:16,direction:t.expanded?"top":"bottom"})]})}),(0,q.jsx)(Qs,{...e}),(0,q.jsx)(ks,{...e})]})})}function Qs({collapsed:e,...s}){return(0,g.fp)()?(0,q.jsx)(P.s,{wrap:!0,className:Ds("dashboard-wrapper",{collapsed:e}),children:(0,q.jsx)(Ys,{...s,collapsed:e})}):null}function Ys({cluster:e,groupStats:s={},loading:t,collapsed:n}){if(t)return(0,q.jsx)(zs,{collapsed:n});const r=[];if((0,Ye.L)(e)){const{CoresUsed:s,NumberOfCpus:t,CoresTotal:a}=e,l=null!==a&&void 0!==a?a:t;(0,is.f8)(s)&&(0,is.f8)(l)&&r.push((0,q.jsx)($s,{value:s,capacity:l,collapsed:n},"cores"))}const{StorageTotal:a,StorageUsed:l}=e;if((0,is.f8)(a)&&(0,is.f8)(l)){const e=(0,vs.lq)(s);r.push((0,q.jsx)(Fs,{value:l,capacity:a,groups:e,collapsed:n},"storage"))}const{MemoryTotal:o,MemoryUsed:i}=e;if((0,is.f8)(o)&&(0,is.f8)(i)&&r.push((0,q.jsx)(Bs,{value:i,capacity:o,collapsed:n},"memory")),(0,Ye.E)(e)){const{NetworkUtilization:s,NetworkWriteThroughput:t}=e;(0,is.f8)(s)&&r.push((0,q.jsx)(Us,{percentsValue:s,throughput:t,collapsed:n},"network"))}return r}const Ks=(0,f.cn)("ydb-cluster");function Xs({additionalClusterProps:e,additionalTenantsProps:s,additionalNodesProps:t}){const f=n.useRef(null),k=(0,g.fp)(),_=(0,m.s)(),[S]=(0,y.Nt)(),E=(0,y.YQ)(),T=function(){const e=(0,y.YQ)(),s=(0,y.N4)((e=>e.cluster.defaultClusterTab)),t=(0,m.s)(),r=(0,o.W5)(p.Ay.cluster),{activeTab:a}=(null===r||void 0===r?void 0:r.params)||{};let l;l=t||a!==vs.Bi.network?(0,vs.eC)(a)?a:s:x.Oy;return n.useEffect((()=>{l!==s&&e((0,x.Yv)(l))}),[l,s,e]),l}(),[{clusterName:V,backend:D}]=(0,i.useQueryParams)({clusterName:i.StringParam,backend:i.StringParam}),O=(0,y.N4)((e=>(0,x.zR)(e,null!==V&&void 0!==V?V:void 0))),{title:A}=(0,x.Zd)(),L=null!==A&&void 0!==A?A:O,{data:{clusterData:I,groupsStats:z}={},isLoading:M,error:G}=x.Zh.useGetClusterInfoQuery(null!==V&&void 0!==V?V:void 0,{pollingInterval:S}),R=G&&"object"===typeof G?G:void 0,$=(0,y.N4)((e=>(0,x.ds)(e,null!==V&&void 0!==V?V:void 0)));n.useEffect((()=>{E((0,j.g)("cluster",{}))}),[E]);const P=n.useMemo((()=>_?vs.bn:vs.bn.filter((e=>e.id!==vs.Bi.network))),[_]),B=n.useMemo((()=>P.find((({id:e})=>e===T))),[T,P]);return(0,q.jsxs)("div",{className:Ks(),ref:f,children:[(0,q.jsx)(l.mg,{defaultTitle:`${L} \u2014 YDB Monitoring`,titleTemplate:`%s \u2014 ${L} \u2014 YDB Monitoring`,children:B?(0,q.jsx)("title",{children:B.title}):null}),(0,q.jsx)("div",{className:Ks("header"),children:(()=>{if(M)return(0,q.jsx)(r.E,{className:Ks("title-skeleton")});const e=(null===I||void 0===I?void 0:I.Overall)||N.m.Grey;return(0,q.jsxs)(d.c,{className:Ks("title"),children:[L,(0,q.jsx)(d.c.Label,{status:e,note:u.D[e]})]})})()}),(0,q.jsx)("div",{className:Ks("sticky-wrapper"),children:(0,q.jsx)(c.E,{className:Ks("auto-refresh-control")})}),k&&(0,q.jsx)("div",{className:Ks("dashboard"),children:(0,q.jsx)(Zs,{cluster:null!==I&&void 0!==I?I:{},groupStats:z,loading:M,error:R||(null===I||void 0===I?void 0:I.error),additionalClusterProps:e})}),(0,q.jsx)("div",{className:Ks("tabs-sticky-wrapper"),children:(0,q.jsx)(a.t,{size:"l",allowNotSelected:!0,activeTab:T,items:P,wrapTo:({id:e},s)=>{const t=(0,vs.a)(e,{clusterName:V,backend:D});return(0,q.jsx)(h.E,{to:t,onClick:()=>{E((0,x.Yv)(e))},children:s},e)}})}),(0,q.jsx)("div",{className:Ks("content"),children:(0,q.jsxs)(o.dO,{children:[(0,q.jsx)(o.qh,{path:(0,p.a3)((0,vs.a)(vs.Bi.tablets)).pathname,children:(0,q.jsx)(C.Q,{loading:M,tablets:$,scrollContainerRef:f})}),(0,q.jsx)(o.qh,{path:(0,p.a3)((0,vs.a)(vs.Bi.tenants)).pathname,children:(0,q.jsx)(pe,{additionalTenantsProps:s,scrollContainerRef:f})}),(0,q.jsx)(o.qh,{path:(0,p.a3)((0,vs.a)(vs.Bi.nodes)).pathname,children:(0,q.jsx)(b.G,{scrollContainerRef:f,additionalNodesProps:t})}),(0,q.jsx)(o.qh,{path:(0,p.a3)((0,vs.a)(vs.Bi.storage)).pathname,children:(0,q.jsx)(w.z,{scrollContainerRef:f})}),_&&(0,q.jsx)(o.qh,{path:(0,p.a3)((0,vs.a)(vs.Bi.network)).pathname,children:(0,q.jsx)(v.x,{scrollContainerRef:f,additionalNodesProps:t})}),(0,q.jsx)(o.qh,{path:(0,p.a3)((0,vs.a)(vs.Bi.versions)).pathname,children:(0,q.jsx)(ns,{cluster:I,loading:M})}),(0,q.jsx)(o.qh,{render:()=>(0,q.jsx)(o.rd,{to:(0,p.a3)((0,vs.a)(T))})})]})})]})}},42655:(e,s,t)=>{t.d(s,{y:()=>d});var n=t(59284),r=t(89169),a=t(77506),l=t(66781),o=t(60712);const i=(0,a.cn)("ydb-info-viewer-skeleton"),c=()=>(0,o.jsxs)("div",{className:i("label"),children:[(0,o.jsx)(r.E,{className:i("label__text")}),(0,o.jsx)("div",{className:i("label__dots")})]}),d=({rows:e=8,className:s,delay:t=600})=>{const[a]=(0,l.y)(t);let d=(0,o.jsxs)(n.Fragment,{children:[(0,o.jsx)(c,{}),(0,o.jsx)(r.E,{className:i("value")})]});return a||(d=null),(0,o.jsx)("div",{className:i(null,s),children:[...new Array(e)].map(((e,s)=>(0,o.jsx)("div",{className:i("row"),children:d},`skeleton-row-${s}`)))})}},70043:(e,s,t)=>{t.d(s,{E:()=>l});var n=t(89169),r=t(66781),a=t(60712);const l=({delay:e=600,className:s})=>{const[t]=(0,r.y)(e);return t?(0,a.jsx)(n.E,{className:s}):null}}}]);