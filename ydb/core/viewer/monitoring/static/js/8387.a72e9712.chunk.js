"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[8387],{41919:(e,t,r)=>{r.d(t,{Q:()=>d});var n=r(39683),s=r(17176),l=r(88776),a=r(24362),o=r(75859);const i=(0,a.cn)("developer-ui-link-button");function d(e){let{href:t,visible:r=!1,className:a}=e;return(0,o.jsx)(s.z,{size:"s",href:t,className:i({visible:r},a),target:"_blank",children:(0,o.jsx)(l.J,{data:n.Z})})}},49201:(e,t,r)=>{r.d(t,{C:()=>i});var n=r(14979),s=r(24362);const l=(0,r(30817).wZ)("ydb-entities-count",{ru:{of:"\u0438\u0437"},en:{of:"of"}});var a=r(75859);const o=(0,s.cn)("ydb-entities-count"),i=e=>{let{total:t,current:r,label:s,loading:i,className:d}=e,u="";return s&&(u+="".concat(s,": ")),i?u+="...":(u+="".concat(r),t&&Number(t)!==Number(r)&&(u+=" ".concat(l("of")," ").concat(t))),(0,a.jsx)(n._,{theme:"info",size:"m",className:o(null,d),children:u})}},62776:(e,t,r)=>{r.d(t,{a:()=>n.a});var n=r(91173)},89778:(e,t,r)=>{r.d(t,{k:()=>m});var n=r(10502),s=r(92398),l=r(48169),a=r(51688),o=r(99683),i=r(41919),d=r(69214),u=r(27506),c=r(75859);const m=e=>{let{node:t,getNodeRef:r,database:m}=e;if(!t.Host)return(0,c.jsx)("span",{children:"\u2014"});const h=!(0,a.TA)(t);let p;r?p=r(t)+"internal":t.NodeId&&(p=(0,l.wq)(t.NodeId)+"internal");const g=h?(0,s.a3)(t.NodeId,{tenantName:null!==m&&void 0!==m?m:t.TenantName}):void 0,v=p?(0,c.jsx)(i.Q,{href:p}):null;return(0,c.jsx)(o.l,{disabled:!h,content:(0,c.jsx)(u.bP,{data:t}),placement:["top","bottom"],behavior:n.x.Immediate,children:(0,c.jsx)(d.A,{name:t.Host,status:t.SystemState,path:g,hasClipboardButton:!0,additionalControls:v})})}},11635:(e,t,r)=>{r.d(t,{WQ:()=>G});var n=r(68963),s=r(5922),l=r(47101);const a=r(905).h.injectEndpoints({endpoints:function(e){return{fetchTableChunk:e.query({queryFn:async(e,t)=>{let{offset:r,limit:n,sortParams:s,filters:l,fetchData:a}=e,{signal:o}=t;try{return{data:await a({limit:n,offset:r,filters:l,sortParams:s,signal:o})}}catch(i){return{error:i}}},providesTags:["All"]})}}});var o=r(17096),i=r(26688),d=r(56711);const u="left",c=!0,m=-1,h=40;const p=(0,r(24362).cn)("ydb-paginated-table");var g=r(75859);const v=e=>{let{children:t,className:r,height:n,width:s,align:l=u,resizeable:a}=e;return(0,g.jsx)("td",{className:p("row-cell",{align:l},r),style:{height:"".concat(n,"px"),width:"".concat(s,"px"),maxWidth:a?"".concat(s,"px"):void 0},children:t})},f=e=>{let{index:t,columns:r,height:n}=e;return(0,g.jsx)("tr",{className:p("row",{loading:!0}),children:r.map((e=>{var r;const s=null!==(r=e.resizeable)&&void 0!==r?r:c;return(0,g.jsx)(v,{height:n,width:e.width,align:e.align,className:e.className,resizeable:s,children:(0,g.jsx)(d.O,{className:p("row-skeleton"),style:{width:"80%",height:"50%"}})},"".concat(e.name).concat(t))}))})},b=e=>{let{row:t,index:r,columns:n,getRowClassName:s,height:l}=e;const a=null===s||void 0===s?void 0:s(t);return(0,g.jsx)("tr",{className:p("row",a),children:n.map((e=>{var n;const s=null!==(n=e.resizeable)&&void 0!==n?n:c;return(0,g.jsx)(v,{height:l,width:e.width,align:e.align,className:e.className,resizeable:s,children:e.render({row:t,index:r})},"".concat(e.name).concat(r))}))})},w=e=>{let{columns:t,children:r}=e;return(0,g.jsx)("tr",{className:p("row",{empty:!0}),children:(0,g.jsx)("td",{colSpan:t.length,className:p("td"),children:r})})},x=(0,n.memo)((function(e){var t;let{id:r,limit:l,rowHeight:d,columns:u,fetchData:c,tableName:m,filters:h,sortParams:p,observer:v,getRowClassName:x,renderErrorMessage:N,onDataFetched:j,isActive:y}=e;const C=n.useRef(null),[S,E]=n.useState(!0),[O]=(0,o.Rj)(),U={offset:r*l,limit:l,fetchData:c,filters:h,sortParams:p,tableName:m};a.useFetchTableChunkQuery(U,{skip:S||!y,pollingInterval:O});const{currentData:I,error:A}=a.endpoints.fetchTableChunk.useQueryState(U);n.useEffect((()=>{let e=0;return y&&S&&(e=window.setTimeout((()=>{E(!1)}),200)),()=>{window.clearTimeout(e)}}),[y,S]),n.useEffect((()=>{const e=C.current;return e&&v.observe(e),()=>{e&&v.unobserve(e)}}),[v]),n.useEffect((()=>{if(I&&y){const{total:e=0,found:t=0}=I;j(e,t)}}),[I,y,j]);const F=(null===I||void 0===I||null===(t=I.data)||void 0===t?void 0:t.length)||l,G=F?F*d:l*d;return(0,g.jsx)("tbody",{ref:C,id:r.toString(),style:{height:"".concat(G,"px"),display:y?"table-row-group":"block"},children:(()=>{if(!y)return null;if(!I){if(A){const e=A;return(0,g.jsx)(w,{columns:u,children:N?N(e):(0,g.jsx)(i.V,{error:e})})}return(0,s.c$)(F).map((e=>(0,g.jsx)(f,{columns:u,height:d,index:e},e)))}return I.data.map(((e,t)=>(0,g.jsx)(b,{index:t,row:e,columns:u,height:d,getRowClassName:x},t)))})()})}));function N(e){let{minWidth:t,maxWidth:r,getCurrentColumnWidth:s,onResize:l}=e;const a=n.useRef(null),[o,i]=n.useState(!1);return n.useEffect((()=>{const e=a.current;if(!e)return;let n,o,d;const u=function(e){let t,r=null;return function(){for(var n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];t=s,"number"!==typeof r&&(r=requestAnimationFrame((()=>{e(...t),r=null})))}}((e=>{if(j(e),"number"!==typeof n||"number"!==typeof o)return;const s=e.clientX-n,a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return Math.max(t,Math.min(e,r))}(o+s,t,r);a!==d&&(d=a,null===l||void 0===l||l(d))})),c=e=>{j(e),void 0!==d&&(null===l||void 0===l||l(d)),i(!1),n=void 0,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)},m=e=>{o=s(),j(e),n=e.clientX,i(!0),document.addEventListener("mousemove",u),document.addEventListener("mouseup",c)};return e.addEventListener("mousedown",m),()=>{e.removeEventListener("mousedown",m),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c)}}),[l,t,r,s]),(0,g.jsx)("span",{ref:a,className:p("resize-handler",{resizing:o}),onClick:e=>j(e)})}function j(e){e.preventDefault(),e.stopPropagation()}const y=e=>{let{order:t}=e;return(0,g.jsx)("svg",{className:p("sort-icon",{desc:-1===t}),viewBox:"0 0 10 6",width:"10",height:"6",children:(0,g.jsx)("path",{fill:"currentColor",d:"M0 5h10l-5 -5z"})})},C=e=>{let{sortOrder:t,sortable:r,defaultSortOrder:n}=e;return r?(0,g.jsx)("span",{className:p("sort-icon-container",{shadow:!t}),children:(0,g.jsx)(y,{order:t||n})}):null},S=e=>{var t;let{column:r,resizeable:s,sortOrder:l,defaultSortOrder:a,onSort:o,rowHeight:i,onCellMount:d,onCellUnMount:u,onColumnsResize:c}=e;const m=n.useRef(null);n.useEffect((()=>{const e=m.current;return e&&(null===d||void 0===d||d(e)),()=>{e&&(null===u||void 0===u||u(e))}}),[d,u]);const h=n.useCallback((()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.getBoundingClientRect().width}),[]),v=n.useCallback((e=>{null===c||void 0===c||c(r.name,e)}),[c,r.name]),f=null!==(t=r.header)&&void 0!==t?t:r.name,b={height:"".concat(i,"px"),width:"".concat(r.width,"px"),minWidth:s?"".concat(r.width,"px"):void 0,maxWidth:s?"".concat(r.width,"px"):void 0};return(0,g.jsxs)("th",{ref:m,className:p("head-cell-wrapper"),style:b,children:[(0,g.jsxs)("div",{className:p("head-cell",{align:r.align,sortable:r.sortable},r.className),onClick:()=>{r.sortable&&(null===o||void 0===o||o(r.name))},children:[(0,g.jsx)("div",{className:p("head-cell-content"),children:f}),(0,g.jsx)(C,{sortOrder:l,sortable:r.sortable,defaultSortOrder:a})]}),s?(0,g.jsx)(N,{maxWidth:r.resizeMaxWidth,minWidth:r.resizeMinWidth,getCurrentColumnWidth:h,onResize:v}):null]})},E=e=>{let{columns:t,onSort:r,onColumnsResize:s,defaultSortOrder:l=m,rowHeight:a=h}=e;const[o,i]=n.useState({}),d=e=>{let t={};if(e===o.columnId){if(o.sortOrder&&o.sortOrder!==l)return i(t),void(null===r||void 0===r||r(t));t={sortOrder:1===o.sortOrder?-1:1,columnId:e}}else t={sortOrder:l,columnId:e};null===r||void 0===r||r(t),i(t)};return(0,g.jsxs)(n.Fragment,{children:[(0,g.jsx)("colgroup",{children:t.map((e=>(0,g.jsx)("col",{style:{width:"".concat(e.width,"px")}},e.name)))}),(0,g.jsx)("thead",{className:p("head"),children:(0,g.jsx)("tr",{children:t.map((e=>{var t;const r=o.columnId===e.name?o.sortOrder:void 0,n=s&&(null!==(t=e.resizeable)&&void 0!==t?t:c);return(0,g.jsx)(S,{column:e,resizeable:n,sortOrder:r,defaultSortOrder:l,onSort:d,rowHeight:a,onColumnsResize:s},e.name)}))})})]})};var O=r(30817);const U=JSON.parse('{"empty":"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"}'),I=(0,O.wZ)("ydb-paginated-table",{ru:U,en:{empty:"No data"}}),A=e=>{let{limit:t,fetchData:r,filters:a,tableName:o,columns:i,getRowClassName:d,rowHeight:u=h,parentContainer:c,initialSortParams:m,onColumnsResize:v,renderControls:f,renderErrorMessage:b,renderEmptyDataMessage:N,containerClassName:j}=e;const[y,C]=n.useState(m),[S,O]=n.useState(t),[U,A]=n.useState(0),[F,G]=n.useState([]),[_,D]=n.useState(!0),P=n.useRef(null),k=n.useCallback(((e,t)=>{O(e),A(t),D(!1)}),[]),R=(e=>{let{onEntry:t,onLeave:r,parentContainer:s}=e;const l=n.useRef();return n.useEffect((()=>(l.current=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?t(e.target.id):r(e.target.id)}))}),{root:s,rootMargin:"100%"}),()=>{var e;null===(e=l.current)||void 0===e||e.disconnect(),l.current=void 0})),[s,t,r]),l.current})({onEntry:n.useCallback((e=>{G((t=>[...new Set([...t,Number(e)])]))}),[]),onLeave:n.useCallback((e=>{G((t=>t.filter((t=>t!==Number(e)))))}),[]),parentContainer:c});n.useLayoutEffect((()=>{var e;(O(t),A(0),D(!0),c)?c.scrollTo(0,0):null===(e=P.current)||void 0===e||e.scrollTo(0,0);G([0])}),[a,t,c]);const T=()=>{if(!R)return null;if(!_&&0===U)return(0,g.jsx)("tbody",{children:(0,g.jsx)(w,{columns:i,children:N?N():I("empty")})});const e=U||t,n=Math.ceil(e/t);return(0,s.c$)(n).map((e=>(0,g.jsx)(x,{id:e,limit:t,rowHeight:u,columns:i,fetchData:r,filters:a,tableName:o,sortParams:y,getRowClassName:d,renderErrorMessage:b,onDataFetched:k,isActive:F.includes(e),observer:R},e)))},M=()=>(0,g.jsxs)("table",{className:p("table"),children:[(0,g.jsx)(E,{columns:i,onSort:C,onColumnsResize:v}),T()]});return(0,g.jsx)("div",{ref:P,className:p(null,j),children:f?(0,g.jsxs)(l.l,{children:[(0,g.jsx)(l.l.Controls,{children:f({inited:!_,totalEntities:S,foundEntities:U})}),(0,g.jsx)(l.l.Table,{children:M()})]}):M()})};var F=r(89712);function G(e){let{columnsWidthLSKey:t,columns:r,...n}=e;const[s,l]=(0,F.M)(t),a=function(e,t){return e.map((e=>{var r;return{...e,width:null!==(r=t[e.name])&&void 0!==r?r:e.width}}))}(r,s);return(0,g.jsx)(A,{columns:a,onColumnsResize:l,containerClassName:p("resizeable-table-container"),...n})}},30629:(e,t,r)=>{r.d(t,{o:()=>i});var n=r(68963),s=r(77264),l=r(24362),a=r(75859);const o=(0,l.cn)("ydb-search"),i=e=>{let{onChange:t,value:r="",className:l,debounce:i=200,placeholder:d}=e;const[u,c]=n.useState(r),m=n.useRef();n.useEffect((()=>{c((e=>e!==r?r:e))}),[r]);return(0,a.jsx)(s.o,{hasClear:!0,autoFocus:!0,className:o(null,l),placeholder:d,value:u,onUpdate:e=>{c(e),window.clearTimeout(m.current),m.current=window.setTimeout((()=>{null===t||void 0===t||t(e)}),i)}})}},22692:(e,t,r)=>{r.d(t,{h:()=>o});var n=r(56711),s=r(24362),l=r(75859);const a=(0,s.cn)("table-skeleton"),o=e=>{let{rows:t=2,className:r}=e;return(0,l.jsxs)("div",{className:a(null,r),children:[(0,l.jsxs)("div",{className:a("row"),children:[(0,l.jsx)(n.O,{className:a("col-1")}),(0,l.jsx)(n.O,{className:a("col-2")}),(0,l.jsx)(n.O,{className:a("col-3")}),(0,l.jsx)(n.O,{className:a("col-4")}),(0,l.jsx)(n.O,{className:a("col-5")})]}),[...new Array(t)].map(((e,t)=>(0,l.jsx)("div",{className:a("row"),children:(0,l.jsx)(n.O,{className:a("col-full")})},"skeleton-row-".concat(t))))]})}},47101:(e,t,r)=>{r.d(t,{l:()=>o});var n=r(24362),s=r(22692),l=r(75859);const a=(0,n.cn)("ydb-table-with-controls-layout"),o=e=>{let{children:t,className:r}=e;return(0,l.jsx)("div",{className:a(null,r),children:t})};o.Controls=function(e){let{children:t,className:r}=e;return(0,l.jsx)("div",{className:a("controls-wrapper"),children:(0,l.jsx)("div",{className:a("controls",r),children:t})})},o.Table=function(e){let{children:t,loading:r,className:n}=e;return r?(0,l.jsx)(s.h,{className:a("loader")}):(0,l.jsx)("div",{className:a("table",n),children:t})}},43989:(e,t,r)=>{r.d(t,{X:()=>a});var n=r(79734),s=r(51688),l=r(75859);const a=e=>{let{value:t,onChange:r,className:a}=e;return(0,l.jsxs)(n.E,{value:t,onUpdate:r,className:a,children:[(0,l.jsx)(n.E.Option,{value:s.Uu.All,children:s.qU[s.Uu.All]}),(0,l.jsx)(n.E.Option,{value:s.Uu.SmallUptime,children:s.qU[s.Uu.SmallUptime]})]})}},80588:(e,t,r)=>{r.d(t,{V:()=>ze});var n=r(52317),s=r(17096),l=r(52846),a=r(82073),o=r(8747),i=r(95829),d=r(95408);const u=d.z.nativeEnum(i.G).catch(i.G.all),c=d.z.nativeEnum(i.d).catch(i.d.groups);var m=r(51688),h=r(68963),p=r(49201),g=r(30629),v=r(43989),f=r(79734),b=r(75859);const w={[i.d.groups]:"Groups",[i.d.nodes]:"Nodes"},x=e=>{let{value:t,onChange:r}=e;return(0,b.jsxs)(f.E,{value:t,onUpdate:r,qa:"storage-type-filter",children:[(0,b.jsx)(f.E.Option,{value:i.d.groups,children:w[i.d.groups]}),(0,b.jsx)(f.E.Option,{value:i.d.nodes,children:w[i.d.nodes]})]})},N={[i.G.all]:"All",[i.G.missing]:"Degraded",[i.G.space]:"Out of Space"},j=e=>{let{value:t,onChange:r}=e;return(0,b.jsxs)(f.E,{value:t,onUpdate:r,qa:"storage-visible-entities-filter",children:[(0,b.jsx)(f.E.Option,{value:i.G.missing,children:N[i.G.missing]}),(0,b.jsx)(f.E.Option,{value:i.G.space,children:N[i.G.space]}),(0,b.jsx)(f.E.Option,{value:i.G.all,children:N[i.G.all]})]})};var y=r(2418),C=r(69214),S=r(24362),E=r(10703),O=r(30817);const U=JSON.parse('{"label":"Usage:","default_value":"Any","groups_count":["{{count}} group","{{count}} groups","{{count}} groups","No groups"]}'),I=JSON.parse('{"label":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435:","default_value":"\u041b\u044e\u0431\u043e\u0435","groups_count":["{{count}} \u0433\u0440\u0443\u043f\u043f\u0430","{{count}} \u0433\u0440\u0443\u043f\u043f\u044b","{{count}} \u0433\u0440\u0443\u043f\u043f","\u041d\u0435\u0442 \u0433\u0440\u0443\u043f\u043f"]}'),A=(0,O.wZ)("ydb-usage-filter",{ru:I,en:U}),F=(0,S.cn)("usage-filter"),G=e=>{const{className:t,value:r=[],groups:n=[],onChange:s,debounce:l=200}=e,[a,o]=h.useState(r),i=h.useRef();h.useEffect((()=>{o((e=>e.join(",")!==r.join(",")?r:e))}),[r]);const d=h.useMemo((()=>n.map((e=>{let{threshold:t,count:r}=e;return{value:String(t),text:"".concat(t,"%"),data:{count:r}}}))),[n]),u=Math.max(...n.map((e=>{let{count:t}=e;return t})));return(0,b.jsx)(y.P,{className:F(null,t),label:A("label"),value:a,placeholder:A("default_value"),options:d,multiple:!0,onUpdate:e=>{o(e),window.clearTimeout(i.current),i.current=window.setTimeout((()=>{null===s||void 0===s||s(e)}),l)},renderOption:e=>{let{value:t,data:r,text:n}=e;return(0,b.jsxs)("div",{className:F("option"),children:[(0,b.jsx)(C.A,{className:F("option-title"),status:(0,E.CZ)(Number(t)),name:n,size:"xs"}),(0,b.jsxs)("div",{className:F("option-meta"),children:[A("groups_count",{count:r.count}),(0,b.jsx)("div",{className:F("option-bar"),style:{width:"".concat(r.count/u*100,"%")}})]})]})},getOptionHeight:()=>50,popupWidth:280,disabled:0===n.length})},_=JSON.parse('{"groups":"Groups","nodes":"Nodes","controls_groups-search-placeholder":"Group ID, Pool name","controls_nodes-search-placeholder":"Node ID, FQDN"}'),D=JSON.parse('{"groups":"\u0413\u0440\u0443\u043f\u043f\u044b","nodes":"\u041d\u043e\u0434\u044b","controls_groups-search-placeholder":"ID \u0433\u0440\u0443\u043f\u043f\u044b, \u0438\u043c\u044f \u043f\u0443\u043b\u0430","controls_nodes-search-placeholder":"ID \u0443\u0437\u043b\u0430, FQDN"}'),P=(0,O.wZ)("ydb-storage",{ru:D,en:_}),k=(0,S.cn)("global-storage"),R=e=>{let{searchValue:t,handleSearchValueChange:r,withTypeSelector:n,storageType:s,handleStorageTypeChange:l,visibleEntities:a,handleVisibleEntitiesChange:o,nodesUptimeFilter:d,handleNodesUptimeFilterChange:u,withGroupsUsageFilter:c,groupsUsageFilter:m,groupsUsageFilterOptions:f,handleGroupsUsageFilterChange:w,entitiesCountCurrent:N,entitiesCountTotal:y,entitiesLoading:C}=e;const S=s===i.d.nodes,E=P(S?"nodes":"groups");return(0,b.jsxs)(h.Fragment,{children:[(0,b.jsx)(g.o,{value:t,onChange:r,placeholder:P(S?"controls_nodes-search-placeholder":"controls_groups-search-placeholder"),className:k("search")}),n&&(0,b.jsx)(x,{value:s,onChange:l}),(0,b.jsx)(j,{value:a,onChange:o}),S&&(0,b.jsx)(v.X,{value:d,onChange:u}),!S&&c&&(0,b.jsx)(G,{value:m,onChange:w,groups:f}),(0,b.jsx)(p.C,{label:E,loading:C,total:y,current:N})]})};var T=r(96409),M=r(11635),L=r(17880),z=r(17176),V=r(79023),W=r(56350);const K=JSON.parse('{"default_message":"Everything is fine!","default_button_label":"Show All"}'),Z=JSON.parse('{"default_message":"\u0412\u0441\u0451 \u0432 \u043f\u043e\u0440\u044f\u0434\u043a\u0435!","default_button_label":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435"}'),H=(0,O.wZ)("ydb-storage-empty-filter",{ru:Z,en:K}),Q=e=>{let{title:t,message:r=H("default_message"),showAll:n=H("default_button_label"),onShowAll:s}=e;return(0,b.jsx)(V.u,{image:(0,b.jsx)(W.Q,{name:"thumbsUp"}),position:"left",title:t,description:r,actions:s&&[(0,b.jsx)(z.z,{onClick:s,children:n},"show-all")]})};var Y=r(43817);const J=e=>{let t,{visibleEntities:r,onShowAll:n}=e;return r===i.G.space&&(t=(0,Y.Z)("empty.out_of_space")),r===i.G.missing&&(t=(0,Y.Z)("empty.degraded")),t?(0,b.jsx)(Q,{title:t,showAll:(0,Y.Z)("show_all"),onShowAll:n}):null};var q=r(77382),B=r(46393),X=r(26491),$=r(27070);const ee=(e,t)=>"getStorageGroups|offset".concat(t,"|limit").concat(e);const te=e=>{let{searchValue:t,visibleEntities:r,database:n,nodeId:s,onShowAll:l,parentContainer:a,renderControls:o,renderErrorMessage:d}=e;const u=(0,B.V)(r),c=(0,L.rU)(),m=(0,L.tS)(),p=(g=m,h.useCallback((async e=>{const{limit:t,offset:r,sortParams:n,filters:s}=e,{sortOrder:l,columnId:a}=null!==n&&void 0!==n?n:{},{searchValue:o,visibleEntities:i,database:d,nodeId:u}=null!==s&&void 0!==s?s:{},c=(0,$.A)(a,l),{groups:m,found:h,total:p}=await(0,X.R)({limit:t,offset:r,sort:c,filter:o,with:i,database:d,nodeId:u,shouldUseGroupsHandler:g},{concurrentId:ee(t,r)});return{data:m||[],found:h||0,total:p||0}}),[g]));var g;const v=h.useMemo((()=>({searchValue:t,visibleEntities:r,database:n,nodeId:s})),[t,r,n,s]);return(0,b.jsx)(T.s,{loading:!c,children:(0,b.jsx)(M.WQ,{columnsWidthLSKey:q.Ty,parentContainer:a,columns:u,fetchData:p,limit:50,renderControls:o,renderErrorMessage:d,renderEmptyDataMessage:()=>r!==i.G.all?(0,b.jsx)(J,{onShowAll:l,visibleEntities:r}):(0,Y.Z)("empty.default"),filters:v,tableName:"storage-groups"})})},re=JSON.parse('{"empty.default":"No such nodes","empty.out_of_space":"No nodes with out of space errors","empty.degraded":"No degraded nodes","empty.small_uptime":"No nodes with uptime < 1h","empty.several_filters":"No nodes match current filters combination","show_all":"Show all nodes"}'),ne=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432","empty.out_of_space":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043a\u043e\u043d\u0447\u0430\u0435\u0442\u0441\u044f \u043c\u0435\u0441\u0442\u043e","empty.degraded":"\u041d\u0435\u0442 \u0434\u0435\u0433\u0440\u0430\u0434\u0438\u0440\u043e\u0432\u0430\u0432\u0448\u0438\u0445 \u0443\u0437\u043b\u043e\u0432","empty.small_uptime":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432 \u0441 uptime < 1h","empty.several_filters":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432, \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043f\u043e\u0434 \u0442\u0435\u043a\u0443\u0449\u0438\u0435 \u0444\u0438\u043b\u044c\u0442\u0440\u044b","show_all":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435 \u0443\u0437\u043b\u044b"}'),se=(0,O.wZ)("ydb-storage-nodes",{ru:ne,en:re}),le=e=>{let t,{visibleEntities:r,nodesUptimeFilter:n,onShowAll:s}=e;return r===i.G.space&&(t=se("empty.out_of_space")),r===i.G.missing&&(t=se("empty.degraded")),n===m.Uu.SmallUptime&&(t=se("empty.small_uptime")),r!==i.G.all&&n!==m.Uu.All&&(t=se("empty.several_filters")),t?(0,b.jsx)(Q,{title:t,showAll:se("show_all"),onShowAll:s}):null};var ae=r(92092);const oe=(e,t)=>"getStorageNodes|offset".concat(t,"|limit").concat(e),ie=async e=>{const{type:t="static",storage:r=!0,limit:n,offset:s,sortParams:l,filters:a}=e,{searchValue:o,nodesUptimeFilter:i,visibleEntities:d,database:u}=null!==a&&void 0!==a?a:{},{sortOrder:c,columnId:h}=null!==l&&void 0!==l?l:{},p=await window.api.getNodes({type:t,storage:r,limit:n,offset:s,sortOrder:c,sortValue:h,filter:o,uptime:(0,m.RW)(i),visibleEntities:d,database:u},{concurrentId:oe(n,s)}),g=(0,ae.Y2)(p);return{data:g.nodes||[],found:g.found||0,total:g.total||0}};var de=r(19812),ue=r(89778),ce=r(17931);const me=(0,S.cn)("global-storage-nodes"),he=e=>me("node",{unavailable:(0,m.TA)(e)}),pe="storageNodesColumnsWidth",ge="NodeId",ve="Host",fe="DC",be="Rack",we="Uptime",xe="PDisks",Ne="Missing",je=(e,t,r)=>{const s=((e,t)=>{const r=null===e||void 0===e?void 0:e.getNodeRef;return[{name:ge,header:"Node ID",width:100,align:de.ZP.RIGHT,render:e=>{let{row:t}=e;return t.NodeId}},{name:ve,header:"Host",width:350,render:e=>{let{row:n}=e;return(0,b.jsx)(ue.k,{node:n,getNodeRef:r,database:t})},align:de.ZP.LEFT},{name:fe,header:"DC",width:100,render:e=>{let{row:t}=e;return t.DC||n.jX},align:de.ZP.LEFT},{name:be,header:"Rack",width:100,render:e=>{let{row:t}=e;return t.Rack||"\u2014"},align:de.ZP.LEFT},{name:we,header:"Uptime",width:130,sortAccessor:e=>{let{StartTime:t}=e;return t?-t:0},align:de.ZP.RIGHT,render:e=>{let{row:t}=e;return t.Uptime}},{name:Ne,header:"Missing",width:100,align:de.ZP.CENTER,defaultOrder:de.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.Missing}},{name:xe,className:me("pdisks-column"),header:"PDisks",render:e=>{var t;let{row:r}=e;return(0,b.jsx)("div",{className:me("pdisks-wrapper"),children:null===(t=r.PDisks)||void 0===t?void 0:t.map((e=>{var t;const n=null===(t=r.VDisks)||void 0===t?void 0:t.filter((t=>t.PDiskId===e.PDiskId));return(0,b.jsx)("div",{className:me("pdisks-item"),children:(0,b.jsx)(ce.l,{data:e,vDisks:n})},e.PDiskId)}))})},align:de.ZP.CENTER,sortable:!1,width:900,resizeable:!1}]})(e,r),l=s.map((e=>({...e,sortable:(0,m.oh)(e.name)})));return t!==i.G.missing?l.filter((e=>e.name!==Ne)):l},ye=e=>{let{searchValue:t,visibleEntities:r,nodesUptimeFilter:n,database:s,additionalNodesProps:l,onShowAll:a,parentContainer:o,renderControls:d,renderErrorMessage:u}=e;const c=h.useMemo((()=>({searchValue:t,visibleEntities:r,nodesUptimeFilter:n,database:s})),[t,r,n,s]),p=h.useMemo((()=>je(l,r,s)),[l,r,s]);return(0,b.jsx)(M.WQ,{columnsWidthLSKey:pe,parentContainer:o,columns:p,fetchData:ie,rowHeight:51,limit:50,renderControls:d,renderErrorMessage:u,renderEmptyDataMessage:()=>r!==i.G.all||n!==m.Uu.All?(0,b.jsx)(le,{onShowAll:a,nodesUptimeFilter:n,visibleEntities:r}):se("empty.default"),getRowClassName:he,filters:c,tableName:"storage-nodes"})},Ce=e=>{var t;let{database:r,nodeId:n,parentContainer:s,additionalNodesProps:d}=e;const[h,p]=(0,l.useQueryParams)({type:l.StringParam,visible:l.StringParam,search:l.StringParam,uptimeFilter:l.StringParam}),g=c.parse(h.type),v=u.parse(h.visible),f=null!==(t=h.search)&&void 0!==t?t:"",w=m.U8.parse(h.uptimeFilter),x=e=>{p({search:e||void 0},"replaceIn")},N=e=>{p({visible:e},"replaceIn")},j=e=>{p({type:e},"replaceIn")},y=e=>{p({uptimeFilter:e},"replaceIn")},C=()=>{p({visible:i.G.all,uptimeFilter:m.Uu.All},"replaceIn")},S=e=>{let{totalEntities:t,foundEntities:r,inited:s}=e;return(0,b.jsx)(R,{searchValue:f,handleSearchValueChange:x,withTypeSelector:!n,storageType:g,handleStorageTypeChange:j,visibleEntities:v,handleVisibleEntitiesChange:N,nodesUptimeFilter:w,handleNodesUptimeFilterChange:y,withGroupsUsageFilter:!1,entitiesCountCurrent:r,entitiesCountTotal:t,entitiesLoading:!s})},E=e=>403===e.status?(0,b.jsx)(a.J,{position:"left"}):(0,b.jsx)(o.V,{error:e});return g===i.d.nodes?(0,b.jsx)(ye,{searchValue:f,visibleEntities:v,nodesUptimeFilter:w,database:r,additionalNodesProps:d,onShowAll:C,parentContainer:s,renderControls:S,renderErrorMessage:E}):(0,b.jsx)(te,{searchValue:f,visibleEntities:v,database:r,nodeId:n,onShowAll:()=>{N(i.G.all)},parentContainer:s,renderControls:S,renderErrorMessage:E})};var Se=r(86969),Ee=r(1440),Oe=r(26688),Ue=r(47101),Ie=r(15106),Ae=r(14223);const Fe=e=>e.trim().toLowerCase(),Ge=(e,t)=>{const r=Fe(t);return r?e.filter((e=>{var t,n;return(null===(t=e.NodeId)||void 0===t?void 0:t.toString().includes(r))||(null===(n=e.Host)||void 0===n?void 0:n.toLowerCase().includes(r))})):e},_e=(e,t)=>{const r=Fe(t);return r?e.filter((e=>{var t,n;return(null===(t=e.PoolName)||void 0===t?void 0:t.toLowerCase().includes(r))||(null===(n=e.GroupId)||void 0===n?void 0:n.toString().includes(r))})):e},De=(e,t)=>Array.isArray(t)&&0!==t.length?e.filter((e=>{const r=e.Usage;return t.some((e=>Number(e)<=r&&r<Number(e)+5))})):e;var Pe=r(33058),ke=r(2098);function Re(e){let{data:t,tableSettings:r,visibleEntities:n,onShowAll:s,sort:l,handleSort:a}=e;const o=(0,B.V)(n);return t.length||n===i.G.all?(0,b.jsx)(ke.G,{columnsWidthLSKey:q.Ty,data:t,columns:o,settings:r,emptyDataMessage:(0,Y.Z)("empty.default"),sortOrder:l,onSort:a},n):(0,b.jsx)(J,{onShowAll:s,visibleEntities:n})}function Te(e){let{data:t,tableSettings:r,visibleEntities:n,onShowAll:s,nodesUptimeFilter:l,additionalNodesProps:a,sort:o,handleSort:d,database:u}=e;const c=je(a,n,u);return t.length||n===i.G.all&&l===m.Uu.All?(0,b.jsx)(ke.G,{columnsWidthLSKey:pe,data:t,columns:c,settings:{...r,dynamicRenderType:"variable"},emptyDataMessage:se("empty.default"),rowClassName:he,sortOrder:o,onSort:d},n):(0,b.jsx)(le,{visibleEntities:n,nodesUptimeFilter:l,onShowAll:s})}const Me=(0,l.withDefault)({encode:l.ArrayParam.encode,decode:e=>null===e||void 0===e?e:Array.isArray(e)?e.filter(Boolean):e?[e]:[]},[]),Le=e=>{var t;let{additionalNodesProps:r,database:a,nodeId:o}=e;const d=(0,L.rU)(),p=(0,L.tS)(),[g]=(0,s.Rj)(),[v,f]=(0,l.useQueryParams)({type:l.StringParam,visible:l.StringParam,search:l.StringParam,uptimeFilter:l.StringParam,usageFilter:Me}),w=c.parse(v.type),x=u.parse(v.visible),N=null!==(t=v.search)&&void 0!==t?t:"",j=m.U8.parse(v.uptimeFilter),y=v.usageFilter,[C,S]=h.useState({sortOrder:void 0,sortValue:void 0}),O=C.sortValue?C:E.TP,[U,I]=h.useState({sortOrder:void 0,sortValue:void 0}),A=U.sortOrder?U:(0,E._r)(x),F=Pe.y.useGetStorageNodesInfoQuery({database:a,visibleEntities:x,node_id:o},{skip:w!==i.d.nodes,pollingInterval:g}),G=Pe.y.useGetStorageGroupsInfoQuery({database:a,with:x,nodeId:o,shouldUseGroupsHandler:p},{skip:w!==i.d.groups||!d,pollingInterval:g}),{currentData:_,isFetching:D,error:P}=w===i.d.nodes?F:G,{currentData:{nodes:T=[]}={}}=F,{currentData:{groups:M=[]}={}}=G,{nodes:z,groups:V,...W}=null!==_&&void 0!==_?_:{found:0,total:0},K=void 0===_&&D,Z=h.useMemo((()=>function(e,t,r){let n=e||[];return n=Ge(n,t),n=(0,Ae.f)(n,r),n}(T,N,j)),[N,T,j]),H=h.useMemo((()=>function(e,t,r){let n=e||[];return n=_e(n,t),n=De(n,r),n}(M,N,y)),[N,M,y]),Q=h.useMemo((()=>function(e){const t={};return null===e||void 0===e||e.forEach((e=>{const r=(0,Ie.I)(e,5);Object.prototype.hasOwnProperty.call(t,r)||(t[r]=0),t[r]+=1})),Object.entries(t).map((e=>{let[t,r]=e;return{threshold:Number(t),count:r}})).sort(((e,t)=>t.threshold-e.threshold))}(M)),[M]),[Y,J]=(0,s.sC)(O,(e=>S(e))),[q,B]=(0,s.sC)(A,(e=>I(e))),X=e=>{f({usageFilter:e.length?e:void 0},"replaceIn")},$=e=>{f({search:e||void 0},"replaceIn")},ee=e=>{f({visible:e},"replaceIn")},te=e=>{f({type:e},"replaceIn")},re=e=>{f({uptimeFilter:e},"replaceIn")},ne=()=>{ee(i.G.all),re(m.Uu.All)};return(0,Ee.u)(P)?(0,b.jsx)(Se.J,{position:"left"}):(0,b.jsxs)(Ue.l,{children:[(0,b.jsx)(Ue.l.Controls,{children:(0,b.jsx)(R,{searchValue:N,handleSearchValueChange:$,withTypeSelector:!0,storageType:w,handleStorageTypeChange:te,visibleEntities:x,handleVisibleEntitiesChange:ee,nodesUptimeFilter:j,handleNodesUptimeFilterChange:re,groupsUsageFilter:y,groupsUsageFilterOptions:Q,handleGroupsUsageFilterChange:X,entitiesCountCurrent:w===i.d.groups?H.length:Z.length,entitiesCountTotal:W.total,entitiesLoading:K})}),P?(0,b.jsx)(Oe.V,{error:P}):null,(0,b.jsx)(Ue.l.Table,{loading:K||!d,className:k("table"),children:_?(0,b.jsxs)(h.Fragment,{children:[w===i.d.groups&&(0,b.jsx)(Re,{visibleEntities:x,data:H,tableSettings:n.LE,onShowAll:()=>ee(i.G.all),sort:q,handleSort:B},"groups"),w===i.d.nodes&&(0,b.jsx)(Te,{visibleEntities:x,nodesUptimeFilter:j,data:Z,tableSettings:n.LE,onShowAll:ne,additionalNodesProps:r,sort:Y,handleSort:J,database:a},"nodes")]}):null})]})},ze=e=>{let{parentContainer:t,...r}=e;const[l]=(0,s.yu)(n.Qy);return l?(0,b.jsx)(Ce,{parentContainer:t,...r}):(0,b.jsx)(Le,{...r})}},14223:(e,t,r)=>{r.d(t,{A:()=>m,f:()=>u});var n=r(75850),s=r(52317),l=r(34301),a=r(27070),o=r(51688),i=r(80839);const d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(arguments.length>1?arguments[1]:void 0)===i.pu.ALL?e:e.filter((e=>{let{SystemState:t}=e;return t&&t!==n.K.Green}))},u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(arguments.length>1?arguments[1]:void 0)===o.Uu.All?e:e.filter((e=>{let{StartTime:t}=e;return!t||(0,l.OW)(t)<s.RQ}))},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!t)return e;const r=(0,a.Y)(t);return e.filter((e=>!e.Host||(r.test(e.Host)||r.test(String(e.NodeId)))))};function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{uptimeFilter:t,searchValue:r,problemFilter:n}=arguments.length>1?arguments[1]:void 0,s=u(e,t);return s=d(s,n),s=c(s,r),s}},83496:(e,t,r)=>{r.d(t,{FW:()=>a,KR:()=>o});var n=r(75850),s=r(28164);const l={[s.g.Dead]:n.K.Red,[s.g.Created]:n.K.Yellow,[s.g.ResolveStateStorage]:n.K.Yellow,[s.g.Candidate]:n.K.Yellow,[s.g.BlockBlobStorage]:n.K.Yellow,[s.g.WriteZeroEntry]:n.K.Yellow,[s.g.Restored]:n.K.Yellow,[s.g.Discover]:n.K.Yellow,[s.g.Lock]:n.K.Yellow,[s.g.Stopped]:n.K.Yellow,[s.g.ResolveLeader]:n.K.Yellow,[s.g.RebuildGraph]:n.K.Yellow,[s.g.Deleted]:n.K.Green,[s.g.Active]:n.K.Green},a=(Object.keys(s.g),Object.entries(l).reduce(((e,t)=>{let[r,n]=t;return e[n]?e[n].push(r):e[n]=[r],e}),{}),e=>{if(!e)return n.K.Grey;return t=e,Object.values(n.K).includes(t)?e:l[e];var t});function o(e){if(!e)return"unknown";switch(e){case s.g.Dead:return"danger";case s.g.Active:case s.g.Deleted:return"success";default:return"warning"}}}}]);