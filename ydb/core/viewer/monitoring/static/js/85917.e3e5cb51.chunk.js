"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[85917],{80208:(i,e,o)=>{o.r(e),o.d(e,{VDiskPage:()=>C});var d=o(59284);const t=i=>d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},i),d.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.28 4.78a.75.75 0 0 0 0-1.06l-2.5-2.5a.75.75 0 1 0-1.06 1.06L6.94 3.5H1.75a.75.75 0 1 0 0 1.5h5.19L5.72 6.22a.75.75 0 1 0 1.06 1.06zm-.06 3.94-2.5 2.5a.75.75 0 0 0 0 1.06l2.5 2.5a.75.75 0 1 0 1.06-1.06L9.06 12.5h5.19a.75.75 0 0 0 0-1.5H9.06l1.22-1.22a.75.75 0 1 0-1.06-1.06M14 4.25a1.75 1.75 0 1 1-3.5 0 1.75 1.75 0 0 1 3.5 0M3.75 13.5a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5",clipRule:"evenodd"}));var s=o(99991),n=o(4980),a=o(61750),r=o(80987),l=o(22983),v=o(3685),u=o(44508),c=o(42655),k=o(58389),D=o(67808),g=o(21334),I=o(67028),p=o(40174),f=o(7187),m=o(27295),w=o(78034);const h=g.F.injectEndpoints({endpoints:i=>({getVDiskData:i.query({queryFn:async({nodeId:i,pDiskId:e,vDiskSlotId:o},{signal:d})=>{try{const t=await Promise.all([window.api.viewer.getVDiskInfo({nodeId:i,pDiskId:e,vDiskSlotId:o},{signal:d}),window.api.viewer.getNodeWhiteboardPDiskInfo({nodeId:i,pDiskId:e},{signal:d}),window.api.viewer.getNodeInfo(i,{signal:d})]);return{data:function([i,e,o]){var d,t,s,n,a,r,l;const v=null===(d=i.VDiskStateInfo)||void 0===d?void 0:d[0],u=(0,m.WT)(v),c=null===(t=e.PDiskStateInfo)||void 0===t?void 0:t[0],k=(0,m.or)(c),D=null===(s=o.SystemStateInfo)||void 0===s?void 0:s[0],g=(0,w.q1)(D),I=null!==(n=null!==(a=u.NodeId)&&void 0!==a?a:k.NodeId)&&void 0!==n?n:g.NodeId,p=g.Host,f=null===(r=g.Roles)||void 0===r?void 0:r[0],h=g.DC,b=null!==(l=u.PDiskId)&&void 0!==l?l:k.PDiskId,N=k.Type;return{...u,NodeId:I,NodeHost:p,NodeType:f,NodeDC:h,PDiskId:b,PDiskType:N}}(t)}}catch(t){return{error:t}}},providesTags:(i,e,o)=>["All",{type:"VDiskData",id:(0,f.gh)(o.nodeId,o.pDiskId,o.vDiskSlotId)}]})}),overrideExisting:"throw"});var b=o(7435),N=o(77506),y=o(69063),x=o(12888),S=o(47199),P=o(48372);const V=JSON.parse('{"fqdn":"FQDN","node":"Node","pdisk":"PDisk","vdisk":"VDisk","storage":"Storage","evict-vdisk-button":"Evict VDisk","force-evict-vdisk-button":"Evict anyway","evict-vdisk-dialog-header":"Evict VDisk","evict-vdisk-dialog-text":"VDisk will be evicted. Do you want to proceed?","evict-vdisk-not-allowed":"You don\'t have enough rights to evict VDisk"}'),$=(0,P.g4)("ydb-vDisk-page",{en:V});var j=o(60712);const T=(0,N.cn)("ydb-vdisk-page");function C(){const i=(0,y.YQ)(),e=d.useRef(null),o=(0,x.X)(),m=(0,I.c2)(),[{nodeId:w,pDiskId:N,vDiskSlotId:P,vDiskId:V}]=(0,r.useQueryParams)({nodeId:r.StringParam,pDiskId:r.StringParam,vDiskSlotId:r.StringParam,vDiskId:r.StringParam});d.useEffect((()=>{i((0,p.g)("vDisk",{nodeId:w,pDiskId:N,vDiskSlotId:P}))}),[i,w,N,P]);const[C]=(0,y.Nt)(),E=(0,b.f8)(w)&&(0,b.f8)(N)&&(0,b.f8)(P)?{nodeId:w,pDiskId:N,vDiskSlotId:P}:n.hT,{currentData:R,isFetching:G,error:F}=h.useGetVDiskDataQuery(E,{pollingInterval:C}),B=G&&void 0===R,{NodeHost:H,NodeId:q,NodeType:M,NodeDC:Y,PDiskId:Q,PDiskType:_,Severity:A,VDiskId:L}=R||{},{GroupID:O,GroupGeneration:z,Ring:W,Domain:X,VDisk:J}=L||!B&&function(i){const e=/^(\d+)-(\d+)-(\d+)-(\d+)-(\d+)$/.exec(null!==i&&void 0!==i?i:"");if(!e)return;const[,o,d,t,s,n]=e;return{GroupID:Number(o),GroupGeneration:Number(d),Ring:Number(t),Domain:Number(s),VDisk:Number(n)}}(V)||{},K=(0,b.f8)(O)&&(0,b.f8)(z)&&(0,b.f8)(W)&&(0,b.f8)(X)&&(0,b.f8)(J),U=async i=>{if(K){var e;const o={groupId:O,groupGeneration:z,failRealmIdx:W,failDomainIdx:X,vDiskIdx:J,force:i};let d;if(d=m?await window.api.vdisk.evictVDisk(o):await window.api.tablets.evictVDiskOld(o),!1===(null===(e=d)||void 0===e?void 0:e.result)){throw{statusText:d.error,retryPossible:d.forceRetryPossible}}}},Z=()=>{i(g.F.util.invalidateTags([{type:"VDiskData",id:(0,f.gh)(w||0,N||0,P||0)},"StorageData"]))};return(0,j.jsxs)("div",{className:T(null),ref:e,children:[(()=>{const i=P?`${$("vdisk")} ${P}`:$("vdisk"),e=N?`${$("pdisk")} ${N}`:$("pdisk"),o=H||$("node");return(0,j.jsx)(a.mg,{titleTemplate:`%s - ${i} - ${e} \u2014 ${o} \u2014 YDB Monitoring`,defaultTitle:`${i} - ${e} \u2014 ${o} \u2014 YDB Monitoring`})})(),(()=>{const i=H?`${$("fqdn")}: ${H}`:void 0,e=q?`${$("node")}: ${q}`:void 0,o=q?`${$("pdisk")}: ${Q}`:void 0;return(0,j.jsx)(k.B,{className:T("meta"),loading:B,items:[i,e,M,Y,o,_]})})(),(0,j.jsx)(v.$,{className:T("title"),entityName:$("vdisk"),status:(0,f.XY)(A),id:(null===R||void 0===R?void 0:R.StringifiedId)||!B&&V}),(0,j.jsx)("div",{className:T("controls"),children:(0,j.jsxs)(l.B,{onConfirmAction:U,onConfirmActionSuccess:Z,buttonDisabled:!K||!o,buttonView:"normal",dialogHeader:$("evict-vdisk-dialog-header"),dialogText:$("evict-vdisk-dialog-text"),retryButtonText:$("force-evict-vdisk-button"),withPopover:!0,popoverContent:$("evict-vdisk-not-allowed"),popoverDisabled:o,children:[(0,j.jsx)(s.I,{data:t}),$("evict-vdisk-button")]})}),B?(0,j.jsx)(c.y,{rows:9}):(0,j.jsxs)(d.Fragment,{children:[F?(0,j.jsx)(u.o,{error:F}):null,(0,j.jsx)(D.E,{data:R,className:T("info"),wrap:!0}),(0,b.f8)(O)&&(0,b.f8)(w)?(0,j.jsxs)(d.Fragment,{children:[(0,j.jsx)("div",{className:T("storage-title"),children:$("storage")}),(0,j.jsx)(S.z,{groupId:O,nodeId:w,pDiskId:null!==N&&void 0!==N?N:void 0,scrollContainerRef:e,viewContext:{groupId:null===O||void 0===O?void 0:O.toString(),nodeId:null===w||void 0===w?void 0:w.toString(),pDiskId:null===N||void 0===N?void 0:N.toString(),vDiskSlotId:null===P||void 0===P?void 0:P.toString()}})]}):null]})]})}}}]);