"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[88117],{3685:(e,s,a)=>{a.d(s,{$:()=>o});var t=a(54090),l=a(77506),i=a(33775),n=a(60712);const r=(0,l.cn)("ydb-entity-page-title");function o({entityName:e,status:s=t.m.Grey,id:a,className:l}){return(0,n.jsxs)("div",{className:r(null,l),children:[(0,n.jsx)("span",{className:r("prefix"),children:e}),(0,n.jsx)(i.k,{className:r("icon"),status:s,size:"s"}),a]})}},42655:(e,s,a)=>{a.d(s,{y:()=>c});var t=a(59284),l=a(1608),i=a(77506),n=a(66781),r=a(60712);const o=(0,i.cn)("ydb-info-viewer-skeleton"),d=()=>(0,r.jsxs)("div",{className:o("label"),children:[(0,r.jsx)(l.E,{className:o("label__text")}),(0,r.jsx)("div",{className:o("label__dots")})]}),c=({rows:e=8,className:s,delay:a=600})=>{const[i]=(0,n.y)(a);let c=(0,r.jsxs)(t.Fragment,{children:[(0,r.jsx)(d,{}),(0,r.jsx)(l.E,{className:o("value")})]});return i||(c=null),(0,r.jsx)("div",{className:o(null,s),children:[...new Array(e)].map(((e,s)=>(0,r.jsx)("div",{className:o("row"),children:c},`skeleton-row-${s}`)))})}},45659:(e,s,a)=>{a.d(s,{Q:()=>g});var t=a(32752),l=a(92459),i=a(7435),n=a(46549),r=a(56839),o=a(31684),d=a(12888),c=a(18863),u=a(25196),v=a(15132),p=a(33775),h=a(50672),m=a(60712);function g({pDisk:e,nodeId:s,withPDiskPageLink:a,className:g}){const f=(0,d.X)(),[j,b,x,N]=function({pDisk:e,nodeId:s,withPDiskPageLink:a,isUserAllowedToMakeChanges:d}){const{PDiskId:c,Path:g,Guid:f,Category:j,Type:b,Device:x,Realtime:N,State:k,SerialNumber:I,TotalSize:y,AllocatedSize:S,AllocatedPercent:D,StatusV2:w,NumActiveSlots:T,ExpectedSlotCount:z,LogUsedSize:P,LogTotalSize:R,SystemSize:C,SharedWithOs:A}=e||{},E=[];(0,i.f8)(j)&&E.push({label:(0,h.D)("type"),value:b}),(0,i.f8)(g)&&E.push({label:(0,h.D)("path"),value:g}),(0,i.f8)(f)&&E.push({label:(0,h.D)("guid"),value:f}),I&&E.push({label:(0,h.D)("serial-number"),value:I}),A&&E.push({label:(0,h.D)("shared-with-os"),value:(0,h.D)("yes")});const V=[];(0,i.f8)(w)&&V.push({label:(0,h.D)("drive-status"),value:w}),(0,i.f8)(k)&&V.push({label:(0,h.D)("state"),value:k}),(0,i.f8)(x)&&V.push({label:(0,h.D)("device"),value:(0,m.jsx)(p.k,{status:x})}),(0,i.f8)(N)&&V.push({label:(0,h.D)("realtime"),value:(0,m.jsx)(p.k,{status:N})});const U=[];U.push({label:(0,h.D)("space"),value:(0,m.jsx)(v.O,{value:S,capacity:y,formatValues:r.vX,colorizeProgress:!0})}),isNaN(Number(D))||U.push({label:(0,h.D)("usage"),value:`${D}%`}),(0,i.f8)(T)&&(0,i.f8)(z)&&U.push({label:(0,h.D)("slots"),value:(0,m.jsx)(v.O,{value:T,capacity:z})}),(0,i.f8)(P)&&(0,i.f8)(R)&&U.push({label:(0,h.D)("log-size"),value:(0,m.jsx)(v.O,{value:P,capacity:R,formatValues:r.vX})}),(0,i.f8)(C)&&U.push({label:(0,h.D)("system-size"),value:(0,n.z3)({value:C})});const _=[];if((a||d)&&(0,i.f8)(c)&&(0,i.f8)(s)){const e=(0,l.Ck)(c,s),i=(0,o.ar)({nodeId:s,pDiskId:c});_.push({label:(0,h.D)("links"),value:(0,m.jsxs)(t.s,{wrap:"wrap",gap:2,children:[a&&(0,m.jsx)(u.K,{title:(0,h.D)("pdisk-page"),url:e,external:!1}),d&&(0,m.jsx)(u.K,{title:(0,h.D)("developer-ui"),url:i})]})})}return[E,V,U,_]}({pDisk:e,nodeId:s,withPDiskPageLink:a,isUserAllowedToMakeChanges:f});return(0,m.jsxs)(t.s,{className:g,gap:2,direction:"row",wrap:!0,children:[(0,m.jsxs)(t.s,{direction:"column",gap:2,width:500,children:[(0,m.jsx)(c.z,{info:j,renderEmptyState:()=>null}),(0,m.jsx)(c.z,{info:x,renderEmptyState:()=>null})]}),(0,m.jsxs)(t.s,{direction:"column",gap:2,width:500,children:[(0,m.jsx)(c.z,{info:b,renderEmptyState:()=>null}),(0,m.jsx)(c.z,{info:N,renderEmptyState:()=>null})]})]})}},52248:(e,s,a)=>{a.d(s,{a:()=>t.a});var t=a(47334)},58389:(e,s,a)=>{a.d(s,{B:()=>u});var t=a(32752),l=a(77506),i=a(90053),n=a(70043),r=a(60712);const o=(0,l.cn)("ydb-page-meta"),d="\xa0\xa0\xb7\xa0\xa0";function c({items:e,loading:s}){return(0,r.jsx)("div",{className:o("info"),children:s?(0,r.jsx)(n.E,{className:o("skeleton")}):e.filter((e=>Boolean(e))).join(d)})}function u({className:e,...s}){return(0,r.jsxs)(t.s,{gap:1,alignItems:"center",justifyContent:"space-between",className:o(null,e),children:[(0,r.jsx)(c,{...s}),(0,r.jsx)(i.E,{})]})}},67808:(e,s,a)=>{a.d(s,{E:()=>k});a(59284);var t=a(32752),l=a(13847),i=a(92459),n=a(67375),r=a(77506),o=a(56839),d=a(31684),c=a(7187),u=a(28232),v=a(12888),p=a(41650),h=a(60073),m=a(44294),g=a(25196),f=a(15132),j=a(33775),b=a(39110),x=a(60712);const N=(0,r.cn)("ydb-vdisk-info");function k({data:e,withVDiskPageLink:s,withTitle:a,className:r,wrap:c}){var k,y;const S=(0,v.X)(),D=(0,u.J)(),{AllocatedSize:w,SizeLimit:T,AllocatedPercent:z,DiskSpace:P,FrontQueues:R,Guid:C,Replicated:A,ReplicationProgress:E,ReplicationSecondsRemaining:V,Donors:U,VDiskState:_,VDiskSlotId:L,Kind:O,SatisfactionRank:F,HasUnreadableBlobs:M,IncarnationGuid:$,InstanceGuid:G,StoragePoolName:X,ReadThroughput:K,WriteThroughput:W,PDiskId:q,StringifiedId:H,NodeId:Q}=e||{},B=[];var Z,J;((0,l.isNil)(X)||B.push({label:(0,b.r)("pool-name"),value:X}),(0,l.isNil)(_)||B.push({label:(0,b.r)("state-status"),value:_}),Number(w)>=0&&Number(T)>=0&&B.push({label:(0,b.r)("size"),value:(0,x.jsx)(f.O,{value:w,capacity:T,formatValues:o.vX,colorizeProgress:!0})}),isNaN(Number(z))||B.push({label:(0,b.r)("usage"),value:`${z}%`}),(0,l.isNil)(P)||B.push({label:(0,b.r)("space-status"),value:(0,x.jsx)(j.k,{status:P})}),(0,l.isNil)(R)||B.push({label:(0,b.r)("front-queues"),value:(0,x.jsx)(j.k,{status:R})}),(0,l.isNil)(null===F||void 0===F||null===(k=F.FreshRank)||void 0===k?void 0:k.Flag))||B.push({label:(0,b.r)("fresh-rank-satisfaction"),value:(0,x.jsx)(j.k,{status:null===F||void 0===F||null===(Z=F.FreshRank)||void 0===Z?void 0:Z.Flag})});(0,l.isNil)(null===F||void 0===F||null===(y=F.LevelRank)||void 0===y?void 0:y.Flag)||B.push({label:(0,b.r)("level-rank-satisfaction"),value:(0,x.jsx)(j.k,{status:null===F||void 0===F||null===(J=F.LevelRank)||void 0===J?void 0:J.Flag})});(0,l.isNil)(K)||B.push({label:(0,b.r)("read-throughput"),value:(0,p.O4)(K)}),(0,l.isNil)(W)||B.push({label:(0,b.r)("write-throughput"),value:(0,p.O4)(W)});const Y=[];if((0,l.isNil)(A)||Y.push({label:(0,b.r)("replication-status"),value:A?(0,b.r)("yes"):(0,b.r)("no")}),!1===A&&_===n.W.OK&&((0,l.isNil)(E)||Y.push({label:(0,b.r)("replication-progress"),value:(0,x.jsx)(f.O,{value:Math.round(100*E),percents:!0,colorizeProgress:!0,capacity:100})}),!(0,l.isNil)(V))){const e=(0,o.YS)(V);e&&Y.push({label:(0,b.r)("replication-time-remaining"),value:e})}if((0,l.isNil)(L)||Y.push({label:(0,b.r)("slot-id"),value:L}),!(0,l.isNil)(q)){const e=(0,l.isNil)(Q)?void 0:(0,i.Ck)(q,Q),s=e?(0,x.jsx)(m.E,{to:e,children:q}):q;Y.push({label:(0,b.r)("label_pdisk-id"),value:s})}if((0,l.isNil)(O)||Y.push({label:(0,b.r)("kind"),value:O}),(0,l.isNil)(C)||Y.push({label:(0,b.r)("guid"),value:C}),(0,l.isNil)($)||Y.push({label:(0,b.r)("incarnation-guid"),value:$}),(0,l.isNil)(G)||Y.push({label:(0,b.r)("instance-guid"),value:G}),(0,l.isNil)(M)||Y.push({label:(0,b.r)("has-unreadable-blobs"),value:M?(0,b.r)("yes"):(0,b.r)("no")}),!1===A&&_===n.W.OK&&null!==U&&void 0!==U&&U.length){const e=U.map(((e,s)=>{const{StringifiedId:a,NodeId:t}=e;if(!a||!t)return null;const l=(0,i.yX)({nodeId:t,vDiskId:a},{database:D});return(0,x.jsx)(m.E,{to:l,children:a},s)})).filter(Boolean);e.length&&Y.push({label:(0,b.r)("donors"),value:(0,x.jsx)(t.s,{direction:"column",gap:1,children:e})})}const ee=[];if(!(0,l.isNil)(H)&&s){const e=(0,i.yX)({nodeId:Q,vDiskId:H},{database:D});ee.push((0,x.jsx)(g.K,{title:(0,b.r)("vdisk-page"),url:e,external:!1},e))}if(S&&!(0,l.isNil)(Q)&&!(0,l.isNil)(L)&&!(0,l.isNil)(q)){const e=(0,d.Wg)({nodeId:Q,pDiskId:q,vDiskSlotId:L});ee.push((0,x.jsx)(g.K,{title:(0,b.r)("developer-ui"),url:e},e))}ee.length&&Y.push({label:(0,b.r)("links"),value:(0,x.jsx)(t.s,{wrap:"wrap",gap:2,children:ee})});const se=e&&a?(0,x.jsx)(I,{data:e}):null;return(0,x.jsxs)(t.s,{className:r,gap:2,direction:c?"row":"column",wrap:c,children:[(0,x.jsx)(h.z_,{title:se,info:B,renderEmptyState:()=>null,className:N("info")}),(0,x.jsx)(h.z_,{info:Y,renderEmptyState:()=>null,className:N("info")})]})}function I({data:e}){return(0,x.jsxs)("div",{className:N("title"),children:[(0,b.r)("vdiks-title"),(0,x.jsx)(j.k,{status:(0,c.XY)(e.Severity)}),e.StringifiedId]})}},70043:(e,s,a)=>{a.d(s,{E:()=>n});var t=a(1608),l=a(66781),i=a(60712);const n=({delay:e=600,className:s})=>{const[a]=(0,l.y)(e);return a?(0,i.jsx)(t.E,{className:s}):null}},71635:(e,s,a)=>{a.d(s,{C:()=>N});var t=a(59284),l=a(4980),i=a(13847),n=a(53850),r=a(62060),o=a.n(r),d=a(21334),c=a(24600);const u=d.F.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,{signal:s})=>{try{return{data:await window.api.viewer.getTabletsInfo(e,{signal:s})}}catch(a){return{error:a}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),v=(0,n.Mz)((e=>e),(e=>u.endpoints.getTabletsInfo.select(e)),{argsMemoize:n.i5,argsMemoizeOptions:{equalityCheck:o()}}),p=(0,n.Mz)((e=>e),((e,s)=>v(s)),((e,s)=>s(e).data)),h=(0,n.Mz)(((e,s)=>p(e,s)),((e,s)=>(0,c.K)(e,s.database)),((e,s)=>null!==e&&void 0!==e&&e.TabletStateInfo?s?e.TabletStateInfo.map((e=>{var a;const t=void 0===e.NodeId||null===(a=s.get(e.NodeId))||void 0===a?void 0:a.Host;return{...e,fqdn:t}})):e.TabletStateInfo:[]));var m=a(6354),g=a(7435),f=a(47779),j=a(88616),b=a(60712);const x=[m.r.Created,m.r.ResolveStateStorage,m.r.Candidate,m.r.BlockBlobStorage,m.r.RebuildGraph,m.r.WriteZeroEntry,m.r.Restored,m.r.Discover,m.r.Lock,m.r.Active,m.r.ResolveLeader,m.r.Terminating];function N({nodeId:e,path:s,database:a,databaseFullPath:n,onlyActive:r,scrollContainerRef:o}){const[d]=(0,f.Nt)();let c={};const v=r?`(State=[${x.join(",")}])`:void 0,p=t.useMemo((()=>{if(!(0,i.isNil)(s)&&!(0,i.isNil)(n))return{path:s,databaseFullPath:n}}),[s,n]);(0,g.f8)(e)?c={nodeId:e,database:a,filter:v}:p&&(c={path:p,database:a,filter:v});const{isLoading:m,error:N}=u.useGetTabletsInfoQuery(0===Object.keys(c).length?l.hT:c,{pollingInterval:d}),k=(0,f.N4)((e=>h(e,c)));return(0,b.jsx)(j.Q,{scrollContainerRef:o,tablets:k,database:a,loading:m,error:N,nodeId:e})}},78491:(e,s,a)=>{a.d(s,{$:()=>n});var t=a(32752),l=a(20263),i=a(60712);function n({header:e,note:s}){return(0,i.jsxs)(t.s,{gap:1,alignItems:"center",children:[e,(0,i.jsx)(l.H,{popoverProps:{placement:["right","left"]},children:s})]})}},93038:(e,s,a)=>{a.r(s),a.d(s,{Node:()=>He});var t=a(59284),l=a(96727),i=a(29859),n=a(66212),r=a(4980),o=a(61750),d=a(10755),c=a(80987),u=a(3685),v=a(44508),p=a(32752),h=a(77506),m=a(23942),g=a(18863),f=a(25196),j=a(60712);const b=(0,h.cn)("ydb-pool-usage"),x=e=>{let s="green";return e>60&&e<=80?s="yellow":e>80&&(s="red"),s},N=({data:e={}})=>{const{Threads:s,Name:a="Unknown",Usage:t=0}=e,l=t&&s,i=Math.floor(100*t),n=i>100?100:i;return(0,j.jsxs)("div",{className:b(),children:[(0,j.jsxs)("div",{className:b("info"),children:[(0,j.jsx)("div",{className:b("pool-name"),children:a}),l&&(0,j.jsxs)("div",{className:b("value"),children:[(0,j.jsxs)("div",{className:b("percents"),children:[i<1?"<1":i,"%"]}),(0,j.jsxs)("div",{className:b("threads"),children:["(\xd7",s,")"]})]})]}),(0,j.jsx)("div",{className:b("visual"),children:(0,j.jsx)("div",{className:b("usage-line",{type:x(n)}),style:{width:`${n}%`}})})]})};var k=a(15132),I=a(41826),y=a(48372);const S=JSON.parse('{"database":"Database","uptime":"Uptime","version":"Version","dc":"DC","rack":"Rack","links":"Links","la-interval-1m":"1 min","la-interval-5m":"5 min","la-interval-15m":"15 min","developer-ui":"Developer UI","no-data":"No data","title.common-info":"Common info","title.endpoints":"Endpoints","title.roles":"Roles","title.pools":"Pools","title.load-average":"Load average"}'),D=(0,y.g4)("ydb-node-info",{en:S}),w=(0,h.cn)("full-node-viewer"),T=({node:e,className:s})=>{var a,t,l,i,n;const r=(0,m.n)(e),o=[];null!==e&&void 0!==e&&null!==(a=e.Tenants)&&void 0!==a&&a.length&&o.push({label:D("database"),value:e.Tenants[0]}),o.push({label:D("version"),value:null===e||void 0===e?void 0:e.Version},{label:D("uptime"),value:(0,j.jsx)(I.p,{StartTime:null===e||void 0===e?void 0:e.StartTime,DisconnectTime:null===e||void 0===e?void 0:e.DisconnectTime})},{label:D("dc"),value:(null===e||void 0===e?void 0:e.DataCenterDescription)||(null===e||void 0===e?void 0:e.DC)}),null!==e&&void 0!==e&&e.Rack&&o.push({label:D("rack"),value:null===e||void 0===e?void 0:e.Rack}),r&&o.push({label:D("links"),value:(0,j.jsx)(f.K,{url:r,title:D("developer-ui")})});const d=null===e||void 0===e||null===(t=e.Endpoints)||void 0===t?void 0:t.map((({Name:e,Address:s})=>({label:e,value:s}))),c=null===e||void 0===e||null===(l=e.LoadAveragePercents)||void 0===l?void 0:l.map(((e,s)=>{return{label:(a=s,[D("la-interval-1m"),D("la-interval-5m"),D("la-interval-15m")][a]),value:(0,j.jsx)(k.O,{value:e,percents:!0,colorizeProgress:!0,capacity:100})};var a}));return e?(0,j.jsx)("div",{className:w(null,s),children:(0,j.jsxs)(p.s,{wrap:!0,gap:4,children:[(0,j.jsxs)(p.s,{direction:"column",gap:2,children:[(0,j.jsx)(g.z,{title:D("title.common-info"),className:w("section"),info:o}),d&&d.length?(0,j.jsx)(g.z,{title:D("title.endpoints"),className:w("section"),info:d}):null]}),(0,j.jsxs)(p.s,{direction:"column",gap:2,children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{className:w("section-title"),children:D("title.pools")}),(0,j.jsx)("div",{className:w("section",{pools:!0}),children:null===e||void 0===e||null===(i=e.PoolStats)||void 0===i?void 0:i.map(((e,s)=>(0,j.jsx)(N,{data:e},s)))})]}),(0,j.jsx)(g.z,{title:D("title.load-average"),className:w("section",{average:!0}),info:c})]}),e.Roles&&e.Roles.length?(0,j.jsx)(p.s,{direction:"column",gap:2,children:(0,j.jsxs)("div",{className:w("section"),children:[(0,j.jsx)("div",{className:w("section-title"),children:D("title.roles")}),null===e||void 0===e||null===(n=e.Roles)||void 0===n?void 0:n.map((e=>(0,j.jsx)("div",{className:w("role"),children:e},e)))]})}):null]})}):(0,j.jsx)("div",{className:"error",children:D("no-data")})};var z=a(42655),P=a(44294),R=a(58389),C=a(92459),A=a(67028),E=a(40174),V=a(21334),U=a(78034);const _=e=>{var s;if(null===(s=e.SystemStateInfo)||void 0===s||!s.length)return{};const a=e.SystemStateInfo[0];return(0,U.q1)(a)},L=V.F.injectEndpoints({endpoints:e=>({getNodeInfo:e.query({queryFn:async({nodeId:e,database:s},{signal:a})=>{try{const t=await window.api.viewer.getNodeInfo({nodeId:e,database:s},{signal:a});return{data:_(t)}}catch(t){return{error:t}}},providesTags:["All"]}),getNodeStructure:e.query({queryFn:async({nodeId:e},{signal:s})=>{try{return{data:await window.api.viewer.getStorageInfo({nodeId:e},{signal:s})}}catch(a){return{error:a}}},providesTags:["All"]})}),overrideExisting:"throw"});var O=a(47779),F=a(12888),M=a(81188),$=a(61323),G=a(37377),X=a(71635),K=a(29819),W=a(905),q=a.n(W),H=a(52248),Q=a(53850),B=a(56839),Z=a(27295);const J=(0,Q.Mz)((e=>e),(e=>L.endpoints.getNodeStructure.select({nodeId:e}))),Y=(0,Q.Mz)((e=>e),((e,s)=>J(s)),((e,s)=>s(e).data)),ee=(0,Q.Mz)(((e,s)=>Number(s)),((e,s)=>Y(e,s)),((e,s)=>{const a=null===s||void 0===s?void 0:s.StoragePools,t={};null===a||void 0===a||a.forEach((s=>{const a=s.Groups;null===a||void 0===a||a.forEach((a=>{var l;const i=null===(l=a.VDisks)||void 0===l?void 0:l.filter((s=>s.NodeId===e)).map(Z.WT);null===i||void 0===i||i.forEach((a=>{var l;const i=(0,B.U9)(a.VDiskId),n=null===(l=a.PDisk)||void 0===l?void 0:l.PDiskId;t[String(n)]||(t[String(n)]={vDisks:{},...a.PDisk}),t[String(n)].vDisks[i]={...a,PDiskId:n,NodeId:e,StoragePoolName:s.Name}}))}))}));return Object.keys(t).reduce(((e,s)=>{const a=t[s].vDisks,l=Object.keys(a).reduce(((e,s,t)=>(e.push({...a[s],id:s,order:t}),e)),[]);return e[s]={...t[s],vDisks:l},e}),{})}));var se=a(112),ae=a(45720),te=a(4557),le=a(80136),ie=a(47653),ne=a(58611),re=a(60461),oe=a(45659),de=a(33775),ce=a(67808),ue=a(54090),ve=a(67375),pe=a(7435),he=a(76086),me=a(31684),ge=a(29971);const fe=(0,h.cn)("kv-node-structure");function je({label:e,value:s,className:a}){return(0,j.jsxs)("span",{className:fe("pdisk-title-item",a),children:[e&&(0,j.jsxs)("span",{className:fe("pdisk-title-item-label"),children:[e,":"]}),(0,j.jsx)("span",{className:fe("pdisk-title-item-value"),children:s})]})}const be=(0,h.cn)("kv-node-structure");var xe=function(e){return e.slotId="VDiskSlotId",e.VDiskState="VDiskState",e.Size="Size",e.Info="Info",e}(xe||{});const Ne={VDiskSlotId:"Slot id",VDiskState:"Status",Size:"Size",Info:""};function ke({pDiskId:e,selectedVdiskId:s,nodeId:a,withDeveloperUILink:t}){return[{name:xe.slotId,header:Ne[xe.slotId],width:100,render:({row:l})=>{const i=l.VDiskSlotId;let n=null;return(0,pe.f8)(a)&&(0,pe.f8)(e)&&(0,pe.f8)(i)&&(n=(0,me.Wg)({nodeId:a,pDiskId:e,vDiskSlotId:i})),(0,j.jsxs)("div",{className:be("vdisk-id",{selected:l.id===s}),children:[(0,j.jsx)("span",{children:i}),n&&t?(0,j.jsx)(le.$,{size:"s",className:be("external-button",{hidden:!0}),href:n,target:"_blank",title:(0,ge.A)("vdisk.developer-ui-button-title"),children:(0,j.jsx)(ie.I,{data:se.A})}):null]})},align:te.Ay.LEFT},{name:xe.VDiskState,header:Ne[xe.VDiskState],width:70,render:({row:e})=>(0,j.jsx)(de.k,{status:e.VDiskState===ve.W.OK?ue.m.Green:ue.m.Red}),sortAccessor:e=>e.VDiskState===ve.W.OK?1:0,align:te.Ay.CENTER},{name:xe.Size,header:Ne[xe.Size],width:170,render:({row:e})=>(0,j.jsx)(k.O,{value:e.AllocatedSize,capacity:Number(e.AllocatedSize)+Number(e.AvailableSize),formatValues:B.vX,colorizeProgress:!0}),sortAccessor:e=>Number(e.AllocatedSize),align:te.Ay.CENTER},{name:xe.Info,header:Ne[xe.Info],width:70,render:({row:e})=>(0,j.jsx)(ne.A,{placement:["right"],content:(0,j.jsx)(ce.E,{data:e,withTitle:!0,withVDiskPageLink:!0,className:be("vdisk-details")}),children:(0,j.jsx)(le.$,{view:"flat-secondary",className:be("vdisk-details-button",{selected:e.id===s}),children:(0,j.jsx)(ie.I,{data:ae.A,size:18})})}),sortable:!1}]}function Ie({id:e,data:s,selectedVdiskId:a,nodeId:l,unfolded:i}){const n=(0,F.X)(),[r,o]=t.useState(null!==i&&void 0!==i&&i),{TotalSize:d=0,AvailableSize:c=0,Device:u,PDiskId:v,Type:p,vDisks:h}=s,m=Number(d),g=Number(c);return(0,j.jsxs)("div",{className:be("pdisk"),id:e,children:[(0,j.jsxs)("div",{className:be("pdisk-header"),children:[(0,j.jsxs)("div",{className:be("pdisk-title-wrapper"),children:[(0,j.jsx)(de.k,{status:u}),(0,j.jsx)(je,{label:"PDiskID",value:v,className:be("pdisk-title-id")}),(0,j.jsx)(je,{value:p,className:be("pdisk-title-type")}),(0,j.jsx)(k.O,{value:m-g,capacity:m,formatValues:B.vX,colorizeProgress:!0,className:be("pdisk-title-size")}),(0,j.jsx)(je,{label:"VDisks",value:h.length})]}),(0,j.jsx)(le.$,{onClick:r?()=>{o(!1)}:()=>{o(!0)},view:"flat-secondary",children:(0,j.jsx)(re.I,{direction:r?"top":"bottom"})})]}),r&&(q()(s)?(0,j.jsx)("div",{children:"No information about PDisk"}):(0,j.jsxs)("div",{children:[(0,j.jsx)(oe.Q,{pDisk:s,nodeId:l,className:be("pdisk-details"),withPDiskPageLink:!0}),(0,j.jsxs)("div",{className:be("vdisks-container"),children:[(0,j.jsx)("div",{className:be("vdisks-header"),children:"VDisks"}),(0,j.jsx)(te.Ay,{theme:"yandex-cloud",data:h,columns:ke({nodeId:l,pDiskId:v,selectedVdiskId:a,withDeveloperUILink:n}),settings:{...he.N3,dynamicRender:!1},rowClassName:e=>e.id===a?be("selected-vdisk"):""})]})]}))]})}const ye=(0,h.cn)("kv-node-structure");function Se({type:e,id:s}){return`${e}-${s}`}const De=function({nodeId:e,className:s}){const a=(0,O.N4)((s=>ee(s,e))),[l]=(0,O.Nt)(),{currentData:i,isFetching:n,error:r}=L.useGetNodeStructureQuery({nodeId:e},{pollingInterval:l}),o=n&&void 0===i,[{pdiskId:d,vdiskId:u}]=(0,c.useQueryParams)({pdiskId:c.StringParam,vdiskId:c.StringParam}),p=t.useRef(null),h=t.useRef(!1);return t.useEffect((()=>{if(!q()(a)&&!h.current&&p.current&&d){const s=document.getElementById(Se({type:"pdisk",id:d}));let t=0;if(u){var e;const s=null===(e=a[d])||void 0===e?void 0:e.vDisks,l=null===s||void 0===s?void 0:s.find((e=>e.id===u)),i=l?document.querySelector(".data-table"):void 0,n=(null===l||void 0===l?void 0:l.order)||0;i&&(t+=i.offsetTop+40*n)}s&&(p.current.scrollTo({behavior:"smooth",top:t||s.offsetTop}),h.current=!0)}}),[a,d,u]),(0,j.jsxs)("div",{className:ye(),ref:p,children:[r?(0,j.jsx)(v.o,{error:r,className:ye("error")}):null,(0,j.jsx)("div",{className:s,children:o?(0,j.jsx)(H.a,{size:"m"}):r&&!i?null:(()=>{const s=Object.keys(a);return s.length>0?s.map((s=>(0,j.jsx)(Ie,{data:a[s],id:Se({type:"pdisk",id:s}),unfolded:d===s,selectedVdiskId:u,nodeId:e},s))):"There is no information about node structure."})()})]})};var we=a(17594),Te=a(69326),ze=a(78491),Pe=a(41650),Re=a(88908);const Ce=(0,h.cn)("cpu-usage-bar");function Ae({systemUsage:e=0,userUsage:s=0,className:a}){const t=e+s,l=Math.round(100*e),i=Math.round(100*s),n=Math.round(100*t);return(0,j.jsxs)(p.s,{gap:2,className:Ce(null,a),children:[(0,j.jsx)("div",{className:Ce("progress"),children:(0,j.jsx)(k.O,{value:n,percents:!0,colorizeProgress:!0,capacity:100,className:Ce("progress")})}),(0,j.jsxs)(Re.E,{color:"secondary",children:["(Sys: ",l,"%, U: ",i,"%)"]})]})}var Ee=a(96344),Ve=a(8979);const Ue=(0,h.cn)("ydb-thread-states-bar"),_e=e=>{switch(e.toUpperCase()){case"R":return"var(--g-color-base-positive-medium)";case"S":return"var(--g-color-base-info-medium)";case"D":return"var(--g-color-base-warning-medium)";case"Z":case"T":case"X":return"var(--g-color-base-danger-medium)";default:return"var(--g-color-base-misc-medium)"}},Le=e=>{switch(e.toUpperCase()){case"R":return"success";case"S":return"info";case"D":return"warning";case"Z":case"T":case"X":return"danger";default:return"misc"}},Oe=e=>{switch(e.toUpperCase()){case"R":return"Running";case"S":return"Sleeping";case"D":return"Uninterruptible sleep";case"Z":return"Zombie";case"T":return"Stopped";case"X":return"Dead";default:return"Unknown"}};function Fe({states:e={},totalThreads:s,className:a}){const t=s||Object.values(e).reduce(((e,s)=>e+s),0);if(0===t)return he.Pd;const l=Object.entries(e).filter((([,e])=>e>0)),i=Object.entries(e).map((([e,s])=>({theme:Le(e),value:s/t*100})));return(0,j.jsxs)("div",{className:Ue(null,a),children:[(0,j.jsx)(Ee.k,{stack:i,size:"s"}),(0,j.jsx)(p.s,{gap:2,children:l.map((([e,s])=>(0,j.jsx)(Ve.m,{title:Oe(e),children:(0,j.jsxs)(p.s,{gap:1,alignItems:"center",children:[(0,j.jsx)("div",{className:Ue("legend-color"),style:{backgroundColor:_e(e)}}),(0,j.jsxs)(Re.E,{color:"secondary",variant:"caption-2",children:[e,": ",s]})]})},e)))})]})}const Me=JSON.parse('{"field_pool-name":"Pool Name","field_thread-count":"Threads","field_cpu-usage":"CPU Usage","field_minor-page-faults":"Minor Page Faults","field_major-page-faults":"Major Page Faults","field_thread-states":"Thread States","value_unknown":"Unknown","alert_no-thread-data":"No thread pool information available","description_cpu-usage":"System usage + user usage"}'),$e=(0,y.g4)("ydb-threads",{en:Me}),Ge=[{name:"Name",header:$e("field_pool-name"),render:({row:e})=>e.Name||$e("value_unknown"),width:200},{name:"Threads",header:$e("field_thread-count"),render:({row:e})=>(0,B.ZV)(e.Threads),align:te.Ay.RIGHT,width:100},{name:"CpuUsage",header:(0,j.jsx)(ze.$,{header:$e("field_cpu-usage"),note:$e("description_cpu-usage")}),render:({row:e})=>(0,j.jsx)(Ae,{systemUsage:e.SystemUsage,userUsage:e.UserUsage}),sortAccessor:e=>(0,Pe.y3)(e.SystemUsage)+(0,Pe.y3)(e.UserUsage),width:200},{name:"MinorPageFaults",header:$e("field_minor-page-faults"),render:({row:e})=>(0,B.ZV)(e.MinorPageFaults),align:te.Ay.RIGHT,width:145},{name:"MajorPageFaults",header:$e("field_major-page-faults"),render:({row:e})=>(0,B.ZV)(e.MajorPageFaults),align:te.Ay.RIGHT,width:145},{name:"States",header:$e("field_thread-states"),render:({row:e})=>(0,j.jsx)(Fe,{states:e.States,totalThreads:e.Threads}),sortable:!1,width:250}],Xe="threadsTableColumnsWidth";function Ke({nodeId:e,className:s,scrollContainerRef:a}){const[t]=(0,O.Nt)(),{currentData:l,isLoading:i,error:n}=L.useGetNodeInfoQuery({nodeId:e},{pollingInterval:t}),r=(null===l||void 0===l?void 0:l.Threads)||[];return(0,j.jsxs)(Te.L,{fullHeight:!0,className:s,children:[n?(0,j.jsx)(v.o,{error:n}):null,(0,j.jsx)(Te.L.Table,{scrollContainerRef:a,children:(0,j.jsx)(we.l,{columnsWidthLSKey:Xe,data:r,columns:Ge,settings:he.N3,emptyDataMessage:$e("alert_no-thread-data"),loading:i})})]})}const We=(0,h.cn)("node"),qe="Storage";function He(){var e,s,a;const l=t.useRef(null),i=(0,F.b)(),n=(0,A.RK)(),o=i&&n,u=(0,O.YQ)(),p=(0,d.W5)(C.Ay.node),h=null===p||void 0===p?void 0:p.params.id,m=null===p||void 0===p?void 0:p.params.activeTab,[{database:g}]=(0,c.useQueryParams)(K.Gi),f=K.IK.parse(m),[b]=(0,O.Nt)(),x=h?{nodeId:h,database:null===g||void 0===g?void 0:g.toString()}:r.hT,{currentData:N,isLoading:k,error:I}=L.useGetNodeInfoQuery(x,{pollingInterval:b}),y=(0,A.Pm)(),S=(0,A.c2)(),D=k||!y,w=null===N||void 0===N||null===(e=N.Roles)||void 0===e?void 0:e.find((e=>e===qe)),T=null===N||void 0===N||null===(s=N.Threads)||void 0===s?void 0:s.length,{activeTab:z,nodeTabs:P}=t.useMemo((()=>{var e;const s=[];w||s.push("storage"),o||s.push("configs"),S&&s.push("structure"),T||s.push("threads");const a=K.GX.filter((e=>!s.includes(e.id)));return{activeTab:null!==(e=a.find((({id:e})=>e===f)))&&void 0!==e?e:a[0],nodeTabs:a}}),[w,S,f,T,o]),R=null===g||void 0===g?void 0:g.toString(),V=null===N||void 0===N||null===(a=N.Tenants)||void 0===a?void 0:a[0];return t.useEffect((()=>{k||u((0,E.g)("node",{database:R,databaseName:V,nodeRole:w?"Storage":"Compute",nodeId:h}))}),[u,R,h,k,w,V]),(0,j.jsxs)("div",{className:We(null),ref:l,children:[(0,j.jsx)(Qe,{node:N,activeTabTitle:z.title}),(0,j.jsx)(Be,{node:N,loading:D}),(0,j.jsx)(Ze,{node:N}),I?(0,j.jsx)(v.o,{error:I,className:We("error")}):null,(0,j.jsx)(Je,{node:N,loading:D}),h?(0,j.jsx)(Ye,{nodeId:h,database:R,activeTabId:z.id,tabs:P,parentContainer:l}):null]})}function Qe({node:e,activeTabTitle:s}){const{appTitle:a}=(0,M.J)(),t=null!==e&&void 0!==e&&e.Host?e.Host:(0,ge.A)("node");return(0,j.jsx)(o.mg,{titleTemplate:`%s \u2014 ${t} \u2014 ${a}`,defaultTitle:`${t} \u2014 ${a}`,children:(0,j.jsx)("title",{children:s})})}function Be({node:e,loading:s}){const a=null!==e&&void 0!==e&&e.Host?`${(0,ge.A)("fqdn")}: ${e.Host}`:void 0,t=null!==e&&void 0!==e&&e.DC?`${(0,ge.A)("dc")}: ${e.DC}`:void 0;return(0,j.jsx)(R.B,{loading:s,items:[a,t],className:We("meta")})}function Ze({node:e}){return(0,j.jsx)(u.$,{entityName:(0,ge.A)("node"),status:null===e||void 0===e?void 0:e.SystemState,id:null===e||void 0===e?void 0:e.NodeId,className:We("title")})}function Je({node:e,loading:s}){return s?(0,j.jsx)(z.y,{className:We("info"),rows:10}):(0,j.jsx)(T,{node:e,className:We("info")})}function Ye({nodeId:e,database:s,activeTabId:a,tabs:r,parentContainer:o}){return(0,j.jsxs)(t.Fragment,{children:[(0,j.jsx)("div",{className:We("tabs"),children:(0,j.jsx)(l.f,{value:a,children:(0,j.jsx)(i.w,{className:We("tab-list"),size:"l",children:r.map((({id:a,title:t})=>{const l=(0,K.vI)(e,{database:s},a);return(0,j.jsx)(n.o,{value:a,children:(0,j.jsx)(P.E,{to:l,as:"tab",children:t})},a)}))})})}),(()=>{switch(a){case"storage":return(0,j.jsx)(G.z,{database:s,nodeId:e,scrollContainerRef:o,viewContext:{nodeId:e}});case"tablets":return(0,j.jsx)(X.C,{scrollContainerRef:o,nodeId:e,database:s,onlyActive:!0});case"structure":return(0,j.jsx)(De,{nodeId:e});case"threads":return(0,j.jsx)(Ke,{nodeId:e,scrollContainerRef:o,className:We("treads")});case"configs":return(0,j.jsx)($.U,{database:s,scrollContainerRef:o});default:return!1}})()]})}}}]);