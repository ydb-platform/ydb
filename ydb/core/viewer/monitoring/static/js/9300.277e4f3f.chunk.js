"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[9300],{2102:(e,t,r)=>{r.d(t,{A:()=>n});var a=r(77506),o=r(60712);const l=(0,a.cn)("ydb-diagnostic-card");function n({children:e,className:t,active:r,size:a="m",interactive:n=!0}){return(0,o.jsx)("div",{className:l({active:r,size:a,interactive:n},t),children:e})}},28539:(e,t,r)=>{r.d(t,{T:()=>a.T});var a=r(53755)},9252:(e,t,r)=>{r.d(t,{k:()=>n});var a=r(44433),o=r(88610),l=r(60712);const n=({value:e,onChange:t,className:r})=>(0,l.jsxs)(a.a,{value:e,onUpdate:t,className:r,children:[(0,l.jsx)(a.a.Option,{value:o.s$.ALL,children:o.s$.ALL}),(0,l.jsx)(a.a.Option,{value:o.s$.PROBLEMS,children:o.s$.PROBLEMS})]})},95963:(e,t,r)=>{r.d(t,{v:()=>a.v});var a=r(41775)},7117:(e,t,r)=>{r.d(t,{G:()=>Z});var a=r(59284),o=r(44508),l=r(98167),n=r(89073),s=r(86782),i=r(67028),u=r(15298),d=r(90182),p=r(88610);function c(){const e=(0,d.YQ)();return{problemFilter:(0,d.N4)(p.yV),handleProblemFilterChange:t=>{e((0,p.$u)(t))}}}var m=r(43951),h=r(78034),g=r(71708),y=r(62710),b=r(98089),f=r(69775),C=r(24555),v=r(28539),F=r(9252),N=r(95963),R=r(64934),x=r(44433),P=r(48372);const j=JSON.parse('{"nodes":"Nodes","empty.default":"No such nodes","no-nodes-groups":"No nodes groups","controls_search-placeholder":"Host name","controls_group-by-placeholder":"Group by:","controls_peer-role-label":"Peer role:","database":"database","static":"static","other":"other","any":"any"}'),S=(0,P.g4)("ydb-nodes",{en:j}),w=["database","static","other","any"],B={get database(){return S("database")},get static(){return S("static")},get other(){return S("other")},get any(){return S("any")}};var G=r(60712);function T({value:e="database",onChange:t}){return(0,G.jsx)(x.a,{value:e,onUpdate:t,children:w.map((e=>(0,G.jsx)(x.a.Option,{value:e,children:B[e]},e)))})}const I="nodesTableSelectedColumns",_=["NodeId","Host","Uptime","CPU","RAM","Version","Tablets"],E=["NodeId"],U=["SystemState","Host","DC","Rack","Database","Version","Uptime"];function A(e,t){return t?e:e.filter((e=>"SystemState"!==e))}var L=r(59109);const V=(0,r(77506).cn)("ydb-nodes"),k=e=>V("node",{unavailable:(0,h.X7)(e)}),O=e=>e&&403===e.status?(0,G.jsx)(L.O,{position:"left"}):(0,G.jsx)(o.o,{error:e});var q=r(67087);function D(e){var t;const[r,a]=(0,q.useQueryParams)({uptimeFilter:q.StringParam,peerRole:q.StringParam,search:q.StringParam,nodesGroupBy:q.StringParam}),o=h.Bm.parse(r.uptimeFilter),l=null!==(t=r.search)&&void 0!==t?t:"",n=(s=r.peerRole,w.find((e=>e===s)));var s;const u=(0,i.DM)(),d=function(e,t,r){return A(t,r).find((t=>t===e))}(r.nodesGroupBy,null!==e&&void 0!==e?e:[],u);return{uptimeFilter:o,searchValue:l,peerRoleFilter:n,groupByParam:d,handleSearchQueryChange:e=>{a({search:e||void 0},"replaceIn")},handleUptimeFilterChange:e=>{a({uptimeFilter:e},"replaceIn")},handlePeerRoleFilterChange:e=>{a({peerRole:e},"replaceIn")},handleGroupByParamChange:e=>{a({nodesGroupBy:e},"replaceIn")}}}function K({withGroupBySelect:e,groupByParams:t=[],withPeerRoleFilter:r,columnsToSelect:o,handleSelectedColumnsUpdate:l,entitiesCountCurrent:n,entitiesCountTotal:u,entitiesLoading:d}){const{searchValue:p,uptimeFilter:m,peerRoleFilter:h,groupByParam:g,handleSearchQueryChange:y,handleUptimeFilterChange:x,handlePeerRoleFilterChange:P,handleGroupByParamChange:j}=D(t),{problemFilter:w,handleProblemFilterChange:B}=c(),I=(0,i.DM)(),_=function(e,t){return A(e,t).map((e=>({value:e,content:(0,s.kn)(e)})))}(t,I),E=(0,i.WF)(),U=r&&E;return(0,G.jsxs)(a.Fragment,{children:[(0,G.jsx)(N.v,{onChange:y,placeholder:S("controls_search-placeholder"),width:238,value:p}),I&&e?null:(0,G.jsx)(F.k,{value:w,onChange:B}),e?null:(0,G.jsx)(R.j,{value:m,onChange:x}),U?(0,G.jsxs)(a.Fragment,{children:[(0,G.jsx)(b.E,{variant:"body-2",children:S("controls_peer-role-label")}),(0,G.jsx)(T,{value:h,onChange:P})]}):null,(0,G.jsx)(f.O,{popupWidth:200,items:o,showStatus:!0,onUpdate:l,sortable:!1}),e?(0,G.jsxs)(a.Fragment,{children:[(0,G.jsx)(b.E,{variant:"body-2",children:S("controls_group-by-placeholder")}),(0,G.jsx)(C.l,{hasClear:!0,placeholder:"-",width:150,defaultValue:g?[g]:void 0,onUpdate:e=>{j(e[0])},options:_,className:V("group-by-select"),popupClassName:V("group-by-popup")})]}):null,(0,G.jsx)(v.T,{current:n,total:u,label:S("nodes"),loading:d})]})}var M=r(78524),W=r(40427),Q=r(11906),$=r(69464),H=r(40781);const z=async e=>{const{type:t="any",storage:r=!1,tablets:a=!0,limit:o,offset:l,sortParams:n,filters:i,columnsIds:u}=e,{sortOrder:d,columnId:p}=null!==n&&void 0!==n?n:{},{path:c,database:m,searchValue:g,problemFilter:y,uptimeFilter:b,peerRoleFilter:f,filterGroup:C,filterGroupBy:v}=null!==i&&void 0!==i?i:{},F=(0,s.kU)(p),N=F?(0,$.T)(F,d):void 0,R=(0,H.R)(u,s.fN),x=await window.api.viewer.getNodes({type:t,storage:r,tablets:a,limit:o,offset:l,sort:N,path:c,database:m,filter:g,problems_only:(0,h.AB)(y),uptime:(0,h.Fo)(b),filter_peer_role:f,filter_group:C,filter_group_by:v,fieldsRequired:R}),P=(0,Q.N)(x);return{data:P.Nodes||[],found:P.FoundNodes||0,total:P.TotalNodes||0}};function X({path:e,database:t,searchValue:r,problemFilter:o,uptimeFilter:l,peerRoleFilter:n,filterGroup:i,filterGroupBy:u,columns:d,parentRef:p,renderControls:c,initialEntitiesCount:m}){const g=a.useMemo((()=>({path:e,database:t,searchValue:r,problemFilter:o,uptimeFilter:l,peerRoleFilter:n,filterGroup:i,filterGroupBy:u})),[e,t,r,o,l,n,i,u]);return(0,G.jsx)(W.k5,{columnsWidthLSKey:s.zO,parentRef:p,columns:d,fetchData:z,limit:50,initialEntitiesCount:m,renderControls:c,renderErrorMessage:O,renderEmptyDataMessage:()=>"All"!==o||l!==h.cW.All?(0,G.jsx)(M.v,{name:"thumbsUp",width:"200"}):S("empty.default"),getRowClassName:k,filters:g,tableName:"nodes"})}var Y=r(78762);function J(e){return[(0,Y._E)(),(0,Y.Nh)(e),(0,Y.eT)(),(0,Y.uk)(),(0,Y.OX)(),(0,Y.jl)(),(0,Y.fr)(),(0,Y.kv)(),(0,Y.pH)(),(0,Y.iX)(),(0,Y.ID)(),(0,Y.Rn)(),(0,Y.qp)(e)].map((e=>({...e,sortable:(0,s.sp)(e.name)})))}function Z({path:e,database:t,parentRef:r,additionalNodesProps:o,withPeerRoleFilter:n,columns:s=J({database:t,getNodeRef:null===o||void 0===o?void 0:o.getNodeRef}),defaultColumnsIds:u=_,requiredColumnsIds:d=E,selectedColumnsKey:p=I,groupByParams:m=U}){const{uptimeFilter:g,groupByParam:y,handleUptimeFilterChange:b}=D(m),{problemFilter:f,handleProblemFilterChange:C}=c(),v=(0,i.Pm)(),F=(0,i.Ye)();a.useEffect((()=>{!F||"All"===f&&g===h.cW.All||(C("All"),b(h.cW.All))}),[C,b,f,g,F]);return(0,G.jsx)(l.r,{loading:!v,children:F&&y?(0,G.jsx)(te,{path:e,database:t,parentRef:r,withPeerRoleFilter:n,columns:s,defaultColumnsIds:u,requiredColumnsIds:d,selectedColumnsKey:p,groupByParams:m}):(0,G.jsx)(ee,{path:e,database:t,parentRef:r,withPeerRoleFilter:n,columns:s,defaultColumnsIds:u,requiredColumnsIds:d,selectedColumnsKey:p,groupByParams:m})})}function ee({path:e,database:t,parentRef:r,withPeerRoleFilter:a,columns:o,defaultColumnsIds:l,requiredColumnsIds:n,selectedColumnsKey:u,groupByParams:d}){const{searchValue:p,uptimeFilter:h,peerRoleFilter:g}=D(d),{problemFilter:y}=c(),b=(0,i.Ye)(),{columnsToShow:f,columnsToSelect:C,setColumns:v}=(0,m.K)(o,u,s.uG,l,n);return(0,G.jsx)(X,{path:e,database:t,searchValue:p,problemFilter:y,uptimeFilter:h,peerRoleFilter:g,columns:f,parentRef:r,renderControls:({totalEntities:e,foundEntities:t,inited:r})=>(0,G.jsx)(K,{withGroupBySelect:b,groupByParams:d,withPeerRoleFilter:a,columnsToSelect:C,handleSelectedColumnsUpdate:v,entitiesCountCurrent:t,entitiesCountTotal:e,entitiesLoading:!r})})}function te({path:e,database:t,parentRef:r,withPeerRoleFilter:a,columns:l,defaultColumnsIds:i,requiredColumnsIds:p,selectedColumnsKey:c,groupByParams:b}){const{searchValue:f,peerRoleFilter:C,groupByParam:v}=D(b),[F]=(0,d.Nt)(),{columnsToShow:N,columnsToSelect:R,setColumns:x}=(0,m.K)(l,c,s.uG,i,p),{currentData:P,isFetching:j,error:w}=u.s.useGetNodesQuery({path:e,database:t,filter:f,filter_peer_role:C,group:v,limit:0},{pollingInterval:F}),B=void 0===P&&j,{NodeGroups:T,FoundNodes:I=0,TotalNodes:_=0}=P||{},{expandedGroups:E,setIsGroupExpanded:U}=(0,y.$)(T);return(0,G.jsxs)(n.L,{children:[(0,G.jsx)(n.L.Controls,{children:(0,G.jsx)(K,{withGroupBySelect:!0,groupByParams:b,withPeerRoleFilter:a,columnsToSelect:R,handleSelectedColumnsUpdate:x,entitiesCountCurrent:I,entitiesCountTotal:_,entitiesLoading:B})}),w?(0,G.jsx)(o.o,{error:w}):null,(0,G.jsx)(n.L.Table,{loading:B,className:V("groups-wrapper"),children:null!==T&&void 0!==T&&T.length?T.map((({name:a,count:o})=>{const l=E[a];return(0,G.jsx)(g.Q,{title:a,count:o,entityName:S("nodes"),expanded:l,onIsExpandedChange:U,children:(0,G.jsx)(X,{path:e,database:t,searchValue:f,problemFilter:"All",uptimeFilter:h.cW.All,peerRoleFilter:C,filterGroup:a,filterGroupBy:v,initialEntitiesCount:o,columns:N,parentRef:r})},a)})):S("no-nodes-groups")})]})}},15298:(e,t,r)=>{r.d(t,{s:()=>l});var a=r(21334),o=r(11906);const l=a.F.injectEndpoints({endpoints:e=>({getNodes:e.query({queryFn:async(e,{signal:t})=>{try{const r=await window.api.viewer.getNodes({type:"any",storage:!1,tablets:!0,...e},{signal:t});return{data:(0,o.N)(r)}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"})},11906:(e,t,r)=>{r.d(t,{N:()=>o});var a=r(78034);const o=e=>{var t;const r=(e.Nodes||[]).map((e=>{const{SystemState:t,...r}=e;return{...r,...(0,a.q1)(t)}}));return{Nodes:r,NodeGroups:null===(t=e.NodeGroups)||void 0===t?void 0:t.map((({GroupName:e,NodeCount:t})=>{if(e&&t)return{name:e,count:Number(t)}})).filter((e=>Boolean(e))),TotalNodes:Number(e.TotalNodes)||r.length,FoundNodes:Number(e.FoundNodes)}}}}]);