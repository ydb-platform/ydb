"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[9300],{2102:(e,t,r)=>{r.d(t,{A:()=>n});var a=r(77506),o=r(60712);const l=(0,a.cn)("ydb-diagnostic-card");function n({children:e,className:t,active:r,size:a="m",interactive:n=!0}){return(0,o.jsx)("div",{className:l({active:r,size:a,interactive:n},t),children:e})}},7117:(e,t,r)=>{r.d(t,{G:()=>ee});var a=r(59284),o=r(44508),l=r(98167),n=r(89073),s=r(86782),i=r(67028),u=r(15298),d=r(90182),p=r(88610);function c(){const e=(0,d.YQ)();return{problemFilter:(0,d.N4)(p.yV),handleProblemFilterChange:t=>{e((0,p.$u)(t))}}}var m=r(12888),h=r(43951),g=r(78034),y=r(71708),b=r(62710),f=r(98089),C=r(69775),v=r(24555),F=r(28539),N=r(9252),R=r(95963),x=r(64934),P=r(44433),j=r(48372);const S=JSON.parse('{"nodes":"Nodes","empty.default":"No such nodes","no-nodes-groups":"No nodes groups","controls_search-placeholder":"Host name","controls_group-by-placeholder":"Group by:","controls_peer-role-label":"Peer role:","database":"database","static":"static","other":"other","any":"any"}'),w=(0,j.g4)("ydb-nodes",{en:S}),B=["database","static","other","any"],G={get database(){return w("database")},get static(){return w("static")},get other(){return w("other")},get any(){return w("any")}};var T=r(60712);function I({value:e="database",onChange:t}){return(0,T.jsx)(P.a,{value:e,onUpdate:t,children:B.map((e=>(0,T.jsx)(P.a.Option,{value:e,children:G[e]},e)))})}const _="nodesTableSelectedColumns",E=["NodeId","Host","Uptime","CPU","RAM","Version","Tablets"],U=["NodeId"],A=["SystemState","Host","DC","Rack","Database","Version","Uptime"];function L(e,t){return t?e:e.filter((e=>"SystemState"!==e))}var V=r(59109);const k=(0,r(77506).cn)("ydb-nodes"),O=e=>k("node",{unavailable:(0,g.X7)(e)}),q=e=>e&&403===e.status?(0,T.jsx)(V.O,{position:"left"}):(0,T.jsx)(o.o,{error:e});var M=r(67087);function D(e){var t;const[r,a]=(0,M.useQueryParams)({uptimeFilter:M.StringParam,peerRole:M.StringParam,search:M.StringParam,nodesGroupBy:M.StringParam}),o=g.Bm.parse(r.uptimeFilter),l=null!==(t=r.search)&&void 0!==t?t:"",n=(s=r.peerRole,B.find((e=>e===s)));var s;const u=(0,i.DM)(),d=function(e,t,r){return L(t,r).find((t=>t===e))}(r.nodesGroupBy,null!==e&&void 0!==e?e:[],u);return{uptimeFilter:o,searchValue:l,peerRoleFilter:n,groupByParam:d,handleSearchQueryChange:e=>{a({search:e||void 0},"replaceIn")},handleUptimeFilterChange:e=>{a({uptimeFilter:e},"replaceIn")},handlePeerRoleFilterChange:e=>{a({peerRole:e},"replaceIn")},handleGroupByParamChange:e=>{a({nodesGroupBy:e},"replaceIn")}}}function K({withGroupBySelect:e,groupByParams:t=[],withPeerRoleFilter:r,columnsToSelect:o,handleSelectedColumnsUpdate:l,entitiesCountCurrent:n,entitiesCountTotal:u,entitiesLoading:d}){const{searchValue:p,uptimeFilter:m,peerRoleFilter:h,groupByParam:g,handleSearchQueryChange:y,handleUptimeFilterChange:b,handlePeerRoleFilterChange:P,handleGroupByParamChange:j}=D(t),{problemFilter:S,handleProblemFilterChange:B}=c(),G=(0,i.DM)(),_=function(e,t){return L(e,t).map((e=>({value:e,content:(0,s.kn)(e)})))}(t,G),E=(0,i.WF)(),U=r&&E;return(0,T.jsxs)(a.Fragment,{children:[(0,T.jsx)(R.v,{onChange:y,placeholder:w("controls_search-placeholder"),width:238,value:p}),G&&e?null:(0,T.jsx)(N.k,{value:S,onChange:B}),e?null:(0,T.jsx)(x.j,{value:m,onChange:b}),U?(0,T.jsxs)(a.Fragment,{children:[(0,T.jsx)(f.E,{variant:"body-2",children:w("controls_peer-role-label")}),(0,T.jsx)(I,{value:h,onChange:P})]}):null,(0,T.jsx)(C.O,{popupWidth:200,items:o,showStatus:!0,onUpdate:l,sortable:!1}),e?(0,T.jsxs)(a.Fragment,{children:[(0,T.jsx)(f.E,{variant:"body-2",children:w("controls_group-by-placeholder")}),(0,T.jsx)(v.l,{hasClear:!0,placeholder:"-",width:150,defaultValue:g?[g]:void 0,onUpdate:e=>{j(e[0])},options:_,className:k("group-by-select"),popupClassName:k("group-by-popup")})]}):null,(0,T.jsx)(F.T,{current:n,total:u,label:w("nodes"),loading:d})]})}var W=r(78524),Q=r(40427),$=r(11906),H=r(69464),X=r(40781);const z=async e=>{const{type:t="any",storage:r=!1,tablets:a=!0,limit:o,offset:l,sortParams:n,filters:i,columnsIds:u}=e,{sortOrder:d,columnId:p}=null!==n&&void 0!==n?n:{},{path:c,database:m,searchValue:h,problemFilter:y,uptimeFilter:b,peerRoleFilter:f,filterGroup:C,filterGroupBy:v}=null!==i&&void 0!==i?i:{},F=(0,s.kU)(p),N=F?(0,H.T)(F,d):void 0,R=(0,X.R)(u,s.fN),x=await window.api.viewer.getNodes({type:t,storage:r,tablets:a,limit:o,offset:l,sort:N,path:c,database:m,filter:h,problems_only:(0,g.AB)(y),uptime:(0,g.Fo)(b),filter_peer_role:f,filter_group:C,filter_group_by:v,fieldsRequired:R}),P=(0,$.N)(x);return{data:P.Nodes||[],found:P.FoundNodes||0,total:P.TotalNodes||0}};function Y({path:e,database:t,searchValue:r,problemFilter:o,uptimeFilter:l,peerRoleFilter:n,filterGroup:i,filterGroupBy:u,columns:d,parentRef:p,renderControls:c,initialEntitiesCount:m}){const h=a.useMemo((()=>({path:e,database:t,searchValue:r,problemFilter:o,uptimeFilter:l,peerRoleFilter:n,filterGroup:i,filterGroupBy:u})),[e,t,r,o,l,n,i,u]);return(0,T.jsx)(Q.k5,{columnsWidthLSKey:s.zO,parentRef:p,columns:d,fetchData:z,limit:50,initialEntitiesCount:m,renderControls:c,renderErrorMessage:q,renderEmptyDataMessage:()=>"All"!==o||l!==g.cW.All?(0,T.jsx)(W.v,{name:"thumbsUp",width:"200"}):w("empty.default"),getRowClassName:O,filters:h,tableName:"nodes"})}var J=r(78762);function Z(e){return[(0,J._E)(),(0,J.Nh)(e),(0,J.eT)(),(0,J.uk)(),(0,J.OX)(),(0,J.jl)(),(0,J.fr)(),(0,J.kv)(),(0,J.pH)(),(0,J.iX)(),(0,J.ID)(),(0,J.Rn)(),(0,J.qp)(e)].map((e=>({...e,sortable:(0,s.sp)(e.name)})))}function ee({path:e,database:t,parentRef:r,additionalNodesProps:o,withPeerRoleFilter:n,columns:u=Z({database:t,getNodeRef:null===o||void 0===o?void 0:o.getNodeRef}),defaultColumnsIds:d=E,requiredColumnsIds:p=U,selectedColumnsKey:h=_,groupByParams:y=A}){const{uptimeFilter:b,groupByParam:f,handleUptimeFilterChange:C}=D(y),{problemFilter:v,handleProblemFilterChange:F}=c(),N=(0,i.Pm)(),R=(0,i.Ye)(),x=(0,m.X)(),P=a.useMemo((()=>x?u:u.filter((e=>!(0,s.xd)(e.name)))),[u,x]);a.useEffect((()=>{!R||"All"===v&&b===g.cW.All||(F("All"),C(g.cW.All))}),[F,C,v,b,R]);return(0,T.jsx)(l.r,{loading:!N,children:R&&f?(0,T.jsx)(re,{path:e,database:t,parentRef:r,withPeerRoleFilter:n,columns:P,defaultColumnsIds:d,requiredColumnsIds:p,selectedColumnsKey:h,groupByParams:y}):(0,T.jsx)(te,{path:e,database:t,parentRef:r,withPeerRoleFilter:n,columns:P,defaultColumnsIds:d,requiredColumnsIds:p,selectedColumnsKey:h,groupByParams:y})})}function te({path:e,database:t,parentRef:r,withPeerRoleFilter:a,columns:o,defaultColumnsIds:l,requiredColumnsIds:n,selectedColumnsKey:u,groupByParams:d}){const{searchValue:p,uptimeFilter:m,peerRoleFilter:g}=D(d),{problemFilter:y}=c(),b=(0,i.Ye)(),{columnsToShow:f,columnsToSelect:C,setColumns:v}=(0,h.K)(o,u,s.uG,l,n);return(0,T.jsx)(Y,{path:e,database:t,searchValue:p,problemFilter:y,uptimeFilter:m,peerRoleFilter:g,columns:f,parentRef:r,renderControls:({totalEntities:e,foundEntities:t,inited:r})=>(0,T.jsx)(K,{withGroupBySelect:b,groupByParams:d,withPeerRoleFilter:a,columnsToSelect:C,handleSelectedColumnsUpdate:v,entitiesCountCurrent:t,entitiesCountTotal:e,entitiesLoading:!r})})}function re({path:e,database:t,parentRef:r,withPeerRoleFilter:a,columns:l,defaultColumnsIds:i,requiredColumnsIds:p,selectedColumnsKey:c,groupByParams:m}){const{searchValue:f,peerRoleFilter:C,groupByParam:v}=D(m),[F]=(0,d.Nt)(),{columnsToShow:N,columnsToSelect:R,setColumns:x}=(0,h.K)(l,c,s.uG,i,p),{currentData:P,isFetching:j,error:S}=u.s.useGetNodesQuery({path:e,database:t,filter:f,filter_peer_role:C,group:v,limit:0},{pollingInterval:F}),B=void 0===P&&j,{NodeGroups:G,FoundNodes:I=0,TotalNodes:_=0}=P||{},{expandedGroups:E,setIsGroupExpanded:U}=(0,b.$)(G);return(0,T.jsxs)(n.L,{children:[(0,T.jsx)(n.L.Controls,{children:(0,T.jsx)(K,{withGroupBySelect:!0,groupByParams:m,withPeerRoleFilter:a,columnsToSelect:R,handleSelectedColumnsUpdate:x,entitiesCountCurrent:I,entitiesCountTotal:_,entitiesLoading:B})}),S?(0,T.jsx)(o.o,{error:S}):null,(0,T.jsx)(n.L.Table,{loading:B,className:k("groups-wrapper"),children:null!==G&&void 0!==G&&G.length?G.map((({name:a,count:o})=>{const l=E[a];return(0,T.jsx)(y.Q,{title:a,count:o,entityName:w("nodes"),expanded:l,onIsExpandedChange:U,children:(0,T.jsx)(Y,{path:e,database:t,searchValue:f,problemFilter:"All",uptimeFilter:g.cW.All,peerRoleFilter:C,filterGroup:a,filterGroupBy:v,initialEntitiesCount:o,columns:N,parentRef:r})},a)})):w("no-nodes-groups")})]})}},9252:(e,t,r)=>{r.d(t,{k:()=>n});var a=r(44433),o=r(88610),l=r(60712);const n=({value:e,onChange:t,className:r})=>(0,l.jsxs)(a.a,{value:e,onUpdate:t,className:r,children:[(0,l.jsx)(a.a.Option,{value:o.s$.ALL,children:o.s$.ALL}),(0,l.jsx)(a.a.Option,{value:o.s$.PROBLEMS,children:o.s$.PROBLEMS})]})},11906:(e,t,r)=>{r.d(t,{N:()=>o});var a=r(78034);const o=e=>{var t;const r=(e.Nodes||[]).map((e=>{const{SystemState:t,...r}=e;return{...r,...(0,a.q1)(t)}}));return{Nodes:r,NodeGroups:null===(t=e.NodeGroups)||void 0===t?void 0:t.map((({GroupName:e,NodeCount:t})=>{if(e&&t)return{name:e,count:Number(t)}})).filter((e=>Boolean(e))),TotalNodes:Number(e.TotalNodes)||r.length,FoundNodes:Number(e.FoundNodes)}}},15298:(e,t,r)=>{r.d(t,{s:()=>l});var a=r(21334),o=r(11906);const l=a.F.injectEndpoints({endpoints:e=>({getNodes:e.query({queryFn:async(e,{signal:t})=>{try{const r=await window.api.viewer.getNodes({type:"any",storage:!1,tablets:!0,...e},{signal:t});return{data:(0,o.N)(r)}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"})},95963:(e,t,r)=>{r.d(t,{v:()=>a.v});var a=r(41775)}}]);