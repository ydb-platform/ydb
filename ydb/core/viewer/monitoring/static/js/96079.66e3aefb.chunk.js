"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([[96079],{13758:(e,t,a)=>{a.r(t),a.d(t,{Node:()=>Ne});var n=a(59284),i=a(23871),s=a(4980),l=a(61750),o=a(10755),d=a(80987),r=a(3685),c=a(44508),u=a(87184),v=a(77506),h=a(31684),p=a(52075),m=a(12888);var g=a(18863),b=a(25196),f=a(60712);const I=(0,v.cn)("ydb-pool-usage"),x=e=>{let t="green";return e>60&&e<=80?t="yellow":e>80&&(t="red"),t},j=({data:e={}})=>{const{Threads:t,Name:a="Unknown",Usage:n=0}=e,i=n&&t,s=Math.floor(100*n),l=s>100?100:s;return(0,f.jsxs)("div",{className:I(),children:[(0,f.jsxs)("div",{className:I("info"),children:[(0,f.jsx)("div",{className:I("pool-name"),children:a}),i&&(0,f.jsxs)("div",{className:I("value"),children:[(0,f.jsxs)("div",{className:I("percents"),children:[s<1?"<1":s,"%"]}),(0,f.jsxs)("div",{className:I("threads"),children:["(\xd7",t,")"]})]})]}),(0,f.jsx)("div",{className:I("visual"),children:(0,f.jsx)("div",{className:I("usage-line",{type:x(l)}),style:{width:`${l}%`}})})]})};var k=a(15132),T=a(41826),w=a(48372);const N=JSON.parse('{"database":"Database","uptime":"Uptime","version":"Version","dc":"DC","rack":"Rack","links":"Links","la-interval-1m":"1 min","la-interval-5m":"5 min","la-interval-15m":"15 min","developer-ui":"Developer UI","no-data":"No data","title.common-info":"Common info","title.endpoints":"Endpoints","title.roles":"Roles","title.pools":"Pools","title.load-average":"Load average"}'),y=(0,w.g4)("ydb-node-info",{en:N}),S=(0,v.cn)("full-node-viewer"),D=({node:e,className:t})=>{var a,n,i,s,l;const o=function(e){const t=(0,p.E)();if((0,m.X)()){if(null!==t&&void 0!==t&&t.getNodeRef){const a=t.getNodeRef(e);return a?(0,h.Un)(a):void 0}if(null!==e&&void 0!==e&&e.NodeId){const t=(0,h.Kx)(e.NodeId);return(0,h.Un)(t)}}}(e),d=[];null!==e&&void 0!==e&&null!==(a=e.Tenants)&&void 0!==a&&a.length&&d.push({label:y("database"),value:e.Tenants[0]}),d.push({label:y("version"),value:null===e||void 0===e?void 0:e.Version},{label:y("uptime"),value:(0,f.jsx)(T.p,{StartTime:null===e||void 0===e?void 0:e.StartTime,DisconnectTime:null===e||void 0===e?void 0:e.DisconnectTime})},{label:y("dc"),value:(null===e||void 0===e?void 0:e.DataCenterDescription)||(null===e||void 0===e?void 0:e.DC)}),null!==e&&void 0!==e&&e.Rack&&d.push({label:y("rack"),value:null===e||void 0===e?void 0:e.Rack}),o&&d.push({label:y("links"),value:(0,f.jsx)(b.K,{url:o,title:y("developer-ui")})});const r=null===e||void 0===e||null===(n=e.Endpoints)||void 0===n?void 0:n.map((({Name:e,Address:t})=>({label:e,value:t}))),c=null===e||void 0===e||null===(i=e.LoadAveragePercents)||void 0===i?void 0:i.map(((e,t)=>{return{label:(a=t,[y("la-interval-1m"),y("la-interval-5m"),y("la-interval-15m")][a]),value:(0,f.jsx)(k.O,{value:e,percents:!0,colorizeProgress:!0,capacity:100})};var a}));return e?(0,f.jsx)("div",{className:S(null,t),children:(0,f.jsxs)(u.s,{wrap:!0,gap:4,children:[(0,f.jsxs)(u.s,{direction:"column",gap:2,children:[(0,f.jsx)(g.z,{title:y("title.common-info"),className:S("section"),info:d}),r&&r.length?(0,f.jsx)(g.z,{title:y("title.endpoints"),className:S("section"),info:r}):null]}),(0,f.jsxs)(u.s,{direction:"column",gap:2,children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:S("section-title"),children:y("title.pools")}),(0,f.jsx)("div",{className:S("section",{pools:!0}),children:null===e||void 0===e||null===(s=e.PoolStats)||void 0===s?void 0:s.map(((e,t)=>(0,f.jsx)(j,{data:e},t)))})]}),(0,f.jsx)(g.z,{title:y("title.load-average"),className:S("section",{average:!0}),info:c})]}),e.Roles&&e.Roles.length?(0,f.jsx)(u.s,{direction:"column",gap:2,children:(0,f.jsxs)("div",{className:S("section"),children:[(0,f.jsx)("div",{className:S("section-title"),children:y("title.roles")}),null===e||void 0===e||null===(l=e.Roles)||void 0===l?void 0:l.map((e=>(0,f.jsx)("div",{className:S("role"),children:e},e)))]})}):null]})}):(0,f.jsx)("div",{className:"error",children:y("no-data")})};var z=a(42655),A=a(44294),C=a(58389),P=a(92459),E=a(67028),R=a(40174),V=a(21334),L=a(78034);const q=e=>{var t;if(null===(t=e.SystemStateInfo)||void 0===t||!t.length)return{};const a=e.SystemStateInfo[0];return(0,L.q1)(a)},F=V.F.injectEndpoints({endpoints:e=>({getNodeInfo:e.query({queryFn:async({nodeId:e},{signal:t})=>{try{const a=await window.api.viewer.getNodeInfo(e,{signal:t});return{data:q(a)}}catch(a){return{error:a}}},providesTags:["All"]}),getNodeStructure:e.query({queryFn:async({nodeId:e},{signal:t})=>{try{return{data:await window.api.viewer.getStorageInfo({nodeId:e},{signal:t})}}catch(a){return{error:a}}},providesTags:["All"]})}),overrideExisting:"throw"});var M=a(69063),O=a(47199),U=a(71635),$=a(29819),G=a(905),Q=a.n(G),X=a(52248),H=a(53850),K=a(56839),B=a(27295);const W=(0,H.Mz)((e=>e),(e=>F.endpoints.getNodeStructure.select({nodeId:e}))),_=(0,H.Mz)((e=>e),((e,t)=>W(t)),((e,t)=>t(e).data)),Y=(0,H.Mz)(((e,t)=>Number(t)),((e,t)=>_(e,t)),((e,t)=>{const a=null===t||void 0===t?void 0:t.StoragePools,n={};null===a||void 0===a||a.forEach((t=>{const a=t.Groups;null===a||void 0===a||a.forEach((a=>{var i;const s=null===(i=a.VDisks)||void 0===i?void 0:i.filter((t=>t.NodeId===e)).map(B.WT);null===s||void 0===s||s.forEach((a=>{var i;const s=(0,K.U9)(a.VDiskId),l=null===(i=a.PDisk)||void 0===i?void 0:i.PDiskId;n[String(l)]||(n[String(l)]={vDisks:{},...a.PDisk}),n[String(l)].vDisks[s]={...a,PDiskId:l,NodeId:e,StoragePoolName:t.Name}}))}))}));return Object.keys(n).reduce(((e,t)=>{const a=n[t].vDisks,i=Object.keys(a).reduce(((e,t,n)=>(e.push({...a[t],id:t,order:n}),e)),[]);return e[t]={...n[t],vDisks:i},e}),{})}));var J=a(112),Z=a(45720),ee=a(4557),te=a(84476),ae=a(99991),ne=a(84375),ie=a(33705),se=a(45659),le=a(33775),oe=a(67808),de=a(54090),re=a(67375),ce=a(7435),ue=a(76086),ve=a(29971);const he=(0,v.cn)("kv-node-structure");function pe({label:e,value:t,className:a}){return(0,f.jsxs)("span",{className:he("pdisk-title-item",a),children:[e&&(0,f.jsxs)("span",{className:he("pdisk-title-item-label"),children:[e,":"]}),(0,f.jsx)("span",{className:he("pdisk-title-item-value"),children:t})]})}const me=(0,v.cn)("kv-node-structure");var ge=function(e){return e.slotId="VDiskSlotId",e.VDiskState="VDiskState",e.Size="Size",e.Info="Info",e}(ge||{});const be={VDiskSlotId:"Slot id",VDiskState:"Status",Size:"Size",Info:""};function fe({pDiskId:e,selectedVdiskId:t,nodeId:a,withDeveloperUILink:n}){return[{name:ge.slotId,header:be[ge.slotId],width:100,render:({row:i})=>{const s=i.VDiskSlotId;let l=null;return(0,ce.f8)(a)&&(0,ce.f8)(e)&&(0,ce.f8)(s)&&(l=(0,h.Wg)({nodeId:a,pDiskId:e,vDiskSlotId:s})),(0,f.jsxs)("div",{className:me("vdisk-id",{selected:i.id===t}),children:[(0,f.jsx)("span",{children:s}),l&&n?(0,f.jsx)(te.$,{size:"s",className:me("external-button",{hidden:!0}),href:l,target:"_blank",title:(0,ve.A)("vdisk.developer-ui-button-title"),children:(0,f.jsx)(ae.I,{data:J.A})}):null]})},align:ee.Ay.LEFT},{name:ge.VDiskState,header:be[ge.VDiskState],width:70,render:({row:e})=>(0,f.jsx)(le.k,{status:e.VDiskState===re.W.OK?de.m.Green:de.m.Red}),sortAccessor:e=>e.VDiskState===re.W.OK?1:0,align:ee.Ay.CENTER},{name:ge.Size,header:be[ge.Size],width:170,render:({row:e})=>(0,f.jsx)(k.O,{value:e.AllocatedSize,capacity:Number(e.AllocatedSize)+Number(e.AvailableSize),formatValues:K.vX,colorizeProgress:!0}),sortAccessor:e=>Number(e.AllocatedSize),align:ee.Ay.CENTER},{name:ge.Info,header:be[ge.Info],width:70,render:({row:e})=>(0,f.jsx)(ne.A,{placement:["right"],content:(0,f.jsx)(oe.E,{data:e,withTitle:!0,withVDiskPageLink:!0}),tooltipContentClassName:me("vdisk-details"),children:(0,f.jsx)(te.$,{view:"flat-secondary",className:me("vdisk-details-button",{selected:e.id===t}),children:(0,f.jsx)(ae.I,{data:Z.A,size:18})})}),sortable:!1}]}function Ie({id:e,data:t,selectedVdiskId:a,nodeId:i,unfolded:s}){const l=(0,m.X)(),[o,d]=n.useState(null!==s&&void 0!==s&&s),{TotalSize:r=0,AvailableSize:c=0,Device:u,PDiskId:v,Type:h,vDisks:p}=t,g=Number(r),b=Number(c);return(0,f.jsxs)("div",{className:me("pdisk"),id:e,children:[(0,f.jsxs)("div",{className:me("pdisk-header"),children:[(0,f.jsxs)("div",{className:me("pdisk-title-wrapper"),children:[(0,f.jsx)(le.k,{status:u}),(0,f.jsx)(pe,{label:"PDiskID",value:v,className:me("pdisk-title-id")}),(0,f.jsx)(pe,{value:h,className:me("pdisk-title-type")}),(0,f.jsx)(k.O,{value:g-b,capacity:g,formatValues:K.vX,colorizeProgress:!0,className:me("pdisk-title-size")}),(0,f.jsx)(pe,{label:"VDisks",value:p.length})]}),(0,f.jsx)(te.$,{onClick:o?()=>{d(!1)}:()=>{d(!0)},view:"flat-secondary",children:(0,f.jsx)(ie.I,{direction:o?"top":"bottom"})})]}),o&&(Q()(t)?(0,f.jsx)("div",{children:"No information about PDisk"}):(0,f.jsxs)("div",{children:[(0,f.jsx)(se.Q,{pDisk:t,nodeId:i,className:me("pdisk-details"),withPDiskPageLink:!0}),(0,f.jsxs)("div",{className:me("vdisks-container"),children:[(0,f.jsx)("div",{className:me("vdisks-header"),children:"VDisks"}),(0,f.jsx)(ee.Ay,{theme:"yandex-cloud",data:p,columns:fe({nodeId:i,pDiskId:v,selectedVdiskId:a,withDeveloperUILink:l}),settings:{...ue.N3,dynamicRender:!1},rowClassName:e=>e.id===a?me("selected-vdisk"):""})]})]}))]})}const xe=(0,v.cn)("kv-node-structure");function je({type:e,id:t}){return`${e}-${t}`}const ke=function({nodeId:e,className:t}){const a=(0,M.N4)((t=>Y(t,e))),[i]=(0,M.Nt)(),{currentData:s,isFetching:l,error:o}=F.useGetNodeStructureQuery({nodeId:e},{pollingInterval:i}),r=l&&void 0===s,[{pdiskId:u,vdiskId:v}]=(0,d.useQueryParams)({pdiskId:d.StringParam,vdiskId:d.StringParam}),h=n.useRef(null),p=n.useRef(!1);return n.useEffect((()=>{if(!Q()(a)&&!p.current&&h.current&&u){const t=document.getElementById(je({type:"pdisk",id:u}));let n=0;if(v){var e;const t=null===(e=a[u])||void 0===e?void 0:e.vDisks,i=null===t||void 0===t?void 0:t.find((e=>e.id===v)),s=i?document.querySelector(".data-table"):void 0,l=(null===i||void 0===i?void 0:i.order)||0;s&&(n+=s.offsetTop+40*l)}t&&(h.current.scrollTo({behavior:"smooth",top:n||t.offsetTop}),p.current=!0)}}),[a,u,v]),(0,f.jsxs)("div",{className:xe(),ref:h,children:[o?(0,f.jsx)(c.o,{error:o,className:xe("error")}):null,(0,f.jsx)("div",{className:t,children:r?(0,f.jsx)(X.a,{size:"m"}):o&&!s?null:(()=>{const t=Object.keys(a);return t.length>0?t.map((t=>(0,f.jsx)(Ie,{data:a[t],id:je({type:"pdisk",id:t}),unfolded:u===t,selectedVdiskId:v,nodeId:e},t))):"There is no information about node structure."})()})]})},Te=(0,v.cn)("node"),we="Storage";function Ne(){var e,t;const a=n.useRef(null),i=(0,M.YQ)(),l=(0,o.W5)(P.Ay.node),r=null===l||void 0===l?void 0:l.params.id,u=null===l||void 0===l?void 0:l.params.activeTab,[{database:v}]=(0,d.useQueryParams)($.Gi),h=$.IK.parse(u),[p]=(0,M.Nt)(),m=r?{nodeId:r}:s.hT,{currentData:g,isLoading:b,error:I}=F.useGetNodeInfoQuery(m,{pollingInterval:p}),x=(0,E.Pm)(),j=(0,E.c2)(),k=b||!x,T=null===g||void 0===g||null===(e=g.Roles)||void 0===e?void 0:e.find((e=>e===we)),{activeTab:w,nodeTabs:N}=n.useMemo((()=>{var e;let t=T?$.GX:$.GX.filter((e=>"storage"!==e.id));j&&(t=t.filter((e=>"structure"!==e.id)));return{activeTab:null!==(e=t.find((({id:e})=>e===h)))&&void 0!==e?e:t[0],nodeTabs:t}}),[T,j,h]),y=(null===g||void 0===g||null===(t=g.Tenants)||void 0===t?void 0:t[0])||(null===v||void 0===v?void 0:v.toString());return n.useEffect((()=>{b||i((0,R.g)("node",{tenantName:y,nodeRole:T?"Storage":"Compute",nodeId:r}))}),[i,y,r,b,T]),(0,f.jsxs)("div",{className:Te(null),ref:a,children:[(0,f.jsx)(ye,{node:g,activeTabTitle:w.title}),(0,f.jsx)(Se,{node:g,loading:k}),(0,f.jsx)(De,{node:g}),I?(0,f.jsx)(c.o,{error:I,className:Te("error")}):null,(0,f.jsx)(ze,{node:g,loading:k}),r?(0,f.jsx)(Ae,{nodeId:r,tenantName:y,activeTabId:w.id,tabs:N,parentContainer:a}):null]})}function ye({node:e,activeTabTitle:t}){const a=null!==e&&void 0!==e&&e.Host?e.Host:(0,ve.A)("node");return(0,f.jsx)(l.mg,{titleTemplate:`%s \u2014 ${a} \u2014 YDB Monitoring`,defaultTitle:`${a} \u2014 YDB Monitoring`,children:(0,f.jsx)("title",{children:t})})}function Se({node:e,loading:t}){const a=null!==e&&void 0!==e&&e.Host?`${(0,ve.A)("fqdn")}: ${e.Host}`:void 0,n=null!==e&&void 0!==e&&e.DC?`${(0,ve.A)("dc")}: ${e.DC}`:void 0;return(0,f.jsx)(C.B,{loading:t,items:[a,n],className:Te("meta")})}function De({node:e}){return(0,f.jsx)(r.$,{entityName:(0,ve.A)("node"),status:null===e||void 0===e?void 0:e.SystemState,id:null===e||void 0===e?void 0:e.NodeId,className:Te("title")})}function ze({node:e,loading:t}){return t?(0,f.jsx)(z.y,{className:Te("info"),rows:10}):(0,f.jsx)(D,{node:e,className:Te("info")})}function Ae({nodeId:e,tenantName:t,activeTabId:a,tabs:s,parentContainer:l}){return(0,f.jsxs)(n.Fragment,{children:[(0,f.jsx)("div",{className:Te("tabs"),children:(0,f.jsx)(i.t,{size:"l",items:s,activeTab:a,wrapTo:({id:a},n)=>{const i=(0,$.vI)(e,{database:t},a);return(0,f.jsx)(A.E,{to:i,children:n},a)}})}),(()=>{switch(a){case"storage":return(0,f.jsx)(O.z,{nodeId:e,scrollContainerRef:l,viewContext:{nodeId:e}});case"tablets":return(0,f.jsx)(U.C,{scrollContainerRef:l,nodeId:e,database:t,onlyActive:!0});case"structure":return(0,f.jsx)(ke,{nodeId:e});default:return!1}})()]})}},21545:(e,t,a)=>{a.d(t,{X:()=>i});var n=a(78034);const i=a(21334).F.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async({id:e,database:t,followerId:a},{signal:i})=>{try{const[s,l,o]=await Promise.all([window.api.viewer.getTablet({id:e,database:t,followerId:a},{signal:i}),window.api.viewer.getTabletHistory({id:e,database:t},{signal:i}),window.api.viewer.getNodesList({signal:i})]),d=(0,n.nN)(o),r=Object.keys(l).reduce(((e,t)=>{var a;const n=null===(a=l[t])||void 0===a?void 0:a.TabletStateInfo;return null===n||void 0===n||n.forEach((a=>{var n;const{ChangeTime:i,Generation:s,State:l,Leader:o,FollowerId:r}=a,c=d&&t?null===(n=d.get(Number(t)))||void 0===n?void 0:n.Host:void 0;e.push({nodeId:t,generation:s,changeTime:i,state:l,leader:o,followerId:r,fqdn:c})})),e}),[]),{TabletStateInfo:c=[]}=s,u=void 0===a?c.find((e=>e.Leader)):c.find((e=>{var t;return(null===(t=e.FollowerId)||void 0===t?void 0:t.toString())===a})),{TabletId:v}=u||{};return{data:{id:v,data:u,history:r}}}catch(s){return{error:s}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),getTabletDescribe:e.query({queryFn:async({tenantId:e},{signal:t})=>{try{const a=await window.api.viewer.getTabletDescribe(e,{signal:t}),{SchemeShard:n,PathId:i}=e;return{data:(null===a||void 0===a?void 0:a.Path)||`${n}:${i}`}}catch(a){return{error:a}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async({id:e,hiveId:t},{signal:a})=>{try{return{data:await window.api.tablets.getTabletFromHive({id:e,hiveId:t},{signal:a})}}catch(n){return{error:n}}},providesTags:(e,t,a)=>["All",{type:"Tablet",id:a.id}]}),killTablet:e.mutation({queryFn:async({id:e})=>{try{return{data:await window.api.tablets.killTablet(e)}}catch(t){return{error:t}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.stopTablet(e,t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.resumeTablet(e,t)}}catch(a){return{error:a}}},invalidatesTags:(e,t,a)=>[{type:"Tablet",id:a.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})},27775:(e,t,a)=>{a.d(t,{i:()=>l});var n=a(47665),i=a(58267),s=a(60712);function l({state:e}){return(0,s.jsx)(n.J,{theme:(0,i._)(e),children:e})}},28539:(e,t,a)=>{a.d(t,{T:()=>n.T});var n=a(53755)},45659:(e,t,a)=>{a.d(t,{Q:()=>g});var n=a(87184),i=a(92459),s=a(7435),l=a(46549),o=a(56839),d=a(31684),r=a(12888),c=a(18863),u=a(25196),v=a(15132),h=a(33775),p=a(50672),m=a(60712);function g({pDisk:e,nodeId:t,withPDiskPageLink:a,className:g}){const b=(0,r.X)(),[f,I,x,j]=function({pDisk:e,nodeId:t,withPDiskPageLink:a,isUserAllowedToMakeChanges:r}){const{PDiskId:c,Path:g,Guid:b,Category:f,Type:I,Device:x,Realtime:j,State:k,SerialNumber:T,TotalSize:w,AllocatedSize:N,StatusV2:y,NumActiveSlots:S,ExpectedSlotCount:D,LogUsedSize:z,LogTotalSize:A,SystemSize:C,SharedWithOs:P}=e||{},E=[];(0,s.f8)(f)&&E.push({label:(0,p.D)("type"),value:I}),(0,s.f8)(g)&&E.push({label:(0,p.D)("path"),value:g}),(0,s.f8)(b)&&E.push({label:(0,p.D)("guid"),value:b}),T&&E.push({label:(0,p.D)("serial-number"),value:T}),P&&E.push({label:(0,p.D)("shared-with-os"),value:(0,p.D)("yes")});const R=[];(0,s.f8)(y)&&R.push({label:(0,p.D)("drive-status"),value:y}),(0,s.f8)(k)&&R.push({label:(0,p.D)("state"),value:k}),(0,s.f8)(x)&&R.push({label:(0,p.D)("device"),value:(0,m.jsx)(h.k,{status:x})}),(0,s.f8)(j)&&R.push({label:(0,p.D)("realtime"),value:(0,m.jsx)(h.k,{status:j})});const V=[];V.push({label:(0,p.D)("space"),value:(0,m.jsx)(v.O,{value:N,capacity:w,formatValues:o.vX,colorizeProgress:!0})}),(0,s.f8)(S)&&(0,s.f8)(D)&&V.push({label:(0,p.D)("slots"),value:(0,m.jsx)(v.O,{value:S,capacity:D})}),(0,s.f8)(z)&&(0,s.f8)(A)&&V.push({label:(0,p.D)("log-size"),value:(0,m.jsx)(v.O,{value:z,capacity:A,formatValues:o.vX})}),(0,s.f8)(C)&&V.push({label:(0,p.D)("system-size"),value:(0,l.z3)({value:C})});const L=[];if((a||r)&&(0,s.f8)(c)&&(0,s.f8)(t)){const e=(0,i.Ck)(c,t),s=(0,d.ar)({nodeId:t,pDiskId:c});L.push({label:(0,p.D)("links"),value:(0,m.jsxs)(n.s,{wrap:"wrap",gap:2,children:[a&&(0,m.jsx)(u.K,{title:(0,p.D)("pdisk-page"),url:e,external:!1}),r&&(0,m.jsx)(u.K,{title:(0,p.D)("developer-ui"),url:s})]})})}return[E,R,V,L]}({pDisk:e,nodeId:t,withPDiskPageLink:a,isUserAllowedToMakeChanges:b});return(0,m.jsxs)(n.s,{className:g,gap:2,direction:"row",wrap:!0,children:[(0,m.jsxs)(n.s,{direction:"column",gap:2,width:500,children:[(0,m.jsx)(c.z,{info:f,renderEmptyState:()=>null}),(0,m.jsx)(c.z,{info:x,renderEmptyState:()=>null})]}),(0,m.jsxs)(n.s,{direction:"column",gap:2,width:500,children:[(0,m.jsx)(c.z,{info:I,renderEmptyState:()=>null}),(0,m.jsx)(c.z,{info:j,renderEmptyState:()=>null})]})]})}},52248:(e,t,a)=>{a.d(t,{a:()=>n.a});var n=a(47334)},71635:(e,t,a)=>{a.d(t,{C:()=>b});var n=a(4980),i=a(53850),s=a(62060),l=a.n(s),o=a(21334),d=a(24600);const r=o.F.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.viewer.getTabletsInfo(e,{signal:t})}}catch(a){return{error:a}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),c=(0,i.Mz)((e=>e),(e=>r.endpoints.getTabletsInfo.select(e)),{argsMemoize:i.i5,argsMemoizeOptions:{equalityCheck:l()}}),u=(0,i.Mz)((e=>e),((e,t)=>c(t)),((e,t)=>t(e).data)),v=(0,i.Mz)(((e,t)=>u(e,t)),(e=>(0,d.K)(e)),((e,t)=>null!==e&&void 0!==e&&e.TabletStateInfo?t?e.TabletStateInfo.map((e=>{var a;const n=void 0===e.NodeId||null===(a=t.get(e.NodeId))||void 0===a?void 0:a.Host;return{...e,fqdn:n}})):e.TabletStateInfo:[]));var h=a(7435),p=a(69063),m=a(88616),g=a(60712);function b({nodeId:e,path:t,database:a,onlyActive:i,scrollContainerRef:s}){const[l]=(0,p.Nt)();let o={};const d=i?"(State!=Dead)":void 0;(0,h.f8)(e)?o={nodeId:e,database:a,filter:d}:t&&(o={path:t,database:a,filter:d});const{isLoading:c,error:u}=r.useGetTabletsInfoQuery(0===Object.keys(o).length?n.hT:o,{pollingInterval:l}),b=(0,p.N4)((e=>v(e,o)));return(0,g.jsx)(m.Q,{scrollContainerRef:s,tablets:b,database:a,loading:c,error:u,nodeId:e})}},76938:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(59284);const i=e=>n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),n.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 1.5a6.5 6.5 0 1 1-6.445 7.348.75.75 0 1 1 1.487-.194A5.001 5.001 0 1 0 4.43 4.5h1.32a.75.75 0 0 1 0 1.5h-3A.75.75 0 0 1 2 5.25v-3a.75.75 0 0 1 1.5 0v1.06A6.48 6.48 0 0 1 8 1.5",clipRule:"evenodd"}))},88616:(e,t,a)=>{a.d(t,{Q:()=>z});var n=a(59284),i=a(76938),s=a(98089),l=a(99991),o=a(80987),d=a(22983),r=a(28539),c=a(10508),u=a(44508),v=a(44294),h=a(17594),p=a(41775),m=a(69326),g=a(80420),b=a(27775),f=a(41826),I=a(21545),x=a(6354),j=a(76086),k=a(12888),T=a(29819),w=a(48372);const N=JSON.parse('{"noTabletsData":"No tablets data","Type":"Type","Tablet":"Tablet","State":"State","Node ID":"Node ID","Node FQDN":"Node FQDN","Generation":"Generation","Uptime":"Uptime","dialog.kill-header":"Restart tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet","controls.search-placeholder":"Tablet ID","controls.entities-count-label":"Tablets"}'),y=(0,w.g4)("ydb-tablets",{en:N});var S=a(60712);function D(e){const t=e.State===x.r.Stopped,a=(0,k.X)(),[n]=I.X.useKillTabletMutation(),s=e.TabletId;return s?(0,S.jsx)(d.B,{buttonView:"outlined",buttonTitle:y("dialog.kill-header"),dialogHeader:y("dialog.kill-header"),dialogText:y("dialog.kill-text"),onConfirmAction:()=>n({id:s}).unwrap(),buttonDisabled:t||!a,withPopover:!0,popoverContent:y(a?"dialog.kill-header":"controls.kill-not-allowed"),popoverPlacement:["right","auto"],popoverDisabled:!1,children:(0,S.jsx)(l.I,{data:i.A})}):null}function z({database:e,tablets:t,loading:a,error:i,scrollContainerRef:l,nodeId:d}){const[{tabletsSearch:I},x]=(0,o.useQueryParams)({tabletsSearch:o.StringParam}),[k,w]=n.useState(),N=n.useMemo((()=>function({database:e,nodeId:t}){const a=[{name:"Type",width:150,get header(){return y("Type")},render:({row:e})=>{const t=!1===e.Leader;return(0,S.jsxs)("span",{children:[e.Type," ",t?(0,S.jsx)(s.E,{color:"secondary",children:"follower"}):""]})}},{name:"TabletId",width:220,get header(){return y("Tablet")},render:({row:t})=>t.TabletId?(0,S.jsx)(g.$,{tabletId:t.TabletId,database:e,followerId:t.FollowerId||void 0}):j.Pd},{name:"State",get header(){return y("State")},render:({row:e})=>(0,S.jsx)(b.i,{state:e.State})}];return void 0===t&&a.push({name:"NodeId",get header(){return y("Node ID")},render:({row:e})=>{const t=void 0===e.NodeId?void 0:(0,T.vI)(e.NodeId);return(0,S.jsx)(v.E,{to:t,children:e.NodeId})},align:"right"},{name:"fqdn",get header(){return y("Node FQDN")},render:({row:e})=>e.fqdn?(0,S.jsx)(c.c,{name:e.fqdn,showStatus:!1,hasClipboardButton:!0}):(0,S.jsx)("span",{children:"\u2014"})}),a.push({name:"Generation",get header(){return y("Generation")},align:"right"},{name:"Uptime",get header(){return y("Uptime")},render:({row:e})=>(0,S.jsx)(f.H,{ChangeTime:e.ChangeTime}),sortAccessor:e=>-Number(e.ChangeTime),align:"right",width:120},{name:"Actions",sortable:!1,resizeable:!1,header:"",render:({row:e})=>(0,S.jsx)(D,{...e})}),a}({database:e,nodeId:d})),[e,d]),z=n.useMemo((()=>t.filter((e=>String(e.TabletId).includes(null!==I&&void 0!==I?I:"")))),[t,I]);return(0,S.jsxs)(m.L,{fullHeight:!0,children:[(0,S.jsxs)(m.L.Controls,{children:[(0,S.jsx)(p.v,{placeholder:y("controls.search-placeholder"),onChange:e=>{x({tabletsSearch:e||void 0},"replaceIn")},value:null!==I&&void 0!==I?I:"",width:238}),(0,S.jsx)(r.T,{label:y("controls.entities-count-label"),loading:a,total:t.length,current:z.length})]}),i?(0,S.jsx)(u.o,{error:i}):null,(0,S.jsx)(m.L.Table,{scrollContainerRef:l,scrollDependencies:[I,k],loading:a,children:(0,S.jsx)(h.l,{columns:N,data:z,settings:j.N3,emptyDataMessage:y("noTabletsData"),onSortChange:w})})]})}}}]);