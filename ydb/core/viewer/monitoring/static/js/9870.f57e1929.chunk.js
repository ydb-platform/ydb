"use strict";(self.webpackChunkydb_embedded_ui=self.webpackChunkydb_embedded_ui||[]).push([[9870],{94790:(e,t,a)=>{a.d(t,{f:()=>n});var r=a(68963),s=a(44920),o=a(75859);const n=e=>{let{children:t,content:a,className:n,pinOnClick:l,hasArrow:d=!0,placement:i=["top","bottom"],...u}=e;const[c,m]=r.useState(!1),[h,p]=r.useState(!1),v=r.useRef(null);return(0,o.jsxs)(r.Fragment,{children:[(0,o.jsx)(s.G,{anchorRef:v,open:h||c,placement:i,hasArrow:d,onOutsideClick:()=>{p(!1)},...u,children:a}),(0,o.jsx)("span",{className:n,ref:v,onClick:l?()=>{p(!0)}:void 0,onMouseEnter:()=>{m(!0)},onMouseLeave:()=>{m(!1)},children:t})]})}},36985:(e,t,a)=>{a.d(t,{C:()=>r.C});var r=a(49201)},68242:(e,t,a)=>{a.d(t,{m:()=>u});var r=a(24362),s=a(94790),o=a(27506),n=a(75859);const l=(0,r.cn)("ydb-pool-bar"),d=e=>{let{data:t={}}=e;const{Usage:a=0}=t,r=Math.min(100*a,100),d=(e=>e>=75?"danger":e>=50&&e<75?"warning":"normal")(r);return(0,n.jsx)(s.f,{className:l({type:d}),content:(0,n.jsx)(o.A8,{data:t,className:l("popup-content")}),children:(0,n.jsx)("div",{style:{height:`${r}%`},className:l("value",{type:d})})})},i=(0,r.cn)("ydb-pools-graph"),u=e=>{let{pools:t=[]}=e;return(0,n.jsx)("div",{className:i(),children:t.map(((e,t)=>(0,n.jsx)(d,{data:e},t)))})}},74221:(e,t,a)=>{a.d(t,{T:()=>n});var r=a(79734),s=a(80839),o=a(75859);const n=e=>{let{value:t,onChange:a,className:n}=e;return(0,o.jsxs)(r.E,{value:t,onUpdate:a,className:n,children:[(0,o.jsx)(r.E.Option,{value:s.pu.ALL,children:s.pu.ALL}),(0,o.jsx)(r.E.Option,{value:s.pu.PROBLEMS,children:s.pu.PROBLEMS})]})}},11551:(e,t,a)=>{a.d(t,{o:()=>r.o});var r=a(30629)},9870:(e,t,a)=>{a.d(t,{G:()=>D});var r=a(52317),s=a(17096),o=a(68963),n=a(81413),l=a(48857),d=a(98994),i=a(36985),u=a(28492),c=a(1440),m=a(26688),h=a(56350),p=a(74221),v=a(2098),g=a(11551),N=a(47101),b=a(43989),x=a(3534),P=a(14223),y=a(80839),w=a(24362),j=a(51688),S=a(54997),T=a(57344),C=a(69);function L(e){const t=o.useMemo((()=>(0,C.gM)(e)),[e]);return(0,T.N)(t,S.pM,S.Pr,S.P3,S.nn)}var f=a(30817);const F=JSON.parse('{"empty.default":"No such nodes"}'),M=JSON.parse('{"empty.default":"\u041d\u0435\u0442 \u0443\u0437\u043b\u043e\u0432"}'),A=(0,f.wZ)("ydb-nodes",{ru:M,en:F});var E=a(75859);const U=(0,w.cn)("ydb-nodes"),I=e=>{var t;let{path:a,database:w,additionalNodesProps:T={}}=e;const[C,f]=(0,d.useQueryParams)({uptimeFilter:d.StringParam,search:d.StringParam}),F=j.U8.parse(C.uptimeFilter),M=null!==(t=C.search)&&void 0!==t?t:"",I=(0,s.zL)(),R=(0,s.ix)(y.qz),[Z]=(0,s.Rj)(),{columnsToShow:k,columnsToSelect:z,setColumns:V}=L({getNodeRef:T.getNodeRef,database:w}),{currentData:G,isLoading:O,error:D}=x.k.useGetNodesQuery({path:a,database:w},{pollingInterval:Z}),[W,q]=o.useState({sortValue:"NodeId",sortOrder:n.zE}),[H,Q]=(0,s.sC)(W,(e=>{q(e)})),$=e=>{f({search:e||void 0},"replaceIn")},_=e=>{I((0,y.M6)(e))},B=e=>{f({uptimeFilter:e},"replaceIn")},J=o.useMemo((()=>(0,P.A)(null===G||void 0===G?void 0:G.Nodes,{searchValue:M,uptimeFilter:F,problemFilter:R})),[G,M,F,R]),X=(null===G||void 0===G?void 0:G.TotalNodes)||0;return(0,c.u)(D)?(0,E.jsx)(u.J,{}):(0,E.jsxs)(N.l,{children:[(0,E.jsx)(N.l.Controls,{children:(0,E.jsxs)(o.Fragment,{children:[(0,E.jsx)(g.o,{onChange:$,placeholder:"Host name",className:U("search"),value:M}),(0,E.jsx)(p.T,{value:R,onChange:_}),(0,E.jsx)(b.X,{value:F,onChange:B}),(0,E.jsx)(i.C,{total:X,current:J.length,label:"Nodes",loading:O}),(0,E.jsx)(l.N,{popupWidth:200,items:z,showStatus:!0,onUpdate:V,sortable:!1})]})}),D?(0,E.jsx)(m.V,{error:D}):null,(0,E.jsx)(N.l.Table,{loading:O,children:G?0!==J.length||R===y.pu.ALL&&F===j.Uu.All?(0,E.jsx)(v.G,{columnsWidthLSKey:S.t5,data:J||[],columns:k,settings:r.LE,sortOrder:H,onSort:Q,emptyDataMessage:A("empty.default"),rowClassName:e=>U("node",{unavailable:(0,j.TA)(e)})}):(0,E.jsx)(h.Q,{name:"thumbsUp",width:"200"}):null})]})};var R=a(11635),Z=a(46925),k=a(27070);const z=(e,t)=>`getNodes|offset${t}|limit${e}`,V=async e=>{const{type:t="any",storage:a=!1,tablets:r=!0,limit:s,offset:o,sortParams:n,filters:l}=e,{sortOrder:d,columnId:i}=null!==n&&void 0!==n?n:{},{path:u,database:c,searchValue:m,problemFilter:h,uptimeFilter:p}=null!==l&&void 0!==l?l:{},v=(0,j.oh)(i)?(0,k.A)(i,d):void 0,g=await window.api.getNodes({type:t,storage:a,tablets:r,limit:s,offset:o,sort:v,path:u,database:c,filter:m,problems_only:(0,j.eV)(h),uptime:(0,j.RW)(p)},{concurrentId:z(s,o),signal:e.signal}),N=(0,Z.n)(g);return{data:N.Nodes||[],found:N.FoundNodes||0,total:N.TotalNodes||0}},G=(0,w.cn)("ydb-nodes"),O=e=>{var t;let{path:a,database:r,parentContainer:n,additionalNodesProps:c}=e;const[v,N]=(0,d.useQueryParams)({uptimeFilter:d.StringParam,search:d.StringParam}),x=j.U8.parse(v.uptimeFilter),P=null!==(t=v.search)&&void 0!==t?t:"",w=(0,s.zL)(),T=(0,s.ix)(y.qz),C=o.useMemo((()=>({path:a,database:r,searchValue:P,problemFilter:T,uptimeFilter:x})),[a,r,P,T,x]),{columnsToShow:f,columnsToSelect:F,setColumns:M}=L({getNodeRef:null===c||void 0===c?void 0:c.getNodeRef,database:r});return(0,E.jsx)(R.WQ,{columnsWidthLSKey:S.t5,parentContainer:n,columns:f,fetchData:V,limit:50,renderControls:e=>{let{totalEntities:t,foundEntities:a,inited:r}=e;return(0,E.jsxs)(o.Fragment,{children:[(0,E.jsx)(g.o,{onChange:e=>{N({search:e||void 0},"replaceIn")},placeholder:"Host name",className:G("search"),value:P}),(0,E.jsx)(p.T,{value:T,onChange:e=>{w((0,y.M6)(e))}}),(0,E.jsx)(b.X,{value:x,onChange:e=>{N({uptimeFilter:e},"replaceIn")}}),(0,E.jsx)(i.C,{total:t,current:a,label:"Nodes",loading:!r}),(0,E.jsx)(l.N,{popupWidth:200,items:F,showStatus:!0,onUpdate:M,sortable:!1})]})},renderErrorMessage:e=>e&&403===e.status?(0,E.jsx)(u.J,{position:"left"}):(0,E.jsx)(m.V,{error:e}),renderEmptyDataMessage:()=>T!==y.pu.ALL||x!==j.Uu.All?(0,E.jsx)(h.Q,{name:"thumbsUp",width:"200"}):A("empty.default"),getRowClassName:e=>G("node",{unavailable:(0,j.TA)(e)}),filters:C,tableName:"nodes"})},D=e=>{let{parentContainer:t,...a}=e;const[o]=(0,s.yu)(r.Qy);return o?(0,E.jsx)(O,{parentContainer:t,...a}):(0,E.jsx)(I,{...a})}},69:(e,t,a)=>{a.d(t,{gM:()=>z,LF:()=>G,sQ:()=>V,Cj:()=>O});var r=a(19812),s=a(99683),o=a(89778),n=a(68242),l=a(67359),d=a(83203),i=a(92398),u=a(54665),c=a(24362),m=a(52317),h=a(83496),p=a(75859);const v=(0,c.cn)("tablets-statistic"),g=e=>{let{tablets:t=[],path:a,nodeId:r,backend:s}=e;const o=(e=>e.map((e=>({label:(0,m.qV)(e.Type),type:e.Type,count:e.Count,state:(0,h.FW)(e.State)}))).sort(((e,t)=>String(e.label).localeCompare(String(t.label)))))(t);return(0,p.jsx)("div",{className:v(),children:o.map(((e,t)=>{var o;const n=(0,u.ax)(u.ZP.node,{id:r,activeTab:i.IA},{tenantName:a,backend:s}),l=`${e.label}: ${e.count}`,c=v("tablet",{state:null===(o=e.state)||void 0===o?void 0:o.toLowerCase()});return s?(0,p.jsx)("a",{href:n,className:c,children:l},t):(0,p.jsx)(d.rU,{to:n,className:c,children:l},t)}))})};var N=a(80816),b=a(46925),x=a(34301),P=a(51688),y=a(54997);const w={name:y.xv.NodeId,header:"#",width:80,render:e=>{let{row:t}=e;return t.NodeId},align:r.ZP.RIGHT,sortable:!1},j=(e,t)=>({name:y.xv.Host,header:y.Pr.Host,render:a=>{let{row:r}=a;return(0,p.jsx)(o.k,{node:r,getNodeRef:e,database:t})},width:350,align:r.ZP.LEFT,sortable:!1}),S={name:y.xv.NodeName,header:y.Pr.NodeName,align:r.ZP.LEFT,render:e=>{let{row:t}=e;return t.NodeName||m.jX},width:200},T=e=>({...j(e),width:void 0}),C={name:y.xv.DC,header:y.Pr.DC,align:r.ZP.LEFT,render:e=>{let{row:t}=e;return t.DC||m.jX},width:60},L={name:y.xv.Rack,header:y.Pr.Rack,align:r.ZP.LEFT,render:e=>{let{row:t}=e;return t.Rack?t.Rack:"\u2014"},width:80},f={name:y.xv.Version,header:y.Pr.Version,width:200,align:r.ZP.LEFT,render:e=>{let{row:t}=e;return(0,p.jsx)(s.l,{content:t.Version,children:t.Version})},sortable:!1},F={name:y.xv.Uptime,header:y.Pr.Uptime,sortAccessor:e=>{let{StartTime:t}=e;return t&&-t},render:e=>{let{row:t}=e;return t.Uptime},align:r.ZP.RIGHT,width:110,sortable:!1},M={name:y.xv.Memory,header:y.Pr.Memory,sortAccessor:e=>{let{MemoryUsed:t=0}=e;return Number(t)},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.MemoryUsed,capacity:t.MemoryLimit,formatValues:x.q3,colorizeProgress:!0})},align:r.ZP.RIGHT,width:120},A={name:y.xv.CPU,header:y.Pr.CPU,sortAccessor:e=>{let{PoolStats:t=[]}=e;return Math.max(...t.map((e=>{let{Usage:t}=e;return Number(t)})))},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return t.PoolStats?(0,p.jsx)(n.m,{pools:t.PoolStats}):"\u2014"},align:r.ZP.LEFT,width:80,resizeMinWidth:60,sortable:!1},E={name:y.xv.LoadAverage,header:y.Pr.LoadAverage,sortAccessor:e=>{let{LoadAveragePercents:t=[]}=e;return t[0]},defaultOrder:r.ZP.DESCENDING,render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.LoadAveragePercents&&t.LoadAveragePercents.length>0?t.LoadAveragePercents[0]:void 0,percents:!0,colorizeProgress:!0,capacity:100})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},U=e=>({name:y.xv.Tablets,header:y.Pr.Tablets,width:500,resizeMinWidth:500,render:t=>{let{row:a}=t;return a.Tablets?(0,p.jsx)(g,{path:null!==e&&void 0!==e?e:a.TenantName,nodeId:a.NodeId,tablets:a.Tablets}):"\u2014"},align:r.ZP.LEFT,sortable:!1}),I={name:y.xv.TopNodesLoadAverage,header:y.Pr.TopNodesLoadAverage,render:e=>{let{row:t}=e;return t.LoadAveragePercents&&t.LoadAveragePercents.length>0?(0,p.jsx)(N.a,{value:t.LoadAveragePercents[0].toFixed(),theme:(0,b.w)(t.LoadAveragePercents[0])}):"\u2014"},align:r.ZP.LEFT,width:80,resizeMinWidth:70,sortable:!1},R={name:y.xv.TopNodesMemory,header:y.Pr.TopNodesMemory,render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.MemoryUsed,capacity:t.MemoryLimit,formatValues:x.q3,colorizeProgress:!0})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},Z={name:y.xv.SharedCacheUsage,header:y.Pr.SharedCacheUsage,render:e=>{let{row:t}=e;return(0,p.jsx)(l.y,{value:t.SharedCacheUsed,capacity:t.SharedCacheLimit,formatValues:x.q3,colorizeProgress:!0})},align:r.ZP.LEFT,width:140,resizeMinWidth:140,sortable:!1},k={name:y.xv.TotalSessions,header:y.Pr.TotalSessions,render:e=>{var t;let{row:a}=e;return null!==(t=a.TotalSessions)&&void 0!==t?t:"\u2014"},align:r.ZP.RIGHT,width:100,sortable:!1};function z(e){let{database:t,getNodeRef:a}=e;return[w,j(a,t),S,C,L,f,F,M,A,E,U(t)].map((e=>({...e,sortable:(0,P.oh)(e.name)})))}function V(e){return[I,w,T(e),f]}function G(e){return[A,w,T(e)]}function O(e){let{database:t,getNodeRef:a}=e;return[w,j(a,t),F,I,R,Z,k,U(t)]}},3534:(e,t,a)=>{a.d(t,{k:()=>o});var r=a(905),s=a(46925);const o=r.h.injectEndpoints({endpoints:e=>({getNodes:e.query({queryFn:async(e,t)=>{let{signal:a}=t;try{const t=await window.api.getNodes({type:"any",storage:!1,tablets:!0,...e},{signal:a});return{data:(0,s.n)(t)}}catch(r){return{error:r}}},providesTags:["All"]})}),overrideExisting:"throw"})},46925:(e,t,a)=>{a.d(t,{n:()=>o,w:()=>n});var r=a(99106),s=a(51688);const o=e=>{var t;const a=(e.Nodes||[]).map((e=>{var t,a,r,o;const n=Number(null===(t=e.SystemState.SharedCacheStats)||void 0===t?void 0:t.LimitBytes)||void 0;return{...(0,s.Ns)(e.SystemState),Tablets:e.Tablets,NodeId:e.NodeId,TenantName:null===(a=e.SystemState)||void 0===a||null===(r=a.Tenants)||void 0===r?void 0:r[0],SharedCacheUsed:null===(o=e.SystemState.SharedCacheStats)||void 0===o?void 0:o.UsedBytes,SharedCacheLimit:n}}));return{Nodes:a,NodeGroups:null===(t=e.NodeGroups)||void 0===t?void 0:t.map((e=>({name:e.GroupName,count:e.NodeCount}))),TotalNodes:Number(e.TotalNodes)||a.length,FoundNodes:Number(e.FoundNodes)}},n=(0,r.p)(60,80,["success","warning","danger"])}}]);