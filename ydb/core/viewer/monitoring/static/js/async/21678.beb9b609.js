"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([["21678"],{12543:function(e,t,s){s.d(t,{a:()=>a.a});var a=s(17549)},42880:function(e,t,s){s.d(t,{$:()=>i});var a=s(74848),r=s(85169),n=s(46086);function i({header:e,note:t}){return(0,a.jsxs)(r.s,{gap:1,alignItems:"center",children:[e,(0,a.jsx)(n.H,{popoverProps:{placement:["right","left"]},children:t})]})}},49488:function(e,t,s){s.r(t),s.d(t,{Node:()=>td});var a=s(74848),r=s(96540),n=s(4329),i=s(38482),l=s(65127),d=s(18117),o=s(85902),c=s(56347),u=s(22708),m=s(78918),h=s(67103),g=s(85169),v=s(25247),p=s(70583),f=s(80865),b=s(60318);let N=(0,v.cn)("ydb-pool-usage"),j=({data:e={}})=>{let t,{Threads:s,Name:r="Unknown",Usage:n=0}=e,i=n&&s,l=Math.floor(100*n),d=l>100?100:l;return(0,a.jsxs)("div",{className:N(),children:[(0,a.jsxs)("div",{className:N("info"),children:[(0,a.jsx)("div",{className:N("pool-name"),children:r}),i&&(0,a.jsxs)("div",{className:N("value"),children:[(0,a.jsxs)("div",{className:N("percents"),children:[l<1?"<1":l,"%"]}),(0,a.jsxs)("div",{className:N("threads"),children:["(\xd7",s,")"]})]})]}),(0,a.jsx)("div",{className:N("visual"),children:(0,a.jsx)("div",{className:N("usage-line",{type:(t="green",d>60&&d<=80?t="yellow":d>80&&(t="red"),t)}),style:{width:`${d}%`}})})]})};var k=s(52705),x=s(9753),y=s(51432),S=JSON.parse('{"database":"Database","uptime":"Uptime","version":"Version","dc":"DC","rack":"Rack","links":"Links","la-interval-1m":"1 min","la-interval-5m":"5 min","la-interval-15m":"15 min","developer-ui":"Developer UI","no-data":"No data","title.common-info":"Common info","title.endpoints":"Endpoints","title.roles":"Roles","title.pools":"Pools","title.load-average":"Load average"}');let T=(0,y.g4)("ydb-node-info",{en:S}),w=(0,v.cn)("full-node-viewer"),I=({node:e,className:t})=>{let s=(0,p.n)(e),r=[];e?.Tenants?.length&&r.push({label:T("database"),value:e.Tenants[0]}),r.push({label:T("version"),value:e?.Version},{label:T("uptime"),value:(0,a.jsx)(x.p,{StartTime:e?.StartTime,DisconnectTime:e?.DisconnectTime})},{label:T("dc"),value:e?.DataCenterDescription||e?.DC}),e?.Rack&&r.push({label:T("rack"),value:e?.Rack}),s&&r.push({label:T("links"),value:(0,a.jsx)(b.K,{url:s,title:T("developer-ui")})});let n=e?.Endpoints?.map(({Name:e,Address:t})=>({label:e,value:t})),i=e?.LoadAveragePercents?.map((e,t)=>({label:[T("la-interval-1m"),T("la-interval-5m"),T("la-interval-15m")][t],value:(0,a.jsx)(k.O,{value:e,percents:!0,colorizeProgress:!0,capacity:100})}));return e?(0,a.jsx)("div",{className:w(null,t),children:(0,a.jsxs)(g.s,{wrap:!0,gap:4,children:[(0,a.jsxs)(g.s,{direction:"column",gap:2,children:[(0,a.jsx)(f.z,{title:T("title.common-info"),className:w("section"),info:r}),n&&n.length?(0,a.jsx)(f.z,{title:T("title.endpoints"),className:w("section"),info:n}):null]}),(0,a.jsxs)(g.s,{direction:"column",gap:2,children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:w("section-title"),children:T("title.pools")}),(0,a.jsx)("div",{className:w("section",{pools:!0}),children:e?.PoolStats?.map((e,t)=>(0,a.jsx)(j,{data:e},t))})]}),(0,a.jsx)(f.z,{title:T("title.load-average"),className:w("section",{average:!0}),info:i})]}),e.Roles&&e.Roles.length?(0,a.jsx)(g.s,{direction:"column",gap:2,children:(0,a.jsxs)("div",{className:w("section"),children:[(0,a.jsx)("div",{className:w("section-title"),children:T("title.roles")}),e?.Roles?.map(e=>(0,a.jsx)("div",{className:w("role"),children:e},e))]})}):null]})}):(0,a.jsx)("div",{className:"error",children:T("no-data")})};var P=s(86691),C=s(15749),R=s(83004),D=s(8946),z=s(1459),_=s(39471),U=s(56496),E=s(65101);let M=U.F.injectEndpoints({endpoints:e=>({getNodeInfo:e.query({queryFn:async({nodeId:e,database:t},{signal:s})=>{try{let a=await window.api.viewer.getNodeInfo({nodeId:e,database:t},{signal:s});return{data:(e=>{if(!e.SystemStateInfo?.length)return{};let t=e.SystemStateInfo[0];return(0,E.q1)(t)})(a)}}catch(e){return{error:e}}},providesTags:["All"]}),getNodeStructure:e.query({queryFn:async({nodeId:e},{signal:t})=>{try{return{data:await window.api.viewer.getStorageInfo({nodeId:e},{signal:t})}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"});var A=s(81882),B=s(88831),V=s(12499),F=s(35461),H=s(41254),O=s(31596),$=s(81709),G=s(33702),L=s(93658),W=s(12623),q=s(61058),Q=s(4320),Z=JSON.parse('{"field_connect-time":"Connect Time","field_sent-bytes":"Sent Bytes","field_received-bytes":"Received Bytes","alert_no-network-data":"No network data","search-placeholder":"Search peers","field_peers":"Peers"}');let K=(0,y.g4)("ydb-network",{en:Z});function J({searchValue:e,onSearchChange:t,entitiesCountCurrent:s,entitiesCountTotal:n,entitiesLoading:i}){return(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)(Q.v,{value:e,onChange:t,placeholder:K("search-placeholder"),width:238}),(0,a.jsx)(q.T,{current:s,total:n,label:K("field_peers"),loading:i})]})}function X({searchValue:e,onSearchChange:t}){let{tableState:s}=(0,W.WV)(),{foundEntities:r,totalEntities:n,isInitialLoad:i}=s;return(0,a.jsx)(J,{searchValue:e,onSearchChange:t,entitiesCountCurrent:r,entitiesCountTotal:n,entitiesLoading:i})}var Y=s(74104),ee=s(282),et=s(87669);let es={NodeId:et.vg.NodeId,Host:et.vg.Host,NodeName:et.vg.NodeName,PileName:et.vg.PileName,ClockSkew:et.vg.ClockSkew,PingTime:et.vg.PingTime,SendThroughput:et.vg.SendThroughput,ReceiveThroughput:et.vg.ReceiveThroughput,ConnectTime:"ConnectTime",BytesSend:"BytesSend",BytesReceived:"BytesReceived"},ea=["NodeId","Host","ClockSkew","PingTime","SendThroughput","ReceiveThroughput"],er=["NodeId","Host"],en={NodeId:et.uG.NodeId,Host:et.uG.Host,NodeName:et.uG.NodeName,PileName:et.uG.PileName,ClockSkew:et.uG.ClockSkew,PingTime:et.uG.PingTime,SendThroughput:et.uG.SendThroughput,ReceiveThroughput:et.uG.ReceiveThroughput,ConnectTime:K("field_connect-time"),BytesSend:K("field_sent-bytes"),BytesReceived:K("field_received-bytes")},ei={NodeId:"PeerId",Host:"PeerName",PileName:"PileName",ClockSkew:"ClockSkew",PingTime:"PingTime",BytesSend:"BytesSend",BytesReceived:"BytesReceived"};function el(e){if(e)return ei[e]}var ed=s(2543),eo=s(33583),ec=s(28241);function eu(e){let t=(0,E.q1)(e.SystemState),s=(0,ec.y3)(e.Forward?.ClockSkewUs),a=(0,ec.y3)(e.Reverse?.ClockSkewUs),r=(0,ec.y3)(e.Forward?.PingTimeUs),n=(0,ec.y3)(e.Reverse?.PingTimeUs);return{...t,PileName:e.SystemState?.Location?.BridgePileName,ConnectTime:e.Forward?.ConnectTime,ClockSkewUs:(s-a)/2,PingTimeUs:(r+n)/2,SendThroughput:e.Forward?.WriteThroughput,BytesSend:(0,ec.y3)(e.Forward?.BytesWritten),ReceiveThroughput:e.Reverse?.WriteThroughput,BytesReceived:(0,ec.y3)(e.Reverse?.BytesWritten)}}let em=async e=>{let{limit:t,offset:s,filters:a,sortParams:r}=e,{sortOrder:n,columnId:i}=r??{};if((0,ed.isNil)(a?.nodeId))return{data:[],found:0,total:0};let{nodeId:l,searchValue:d}=a,o=el(i),c=o?(0,eo.T)(o,n):void 0,u=await window.api.viewer.getNodePeers({nodeId:l,filter:d,limit:t,offset:s,sort:c});return{data:(u.Peers??[]).map(eu),found:(0,ec.kf)(u.FoundPeers)?Number(u.FoundPeers):0,total:(0,ec.kf)(u.TotalPeers)?Number(u.TotalPeers):0}};function eh({nodeId:e,searchValue:t,columns:s,scrollContainerRef:n,onDataFetched:i}){let l=r.useMemo(()=>({nodeId:e,searchValue:t||void 0}),[e,t]),d=r.useCallback(()=>K("alert_no-network-data"),[]);return(0,a.jsx)(Y.k5,{columnsWidthLSKey:"nodeNetworkTableColumnsWidth",scrollContainerRef:n,columns:s,fetchData:em,filters:l,tableName:Y.qr.NODE_PEERS,renderErrorMessage:ee.$,renderEmptyDataMessage:d,onDataFetched:i})}var eg=s(29581),ev=s(65943),ep=s(44524),ef=s(9849),eb=s(97855);function eN(e){return(0,ef.z3)({value:e,size:"mb",withSizeLabel:!0})}function ej({nodeId:e,scrollContainerRef:t}){let s=(0,$.J)(),n=(0,z.Z9)(),{searchValue:i,handleSearchQueryChange:l}=(0,L.y)(void 0,!1),d=r.useMemo(()=>{let e=function(e={}){let t=(0,ev.Nh)(e);return[(0,ev._E)(),(0,ev.eT)(),(0,ev.OV)(),t,{name:es.ConnectTime,header:en.ConnectTime,align:eg.Ay.LEFT,width:160,resizeMinWidth:120,render:({row:e})=>e.ConnectTime?(0,eb.r6)(e.ConnectTime):ep.Pd},(0,ev.rU)(),(0,ev.LD)(),(0,ev.DH)(),{name:es.BytesSend,header:en.BytesSend,align:eg.Ay.RIGHT,width:140,resizeMinWidth:120,render:({row:e})=>eN(e.BytesSend)||ep.Pd},(0,ev.ui)(),{name:es.BytesReceived,header:en.BytesReceived,align:eg.Ay.RIGHT,width:160,resizeMinWidth:130,render:({row:e})=>eN(e.BytesReceived)||ep.Pd}].map(e=>({...e,sortable:!!el(e.name)}))}({database:s});return n?e:e.filter(e=>e.name!==es.PileName)},[s,n]),{columnsToShow:o,columnsToSelect:c,setColumns:u}=(0,G.K)(d,"nodeNetworkTableSelectedColumns",en,ea,er);return(0,a.jsx)(H.o,{controls:(0,a.jsx)(X,{searchValue:i,onSearchChange:l}),extraControls:(0,a.jsx)(O.O,{popupWidth:200,items:c,showStatus:!0,onUpdate:u}),table:(0,a.jsx)(eh,{nodeId:e,searchValue:i,columns:o,scrollContainerRef:t}),tableWrapperProps:{scrollContainerRef:t,scrollDependencies:[i]},fullHeight:!0})}var ek=s(20687),ex=s(51950),ey=s(14476),eS=JSON.parse('{"pdisk.developer-ui-button-title":"PDisk Developer UI page","vdisk.developer-ui-button-title":"VDisk Developer UI page","tabs.storage":"Storage","tabs.structure":"Structure","tabs.tablets":"Tablets","tabs.threads":"Threads","tabs.network":"Network","tabs.configs":"Configs","node":"Node","fqdn":"FQDN","dc":"DC"}');let eT=(0,y.g4)("ydb-node-page",{en:eS}),ew={storage:"storage",tablets:"tablets",structure:"structure",threads:"threads",network:"network",configs:"configs"},eI=[{id:ew.storage,get title(){return eT("tabs.storage")}},{id:ew.structure,get title(){return eT("tabs.structure")}},{id:ew.tablets,get title(){return eT("tabs.tablets")}},{id:ew.threads,get title(){return eT("tabs.threads")}},{id:ew.network,get title(){return eT("tabs.network")}},{id:ew.configs,get title(){return eT("tabs.configs")}}],eP=ey.z.nativeEnum(ew).catch(ew.tablets),eC={database:u.StringParam,pdiskId:u.StringParam,vdiskId:u.StringParam};var eR=s(62193),eD=s.n(eR),ez=s(12543),e_=s(25508),eU=s(22530);let eE=(0,e_.Mz)(e=>e,e=>M.endpoints.getNodeStructure.select({nodeId:e})),eM=(0,e_.Mz)(e=>e,(e,t)=>eE(t),(e,t)=>t(e).data),eA=(0,e_.Mz)((e,t)=>Number(t),(e,t)=>eM(e,t),(e,t)=>{let s=t?.StoragePools,a={};return s?.forEach(t=>{let s=t.Groups;s?.forEach(s=>{let r=s.VDisks?.filter(t=>t.NodeId===e).map(eU.WT);r?.forEach(s=>{let r=(0,eb.U9)(s.VDiskId),n=s.PDisk?.PDiskId;a[String(n)]||(a[String(n)]={vDisks:{},...s.PDisk}),a[String(n)].vDisks[r]={...s,PDiskId:n,NodeId:e,StoragePoolName:t.Name}})})}),Object.keys(a).reduce((e,t)=>{let s=a[t].vDisks,r=Object.keys(s).reduce((e,t,a)=>(e.push({...s[t],id:t,order:a}),e),[]);return e[t]={...a[t],vDisks:r},e},{})});var eB=s(14184),eV=s(63584),eF=s(24629),eH=s(17427),eO=s(29901),e$=s(94866),eG=s(18336),eL=s(17989),eW=s(95779),eq=s(40897),eQ=s(33172),eZ=s(35537),eK=s(88387);let eJ=(0,v.cn)("kv-node-structure");function eX({label:e,value:t,className:s}){return(0,a.jsxs)("span",{className:eJ("pdisk-title-item",s),children:[e&&(0,a.jsxs)("span",{className:eJ("pdisk-title-item-label"),children:[e,":"]}),(0,a.jsx)("span",{className:eJ("pdisk-title-item-value"),children:t})]})}let eY=(0,v.cn)("kv-node-structure");function e0({id:e,data:t,selectedVdiskId:s,nodeId:n,unfolded:i}){let l=(0,B.X)(),[d,o]=r.useState(i??!1),{TotalSize:c=0,AvailableSize:u=0,Device:m,PDiskId:h,Type:g,vDisks:v}=t,p=Number(c),f=Number(u);return(0,a.jsxs)("div",{className:eY("pdisk"),id:e,children:[(0,a.jsxs)("div",{className:eY("pdisk-header"),children:[(0,a.jsxs)("div",{className:eY("pdisk-title-wrapper"),children:[(0,a.jsx)(eL.k,{status:m}),(0,a.jsx)(eX,{label:"PDiskID",value:h,className:eY("pdisk-title-id")}),(0,a.jsx)(eX,{value:g,className:eY("pdisk-title-type")}),(0,a.jsx)(k.O,{value:p-f,capacity:p,formatValues:eb.vX,colorizeProgress:!0,className:eY("pdisk-title-size")}),(0,a.jsx)(eX,{label:"VDisks",value:v.length})]}),(0,a.jsx)(eF.$,{onClick:d?()=>{o(!1)}:()=>{o(!0)},view:"flat-secondary",children:(0,a.jsx)(e$.I,{direction:d?"top":"bottom"})})]}),d&&(eD()(t)?(0,a.jsx)("div",{children:"No information about PDisk"}):(0,a.jsxs)("div",{children:[(0,a.jsx)(eG.Q,{pDisk:t,nodeId:n,className:eY("pdisk-details"),withPDiskPageLink:!0}),(0,a.jsxs)("div",{className:eY("vdisks-container"),children:[(0,a.jsx)("div",{className:eY("vdisks-header"),children:"VDisks"}),(0,a.jsx)(eg.Ay,{theme:"yandex-cloud",data:v,columns:function({pDiskId:e,selectedVdiskId:t,nodeId:s,withDeveloperUILink:r}){return[{name:"VDiskSlotId",header:"Slot id",width:100,render:({row:n})=>{let i=n.VDiskSlotId,l=null;return(0,eQ.f8)(s)&&(0,eQ.f8)(e)&&(0,eQ.f8)(i)&&(l=(0,eK.Wg)({nodeId:s,pDiskId:e,vDiskSlotId:i})),(0,a.jsxs)("div",{className:eY("vdisk-id",{selected:n.id===t}),children:[(0,a.jsx)("span",{children:i}),l&&r?(0,a.jsx)(eF.$,{size:"s",className:eY("external-button",{hidden:!0}),href:l,target:"_blank",title:eT("vdisk.developer-ui-button-title"),children:(0,a.jsx)(eH.I,{data:eB.A})}):null]})},align:eg.Ay.LEFT},{name:"VDiskState",header:"Status",width:70,render:({row:e})=>(0,a.jsx)(eL.k,{status:"OK"===e.VDiskState?eq.m.Green:eq.m.Red}),sortAccessor:e=>+("OK"===e.VDiskState),align:eg.Ay.CENTER},{name:"Size",header:"Size",width:170,render:({row:e})=>(0,a.jsx)(k.O,{value:e.AllocatedSize,capacity:Number(e.AllocatedSize)+Number(e.AvailableSize),formatValues:eb.vX,colorizeProgress:!0}),sortAccessor:e=>Number(e.AllocatedSize),align:eg.Ay.CENTER},{name:"Info",header:"",width:70,render:({row:e})=>(0,a.jsx)(eO.A,{placement:["right"],content:(0,a.jsx)(eW.E,{data:e,withTitle:!0,withVDiskPageLink:!0,className:eY("vdisk-details")}),children:(0,a.jsx)(eF.$,{view:"flat-secondary",className:eY("vdisk-details-button",{selected:e.id===t}),children:(0,a.jsx)(eH.I,{data:eV.A,size:18})})}),sortable:!1}]}({nodeId:n,pDiskId:h,selectedVdiskId:s,withDeveloperUILink:l}),settings:{...eZ.N3,dynamicRender:!1},rowClassName:e=>e.id===s?eY("selected-vdisk"):""})]})]}))]})}let e1=(0,v.cn)("kv-node-structure"),e8=function({nodeId:e,className:t}){let s,n=(0,A.N4)(t=>eA(t,e)),[i]=(0,A.Nt)(),{currentData:l,isFetching:d,error:o}=M.useGetNodeStructureQuery({nodeId:e},{pollingInterval:i}),c=d&&void 0===l,[{pdiskId:m,vdiskId:g}]=(0,u.useQueryParams)({pdiskId:u.StringParam,vdiskId:u.StringParam}),v=r.useRef(null),p=r.useRef(!1);return r.useEffect(()=>{if(!eD()(n)&&!p.current&&v.current&&m){let e=document.getElementById(function({type:e,id:t}){return`${e}-${t}`}({type:"pdisk",id:m})),t=0;if(g){let e=n[m]?.vDisks,s=e?.find(e=>e.id===g),a=s?document.querySelector(".data-table"):void 0,r=s?.order||0;a&&(t+=a.offsetTop+40*r)}e&&(v.current.scrollTo({behavior:"smooth",top:t||e.offsetTop}),p.current=!0)}},[n,m,g]),(0,a.jsxs)("div",{className:e1(),ref:v,children:[o?(0,a.jsx)(h.o,{error:o,className:e1("error")}):null,(0,a.jsx)("div",{className:t,children:c?(0,a.jsx)(ez.a,{size:"m"}):o&&!l?null:(s=Object.keys(n)).length>0?s.map(t=>(0,a.jsx)(e0,{data:n[t],id:function({type:e,id:t}){return`${e}-${t}`}({type:"pdisk",id:t}),unfolded:m===t,selectedVdiskId:g,nodeId:e},t)):"There is no information about node structure."})]})};var e4=s(74010),e2=s(48849),e5=s(42880),e3=s(77269);let e6=(0,v.cn)("cpu-usage-bar");function e7({systemUsage:e=0,userUsage:t=0,className:s}){let r=Math.round(100*e),n=Math.round(100*t),i=Math.round(100*(e+t));return(0,a.jsxs)(g.s,{gap:2,className:e6(null,s),children:[(0,a.jsx)("div",{className:e6("progress"),children:(0,a.jsx)(k.O,{value:i,percents:!0,colorizeProgress:!0,capacity:100,className:e6("progress")})}),(0,a.jsxs)(e3.E,{color:"secondary",children:["(Sys: ",r,"%, U: ",n,"%)"]})]})}var e9=s(47037),te=s(6876);let tt=(0,v.cn)("ydb-thread-states-bar");function ts({states:e={},totalThreads:t,className:s}){let r=t||Object.values(e).reduce((e,t)=>e+t,0);if(0===r)return eZ.Pd;let n=Object.entries(e).filter(([,e])=>e>0),i=Object.entries(e).map(([e,t])=>({theme:(e=>{switch(e.toUpperCase()){case"R":return"success";case"S":return"info";case"D":return"warning";case"Z":case"T":case"X":return"danger";default:return"misc"}})(e),value:t/r*100}));return(0,a.jsxs)("div",{className:tt(null,s),children:[(0,a.jsx)(e9.k,{stack:i,size:"s"}),(0,a.jsx)(g.s,{gap:2,children:n.map(([e,t])=>(0,a.jsx)(te.m,{title:(e=>{switch(e.toUpperCase()){case"R":return"Running";case"S":return"Sleeping";case"D":return"Uninterruptible sleep";case"Z":return"Zombie";case"T":return"Stopped";case"X":return"Dead";default:return"Unknown"}})(e),children:(0,a.jsxs)(g.s,{gap:1,alignItems:"center",children:[(0,a.jsx)("div",{className:tt("legend-color"),style:{backgroundColor:(e=>{switch(e.toUpperCase()){case"R":return"var(--g-color-base-positive-medium)";case"S":return"var(--g-color-base-info-medium)";case"D":return"var(--g-color-base-warning-medium)";case"Z":case"T":case"X":return"var(--g-color-base-danger-medium)";default:return"var(--g-color-base-misc-medium)"}})(e)}}),(0,a.jsxs)(e3.E,{color:"secondary",variant:"caption-2",children:[e,": ",t]})]})},e))})]})}var ta=JSON.parse('{"field_pool-name":"Pool Name","field_thread-count":"Threads","field_cpu-usage":"CPU Usage","field_minor-page-faults":"Minor Page Faults","field_major-page-faults":"Major Page Faults","field_thread-states":"Thread States","value_unknown":"Unknown","alert_no-thread-data":"No thread pool information available","description_cpu-usage":"System usage + user usage"}');let tr=(0,y.g4)("ydb-threads",{en:ta}),tn=[{name:"Name",header:tr("field_pool-name"),render:({row:e})=>e.Name||tr("value_unknown"),width:200},{name:"Threads",header:tr("field_thread-count"),render:({row:e})=>(0,eb.ZV)(e.Threads),align:eg.Ay.RIGHT,width:100},{name:"CpuUsage",header:(0,a.jsx)(e5.$,{header:tr("field_cpu-usage"),note:tr("description_cpu-usage")}),render:({row:e})=>(0,a.jsx)(e7,{systemUsage:e.SystemUsage,userUsage:e.UserUsage}),sortAccessor:e=>(0,ec.y3)(e.SystemUsage)+(0,ec.y3)(e.UserUsage),width:200},{name:"MinorPageFaults",header:tr("field_minor-page-faults"),render:({row:e})=>(0,eb.ZV)(e.MinorPageFaults),align:eg.Ay.RIGHT,width:145},{name:"MajorPageFaults",header:tr("field_major-page-faults"),render:({row:e})=>(0,eb.ZV)(e.MajorPageFaults),align:eg.Ay.RIGHT,width:145},{name:"States",header:tr("field_thread-states"),render:({row:e})=>(0,a.jsx)(ts,{states:e.States,totalThreads:e.Threads}),sortable:!1,width:250}];function ti({nodeId:e,className:t,scrollContainerRef:s}){let[r]=(0,A.Nt)(),{currentData:n,isLoading:i,error:l}=M.useGetNodeInfoQuery({nodeId:e},{pollingInterval:r}),d=n?.Threads||[];return(0,a.jsxs)(e2.L,{fullHeight:!0,className:t,children:[l?(0,a.jsx)(h.o,{error:l}):null,(0,a.jsx)(e2.L.Table,{scrollContainerRef:s,children:(0,a.jsx)(e4.l,{columnsWidthLSKey:"threadsTableColumnsWidth",data:d,columns:tn,settings:eZ.N3,emptyDataMessage:tr("alert_no-thread-data"),isLoading:i})})]})}let tl=(0,v.cn)("node");function td(){let e=r.useRef(null),t=(0,B.b)(),s=(0,z.RK)(),n=t&&s,i=(0,A.YQ)(),l=(0,c.W6)(),o=(0,c.W5)(D.Ay.node),m=o?.params.id,g=o?.params.activeTab,[{database:v}]=(0,u.useQueryParams)(eC),p=eP.parse(g),[f]=(0,A.Nt)(),b=m?{nodeId:m,database:v?.toString()}:d.hT,{currentData:N,isLoading:j,error:k}=M.useGetNodeInfoQuery(b,{pollingInterval:f}),x=(0,z.Pm)(),y=(0,z.c2)(),S=(0,z.e4)(),T=j||!x,w=(0,E.wH)(N),I=N?.Threads?.length,{activeTab:P,nodeTabs:C}=r.useMemo(()=>{let e=[];w||e.push("storage"),n||e.push("configs"),y&&e.push("structure"),I||e.push("threads"),S||e.push("network");let t=eI.filter(t=>!e.includes(t.id));return{activeTab:t.find(({id:e})=>e===p)??t[0],nodeTabs:t}},[w,y,S,p,I,n]),R=v?.toString(),U=N?.Tenants?.[0];return r.useEffect(()=>{j||i((0,_.g)("node",{database:R,databaseName:U,nodeRole:w?"Storage":"Compute",nodeId:m}))},[i,R,m,j,w,U]),r.useEffect(()=>{if(m&&P&&P.id!==p){let e=(0,D.vI)({id:m,activeTab:P.id},{database:R});l.replace(e)}},[m,R,P.id,p,l,P]),(0,a.jsxs)("div",{className:tl(null),ref:e,children:[(0,a.jsx)(to,{node:N,activeTabTitle:P.title}),(0,a.jsx)(tc,{node:N,loading:T}),(0,a.jsx)(tu,{node:N}),k?(0,a.jsx)(h.o,{error:k,className:tl("error")}):null,(0,a.jsx)(tm,{node:N,loading:T}),m?(0,a.jsx)(th,{nodeId:m,database:R,activeTabId:P.id,tabs:C,parentContainer:e}):null]})}function to({node:e,activeTabTitle:t}){let{appTitle:s}=(0,V.J)(),r=e?.Host?e.Host:eT("node");return(0,a.jsx)(o.mg,{titleTemplate:`%s — ${r} — ${s}`,defaultTitle:`${r} — ${s}`,children:(0,a.jsx)("title",{children:t})})}function tc({node:e,loading:t}){let s=e?.Host?`${eT("fqdn")}: ${e.Host}`:void 0,r=e?.DC?`${eT("dc")}: ${e.DC}`:void 0;return(0,a.jsx)(R.B,{loading:t,items:[s,r],className:tl("meta")})}function tu({node:e}){return(0,a.jsx)(m.$,{entityName:eT("node"),status:e?.SystemState,id:e?.NodeId,className:tl("title")})}function tm({node:e,loading:t}){return t?(0,a.jsx)(P.y,{className:tl("info"),rows:10}):(0,a.jsx)(I,{node:e,className:tl("info")})}function th({nodeId:e,database:t,activeTabId:s,tabs:d,parentContainer:o}){return(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)("div",{className:tl("tabs"),children:(0,a.jsx)(n.f,{value:s,children:(0,a.jsx)(i.w,{className:tl("tab-list"),size:"l",children:d.map(({id:s,title:r})=>{let n=(0,D.vI)({id:e,activeTab:s},{database:t});return(0,a.jsx)(l.o,{value:s,children:(0,a.jsx)(C.E,{to:n,as:"tab",children:r})},s)})})})}),(()=>{switch(s){case"storage":return(0,a.jsx)(ek.z,{database:t,nodeId:e,scrollContainerRef:o,viewContext:{nodeId:e}});case"tablets":return(0,a.jsx)(ex.C,{scrollContainerRef:o,nodeId:e,database:t,onlyActive:!0});case"structure":return(0,a.jsx)(e8,{nodeId:e});case"threads":return(0,a.jsx)(ti,{nodeId:e,scrollContainerRef:o,className:tl("treads")});case"configs":return(0,a.jsx)(F.U,{database:t,scrollContainerRef:o});case"network":return(0,a.jsx)(ej,{nodeId:e,scrollContainerRef:o});default:return!1}})()]})}},51950:function(e,t,s){s.d(t,{C:()=>j});var a=s(74848),r=s(96540),n=s(18117),i=s(2543),l=s(25508),d=s(2404),o=s.n(d),c=s(56496),u=s(56321);let m=c.F.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.viewer.getTabletsInfo(e,{signal:t})}}catch(e){return{error:e}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),h=(0,l.Mz)(e=>e,e=>m.endpoints.getTabletsInfo.select(e),{argsMemoize:l.i5,argsMemoizeOptions:{equalityCheck:o()}}),g=(0,l.Mz)(e=>e,(e,t)=>h(t),(e,t)=>t(e).data),v=(0,l.Mz)((e,t)=>g(e,t),(e,t)=>(0,u.K)(e,t.database),(e,t)=>e?.TabletStateInfo?t?e.TabletStateInfo.map(e=>{let s=void 0===e.NodeId?void 0:t.get(e.NodeId)?.Host;return{...e,fqdn:s}}):e.TabletStateInfo:[]);var p=s(33172),f=s(81882),b=s(6168);let N=["Created","ResolveStateStorage","Candidate","BlockBlobStorage","RebuildGraph","WriteZeroEntry","Restored","Discover","Lock","Active","ResolveLeader","Terminating"];function j({nodeId:e,path:t,database:s,databaseFullPath:l,onlyActive:d,scrollContainerRef:o}){let[c]=(0,f.Nt)(),u={},h=d?`(State=[${N.join(",")}])`:void 0,g=r.useMemo(()=>{if(!(0,i.isNil)(t)&&!(0,i.isNil)(l))return{path:t,databaseFullPath:l}},[t,l]);(0,p.f8)(e)?u={nodeId:e,database:s,filter:h}:g&&(u={path:g,database:s,filter:h});let{isLoading:j,error:k}=m.useGetTabletsInfoQuery(0===Object.keys(u).length?n.hT:u,{pollingInterval:c}),x=(0,f.N4)(e=>v(e,u));return(0,a.jsx)(b.Q,{scrollContainerRef:o,tablets:x,loading:j,error:k,nodeId:e})}}}]);