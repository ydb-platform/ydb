"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([["2765"],{50247:function(e,t,n){n.d(t,{A:()=>r});var a=n(96540);let r=e=>a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),a.createElement("g",{clipPath:"url(#a)"},a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M10.257 4.2a.86.86 0 0 1-.86.274l-3.103-.776a2.81 2.81 0 0 0-2.796.876L1.242 7.152A3 3 0 0 0 .5 9.127V12a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V3.309a1.933 1.933 0 0 0-3.4-1.258l-1.31 1.528zM14 6.48V3.31a.433.433 0 0 0-.762-.282l-1.842 2.15a2.36 2.36 0 0 1-2.362.753L5.93 5.154a1.31 1.31 0 0 0-1.303.408L2.37 8.139a1.5 1.5 0 0 0-.37.988v.685l2.304-1.44a2.59 2.59 0 0 1 2.458-.155l1.923.888a1.58 1.58 0 0 0 1.777-.317l.22-.22 1.575-1.574A1.86 1.86 0 0 1 14 6.479m-12 5.52c0 .277.226.501.5.501h11a.5.5 0 0 0 .5-.5V8.337a.4.4 0 0 0-.683-.283L11.523 9.85a3.08 3.08 0 0 1-3.466.618L6.134 9.58a1.09 1.09 0 0 0-1.035.066L2.353 11.36a.75.75 0 0 0-.353.637",clipRule:"evenodd"})),a.createElement("defs",null,a.createElement("clipPath",{id:"a"},a.createElement("path",{fill:"currentColor",d:"M0 0h16v16H0z"}))))},41982:function(e,t,n){n.d(t,{p:()=>p});var a=n(74848),r=n(96540),s=n(24629),o=n(85169),l=n(78419),i=n(2543),c=n(25247),d=n(51432),u=JSON.parse('{"action_show_more":"Show {{count}} more","action_hide":"Hide {{count}}","tooltip_nodes":{"one":"{{count}} Node","other":"{{count}} Nodes"}}');let m=(0,d.g4)("ydb-versions-bar",{en:u}),h=(0,c.cn)("ydb-versions-bar");function p({preparedVersions:e,withTitles:t=!0,size:n="s"}){let c=e.length>4&&"s"===n,[d,u]=r.useState(),[p,w]=r.useState(!1),N=r.useMemo(()=>{let t=e.reduce((e,t)=>e+(t.count||0),0);return e.map(e=>({value:(e.count||0)/t*100,color:e.color,version:e.version,count:e.count}))},[e]),x=r.useMemo(()=>p?e:c?e.slice(0,3):e,[p,e,c]),v=e=>{e.preventDefault(),e.stopPropagation(),w(!0)},b=e=>{e.preventDefault(),e.stopPropagation(),w(!1)},f=r.useMemo(()=>(0,i.debounce)(e=>{u(e)},200),[]),y=r.useMemo(()=>(f.cancel(),(0,i.debounce)(()=>{u(void 0)},200)),[f]),j=e=>!!(d&&d!==e);return(0,a.jsxs)(o.s,{direction:"column",className:h("bar-wrapper",{size:n}),wrap:!0,children:[(0,a.jsx)(o.s,{className:h("bar",{size:n}),grow:1,children:N.map(e=>(0,a.jsx)(l.m,{content:(0,a.jsxs)(r.Fragment,{children:[m("tooltip_nodes",{count:e.count}),(0,a.jsx)("br",{}),e.version]}),placement:"m"===n?"auto":"top-start",openDelay:200,children:(0,a.jsx)("span",{onMouseEnter:()=>{f(e.version)},onMouseLeave:y,className:h("version",{dimmed:j(e.version),size:n}),style:{backgroundColor:e.color,width:`${e.value}%`}})},e.version))}),t&&(0,a.jsxs)(o.s,{className:h("titles-wrapper",{size:n}),children:[x.map(e=>(0,a.jsx)(g,{version:e.version,color:e.color||"",count:e.count,isDimmed:j(e.version),onMouseEnter:()=>{f(e.version)},onMouseLeave:y,size:n},e.version)),(()=>{if(!c)return null;let t=e.length-3;return p?(0,a.jsx)(s.$,{view:"flat-secondary",size:"s",onClick:b,className:h("button"),children:m("action_hide",{count:t})}):(0,a.jsx)(s.$,{view:"flat-secondary",size:"s",onClick:v,className:h("button"),children:m("action_show_more",{count:t})})})()]})]})}function g({version:e,color:t,count:n,isDimmed:r,onMouseEnter:s,onMouseLeave:i,size:c}){return(0,a.jsx)(l.m,{content:m("tooltip_nodes",{count:n}),placement:"bottom-end",openDelay:200,children:(0,a.jsxs)(o.s,{alignItems:"center",className:h("title",{size:c}),children:[(0,a.jsx)(w,{size:c,dimmed:r,color:t}),(0,a.jsx)("div",{className:h("title-text",{dimmed:r,size:c}),onMouseEnter:s,onMouseLeave:i,children:e})]})})}function w({size:e,dimmed:t,color:n}){let r="m"===e?8:6,s=r/2;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:`0 0 ${r} ${r}`,fill:"none",className:h("version-icon",{dimmed:t}),children:(0,a.jsx)("circle",{cx:s,cy:s,r:s,fill:n})})}},43125:function(e,t,n){n.d(t,{A:()=>ew});var a=n(74848),r=n(96540),s=n(16509),o=n(29581),l=n(24629),i=n(17427),c=n(5434),d=n(85169),u=n(61058),m=n(67103),h=n(78870),p=n(48649),g=n(53808),w=n(74010),N=n(4320),x=n(31596),v=n(48849),b=n(14184),f=n(39688),y=n(68910),j=n(97547),C=n(56824),E=n(77269),S=n(66111),D=n(8946),I=n(1459),T=n(71790),A=n(40897),P=n(67222),k=n(53263),G=n(25247),M=n(88831),_=n(95200),O=n(60117),L=n(19122),R=n(9259);let z=(0,G.cn)("ydb-database-name-wrapper");function B({tenant:e,clusterName:t,additionalTenantsProps:n,externalLink:s}){let o=(0,M.X)(),l=(0,I.g7)()&&void 0!==P.J.onEditDB,c=(0,I.TW)()&&void 0!==P.J.onDeleteDB,{settings:u}=(0,T.Zd)(),m=function(e,t){let n;if("function"!=typeof t?.prepareTenantBackend)return;let a=e.NodeIds??e.sharedNodeIds;if(a&&a.length>0){let e=Math.floor(Math.random()*a.length);n=a[e].toString()}return t.prepareTenantBackend(n)}(e,n),h=s||!!m,p=(0,k.f)(n,e?.Name,e?.Type),{monitoring:g}=(0,T.Zd)(),w=(0,_.A)(e?.ControlPlane,g)?p:p.filter(({title:e})=>e!==(0,R.A)("field_monitoring-link")),N=P.J.useDatabaseId&&u?.use_meta_proxy!==!1,x=(0,D.YL)({clusterName:e.Cluster,database:N?e.Id:e.Name,backend:m},{withBasename:h}),v=e.controlPlaneName,G=e.Name??(0,R.A)("context_unknown"),B=e.Overall,U=r.useMemo(()=>{let n=[];if(!o)return[];let r=[];for(let e of w)r.push({text:e.title,iconStart:(0,a.jsx)(i.I,{data:e.icon}),iconEnd:(0,a.jsx)(b.A,{}),href:e.url});if(r.length>0&&n.push(r),"Domain"!==e.Type&&t){let r=[];l&&r.push({text:(0,R.A)("action_edit"),iconStart:(0,a.jsx)(f.A,{}),action:()=>{P.J.onEditDB?.({clusterName:t,databaseData:e})}}),c&&r.push({text:(0,R.A)("action_remove"),iconStart:(0,a.jsx)(y.A,{}),action:()=>{P.J.onDeleteDB?.({clusterName:t,databaseData:e})},theme:"danger"}),r.length>0&&n.push(r)}return n},[o,w,t,l,c,e]),H=r.useCallback(()=>U.length?(0,a.jsx)(j.r,{items:U,defaultSwitcherProps:{view:"flat-secondary",size:"xs"},size:"s",menuProps:{size:"l"}}):null,[U]),J=r.useCallback(()=>h?(0,a.jsx)(C.N,{href:x,target:"_blank",className:z("db-name"),children:v}):(0,a.jsx)(L.E,{to:x,className:z("db-name"),children:v}),[h,x,v]),W=r.useCallback(()=>(0,a.jsx)(O.c.Label,{status:B??A.m.Grey,size:"xs"}),[B]),V=r.useCallback(()=>G?(0,a.jsxs)(d.s,{gap:.5,alignItems:"baseline",children:[(0,a.jsx)("span",{className:z("db-path-wrapper"),children:(0,a.jsx)(E.E,{variant:"caption-2",color:"secondary",className:z("db-path"),children:G})}),(0,a.jsx)(S.b,{size:"xs",text:G,className:z("path-copy-icon")})]}):null,[G]);return(0,a.jsxs)(d.s,{direction:"column",gap:.5,children:[(0,a.jsxs)(d.s,{alignItems:"flex-start",justifyContent:"space-between",gap:1,children:[(0,a.jsx)("div",{className:z("db-name-wrapper"),children:J()}),(0,a.jsxs)(d.s,{gap:1,children:[W(),H()]})]}),V()]})}var U=n(2837),H=n(60680),J=n.n(H),W=n(56496),V=n(88367);let F=W.F.injectEndpoints({endpoints:e=>({getTenantsInfo:e.query({queryFn:async({clusterName:e,environmentName:t,isMetaDatabasesAvailable:n},{signal:a})=>{try{let r;return r=n&&window.api.meta?await window.api.meta.getTenantsV2({clusterName:e,environmentName:t},{signal:a}):window.api.meta?await window.api.meta.getTenants({clusterName:e},{signal:a}):await window.api.viewer.getTenants({clusterName:e},{signal:a}),{data:Array.isArray(r.TenantInfo)?(0,V.T3)(r.TenantInfo):[]}}catch(e){return{error:e}}},serializeQueryArgs:({queryArgs:e})=>{let{clusterName:t,environmentName:n}=e;return{clusterName:t,environmentName:n}},providesTags:["All"]})}),overrideExisting:"throw"});var $=n(9849),Z=n(35537),K=n(97855),Q=n(61738),X=n(33702),q=n(28241),Y=n(51432),ee=JSON.parse('{"create-database":"Create database","column-name":"Database","column-type":"Type","column-state":"State","column-cpu":"CPU","column-memory":"Memory","column-storage":"Storage","column-network":"Network","column-nodes":"Nodes","column-groups":"Groups","column-pools":"Pools"}');let et=(0,Y.g4)("ydb-tenants-table",{en:ee}),en="Name",ea="Type",er="State",es="memory",eo="storage",el="Network",ei="nodesCount",ec="groupsCount",ed="PoolStats",eu=[en,ea,er,"cpu",es,eo,el,ei,ec,ed],em=[en],eh={get[en](){return et("column-name")},get[ea](){return et("column-type")},get[er](){return et("column-state")},get cpu(){return et("column-cpu")},get[es](){return et("column-memory")},get[eo](){return et("column-storage")},get[el](){return et("column-network")},get[ei](){return et("column-nodes")},get[ec](){return et("column-groups")},get[ed](){return et("column-pools")}};var ep=n(22708);let eg=(0,G.cn)("tenants"),ew=({clusterName:e,environmentName:t,isMetaDatabasesAvailable:n,scrollContainerRef:b,additionalTenantsProps:f,showDomainDatabase:y,showWithProblemsFilter:j,showPoolsColumn:C})=>{let[E]=(0,Q.Nt)(),{currentData:S,isFetching:D,error:T}=F.useGetTenantsInfoQuery({clusterName:e,environmentName:t,isMetaDatabasesAvailable:n},{pollingInterval:E}),k=D&&void 0===S,[G,M]=r.useState(),_=(0,I.sH)()&&void 0!==P.J.onCreateDB,{search:O,withProblems:L,handleSearchChange:R,handleWithProblemsChange:z}=function(){let[{withProblems:e,search:t},n]=(0,ep.useQueryParams)({withProblems:ep.BooleanParam,search:ep.StringParam});return{withProblems:!!e,search:t||"",handleWithProblemsChange:r.useCallback(e=>{n({withProblems:e||void 0},"replaceIn")},[n]),handleSearchChange:r.useCallback(e=>{n({search:e||void 0},"replaceIn")},[n])}}(),[H]=(0,Q.iK)(U.GS.SHOW_NETWORK_UTILIZATION),W=r.useMemo(()=>{var e;return e=S??[],!y&&e.length>1?e.filter(e=>"Domain"!==e.Type):e},[S,y]),V=r.useMemo(()=>{let e=W;return j&&(e=L?W.filter(e=>e.Overall&&e.Overall!==A.m.Green):W),e.filter(e=>{let t=RegExp(J()(O),"i");return t.test(e.Name||"")||t.test(e.controlPlaneName)})},[W,L,O]),Y=r.useMemo(()=>{let n=[{name:en,header:eh[en],render:({row:n})=>(0,a.jsx)(B,{tenant:n,clusterName:e,additionalTenantsProps:f,externalLink:!!t}),width:440,resizeMinWidth:200,sortable:!0,defaultOrder:o.Ay.DESCENDING},{name:ea,header:eh[ea],width:200,resizeMinWidth:150,render:({row:e})=>"Serverless"!==e.Type?e.Type:(0,a.jsxs)("div",{className:eg("type"),children:[(0,a.jsx)("span",{className:eg("type-value"),children:e.Type}),(0,a.jsx)(l.$,{className:eg("type-button"),onClick:()=>R(e.sharedTenantName||""),children:"Show shared"})]})},{name:er,header:eh[er],width:150,render:({row:e})=>(0,a.jsx)(c.J,{theme:function(e){switch(e){case"CREATING":case"CONFIGURING":return"info";case"RUNNING":return"success";case"REMOVING":return"danger";case"PENDING_RESOURCES":return"warning";default:return"unknown"}}(e.State),children:function(e){if(!e)return Z.Pd;switch(e){case"STATE_UNSPECIFIED":return"Unspecified";case"PENDING_RESOURCES":return"Pending";default:return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}}(e.State)})},{name:"cpu",header:eh.cpu,width:80,render:({row:e})=>e.cpu&&e.cpu>1e4?(0,K.iM)(e.cpu):Z.Pd,align:o.Ay.RIGHT,defaultOrder:o.Ay.DESCENDING},{name:es,header:eh[es],width:120,render:({row:e})=>e.memory?(0,K.vX)(e.memory):Z.Pd,align:o.Ay.RIGHT,defaultOrder:o.Ay.DESCENDING},{name:eo,header:eh[eo],width:120,render:({row:e})=>e.storage?(0,K.vX)(e.storage):Z.Pd,align:o.Ay.RIGHT,defaultOrder:o.Ay.DESCENDING}];return H&&n.push({name:el,header:eh[el],width:120,align:o.Ay.RIGHT,defaultOrder:o.Ay.DESCENDING,sortAccessor:({NetworkWriteThroughput:e=0})=>Number(e),render:({row:e})=>{let{NetworkWriteThroughput:t}=e;return(0,q.kf)(t)?(0,$.z3)({value:t,size:"mb",withSpeedLabel:!0,precision:2}):Z.Pd}}),n.push({name:ei,header:eh[ei],width:100,render:({row:e})=>e.nodesCount?(0,K.ZV)(e.nodesCount):Z.Pd,align:o.Ay.RIGHT,defaultOrder:o.Ay.DESCENDING},{name:ec,header:eh[ec],width:100,render:({row:e})=>e.groupsCount?(0,K.ZV)(e.groupsCount):Z.Pd,align:o.Ay.RIGHT,defaultOrder:o.Ay.DESCENDING}),C&&n.push({name:ed,header:eh[ed],width:100,resizeMinWidth:60,sortAccessor:({PoolStats:e=[]})=>e.reduce((e,t)=>e+(t.Usage||0),0),defaultOrder:o.Ay.DESCENDING,align:o.Ay.LEFT,render:({row:e})=>(0,a.jsx)(p._,{pools:e.PoolStats})}),n},[e,f,t,R,H,C]),{columnsToShow:ee,columnsToSelect:ew,setColumns:eN}=(0,X.K)(Y,"databasesTableSelectedColumns",eh,eu,em);return(0,a.jsx)("div",{className:eg("table-wrapper"),children:(0,a.jsxs)(v.L,{fullHeight:!0,children:[(0,a.jsx)(v.L.Controls,{renderExtraControls:()=>(0,a.jsxs)(d.s,{direction:"row",gap:3,children:[_&&e&&!k?(0,a.jsxs)(l.$,{view:"action",onClick:()=>P.J.onCreateDB?.({clusterName:e}),children:[(0,a.jsx)(i.I,{data:s.A}),et("create-database")]}):null,(0,a.jsx)(x.O,{popupWidth:200,items:ew,showStatus:!0,onUpdate:eN})]}),children:(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)(N.v,{value:O,onChange:R,placeholder:"Database name",className:eg("search")}),j?(0,a.jsx)(g.k,{value:L,onChange:z}):null,(0,a.jsx)(u.T,{total:W?.length,current:V?.length||0,label:"Databases",loading:k})]})}),T?(0,a.jsx)(m.o,{error:T}):null,(0,a.jsx)(v.L.Table,{scrollContainerRef:b,loading:k,scrollDependencies:[O,L,G],children:S?0===V.length&&L?(0,a.jsx)(h.v,{name:"thumbsUp",width:200}):(0,a.jsx)(w.l,{columnsWidthLSKey:"databasesTableColumnsWidth",data:V,columns:ee,settings:Z.N3,emptyDataMessage:"No such tenants",onSortChange:M}):null})]})})}}}]);