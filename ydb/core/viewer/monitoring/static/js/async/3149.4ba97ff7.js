"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([["3149"],{9500:function(e,n,t){t.d(n,{A:()=>r});var a=t(96540);let r=e=>a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M5 13.5h6a1.5 1.5 0 0 0 1.5-1.5V7.243a1.5 1.5 0 0 0-.44-1.061L8.819 2.939a1.5 1.5 0 0 0-1.06-.439H5A1.5 1.5 0 0 0 3.5 4v8A1.5 1.5 0 0 0 5 13.5m9-6.257a3 3 0 0 0-.879-2.122L9.88 1.88A3 3 0 0 0 7.757 1H5a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h6a3 3 0 0 0 3-3zM5 8.25a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5A.75.75 0 0 1 5 8.25m.75 2.25a.75.75 0 0 0 0 1.5h2.5a.75.75 0 0 0 0-1.5z",clipRule:"evenodd"}))},41982:function(e,n,t){t.d(n,{p:()=>p});var a=t(74848),r=t(96540),o=t(24629),s=t(85169),l=t(78419),i=t(2543),d=t(25247),c=t(51432),u=JSON.parse('{"action_show_more":"Show {{count}} more","action_hide":"Hide {{count}}","tooltip_nodes":{"one":"{{count}} Node","other":"{{count}} Nodes"}}');let h=(0,c.g4)("ydb-versions-bar",{en:u}),m=(0,d.cn)("ydb-versions-bar");function p({preparedVersions:e,withTitles:n=!0,size:t="s"}){let d=e.length>4&&"s"===t,[c,u]=r.useState(),[p,g]=r.useState(!1),w=r.useMemo(()=>{let n=e.reduce((e,n)=>e+(n.count||0),0);return e.map(e=>({value:(e.count||0)/n*100,color:e.color,version:e.version,count:e.count}))},[e]),N=r.useMemo(()=>p?e:d?e.slice(0,3):e,[p,e,d]),x=e=>{e.preventDefault(),e.stopPropagation(),g(!0)},y=e=>{e.preventDefault(),e.stopPropagation(),g(!1)},b=r.useMemo(()=>(0,i.debounce)(e=>{u(e)},200),[]),f=r.useMemo(()=>(b.cancel(),(0,i.debounce)(()=>{u(void 0)},200)),[b]),C=e=>!!(c&&c!==e);return(0,a.jsxs)(s.s,{direction:"column",className:m("bar-wrapper",{size:t}),wrap:!0,children:[(0,a.jsx)(s.s,{className:m("bar",{size:t}),grow:1,children:w.map(e=>(0,a.jsx)(l.m,{content:(0,a.jsxs)(r.Fragment,{children:[h("tooltip_nodes",{count:e.count}),(0,a.jsx)("br",{}),e.version]}),placement:"m"===t?"auto":"top-start",openDelay:200,children:(0,a.jsx)("span",{onMouseEnter:()=>{b(e.version)},onMouseLeave:f,className:m("version",{dimmed:C(e.version),size:t}),style:{backgroundColor:e.color,width:`${e.value}%`}})},e.version))}),n&&(0,a.jsxs)(s.s,{className:m("titles-wrapper",{size:t}),children:[N.map(e=>(0,a.jsx)(v,{version:e.version,color:e.color||"",count:e.count,isDimmed:C(e.version),onMouseEnter:()=>{b(e.version)},onMouseLeave:f,size:t},e.version)),(()=>{if(!d)return null;let n=e.length-3;return p?(0,a.jsx)(o.$,{view:"flat-secondary",size:"s",onClick:y,className:m("button"),children:h("action_hide",{count:n})}):(0,a.jsx)(o.$,{view:"flat-secondary",size:"s",onClick:x,className:m("button"),children:h("action_show_more",{count:n})})})()]})]})}function v({version:e,color:n,count:t,isDimmed:r,onMouseEnter:o,onMouseLeave:i,size:d}){return(0,a.jsx)(l.m,{content:h("tooltip_nodes",{count:t}),placement:"bottom-end",openDelay:200,children:(0,a.jsxs)(s.s,{alignItems:"center",className:m("title",{size:d}),children:[(0,a.jsx)(g,{size:d,dimmed:r,color:n}),(0,a.jsx)("div",{className:m("title-text",{dimmed:r,size:d}),onMouseEnter:o,onMouseLeave:i,children:e})]})})}function g({size:e,dimmed:n,color:t}){let r="m"===e?8:6,o=r/2;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:`0 0 ${r} ${r}`,fill:"none",className:m("version-icon",{dimmed:n}),children:(0,a.jsx)("circle",{cx:o,cy:o,r:o,fill:t})})}},21116:function(e,n,t){t.d(n,{A:()=>X});var a=t(74848),r=t(96540),o=t(16509),s=t(39688),l=t(68910),i=t(29581),d=t(24629),c=t(17427),u=t(97547),h=t(61058),m=t(67103),p=t(78870),v=t(48649),g=t(53808),w=t(74010),N=t(4320),x=t(48849),y=t(66918),b=t(85169),f=t(8946),C=t(71790),j=t(67222),D=t(79121),E=t(88831),T=t(95200),A=t(93397),S=t(60318),I=t(9259);function P({tenant:e,additionalTenantsProps:n,externalLink:t}){let r=(0,E.X)(),{settings:o}=(0,C.Zd)(),s=((e,n)=>{let t;if("function"!=typeof n?.prepareTenantBackend)return;let a=e.NodeIds??e.sharedNodeIds;if(a&&a.length>0){let e=Math.floor(Math.random()*a.length);t=a[e].toString()}return n.prepareTenantBackend(t)})(e,n),l=t||!!s,i=(0,D.f)(n,e?.Name,e?.Type),{monitoring:d}=(0,C.Zd)(),c=(0,T.A)(e?.ControlPlane,d)?i:i.filter(({title:e})=>e!==(0,I.A)("field_monitoring-link")),u=c.length>0&&r?(0,a.jsx)(y.u,{responsive:!0,children:(0,a.jsx)(y.u.Item,{name:(0,I.A)("field_links"),children:(0,a.jsx)(b.s,{gap:2,wrap:"wrap",children:c.map(({title:e,url:n})=>(0,a.jsx)(S.K,{title:e,url:n},e))})})}):null,h=j.J.useDatabaseId&&o?.use_meta_proxy!==!1;return(0,a.jsx)(A.c,{externalLink:l,name:e.Name||(0,I.A)("context_unknown"),withLeftTrim:!0,status:e.Overall,infoPopoverContent:u,hasClipboardButton:!0,path:(0,f.YL)({clusterName:e.Cluster,database:h?e.Id:e.Name,backend:s},{withBasename:l})})}var _=t(1459),k=t(2837),M=t(60680),G=t.n(M),O=t(40897),L=t(56496),R=t(88367);let B=L.F.injectEndpoints({endpoints:e=>({getTenantsInfo:e.query({queryFn:async({clusterName:e,environmentName:n,isMetaDatabasesAvailable:t},{signal:a})=>{try{let r;return r=t&&window.api.meta?await window.api.meta.getTenantsV2({clusterName:e,environmentName:n},{signal:a}):window.api.meta?await window.api.meta.getTenants({clusterName:e},{signal:a}):await window.api.viewer.getTenants({clusterName:e},{signal:a}),{data:Array.isArray(r.TenantInfo)?(0,R.T3)(r.TenantInfo):[]}}catch(e){return{error:e}}},serializeQueryArgs:({queryArgs:e})=>{let{clusterName:n,environmentName:t}=e;return{clusterName:n,environmentName:t}},providesTags:["All"]})}),overrideExisting:"throw"});var z=t(9849),H=t(25247),J=t(35537),U=t(97855),W=t(61738),$=t(28241),F=t(51432),Z=JSON.parse('{"create-database":"Create database","remove":"Remove","edit":"Edit"}');let K=(0,F.g4)("ydb-tenants-table",{en:Z});var V=t(22708);let Q=(0,H.cn)("tenants"),X=({clusterName:e,environmentName:n,isMetaDatabasesAvailable:t,showDomainDatabase:y,scrollContainerRef:b,additionalTenantsProps:f})=>{let[C]=(0,W.Nt)(),{currentData:D,isFetching:E,error:T}=B.useGetTenantsInfoQuery({clusterName:e,environmentName:n,isMetaDatabasesAvailable:t},{pollingInterval:C}),A=E&&void 0===D,[S,I]=r.useState(),M=(0,_.sH)()&&void 0!==j.J.onCreateDB,L=(0,_.g7)()&&void 0!==j.J.onEditDB,R=(0,_.TW)()&&void 0!==j.J.onDeleteDB,{search:H,withProblems:F,handleSearchChange:Z,handleWithProblemsChange:X}=function(){let[{withProblems:e,search:n},t]=(0,V.useQueryParams)({withProblems:V.BooleanParam,search:V.StringParam});return{withProblems:!!e,search:n||"",handleWithProblemsChange:r.useCallback(e=>{t({withProblems:e||void 0},"replaceIn")},[t]),handleSearchChange:r.useCallback(e=>{t({search:e||void 0},"replaceIn")},[t])}}(),[q]=(0,W.iK)(k.GS.SHOW_NETWORK_UTILIZATION),Y=r.useMemo(()=>{var e;return e=D??[],!y&&e.length>1?e.filter(e=>"Domain"!==e.Type):e},[D,y]),ee=r.useMemo(()=>{var e;return e=F?Y.filter(e=>e.Overall&&e.Overall!==O.m.Green):Y,e.filter(e=>{let n=RegExp(G()(H),"i");return n.test(e.Name||"")||n.test(e.controlPlaneName)})},[Y,F,H]);return(0,a.jsx)("div",{className:Q("table-wrapper"),children:(0,a.jsxs)(x.L,{fullHeight:!0,children:[(0,a.jsx)(x.L.Controls,{renderExtraControls:()=>M&&e&&!A?(0,a.jsxs)(d.$,{view:"action",onClick:()=>j.J.onCreateDB?.({clusterName:e}),children:[(0,a.jsx)(c.I,{data:o.A}),K("create-database")]}):null,children:(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)(N.v,{value:H,onChange:Z,placeholder:"Database name",className:Q("search")}),(0,a.jsx)(g.k,{value:F,onChange:X}),(0,a.jsx)(h.T,{total:Y?.length,current:ee?.length||0,label:"Databases",loading:A})]})}),T?(0,a.jsx)(m.o,{error:T}):null,(0,a.jsx)(x.L.Table,{scrollContainerRef:b,loading:A,scrollDependencies:[H,F,S],children:D?(()=>{let t=[{name:"Name",header:"Database",render:({row:e})=>(0,a.jsx)(P,{tenant:e,additionalTenantsProps:f,externalLink:!!n}),width:440,sortable:!0,defaultOrder:i.Ay.DESCENDING},{name:"controlPlaneName",header:"Name",render:({row:e})=>e.controlPlaneName,width:200,sortable:!0,defaultOrder:i.Ay.DESCENDING},{name:"Type",width:200,resizeMinWidth:150,render:({row:e})=>"Serverless"!==e.Type?e.Type:(0,a.jsxs)("div",{className:Q("type"),children:[(0,a.jsx)("span",{className:Q("type-value"),children:e.Type}),(0,a.jsx)(d.$,{className:Q("type-button"),onClick:()=>Z(e.sharedTenantName||""),children:"Show shared"})]})},{name:"State",width:150,render:({row:e})=>(function(e){if(!e)return J.Pd;switch(e){case"STATE_UNSPECIFIED":return"Unspecified";case"PENDING_RESOURCES":return"Pending";default:return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}})(e.State)},{name:"cpu",header:"CPU",width:80,render:({row:e})=>e.cpu&&e.cpu>1e4?(0,U.iM)(e.cpu):J.Pd,align:i.Ay.RIGHT,defaultOrder:i.Ay.DESCENDING},{name:"memory",header:"Memory",width:120,render:({row:e})=>e.memory?(0,U.vX)(e.memory):J.Pd,align:i.Ay.RIGHT,defaultOrder:i.Ay.DESCENDING},{name:"storage",header:"Storage",width:120,render:({row:e})=>e.storage?(0,U.vX)(e.storage):J.Pd,align:i.Ay.RIGHT,defaultOrder:i.Ay.DESCENDING}];if(q&&t.push({name:"Network",header:"Network",width:120,align:i.Ay.RIGHT,defaultOrder:i.Ay.DESCENDING,sortAccessor:({NetworkWriteThroughput:e=0})=>Number(e),render:({row:e})=>{let{NetworkWriteThroughput:n}=e;return(0,$.kf)(n)?(0,z.z3)({value:n,size:"mb",withSpeedLabel:!0,precision:2}):J.Pd}}),t.push({name:"nodesCount",header:"Nodes",width:100,render:({row:e})=>e.nodesCount?(0,U.ZV)(e.nodesCount):J.Pd,align:i.Ay.RIGHT,defaultOrder:i.Ay.DESCENDING},{name:"groupsCount",header:"Groups",width:100,render:({row:e})=>e.groupsCount?(0,U.ZV)(e.groupsCount):J.Pd,align:i.Ay.RIGHT,defaultOrder:i.Ay.DESCENDING},{name:"PoolStats",header:"Pools",width:100,resizeMinWidth:60,sortAccessor:({PoolStats:e=[]})=>e.reduce((e,n)=>e+(n.Usage||0),0),defaultOrder:i.Ay.DESCENDING,align:i.Ay.LEFT,render:({row:e})=>(0,a.jsx)(v._,{pools:e.PoolStats})}),e&&(R||L)){let n=function({clusterName:e,isEditDBAvailable:n,isDeleteDBAvailable:t}){return{name:"actions",header:"",width:40,resizeable:!1,align:i.Ay.CENTER,render:({row:r})=>{let o=[];return"Domain"===r.Type?null:(n&&o.push({text:K("edit"),iconStart:(0,a.jsx)(s.A,{}),action:()=>{j.J.onEditDB?.({clusterName:e,databaseData:r})}}),t&&o.push({text:K("remove"),iconStart:(0,a.jsx)(l.A,{}),action:()=>{j.J.onDeleteDB?.({clusterName:e,databaseData:r})},theme:"danger"}),o.length)?(0,a.jsx)(u.r,{items:o}):null}}}({clusterName:e,isDeleteDBAvailable:R,isEditDBAvailable:L});t.push(n)}return 0===ee.length&&F?(0,a.jsx)(p.v,{name:"thumbsUp",width:200}):(0,a.jsx)(w.l,{columnsWidthLSKey:"databasesTableColumnsWidth",data:ee,columns:t,settings:J.N3,emptyDataMessage:"No such tenants",onSortChange:I})})():null})]})})}}}]);