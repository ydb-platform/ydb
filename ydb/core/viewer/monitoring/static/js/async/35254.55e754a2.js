"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([["35254"],{23273:function(e,t,l){l.d(t,{E:()=>p});var a=l(74848),n=l(32065),r=l(24629),i=l(43834),o=l(56496),s=l(25247),d=l(81882),c=l(51432),u=JSON.parse('{"None":"None","15 sec":"15 sec","1 min":"1 min","2 min":"2 min","5 min":"5 min","Refresh":"Refresh"}');let h=(0,c.g4)("ydb-diagnostics-autorefresh-control",{en:u}),m=(0,s.cn)("auto-refresh-control");function p({className:e,onManualRefresh:t}){let l=(0,d.YQ)(),[s,c]=(0,d.Nt)();return(0,a.jsxs)("div",{className:m(null,e),children:[(0,a.jsx)(r.$,{view:"flat-secondary",onClick:()=>{l(o.F.util.invalidateTags(["All"])),t?.()},"aria-label":h("Refresh"),children:(0,a.jsx)(r.$.Icon,{children:(0,a.jsx)(n.A,{})})}),(0,a.jsxs)(i.l,{value:[String(s)],onUpdate:e=>{c(Number(e))},width:85,qa:"ydb-autorefresh-select",children:[(0,a.jsx)(i.l.Option,{value:"0",children:h("None")}),(0,a.jsx)(i.l.Option,{value:"15000",children:h("15 sec")}),(0,a.jsx)(i.l.Option,{value:"60000",children:h("1 min")}),(0,a.jsx)(i.l.Option,{value:"120000",children:h("2 min")}),(0,a.jsx)(i.l.Option,{value:"300000",children:h("5 min")})]})]})}},78918:function(e,t,l){l.d(t,{$:()=>s});var a=l(74848),n=l(40897),r=l(25247),i=l(17989);let o=(0,r.cn)("ydb-entity-page-title");function s({entityName:e,status:t=n.m.Grey,id:l,className:r}){return(0,a.jsxs)("div",{className:o(null,r),children:[(0,a.jsx)("span",{className:o("prefix"),children:e}),(0,a.jsx)(i.k,{className:o("icon"),status:t,size:"s"}),l]})}},83004:function(e,t,l){l.d(t,{B:()=>c});var a=l(74848),n=l(85169),r=l(25247),i=l(23273),o=l(40700);let s=(0,r.cn)("ydb-page-meta");function d({items:e,loading:t}){return(0,a.jsx)("div",{className:s("info"),children:t?(0,a.jsx)(o.E,{className:s("skeleton")}):e.filter(e=>!!e).join("\xa0\xa0\xb7\xa0\xa0")})}function c({className:e,...t}){return(0,a.jsxs)(n.s,{gap:1,alignItems:"center",justifyContent:"space-between",className:s(null,e),children:[(0,a.jsx)(d,{...t}),(0,a.jsx)(i.E,{})]})}},40700:function(e,t,l){l.d(t,{E:()=>i});var a=l(74848),n=l(86268),r=l(28544);let i=({delay:e=600,className:t})=>{let[l]=(0,r.y)(e);return l?(0,a.jsx)(n.E,{className:t}):null}},43696:function(e,t,l){l.d(t,{A:()=>i,X:()=>o});var a=l(74848),n=l(51936);let r=(0,l(25247).cn)("ydb-table");function i({children:e,className:t}){return(0,a.jsx)("div",{className:r("table-header-content",t),children:e})}function o({className:e,width:t,wrapperClassName:l,...i}){return(0,a.jsx)("div",{className:r(null,l),children:(0,a.jsx)(n.WE,{headerCellClassName:({column:e})=>r("table-header-cell",{align:e.columnDef.meta?.align}),cellClassName:e=>r("table-cell",{align:e?.column.columnDef.meta?.align,"vertical-align":e?.column.columnDef.meta?.verticalAlign}),className:r("table",{width:t},e),...i})})}},66660:function(e,t,l){l.d(t,{i:()=>i});var a=l(74848),n=l(5434),r=l(53486);function i({state:e}){return(0,a.jsx)(n.J,{theme:(0,r._)(e),children:e})}},57916:function(e,t,l){l.r(t),l.d(t,{Tablet:()=>ef});var a=l(74848),n=l(96540),r=l(85169),i=l(4329),o=l(38482),s=l(65127),d=l(18117),c=l(85902),u=l(56347),h=l(22708),m=l(14476),p=l(78636),b=l(78918),g=l(67103),v=l(15749),x=l(42724),f=l(83004),w=l(8946),j=l(39471),y=l(56946),T=l(40897),_=l(25247),I=l(35537),N=l(81882),S=l(88831),C=l(28722);let k=e=>n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),n.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M4.5 1.5a3 3 0 0 0-3 3v7a3 3 0 0 0 3 3h7a3 3 0 0 0 3-3v-7a3 3 0 0 0-3-3z",clipRule:"evenodd"})),D=e=>n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16"},e),n.createElement("path",{fill:"currentColor",d:"M13.756 10.164c1.665-.962 1.665-3.366 0-4.328L5.251.919C3.584-.045 1.5 1.158 1.5 3.083v9.834c0 1.925 2.084 3.128 3.751 2.164z"}));var E=l(17427),A=l(32692),R=l(51432),G=JSON.parse('{"tablet.header":"Tablet","tablet.meta-database":"Database","tablet.meta-follower":"Follower","controls.kill":"Restart","controls.stop":"Stop","controls.resume":"Resume","controls.kill-not-allowed":"You don\'t have enough rights to restart tablet","controls.stop-not-allowed":"You don\'t have enough rights to stop tablet","controls.resume-not-allowed":"You don\'t have enough rights to resume tablet","dialog.kill-header":"Restart tablet","dialog.stop-header":"Stop tablet","dialog.resume-header":"Resume tablet","dialog.kill-text":"The tablet will be restarted. Do you want to proceed?","dialog.stop-text":"The tablet will be stopped. Do you want to proceed?","dialog.resume-text":"The tablet will be resumed. Do you want to proceed?","emptyState":"The tablet was not found","label_tablet-history":"Tablets","label_tablet-channels":"Storage"}');let $=(0,R.g4)("ydb-tablet-page",{en:G});function Y(e){return!!(e&&"0"!==e)}let F=({tablet:e})=>{let{TabletId:t,HiveId:l}=e,i=(0,S.X)(),[o]=y.X.useKillTabletMutation(),[s]=y.X.useStopTabletMutation(),[d]=y.X.useResumeTabletMutation();if(!t)return null;let c=Y(l),u="Stopped"===e.State,h="Stopped"!==e.State&&"Dead"!==e.State,m="Stopped"===e.State||"Deleted"===e.State;return(0,a.jsxs)(r.s,{gap:2,wrap:"nowrap",children:[(0,a.jsxs)(A.B,{dialogHeader:$("dialog.kill-header"),dialogText:$("dialog.kill-text"),onConfirmAction:()=>o({id:t}).unwrap(),buttonDisabled:u||!i,withPopover:!0,buttonView:"normal",popoverContent:$("controls.kill-not-allowed"),popoverPlacement:"bottom",popoverDisabled:i,children:[(0,a.jsx)(E.I,{data:C.A}),$("controls.kill")]}),c&&(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)(A.B,{dialogHeader:$("dialog.stop-header"),dialogText:$("dialog.stop-text"),onConfirmAction:()=>s({id:t,hiveId:l}).unwrap(),buttonDisabled:m||!i,withPopover:!0,buttonView:"normal",popoverContent:$("controls.stop-not-allowed"),popoverPlacement:"bottom",popoverDisabled:i,children:[(0,a.jsx)(E.I,{data:k}),$("controls.stop")]}),(0,a.jsxs)(A.B,{dialogHeader:$("dialog.resume-header"),dialogText:$("dialog.resume-text"),onConfirmAction:()=>d({id:t,hiveId:l}).unwrap(),buttonDisabled:h||!i,withPopover:!0,buttonView:"normal",popoverContent:$("controls.resume-not-allowed"),popoverPlacement:"bottom",popoverDisabled:i,children:[(0,a.jsx)(E.I,{data:D}),$("controls.resume")]})]})]})};var q=l(54625),z=l(83758),O=l(60318),P=l(66660),H=l(9753),K=l(88387),X=l(81709),B=JSON.parse('{"field_scheme-shard":"SchemeShard","field_follower":"Follower","field_generation":"Generation","field_hive":"HiveId","field_state":"State","field_uptime":"Uptime","field_node":"Node","field_links":"Links","field_developer-ui-app":"App","field_developer-ui-counters":"Counters","field_developer-ui-executor":"Executor DB internals","field_developer-ui-state":"State Storage","title_info":"Info","title_links":"Links"}');let L=(0,R.g4)("ydb-tablet-info",{en:B}),M=(0,_.cn)("ydb-tablet-info"),Q=({tablet:e})=>{let t=(0,w.Cs)(),l=(0,S.X)(),n=(0,X.J)(),{ChangeTime:i,Generation:o,FollowerId:s,NodeId:d,HiveId:c,State:u,TenantId:{SchemeShard:h}={},TabletId:m}=e,p=Y(c),b="Active"===u,g=[];return p&&g.push({label:L("field_hive"),value:(0,a.jsx)(q.N_,{to:t(c),className:M("link"),children:c})}),h&&g.push({label:L("field_scheme-shard"),value:(0,a.jsx)(q.N_,{to:t(h),className:M("link"),children:h})}),g.push({label:L("field_state"),value:(0,a.jsx)(P.i,{state:u})}),b&&g.push({label:L("field_uptime"),value:(0,a.jsx)(H.H,{ChangeTime:i})}),g.push({label:L("field_generation"),value:o},{label:L("field_node"),value:(0,a.jsx)(q.N_,{className:M("link"),to:(0,w.vI)({id:String(d)},{database:n}),children:d})}),s&&g.push({label:L("field_follower"),value:s}),(0,a.jsxs)(r.s,{gap:10,wrap:"nowrap",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:M("section-title"),children:L("title_info")}),(0,a.jsx)(z.z_,{info:g})]}),l&&m?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:M("section-title"),children:L("title_links")}),(0,a.jsxs)(r.s,{direction:"column",gap:3,children:[(0,a.jsx)(O.K,{title:L("field_developer-ui-app"),url:(0,K._t)(m,"app")}),(0,a.jsx)(O.K,{title:L("field_developer-ui-counters"),url:(0,K._t)(m,"counters")}),(0,a.jsx)(O.K,{title:L("field_developer-ui-executor"),url:(0,K._t)(m,"executorInternals")}),(0,a.jsx)(O.K,{title:L("field_developer-ui-state"),url:(0,K._t)(m,void 0,"SsId")})]})]}):null]})};var J=l(51936),V=l(43696),W=l(24629),U=l(94866),Z=l(97855),ee=JSON.parse('{"label_channel-index":"Channel","label_storage-pool":"Storage Pool Name","label_group-id":"Group ID","label_generation":"From generation","label_timestamp":"Timestamp"}');let et=(0,R.g4)("ydb-tablet-storage-info",{en:ee}),el=(0,_.cn)("ydb-tablet-storage-info");function ea(e,t){let l=e.getValue(),n="function"==typeof t?t(l):l;return(0,a.jsx)("div",{className:el("metrics-cell"),children:n})}function en({row:e,name:t,hasExpand:l}){let n=e.getCanExpand();return(0,a.jsxs)(r.s,{gap:1,alignItems:"flex-start",className:el("name-wrapper"),children:[n&&(0,a.jsx)(W.$,{view:"flat",size:"xs",onClick:e.getToggleExpandedHandler(),children:(0,a.jsx)(W.$.Icon,{children:(0,a.jsx)(U.I,{direction:e.getIsExpanded()?"bottom":"right",size:14})})}),(0,a.jsx)("div",{className:el("name-content",{"no-control":l&&!n}),children:t})]})}function er({data:e}){let[t,l]=n.useState({}),r=n.useMemo(()=>(function(e){if(!e)return[];let{BoundChannels:t,TabletStorageInfo:l={}}=e,a=l.Channels??[],n=[];for(let e of a){let l=e.Channel,a=e.History;if(!l||!a||!a.length)continue;let r=[...a];r.reverse();let[i,...o]=r,s=t?.[l]?.StoragePoolName,d={...i,storagePoolName:s,channelIndex:l,children:o};n.push(d)}return n})(e),[e]),i=n.useMemo(()=>r.some(e=>e.children?.length),[r]),o=n.useMemo(()=>[{accessorKey:"channelIndex",header:()=>(0,a.jsx)(V.A,{children:et("label_channel-index")}),size:50,cell:ea,meta:{align:"right"}},{accessorKey:"storagePoolName",header:()=>(0,a.jsx)(V.A,{children:et("label_storage-pool")}),size:200,cell:ea},{accessorKey:"GroupID",header:()=>(0,a.jsx)(V.A,{className:i?el("with-padding"):void 0,children:et("label_group-id")}),size:100,cell:e=>(0,a.jsx)(en,{row:e.row,name:e.getValue(),hasExpand:i})},{accessorKey:"FromGeneration",header:()=>(0,a.jsx)(V.A,{children:et("label_generation")}),size:100,cell:ea,meta:{align:"right"}},{accessorKey:"Timestamp",header:()=>(0,a.jsx)(V.A,{children:et("label_timestamp")}),size:200,cell:e=>ea(e,Z.Ey),meta:{align:"right"}}],[i]),s=(0,J.K2)({columns:o,data:r,getSubRows:e=>e.children,enableExpanding:!0,onExpandedChange:l,state:{expanded:t}});return(0,a.jsx)(V.X,{table:s})}var ei=l(29581),eo=l(93397),es=l(19122),ed=l(29432),ec=l(74010),eu=l(44524);function eh({tabletId:e,row:t}){let l=(0,w.Cs)()(e,{followerId:t.leader?void 0:t.followerId?.toString()}),n=`${e}${t.followerId?`.${t.followerId}`:""}`;return(0,a.jsx)(es.E,{to:l,children:n})}let em={displayIndices:!1,highlightRows:!0},ep=({history:e,tabletId:t})=>{let l=n.useMemo(()=>(({tabletId:e})=>[{name:"Generation",align:ei.Ay.RIGHT,render:({row:e})=>e.generation},{name:"Change time",align:ei.Ay.RIGHT,sortable:!1,render:({row:e})=>(0,a.jsx)(H.H,{ChangeTime:e.changeTime}),width:120},{name:"State",sortable:!1,render:({row:e})=>(0,a.jsx)(P.i,{state:e.state})},{name:"Tablet",sortable:!1,render:({row:t})=>(0,a.jsx)(eh,{row:t,tabletId:e})},{name:"Node ID",align:ei.Ay.RIGHT,sortable:!1,render:({row:e})=>(0,a.jsx)(ed.W,{id:e.nodeId})},{name:"Node FQDN",sortable:!1,width:300,render:({row:e})=>e.fqdn?(0,a.jsx)(eo.c,{name:e.fqdn,showStatus:!1,hasClipboardButton:!0}):eu.Pd}])({tabletId:t}),[t]);return(0,a.jsx)(ec.l,{columnsWidthLSKey:"tabletTableColumnsWidth",data:e,columns:l,settings:em,initialSortOrder:{columnId:"Generation",order:ei.Ay.DESCENDING}})},eb=(0,_.cn)("ydb-tablet-page"),eg={history:"history",channels:"channels"},ev=[{id:eg.history,get title(){return $("label_tablet-history")}},{id:eg.channels,get title(){return $("label_tablet-channels")},isAdvanced:!0}],ex=m.z.nativeEnum(eg).catch(eg.history);function ef(){let e=(0,N.YQ)(),{id:t}=(0,u.g)(),[{database:l,clusterName:i,followerId:o}]=(0,h.useQueryParams)(w.qc),s=l?.toString(),[m]=(0,N.Nt)(),{currentData:p,isFetching:b,error:v}=y.X.useGetTabletQuery({id:t,database:s,followerId:o??void 0},{pollingInterval:m}),{data:T={},history:_=[]}=p||{},{currentData:S}=y.X.useGetTabletDescribeQuery(T.TenantId?{tenantId:T.TenantId,database:s}:d.hT),C=T.Type;n.useEffect(()=>{e((0,j.g)("tablet",{database:s,tabletId:t,tabletType:C,databaseName:S}))},[e,s,t,C,S]);let{Leader:k}=T,D=[];return S&&D.push(`${$("tablet.meta-database")}: ${S}`),D.push($("tablet.header")),!1===k&&D.push($("tablet.meta-follower").toUpperCase()),(0,a.jsxs)(r.s,{gap:5,direction:"column",className:eb(),children:[(0,a.jsx)(c.mg,{children:(0,a.jsx)("title",{children:`${t} — ${$("tablet.header")} — ${S||i||I.QM}`})}),(0,a.jsx)(f.B,{items:D}),(0,a.jsxs)(x.r,{loading:b&&void 0===p,size:"l",children:[v?(0,a.jsx)(g.o,{error:v}):null,p?(0,a.jsx)(ew,{id:t,tablet:T,history:_}):null]})]})}function ew({id:e,tablet:t,history:l}){let n=!Object.keys(t).length,{Overall:i,HiveId:o,FollowerId:s,Type:d}=t,c=`${e}${s?`.${s}`:""}`;return(0,a.jsxs)(p.q5,{title:$("emptyState"),className:eb("placeholder"),isEmpty:n,children:[(0,a.jsxs)(r.s,{gap:5,direction:"column",children:[(0,a.jsx)(b.$,{entityName:d||$("tablet.header"),status:i??T.m.Grey,id:c}),(0,a.jsx)(F,{tablet:t}),(0,a.jsx)(Q,{tablet:t})]}),(0,a.jsx)(ej,{id:e,hiveId:o,history:l})]})}function ej({id:e,hiveId:t,history:l}){let d=(0,w.Cs)(),[{activeTab:c,...u},m]=(0,h.useQueryParams)(w.qc),p=!(0,S.X)()||!Y(t),b=ex.parse(c);return p&&ev.find(e=>e.id===b)?.isAdvanced&&(b=eg.history),n.useEffect(()=>{c!==b&&m({activeTab:b},"replaceIn")},[c,b,m]),(0,a.jsxs)(r.s,{gap:5,direction:"column",children:[(0,a.jsx)("div",{children:(0,a.jsx)(i.f,{value:b,children:(0,a.jsx)(o.w,{size:"l",children:ev.filter(({isAdvanced:e})=>!e||!p).map(({id:t,title:l})=>{let n=d(e,{...u,activeTab:t});return(0,a.jsx)(s.o,{value:t,children:(0,a.jsx)(v.E,{view:"primary",as:"tab",to:n,children:l})},t)})})})}),"history"===b?(0,a.jsx)(ep,{history:l,tabletId:e}):null,"channels"!==b||p?null:(0,a.jsx)(ey,{id:e,hiveId:t})]})}function ey({id:e,hiveId:t}){let[l]=(0,N.Nt)(),{currentData:n,error:r,isFetching:i}=y.X.useGetAdvancedTableInfoQuery({id:e,hiveId:t},{pollingInterval:l});return(0,a.jsxs)(x.r,{loading:i&&void 0===n,size:"l",children:[r?(0,a.jsx)(g.o,{error:r}):null,n?(0,a.jsx)(er,{data:n}):null]})}},56946:function(e,t,l){l.d(t,{X:()=>n});var a=l(65101);let n=l(56496).F.injectEndpoints({endpoints:e=>({getTablet:e.query({queryFn:async({id:e,database:t,followerId:l},{signal:n})=>{try{let[r,i,o]=await Promise.all([window.api.viewer.getTablet({id:e,database:t,followerId:l},{signal:n}),window.api.viewer.getTabletHistory({id:e,database:t},{signal:n}),window.api.viewer.getNodesList({database:t},{signal:n})]),s=(0,a.nN)(o),d=Object.keys(i).reduce((e,t)=>{let l=i[t]?.TabletStateInfo;return l?.forEach(l=>{let{ChangeTime:a,Generation:n,State:r,Leader:i,FollowerId:o}=l,d=s&&t?s.get(Number(t))?.Host:void 0;e.push({nodeId:t,generation:n,changeTime:a,state:r,leader:i,followerId:o,fqdn:d})}),e},[]),{TabletStateInfo:c=[]}=r,u=void 0===l?c.find(e=>e.Leader):c.find(e=>e.FollowerId?.toString()===l),{TabletId:h}=u||{};return{data:{id:h,data:u,history:d}}}catch(e){return{error:e}}},providesTags:(e,t,l)=>["All",{type:"Tablet",id:l.id}]}),getTabletDescribe:e.query({queryFn:async({tenantId:e,database:t},{signal:l})=>{try{let a=await window.api.viewer.getTabletDescribe(e,t,{signal:l}),{SchemeShard:n,PathId:r}=e;return{data:a?.Path||`${n}:${r}`}}catch(e){return{error:e}}},providesTags:["All"]}),getAdvancedTableInfo:e.query({queryFn:async({id:e,hiveId:t},{signal:l})=>{try{return{data:await window.api.tablets.getTabletFromHive({id:e,hiveId:t},{signal:l})}}catch(e){return{error:e}}},providesTags:(e,t,l)=>["All",{type:"Tablet",id:l.id}]}),killTablet:e.mutation({queryFn:async({id:e})=>{try{return{data:await window.api.tablets.killTablet(e)}}catch(e){return{error:e}}},invalidatesTags:(e,t,l)=>[{type:"Tablet",id:l.id},{type:"Tablet",id:"LIST"}]}),stopTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.stopTablet(e,t)}}catch(e){return{error:e}}},invalidatesTags:(e,t,l)=>[{type:"Tablet",id:l.id},{type:"Tablet",id:"LIST"}]}),resumeTablet:e.mutation({queryFn:async({id:e,hiveId:t})=>{try{return{data:await window.api.tablets.resumeTablet(e,t)}}catch(e){return{error:e}}},invalidatesTags:(e,t,l)=>[{type:"Tablet",id:l.id},{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"})},53486:function(e,t,l){l.d(t,{P:()=>r,_:()=>i});var a=l(40897);let n={Dead:a.m.Red,Created:a.m.Yellow,ResolveStateStorage:a.m.Yellow,Candidate:a.m.Yellow,BlockBlobStorage:a.m.Yellow,WriteZeroEntry:a.m.Yellow,Restored:a.m.Yellow,Discover:a.m.Yellow,Lock:a.m.Yellow,Stopped:a.m.Yellow,ResolveLeader:a.m.Yellow,RebuildGraph:a.m.Yellow,Terminating:a.m.Yellow,Deleted:a.m.Green,Active:a.m.Green},r=e=>e?Object.values(a.m).includes(e)?e:n[e]:a.m.Grey;function i(e){if(!e)return"unknown";switch(e){case"Dead":return"danger";case"Active":case"Deleted":return"success";default:return"warning"}}}}]);