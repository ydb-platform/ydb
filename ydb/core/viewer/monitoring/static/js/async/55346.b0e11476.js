"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([["55346"],{12543:function(e,t,a){a.d(t,{a:()=>r.a});var r=a(17549)},60198:function(e,t,a){a.r(t),a.d(t,{YDBSyntaxHighlighter:()=>v});var r=a(74848),n=a(96540),s=a(50934),i=a(9243);let l=(0,a(25247).cn)("ydb-syntax-highlighter"),o={name:"yql-light",type:"light",tokenColors:[{scope:["comment.block"],settings:{foreground:"#969896",fontStyle:"italic"}},{scope:["string.quoted.double"],settings:{foreground:"#a31515"}},{scope:["string.interpolated"],settings:{foreground:"#338186"}},{scope:["entity.name.function"],settings:{foreground:"#7a3e9d"}},{scope:["entity.name.type"],settings:{foreground:"#4d932d"}},{scope:["keyword.control"],settings:{foreground:"#0000ff"}},{scope:["constant.numeric"],settings:{foreground:"#098658"}},{scope:["support.constant"],settings:{foreground:"#7497c4"}},{scope:["variable.parameter"],settings:{foreground:"#000000"}},{scope:["variable.other"],settings:{foreground:"#000000"}}]},c={name:"yql-dark",type:"dark",colors:{"editor.foreground":"#d4d4d4","editor.background":"#1e1e1e"},tokenColors:[{scope:["comment.block"],settings:{foreground:"#969896",fontStyle:"italic"}},{scope:["string.quoted.double"],settings:{foreground:"#ce9178"}},{scope:["string.interpolated"],settings:{foreground:"#338186"}},{scope:["entity.name.function"],settings:{foreground:"#9e7bb0"}},{scope:["entity.name.type"],settings:{foreground:"#6A8759"}},{scope:["keyword.control"],settings:{foreground:"#569cd6"}},{scope:["constant.numeric"],settings:{foreground:"#b5cea8"}},{scope:["support.constant"],settings:{foreground:"#7497c4"}},{scope:["variable.parameter"],settings:{foreground:"#D4D4D4"}},{scope:["variable.other"],settings:{foreground:"#D4D4D4"}}]};var d=a(4095);let u="yql-light",p="yql-dark",m=null,h=new Set,g=new Set;async function x(){return m||(m=(async()=>{let{createHighlighter:e}=await a.e("91798").then(a.bind(a,14613));return e({themes:[],langs:[]})})()),m}async function y(e){if(h.has(e))return;let t=await x();try{"yql"===e?await t.loadLanguage(d):await t.loadLanguage(e),h.add(e)}catch(t){throw console.error(`Failed to load language: ${e}`,t),t}}async function f(e){if(g.has(e))return;let t=await x();try{e===u?await t.loadTheme(o):e===p?await t.loadTheme(c):await t.loadTheme(e),g.add(e)}catch(t){throw console.error(`Failed to load theme: ${e}`,t),t}}async function b(e,t,a){let r="dark"===a,n=r?"github-dark":"github-light";return"yql"===t&&(n=r?p:u),await Promise.all([y(t),f(n)]),(await x()).codeToHtml(e,{lang:t,theme:n})}function v({text:e,language:t,className:a,transparentBackground:o=!0,withClipboardButton:c}){let[d,u]=n.useState(""),[p,m]=n.useState(!0),h=(0,s.x)();n.useEffect(()=>{let a=!1;return async function(){m(!0);try{let r=await b(e,t,h);a||u(r)}catch(e){console.error("Failed to highlight code:",e)}finally{a||m(!1)}}(),()=>{a=!0}},[e,t,h]);let g={};c?.alwaysVisible&&(g=!1===c.withLabel?{paddingRight:40}:{paddingRight:80});let x={...g};return o&&(x.background="transparent"),(0,r.jsxs)("div",{className:l(null,a),children:[(()=>{if(!c)return null;let{alwaysVisible:t,copyText:a,...n}=c;return(0,r.jsx)("div",{className:l("sticky-container"),onClick:e=>e.stopPropagation(),children:(0,r.jsx)(i.b,{...n,copyText:a||e,className:l("copy",{visible:t}),view:"flat-secondary"})})})(),p||!d?(0,r.jsx)("div",{style:x,className:l("content",{transparent:o}),children:(0,r.jsx)("pre",{children:(0,r.jsx)("code",{children:e})})}):(0,r.jsx)("div",{className:l("content",{transparent:o}),style:x,dangerouslySetInnerHTML:{__html:d}})]})}},43696:function(e,t,a){a.d(t,{A:()=>i,X:()=>l});var r=a(74848),n=a(51936);let s=(0,a(25247).cn)("ydb-table");function i({children:e,className:t}){return(0,r.jsx)("div",{className:s("table-header-content",t),children:e})}function l({className:e,width:t,wrapperClassName:a,...i}){return(0,r.jsx)("div",{className:s(null,a),children:(0,r.jsx)(n.WE,{headerCellClassName:({column:e})=>s("table-header-cell",{align:e.columnDef.meta?.align}),cellClassName:e=>s("table-cell",{align:e?.column.columnDef.meta?.align,"vertical-align":e?.column.columnDef.meta?.verticalAlign}),className:s("table",{width:t},e),...i})})}},42880:function(e,t,a){a.d(t,{$:()=>i});var r=a(74848),n=a(85169),s=a(46086);function i({header:e,note:t}){return(0,r.jsxs)(n.s,{gap:1,alignItems:"center",children:[e,(0,r.jsx)(s.H,{popoverProps:{placement:["right","left"]},children:t})]})}},51950:function(e,t,a){a.d(t,{C:()=>v});var r=a(74848),n=a(96540),s=a(18117),i=a(2543),l=a(25508),o=a(2404),c=a.n(o),d=a(56496),u=a(56321);let p=d.F.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.viewer.getTabletsInfo(e,{signal:t})}}catch(e){return{error:e}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),m=(0,l.Mz)(e=>e,e=>p.endpoints.getTabletsInfo.select(e),{argsMemoize:l.i5,argsMemoizeOptions:{equalityCheck:c()}}),h=(0,l.Mz)(e=>e,(e,t)=>m(t),(e,t)=>t(e).data),g=(0,l.Mz)((e,t)=>h(e,t),(e,t)=>(0,u.K)(e,t.database),(e,t)=>e?.TabletStateInfo?t?e.TabletStateInfo.map(e=>{let a=void 0===e.NodeId?void 0:t.get(e.NodeId)?.Host;return{...e,fqdn:a}}):e.TabletStateInfo:[]);var x=a(33172),y=a(81882),f=a(6168);let b=["Created","ResolveStateStorage","Candidate","BlockBlobStorage","RebuildGraph","WriteZeroEntry","Restored","Discover","Lock","Active","ResolveLeader","Terminating"];function v({nodeId:e,path:t,database:a,databaseFullPath:l,onlyActive:o,scrollContainerRef:c}){let[d]=(0,y.Nt)(),u={},m=o?`(State=[${b.join(",")}])`:void 0,h=n.useMemo(()=>{if(!(0,i.isNil)(t)&&!(0,i.isNil)(l))return{path:t,databaseFullPath:l}},[t,l]);(0,x.f8)(e)?u={nodeId:e,database:a,filter:m}:h&&(u={path:h,database:a,filter:m});let{isLoading:v,error:j}=p.useGetTabletsInfoQuery(0===Object.keys(u).length?s.hT:u,{pollingInterval:d}),T=(0,y.N4)(e=>g(e,u));return(0,r.jsx)(f.Q,{scrollContainerRef:c,tablets:T,loading:v,error:j,nodeId:e})}},46896:function(e,t,a){a.r(t),a.d(t,{Tenant:()=>xY});var r=a(74848),n=a(96540),s=a(85902),i=a(30919),l=a(42724),o=a(83107),c=a(25247);let d=(0,c.cn)("kv-split"),u=[0,100],p=[50,50],m=function(e){let[t,a]=n.useState(),s=t=>{let{defaultSizePaneKey:a}=e;localStorage.setItem(a,t.join(","))};return n.useEffect(()=>{let{collapsedSizes:t,triggerCollapse:r}=e;if(r){let e=t||u;s(e),a(e)}},[e.triggerCollapse]),n.useEffect(()=>{let{triggerExpand:t,defaultSizes:r}=e,n=r||p;t&&(s(n),a(n))},[e.triggerExpand]),(0,r.jsx)(n.Fragment,{children:(0,r.jsx)(o.A,{direction:e.direction||"horizontal",sizes:t||(()=>{let{defaultSizePaneKey:t,defaultSizes:a=p,initialSizes:r}=e;return r||localStorage.getItem(t)?.split(",").map(Number)||a})(),minSize:e.minSize||[0,0],onDrag:t=>{let{onSplitDragAdditional:a}=e;a&&a(),s(t)},className:d(null,e.direction||"horizontal"),gutterSize:8,onDragStart:()=>{let{onSplitStartDragAdditional:t}=e;t&&t(),a(void 0)},expandToMin:!0,children:e.children})})};var h=a(39471),g=a(56496);let x=g.F.injectEndpoints({endpoints:e=>({getOverview:e.query({queryFn:async({path:e,database:t,timeout:a,databaseFullPath:r},{signal:n})=>{try{return{data:await window.api.viewer.getDescribe({path:{path:e,databaseFullPath:r},database:t,timeout:a},{signal:n})}}catch(e){return{error:e}}},serializeQueryArgs:({queryArgs:e})=>{let{database:t,path:a}=e;return{database:t,path:a}},keepUnusedDataFor:0,providesTags:["All","SchemaTree"]})})});var y=a(82691),f=a(98821),b=a(67222),v=a(35537),j=a(81882),T=a(69045),w=a(12499),S=a(94169),E=a(36928),_=a(4329),N=a(38482),C=a(23273),P=a(96927),I=a(1459),A=a(71790),D=a(88831),R=a(95200),k=a(35461),M=a(43834),O=a(68243),q=a(67103),L=a(12543),z=a(23172),F=a(61667),Q=a(97855),U=a(7350),$=a.n(U),G=a(5556),H=a.n(G),B=a(8946),W=a(29620);let V=(0,c.cn)("heatmap"),J={width:0,height:0},Y=e=>{let[t,a]=n.useState(J),{tablets:s}=e,i=n.useRef(null),l=n.useRef(null),o=(0,B.Cs)();n.useEffect(()=>{let e=i.current,a=e.getContext("2d");a.clearRect(0,0,e.offsetWidth,e.offsetHeight),s.map((e,r)=>{let{columnsCount:n}=t,s=12*Math.floor(r/n);a.fillStyle=e.color||"grey",a.fillRect(r%n*12,s,10,10)})}),n.useLayoutEffect(()=>{let e=l.current;if(e){let t=e.offsetWidth-15,r=Math.floor(t/12),n=Math.ceil(s.length/r);a({width:t,height:12*n,columnsCount:r,rowsCount:n})}},[]);let c=()=>{let e=i.current,t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t},d=()=>{let e=i.current,t=0;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t},u=(e,a)=>{let{columnsCount:r}=t;return r*Math.floor(a/12)+Math.floor(e/12)},p=$()((t,a)=>{let r=new CustomEvent("scroll");window.dispatchEvent(r);let n=e.parentRef.current,i=s[u(t-d()+n.scrollLeft,a-c()+n.scrollTop)];if(i){let r={name:i.currentMetric,value:i.formattedValue};e.showTooltip(void 0,i,"tablet",r,{left:t-20,top:a-20})}else e.hideTooltip()},20);return(0,r.jsx)("div",{ref:l,className:V("canvas-container"),onMouseLeave:()=>{setTimeout(()=>{e.hideTooltip()},40)},children:(0,r.jsx)("canvas",{ref:i,width:t.width,height:t.height,onClick:t=>{let a=e.parentRef.current,r=s[u(t.clientX-d()+a.scrollLeft,t.clientY-c()+a.scrollTop)];r&&window.open((e=>{let{TabletId:t}=e,a=window.location.hostname,r=o(t),n=[a,W.P8,r].map(e=>e.startsWith("/")?e.slice(1):e).filter(Boolean).join("/");return`https://${n}`})(r),"_blank")},onMouseMove:e=>p(e.clientX,e.clientY)})})};Y.propTypes={tablets:H().array,parentRef:H().object,showTooltip:H().func,hideTooltip:H().func};let K={r:255,g:4,b:0},Z={r:255,g:219,b:77},X={r:59,g:201,b:53},ee={CPU:{min:0,max:1e6},Network:{min:0,max:1e9},Storage:{min:0,max:2e9},DataSize:{min:0,max:2e9},RowCount:{min:0},IndexSize:{min:0}},et=e=>{let t=e.toString(16);return 1===t.length?`0${t}`:t},ea=(e,t,a)=>{if(1===e)return[t];if(2===e)return[t,a];let r=(t.r-a.r)/(e-1),n=(t.g-a.g)/(e-1),s=(t.b-a.b)/(e-1),i=[];for(let a=0;a<e;a++)i.push({r:Math.round(t.r-r*a),g:Math.round(t.g-n*a),b:Math.round(t.b-s*a)});return i.map(e=>(({r:e,g:t,b:a})=>`#${et(e)}${et(t)}${et(a)}`)(e))},er=e=>{let t=Math.floor(e/2);return[...ea(e%2==0?t:t+1,X,Z),...ea(t+1,Z,K).slice(1)]},en=(e,t)=>{let a=new Set,r=ee[e]||{};t.forEach(t=>{a.add(Number(t.metrics?.[e]))}),Number.isInteger(r.min)&&a.add(r.min),Number.isInteger(r.max)&&a.add(r.max);let n=Array.from(a.values()).sort((e,t)=>e-t);return{min:n[0],max:n[n.length-1]}},es=(0,c.cn)("histogram"),ei=e=>{let t=n.useRef(),{data:a={},maxCount:s}=e,{count:i,leftBound:l,rightBound:o,color:c}=a,d=i/s*100;return(0,r.jsx)("div",{ref:t,className:es("item"),style:{backgroundColor:c,height:`${d}%`},onMouseEnter:()=>{let a=t.current;e.showTooltip(a,{count:i,leftBound:l,rightBound:o},"histogram")},onMouseLeave:e.hideTooltip})};ei.propTypes={data:H().object,maxCount:H().number,showTooltip:H().func,hideTooltip:H().func};let el=e=>{let{tablets:t,currentMetric:a}=e,{min:n,max:s}=en(a,t),i=er(50),l=(s-n)/50,o=i.map((e,t)=>({color:e,count:0,leftBound:(0,Q.ZV)(n+t*l),rightBound:(0,Q.ZV)(n+(t+1)*l)})),c=0;return t.forEach(e=>{let t=Math.floor((a&&Number(e.metrics?.[a]))/l),r=o[t]?.count+1;r>c&&(c=r),o[t]={...o[t],count:r}}),(0,r.jsx)("div",{className:es(),children:(0,r.jsxs)("div",{className:es("chart"),children:[!!s&&o.map((t,a)=>(0,r.jsx)(ei,{data:t,maxCount:c,showTooltip:e.showTooltip,hideTooltip:e.hideTooltip},a)),(0,r.jsx)("div",{className:es("x-min"),children:(0,Q.ZV)(n)}),(0,r.jsx)("div",{className:es("x-max"),children:(0,Q.ZV)(s)}),(0,r.jsx)("div",{className:es("y-min"),children:"0"}),(0,r.jsx)("div",{className:es("y-max"),children:(0,Q.ZV)(c)})]})})};el.propTypes={tablets:H().array,currentMetric:H().string,showTooltip:H().func,hideTooltip:H().func};let eo=(0,c.cn)("heatmap"),ec=er(500),ed=({path:e,database:t,databaseFullPath:a})=>{let s=(0,j.YQ)(),i=n.createRef(),[l]=(0,j.Nt)(),{currentData:o,isFetching:c,error:d}=z.f1.useGetHeatmapTabletsInfoQuery({path:e,database:t,databaseFullPath:a},{pollingInterval:l}),{tablets:u=[],metrics:p}=o||{},{sort:m,heatmap:h,currentMetric:g}=(0,j.N4)(e=>e.heatmap),x=(...e)=>{s((0,F.DK)(...e))},y=()=>{s((0,F.w7)())},f=e=>{s((0,z.nd)({currentMetric:e[0]}))},b=()=>{s((0,z.nd)({sort:!m}))},T=()=>{s((0,z.nd)({heatmap:!h}))};return c&&void 0===o?(0,r.jsx)(L.a,{}):(()=>{let e,{min:t,max:a}=en(g,u);return(!d||o)&&(e=h?(()=>{let{min:e,max:t}=en(g,u),a=u.map(a=>{let r=g&&Number(a.metrics?.[g]),n=ec[0===t?0:Math.round((r-e)/(t-e)*499)];return{...a,color:n,value:r,formattedValue:(0,Q.ZV)(r),currentMetric:g}}),n=m?a.sort((e,t)=>Number(t.value)-Number(e.value)):a;return(0,r.jsx)("div",{ref:i,className:eo("items"),children:(0,r.jsx)(Y,{tablets:n,parentRef:i,showTooltip:x,hideTooltip:y})})})():(0,r.jsx)(el,{tablets:u,currentMetric:g,showTooltip:x,hideTooltip:y})),(0,r.jsxs)("div",{className:eo(),children:[(0,r.jsxs)("div",{className:eo("filters"),children:[(0,r.jsx)(M.l,{className:eo("heatmap-select"),value:g?[g]:[],options:p,onUpdate:f,width:200}),(0,r.jsx)("div",{className:eo("sort-checkbox"),children:(0,r.jsx)(O.S,{onUpdate:b,checked:m,children:"Sort"})}),(0,r.jsx)("div",{className:eo("histogram-checkbox"),children:(0,r.jsx)(O.S,{onUpdate:T,checked:h,children:"Heatmap"})}),(0,r.jsxs)("div",{className:eo("limits"),children:[(0,r.jsxs)("div",{className:eo("limits-block"),children:[(0,r.jsx)("div",{className:eo("limits-title"),children:"min:"}),(0,r.jsx)("div",{className:eo("limits-value"),children:Number.isInteger(t)?(0,Q.ZV)(t):v.Pd})]}),(0,r.jsxs)("div",{className:eo("limits-block"),children:[(0,r.jsx)("div",{className:eo("limits-title"),children:"max:"}),(0,r.jsx)("div",{className:eo("limits-value"),children:Number.isInteger(a)?(0,Q.ZV)(a):v.Pd})]}),(0,r.jsxs)("div",{className:eo("limits-block"),children:[(0,r.jsx)("div",{className:eo("limits-title"),children:"count:"}),(0,r.jsx)("div",{className:eo("limits-value"),children:(0,Q.ZV)(u.length)})]})]})]}),d?(0,r.jsx)(q.o,{error:d}):null,e]})})()};var eu=a(11025),ep=a(74010),em=a(78951),eh=a(48849),eg=a(4320),ex=a(51432),ey=JSON.parse('{"title_empty":"No operations data","pleaceholder_search":"Search operations","placeholder_kind":"Select operation kind","kind_ssBackgrounds":"SS/Backgrounds","kind_export_s3":"Export/S3","kind_export_yt":"Export/YT","kind_import_s3":"Import/S3","kind_buildIndex":"Build Index","column_operationId":"Operation ID","column_status":"Status","column_createdBy":"Created By","column_createTime":"Create Time","column_endTime":"End Time","column_duration":"Duration","column_state":"State","label_duration-ongoing":"{{value}} (ongoing)","label_in-progress":"In progress","value_progress_unspecified":"Unspecified","value_progress_preparing":"Preparing","value_progress_transfer_data":"Transferring Data","value_progress_build_indexes":"Building Indexes","value_progress_done":"Done","value_progress_cancellation":"Cancelling","value_progress_cancelled":"Cancelled","value_progress_create_changefeeds":"Creating Changefeeds","header_cancel":"Cancel operation","header_forget":"Forget operation","text_cancel":"The operation will be cancelled. Do you want to proceed?","text_forget":"The operation will be forgotten. Do you want to proceed?","text_forgotten":"The operation {{id}} has been forgotten","text_cancelled":"The operation {{id}} has been cancelled"}');let ef=(0,ex.g4)("ydb-operations",{en:ey}),eb="status",ev="created_by",ej="create_time",eT="end_time",ew="duration",eS="state",eE={id:ef("column_operationId"),[eb]:ef("column_status"),[ev]:ef("column_createdBy"),[ej]:ef("column_createTime"),[eT]:ef("column_endTime"),[ew]:ef("column_duration"),[eS]:ef("column_state")},e_=[{value:"export/s3",content:ef("kind_export_s3")},{value:"export/yt",content:ef("kind_export_yt")},{value:"import/s3",content:ef("kind_import_s3")},{value:"ss/backgrounds",content:ef("kind_ssBackgrounds")},{value:"buildindex",content:ef("kind_buildIndex")}],eN=(0,c.cn)("operations");function eC({kind:e,searchValue:t,handleKindChange:a,handleSearchChange:s}){return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(eg.v,{value:t,onChange:s,placeholder:ef("pleaceholder_search"),className:eN("search")}),(0,r.jsx)(M.l,{value:[e],width:150,options:e_,onUpdate:e=>a(e[0])})]})}var eP=a(93704),eI=a(13177),eA=a(77269),eD=a(85169),eR=a(6876),ek=a(17427),eM=a(32692),eO=a(5948);let eq=g.F.injectEndpoints({endpoints:e=>({getOperationList:e.infiniteQuery({infiniteQueryOptions:{initialPageParam:void 0,getNextPageParam:e=>"0"===e.next_page_token?void 0:e.next_page_token},queryFn:async({queryArg:e,pageParam:t},{signal:a})=>{try{var r;let n={database:e.database,kind:e.kind,page_size:e.page_size??20,page_token:t};return{data:(r=await window.api.operation.getOperationList(n,{signal:a}),Array.isArray(r.operations)?r:{...r,operations:[],next_page_token:"0"})}}catch(e){return{error:e}}},providesTags:["All"]}),cancelOperation:e.mutation({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.operation.cancelOperation(e,{signal:t})}}catch(e){return{error:e}}}}),forgetOperation:e.mutation({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.operation.forgetOperation(e,{signal:t})}}catch(e){return{error:e}}}})}),overrideExisting:"throw"});var eL=a(91349),ez=a(51630);function eF(e){return!!e&&"type.googleapis.com/Ydb.Table.IndexBuildMetadata"===e["@type"]}function eQ({operation:e,database:t,refreshTable:a}){let[n,{isLoading:s}]=eq.useCancelOperationMutation(),[i,{isLoading:l}]=eq.useForgetOperationMutation(),o=e.id;if(!o)return null;let c=s||!0===e.ready;return(0,r.jsxs)(eD.s,{gap:"2",children:[(0,r.jsx)(eR.m,{title:ef("header_forget"),placement:["left","bottom"],disabled:l,children:(0,r.jsx)("div",{children:(0,r.jsx)(eM.B,{buttonView:"outlined",dialogHeader:ef("header_forget"),dialogText:ef("text_forget"),onConfirmAction:()=>i({id:o,database:t}).unwrap().then(()=>{(0,eL.A)({name:"Forgotten",title:ef("text_forgotten",{id:o}),theme:"success"}),a()}),buttonDisabled:l,children:(0,r.jsx)(ek.I,{data:eP.A})})})}),(0,r.jsx)(eR.m,{title:ef("header_cancel"),placement:["right","bottom"],disabled:c,children:(0,r.jsx)("div",{children:(0,r.jsx)(eM.B,{popoverDisabled:c,buttonView:"outlined",dialogHeader:ef("header_cancel"),dialogText:ef("text_cancel"),onConfirmAction:()=>n({id:o,database:t}).unwrap().then(()=>{(0,eL.A)({name:"Cancelled",title:ef("text_cancelled",{id:o}),theme:"success"}),a()}),buttonDisabled:c,children:(0,r.jsx)(ek.I,{data:eI.A})})})})]})}var eU=a(2543),e$=a(22708),eG=a(14476);let eH=eG.z.enum(["ss/backgrounds","export/s3","export/yt","import/s3","buildindex"]).catch("buildindex");function eB({database:e,scrollContainerRef:t}){let{kind:a,searchValue:s,pageSize:l,handleKindChange:o,handleSearchChange:c}=function(){let[e,t]=(0,e$.useQueryParams)({kind:e$.StringParam,search:e$.StringParam,pageSize:e$.NumberParam,pageToken:e$.StringParam}),a=eH.parse(e.kind),r=e.search??"",n=e.pageSize??void 0;return{kind:a,searchValue:r,pageSize:n,pageToken:e.pageToken??void 0,handleKindChange:e=>{t({kind:e},"replaceIn")},handleSearchChange:e=>{t({search:e||void 0},"replaceIn")},handlePageSizeChange:e=>{t({pageSize:e},"replaceIn")},handlePageTokenChange:e=>{t({pageToken:e},"replaceIn")}}}(),{operations:d,isLoading:u,isLoadingMore:p,error:m,refreshTable:h}=function({database:e,kind:t,pageSize:a=20,searchValue:r,scrollContainerRef:s}){let{data:i,error:l,isLoading:o,isFetchingNextPage:c,hasNextPage:d,fetchNextPage:u,refetch:p}=eq.useGetOperationListInfiniteQuery({database:e,kind:t,page_size:a}),m=n.useMemo(()=>i?.pages?i.pages.flatMap(e=>e.operations||[]):[],[i]),h=n.useMemo(()=>r?m.filter(e=>e.id?.toLowerCase().includes(r.toLowerCase())):m,[m,r]),g=n.useCallback(async()=>{let e=s?.current;if(!e||!d||c)return;let{scrollHeight:t,clientHeight:a}=e;t<=a&&await u()},[s,d,c,u]);return n.useLayoutEffect(()=>{if(!c){let e=requestAnimationFrame(()=>{g()});return()=>cancelAnimationFrame(e)}},[i,c,g]),n.useEffect(()=>{let e=s?.current;if(!e)return;let t=()=>{let{scrollTop:t,scrollHeight:a,clientHeight:r}=e;a-t-r<100&&d&&!c&&u()};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[s,d,c,u]),n.useEffect(()=>{let e=(0,eU.throttle)(g,200,{trailing:!0,leading:!0});return window.addEventListener("resize",e),()=>{e.cancel(),window.removeEventListener("resize",e)}},[g]),{operations:h,isLoading:o,isLoadingMore:c,error:l,refreshTable:p}}({database:e,kind:a,pageSize:l,searchValue:s,scrollContainerRef:t}),g=n.useMemo(()=>({...v.N3,sortable:!1}),[]);return m?(0,r.jsx)(i.A,{error:m,position:"left"}):(0,r.jsxs)(eh.L,{children:[(0,r.jsx)(eh.L.Controls,{children:(0,r.jsx)(eC,{kind:a,searchValue:s,handleKindChange:o,handleSearchChange:c})}),(0,r.jsxs)(eh.L.Table,{loading:u,className:eN("table"),children:[d.length>0||u?(0,r.jsx)(ep.l,{columns:function({database:e,refreshTable:t,kind:a}){let n="buildindex"===a,s=[{name:"id",header:eE.id,width:340,render:({row:e})=>{if(!e.id)return v.Pd;let t=n&&(e=>{let{metadata:t}=e;return eF(t)&&t.description?JSON.stringify(t.description,null,2):""})(e)||e.id;return(0,r.jsx)(eO.s,{placement:["top","bottom"],content:t,children:e.id})}},{name:eb,header:eE[eb],render:({row:e})=>{var t;let a;return a=function(e,t){let a=e.metadata;if(!a)return null;if(eF(a)&&"number"==typeof a.progress)return`${Math.round(a.progress)}%`;if(a&&"type.googleapis.com/Ydb.Import.ImportFromS3Metadata"===a["@type"]||a&&"type.googleapis.com/Ydb.Export.ExportToS3Metadata"===a["@type"]||a&&"type.googleapis.com/Ydb.Export.ExportToYtMetadata"===a["@type"]){let e=function(e){if(!e?.items_progress||0===e.items_progress.length)return null;let t=0,a=0;for(let r of e.items_progress)void 0!==r.parts_total&&r.parts_total>0&&(t+=r.parts_total,a+=r.parts_completed||0);return 0===t?null:Math.round(a/t*100)}(a);if(null!==e)return`${e}%`;if(a.progress){let e="string"==typeof a.progress?a.progress:String(a.progress),r=e.replace(/^PROGRESS_/,"").toLowerCase(),n=`value_progress_${r}`;try{let e=t(n);if(e&&e!==n)return e}catch{}return e}}return null}(t=e,ef),t.ready?t.status?(0,r.jsx)(eA.E,{color:"SUCCESS"===t.status?"positive":"danger",children:t.status}):v.Pd:t.status&&"SUCCESS"!==t.status?(0,r.jsx)(eA.E,{color:"danger",children:t.status}):null!==a?a:ef("label_in-progress")}}];return n&&s.push({name:eS,header:eE[eS],render:({row:e})=>{let t=e.metadata;return t?.state?t.state:v.Pd}}),n||s.push({name:ev,header:eE[ev],render:({row:e})=>e.created_by?e.created_by:v.Pd},{name:ej,header:eE[ej],render:({row:e})=>e.create_time?(0,Q.r6)((0,ez.ee)(e.create_time)):v.Pd},{name:eT,header:eE[eT],render:({row:e})=>e.end_time?(0,Q.r6)((0,ez.ee)(e.end_time)):v.Pd},{name:ew,header:eE[ew],render:({row:e})=>{let t=0;if(!e.create_time)return v.Pd;let a=(0,ez.ee)(e.create_time),r=(t=e.end_time?(0,ez.ee)(e.end_time)-a:Date.now()-a)<0?0:t,n=(0,Q.uH)(r);return e.end_time?n:ef("label_duration-ongoing",{value:n})}}),s.push({name:"Actions",sortable:!1,resizeable:!1,header:"",render:({row:a})=>(0,r.jsx)(eQ,{operation:a,database:e,refreshTable:t})}),s}({database:e,refreshTable:h,kind:a}),columnsWidthLSKey:"selectedOperationColumns",data:d,settings:g,emptyDataMessage:ef("title_empty")}):(0,r.jsx)("div",{children:ef("title_empty")}),p&&(0,r.jsx)(em.Q,{showHeader:!1,rows:3,delay:0,className:eN("loading-more")})]})]})}var eW=a(20687),eV=a(51950);function eJ(e,t){let a=e.replace(/^\/+|\/+$/g,""),r=t.replace(/^\/+|\/+$/g,"");if(!a.startsWith(r))return a||"/";if(a===r)return`/${a}`;let n=a.slice(r.length);return n.replace(/^\/+/,"")||"/"}function eY(e,t){return"EPathTypeDir"===t&&2===e.split("/").length&&e.startsWith("/")}var eK=a(55028);let eZ=g.F.injectEndpoints({endpoints:e=>({getViewSchema:e.query({queryFn:async({database:e,path:t,databaseFullPath:a,timeout:r})=>{try{let n=eJ(t,a),s=await window.api.viewer.sendQuery({query:`SELECT * FROM \`${n}\` LIMIT 0`,database:e,action:"execute-query",timeout:r,internal_call:!0},{withRetries:!0});if((0,eK.We)(s))return{error:s};return{data:s?.result?.[0]?.columns||[]}}catch(e){return{error:e}}},serializeQueryArgs:({queryArgs:e})=>{let{database:t,path:a}=e;return{database:t,path:a}},providesTags:["All","SchemaTree"]})}),overrideExisting:"throw"});var eX=JSON.parse('{"page.title":"Database","pages.query":"Query","pages.diagnostics":"Diagnostics","summary.navigation":"Navigation","summary.showPreview":"Show preview","summary.source-type":"Source Type","summary.data-source":"Data Source","summary.copySchemaPath":"Copy schema path","summary.type":"Type","summary.subtype":"SubType","summary.id":"Id","summary.version":"Version","summary.created":"Created","summary.data-size":"Data size","summary.row-count":"Row count","summary.partitions":"Partitions count","summary.paths":"Paths","summary.shards":"Shards","summary.state":"State","summary.mode":"Mode","summary.format":"Format","summary.retention":"Retention","label.read-only":"ReadOnly","actions.copied":"The path is copied to the clipboard","actions.notCopied":"Couldn’t copy the path","actions.copyPath":"Copy path","actions.connectToDB":"Connect to DB","actions.dropIndex":"Drop index","actions.openPreview":"Open preview","actions.openMonitoring":"Monitoring","actions.createTable":"Create table...","actions.createExternalTable":"Create external table...","actions.createTopic":"Create topic...","actions.createColumnTable":"Create column table...","actions.createAsyncReplication":"Create async replication...","actions.createTransfer":"Create transfer...","actions.createView":"Create view...","actions.createStreamingQuery":"Create streaming query...","actions.dropTable":"Drop table...","actions.dropTopic":"Drop topic...","actions.dropView":"Drop view...","actions.alterTable":"Alter table...","actions.manageColumns":"Manage columns...","actions.manageAutoPartitioning":"Manage auto partitioning...","actions.manageReadReplicas":"Add read-only replicas...","actions.addTableIndex":"Add index...","actions.addVectorIndex":"Add vector index...","actions.createCdcStream":"Create changefeed...","actions.showCreateTable":"Show Create SQL...","actions.alterTopic":"Alter topic...","actions.selectQuery":"Select query...","actions.upsertQuery":"Upsert query...","actions.alterReplication":"Alter async replicaton...","actions.alterTransfer":"Alter transfer...","actions.dropReplication":"Drop async replicaton...","actions.dropTransfer":"Drop transfer...","actions.dropStreamingQuery":"Drop query...","actions.alterStreamingQuerySettings":"Alter query settings...","actions.alterStreamingQueryText":"Alter query text...","actions.createDirectory":"Create directory","schema.tree.dialog.placeholder":"Relative path","schema.tree.dialog.invalid":"Invalid path","schema.tree.dialog.whitespace":"Whitespace is not allowed","schema.tree.dialog.empty":"Path is empty","schema.tree.dialog.header":"Create directory","schema.tree.dialog.description":"Inside","schema.tree.dialog.buttonCancel":"Cancel","schema.tree.dialog.buttonApply":"Create","label_healthcheck-dashboard":"Healthcheck Dashboard","description_ok":"Everything is working fine.","description_degraded":"Some issues, but still working.","description_maintenance":"Working, but needs urgent attention to avoid failure.","description_emergency":"Something is broken and not working.","label_download":"Download healthcheck data","label_grant-access":"Grant access","context_grant-access":"Please note that granular rights can be combined into groups","entity-name_database":"Database","entity-name_directory":"Directory","entity-name_table":"Table","entity-name_system-view":"System view","entity-name_secondary-index":"Secondary Index","entity-name_vector-index":"Vector Index","entity-name_fulltext-index":"Fulltext Index","entity-name_tablestore":"Tablestore","entity-name_column-oriented-table":"Column-oriented table","entity-name_changefeed":"Changefeed","entity-name_topic":"Topic","entity-name_external-data-source":"External Data Source","entity-name_external-table":"External Table","entity-name_view":"View","entity-name_async-replication":"Async Replication","entity-name_transfer":"Transfer","entity-name_resource-pool":"Resource Pool","entity-name_secondary-index-table":"Secondary Index Table","entity-name_vector-index-table":"Vector Index Table","entity-name_fulltext-index-table":"Fulltext Index Table","entity-name_streaming_query":"Streaming Query"}');let e0=(0,ex.g4)("ydb-tenant",{en:eX}),e1={EPathSubTypeSyncIndexImplTable:"index_table",EPathSubTypeAsyncIndexImplTable:"index_table",EPathSubTypeVectorKmeansTreeIndexImplTable:"index_table",EPathSubTypeFulltextIndexImplTable:"index_table",EPathSubTypeStreamImpl:void 0,EPathSubTypeEmpty:void 0},e2={EPathTypeInvalid:void 0,EPathTypeSubDomain:"database",EPathTypeExtSubDomain:"database",EPathTypeDir:"directory",EPathTypeColumnStore:"directory",EPathTypeTable:"table",EPathTypeSysView:"system_table",EPathTypeTableIndex:"index",EPathTypeColumnTable:"column_table",EPathTypeCdcStream:"stream",EPathTypePersQueueGroup:"topic",EPathTypeExternalDataSource:"external_data_source",EPathTypeExternalTable:"external_table",EPathTypeView:"view",EPathTypeReplication:"async_replication",EPathTypeTransfer:"transfer",EPathTypeResourcePool:"resource_pool",EPathTypeStreamingQuery:"streaming_query"},e3={table:"EPathTypeTable",index:"EPathTypeTableIndex",column_table:"EPathTypeColumnTable",external_table:"EPathTypeExternalTable",view:"EPathTypeView"},e4={table:"EPathTypeTable",column_table:"EPathTypeColumnTable"},e5={streaming_query:"EPathTypeStreamingQuery"},e6=(e="EPathTypeDir",t,a="directory")=>t&&e1[t]||e2[e]||a,e7={EPathSubTypeSyncIndexImplTable:e0("entity-name_secondary-index-table"),EPathSubTypeAsyncIndexImplTable:e0("entity-name_secondary-index-table"),EPathSubTypeVectorKmeansTreeIndexImplTable:e0("entity-name_vector-index-table"),EPathSubTypeFulltextIndexImplTable:e0("entity-name_fulltext-index-table"),EPathSubTypeStreamImpl:void 0,EPathSubTypeEmpty:void 0},e8={EPathTypeInvalid:void 0,EPathTypeSubDomain:e0("entity-name_database"),EPathTypeExtSubDomain:e0("entity-name_database"),EPathTypeDir:e0("entity-name_directory"),EPathTypeTable:e0("entity-name_table"),EPathTypeSysView:e0("entity-name_system-view"),EPathTypeTableIndex:e0("entity-name_secondary-index"),EPathTypeColumnStore:e0("entity-name_tablestore"),EPathTypeColumnTable:e0("entity-name_column-oriented-table"),EPathTypeCdcStream:e0("entity-name_changefeed"),EPathTypePersQueueGroup:e0("entity-name_topic"),EPathTypeExternalDataSource:e0("entity-name_external-data-source"),EPathTypeExternalTable:e0("entity-name_external-table"),EPathTypeStreamingQuery:e0("entity-name_streaming_query"),EPathTypeView:e0("entity-name_view"),EPathTypeReplication:e0("entity-name_async-replication"),EPathTypeTransfer:e0("entity-name_transfer"),EPathTypeResourcePool:e0("entity-name_resource-pool")},e9={EIndexTypeInvalid:void 0,EIndexTypeGlobal:e0("entity-name_secondary-index"),EIndexTypeGlobalAsync:e0("entity-name_secondary-index"),EIndexTypeGlobalVectorKmeansTree:e0("entity-name_vector-index"),EIndexTypeGlobalFulltext:e0("entity-name_fulltext-index")},te={UnknownTenantType:"Database",Domain:"Cluster Root",Dedicated:"Dedicated Database",Shared:"Shared Database",Serverless:"Serverless Database"},tt={EPathTypeTable:!0,EPathTypeColumnTable:!0,EPathTypeSysView:!0,EPathTypeExternalTable:!0,EPathTypeView:!0,EPathTypeInvalid:!1,EPathTypeDir:!1,EPathTypeSubDomain:!1,EPathTypeTableIndex:!1,EPathTypeExtSubDomain:!1,EPathTypeColumnStore:!1,EPathTypeCdcStream:!1,EPathTypePersQueueGroup:!1,EPathTypeExternalDataSource:!1,EPathTypeReplication:!1,EPathTypeTransfer:!1,EPathTypeResourcePool:!1,EPathTypeStreamingQuery:!1},ta=e=>(e&&tt[e])??!1,tr={EPathTypeColumnStore:!0,EPathTypeColumnTable:!0,EPathTypeInvalid:!1,EPathTypeDir:!1,EPathTypeTable:!1,EPathTypeSysView:!1,EPathTypeSubDomain:!1,EPathTypeTableIndex:!1,EPathTypeExtSubDomain:!1,EPathTypeCdcStream:!1,EPathTypePersQueueGroup:!1,EPathTypeExternalDataSource:!1,EPathTypeExternalTable:!1,EPathTypeStreamingQuery:!1,EPathTypeView:!1,EPathTypeReplication:!1,EPathTypeTransfer:!1,EPathTypeResourcePool:!1},tn=e=>(e&&tr[e])??!1,ts={EPathTypeSubDomain:!0,EPathTypeExtSubDomain:!0,EPathTypeInvalid:!1,EPathTypeDir:!1,EPathTypeColumnStore:!1,EPathTypeColumnTable:!1,EPathTypeTable:!1,EPathTypeSysView:!1,EPathTypeTableIndex:!1,EPathTypeCdcStream:!1,EPathTypePersQueueGroup:!1,EPathTypeExternalDataSource:!1,EPathTypeExternalTable:!1,EPathTypeStreamingQuery:!1,EPathTypeView:!1,EPathTypeReplication:!1,EPathTypeTransfer:!1,EPathTypeResourcePool:!1},ti=e=>(e&&ts[e])??!1,tl={EPathSubTypeSyncIndexImplTable:!0,EPathSubTypeAsyncIndexImplTable:!0,EPathSubTypeVectorKmeansTreeIndexImplTable:!0,EPathSubTypeFulltextIndexImplTable:!0,EPathSubTypeStreamImpl:!0,EPathSubTypeEmpty:!1},to={EPathTypeCdcStream:!1,EPathTypePersQueueGroup:!0,EPathTypeExternalDataSource:!0,EPathTypeExternalTable:!0,EPathTypeView:!0,EPathTypeResourcePool:!0,EPathTypeReplication:!0,EPathTypeTransfer:!0,EPathTypeInvalid:!1,EPathTypeColumnStore:!1,EPathTypeColumnTable:!1,EPathTypeDir:!1,EPathTypeTable:!1,EPathTypeSysView:!1,EPathTypeSubDomain:!1,EPathTypeTableIndex:!1,EPathTypeExtSubDomain:!1,EPathTypeStreamingQuery:!0};var tc=a(5434),td=a(80720),tu=JSON.parse('{"column-title.id":"Id","column-title.name":"Name","column-title.type":"Type","column-title.notNull":"NotNull","column-title.autoIncrement":"AutoIncrement","column-title.defaultValue":"Default","column-title.family":"Family","column-title.media":"Media","column-title.compression":"Compression","primary-key.title":"Primary key:","partitioning-key.title":"Partitioning key:"}');let tp=(0,ex.g4)("ydb-schema-viewer",{en:tu}),tm=(0,c.cn)("schema-viewer"),th=({tableData:e,extended:t,type:a})=>{let n="primary"===a?e.filter(e=>!!(void 0!==e.keyColumnIndex&&-1!==e.keyColumnIndex&&e.name)).sort((e,t)=>e.keyColumnIndex-t.keyColumnIndex).map(e=>e.name):e.filter(e=>!!(void 0!==e.partitioningColumnIndex&&-1!==e.partitioningColumnIndex&&e.name)).sort((e,t)=>e.partitioningColumnIndex-t.partitioningColumnIndex).map(e=>e.name),s=t?3:n.length,i=n.slice(0,s),l=n.slice(s);return n.length>0?(0,r.jsxs)("div",{className:tm("keys",{summary:!t,type:a}),children:[(0,r.jsx)("div",{className:tm("keys-header"),children:"primary"===a?tp("primary-key.title"):tp("partitioning-key.title")}),(0,r.jsxs)("div",{className:tm("keys-values"),children:[" "+i.join(", "),l.length?(0,r.jsx)(td.u,{className:tm("more-badge"),placement:["bottom"],hasArrow:!1,pinOnClick:!0,content:(0,r.jsx)("div",{className:tm("popup-content"),children:l.map(e=>(0,r.jsx)("div",{className:tm("popup-item"),children:e},e))}),children:(0,r.jsx)(tc.J,{className:tm("keys-label"),children:`+${l.length}`})}):null]})]}):null};var tg=a(29581);function tx({data:e,name:t,header:a,sortable:r}){let n="string"==typeof a?a.length:t.length,s=r?n+2:n;if(e)for(let a of e){let e=0;if(a[t]&&(e=String(a[t]).length),10*(s=Math.max(s,e))+20>=600)return 600}return 10*s+20}var ty=a(73831);let tf={name:"id",get header(){return tp("column-title.id")},width:60,align:tg.Ay.RIGHT,render:({row:e})=>{let t=(0,r.jsx)(ek.I,{className:tm("key-icon"),size:12,data:ty.A});return(0,r.jsxs)("span",{className:tm("id-wrapper"),children:[e.id,void 0===e.keyColumnIndex||-1===e.keyColumnIndex?null:t]})}},tb={name:"name",get header(){return tp("column-title.name")},width:120,render:({row:e})=>e.name},tv={name:"type",get header(){return tp("column-title.type")},width:100,render:({row:e})=>e.type},tj={name:"notNull",get header(){return tp("column-title.notNull")},width:100,defaultOrder:tg.Ay.DESCENDING,render:({row:e})=>{if(e.notNull)return"✓"}},tT={name:"autoIncrement",get header(){return tp("column-title.autoIncrement")},width:100,defaultOrder:tg.Ay.DESCENDING,render:({row:e})=>{if(e.autoIncrement)return"✓"}},tw={name:"defaultValue",get header(){return tp("column-title.defaultValue")},width:100,render:({row:e})=>String(e.defaultValue)},tS={name:"familyName",get header(){return tp("column-title.family")},width:100,render:({row:e})=>e.familyName},tE={name:"prefferedPoolKind",get header(){return tp("column-title.media")},width:100,render:({row:e})=>e.prefferedPoolKind},t_={name:"columnCodec",get header(){return tp("column-title.compression")},width:130,render:({row:e})=>e.columnCodec};function tN(e,t){if(!t)return e;let a=t.slice(0,100);return e.map(e=>({...e,width:tx({data:a,name:e.name,header:"string"==typeof e.header?e.header:void 0,sortable:e.sortable||void 0===e.sortable})}))}function tC(e,t){let{Table:a,ColumnTableDescription:r,ExternalTableDescription:n}=t?.PathDescription||{};return"EPathTypeTable"===e||"EPathTypeSysView"===e?function(e={}){let t=e?.PartitionConfig?.ColumnFamilies?.reduce((e,t)=>t.Id?{...e,[t.Id]:t}:e,{})??{},{Columns:a,KeyColumnNames:r}=e;return a?.map(e=>{let{Id:a,Name:n,NotNull:s,Type:i,Family:l,DefaultFromSequence:o,DefaultFromLiteral:c}=e,d=r?.findIndex(e=>e===n)??-1,u=l?t[l].Name:void 0,p=l?t[l].StorageConfig?.Data?.PreferredPoolKind:void 0,m=l?function(e){if(e)return"ColumnCodecPlain"===e?"None":e.replace("ColumnCodec","").toLocaleLowerCase()}(t[l].ColumnCodec):void 0;return{id:a,name:n,keyColumnIndex:d,type:i,notNull:s,autoIncrement:!!o,defaultValue:Object.values(c?.value||{})[0]??"-",familyName:u,prefferedPoolKind:p,columnCodec:m}})??[]}(a):tn(e)?function(e={}){let{Schema:t={},Sharding:a={}}=e,{Columns:r,KeyColumnNames:n}=t,{HashSharding:s={}}=a,{Columns:i=[]}=s,l=r?.map(e=>{let{Id:t,Name:a,Type:r,NotNull:s}=e,l=n?.findIndex(e=>e===a)??-1,o=i?.findIndex(e=>e===a)??-1;return{id:t,name:a,keyColumnIndex:l,partitioningColumnIndex:o,type:r,notNull:s}});return[...l?.filter(e=>-1!==e.keyColumnIndex)||[],...l?.filter(e=>-1===e.keyColumnIndex)||[]]}(r):"EPathTypeExternalTable"===e?function(e={}){let{Columns:t}=e;return t?.map(e=>{let{Id:t,Name:a,Type:r,NotNull:n}=e;return{id:t,name:a,type:r,notNull:n}})||[]}(n):[]}function tP(e){return e?.map(e=>({type:e.type?.endsWith("?")?e.type.slice(0,-1):e.type,name:e.name}))||[]}let tI=({type:e,path:t,database:a,extended:s=!1,databaseFullPath:i})=>{let[l]=(0,j.Nt)(),o=s?l:void 0,{currentData:c,isFetching:d}=x.useGetOverviewQuery({path:t,database:a,databaseFullPath:i},{pollingInterval:o,skip:"EPathTypeView"===e}),{currentData:u,isFetching:p}=eZ.useGetViewSchemaQuery({path:t,database:a,databaseFullPath:i},{pollingInterval:o,skip:"EPathTypeView"!==e}),m=p&&void 0===u||d&&void 0===c,h=n.useMemo(()=>"EPathTypeView"===e?tP(u):tC(e,c),[c,e,u]),g=n.useMemo(()=>h.some(e=>e.autoIncrement),[h]),y=n.useMemo(()=>h.some(e=>e.defaultValue),[h]),f=n.useMemo(()=>{if("EPathTypeView"===e)return tN([tb,tv],h);if("EPathTypeSysView"===e||"EPathTypeExternalTable"===e||tn(e))return tN([tf,tb,tv,tj],h);if("EPathTypeTable"===e){let e;return e=[tf,tb,tv,tj],y&&e.push(tw),s&&e.push(tS,tE,t_),g&&e.push(tT),tN(e,h)}return[]},[e,s,g,y,h]);return m?(0,r.jsx)(em.Q,{}):(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)("div",{className:tm("keys-wrapper"),children:[(0,r.jsx)(th,{tableData:h,extended:s,type:"primary"}),(0,r.jsx)(th,{tableData:h,extended:s,type:"partitioning"})]}),(0,r.jsx)("div",{className:tm(),children:(0,r.jsx)(ep.l,{columnsWidthLSKey:"schemaTableColumnsWidth",data:h,columns:f,settings:v.N3})})]})},tA=n.createContext(void 0),tD=({children:e,path:t,database:a,type:s,subType:i,databaseFullPath:l})=>{let o=n.useMemo(()=>({path:t,database:a,type:s,subType:i,databaseFullPath:l}),[t,a,s,i,l]);return(0,r.jsx)(tA.Provider,{value:o,children:e})},tR=()=>{let e=n.useContext(tA);if(void 0===e)throw Error("useCurrentSchema must be used within a TenantContextProvider");return e};var tk=a(90076),tM=a(24629),tO=a(25508);let tq=g.F.injectEndpoints({endpoints:e=>({getSchemaAcl:e.query({queryFn:async({path:e,database:t,dialect:a,databaseFullPath:r},{signal:n})=>{try{let s=await window.api.viewer.getSchemaAcl({path:{path:e,databaseFullPath:r},database:t,dialect:a},{signal:n});return{data:{acl:s.Common.ACL,effectiveAcl:s.Common.EffectiveACL,owner:s.Common.Owner,interruptInheritance:s.Common.InterruptInheritance}}}catch(e){return{error:e}}},providesTags:["All","AccessRights"]}),getAvailablePermissions:e.query({queryFn:async({database:e,dialect:t,databaseFullPath:a},{signal:r})=>{try{return{data:(await window.api.viewer.getAvailablePermissions({path:{path:a,databaseFullPath:a},database:e,dialect:t},{signal:r})).AvailablePermissions}}catch(e){return{error:e}}}}),updateAccess:e.mutation({queryFn:async({database:e,databaseFullPath:t,path:a,rights:r,dialect:n})=>{try{return{data:await window.api.viewer.updateAccessRights({database:e,rights:r,dialect:n,path:{path:a,databaseFullPath:t}})}}catch(e){return{error:e}}},invalidatesTags:(e,t)=>t?[]:["AccessRights"]})}),overrideExisting:"throw"}),tL=(0,tO.Mz)(e=>e,(e,t)=>t,(e,t,a)=>a,(e,t,a,r)=>r,(e,t,a,r)=>tq.endpoints.getSchemaAcl.select({path:e,database:t,databaseFullPath:a,dialect:r})),tz=(0,tO.Mz)(e=>e,(e,t,a,r,n)=>tL(t,a,r,n),(e,t)=>t(e).data?.owner),tF=(0,tO.Mz)(e=>e,(e,t,a,r,n)=>tL(t,a,r,n),(e,t)=>t(e).data),tQ=(0,tO.Mz)((e,t,a,r,n)=>tF(e,t,a,r,n),e=>{if(!e)return null;let{acl:t,effectiveAcl:a}=e,r={};return t?.length&&t.forEach(e=>{e.Subject&&(r[e.Subject]||(r[e.Subject]={explicit:new Set,effective:new Set}),e.AccessRules?.forEach(t=>{r[e.Subject].explicit.add(t)}),e.AccessRights?.forEach(t=>{r[e.Subject].explicit.add(t)}))}),a?.length&&a.forEach(e=>{e.Subject&&(r[e.Subject]||(r[e.Subject]={explicit:new Set,effective:new Set}),e.AccessRules?.forEach(t=>{r[e.Subject].effective.add(t)}),e.AccessRights?.forEach(t=>{r[e.Subject].effective.add(t)}))}),r}),tU=(0,tO.Mz)((e,t,a,r,n)=>tQ(e,t,a,r,n),e=>e?Object.entries(e).map(([e,t])=>({subject:e,explicit:Array.from(t.explicit),effective:Array.from(t.effective)})):null),t$=(0,tO.Mz)([(e,t)=>t,(e,t,a,r,n,s)=>tQ(e,a,r,n,s)],(e,t)=>e&&t?Array.from(t[e]?.explicit||new Set):[]),tG=(0,tO.Mz)([(e,t)=>t,(e,t,a,r,n,s)=>tQ(e,a,r,n,s)],(e,t)=>{if(!e||!t)return new Set;let a=t[e]?.explicit||new Set;return new Set(Array.from(t[e]?.effective||new Set).filter(e=>!a.has(e)))}),tH=(0,tO.Mz)(e=>e,(e,t)=>t,(e,t,a)=>a,(e,t,a)=>tq.endpoints.getAvailablePermissions.select({database:e,dialect:a,databaseFullPath:t})),tB=(0,tO.Mz)(e=>e,(e,t,a,r)=>tH(t,a,r),(e,t)=>t(e).data);function tW(){let[{showHealthcheck:e,database:t,schema:a,view:r,issuesFilter:s,showGrantAccess:i,aclSubject:l,name:o},c]=(0,e$.useQueryParams)({name:e$.StringParam,showHealthcheck:e$.BooleanParam,database:e$.StringParam,schema:e$.StringParam,view:e$.StringParam,issuesFilter:e$.StringParam,showGrantAccess:e$.BooleanParam,aclSubject:e$.StringParam}),d=n.useCallback(e=>{c({showHealthcheck:e||void 0},"replaceIn")},[c]),u=n.useCallback(e=>{c({aclSubject:e},"replaceIn")},[c]),p=n.useCallback(e=>{c({showGrantAccess:e||void 0},"replaceIn")},[c]),m=n.useCallback(e=>{c({database:e},"replaceIn")},[c]),h=n.useCallback(e=>{c({schema:e},"replaceIn")},[c]),g=n.useCallback(e=>{c({issuesFilter:e},"replaceIn")},[c]),x=n.useCallback(e=>{c({view:e},"replaceIn")},[c]);return n.useEffect(()=>{o&&!t&&c({database:o,name:void 0},"replaceIn")},[t,o,c]),{showHealthcheck:e,handleShowHealthcheckChange:d,database:t||o,handleDatabaseChange:m,showGrantAccess:i,handleShowGrantAccessChange:p,schema:a,handleSchemaChange:h,view:r,handleHealthcheckViewChange:x,issuesFilter:s,handleIssuesFilterChange:g,aclSubject:l,handleAclSubjectChange:u}}var tV=a(38360),tJ=a(39688),tY=a(44444),tK=a(65066),tZ=a(99802);let tX=(0,c.cn)("ydb-subject-with-avatar");function t0({subject:e,title:t,renderIcon:a}){return(0,r.jsxs)(eD.s,{gap:2,alignItems:"center",children:[(0,r.jsxs)("div",{className:tX("avatar-wrapper"),children:[(0,r.jsx)(tZ.e,{theme:"brand",text:e,title:e}),a?.()]}),(0,r.jsxs)(eD.s,{direction:"column",overflow:"hidden",children:[(0,r.jsx)(eA.E,{variant:"body-2",className:tX("subject"),children:e}),t&&(0,r.jsx)(eA.E,{variant:"body-2",color:"secondary",children:t})]})]})}var t1=JSON.parse('{"title_owner":"owner","action_change-owner":"Change owner","description_owner":"The owner has complete management authority over the object and cannot acquire or lose any rights associated with it.","action_grant-access":"Grant Access","label_explicit-rights":"Explicit rights","label_effective-rights":"Effective rights","label_subject":"Subject","descrtiption_empty-rights":"No access rights","decription_enter-subject":"Enter subject","action_cancel":"Cancel","action_apply":"Apply","title_owner-changed":"Owner has been successfully changed","description_explicit-rights":"Direct granted permissions","description_effective-rights":"Total active permissions from inheritance and direct grants","action_revoke":"Revoke","label_revoke-all-rights":"Revoke all explicit rights","descripition_no-rights-to-revoke":"No rights to revoke","description_grant-explicit-rights":"Grant explicit rights","description_revoke-all-rights":"Are you sure you want to revoke all explicit rights for:","description_rights-revoked":"Explicit rights has been successfully revoked"}');let t2=(0,ex.g4)("ydb-access-rights",{en:t1}),t3=(0,c.cn)("ydb-access-rights");var t4=a(99460),t5=a(74101),t6=a(33777),t7=a(58746);let t8="change-owner-dialog";async function t9({path:e,database:t,databaseFullPath:a}){return await t4.Ay.show(t8,{id:t8,path:e,database:t,databaseFullPath:a})}let ae=t4.Ay.create(({path:e,database:t,databaseFullPath:a})=>{let n=t4.Ay.useModal();return(0,r.jsx)(at,{onClose:()=>{n.resolve(!1),n.hide(),n.remove()},open:n.visible,path:e,database:t,databaseFullPath:a})});function at({open:e,onClose:t,path:a,database:s,databaseFullPath:i}){let[l,o]=n.useState(""),[c,d]=n.useState(""),[u,p]=tq.useUpdateAccessMutation(),m=(0,j.XC)(),h=n.useRef(null),g=()=>{u({path:a,database:s,databaseFullPath:i,dialect:m,rights:{ChangeOwnership:{Subject:l}}}).unwrap().then(()=>{t(),(0,eL.A)({name:"updateOwner",content:t2("title_owner-changed"),autoHiding:3e3})}).catch(e=>{d((0,t7.$)(e))})};return(0,r.jsxs)(t5.l,{open:e,size:"s",onClose:t,onEnterKeyDown:g,initialFocus:h,children:[(0,r.jsx)(t5.l.Header,{caption:t2("action_change-owner")}),(0,r.jsx)(t5.l.Body,{children:(0,r.jsxs)("div",{className:t3("dialog-content-wrapper"),children:[(0,r.jsx)(t6.k,{controlRef:h,id:"queryName",placeholder:t2("decription_enter-subject"),value:l,onUpdate:e=>{o(e),d("")},hasClear:!0,autoFocus:!0,autoComplete:!1}),c&&(0,r.jsx)(eA.E,{color:"danger",className:t3("dialog-error"),title:c,children:c})]})}),(0,r.jsx)(t5.l.Footer,{onClickButtonApply:g,textButtonCancel:t2("action_cancel"),textButtonApply:t2("action_apply"),onClickButtonCancel:t,propsButtonApply:{loading:p.isLoading,disabled:!l.length}})]})}function aa(){let e=(0,I.nz)(),{path:t,database:a,databaseFullPath:n}=tR(),s=(0,j.XC)(),i=(0,j.N4)(e=>tz(e,t,a,n,s));return i?(0,r.jsxs)(eD.s,{gap:4,alignItems:"center",children:[(0,r.jsx)(tY.Z,{view:"filled",className:t3("owner-card"),children:(0,r.jsxs)(eD.s,{alignItems:"center",justifyContent:"space-between",gap:9,children:[(0,r.jsx)(t0,{subject:i,renderIcon:()=>(0,r.jsx)(eD.s,{alignItems:"center",justifyContent:"center",className:t3("icon-wrapper"),children:(0,r.jsx)(ek.I,{data:tV.A,size:14,className:t3("avatar-icon")})}),title:t2("title_owner")}),e&&(0,r.jsxs)(eD.s,{gap:1,alignItems:"center",children:[(0,r.jsx)(tK.c,{className:t3("owner-divider"),orientation:"vertical"}),(0,r.jsx)(eR.m,{title:t2("action_change-owner"),children:(0,r.jsx)(tM.$,{view:"flat-secondary",onClick:()=>t9({path:t,database:a,databaseFullPath:n}),children:(0,r.jsx)(ek.I,{data:tJ.A})})})]})]})}),(0,r.jsx)(eA.E,{color:"secondary",className:t3("owner-description"),children:t2("description_owner")})]}):null}t4.Ay.register(t8,ae);var ar=a(42880),an=a(66840);let as="revoke-all-rights-dialog";async function ai({path:e,database:t,subject:a,databaseFullPath:r}){return await t4.Ay.show(as,{id:as,path:e,database:t,subject:a,databaseFullPath:r})}let al=t4.Ay.create(({path:e,database:t,subject:a,databaseFullPath:n})=>{let s=t4.Ay.useModal();return(0,r.jsx)(ao,{onClose:()=>{s.resolve(!1),s.hide(),s.remove()},open:s.visible,path:e,database:t,subject:a,databaseFullPath:n})});function ao({open:e,onClose:t,path:a,database:s,databaseFullPath:i,subject:l}){let o=(0,j.XC)(),c=(0,j.N4)(e=>t$(e,l,a,s,i,o)),[d,u]=n.useState(""),[p,m]=tq.useUpdateAccessMutation();return(0,r.jsxs)(t5.l,{open:e,size:"s",onClose:t,children:[(0,r.jsx)(t5.l.Header,{caption:t2("label_revoke-all-rights")}),(0,r.jsx)(t5.l.Body,{children:(0,r.jsxs)(eD.s,{direction:"column",gap:5,children:[(0,r.jsx)(eA.E,{variant:"body-2",children:t2("description_revoke-all-rights")}),(0,r.jsx)(t0,{subject:l})]})}),(0,r.jsx)(t5.l.Footer,{onClickButtonApply:()=>{p({path:a,database:s,databaseFullPath:i,dialect:o,rights:{RemoveAccess:[{Subject:l,AccessRights:Array.from(c),AccessType:"Allow"}]}}).unwrap().then(()=>{t(),(0,eL.A)({name:"revokeAllRights",content:t2("description_rights-revoked"),autoHiding:3e3})}).catch(e=>{u((0,t7.$)(e))})},textButtonCancel:t2("action_cancel"),textButtonApply:t2("action_revoke"),onClickButtonCancel:t,propsButtonApply:{loading:m.isLoading,view:"outlined-danger"},children:d&&(0,r.jsx)(eA.E,{color:"danger",title:d,children:d})})]})}function ac({subject:e,className:t}){return(0,I.nz)()?(0,r.jsxs)(eD.s,{gap:1,className:t,alignItems:"center",children:[(0,r.jsx)(ad,{subject:e}),(0,r.jsx)(au,{subject:e})]}):null}function ad({subject:e}){let{handleShowGrantAccessChange:t,handleAclSubjectChange:a}=tW();return(0,r.jsx)(eR.m,{title:t2("description_grant-explicit-rights"),children:(0,r.jsx)(tM.$,{view:"outlined",onClick:()=>{t(!0),a(e)},size:"s",children:(0,r.jsx)(ek.I,{data:tJ.A})})})}function au({subject:e}){let{path:t,database:a,databaseFullPath:n}=tR(),s=(0,j.XC)(),i=0===(0,j.N4)(r=>t$(r,e,t,a,n,s)).length,l=async()=>{await ai({path:t,database:a,databaseFullPath:n,subject:e})};return(0,r.jsx)(eR.m,{title:i?t2("descripition_no-rights-to-revoke"):t2("label_revoke-all-rights"),children:(0,r.jsx)("div",{className:t3("button-wrapper"),children:(0,r.jsx)(tM.$,{onClick:l,disabled:i,view:"outlined",size:"s",children:(0,r.jsx)(ek.I,{data:an.A})})})})}t4.Ay.register(as,al);let ap=[{name:"subject",width:210,get header(){return t2("label_subject")},render:({row:{subject:e}})=>(0,r.jsx)(t0,{subject:e})},{name:"explicit",width:400,get header(){return(0,r.jsx)(ar.$,{header:t2("label_explicit-rights"),note:t2("description_explicit-rights")})},render:({row:{subject:e,explicit:t}})=>(0,r.jsxs)(eD.s,{justifyContent:"space-between",alignItems:"center",className:t3("rights-wrapper"),children:[(0,r.jsx)(eD.s,{gap:2,wrap:"wrap",children:t.map(e=>(0,r.jsx)(tc.J,{theme:"normal",size:"xs",children:e},e))}),(0,r.jsx)(ac,{subject:e,className:t3("rights-actions")})]}),sortable:!1},{name:"effective",width:400,get header(){return(0,r.jsx)(ar.$,{header:t2("label_effective-rights"),note:t2("description_effective-rights")})},render:({row:{effective:e}})=>(0,r.jsx)(eD.s,{gap:2,wrap:"wrap",children:e.map(e=>(0,r.jsx)(tc.J,{theme:"unknown",size:"xs",children:e},e))}),sortable:!1}],am={...v.N3,dynamicRender:!1};function ah(){let{path:e,database:t,databaseFullPath:a}=tR(),n=(0,j.XC)(),s=(0,j.N4)(r=>tU(r,e,t,a,n));return(0,r.jsx)(ep.l,{columnsWidthLSKey:"right-table-columns-width",columns:ap,data:s??[],settings:am,emptyDataMessage:t2("descrtiption_empty-rights"),wrapperClassName:t3("rights-table")})}function ag(){let{path:e,database:t,databaseFullPath:a}=tR(),s=(0,I.nz)(),[i]=(0,j.Nt)(),o=(0,j.XC)(),{isFetching:c,currentData:d,error:u}=tq.useGetSchemaAclQuery({path:e,database:t,dialect:o,databaseFullPath:a},{pollingInterval:i}),{handleShowGrantAccessChange:p}=tW();return(0,r.jsx)(l.r,{loading:c&&!d,children:u?(0,r.jsx)(q.o,{error:u}):(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)(eD.s,{gap:10,justifyContent:"space-between",alignItems:"start",className:t3("header"),children:[(0,r.jsx)(aa,{}),s&&(0,r.jsxs)(tM.$,{view:"action",onClick:()=>{p(!0)},children:[(0,r.jsx)(ek.I,{data:tk.A}),t2("action_grant-access")]})]}),(0,r.jsx)(ah,{})]})})}var ax=a(60680),ay=a.n(ax),af=a(9849);let ab=g.F.injectEndpoints({endpoints:e=>({getTopic:e.query({queryFn:async({path:e,database:t,databaseFullPath:a})=>{try{let r=await window.api.viewer.getTopic({path:{path:e,databaseFullPath:a},database:t});if("object"!=typeof r)return{error:{}};return{data:r}}catch(e){return{error:e}}},providesTags:["All"]}),getTopicData:e.query({queryFn:async e=>{try{return{data:await window.api.viewer.getTopicData({message_size_limit:100,...e})}}catch(e){return{error:e}}},keepUnusedDataFor:0})}),overrideExisting:"throw"}),av=(0,tO.Mz)(e=>e,(e,t)=>t,(e,t,a)=>a,(e,t,a)=>ab.endpoints.getTopic.select({path:e,database:t,databaseFullPath:a})),aj=(0,tO.Mz)(e=>e,(e,t,a,r)=>av(t,a,r),(e,t)=>t(e).data?.topic_stats),aT=(0,tO.Mz)(e=>e,(e,t,a,r)=>av(t,a,r),(e,t)=>t(e).data?.consumers),aw=(0,tO.Mz)(aT,e=>e?.map(e=>e?.name).filter(e=>void 0!==e)),aS=(0,tO.Mz)(aj,e=>{if(!e)return;let{store_size_bytes:t="0",min_last_write_time:a,max_write_time_lag:r,bytes_written:n}=e||{};return{storeSize:t,partitionsIdleTime:(0,ez.MC)(a),partitionsWriteLag:(0,ez.i6)(r),writeSpeed:(0,af.ey)(n)}}),aE=(0,tO.Mz)(aT,e=>e?.map(e=>{let{name:t,consumer_stats:a}=e||{},{min_partitions_last_read_time:r,max_read_time_lag:n,max_write_time_lag:s,bytes_read:i}=a||{};return{name:t,readSpeed:(0,af.ey)(i),writeLag:(0,ez.i6)(s),readLag:(0,ez.i6)(n),readIdleTime:(0,ez.MC)(r)}}));var a_=a(29901),aN=JSON.parse('{"averageSpeed":"Average speed","perMinute":"per minute","perHour":"per hour","perDay":"per day"}'),aC=JSON.parse('{"averageSpeed":"Средняя скорость","perMinute":"за минуту","perHour":"за час","perDay":"за день"}');let aP=(0,ex.g4)("ydb-components-speed-multimeter",{ru:aC,en:aN}),aI=(0,c.cn)("speed-multimeter"),aA=({data:e,speedSize:t="kb",withValue:a=!0,withPopover:s=!0})=>{let i,{perMinute:l=0,perHour:o=0,perDay:c=0}=e||{},d=[l,o,c],u=e=>(0,af.z3)({value:e,size:t,withSpeedLabel:!0}),p=[{value:u(l),label:aP("perMinute")},{value:u(o),label:aP("perHour")},{value:u(c),label:aP("perDay")}],[m,h]=n.useState(0),[g,x]=n.useState(a?0:void 0),[y,f]=n.useState();return(0,r.jsx)("div",{className:aI(),children:(0,r.jsxs)("div",{className:aI("content"),children:[a&&(0,r.jsx)("div",{className:aI("displayed-value"),children:u(d[m])}),(0,r.jsx)(a_.A,{content:(0,r.jsxs)("div",{className:aI("popover-content"),children:[(0,r.jsx)("span",{className:aI("popover-header"),children:aP("averageSpeed")}),p.map((e,t)=>(0,r.jsx)("span",{className:aI("popover-row",g===t?{color:"primary"}:{color:"secondary"}),children:`${e.label}: ${e.value}`},t))]}),className:aI("popover-container",v.zQ),placement:"bottom",disabled:!s,hasArrow:!0,children:(0,r.jsx)("div",{className:aI("bars"),onMouseLeave:()=>{h(0),x(a?0:void 0),f(void 0)},children:(i=Math.max(...d,0)||1,d.map((e,t)=>(0,r.jsx)("div",{className:aI("bar-container",{highlighted:y===t}),onMouseEnter:()=>{h(t),x(t),f(t)},children:(0,r.jsx)("div",{className:aI("bar",{color:g===t?"dark":"light"}),style:{width:`${100*e/i}%`}})},t)))})})]})})},aD=(0,c.cn)("ydb-diagnostics-consumers-topic-stats"),aR=({data:e})=>{let{writeSpeed:t,partitionsWriteLag:a,partitionsIdleTime:n}=e||{},s=[{label:"Write speed",value:(0,r.jsx)(aA,{data:t})},{label:"Write lag",value:(0,Q.uH)(a||0)},{label:"Write idle time",value:(0,Q.uH)(n||0)}];return(0,r.jsx)("div",{className:aD("wrapper"),children:s.map((e,t)=>(0,r.jsxs)("div",{className:aD("item"),children:[(0,r.jsx)("div",{className:aD("label"),children:e.label}),(0,r.jsx)("div",{className:aD("value"),children:e.value})]},t))})};var ak=a(55373),aM=a.n(ak),aO=a(15749),aq=a(44524),aL=a(67664),az=a(46086);let aF=({text:e,popoverContent:t,popoverClassName:a,className:n})=>(0,r.jsxs)("div",{className:n,children:[e,"\xa0",(0,r.jsx)(az.H,{className:a,children:t})]}),aQ="#ADE8F5",aU="#f5be9d",a$=({width:e,height:t,transform:a})=>(0,r.jsx)("path",{d:`M-${e/2} 0 c0 -${t}, ${e} -${t}, ${e} 0`,fill:"none",strokeDasharray:"4,6",stroke:"#28f",strokeWidth:"1.6",transform:a}),aG=({width:e})=>(0,r.jsx)("path",{fill:"none",strokeWidth:"2",d:`M0 0 h${e} l-10 -5 m0 10 l10 -5`}),aH=()=>(0,r.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,r.jsx)("g",{transform:"translate(0, 27)",stroke:aU,children:(0,r.jsx)(aG,{width:203})}),(0,r.jsxs)("g",{transform:"translate(30, 0)",children:[(0,r.jsxs)("g",{transform:"translate(35, 27)",children:[(0,r.jsx)(a$,{width:70,height:15}),(0,r.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,r.jsxs)("g",{transform:"translate(119, 27)",children:[(0,r.jsx)(a$,{width:98,height:15}),(0,r.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"write idle time"})})]})]}),(0,r.jsxs)("g",{transform:"translate(30, 0)",children:[(0,r.jsxs)("g",{transform:"translate(0, 27)",children:[(0,r.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:aU}),(0,r.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,r.jsxs)("g",{transform:"translate(70, 27)",children:[(0,r.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:aU}),(0,r.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,r.jsx)("g",{transform:"translate(168, 27)",children:(0,r.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),aB=()=>(0,r.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,r.jsx)("g",{transform:"translate(0, 27)",stroke:aQ,children:(0,r.jsx)(aG,{width:268})}),(0,r.jsxs)("g",{transform:"translate(30, 0)",children:[(0,r.jsxs)("g",{transform:"translate(105, 27)",children:[(0,r.jsx)(a$,{width:70,height:15}),(0,r.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"read lag"})})]}),(0,r.jsxs)("g",{transform:"translate(35, 27)",children:[(0,r.jsx)(a$,{width:70,height:15}),(0,r.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,r.jsxs)("g",{transform:"translate(182, 27)",children:[(0,r.jsx)(a$,{width:91,height:15}),(0,r.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"read idle time"})})]})]}),(0,r.jsxs)("g",{transform:"translate(30, 27)",children:[(0,r.jsxs)("g",{transform:"translate(0, 0)",children:[(0,r.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:aQ}),(0,r.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,r.jsxs)("g",{transform:"translate(70, 0)",children:[(0,r.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:aQ}),(0,r.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,r.jsxs)("g",{transform:"translate(140, 0)",children:[(0,r.jsx)("use",{x:"-2",y:"-10",xlinkHref:"#check",stroke:aQ}),(0,r.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"read time"})})]}),(0,r.jsx)("g",{transform:"translate(224, 0)",children:(0,r.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,r.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),aW=({id:e,fill:t})=>(0,r.jsx)("pattern",{id:e,x:"0",y:"0",width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,r.jsx)("path",{d:"M0 5L5 0H8L0 8V5M5 8L8 5V8Z",fill:t})}),aV=()=>(0,r.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 268 54",width:268,height:54,children:[(0,r.jsxs)("defs",{children:[(0,r.jsx)("g",{id:"check",children:(0,r.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,r.jsx)(aW,{id:"latest-read",fill:aQ}),(0,r.jsx)(aW,{id:"latest-write",fill:aU})]}),(0,r.jsx)(aH,{})]}),aJ=()=>(0,r.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 268 54",width:268,height:54,children:[(0,r.jsxs)("defs",{children:[(0,r.jsx)("g",{id:"check",children:(0,r.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,r.jsx)(aW,{id:"latest-read",fill:aQ}),(0,r.jsx)(aW,{id:"latest-write",fill:aU})]}),(0,r.jsx)(aB,{})]}),aY=(0,c.cn)("ydb-lag-popover-content"),aK=({text:e,type:t})=>(0,r.jsxs)("div",{className:aY({type:t}),children:[(0,r.jsx)("div",{className:aY("text"),children:e}),(0,r.jsx)("div",{children:"read"===t?(0,r.jsx)(aJ,{}):(0,r.jsx)(aV,{})})]});var aZ=JSON.parse('{"noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers","lagsPopover.readLags":"Read lags statistics, maximum among all consumer partitions (time format dd hh:mm:ss)","table.emptyDataMessage":"No consumers match the current search","controls.search":"Consumer"}'),aX=JSON.parse('{"noConsumersMessage.topic":"У этого топика нет читателей","noConsumersMessage.stream":"У этого стрима нет читателей","lagsPopover.readLags":"Статистика лагов чтения, максимальное значение среди всех партиций читателя (формат времени дд чч:мм:сс)","table.emptyDataMessage":"По заданному поиску нет читателей","controls.search":"Consumer"}');let a0=(0,ex.g4)("ydb-diagnostics-consumers",{ru:aX,en:aZ}),a1="consumer",a2="readSpeed",a3="readLags",a4={[a1]:"Consumer",[a2]:"Read speed",[a3]:"Read lags, duration"},a5="writeLag",a6="readLag",a7="readIdleTime",a8={[a5]:"write lag",[a6]:"read lag",[a7]:"read idle time"},a9=(0,c.cn)("ydb-diagnostics-consumers-columns-header"),re=(0,c.cn)("ydb-diagnostics-consumers-columns"),rt=[{name:a1,header:a4[a1],align:tg.Ay.LEFT,render:({row:e})=>e.name?(0,r.jsx)(ra,{name:e.name}):aq.Pd},{name:a2,header:a4[a2],align:tg.Ay.RIGHT,resizeMinWidth:140,sortAccessor:e=>e.readSpeed.perMinute,render:({row:e})=>(0,r.jsx)(aA,{data:e.readSpeed})},{name:a3,header:(0,r.jsx)(()=>(0,r.jsx)(aF,{className:a9("lags"),text:a4[a3],popoverContent:(0,r.jsx)(aK,{text:a0("lagsPopover.readLags"),type:"read"})}),{}),className:re("lags-header"),sub:[{name:a5,header:a8[a5],align:tg.Ay.RIGHT,render:({row:e})=>(0,Q.uH)(e.writeLag)},{name:a6,header:a8[a6],align:tg.Ay.RIGHT,render:({row:e})=>(0,Q.uH)(e.readLag)},{name:a7,header:a8[a7],align:tg.Ay.RIGHT,render:({row:e})=>(0,Q.uH)(e.readIdleTime)}]}];function ra({name:e}){let t=aM().parse(location.search,{ignoreQueryPrefix:!0});return(0,r.jsx)(aO.E,{to:(0,B.YL)({...t,[aL.vh.diagnosticsTab]:E.iJ.partitions,selectedConsumer:e}),children:e})}let rr=(0,c.cn)("ydb-diagnostics-consumers"),rn=({path:e,database:t,type:a,databaseFullPath:s})=>{let[i,l]=n.useState(""),[o]=(0,j.Nt)(),{currentData:c,isFetching:d,error:u}=ab.useGetTopicQuery({path:e,database:t,databaseFullPath:s},{pollingInterval:o}),p=(0,j.N4)(a=>aE(a,e,t,s)),m=(0,j.N4)(a=>aS(a,e,t,s)),h=n.useMemo(()=>{if(!p)return[];let e=RegExp(ay()(i),"i");return p.filter(t=>e.test(String(t.name)))},[p,i]);return d&&void 0===c?(0,r.jsx)(L.a,{size:"m"}):u||p&&p.length?(0,r.jsxs)("div",{className:rr(),children:[(0,r.jsxs)("div",{className:rr("controls"),children:[(0,r.jsx)(eg.v,{onChange:e=>{l(e)},placeholder:a0("controls.search"),className:rr("search"),value:i}),m&&(0,r.jsx)(aR,{data:m})]}),u?(0,r.jsx)(q.o,{error:u}):null,p?(0,r.jsx)("div",{className:rr("table-wrapper"),children:(0,r.jsx)("div",{className:rr("table-content"),children:(0,r.jsx)(ep.l,{columnsWidthLSKey:"consumersColumnsWidth",wrapperClassName:rr("table"),data:h,columns:rt,settings:v.N3,emptyDataMessage:a0("table.emptyDataMessage")})})}):null]}):(0,r.jsx)("div",{children:a0(`noConsumersMessage.${"EPathTypeCdcStream"===a?"stream":"topic"}`)})};var rs=a(44468);let ri=(0,c.cn)("ydb-describe"),rl=({path:e,database:t,databaseFullPath:a,scrollContainerRef:n})=>{let[s]=(0,j.Nt)(),{currentData:i,isFetching:l,error:o}=x.useGetOverviewQuery({path:e,database:t,databaseFullPath:a},{pollingInterval:s});return l&&void 0===i?(0,r.jsx)(L.a,{size:"m"}):i||o?(0,r.jsxs)("div",{className:ri(),children:[o?(0,r.jsx)(q.o,{error:o}):null,i?(0,r.jsx)("div",{className:ri("result"),children:(0,r.jsx)(rs.p,{value:i,withClipboardButton:{withLabel:!1,copyText:JSON.stringify(i)},search:!0,collapsedInitially:!0,scrollContainerRef:n})}):null]}):(0,r.jsx)("div",{className:ri("message-container"),children:"Empty"})};var ro=a(83758);let rc=e=>{let{PathType:t,PathSubType:a}=e?.Self||{};if("EPathTypeTableIndex"===t){let t;return(t=e?.TableIndex?.Type)&&e9[t]}return a&&e7[a]||t&&e8[t]};var rd=JSON.parse('{"title_index-settings":"Index Settings","field_clusters":"Clusters","field_levels":"Levels","field_vector_dimension":"Vector Dimension","field_vector_type":"Vector Type","field_metric":"Metric","field_columns":"Columns","field_includes":"Includes","field_data-size":"Data Size","field_layout":"Layout","field_tokenizer":"Tokenizer","field_language":"Language","field_use_filter_lowercase":"Filter Lowercase","field_use_filter_stopwords":"Filter Stopwords","field_use_filter_ngram":"Filter Ngram","field_use_filter_edge_ngram":"Filter Edge Ngram","field_filter_ngram_min_length":"Filter Ngram Min Length","field_filter_ngram_max_length":"Filter Ngram Max Length","field_use_filter_length":"Filter Length","field_filter_length_min":"Filter Length Min","field_filter_length_max":"Filter Length Max","filter_enabled":"Enabled","filter_disabled":"Disabled","alert_no-entity-data":"No {{entity}} data"}');let ru=(0,ex.g4)("info-viewer-schema-index-info",{en:rd});var rp=a(64349),rm=a(2275);let rh=(0,rm.H)({values:{PathType:e=>e?.substring("EPathType".length),CreateStep:e=>(0,Q.r6)(e,{defaultValue:v.Pd})},labels:{PathType:(0,rp.A)("common.type"),CreateStep:(0,rp.A)("common.created")}}),rg=({value:e,withSpeedLabel:t,...a})=>{let n=(0,af.z3)({value:e,withSpeedLabel:t,...a}),s=(0,af.z3)({value:e,withSpeedLabel:t,size:"b"});return(0,r.jsx)("span",{title:s,children:n})},rx=(e,t)=>e?(0,r.jsx)(rg,{value:e,...t}):null,ry=(0,rm.H)({values:{Type:e=>e?.substring(10),State:e=>e?.substring(11),KeyColumnNames:e=>e?.join(", "),DataColumnNames:e=>e?.join(", "),DataSize:rx},labels:{KeyColumnNames:ru("field_columns"),DataColumnNames:ru("field_includes"),DataSize:ru("field_data-size")}}),rf={METERING_MODE_REQUEST_UNITS:"request-units",METERING_MODE_RESERVED_CAPACITY:"reserved-capacity"},rb=(0,rm.H)({values:{Partitions:e=>(0,Q.ZV)(e?.length||0),PQTabletConfig:e=>{let t=Math.round(e.PartitionConfig.LifetimeSeconds/v.Jg*100)/100;return`${(0,Q.ZV)(t)} hours`}},labels:{Partitions:"Partitions count",PQTabletConfig:"Retention"}}),rv=(0,rm.H)({values:{Codecs:e=>e&&Object.values(e.Codecs||{}).join(", "),MeteringMode:e=>e&&rf[e]},labels:{MeteringMode:"Metering mode"}}),rj=(0,rm.H)({values:{StorageLimitBytes:Q.z3,WriteSpeedInBytesPerSecond:Q.tC},labels:{StorageLimitBytes:"Retention storage",WriteSpeedInBytesPerSecond:"Partitions write speed"}}),rT=(0,rm.H)({values:{Mode:e=>e?.substring("ECdcStreamMode".length),Format:e=>e?.substring("ECdcStreamFormat".length)}}),rw=(0,rm.H)({values:{CPU:Q.iM,Memory:rx,Storage:rx,Network:Q.tC,ReadThroughput:Q.tC,WriteThroughput:Q.tC},defaultValueFormatter:Q.ZV}),rS=(0,rm.H)({values:{FollowerCount:Q.ZV},labels:{FollowerCountPerDataCenter:"FollowerCountPerDC"},defaultValueFormatter:e=>e&&String(e)}),rE=(0,rm.H)({values:{FollowerCount:Q.ZV,CrossDataCenterFollowerCount:Q.ZV}}),r_=(0,rm.H)({values:{DataSize:rx,IndexSize:rx,LastAccessTime:Q.r6,LastUpdateTime:Q.r6},defaultValueFormatter:Q.ZV}),rN=["Type","State","DataSize","KeyColumnNames","DataColumnNames"],rC=(0,c.cn)("ydb-diagnostics-table-info"),rP=({data:e})=>{let t,a=rc(e?.PathDescription);if(!e)return(0,r.jsx)("div",{className:"error",children:ru("alert_no-entity-data",{entity:a})});let n=e.PathDescription?.TableIndex,s=(t=[],n&&new Set(rN).forEach(e=>{let a=n[e];void 0!==a&&t.push(ry(e,a))}),t),i=[];return n?.Type==="EIndexTypeGlobalVectorKmeansTree"&&(i=function(e){let t=[];if(!e)return t;let a=(0,rm.H)({values:{clusters:e=>"number"==typeof e?(0,Q.ZV)(e):e,levels:e=>"number"==typeof e?(0,Q.ZV)(e):e},labels:{clusters:ru("field_clusters"),levels:ru("field_levels")}}),{clusters:r,levels:n,settings:s}=e;void 0!==r&&t.push(a("clusters",r)),void 0!==n&&t.push(a("levels",n));let i=(0,rm.H)({values:{vector_dimension:e=>"number"==typeof e?(0,Q.ZV)(e):e,vector_type:e=>"string"==typeof e?e.replace(/^VECTOR_TYPE_/,""):e},labels:{vector_dimension:ru("field_vector_dimension"),vector_type:ru("field_vector_type"),metric:ru("field_metric")}}),{metric:l,vector_type:o,vector_dimension:c}=s??{};return void 0!==l&&t.push(i("metric",l)),void 0!==o&&t.push(i("vector_type",o)),void 0!==c&&t.push(i("vector_dimension",c)),t}(n?.VectorIndexKmeansTreeDescription?.Settings)),n?.Type==="EIndexTypeGlobalFulltext"&&(i=function(e){let t=[];if(!e)return t;let a=(0,rm.H)({values:{layout:e=>e},labels:{layout:ru("field_layout")}}),{layout:r}=e;void 0!==r&&t.push(a("layout",r));let n=(0,rm.H)({values:{tokenizer:e=>e,language:e=>e,use_filter_lowercase:e=>!0===e?ru("filter_enabled"):ru("filter_disabled"),use_filter_stopwords:e=>!0===e?ru("filter_enabled"):ru("filter_disabled"),use_filter_ngram:e=>!0===e?ru("filter_enabled"):ru("filter_disabled"),use_filter_edge_ngram:e=>!0===e?ru("filter_enabled"):ru("filter_disabled"),filter_ngram_min_length:e=>"number"==typeof e?(0,Q.ZV)(e):e,filter_ngram_max_length:e=>"number"==typeof e?(0,Q.ZV)(e):e,use_filter_length:e=>!0===e?ru("filter_enabled"):ru("filter_disabled"),filter_length_min:e=>"number"==typeof e?(0,Q.ZV)(e):e,filter_length_max:e=>"number"==typeof e?(0,Q.ZV)(e):e},labels:{tokenizer:ru("field_tokenizer"),language:ru("field_language"),use_filter_lowercase:ru("field_use_filter_lowercase"),use_filter_stopwords:ru("field_use_filter_stopwords"),use_filter_ngram:ru("field_use_filter_ngram"),use_filter_edge_ngram:ru("field_use_filter_edge_ngram"),filter_ngram_min_length:ru("field_filter_ngram_min_length"),filter_ngram_max_length:ru("field_filter_ngram_max_length"),use_filter_length:ru("field_use_filter_length"),filter_length_min:ru("field_filter_length_min"),filter_length_max:ru("field_filter_length_max")}}),{tokenizer:s,language:i,use_filter_lowercase:l,use_filter_stopwords:o,use_filter_ngram:c,use_filter_edge_ngram:d,filter_ngram_min_length:u,filter_ngram_max_length:p,use_filter_length:m,filter_length_min:h,filter_length_max:g}=e.columns?.filter(e=>void 0!==e.analyzers)[0]?.analyzers??{};return void 0!==s&&t.push(n("tokenizer",s)),void 0!==i&&t.push(n("language",i)),void 0!==l&&t.push(n("use_filter_lowercase",l)),void 0!==o&&t.push(n("use_filter_stopwords",o)),void 0!==c&&t.push(n("use_filter_ngram",c)),void 0!==d&&t.push(n("use_filter_edge_ngram",d)),void 0!==u&&t.push(n("filter_ngram_min_length",u)),void 0!==p&&t.push(n("filter_ngram_max_length",p)),void 0!==m&&t.push(n("use_filter_length",m)),void 0!==h&&t.push(n("filter_length_min",h)),void 0!==g&&t.push(n("filter_length_max",g)),t}(n?.FulltextIndexDescription?.Settings)),(0,r.jsxs)("div",{className:rC(),children:[(0,r.jsx)(ro.z_,{info:s,title:a,className:rC("info-block"),renderEmptyState:()=>(0,r.jsx)("div",{className:rC("title"),children:a})}),i&&i.length?(0,r.jsx)(ro.z_,{info:i,title:ru("title_index-settings"),className:rC("info-block")}):null]})};var rI=a(70073),rA=JSON.parse('{"created":"Created","external-objects.source-type":"Source Type","external-objects.data-source":"Data Source","external-objects.location":"Location","external-objects.auth-method":"Auth Method","external-objects.auth-method.none":"None","external-objects.auth-method.service-account":"Service Account","external-objects.auth-method.aws":"AWS","external-objects.auth-method.token":"Token","external-objects.auth-method.basic":"Basic","external-objects.auth-method.mdb-basic":"MDB Basic","view.query-text":"Query Text","field_system-view-type":"System view type","no-entity-data":"No {{entityName}} data"}');let rD=(0,ex.g4)("ydb-tenant-objects-info",{en:rA});function rR(e){return{name:rD("created"),content:(0,Q.r6)(e,{defaultValue:v.Pd})}}function rk(e){return(0,r.jsx)(eA.E,{variant:"body-2",color:"danger",children:rD("no-entity-data",{entityName:e??""})})}function rM(e){let t,a,{Location:r}=e.PathDescription?.ExternalDataSourceDescription||{};return[...(t=[{name:rD("external-objects.source-type"),content:e.PathDescription?.ExternalDataSourceDescription?.SourceType}],Number(a=e.PathDescription?.Self?.CreateStep)&&t.push(rR(a)),t),{name:rD("external-objects.location"),content:r,copyText:r},{name:rD("external-objects.auth-method"),content:function(e){let{Auth:t}=e.PathDescription?.ExternalDataSourceDescription||{};return t?.ServiceAccount?rD("external-objects.auth-method.service-account"):t?.Aws?rD("external-objects.auth-method.aws"):t?.Token?rD("external-objects.auth-method.token"):t?.Basic?rD("external-objects.auth-method.basic"):t?.MdbBasic?rD("external-objects.auth-method.mdb-basic"):rD("external-objects.auth-method.none")}(e)}]}let rO=({data:e,prepareData:t})=>{let a=rc(e?.PathDescription);return e?(0,r.jsx)(rI.n,{title:a,items:t(e)}):rk(a)},rq=({data:e})=>(0,r.jsx)(rO,{data:e,prepareData:rM});var rL=a(56347),rz=a(60318);let rF=(e,t)=>{let a=e.PathDescription?.ExternalTableDescription?.Location;return[...((e,t)=>{let{CreateStep:a}=e.PathDescription?.Self||{},{SourceType:n,DataSourcePath:s}=e.PathDescription?.ExternalTableDescription||{},i=s?.split("/").pop(),l=[{name:rD("external-objects.source-type"),content:n}];return Number(a)&&l.push(rR(a)),l.push({name:rD("external-objects.data-source"),content:s&&(0,r.jsx)("span",{title:s,children:(0,r.jsx)(rz.K,{title:i||"",url:t})})}),l})(e,t),{name:rD("external-objects.location"),content:a,copyText:a}]},rQ=({data:e,prepareData:t})=>{let a=(0,rL.zy)(),n=(0,B.mA)(a),s=(0,B.Ow)({...n,schema:e?.PathDescription?.ExternalTableDescription?.DataSourcePath}),i=rc(e?.PathDescription);return e?(0,r.jsx)(rI.n,{title:i,items:t(e,s)}):rk(i)},rU=({data:e})=>(0,r.jsx)(rQ,{data:e,prepareData:rF});function r$(e){if(e)return e.startsWith("E")?e.slice(1):e}function rG({data:e}){let t,a=rc(e?.PathDescription);if(!e)return rk(a);let n=(t=e.PathDescription?.SysViewDescription?.Type,[{name:rD("field_system-view-type"),content:r$(t)}]);return(0,r.jsx)(rI.n,{title:a,items:n})}var rH=a(60198);function rB({data:e}){let t,a=rc(e?.PathDescription);if(!e)return rk(a);let n=(t=e.PathDescription?.ViewDescription?.QueryText,[{name:rD("view.query-text"),copyText:t,content:t?(0,r.jsx)(rH.YDBSyntaxHighlighter,{language:"yql",text:t}):null}]);return(0,r.jsx)(rI.n,{title:a,items:n})}function rW({state:e}){return e?"StandBy"in e?(0,r.jsx)(tc.J,{theme:"info",children:"Standby"}):"Paused"in e?(0,r.jsx)(tc.J,{theme:"info",children:"Paused"}):"Done"in e?(0,r.jsx)(tc.J,{theme:"success",children:"Done"}):"Error"in e?(0,r.jsx)(tc.J,{theme:"danger",children:"Error"}):(0,r.jsx)(tc.J,{size:"s",children:"Unknown"}):null}var rV=JSON.parse('{"column.dstPath.name":"Dist","column.srcPath.name":"Source","everythingWithPrefix":"Everything with prefix:","noData":"No data.","title":"Replicated Paths"}');let rJ=(0,ex.g4)("ydb-diagnostics-async-replication-paths",{en:rV}),rY=(0,c.cn)("ydb-async-replication-paths"),rK=[{name:rJ("column.srcPath.name"),render:({row:e})=>e.SrcPath,sortAccessor:e=>e.SrcPath},{name:rJ("column.dstPath.name"),render:({row:e})=>e.DstPath,sortAccessor:e=>e.DstPath}];function rZ({config:e}){if(!e)return null;let t=rJ("noData");return e.Everything&&(t=(0,r.jsxs)("span",{children:[rJ("everythingWithPrefix")," ",(0,r.jsx)(eA.E,{variant:"code-inline-2",children:e.Everything?.DstPrefix??"undefined"}),"."]})),e.Specific&&(t=(0,r.jsx)(ep.l,{data:e.Specific.Targets,settings:v.jp,columns:rK})),(0,r.jsxs)("div",{className:rY(),children:[(0,r.jsx)("div",{className:rY("title"),children:rJ("title")}),t]})}function rX({connection:e}){return e?e.StaticCredentials?(0,r.jsx)(tc.J,{value:e.StaticCredentials.User,theme:"normal",children:"user"}):"OAuthToken"in e?"OAuth":"unknown":null}var r0=JSON.parse('{"credentials.label":"Credentials","noData":"No data for entity:","srcConnection.database.label":"Source Database Path","srcConnection.endpoint.label":"Source Cluster Endpoint","state.label":"State"}');let r1=(0,ex.g4)("ydb-diagnostics-async-replication-info",{en:r0});function r2({data:e}){let t=rc(e?.PathDescription);if(!e)return(0,r.jsxs)("div",{className:"error",children:[r1("noData")," ",t]});let a=function(e){let t=e.PathDescription?.ReplicationDescription||{},a=t.State,n=t.Config?.SrcConnectionParams||{},{Endpoint:s,Database:i}=n,l=[];return a&&l.push({name:r1("state.label"),content:(0,r.jsx)(rW,{state:a})}),s&&l.push({name:r1("srcConnection.endpoint.label"),copyText:s,content:(0,r.jsx)(eA.E,{variant:"code-inline-2",children:s})}),i&&l.push({name:r1("srcConnection.database.label"),copyText:i,content:(0,r.jsx)(eA.E,{variant:"code-inline-2",children:i})}),n&&l.push({name:r1("credentials.label"),content:(0,r.jsx)(rX,{connection:n})}),l}(e);return(0,r.jsxs)(eD.s,{direction:"column",gap:"4",children:[(0,r.jsx)(rI.n,{title:t,items:a}),(0,r.jsx)(rZ,{config:e.PathDescription?.ReplicationDescription?.Config})]})}var r3=JSON.parse('{"writeLagPopover":"Write lag, maximum among all topic partitions","writeIdleTimePopover":"Write idle time, maximum among all topic partitions"}'),r4=JSON.parse('{"writeLagPopover":"Лаг записи, максимальное значение среди всех партиций топика","writeIdleTimePopover":"Время без записи, максимальное значение среди всех партиций топика"}');let r5=(0,ex.g4)("ydb-diagnostics-overview-topic-stats",{ru:r4,en:r3}),r6=(0,c.cn)("ydb-overview-topic-stats"),r7=({path:e,database:t,databaseFullPath:a})=>{let s,[i]=(0,j.Nt)(),{currentData:l,isFetching:o,error:c}=ab.useGetTopicQuery({path:e,database:t,databaseFullPath:a},{pollingInterval:i}),d=(0,j.N4)(r=>aS(r,e,t,a));if(o&&void 0===l)return(0,r.jsx)("div",{className:r6(),children:(0,r.jsx)(L.a,{size:"s"})});let u=c||!d?(0,r.jsx)(q.o,{error:c}):null;return(0,r.jsxs)("div",{className:r6(),children:[(0,r.jsx)("div",{className:r6("title"),children:"Stats"}),u,d?(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)("div",{className:r6("info"),children:(0,r.jsx)(ro.z_,{info:[{label:"Store size",value:(0,Q.z3)(d.storeSize)},{label:(0,r.jsx)(aF,{text:"Write idle time",popoverContent:(0,r.jsx)(aK,{text:r5("writeIdleTimePopover"),type:"write"})}),value:(0,ez.Bi)(d.partitionsIdleTime)},{label:(0,r.jsx)(aF,{text:"Write lag",popoverContent:(0,r.jsx)(aK,{text:r5("writeLagPopover"),type:"write"})}),value:(0,ez.Bi)(d.partitionsWriteLag)},{label:"Average write speed",value:(0,r.jsx)(aA,{data:d.writeSpeed,withValue:!1})}],multilineLabels:!0})}),(0,r.jsx)("div",{className:r6("bytes-written"),children:(0,r.jsx)(ro.z_,{info:(s=d.writeSpeed,[{label:"per minute",value:(0,Q.tC)(s.perMinute)},{label:"per hour",value:(0,Q.tC)(s.perHour)},{label:"per day",value:(0,Q.tC)(s.perDay)}])})})]}):null]})},r8=({path:e,database:t,data:a,databaseFullPath:n})=>{let s=rc(a?.PathDescription);return a?(0,r.jsxs)("div",{children:[(0,r.jsx)(ro.z_,{title:s,info:(e=>{if(!e)return[];let{Mode:t,Format:a}=e?.PathDescription?.CdcStreamDescription||{},r=(0,ro.jl)(rT,{Mode:t,Format:a}),n=e?.PathDescription?.Self?.CreateStep;return Number(n)&&r.unshift(rh("CreateStep",n)),r})(a)}),(0,r.jsx)(r7,{path:e,databaseFullPath:n,database:t})]}):(0,r.jsxs)("div",{className:"error",children:["No ",s," data"]})},r9=g.F.injectEndpoints({endpoints:e=>({getStreamingQueryInfo:e.query({queryFn:async({database:e,path:t},{signal:a})=>{try{let r,n=await window.api.viewer.sendQuery({query:(r=t.replace(/'/g,"''"),`${v.Zi}
SELECT
    Status AS State,
    Issues AS Error,
    Text
FROM \`.sys/streaming_queries\`
WHERE Path = '${r}'
LIMIT 1`),database:e,action:"execute-query",internal_call:!0},{signal:a,withRetries:!0});if((0,eK.We)(n))return{error:n};return{data:(0,eK.fW)(n)}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"});var ne=a(69117),nt=JSON.parse('{"field_query-state":"State","field_query-error":"Error","field_query-text":"Text"}');let na=(0,ex.g4)("ydb-diagnostics-streaming-query-info",{en:nt});function nr({database:e,path:t}){let a=rc({Self:{PathType:"EPathTypeStreamingQuery"}}),{data:n,isFetching:s}=r9.useGetStreamingQueryInfoQuery({database:e,path:t},{skip:!e||!t}),i=function(e){if(!e)return[];let t=[],a=(0,Q.vN)(e.resultSets?.[0]?.result?.[0]?.State),n=(0,Q.vN)(e.resultSets?.[0]?.result?.[0]?.Text),s=(0,Q.qe)(n);s=(0,Q.YY)(s);let i=function(e){if("string"==typeof e)try{let t=JSON.parse(e);return(0,eK.CR)(t)?t:void 0}catch{return e}if((0,eK.CR)(e))return e}(e.resultSets?.[0]?.result?.[0]?.Error);return t.push({name:na("field_query-state"),content:(0,r.jsx)(ns,{state:a})}),i&&t.push({name:na("field_query-error"),content:(0,r.jsx)(ne.vt,{data:i})}),t.push({name:na("field_query-text"),copyText:s,content:s?(0,r.jsx)(rH.YDBSyntaxHighlighter,{language:"yql",text:s}):null}),t}(n);return(0,r.jsx)(l.r,{loading:s,children:(0,r.jsx)(rI.n,{title:a,items:i})})}let nn={CREATING:"info",CREATED:"normal",STARTING:"info",RUNNING:"success",STOPPING:"info",STOPPED:"normal",COMPLETED:"success",SUSPENDED:"warning",FAILED:"danger"};function ns({state:e}){if(!e)return null;let t=nn[e]??"normal";return(0,r.jsx)(tc.J,{theme:t,children:e})}function ni({data:e}){let t=rc(e);return e?.UserAttributes?.some(({Key:e,Value:t})=>"__async_replica"===e&&"true"===t)?(0,r.jsxs)(eD.s,{gap:1,wrap:"nowrap",children:[t," ",(0,r.jsx)(tc.J,{children:e0("label.read-only")})]}):t}var nl=JSON.parse('{"tableStats":"Table Stats","tabletMetrics":"Tablet Metrics","partitionConfig":"Partition Config","label.ttl":"TTL for rows","value.ttl":"column: \'{{columnName}}\', expire after: {{expireTime}}","label.standalone":"Standalone","label.partitioning":"Partitioning","label.partitioning-by-size":"Partitioning by size","value.partitioning-by-size.enabled":"Enabled, split size: {{size}}","label.partitioning-by-load":"Partitioning by load","label.partitions-min":"Min number of partitions","label.partitions-max":"Max number of partitions","label.read-replicas":"Read replicas (followers)","label.bloom-filter":"Bloom filter","enabled":"Enabled","disabled":"Disabled"}');let no=(0,ex.g4)("ydb-diagnostics-overview-table-info",{en:nl});var nc=a(90179),nd=a.n(nc),nu=a(33172),np=a(28241);let nm=e=>{if(e.Enabled&&e.Enabled.ColumnName&&void 0!==e.Enabled.ExpireAfterSeconds){let t=no("value.ttl",{columnName:e.Enabled.ColumnName,expireTime:(0,ez.Bi)(1e3*e.Enabled.ExpireAfterSeconds,1)});return{label:no("label.ttl"),value:t}}},nh=(0,c.cn)("ydb-diagnostics-table-info"),ng=({data:e,type:t})=>{let a=(0,r.jsx)(ni,{data:e?.PathDescription}),{generalInfo:s,tableStatsInfo:i,tabletMetricsInfo:l=[],partitionConfigInfo:o=[]}=n.useMemo(()=>((e,t)=>{if(!e)return{};let{PathDescription:a={}}=e,{TableStats:n={},TabletMetrics:s={},Table:{PartitionConfig:i={},TTLSettings:l}={},ColumnTableDescription:o={}}=a,{PartCount:c,RowCount:d,DataSize:u,IndexSize:p,ByKeyFilterSize:m,LastAccessTime:h,LastUpdateTime:g,ImmediateTxCompleted:x,PlannedTxCompleted:y,TxRejectedByOverload:f,TxRejectedBySpace:b,TxCompleteLagMsec:v,InFlightTxCount:j,RowUpdates:T,RowDeletes:w,RowReads:S,RangeReads:E,RangeReadRows:_}=n,{FollowerGroups:N,FollowerCount:C,CrossDataCenterFollowerCount:P}=i,I=[];switch(t){case"EPathTypeTable":I=((e,t)=>{let{PartitioningPolicy:a={},FollowerGroups:r,EnableFilterByKey:n}=e,s=[],i=a.SizeToSplit&&Number(a.SizeToSplit)>0?no("value.partitioning-by-size.enabled",{size:(0,Q.z3)(a.SizeToSplit)}):no("disabled"),l=a.SplitByLoadSettings?.Enabled?no("enabled"):no("disabled");if(s.push({label:no("label.partitioning-by-size"),value:i},{label:no("label.partitioning-by-load"),value:l},{label:no("label.partitions-min"),value:(0,Q.ZV)(a.MinPartitionsCount||0)}),a.MaxPartitionsCount&&s.push({label:no("label.partitions-max"),value:(0,Q.ZV)(a.MaxPartitionsCount)}),r&&r.length){let e,{RequireAllDataCenters:t,FollowerCountPerDataCenter:a,FollowerCount:n}=r[0];e=t&&a?`PER_AZ: ${n}`:`ANY_AZ: ${n}`,s.push({label:no("label.read-replicas"),value:e})}if(t){let e=nm(t);e&&s.push(e)}return(0,nu.f8)(n)&&s.push({label:no("label.bloom-filter"),value:n?no("enabled"):no("disabled")}),s})(i,l);break;case"EPathTypeColumnTable":I=function(e){let t=[];if(t.push({label:no("label.standalone"),value:String(!(e.SchemaPresetName&&void 0!==e.SchemaPresetId))}),e.Sharding?.HashSharding?.Columns){let a=e.Sharding.HashSharding.Columns.join(", "),n=`PARTITION BY HASH(${a})`;t.push({label:no("label.partitioning"),value:(0,r.jsx)(eA.E,{variant:"code-2",wordBreak:"break-word",children:n})})}if(e.TtlSettings){let a=nm(e?.TtlSettings);a&&t.push(a)}return t}(o)}let A=(0,ro.jl)(r_,{PartCount:c,RowCount:d,DataSize:u,IndexSize:p});(0,np.kf)(m)&&(i.EnableFilterByKey||Number(m)>0)&&A.push({label:"BloomFilterSize",value:rx(m)});let D=[A,(0,ro.jl)(r_,{LastAccessTime:h,LastUpdateTime:g}),(0,ro.jl)(r_,{ImmediateTxCompleted:x,PlannedTxCompleted:y,TxRejectedByOverload:f,TxRejectedBySpace:b,TxCompleteLagMsec:v,InFlightTxCount:j}),(0,ro.jl)(r_,{RowUpdates:T,RowDeletes:w,RowReads:S,RangeReads:E,RangeReadRows:_})],R=(0,ro.jl)(rw,nd()(s,["GroupReadIops","GroupReadThroughput","GroupWriteIops","GroupWriteThroughput"])),k=[];return Array.isArray(N)&&N.length>0?k=(0,ro.jl)(rS,N[0]):void 0!==C?k.push(rE("FollowerCount",C)):void 0!==P&&k.push(rE("CrossDataCenterFollowerCount",P)),{generalInfo:I,tableStatsInfo:D,tabletMetricsInfo:R,partitionConfigInfo:k}})(e,t),[e,t]);return(0,r.jsxs)("div",{className:nh(),children:[(0,r.jsx)(ro.z_,{info:s,title:a,className:nh("info-block"),renderEmptyState:()=>(0,r.jsx)("div",{className:nh("title"),children:a})}),(0,r.jsxs)("div",{className:nh("row"),children:[i?(0,r.jsx)("div",{className:nh("col"),children:i.map((e,t)=>(0,r.jsx)(ro.z_,{info:e,title:0===t?no("tableStats"):void 0,className:nh("info-block"),renderEmptyState:()=>null},t))}):null,l.length>0||o.length>0?(0,r.jsxs)("div",{className:nh("col"),children:[(0,r.jsx)(ro.z_,{info:l,title:no("tabletMetrics"),className:nh("info-block"),renderEmptyState:()=>null}),(0,r.jsx)(ro.z_,{info:o,title:no("partitionConfig"),className:nh("info-block"),renderEmptyState:()=>null})]}):null]})]})},nx=({data:e,path:t,database:a,databaseFullPath:n})=>{let s=rc(e?.PathDescription);return e?(0,r.jsxs)("div",{children:[(0,r.jsx)(ro.z_,{title:s,info:(e=>{let t=e?.PathDescription?.PersQueueGroup;if(!t)return[];let{Partitions:a=[],PQTabletConfig:r={PartitionConfig:{LifetimeSeconds:0}}}=t,{Codecs:n,MeteringMode:s}=r,{WriteSpeedInBytesPerSecond:i,StorageLimitBytes:l}=r.PartitionConfig;return[...(0,ro.jl)(rb,{Partitions:a,PQTabletConfig:r}),...(0,ro.jl)(rj,{StorageLimitBytes:l,WriteSpeedInBytesPerSecond:i}),...(0,ro.jl)(rv,{Codecs:n,MeteringMode:s})]})(e)}),e.PathDescription?.Self?.PathSubType==="EPathSubTypeStreamImpl"?null:(0,r.jsx)(r7,{path:t,database:a,databaseFullPath:n})]}):(0,r.jsxs)("div",{className:"error",children:["No ",s," data"]})},ny=g.F.injectEndpoints({endpoints:e=>({getReplication:e.query({queryFn:async({path:e,database:t,databaseFullPath:a})=>{try{let r=await window.api.viewer.getReplication({path:{path:e,databaseFullPath:a},database:t});if("object"!=typeof r)return{error:{}};return{data:r}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"});function nf({connection:e}){return e?e.StaticCredentials?(0,r.jsx)(tc.J,{value:e.StaticCredentials.User,theme:"normal",children:"user"}):"OAuthToken"in e?void 0!==e.OAuthToken&&("Token"in e.OAuthToken||"TokenSecretName"in e.OAuthToken)?"OAuth":"":"unknown":null}var nb=JSON.parse('{"credentials.label":"Credentials","noData":"No data for entity:","srcConnection.database.label":"Source Database Path","srcConnection.endpoint.label":"Source Cluster Endpoint","state.label":"State","state.error":"Error","srcPath.label":"Source Topic","dstPath.label":"Destination Table","transformLambda.label":"Transformation Lambda"}');let nv=(0,ex.g4)("ydb-diagnostics-transfer-info",{en:nb});function nj({path:e,database:t,data:a,databaseFullPath:n}){let s=rc(a?.PathDescription);if(!a)return(0,r.jsxs)("div",{className:"error",children:[nv("noData")," ",s]});let{data:i}=ny.useGetReplicationQuery({path:e,database:t,databaseFullPath:n},{}),l=function(e,t){let a=e.PathDescription?.ReplicationDescription||{},n=a.Config?.SrcConnectionParams||{},{Endpoint:s,Database:i}=n,l=a.Config?.TransferSpecific?.Target,o=l?.SrcPath,c=l?.DstPath,d=l?.TransformLambda,u=[];return t&&u.push({name:nv("state.label"),content:t?"running"in t?(0,r.jsx)(tc.J,{theme:"info",children:"Running"}):"paused"in t?(0,r.jsx)(tc.J,{theme:"info",children:"Paused"}):"done"in t?(0,r.jsx)(tc.J,{theme:"success",children:"Done"}):"error"in t?(0,r.jsx)(tc.J,{theme:"danger",children:"Error"}):(0,r.jsx)(tc.J,{size:"s",children:"Unknown"}):null}),t?.error?.issues&&t.error.issues[0]?.message&&u.push({name:nv("state.error"),copyText:t.error.issues[0].message,content:(0,r.jsx)(eA.E,{variant:"code-inline-2",color:"danger",children:t.error.issues[0].message})}),s&&u.push({name:nv("srcConnection.endpoint.label"),copyText:s,content:(0,r.jsx)(eA.E,{variant:"code-inline-2",children:s})}),i&&u.push({name:nv("srcConnection.database.label"),copyText:i,content:(0,r.jsx)(eA.E,{variant:"code-inline-2",children:i})}),n&&u.push({name:nv("credentials.label"),content:(0,r.jsx)(nf,{connection:n})}),u.push({name:nv("srcPath.label"),copyText:o,content:(0,r.jsx)(eA.E,{variant:"code-inline-2",children:o})}),u.push({name:nv("dstPath.label"),copyText:c,content:(0,r.jsx)(eA.E,{variant:"code-inline-2",children:c})}),u.push({name:nv("transformLambda.label"),copyText:d,content:d?(0,r.jsx)(rH.YDBSyntaxHighlighter,{language:"yql",text:d}):null}),u}(a,i);return(0,r.jsx)(eD.s,{direction:"column",gap:"4",children:(0,r.jsx)(rI.n,{title:s,items:l})})}let nT=function({type:e,path:t,database:a,databaseFullPath:s}){let i,[l]=(0,j.Nt)(),{currentData:o,isFetching:c,error:d}=x.useGetOverviewQuery({path:t,database:a,databaseFullPath:s},{pollingInterval:l,skip:"EPathTypeStreamingQuery"===e});return c&&void 0===o?(0,r.jsx)(L.a,{size:"m"}):(0,r.jsxs)(n.Fragment,{children:[d?(0,r.jsx)(q.o,{error:d}):null,d&&!o?null:(i=o??void 0,e&&({EPathTypeInvalid:void 0,EPathTypeDir:void 0,EPathTypeResourcePool:void 0,EPathTypeTable:void 0,EPathTypeSysView:()=>(0,r.jsx)(rG,{data:i}),EPathTypeSubDomain:void 0,EPathTypeTableIndex:()=>(0,r.jsx)(rP,{data:i}),EPathTypeExtSubDomain:void 0,EPathTypeColumnStore:void 0,EPathTypeColumnTable:void 0,EPathTypeCdcStream:()=>(0,r.jsx)(r8,{path:t,database:a,databaseFullPath:s,data:i}),EPathTypePersQueueGroup:()=>(0,r.jsx)(nx,{data:i,path:t,databaseFullPath:s,database:a}),EPathTypeExternalTable:()=>(0,r.jsx)(rU,{data:i}),EPathTypeExternalDataSource:()=>(0,r.jsx)(rq,{data:i}),EPathTypeView:()=>(0,r.jsx)(rB,{data:i}),EPathTypeReplication:()=>(0,r.jsx)(r2,{data:i}),EPathTypeTransfer:()=>(0,r.jsx)(nj,{path:t,databaseFullPath:s,database:a,data:i}),EPathTypeStreamingQuery:()=>(0,r.jsx)(nr,{path:t,database:a})})[e]?.()||(0,r.jsx)(ng,{data:i,type:e}))]})};var nw=a(63478),nS=a(93397),nE=a(25711),n_=a(33691),nN=a(27088),nC=JSON.parse('{"title_queries-activity":"Queries Activity","context_monitor-changes-realtime":"Monitor changes in real time","value_per-sec":"{{count}} per sec","value_ms":"{{time}} ms","field_running-queries":"Running Queries","field_applications":"Applications","field_users":"Users","action_open-running-queries":"Open Running Queries"}');let nP="ydb-queries-activity-bar";ex.Ru.registerKeyset(ex.JA.En,nP,nC);let nI=ex.Ru.keyset(nP),nA=(0,c.cn)("queries-activity-alert");function nD({runningQueriesCount:e,uniqueApplications:t,uniqueUsers:a}){let n=(0,rL.W6)(),s=(0,rL.zy)();return(0,r.jsx)("div",{className:nA(),children:(0,r.jsx)(tY.Z,{className:nA("card"),type:"container",view:"outlined",children:(0,r.jsxs)(eD.s,{direction:"row",justifyContent:"space-between",alignItems:"center",gap:4,className:nA("content"),children:[(0,r.jsx)(eD.s,{children:(0,r.jsx)(eA.E,{variant:"subheader-2",className:nA("title"),children:nI("title_queries-activity")})}),(0,r.jsxs)(eD.s,{wrap:!0,alignItems:"center",gap:1,className:nA("stats"),children:[(0,r.jsx)(tc.J,{theme:e>0?"success":"unknown",icon:(0,r.jsx)(ek.I,{data:nE.A}),size:"s",value:String(e),children:nI("field_running-queries")}),(0,r.jsx)(tc.J,{theme:"unknown",icon:(0,r.jsx)(ek.I,{data:n_.A}),size:"s",value:String(t),children:nI("field_applications")}),(0,r.jsx)(tc.J,{theme:"unknown",icon:(0,r.jsx)(ek.I,{data:nN.A}),size:"s",value:String(a),children:nI("field_users")}),e>0&&(0,r.jsx)(tM.$,{view:"outlined",size:"s",onClick:()=>{let e=(0,B.mA)(s),t=(0,B.YL)({...e,[aL.vh.diagnosticsTab]:E.iJ.topQueries,queryMode:"running"});n.push(t)},className:nA("open-queries-button"),children:nI("action_open-running-queries")})]})]})})})}var nR=a(86889),nk=a(66247),nM=a(94866),nO=JSON.parse('{"action_open-monitoring":"Monitoring","top-nodes.empty-data":"No such nodes","title_top-nodes-load":"Top nodes by load","title_top-nodes-pool":"Top nodes by pools usage","cards.cpu-label":"CPU load","cards.storage-label":"Storage","cards.memory-label":"Memory used","cards.network-label":"Network","cards.network-note":"Network throughput is the average outgoing bandwidth usage across all nodes in the database","context_cpu-load":"CPU load","context_storage-groups":"Storage: {{count}} groups","context_memory-used":"Memory used","context_network-usage":"Network usage","context_cpu-description":"CPU load is calculated as the cumulative usage across all actor system pools in the database","context_memory-description":"Memory usage is the total memory consumed by all processes in the database","context_storage-description":"Storage usage shows how much data is stored in the database including user data and indexes","context_network-description":"Network throughput is the average outgoing bandwidth usage across all nodes in the database","charts.queries-per-second":"Queries per second","charts.queries-latency":"Queries latencies {{percentile}}","charts.cpu-usage":"CPU usage by pool","charts.storage-usage":"Tablet storage usage","charts.memory-usage":"Memory usage","charts.network-utilization":"Network utilization","title_storage-details":"Storage Details","storage.tablet-storage-title":"Tablet storage","storage.tablet-storage-description":"Size of user data and indexes stored in schema objects (tables, topics, etc.)","storage.db-storage-title":"Database storage","storage.db-storage-description":"Size of data stored in distributed storage with all overheads for redundancy","title_top-shards":"Top shards by CPU usage","title_top-queries":"Top queries by CPU usage","title_top-tables-by-size":"Top tables by size","title_top-groups-by-usage":"Top groups by usage","title_top-nodes-by-memory":"Top nodes by memory","title_nodes-by-ping":"Top nodes by ping time","title_nodes-by-skew":"Top nodes by clock skew","title_memory-details":"Memory Details","field_memory-usage":"Memory usage","context_capacity-usage":"{{value}} of {{capacity}}","title_network-stats-unavailable":"Network Statistics Unavailable","context_network-stats-unavailable":"Network ping and clock skew statistics require a newer backend version. Please upgrade your YDB installation to access these features.","value_serverless":"Serverless","context_serverless-tooltip":"Some metrics are hidden in Serverless mode — resources scale automatically based on workload","context_serverless-autoscaled":"Auto-Scaled Resources","context_serverless-storage-subtitle":"{{legend}} | {{groups}} groups"}');let nq=(0,ex.g4)("ydb-diagnostics-tenant-overview",{en:nO}),nL=[{title:nq("charts.queries-per-second"),metrics:[{target:"queries.requests",title:nq("charts.queries-per-second")}]},{title:nq("charts.queries-latency",{percentile:""}),metrics:[{target:"queries.latencies.p50",title:"p50"},{target:"queries.latencies.p75",title:"p75"},{target:"queries.latencies.p90",title:"p90"},{target:"queries.latencies.p99",title:"p99"}],options:{dataType:"ms",showLegend:!0}}];var nz=a(41388),nF=a(76056),nQ=a(73493),nU=a(88786),n$=a(97547);let nG={"30m":30*v.r0,"1h":v.Jg,"1d":v.tt,"1w":7*v.tt};var nH=JSON.parse('{"value_30m":"Last 30 min","value_1h":"Last hour","value_1d":"Last day","value_1w":"Last week"}');let nB=(0,ex.g4)("ydb-timeframe-dropdown",{en:nH}),nW=e=>{switch(e){case"30m":return nB("value_30m");case"1h":return nB("value_1h");case"1d":return nB("value_1d");case"1w":return nB("value_1w");default:return e}},nV=(0,c.cn)("ydb-timeframe-dropdown"),nJ=({value:e,onChange:t,className:a,size:s="s",view:i="flat-secondary"})=>{let l=n.useMemo(()=>Object.keys(nG).map(e=>({text:nW(e),action:()=>t(e)})),[t]);return(0,r.jsx)(n$.r,{renderSwitcher:t=>(0,r.jsxs)(tM.$,{...t,size:s,view:i,className:nV(null,a),children:[nW(e),(0,r.jsx)(ek.I,{data:nU.A,size:12})]}),items:l,popupProps:{placement:"bottom-start"}})};var nY=a(83640);let nK=["#7EB26D","#EAB839","#6ED0E0","#EF843C","#E24D42","#1F78C1","#BA43A9","#705DA0","#508642","#CCA300"];function nZ(e){return null===e?v.Pd:(0,ez.Xo)((0,Q.CR)((0,np.y3)(e),2))}function nX(e){return null===e?v.Pd:(0,af.z3)({value:(0,np.y3)(e),precision:3})}function n0(e){return null===e?v.Pd:Math.round(100*(0,np.y3)(e))+"%"}let n1=async({database:e,metrics:t,timeFrame:a,maxDataPoints:r},{signal:n}={})=>{let s=t.map(e=>`target=${e.target}`).join("&"),i=Math.round(Date.now()/1e3),l=i-nG[a];return window.api.viewer.getChartData({target:s,from:l,until:i,maxDataPoints:r,database:e},{signal:n})};var n2=JSON.parse('{"not-supported":"Charts are not supported on current ydb version"}');let n3=(0,ex.g4)("ydb-metric-chart",{en:n2}),n4=g.F.injectEndpoints({endpoints:e=>({getChartData:e.query({queryFn:async(e,{signal:t})=>{try{let a=await n1(e,{signal:t});if(Array.isArray(a))return{data:((e=[],t)=>{let a=e.map(({datapoints:e,target:a})=>{let r=t.find(e=>e.target===a);if(!r)return;let n=e.map(e=>e[0]);return{...r,data:n}}).filter(e=>void 0!==e);return{timeline:e[0].datapoints.map(e=>1e3*e[1]),metrics:a}})(a,e.metrics)};return{error:Error("string"==typeof a?n3("not-supported"):a.error)}}catch(e){return{error:e}}},providesTags:["All"],keepUnusedDataFor:0})}),overrideExisting:"throw"}),n5=(0,c.cn)("ydb-metric-chart");nz.W.set({plugins:[nQ.z]});let n6={timeline:[],metrics:[]},n7=({database:e,metrics:t,defaultTimeFrame:a="1h",autorefresh:s,width:i=400,height:l=i/1.5,chartOptions:o,onChartDataStatusChange:c,isChartVisible:d,title:u})=>{let[p,m]=n.useState(a),{currentData:h,error:g,isFetching:x,status:y}=n4.useGetChartDataQuery({database:e,metrics:t,timeFrame:p,maxDataPoints:300},{pollingInterval:s}),f=x&&!h;n.useEffect(()=>c?.("fulfilled"===y?"success":"loading"),[y,c]);let b=((e,t={})=>{let{dataType:a,scaleRange:r,showLegend:n}=t,s=(e=>{switch(e){case"ms":return nZ;case"size":return nX;case"percent":return n0;default:return}})(a),i=!e.metrics.length,l=e.metrics.map((e,t)=>{let a=e.color||nK[t],r=function(e,t){let a=(0,nY.Mj)(e);if(!a.isValid())throw Error("Invalid color is passed");return a.alpha(.1).toRgbString()}(a,0);return{id:e.target,name:e.title||e.target,data:e.data,formatter:s,lineColor:a,color:r,legendColorKey:"lineColor"}});return{data:{timeline:e.timeline,graphs:l},libraryConfig:{chart:{size:{padding:i?[10,0,10,0]:void 0},series:{type:"area",spanGaps:!0,lineWidth:1.5},select:{zoom:!1}},scales:{y:{type:"linear",range:"nice",min:r?.min||0,max:r?.max}},axes:{y:{values:s?(e,t)=>t.map(s):void 0}},tooltip:{show:!0,tracking:"sticky"},legend:{show:n}}}})(h||n6,o);return(0,r.jsxs)("div",{className:n5(),style:{height:l},children:[(0,r.jsxs)(eD.s,{className:n5("toolbar"),justifyContent:"space-between",alignItems:"center",children:[(0,r.jsx)("div",{children:u}),(0,r.jsx)(nJ,{value:p,onChange:m})]}),f?(0,r.jsx)(L.a,{}):d?(0,r.jsxs)("div",{className:n5("chart"),children:[(0,r.jsx)(nF.Ay,{type:"yagr",data:b}),g?(0,r.jsx)(q.o,{className:n5("error"),error:g}):null]}):null]})},n8=(0,c.cn)("queries-activity-bar");function n9({database:e,expanded:t,onChartDataStatusChange:a}){let[s]=(0,j.Nt)(),[i,l]=n.useState(!1),o=e=>nL.find(t=>t.metrics.some(t=>t.target===e)),c=o("queries.requests"),d=o("queries.latencies.p99"),u=i?s:0,p=n.useCallback(e=>{"success"===e&&l(!0),a?.(e)},[a]);return c&&d?(0,r.jsxs)(eD.s,{className:n8("charts"),gap:4,direction:"row",style:{display:t?void 0:"none"},children:[(0,r.jsx)(eD.s,{direction:"column",gap:3,grow:!0,basis:0,minWidth:0,children:(0,r.jsx)(n7,{database:e,metrics:c.metrics,autorefresh:u,height:292,chartOptions:c.options,onChartDataStatusChange:p,isChartVisible:i&&t,title:c.title})}),(0,r.jsx)(eD.s,{direction:"column",gap:3,grow:!0,basis:0,minWidth:0,children:(0,r.jsx)(n7,{database:e,metrics:d.metrics,autorefresh:u,height:326.5,chartOptions:d.options,onChartDataStatusChange:p,isChartVisible:i&&t,title:d.title})})]}):(console.warn("Required chart configurations not found in defaultDashboardConfig"),null)}let se=e=>e>=1?`+${e.toFixed(0)}`:e>0?`+${e.toFixed(1)}`:e.toFixed(1),st=(0,c.cn)("queries-activity-bar");function sa({database:e,runningQueriesCount:t,uniqueApplications:a,uniqueUsers:s,qps:i,latency:l}){let o=(0,rL.W6)(),c=(0,rL.zy)(),[d,u]=n.useState(!1);return(0,r.jsx)("div",{className:st({expanded:d}),children:(0,r.jsxs)(tY.Z,{className:st("card"),type:"container",view:d?"outlined":"raised",children:[(0,r.jsxs)(eD.s,{className:st("header"),onClick:()=>{u(!d)},justifyContent:"space-between",alignItems:"center",gap:3,children:[(0,r.jsxs)(eD.s,{direction:"column",children:[(0,r.jsx)(eA.E,{variant:"subheader-2",className:st("title"),children:nI("title_queries-activity")}),(0,r.jsx)(eA.E,{color:"secondary",variant:"caption-2",className:st("subtitle"),children:nI("context_monitor-changes-realtime")})]}),(0,r.jsxs)(eD.s,{alignItems:"center",gap:4,children:[(0,r.jsxs)(eD.s,{alignItems:"center",gap:1,children:[(0,r.jsx)(tc.J,{theme:t>0?"success":"unknown",size:"s",icon:(0,r.jsx)(ek.I,{data:nE.A,size:14}),children:t}),(0,r.jsx)(tc.J,{theme:"unknown",icon:(0,r.jsx)(ek.I,{data:nR.A}),size:"s",value:se(i?.trend?.value??0),children:nI("value_per-sec",{count:i?.value??"0"})}),(0,r.jsx)(tc.J,{theme:"unknown",icon:(0,r.jsx)(ek.I,{data:nk.A}),size:"s",value:se(l?.trend?.value??0),children:nI("value_ms",{time:l?.value??"0"})})]}),(0,r.jsx)(nM.I,{direction:d?"top":"bottom",size:16})]})]}),d&&(0,r.jsx)(eD.s,{direction:"column",gap:4,className:st("content"),children:(0,r.jsxs)(eD.s,{wrap:!0,alignItems:"center",gap:1,className:st("stats"),children:[(0,r.jsx)(tc.J,{theme:"unknown",icon:(0,r.jsx)(ek.I,{data:nE.A}),size:"s",value:String(t),children:nI("field_running-queries")}),(0,r.jsx)(tc.J,{theme:"unknown",icon:(0,r.jsx)(ek.I,{data:n_.A}),size:"s",value:String(a),children:nI("field_applications")}),(0,r.jsx)(tc.J,{theme:"unknown",icon:(0,r.jsx)(ek.I,{data:nN.A}),size:"s",value:String(s),children:nI("field_users")}),t>0&&(0,r.jsx)(tM.$,{view:"outlined",size:"s",onClick:()=>{let e=(0,B.mA)(c),t=(0,B.YL)({...e,[aL.vh.diagnosticsTab]:E.iJ.topQueries,queryMode:"running"});o.push(t)},className:st("open-queries-button"),children:nI("action_open-running-queries")})]})}),(0,r.jsx)(n9,{database:e,expanded:d})]})})}var sr=a(86268);let sn=(0,c.cn)("queries-activity-skeleton");function ss(){return(0,r.jsx)(sr.E,{className:sn("skeleton")})}var si=a(87693),sl=a(39212),so=a(3715);function sc({database:e}){let{runningQueriesCount:t,uniqueApplications:a,uniqueUsers:s,qps:i,latency:l,areChartsAvailable:o}=function(e){let[t]=(0,j.Nt)(),a=!1===(0,so.N)(t=>(0,si.TH)(t,e)),{data:r}=sl.Ke.useGetRunningQueriesQuery({database:e,filters:{}},{pollingInterval:t}),{data:s,isSuccess:i,isError:l}=n4.useGetChartDataQuery({database:e,metrics:[{target:"queries.requests"}],timeFrame:"1h",maxDataPoints:30},{pollingInterval:t,skip:a}),{data:o}=n4.useGetChartDataQuery({database:e,metrics:[{target:"queries.latencies.p99"}],timeFrame:"1h",maxDataPoints:30},{pollingInterval:t,skip:a}),c=r?.resultSets?.[0]?.result?.length||0,d=n.useMemo(()=>!a&&(!!i||!l&&null),[i,l,a]),u=n.useMemo(()=>(e=>{let t;if(!e||0===e.length)return{value:"0",trend:{value:1e-6,direction:"up"}};let a=e[e.length-1]??1e-6,r=e.length>=2?e[e.length-2]??1e-6:1e-6;if(r>0){let e=a-r;t={value:Math.abs(e),direction:e>=0?"up":"down"}}else t={value:1e-6,direction:"up"};return{value:a.toFixed(0),trend:t}})(s?.metrics?.[0]?.data),[s?.metrics?.[0]?.data]),p=n.useMemo(()=>(e=>{let t;if(!e||0===e.length)return{value:"0.0",trend:{value:1e-6,direction:"up"}};let a=e[e.length-1]??1e-6,r=e.length>=2?e[e.length-2]??1e-6:1e-6;if(r>0){let e=a-r;t={value:Math.abs(e),direction:e>=0?"up":"down"}}else t={value:1e-6,direction:"up"};return{value:a.toFixed(1),trend:t}})(o?.metrics?.[0]?.data),[o?.metrics?.[0]?.data]);return{runningQueriesCount:c,uniqueApplications:n.useMemo(()=>{let e=new Set;return r?.resultSets?.[0]?.result?.forEach(t=>{t.ApplicationName&&e.add(String(t.ApplicationName))}),e.size},[r]),uniqueUsers:n.useMemo(()=>{let e=new Set;return r?.resultSets?.[0]?.result?.forEach(t=>{t.UserSID&&e.add(String(t.UserSID))}),e.size},[r]),qps:u,latency:p,areChartsAvailable:d}}(e);return null===o?(0,r.jsx)(ss,{}):!1===o?(0,r.jsx)(nD,{runningQueriesCount:t,uniqueApplications:a,uniqueUsers:s}):(0,r.jsx)(sa,{database:e,runningQueriesCount:t,uniqueApplications:a,uniqueUsers:s,qps:i,latency:l})}var sd=a(88367),su=a(79121),sp=a(81709),sm=a(87873),sh=a(3996),sg=a(2837);let sx=eG.z.nativeEnum(E.Dg),sy=["query","diagnostics"],sf={query:sm.A,diagnostics:sh.A};function sb(){let[{tenantPage:e},t]=(0,e$.useQueryParams)({tenantPage:e$.StringParam}),[a,r]=(0,j.iK)(sg.GS.TENANT_INITIAL_PAGE),s=n.useCallback(e=>{t({tenantPage:e}),r(e)},[r,t]),i=n.useMemo(()=>sx.catch(sg.cL[sg.GS.TENANT_INITIAL_PAGE]).parse(a),[a]),l=n.useMemo(()=>sx.catch(i).parse(e),[e,i]);return n.useEffect(()=>{try{let t=sx.parse(e);t!==i&&r(t)}catch{t({tenantPage:i},"replaceIn")}},[e,i,t,r]),{tenantPage:l,handleTenantPageChange:s}}var sv=a(95146),sj=a(40897);let sT={UNSPECIFIED:sj.m.Grey,GREY:sj.m.Grey,GREEN:sj.m.Green,BLUE:sj.m.Blue,YELLOW:sj.m.Yellow,ORANGE:sj.m.Orange,RED:sj.m.Red},sw=g.F.injectEndpoints({endpoints:e=>({getHealthcheckInfo:e.query({queryFn:async({database:e,maxLevel:t},{signal:a})=>{try{return{data:await window.api.viewer.getHealthcheckInfo({database:e,maxLevel:t},{signal:a})}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"}),sS={RED:0,ORANGE:1,YELLOW:2,BLUE:3,GREEN:4},sE=e=>e.sort((e,t)=>(e.status&&sS[e.status]||0)-(t.status&&sS[t.status]||0)),s_=(0,tO.Mz)(e=>e,e=>sw.endpoints.getHealthcheckInfo.select({database:e})),sN=(0,tO.Mz)(e=>e,(e,t)=>s_(t),(e,t)=>t(e).data?.self_check_result),sC=(0,tO.Mz)(e=>e,(e,t)=>s_(t),(e,t)=>t(e).data?.issue_log||[]),sP=(0,tO.Mz)(sC,(e=[])=>sE(e.filter(t=>!e.find(e=>e.reason&&-1!==e.reason.indexOf(t.id))))),sI=(0,tO.Mz)([sC,sP],(e=[],t=[])=>t.map(t=>sE(function(e,t){let a=[];if(!t.reason||0===t.reason.length)return[t];for(let r of t.reason){let t=e.find(e=>e.id===r);if(!t)continue;let n=[t],s=t.type;for(;n.length>0;){let t=n.pop();if(!t.reason||0===t.reason.length){a.push(t);continue}for(let a of t.reason){let r=e.find(e=>e.id===a);if(!r)continue;let i={...r,parent:t,firstParentType:s};n.push(i)}}}return a}(e,t))).flat()),sA=(0,tO.Mz)(e=>e,(e,t)=>s_(t),(e,t)=>t(e).data);var sD=a(30240),sR=a(83544),sk=a(63584),sM=a(17453),sO=a(75561);let sq={UNSPECIFIED:"",GOOD:e0("description_ok"),DEGRADED:e0("description_degraded"),MAINTENANCE_REQUIRED:e0("description_maintenance"),EMERGENCY:e0("description_emergency")},sL={UNSPECIFIED:sD.A,GOOD:sR.A,DEGRADED:sk.A,MAINTENANCE_REQUIRED:sM.A,EMERGENCY:sO.A};var sz=JSON.parse('{"description_problems":["There is {{count}} issue.","There are {{count}} issues.","There are {{count}} issues.","There are {{count}} issues."],"action_review-issues":"Review issues","description_no-data":"No healthcheck data"}');let sF=(0,ex.g4)("ydb-diagnostics-healthcheck",{en:sz}),sQ=(0,c.cn)("ydb-healthcheck-preview"),sU={UNSPECIFIED:"normal",GOOD:"success",DEGRADED:"info",MAINTENANCE_REQUIRED:"warning",EMERGENCY:"danger"};function s$(e){let{database:t}=e,[a]=(0,j.Nt)(),{handleShowHealthcheckChange:n}=tW(),{currentData:s,isFetching:i,error:l}=sw.useGetHealthcheckInfoQuery({database:t},{pollingInterval:a}),o=i&&void 0===s,c=s?.self_check_result||"UNSPECIFIED",d=c.toLowerCase();if(o)return(0,r.jsx)(sr.E,{className:sQ("skeleton")});let u=s?.issue_log?.filter(e=>!e.reason).length,p=u?sF("description_problems",{count:u}):"";return"GOOD"!==c||u||o?(0,r.jsx)(sv.F,{className:sQ(),theme:sU[c],view:l?"outlined":"filled",message:l?(0,r.jsx)(q.o,{error:l,defaultMessage:sF("description_no-data")}):(0,r.jsxs)(eD.s,{gap:1,alignItems:"center",justifyContent:"space-between",className:sQ("alert-message"),children:[(0,r.jsxs)(eD.s,{gap:1,alignItems:"center",children:[sq[c],p?` ${p}`:""]}),u&&(0,r.jsx)(tM.$,{onClick:()=>{n(!0)},children:sF("action_review-issues")})]}),icon:(0,r.jsx)(ek.I,{size:18,data:sL[c],className:sQ("icon",{[d]:!0})})}):null}a(36966);var sG=a(5577);let sH=(e=[])=>{let t=Number(e.reduce((e,t)=>e+(t.used||0),0).toFixed(2)),a=Number(e.reduce((e,t)=>e+(t.limit||0),0).toFixed(2)),r=a>0?t/a*100:0,n=(0,sG.w)({fillWidth:r,colorizeProgress:!0});return{totalUsed:t,totalLimit:a,usagePercent:r,status:n}};var sB=a(54625),sW=a(9471),sV=a(96945);let sJ=(0,c.cn)("tenant-tab-card");function sY({text:e,active:t,helpText:a,subtitle:n}){return(0,r.jsx)("div",{className:sJ({active:t}),children:(0,r.jsx)(tY.Z,{className:sJ("card-container",{active:t}),type:"container",view:t?"outlined":"raised",children:(0,r.jsxs)("div",{className:sJ("legend-wrapper"),children:[(0,r.jsx)(sV.e.Legend,{variant:"subheader-2",note:a,noteIconSize:"s",children:e}),n?(0,r.jsx)(sV.e.Legend,{variant:"body-1",color:"secondary",children:n}):null]})})})}var sK=a(47635);let sZ=(0,c.cn)("tenant-tab-card");function sX({active:e,children:t}){return(0,r.jsx)("div",{className:sZ({active:e}),children:(0,r.jsx)(tY.Z,{className:sZ("card-container",{active:e}),type:"container",view:e?"outlined":"raised",children:t})})}function s0({text:e,value:t,limit:a,helpText:s,legendFormatter:i,active:l}){let{status:o,percents:c,legend:d,fill:u}=n.useMemo(()=>(0,sK.s)({value:t,capacity:a,legendFormatter:i}),[t,a,i]);return(0,r.jsx)(sX,{active:l,children:(0,r.jsxs)(eD.s,{gap:3,alignItems:"center",children:[(0,r.jsx)(sV.e,{size:"small",status:o,fillWidth:u,className:sZ("doughnut"),children:(0,r.jsx)(sV.e.Value,{variant:"subheader-1",children:c})}),(0,r.jsxs)("div",{className:sZ("legend-wrapper"),children:[(0,r.jsx)(sV.e.Legend,{variant:"subheader-2",children:d}),(0,r.jsx)(sV.e.Legend,{variant:"body-1",color:"secondary",note:s,noteIconSize:"s",children:e})]})]})})}let s1=(0,c.cn)("tenant-metrics-tabs");function s2({to:e,active:t,isServerless:a,cpu:n}){return(0,r.jsx)("div",{className:s1("link-container",{active:t}),children:(0,r.jsx)(sB.N_,{to:e,className:s1("link"),children:a?(0,r.jsx)(sY,{text:nq("context_cpu-load"),active:t,helpText:nq("context_cpu-description"),subtitle:nq("context_serverless-autoscaled")}):(0,r.jsx)(s0,{text:nq("context_cpu-load"),value:n.totalUsed,limit:n.totalLimit,legendFormatter:sW.vs,active:t,helpText:nq("context_cpu-description")})})})}let s3=(0,c.cn)("tenant-metrics-tabs");function s4({to:e,active:t,memory:a}){return(0,r.jsx)("div",{className:s3("link-container",{active:t}),children:(0,r.jsx)(sB.N_,{to:e,className:s3("link"),children:(0,r.jsx)(s0,{text:nq("context_memory-used"),value:a.totalUsed,limit:a.totalLimit,legendFormatter:sW.cO,active:t,helpText:nq("context_memory-description")})})})}var s5=a(89250);let s6=(0,c.cn)("tenant-tab-card");function s7({active:e,children:t}){return(0,r.jsx)("div",{className:s6({active:e}),children:(0,r.jsx)(tY.Z,{className:s6("card-container",{active:e}),type:"container",view:e?"outlined":"raised",children:t})})}function s8({text:e,fillPercent:t,helpText:a,legendText:s,active:i}){let{status:l,percents:o,fill:c}=n.useMemo(()=>(0,sK.v)({fillWidth:t}),[t]);return(0,r.jsx)(s7,{active:i,children:(0,r.jsxs)(eD.s,{gap:3,alignItems:"center",children:[(0,r.jsx)(sV.e,{size:"small",status:l,fillWidth:c,className:s6("doughnut"),children:(0,r.jsx)(sV.e.Value,{variant:"subheader-1",children:o})}),(0,r.jsxs)("div",{className:s6("legend-wrapper"),children:[(0,r.jsx)(sV.e.Legend,{variant:"subheader-2",children:s}),(0,r.jsx)(sV.e.Legend,{variant:"body-1",color:"secondary",note:a,noteIconSize:"s",children:e})]})]})})}let s9=(0,c.cn)("tenant-metrics-tabs");function ie({to:e,active:t,networkUtilization:a,networkThroughput:n}){let s=(0,s5.z)({value:n,withSpeedLabel:!0});return(0,r.jsx)("div",{className:s9("link-container",{active:t}),children:(0,r.jsx)(sB.N_,{to:e,className:s9("link"),children:(0,r.jsx)(s8,{text:nq("context_network-usage"),fillPercent:100*a,legendText:s,active:t,helpText:nq("context_network-description")})})})}let it=(0,c.cn)("tenant-metrics-tabs");function ia(){return(0,r.jsx)("div",{className:it("link-container",{placeholder:!0}),children:(0,r.jsx)("div",{className:it("link"),children:(0,r.jsx)(sY,{text:v.en,active:!1,helpText:void 0,subtitle:v.en})})})}let ir=(0,c.cn)("tenant-metrics-tabs");function is({to:e,active:t,isServerless:a,storage:n,storageGroupsCount:s}){let i=void 0===s||a?nq("cards.storage-label"):nq("context_storage-groups",{count:s});return(0,r.jsx)("div",{className:ir("link-container",{active:t}),children:(0,r.jsx)(sB.N_,{to:e,className:ir("link"),children:a?(0,r.jsx)(sY,{text:i,active:t,helpText:nq("context_storage-description"),subtitle:n.totalLimit?nq("context_serverless-storage-subtitle",{groups:String(s??0),legend:(0,sW.cO)({value:n.totalUsed,capacity:n.totalLimit})}):void 0}):(0,r.jsx)(s0,{text:i,value:n.totalUsed,limit:n.totalLimit,legendFormatter:sW.cO,active:t,helpText:nq("context_storage-description")})})})}let ii=(0,c.cn)("tenant-metrics-tabs");function il({poolsCpuStats:e,memoryStats:t,blobStorageStats:a,tabletStorageStats:s,networkUtilization:i,networkThroughput:l,storageGroupsCount:o,databaseType:c,activeTab:d}){let u=(0,rL.zy)(),p=(0,B.mA)(u),m={[E.pA.cpu]:(0,B.YL)({...p,[aL.vh.metricsTab]:E.pA.cpu}),[E.pA.storage]:(0,B.YL)({...p,[aL.vh.metricsTab]:E.pA.storage}),[E.pA.memory]:(0,B.YL)({...p,[aL.vh.metricsTab]:E.pA.memory}),[E.pA.network]:(0,B.YL)({...p,[aL.vh.metricsTab]:E.pA.network})},h=n.useMemo(()=>(e||[]).filter(e=>"Batch"!==e.name&&"IO"!==e.name),[e]),g=n.useMemo(()=>sH(h),[h]),x=n.useMemo(()=>s||a||[],[s,a]),y=n.useMemo(()=>sH(x),[x]),f=n.useMemo(()=>sH(t),[t]),[b]=(0,j.iK)(sg.GS.SHOW_NETWORK_UTILIZATION),v="Serverless"===c;return(0,r.jsxs)(eD.s,{className:ii({serverless:!!v}),alignItems:"center",children:[(0,r.jsx)(s2,{to:m[E.pA.cpu],active:d===E.pA.cpu,isServerless:!!v,cpu:{totalUsed:g.totalUsed,totalLimit:g.totalLimit}}),(0,r.jsx)(is,{to:m[E.pA.storage],active:d===E.pA.storage,isServerless:!!v,storage:{totalUsed:y.totalUsed,totalLimit:y.totalLimit},storageGroupsCount:o}),v?(0,r.jsx)(ia,{}):(0,r.jsx)(s4,{to:m[E.pA.memory],active:d===E.pA.memory,memory:{totalUsed:f.totalUsed,totalLimit:f.totalLimit}}),b&&void 0!==i&&void 0!==l&&isFinite(i)&&isFinite(l)?v?(0,r.jsx)(ia,{}):(0,r.jsx)(ie,{to:m[E.pA.network],active:d===E.pA.network,networkUtilization:i,networkThroughput:l}):null]})}let io={id:E.iJ.overview,title:"Info"},ic={id:E.iJ.schema,title:"Schema"},id={id:E.iJ.topQueries,title:"Queries"},iu={id:E.iJ.topShards,title:"Top shards"},ip={id:E.iJ.access,title:"Access"},im={id:E.iJ.backups,title:"Backups"},ih={id:E.iJ.nodes,title:"Nodes"},ig={id:E.iJ.tablets,title:"Tablets"},ix={id:E.iJ.storage,title:"Storage"},iy={id:E.iJ.network,title:"Network"},ib={id:E.iJ.describe,title:"Describe"},iv={id:E.iJ.hotKeys,title:"Hot keys"},ij={id:E.iJ.graph,title:"Graph"},iT={id:E.iJ.consumers,title:"Consumers"},iw={id:E.iJ.partitions,title:"Partitions"},iS={id:E.iJ.topicData,title:"Data"},iE={id:E.iJ.configs,title:"Configs"},i_={id:E.iJ.operations,title:"Operations"},iN={id:E.iJ.monitoring,title:"Monitoring",badge:{text:"New",theme:"normal",size:"xs"}},iC=[io,iN,id,iu,ih,ig,ix,iy,ib,iE,ip,i_,im],iP=[io,iN,id,iu,ig,ib,iE,i_],iI=[io,iu,ih,ib,ip],iA={EPathTypeInvalid:void 0,EPathTypeSubDomain:iC,EPathTypeExtSubDomain:iC,EPathTypeColumnStore:iC,EPathTypeTable:[io,ic,iu,ih,ij,ig,iv,ib,ip],EPathTypeColumnTable:[io,ic,iu,ih,ig,ib,ip],EPathTypeSysView:[io,ic,ih,ib,ip],EPathTypeDir:iI,EPathTypeTableIndex:iI,EPathTypeCdcStream:[io,iT,iw,iS,ih,ib,ip],EPathTypePersQueueGroup:[io,iT,iw,iS,ih,ig,ib,ip],EPathTypeExternalDataSource:[io,ib,ip],EPathTypeExternalTable:[io,ic,ib,ip],EPathTypeStreamingQuery:[io,ib,ip],EPathTypeView:[io,ic,ib,ip],EPathTypeReplication:[io,ig,ib,ip],EPathTypeTransfer:[io,ig,ib,ip],EPathTypeResourcePool:iI},iD={EPathSubTypeStreamImpl:[io,ih,ig,ib,ip],EPathSubTypeSyncIndexImplTable:void 0,EPathSubTypeAsyncIndexImplTable:void 0,EPathSubTypeVectorKmeansTreeIndexImplTable:void 0,EPathSubTypeFulltextIndexImplTable:void 0,EPathSubTypeEmpty:void 0},iR=()=>{let[e]=(0,e$.useQueryParams)({database:e$.StringParam,schema:e$.StringParam,backend:e$.StringParam,clusterName:e$.StringParam});return n.useCallback((t,a)=>(0,B.YL)({...e,[aL.vh.diagnosticsTab]:t,...a}),[e])};var ik=a(94084),iM=JSON.parse('{"action_see-all":"See all"}');let iO=(0,ex.g4)("ydb-see-all-button",{en:iM});function iq({to:e,className:t,onClick:a}){return(0,r.jsx)(aO.E,{className:t,to:e,onClick:a,children:(0,r.jsxs)(eD.s,{alignItems:"center",gap:1,children:[(0,r.jsx)(eA.E,{children:iO("action_see-all")}),(0,r.jsx)(ek.I,{data:ik.A,size:16})]})})}let iL=(0,c.cn)("ydb-stats-wrapper");function iz({children:e,className:t,title:a,description:n,allEntitiesLink:s,onAllEntitiesClick:i}){return(0,r.jsxs)(eD.s,{className:iL(null,t),gap:2,direction:"column",children:[(0,r.jsxs)(eD.s,{justifyContent:"space-between",wrap:"nowrap",className:iL("header"),children:[(0,r.jsxs)(eD.s,{direction:"column",children:[(0,r.jsx)(eA.E,{variant:"subheader-2",children:a}),n&&(0,r.jsx)(eA.E,{color:"secondary",children:n})]}),s&&(0,r.jsx)(iq,{to:s,onClick:i})]}),e]})}let iF=(0,c.cn)("ydb-tenant-dashboard"),iQ=({database:e,charts:t})=>{let a=(0,I.iC)(),[s,i]=n.useState(!1),l=n.useMemo(()=>!a&&!s,[a,s]),[o]=(0,j.Nt)(),c=l?0:o;if(!1===a)return null;let d=e=>{"success"===e&&i(!0)},u=1===t.length?872:428,p=428/1.5;return(0,r.jsx)("div",{className:iF(null),style:{display:l?"none":void 0},children:(0,r.jsx)("div",{className:iF("charts"),children:t.map((t,a)=>(0,r.jsx)(n7,{database:e,metrics:t.metrics,chartOptions:t.options,autorefresh:c,width:u,height:p,onChartDataStatusChange:d,isChartVisible:!l,title:t.title},a))})})};var iU=a(65943),i$=a(87669),iG=a(75043),iH=a(36712);let iB=(0,c.cn)("tenant-overview");function iW({title:e,error:t,loading:a,tableClassNameModifiers:s={},withData:i,children:l}){return(0,r.jsxs)(n.Fragment,{children:[e&&(0,r.jsx)("div",{className:iB("title"),children:e}),t?(0,r.jsx)(q.o,{error:t}):null,(0,r.jsx)("div",{className:iB("table",s),children:t&&!i?null:a?(0,r.jsx)(em.Q,{rows:v.Nz}):l})]})}function iV({database:e}){var t;let a,n,s,[i]=(0,j.Nt)(),[l,o]=(t={database:e},a={...(0,iU.Nh)(t),width:void 0},s=(n=[(0,iU.kv)(),(0,iU._E)(),a]).map(e=>e.name),[n,(0,iH.R)(s,i$.fN)]),{currentData:c,isFetching:d,error:u}=iG.s.useGetNodesQuery({tenant:e,type:"any",sort:"-CPU",limit:v.Nz,tablets:!1,fieldsRequired:o},{pollingInterval:i}),p=d&&void 0===c,m=c?.nodes||[];return(0,r.jsx)(iW,{loading:p,error:u,withData:!!c,children:(0,r.jsx)(ep.l,{columnsWidthLSKey:i$.zO,data:m,columns:l,emptyDataMessage:nq("top-nodes.empty-data"),settings:v.jp})})}function iJ({database:e}){var t;let a,n,s,[i]=(0,j.Nt)(),[l,o]=(t={database:e},a={...(0,iU.Nh)(t),width:void 0},s=(n=[(0,iU.fR)(),(0,iU._E)(),a,(0,iU.Rn)()]).map(e=>e.name),[n,(0,iH.R)(s,i$.fN)]),{currentData:c,isFetching:d,error:u}=iG.s.useGetNodesQuery({tenant:e,type:"any",sort:"-LoadAverage",limit:v.Nz,tablets:!1,fieldsRequired:o},{pollingInterval:i}),p=d&&void 0===c,m=c?.nodes||[];return(0,r.jsx)(iW,{loading:p,error:u,withData:!!c,children:(0,r.jsx)(ep.l,{columnsWidthLSKey:i$.zO,data:m,columns:l,emptyDataMessage:nq("top-nodes.empty-data"),settings:v.jp})})}var iY=a(43168),iK=a(84323),iZ=a(85889),iX=a(90132),i0=JSON.parse('{"description_copy":"Copy link to clipboard","description_copied":"Copied to clipboard"}');let i1=(0,ex.g4)("ydb-copy-link-button",{en:i0}),i2=(0,c.cn)("ydb-copy-link-button"),i3=e=>{let{size:t="m",hasTooltip:a=!0,status:n,closeDelay:s,title:i,...l}=e,o=i??i1("description_copy");return(0,r.jsx)(eR.m,{title:"success"===n?i1("description_copied"):o,disabled:!a,closeDelay:s,children:(0,r.jsx)(tM.$,{view:"flat",size:t,...l,children:(0,r.jsx)(tM.$.Icon,{className:i2("icon"),children:(0,r.jsx)(ek.I,{data:iZ.A,size:16})})})})};function i4(e){let{text:t,...a}=e,s=n.useRef(),[i,l]=n.useState(void 0),[o,c]=n.useState(!1);n.useEffect(()=>window.clearTimeout(s.current),[]);let d=n.useCallback(()=>{c(!1),l(1200),window.clearTimeout(s.current),s.current=window.setTimeout(()=>{c(!0)},1e3)},[1200]);return(0,r.jsx)(iX.$,{text:t,timeout:1200,onCopy:d,children:e=>(0,r.jsx)(i3,{...a,closeDelay:i,hasTooltip:!o,status:e})})}var i5=a(40961);function i6({container:e,children:t,disablePortal:a}){return a?(0,r.jsx)(n.Fragment,{children:t}):e?i5.createPortal(t,e):null}a(4467);let i7="drawer-width",i8=(0,c.cn)("ydb-drawer"),i9=({isVisible:e,onClose:t,children:a,drawerId:s="drawer",storageKey:i=i7,defaultWidth:l,direction:o="right",className:c,detectClickOutside:d=!1,isPercentageWidth:u,hideVeil:p=!0})=>{let[m,h]=n.useState(()=>{let e=localStorage.getItem(i);return(0,np.kf)(e)?Number(e):l}),g=n.useRef(null),{containerWidth:x,itemContainerRef:y}=(0,P.g)(),f=n.useMemo(()=>u&&x>0?Math.round(x*(m||60)/100):m||600,[x,u,m]);n.useEffect(()=>{if(!d)return;let a=a=>{!a._capturedInsideDrawer&&a.isTrusted&&e&&g.current&&!g.current.contains(a.target)&&t()};return document.addEventListener("click",a),()=>{document.removeEventListener("click",a)}},[e,t,d]);let b=y?.current;return b?(0,r.jsx)(i6,{container:b,children:(0,r.jsx)(iK.f,{onEscape:t,onVeilClick:t,hideVeil:p,className:i8("container",c),children:(0,r.jsx)(iK.D,{id:s,visible:e,resizable:!0,maxResizeWidth:x,width:u?f:m,onResize:e=>{if(u&&x>0){let t=Math.round(e/x*100);h(t),localStorage.setItem(i,t.toString())}else h(e),localStorage.setItem(i,e.toString())},direction:o,className:i8("item"),ref:d?g:void 0,children:(0,r.jsx)("div",{className:i8("click-handler"),onClickCapture:e=>{e.nativeEvent._capturedInsideDrawer=!0},children:a})})})}):null},le=({children:e,renderDrawerContent:t,isDrawerVisible:a,onCloseDrawer:s,drawerId:i,storageKey:l,defaultWidth:o,direction:c,className:d,detectClickOutside:u,isPercentageWidth:p,drawerControls:m=[],title:h,headerClassName:g,hideVeil:x})=>(n.useEffect(()=>()=>{s()},[s]),(0,r.jsxs)(n.Fragment,{children:[e,(0,r.jsx)(i9,{hideVeil:x,isVisible:a,onClose:s,drawerId:i,storageKey:l,defaultWidth:o,direction:c,className:d,detectClickOutside:u,isPercentageWidth:p,children:a?(0,r.jsxs)("div",{className:i8("content-wrapper"),children:[(()=>{let e=[];for(let t of m)switch(t.type){case"close":e.push((0,r.jsx)(eR.m,{title:"Close",children:(0,r.jsx)(tM.$,{view:"flat",onClick:s,children:(0,r.jsx)(ek.I,{data:iY.A,size:16})})},"close"));break;case"copyLink":e.push((0,r.jsx)(i4,{text:t.link},"copyLink"));break;case"custom":e.push((0,r.jsx)(n.Fragment,{children:t.node},t.key))}return(0,r.jsxs)(eD.s,{justifyContent:"space-between",alignItems:"center",className:i8("header-wrapper",g),children:[(0,r.jsx)(eA.E,{variant:"subheader-2",children:h}),(0,r.jsx)(eD.s,{className:i8("controls"),children:e})]})})(),t()]}):null})]}));var lt=a(33771),la=a(52566),lr=a.n(la);let ln=e=>(lr().str(e)>>>0).toString(16).toUpperCase().padStart(8,"0"),ls={...v.N3,dynamicRenderType:"simple"};var li=JSON.parse('{"cpu-time":"CPU Time","read-rows":"Read Rows","read-bytes":"Read Bytes","query-hash":"Query Hash","user":"User","start-time":"Start time","end-time":"End time","duration":"Duration","query-text":"Query text","application":"Application","request-units":"Request Units"}');let ll=(0,ex.g4)("ydb-top-queries-columns",{en:li}),lo={...ls,disableSortReset:!0,externalSort:!0,dynamicRenderType:"uniform"};var lc=JSON.parse('{"no-data":"No data","filter.text.placeholder":"Search by query text or userSID...","mode_top":"Top","mode_running":"Running","timeframe_hour":"Per hour","timeframe_minute":"Per minute","query-details.title":"Query","query-details.open-in-editor":"Open in Editor","query-details.close":"Close","query-details.query.title":"Query Text","query-details.not-found.title":"Not found","query-details.not-found.description":"This query no longer exists"}');let ld=(0,ex.g4)("ydb-diagnostics-top-queries",{en:lc}),lu=e=>(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:100,height:100,viewBox:"0 0 100 100",...e,children:(0,r.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[(0,r.jsxs)("g",{fill:"currentColor",fillRule:"nonzero",children:[(0,r.jsx)("path",{d:"M72.844 36.587a1 1 0 0 1 1.414.017c2.607 2.67 4.53 5.866 5.672 9.573C84.845 62.124 74.557 73 50 73S15.155 62.124 20.07 46.177c1.122-3.641 2.998-6.79 5.535-9.432a1 1 0 0 1 1.442 1.386c-2.323 2.418-4.036 5.296-5.066 8.635C17.502 61.297 26.681 71 50 71s32.498-9.703 28.019-24.234c-1.048-3.4-2.805-6.32-5.192-8.765a1 1 0 0 1 .017-1.414"}),(0,r.jsx)("path",{d:"M84.876 52.008a1 1 0 0 1 .363 1.963l-.115.021-8 1a1 1 0 0 1-.363-1.963l.115-.021zm-8.838 5.717a1 1 0 0 1 1.123-.712l.114.025 7 2a1 1 0 0 1-.436 1.95l-.114-.026-7-2a1 1 0 0 1-.687-1.237M15.128 52.008a1 1 0 0 0-.37 1.962l.114.022 7.733 1a1 1 0 0 0 .371-1.962l-.115-.022zM23.425 57.715a1 1 0 0 0-1.13-.7l-.114.026-6.732 2a1 1 0 0 0 .455 1.944l.114-.026 6.733-2a1 1 0 0 0 .674-1.244M69.857 19.01a1 1 0 0 1 .951.401c3.511 4.821 4.55 11.746 3.18 20.74a1 1 0 1 1-1.977-.302c1.241-8.148.416-14.366-2.42-18.683l-.051-.075-.093.018c-4.025.803-7.448 3.451-10.29 8.011l-.243.396a1 1 0 0 1-1.074.46Q53.445 29 50 29q-3.444-.001-7.84.976a1 1 0 0 1-1.074-.46c-2.807-4.666-6.193-7.42-10.18-8.331l-.447-.094-.05.075c-2.771 4.219-3.623 10.253-2.502 18.13l.082.553a1 1 0 1 1-1.978.302c-1.37-8.994-.33-15.919 3.18-20.74a1 1 0 0 1 .952-.4c4.84.7 8.902 3.617 12.161 8.678l.117.184.6-.12q3.507-.69 6.449-.748L50 27q3.152 0 6.98.753l.598.12.118-.184c3.176-4.931 7.114-7.827 11.79-8.62z"})]}),(0,r.jsx)("path",{fill:"currentColor",fillRule:"nonzero",d:"m36.744 52.332.185.21q.214.248.47.56c.484.59.968 1.222 1.421 1.873.47.673.88 1.33 1.216 1.959.617 1.158.964 2.185.964 3.09C41 62.774 38.76 65 36 65s-5-2.226-5-4.976c0-.905.347-1.932.964-3.09.336-.63.746-1.286 1.216-1.959a30 30 0 0 1 2.076-2.643 1 1 0 0 1 1.488 0M36 54.552c-.404.5-.804 1.028-1.18 1.567a18 18 0 0 0-1.09 1.756c-.478.894-.73 1.641-.73 2.15C33 61.665 34.342 63 36 63s3-1.334 3-2.976c0-.508-.252-1.255-.73-2.15a18 18 0 0 0-1.09-1.755A28 28 0 0 0 36 54.552m10.769 10.087a1 1 0 1 1-1.538-1.278C46.473 61.868 48.172 61 50 61s3.527.868 4.769 2.36a1 1 0 1 1-1.538 1.28C52.355 63.585 51.208 63 50 63s-2.355.586-3.231 1.64m-15.114-14a1 1 0 0 1 .69-1.878c.724.266 1.587.413 2.495.413 1.456 0 2.775-.38 3.557-.972a1 1 0 1 1 1.206 1.596c-1.156.874-2.897 1.376-4.763 1.376-1.14 0-2.235-.186-3.185-.536m28.742-.841a1 1 0 1 1 1.206-1.596c.782.592 2.101.972 3.558.972.908 0 1.77-.147 2.494-.413a1 1 0 1 1 .69 1.877c-.95.35-2.045.536-3.184.536-1.867 0-3.608-.502-4.764-1.376"})]})}),lp=(0,c.cn)("kv-top-queries"),lm=({onClose:e})=>(0,r.jsxs)(eD.s,{justifyContent:"center",alignItems:"center",direction:"column",className:lp("not-found-container"),children:[(0,r.jsx)(ek.I,{data:lu,size:100}),(0,r.jsx)(eA.E,{variant:"subheader-2",className:lp("not-found-title"),children:ld("query-details.not-found.title")}),(0,r.jsx)(eA.E,{variant:"body-1",color:"complementary",className:lp("not-found-description"),children:ld("query-details.not-found.description")}),(0,r.jsx)(tM.$,{size:"m",view:"normal",className:lp("not-found-close"),onClick:e,children:ld("query-details.close")})]});var lh=a(48448);let lg=(0,c.cn)("ydb-query-details"),lx=({queryText:e,infoItems:t,onOpenInEditor:a})=>(0,r.jsx)(eD.s,{direction:"column",className:lg(),children:(0,r.jsxs)(eD.s,{direction:"column",className:lg("content"),children:[(0,r.jsx)(ro.z_,{info:t}),(0,r.jsxs)("div",{className:lg("query-content"),children:[(0,r.jsxs)("div",{className:lg("query-header"),children:[(0,r.jsx)("div",{className:lg("query-title"),children:ld("query-details.query.title")}),(0,r.jsxs)(tM.$,{view:"flat-secondary",size:"m",onClick:a,className:lg("editor-button"),children:[(0,r.jsx)(ek.I,{data:lh.A,size:16}),ld("query-details.open-in-editor")]})]}),(0,r.jsx)(rH.YDBSyntaxHighlighter,{language:"yql",text:e,withClipboardButton:{alwaysVisible:!0,withLabel:!1}})]})]})}),ly=({row:e,onClose:t})=>{let a=(0,j.YQ)(),s=(0,rL.zy)(),i=(0,rL.W6)(),l=n.useCallback(()=>{if(e){let t=e.QueryText;a((0,lt.iZ)({input:t})),a((0,lt.Xb)(!1));let r=(0,B.mA)(s),n=(0,B.YL)({...r,[E.Dt]:E.Dg.query,[aL.vh.queryTab]:E.tQ.newQuery});i.push(n)}},[a,i,s,e]);if(e){let t;return(0,r.jsx)(lx,{queryText:e.QueryText,infoItems:(t=[],e.QueryText&&t.push({label:ll("query-hash"),value:ln(String(e.QueryText))}),void 0!==e.CPUTimeUs&&t.push({label:ll("cpu-time"),value:(0,ez.Xo)((0,ez.Jc)(e.CPUTimeUs??void 0))}),void 0!==e.Duration&&t.push({label:ll("duration"),value:(0,ez.Xo)((0,ez.Jc)(e.Duration??void 0))}),void 0!==e.ReadBytes&&t.push({label:ll("read-bytes"),value:(0,Q.ZV)(e.ReadBytes)}),void 0!==e.RequestUnits&&t.push({label:ll("request-units"),value:(0,Q.ZV)(e.RequestUnits)}),e.EndTime&&t.push({label:ll("end-time"),value:(0,Q.r6)(new Date(e.EndTime).getTime())}),void 0!==e.ReadRows&&t.push({label:ll("read-rows"),value:(0,Q.ZV)(e.ReadRows)}),e.UserSID&&t.push({label:ll("user"),value:e.UserSID}),e.ApplicationName&&t.push({label:ll("application"),value:e.ApplicationName}),e.QueryStartAt&&t.push({label:ll("start-time"),value:(0,Q.r6)(new Date(e.QueryStartAt).getTime())}),t),onOpenInEditor:l})}return(0,r.jsx)(lm,{onClose:t})},lf=(0,c.cn)("kv-top-queries");function lb({columns:e,data:t,isFetching:a,isLoading:s,onRowClick:i,columnsWidthLSKey:l,emptyDataMessage:o,sortOrder:c,onSort:d,selectedRow:u,onSelectedRowChange:p,drawerControls:m,drawerId:h="query-details",storageKey:g="kv-top-queries-drawer-width",tableSettings:x=lo}){let[y,f]=n.useState(void 0),b=void 0===u?y:u,v=p||f,j=n.useCallback(()=>{v(void 0)},[v]),T=void 0!==b,w=n.useCallback((e,t,a)=>{a?.stopPropagation(),v(e),i?.(e,t,a)},[i,v]),S=n.useCallback(()=>(0,r.jsx)(ly,{row:b,onClose:j}),[b,j]),E=n.useMemo(()=>[{type:"close"}],[]);return(0,r.jsx)(le,{isDrawerVisible:T,onCloseDrawer:j,renderDrawerContent:S,drawerId:h,storageKey:g,detectClickOutside:!0,isPercentageWidth:!0,title:ld("query-details.title"),drawerControls:m||E,children:(0,r.jsx)(ep.l,{emptyDataMessage:o||ld("no-data"),columnsWidthLSKey:l,columns:e,data:t,isFetching:a,isLoading:s,settings:x,onRowClick:w,rowClassName:e=>lf("row",{active:(0,eU.isEqual)(e,b)}),sortOrder:c,onSort:d})})}let lv=(0,c.cn)("ydb-fixed-height-query"),lj=({value:e="",lines:t=4,hasClipboardButton:a,clipboardButtonAlwaysVisible:n,mode:s="fixed"})=>{let i=`${20*t+0}px`,l=e.replace(/^(\s*\n)+/,"");return(0,r.jsx)("div",{className:lv(),style:{..."fixed"===s?{height:i}:{maxHeight:i},"--line-clamp":t},children:(0,r.jsx)(rH.YDBSyntaxHighlighter,{language:"yql",text:l,withClipboardButton:a?{alwaysVisible:n,copyText:e,withLabel:!1,size:"xs"}:void 0})})},lT="topQueriesColumnsWidth",lw="CPUTime",lS="QueryText",lE="ReadRows",l_="ReadBytes",lN="UserSID",lC="Duration",lP="QueryStartAt",lI="ApplicationName",lA=["QueryHash","CPUTime","QueryText","EndTime","Duration","ReadRows","ReadBytes","RequestUnits","UserSID"],lD=["CPUTime","QueryText"],lR=["QueryHash","UserSID","QueryStartAt","QueryText","ApplicationName"],lk=["QueryStartAt","QueryText"],lM={get CPUTime(){return ll("cpu-time")},get QueryText(){return ll("query-text")},get EndTime(){return ll("end-time")},get ReadRows(){return ll("read-rows")},get ReadBytes(){return ll("read-bytes")},get UserSID(){return ll("user")},get OneLineQueryText(){return ll("query-text")},get QueryHash(){return ll("query-hash")},get Duration(){return ll("duration")},get QueryStartAt(){return ll("start-time")},get ApplicationName(){return ll("application")},get RequestUnits(){return ll("request-units")}},lO={CPUTime:"CPUTimeUs",QueryText:void 0,EndTime:void 0,ReadRows:void 0,ReadBytes:"ReadBytes",UserSID:void 0,OneLineQueryText:void 0,QueryHash:void 0,Duration:"Duration",QueryStartAt:void 0,ApplicationName:void 0,RequestUnits:"RequestUnits"},lq={CPUTime:void 0,QueryText:void 0,EndTime:void 0,ReadRows:void 0,ReadBytes:void 0,UserSID:"UserSID",OneLineQueryText:void 0,QueryHash:void 0,Duration:void 0,QueryStartAt:"QueryStartAt",ApplicationName:"ApplicationName",RequestUnits:void 0};function lL(e){return lO[e]}function lz(e){return lq[e]}let lF=(0,c.cn)("kv-top-queries"),lQ={name:lw,header:lM.CPUTime,render:({row:e})=>(0,ez.Xo)((0,ez.Jc)(e.CPUTimeUs??void 0)),width:120,align:tg.Ay.RIGHT},lU={name:lS,header:lM.QueryText,render:({row:e})=>(0,r.jsx)("div",{className:lF("query"),children:(0,r.jsx)(lj,{value:e.QueryText?.toString(),lines:3,hasClipboardButton:!0})}),width:500},l$={name:lS,header:lM.QueryText,render:({row:e})=>(0,r.jsx)("div",{className:lF("query"),children:(0,r.jsx)(lj,{value:e.QueryText?.toString(),lines:6,hasClipboardButton:!0,mode:"max"})}),width:500},lG={name:"EndTime",header:lM.EndTime,render:({row:e})=>(0,Q.r6)(new Date(e.EndTime).getTime()),align:tg.Ay.RIGHT,width:200},lH={name:lE,header:lM.ReadRows,render:({row:e})=>(0,Q.ZV)(e.ReadRows),align:tg.Ay.RIGHT,width:150},lB={name:l_,header:lM.ReadBytes,render:({row:e})=>(0,Q.ZV)(e.ReadBytes),align:tg.Ay.RIGHT,width:150},lW={name:lN,header:lM.UserSID,render:({row:e})=>(0,r.jsx)("div",{className:lF("user-sid"),children:e.UserSID||aq.Pd}),align:tg.Ay.LEFT,width:120},lV={name:"QueryHash",header:lM.QueryHash,render:({row:e})=>ln(String(e.QueryText)),width:130},lJ={name:lC,header:lM.Duration,render:({row:e})=>(0,ez.Xo)((0,ez.Jc)(e.Duration??void 0)),align:tg.Ay.RIGHT,width:150},lY={name:lP,header:lM.QueryStartAt,render:({row:e})=>(0,Q.r6)(new Date(e.QueryStartAt).getTime()),resizeable:!1,width:160},lK={name:"RequestUnits",header:lM.RequestUnits,render:({row:e})=>(0,Q.ZV)(e.RequestUnits),align:tg.Ay.RIGHT,width:150},lZ={name:lI,header:lM.ApplicationName,render:({row:e})=>(0,r.jsx)("div",{className:lF("user-sid"),children:e.ApplicationName||aq.Pd})},lX={encode:e=>{if(null!=e&&Array.isArray(e))return encodeURIComponent(JSON.stringify(e))},decode:e=>{if("string"!=typeof e||!e)return[];try{return JSON.parse(decodeURIComponent(e))}catch{return[]}}};function l0(e){let{paramName:t,schema:a,defaultSort:r}=e,[s,i]=(0,e$.useQueryParam)(t,lX);return{sortParam:n.useMemo(()=>{if(!s||!Array.isArray(s)||0===s.length)return[r];let e=s.filter(e=>{try{return a.parse(e.columnId),!0}catch{return!1}});return e.length?e:[r]},[s,a,r]),updateSortParam:n.useCallback(e=>{i(e||[],"replaceIn")},[i])}}let l1=eG.z.enum([lw,lC,lE,l_,lS]).catch(lw),l2={columnId:lw,order:tg.Ay.DESCENDING};function l3(){let{sortParam:e,updateSortParam:t}=l0({paramName:"topSort",schema:l1,defaultSort:l2}),[a,r]=(0,j.GY)({initialSortColumn:e?.[0]?.columnId||l2.columnId,initialSortOrder:e?.[0]?.order||l2.order,multiple:!0,fixedOrderType:tg.Ay.DESCENDING,onSort:t});return{tableSort:a,handleTableSort:r,backendSort:n.useMemo(()=>(0,j.JN)(a,lL),[a])}}let l4=[lV,l$,lQ];function l5({database:e}){let[t]=(0,j.Nt)(),{backendSort:a}=l3(),{currentData:n,isFetching:s,error:i}=sl.Ke.useGetTopQueriesQuery({database:e,timeFrame:"hour",limit:v.Nz,sortOrder:a},{pollingInterval:t}),l=s&&void 0===n,o=n?.resultSets?.[0]?.result||[];return(0,r.jsx)(iW,{loading:l,error:(0,eK.Cb)(i),withData:!!n,children:(0,r.jsx)(lb,{columnsWidthLSKey:lT,data:o,columns:l4,tableSettings:v.jp,drawerId:"tenant-overview-query-details",storageKey:"tenant-overview-queries-drawer-width"})})}var l6=a(28904),l7=a(8747);let l8=g.F.injectEndpoints({endpoints:e=>({getTopShards:e.query({queryFn:async({database:e,databaseFullPath:t},{signal:a})=>{try{let r=await window.api.viewer.sendQuery({query:(0,l7.Q7)({databaseFullPath:t,path:t,selectFields:["Path","TabletId","CPUCores"],sortOrder:[{columnId:"CPUCores",order:-1}],limit:v.Nz}),database:e,action:"execute-query",internal_call:!0},{signal:a,withRetries:!0});if((0,eK.We)(r))return{error:r};return{data:(0,eK.fW)(r)}}catch(e){return{error:e||Error("Unauthorized")}}},providesTags:["All"]})}),overrideExisting:"throw"}),l9=["TabletId","Path","CPUCores"],oe=({database:e,databaseFullPath:t})=>{let a=(0,l6.x)("ShardsTable"),[n]=(0,j.Nt)(),{currentData:s,isFetching:i,error:l}=l8.useGetTopShardsQuery({database:e,databaseFullPath:t},{pollingInterval:n}),o=i&&void 0===s,c=s?.resultSets?.[0]?.result||[];return(0,r.jsx)(iW,{loading:o,error:(0,eK.Cb)(l),withData:!!s,children:(0,r.jsx)(a,{data:c,databaseFullPath:t,columnsIds:l9,settings:v.jp})})},ot=[{title:nq("charts.cpu-usage"),metrics:["IC","IO","Batch","User","System"].map(e=>({target:`resources.cpu.${e}.usage`,title:e})),options:{dataType:"percent",scaleRange:{min:0,max:1},showLegend:!0}}];function oa({database:e,databaseType:t,databaseFullPath:a}){let s=(0,j.YQ)(),i=iR(),l=i(E.iJ.nodes),o=i(E.iJ.topShards),c=i(E.iJ.topQueries);return(0,r.jsxs)(eD.s,{direction:"column",gap:4,children:["Serverless"!==t&&(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(iQ,{database:e,charts:ot}),(0,r.jsx)(iz,{allEntitiesLink:l,title:nq("title_top-nodes-load"),children:(0,r.jsx)(iJ,{database:e})}),(0,r.jsx)(iz,{title:nq("title_top-nodes-pool"),allEntitiesLink:l,children:(0,r.jsx)(iV,{database:e})})]}),(0,r.jsx)(iz,{title:nq("title_top-shards"),allEntitiesLink:o,children:(0,r.jsx)(oe,{database:e,databaseFullPath:a})}),(0,r.jsx)(iz,{title:nq("title_top-queries"),allEntitiesLink:c,onAllEntitiesClick:()=>s((0,sl.TX)({from:void 0,to:void 0})),children:(0,r.jsx)(l5,{database:e})})]})}var or=a(80865),on=a(47037),os=JSON.parse('{"alert_no-data":"No data","context_capacity-usage":"{{value}} of {{capacity}}"}');let oi=(0,ex.g4)("progress-wrapper",{en:os});function ol(e,t,a){return a<=0?String(e):oi("context_capacity-usage",{value:e,capacity:t})}function oo(e,t,a){if(a){let r=a(Number(e),Number(t));return[r[0],r[1]]}return[e,t]}function oc({children:e,displayText:t,withCapacityUsage:a=!1,className:n,width:s}){let i,l,o=(l=(i="full"===s)?0:Math.max(0,s||400),{width:i?"100%":`${l}px`,flex:i?"1":"none"});return(0,r.jsxs)(eD.s,{alignItems:"center",gap:"2",className:n,children:[(0,r.jsx)("div",{style:o,children:e}),a&&t&&(0,r.jsx)(eA.E,{variant:"body-1",color:"secondary",children:t})]})}function od({value:e,capacity:t,formatValues:a=sG.g,className:s,width:i,size:l="s",withCapacityUsage:o=!1}){let c=(0,np.y3)(e),d=(0,np.y3)(t),u=Math.min(Math.max(0,d>0?Math.floor(c/d*100):100),100),[p,m]=n.useMemo(()=>oo(e,t,a),[a,e,t]),h=n.useMemo(()=>ol(p,m,d),[p,m,d]);return(0,np.kf)(e)&&(0,np.y3)(e)>=0?(0,r.jsx)(oc,{displayText:h,withCapacityUsage:o,className:s,width:i,children:(0,r.jsx)(on.k,{value:u,theme:"success",size:l})}):(0,r.jsx)("div",{className:s,children:oi("alert_no-data")})}var ou=a(26552);function op({stack:e,totalCapacity:t,formatValues:a=sG.g,className:s,width:i,size:l="s",withCapacityUsage:o=!1}){let c=n.useMemo(()=>e.filter(e=>!e.isInfo&&e.value>0),[e]),d=n.useMemo(()=>c.reduce((e,t)=>e+t.value,0),[c]),u=n.useMemo(()=>(0,np.y3)(t),[t]),p=u||d,m=n.useMemo(()=>c.map(e=>({value:p>0?e.value/p*100:0,color:(0,ou.AB)(e.key),title:e.label})),[c,p]),[h,g]=n.useMemo(()=>oo(d,u||d,a),[a,d,u]),x=n.useMemo(()=>ol(h,g,u||0),[h,g,u]);return 0===c.length?(0,r.jsx)("div",{className:s,children:oi("alert_no-data")}):(0,r.jsx)(oc,{displayText:x,withCapacityUsage:o,className:s,width:i,children:(0,r.jsx)(on.k,{value:100,stack:m,size:l})})}function om(e){return"stack"in e&&e.stack?(0,r.jsx)(op,{...e}):(0,r.jsx)(od,{...e})}var oh=a(11342),og=a(66918);let ox=(0,c.cn)("memory-details");function oy({segments:e,className:t}){return(0,r.jsx)(og.u,{nameMaxWidth:200,responsive:!0,className:t,children:e.map(e=>{let t=(0,ou.AB)(e.key),[a,n]=(0,Q.vX)(e.value,e.capacity),s=e.capacity?oi("context_capacity-usage",{value:a,capacity:n}):a,i=e.capacity?e.value/e.capacity*100:100;return(0,r.jsx)(og.u.Item,{name:(0,r.jsxs)(eD.s,{alignItems:"center",gap:"1",children:[(0,r.jsx)("div",{className:ox("segment-indicator"),style:{backgroundColor:t}}),(0,r.jsx)(eA.E,{variant:"body-1",color:"secondary",children:e.label})]}),children:(0,r.jsxs)(eD.s,{alignItems:"center",gap:"3",children:[(0,r.jsx)("div",{className:ox("segment-progress"),children:(0,r.jsx)("div",{style:{"--g-progress-filled-background-color":t},children:(0,r.jsx)(on.k,{value:i,size:"s",className:ox("progress-bar")})})}),(0,r.jsx)(eA.E,{variant:"body-1",color:"secondary",children:s})]})},e.key)})})}let of=(0,c.cn)("memory-details");function ob({memoryStats:e}){let t=n.useMemo(()=>void 0===e.AnonRss?(0,np.y3)(e.AllocatedMemory)+(0,np.y3)(e.AllocatorCachesMemory):(0,np.y3)(e.AnonRss),[e.AnonRss,e.AllocatedMemory,e.AllocatorCachesMemory]),a=n.useMemo(()=>(0,ou.Sb)(e,t),[e,t]),s=n.useMemo(()=>a.filter(e=>!e.isInfo&&e.value>0),[a]),i=n.useCallback((e,t)=>(0,Q.vX)(e,t),[]);return(0,r.jsxs)(eD.s,{direction:"column",alignItems:"flex-start",gap:"3",children:[(0,r.jsx)("div",{className:of("header"),children:(0,r.jsx)(eA.E,{variant:"body-1",className:of("title"),children:(0,oh.A)("text_memory-details")})}),(0,r.jsxs)(eD.s,{direction:"column",alignItems:"flex-start",gap:"4",width:"100%",children:[(0,r.jsx)("div",{className:of("main-progress"),children:(0,r.jsx)(om,{stack:a,totalCapacity:e.HardLimit,formatValues:i,className:of("main-progress-bar"),size:"m",width:"full"})}),(0,r.jsx)(oy,{segments:s,className:of("memory-segments-list")})]})]})}function ov({database:e}){var t;let a,n,[s]=(0,j.Nt)(),[i,l]=(t={database:e},n=(a=[(0,iU._E)(),(0,iU.Nh)(t),(0,iU.jl)(),(0,iU.fR)(),(0,iU.iX)(),(0,iU.oz)(),(0,iU.qp)(t)]).map(e=>e.name),[a,(0,iH.R)(n,i$.fN)]),{currentData:o,isFetching:c,error:d}=iG.s.useGetNodesQuery({tenant:e,type:"any",tablets:!0,sort:"-Memory",limit:v.Nz,fieldsRequired:l},{pollingInterval:s}),u=c&&void 0===o,p=o?.nodes||[];return(0,r.jsx)(iW,{loading:u,error:d,withData:!!o,children:(0,r.jsx)(ep.l,{columnsWidthLSKey:i$.zO,data:p,columns:i,emptyDataMessage:nq("top-nodes.empty-data"),settings:v.jp})})}let oj=[{title:nq("charts.memory-usage"),metrics:[{target:"resources.memory.used_bytes",title:nq("charts.memory-usage")}],options:{dataType:"size"}}],oT=(0,c.cn)("tenant-memory");function ow({database:e,memoryStats:t,memoryUsed:a,memoryLimit:n}){let s=(0,j.e4)();return(0,r.jsxs)("div",{className:oT(),children:[(0,r.jsx)(iQ,{database:e,charts:oj}),t?(0,r.jsx)(ob,{memoryStats:t}):(0,r.jsx)(or.z,{variant:"small",title:nq("title_memory-details"),info:[{label:nq("field_memory-usage"),value:(0,r.jsx)(om,{value:a,capacity:n,formatValues:Q.vX,withCapacityUsage:!0,className:oT("fallback-progress-wrapper"),size:"m",width:400})}]}),(0,r.jsx)(iz,{title:nq("title_top-nodes-by-memory"),allEntitiesLink:(0,B.YL)({...s,[aL.vh.diagnosticsTab]:E.iJ.nodes}),children:(0,r.jsx)(ov,{database:e})})]})}function oS({database:e}){var t;let a,n,s,[i]=(0,j.Nt)(),[l,o]=(t={database:e},n=(a=[(0,iU._E)(),(0,iU.b8)(t),(0,iU.jl)(),(0,iU.wN)()]).map(e=>e.name),s=(0,iH.R)(n,i$.fN),[a.map(e=>({...e,sortable:!1})),s]),{currentData:c,isFetching:d,error:u}=iG.s.useGetNodesQuery({tenant:e,type:"any",sort:"-PingTime",limit:v.Nz,tablets:!1,fieldsRequired:o},{pollingInterval:i}),p=d&&void 0===c,m=c?.nodes||[];return(0,r.jsx)(iW,{loading:p,error:u,withData:!!c,children:(0,r.jsx)(ep.l,{columnsWidthLSKey:i$.zO,data:m,columns:l,emptyDataMessage:nq("top-nodes.empty-data"),settings:v.jp})})}function oE({database:e}){var t;let a,n,s,[i]=(0,j.Nt)(),[l,o]=(t={database:e},n=(a=[(0,iU._E)(),(0,iU.b8)(t),(0,iU.jl)(),(0,iU.pt)()]).map(e=>e.name),s=(0,iH.R)(n,i$.fN),[a.map(e=>({...e,sortable:!1})),s]),{currentData:c,isFetching:d,error:u}=iG.s.useGetNodesQuery({tenant:e,type:"any",sort:"-ClockSkew",limit:v.Nz,tablets:!1,fieldsRequired:o},{pollingInterval:i}),p=d&&void 0===c,m=c?.nodes||[];return(0,r.jsx)(iW,{loading:p,error:u,withData:!!c,children:(0,r.jsx)(ep.l,{columnsWidthLSKey:i$.zO,data:m,columns:l,emptyDataMessage:nq("top-nodes.empty-data"),settings:v.jp})})}let o_=(0,c.cn)("tenant-network");function oN({database:e}){let t=(0,j.e4)(),[a]=(0,j.iK)(sg.GS.ENABLE_NETWORK_TABLE),n=a?{[aL.vh.diagnosticsTab]:E.iJ.network}:{[aL.vh.diagnosticsTab]:E.iJ.nodes},s=(0,B.YL)({...t,...n});return(0,r.jsxs)(eD.s,{direction:"column",gap:4,className:o_(),children:[(0,r.jsx)(iz,{title:nq("title_nodes-by-ping"),allEntitiesLink:s,children:(0,r.jsx)(oS,{database:e})}),(0,r.jsx)(iz,{title:nq("title_nodes-by-skew"),allEntitiesLink:s,children:(0,r.jsx)(oE,{database:e})})]})}var oC=a(65615),oP=a(13195),oI=a(38512);function oA({tenant:e}){let t,a,n=(0,I.Pm)(),s=(0,I.YA)(),[i]=(0,j.Nt)(),[l,o]=(a=(t=(0,oP.k)()).map(e=>e.name),[t,(0,iH.R)(a,oI.YX)]),{currentData:c,isFetching:d,error:u}=oC.S.useGetStorageGroupsInfoQuery({database:e,sort:"-Usage",with:"all",limit:v.Nz,shouldUseGroupsHandler:s,fieldsRequired:o},{pollingInterval:i,skip:!n}),p=d&&void 0===c,m=c?.groups||[];return(0,r.jsx)(iW,{loading:p||!n,error:u,withData:!!c,children:(0,r.jsx)(ep.l,{columnsWidthLSKey:oI.qK,data:m,columns:l,settings:v.jp})})}var oD=a(60908);let oR=g.F.injectEndpoints({endpoints:e=>({getTopTables:e.query({queryFn:async({database:e},{signal:t})=>{try{let a=await window.api.viewer.sendQuery({query:`${v.Zi}
SELECT
    Path, SUM(DataSize) as Size
FROM \`.sys/partition_stats\`
GROUP BY Path
ORDER BY Size DESC
LIMIT ${v.Nz}
`,database:e,action:"execute-query",internal_call:!0},{signal:t,withRetries:!0});if((0,eK.We)(a))return{error:a};return{data:(0,eK.fW)(a)}}catch(e){return{error:e||"Unauthorized"}}},providesTags:["All"]})}),overrideExisting:"throw"});function ok({database:e}){let[t]=(0,j.Nt)(),{currentData:a,error:s,isFetching:i}=oR.useGetTopTablesQuery({database:e},{pollingInterval:t}),l=i&&void 0===a,o=a?.resultSets?.[0]?.result||[],c=(0,af.fn)(o?.length?Number(o[0].Size):0),d=n.useMemo(()=>[{name:"Size",width:100,render:({row:e})=>(0,af.z3)({value:Number(e.Size),size:c,precision:1}),align:tg.Ay.RIGHT},{name:"Path",width:700,render:({row:e})=>e.Path?(0,r.jsx)(eO.s,{content:e.Path,children:(0,r.jsx)(oD.I,{path:String(e.Path),children:e.Path})}):null}],[c]);return(0,r.jsx)(iW,{loading:l,error:(0,eK.Cb)(s),withData:!!a,children:(0,r.jsx)(ep.l,{columnsWidthLSKey:"topTablesTableColumnsWidth",data:o,columns:d,settings:v.jp})})}let oM=[{title:nq("charts.storage-usage"),metrics:[{target:"resources.storage.used_bytes",title:nq("charts.storage-usage")}],options:{dataType:"size"}}];function oO({database:e,metrics:t,databaseType:a}){let{blobStorageUsed:n,tabletStorageUsed:s,blobStorageLimit:i,tabletStorageLimit:l}=t,o=(0,j.e4)(),c=[{label:(0,r.jsx)(aF,{text:nq("storage.tablet-storage-title"),popoverContent:nq("storage.tablet-storage-description")}),value:(0,r.jsx)(om,{value:s,capacity:l,formatValues:Q.j9,withCapacityUsage:!0})},{label:(0,r.jsx)(aF,{text:nq("storage.db-storage-title"),popoverContent:nq("storage.db-storage-description")}),value:(0,r.jsx)(om,{value:n,capacity:i,formatValues:Q.j9,withCapacityUsage:!0})}];return"Serverless"===a?(0,r.jsx)(eD.s,{direction:"column",gap:4,children:(0,r.jsx)(iz,{title:nq("title_top-tables-by-size"),allEntitiesLink:(0,B.YL)({...o,[aL.vh.diagnosticsTab]:E.iJ.storage}),children:(0,r.jsx)(ok,{database:e})})}):(0,r.jsxs)(eD.s,{direction:"column",gap:4,children:[(0,r.jsx)(iQ,{database:e,charts:oM}),(0,r.jsx)(or.z,{variant:"small",title:nq("title_storage-details"),info:c}),(0,r.jsx)(iz,{title:nq("title_top-tables-by-size"),children:(0,r.jsx)(ok,{database:e})}),(0,r.jsx)(iz,{title:nq("title_top-groups-by-usage"),allEntitiesLink:(0,B.YL)({...o,[aL.vh.diagnosticsTab]:E.iJ.storage}),children:(0,r.jsx)(oA,{tenant:e})})]})}function oq({database:e,databaseFullPath:t,additionalTenantProps:a}){let{metricsTab:n}=(0,j.N4)(e=>e.tenant),[s]=(0,j.Nt)(),i=(0,sp.H)(),o=(0,j.YQ)(),{handleTenantPageChange:c}=sb(),d=(0,I.$h)(),{currentData:u,isFetching:p}=f.z6.useGetTenantInfoQuery({database:e,clusterName:i,isMetaDatabasesAvailable:d},{pollingInterval:s}),m=p&&void 0===u,{Name:h,Type:g,Overall:y}=u||{},b="Serverless"===g,T=b&&n!==E.pA.cpu&&n!==E.pA.storage?E.pA.cpu:n,w=g&&te[g],{currentData:S}=x.useGetOverviewQuery({path:t,database:e,databaseFullPath:t},{pollingInterval:s}),{Tables:_,Topics:N}=S?.PathDescription?.DomainDescription?.DiskSpaceUsage||{},C=[_?.TotalSize,N?.DataSize].reduce((e,t)=>t?e+Number(t):e,0),P={...u,Metrics:{...u?.Metrics,Storage:String(C)}},{blobStorage:D,tabletStorage:k,blobStorageLimit:M,tabletStorageLimit:O,poolsStats:q,memoryStats:L,blobStorageStats:z,tabletStorageStats:F,networkUtilization:Q,networkThroughput:U}=(0,sd.uI)(P),$={blobStorageUsed:D,blobStorageLimit:M,tabletStorageUsed:k,tabletStorageLimit:O},G=(0,su.y)(a,h,g),{monitoring:H}=(0,A.Zd)(),B=(0,R.P)(u?.ControlPlane,H);return(0,r.jsx)(l.r,{loading:m,children:(0,r.jsxs)("div",{className:iB(),children:[(0,r.jsxs)("div",{className:iB("info"),children:[(0,r.jsxs)(eD.s,{alignItems:"center",gap:"2",className:iB("top-label"),children:[w,B&&(0,r.jsxs)(tM.$,{view:"normal",onClick:()=>{c(E.Dg.diagnostics),o((0,f.WO)(E.iJ.monitoring))},children:[(0,r.jsx)(ek.I,{data:nw.A,size:16}),nq("action_open-monitoring")]})]}),(0,r.jsxs)(eD.s,{alignItems:"center",gap:"1",className:iB("top"),children:[(0,r.jsxs)(eD.s,{alignItems:"center",style:{overflow:"hidden"},children:[(0,r.jsx)(nS.c,{status:y,name:h||v.oK,withLeftTrim:!0,hasClipboardButton:!!u,clipboardButtonAlwaysVisible:!0}),b?(0,r.jsx)("div",{className:iB("serverless-tag"),children:(0,r.jsx)(tc.J,{theme:"clear",size:"s",className:iB("serverless-tag-label"),children:(0,r.jsxs)(eD.s,{alignItems:"center",gap:"2",children:[nq("value_serverless"),(0,r.jsx)(az.H,{iconSize:"s",className:iB("serverless-tag-tooltip"),children:nq("context_serverless-tooltip")})]})})}):null]}),G.length>0&&(0,r.jsx)(eD.s,{gap:"2",children:G.map(({title:e,url:t,icon:a})=>(0,r.jsx)(tM.$,{href:t,target:"_blank",size:"xs",title:e,children:(0,r.jsx)(ek.I,{data:a})},e))})]}),(0,r.jsxs)(eD.s,{direction:"column",gap:4,children:[!b&&(0,r.jsx)(s$,{database:e}),(0,r.jsx)(sc,{database:e}),(0,r.jsx)(il,{poolsCpuStats:q,memoryStats:L,blobStorageStats:z,tabletStorageStats:F,networkUtilization:Q,networkThroughput:U,storageGroupsCount:P.StorageGroups?Number(P.StorageGroups):void 0,databaseType:g,activeTab:T})]})]}),(0,r.jsx)("div",{className:iB("tab-content"),children:(()=>{switch(T){case E.pA.cpu:return(0,r.jsx)(oa,{database:e,databaseType:g,databaseFullPath:t});case E.pA.storage:return(0,r.jsx)(oO,{database:e,metrics:$,databaseType:g});case E.pA.memory:return(0,r.jsx)(ow,{database:e,memoryUsed:P.MemoryUsed,memoryLimit:P.MemoryLimit,memoryStats:P.MemoryStats});case E.pA.network:return(0,r.jsx)(oN,{database:e});default:return null}})()})]})})}let oL=(0,c.cn)("kv-detailed-overview"),oz=function({type:e,database:t,databaseFullPath:a,path:n,additionalTenantProps:s}){let i=a===n;return(0,r.jsx)("div",{className:oL(),children:i?(0,r.jsx)("div",{className:oL("section"),children:(0,r.jsx)(oq,{database:t,databaseFullPath:a,additionalTenantProps:s})}):(0,r.jsx)(nT,{type:e,path:n,database:t,databaseFullPath:a})})};var oF=a(65127);let oQ=(0,c.cn)("kv-tenant-diagnostics");function oU({id:e,title:t,linkPath:a,badge:n}){return(0,r.jsx)(oF.o,{value:e,children:(0,r.jsxs)(aO.E,{to:a,as:"tab",children:[t,n&&(0,r.jsx)(tc.J,{className:oQ("tab-badge"),theme:n.theme,size:n.size,children:n.text})]})},e)}let o$=g.F.injectEndpoints({endpoints:e=>({getHotKeys:e.query({queryFn:async({path:e,database:t,databaseFullPath:a},{signal:r})=>{try{let n=await window.api.viewer.getHotKeys({path:{path:e,databaseFullPath:a},database:t,enableSampling:!0},{signal:r});if(Array.isArray(n.hotkeys))return{data:n.hotkeys};return await Promise.race([new Promise(e=>{setTimeout(e,5e3)}),new Promise((e,t)=>{r.addEventListener("abort",t)})]),{data:(await window.api.viewer.getHotKeys({path:{path:e,databaseFullPath:a},database:t,enableSampling:!1},{signal:r})).hotkeys??null}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"});var oG=JSON.parse('{"hot-keys-collecting":"Please wait a little while we are collecting hot keys samples...","no-data":"No information about hot keys","help":"Hot keys contains a list of table primary key values that are accessed most often. Sample is collected upon request to the tab during 5s time interval. Samples column indicates how many requests to the particular key value were registered during collection phase."}');let oH=(0,ex.g4)("ydb-hot-keys",{en:oG}),oB=e=>(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 12 7",...e,children:(0,r.jsx)("path",{d:"M8 7h3V5h1V2H6.66C6.085.79 4.86 0 3.5 0 1.57 0 0 1.57 0 3.5S1.57 7 3.5 7c1.36 0 2.59-.79 3.16-2H8zm2-1H9V4H5.97l-.115.335a2.5 2.5 0 1 1 0-1.67L5.97 3H11v1h-1zM3.5 5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3M3 3.5a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0"})}),oW=(0,c.cn)("ydb-hot-keys"),oV="accessSample";function oJ({path:e,database:t,databaseFullPath:a}){let{currentData:s,isFetching:i,error:l}=o$.useGetHotKeysQuery({path:e,database:t,databaseFullPath:a}),o=i&&void 0===s,[c]=(0,j.Nt)(),{currentData:d,isLoading:u}=x.useGetOverviewQuery({path:e,database:t,databaseFullPath:a},{pollingInterval:c}),p=d?.PathDescription?.Table?.KeyColumnNames,m=n.useMemo(()=>((e=[])=>[...e.map((e,t)=>({name:e,header:(0,r.jsxs)("div",{className:oW("primary-key-column"),children:[(0,r.jsx)(ek.I,{data:oB,width:12,height:7}),e]}),render:({row:e})=>e.keyValues[t],align:tg.Ay.RIGHT,sortable:!1})),{name:oV,header:"Samples",render:({row:e})=>e.accessSample,align:tg.Ay.RIGHT,sortable:!1}])(p),[p]);return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(oY,{}),o||u?(0,r.jsx)("div",{children:oH("hot-keys-collecting")}):l?(0,r.jsx)(q.o,{error:l}):s?(0,r.jsx)(ep.l,{wrapperClassName:oW("table"),columns:m,data:s,settings:v.N3,initialSortOrder:{columnId:oV,order:tg.Ay.DESCENDING}}):(0,r.jsx)("div",{children:oH("no-data")})]})}function oY(){let[e,t]=(0,j.iK)(sg.GS.IS_HOTKEYS_HELP_HIDDEN);return e?null:(0,r.jsxs)(tY.Z,{theme:"info",view:"filled",type:"container",className:oW("help-card"),children:[oH("help"),(0,r.jsx)(tM.$,{className:oW("help-card__close-button"),view:"flat",onClick:()=>t(!0),children:(0,r.jsx)(ek.I,{data:iY.A,size:18})})]})}var oK=a(6390),oZ=a(4858),oX=a(83129),o0=a(78870),o1=a(53808);let o2=g.F.injectEndpoints({endpoints:e=>({getNetworkInfo:e.query({queryFn:async({database:e,databaseFullPath:t},{signal:a})=>{try{return{data:await window.api.viewer.getNetwork({path:{path:t,databaseFullPath:t},database:e},{signal:a})}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"});function o3(){let[{withProblems:e},t]=(0,e$.useQueryParams)({withProblems:e$.BooleanParam});return{withProblems:!!e,handleWithProblemsChange:n.useCallback(e=>{t({withProblems:e||void 0},"replaceIn")},[t])}}let o4=(0,c.cn)("node-network");function o5(){}function o6({nodeId:e,connected:t,capacity:a,rack:s,status:i,onClick:l=o5,onMouseEnter:o=o5,onMouseLeave:c=o5,showID:d,isBlurred:u}){let p=n.useRef(null),m=i||function(e=0,t=0){let a=Math.floor(e/t*100);return 100===a?sj.m.Green:a>=70?sj.m.Yellow:a>=1?sj.m.Red:sj.m.Grey}(t,a);return(0,r.jsx)("div",{ref:p,className:o4({[m.toLowerCase()]:!0,id:d,blur:u}),onMouseEnter:()=>{o(p.current,{nodeId:e,connected:t,capacity:a,rack:s},"node")},onMouseLeave:()=>{c()},onClick:()=>l(e),children:d?e:null})}let o7=e=>e?.reduce((e,t)=>t.Connected?e+1:e,0),o8=e=>(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 221 204",...e,children:[(0,r.jsx)("path",{fill:"#EBF2FA",d:"M68.46 2.529v25.227c0 1.227.876 2.278 2.102 2.511 16.643 2.979 29.14 17.812 28.498 35.448-.642 18.045-15.359 32.703-33.345 33.403-17.636.643-32.41-11.854-35.448-28.44a2.56 2.56 0 0 0-2.51-2.102H2.528c-1.519 0-2.687 1.285-2.512 2.745 3.446 32.703 31.243 58.106 64.939 57.814 35.155-.292 63.829-29.024 64.121-64.18.292-33.695-25.17-61.492-57.873-64.938-1.46-.175-2.744.993-2.744 2.512"}),(0,r.jsx)("path",{fill:"#EBF2FA",d:"m22.736 18.354 17.811 17.812c.876.876 2.278.992 3.329.233 4.146-3.095 9.052-5.197 14.366-6.19 1.226-.233 2.102-1.226 2.102-2.511V2.528a2.502 2.502 0 0 0-2.803-2.51C44.46 1.418 32.488 6.674 22.91 14.674c-1.168.935-1.226 2.628-.175 3.68m-9.403 6.133C6.093 33.83 1.303 45.16.02 57.54c-.176 1.46 1.05 2.745 2.51 2.745H27.7a2.56 2.56 0 0 0 2.511-2.103c.818-4.672 2.628-9.051 5.14-12.847a2.64 2.64 0 0 0-.293-3.212L17.13 24.312c-1.05-1.11-2.861-.993-3.796.175m67.275 107.392h32.995c1.868 0 3.387 1.518 3.445 3.445v65.231a3.45 3.45 0 0 1-3.445 3.445H80.608a3.45 3.45 0 0 1-3.446-3.445v-65.231a3.45 3.45 0 0 1 3.446-3.445m77.844 27.097h-32.878a3.514 3.514 0 0 0-3.503 3.504v37.959a3.514 3.514 0 0 0 3.503 3.504h32.878a3.515 3.515 0 0 0 3.504-3.504V162.48a3.515 3.515 0 0 0-3.504-3.504m12.205 18.28h32.586a3.64 3.64 0 0 1 3.621 3.62v19.388a3.64 3.64 0 0 1-3.621 3.621h-32.586a3.64 3.64 0 0 1-3.62-3.621v-19.388a3.64 3.64 0 0 1 3.62-3.62"}),(0,r.jsx)("path",{stroke:"#2EE5C0",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M134.275 171.532h-113c-5.84 0-10.628-4.789-10.628-10.629v-73.23c0-5.84 4.788-10.629 10.628-10.629h112.941c5.84 0 10.629 4.789 10.629 10.629v73.23c.058 5.899-4.731 10.629-10.57 10.629"}),(0,r.jsx)("path",{fill:"#2EE5C0",d:"M21.625 90.769a3.037 3.037 0 1 0 0-6.074 3.037 3.037 0 0 0 0 6.074M31.494 90.769a3.037 3.037 0 1 0 0-6.074 3.037 3.037 0 0 0 0 6.074M41.363 90.769a3.037 3.037 0 1 0 0-6.074 3.037 3.037 0 0 0 0 6.074"}),(0,r.jsx)("path",{stroke:"#2EE5C0",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M10.822 98.592h133.673"}),(0,r.jsx)("path",{fill:"#027BF3",d:"M184.555 149.164 57.89 156.172c-4.263.234-7.767-3.037-7.767-7.3V51.114c0-4.263 3.504-7.533 7.767-7.3l126.665 7.008c3.27.176 5.898 3.33 5.898 7.008v84.327c0 3.679-2.628 6.832-5.898 7.007"}),(0,r.jsx)("path",{fill:"#fff",d:"M65.13 54.151c0 1.986-1.576 3.504-3.562 3.387-1.985-.058-3.562-1.752-3.562-3.737s1.635-3.504 3.562-3.387c1.927.058 3.562 1.752 3.562 3.737m11.506.466a3.38 3.38 0 0 1-3.504 3.388c-1.927-.059-3.504-1.753-3.504-3.68a3.38 3.38 0 0 1 3.504-3.387c1.927.117 3.504 1.752 3.504 3.68m7.825 3.855c1.869.117 3.387-1.402 3.387-3.329s-1.518-3.562-3.387-3.62c-1.927-.117-3.445 1.401-3.445 3.328s1.576 3.562 3.445 3.62"}),(0,r.jsx)("path",{fill:"#00236B",d:"M75.467 142.974V85.277c-3.971-.525-8.584-.409-13.899.7v57.64zM88.84 90.651v51.799l-11.096.467v-57.23c4.322.934 7.942 2.745 11.096 4.964m13.431 13.899a2 2 0 0 1-.146-.176 1.5 1.5 0 0 0-.146-.175q-.63-.765-1.265-1.546c-2.875-3.522-5.874-7.197-9.538-10.25v49.93l11.095-.467zm13.432 5.722c-3.913-.058-7.709-.701-11.096-3.445v34.922l11.096-.468zm13.431-.409c-2.764-.173-5.529.006-8.246.181-.957.062-1.907.123-2.849.169v30.951l11.095-.467zm24.002 29.841-8.234.35v-22.191c8.176 9.285 8.234 21.841 8.234 21.841M140.113 113.6a20 20 0 0 1 2.453 1.927v24.644l-11.096.467v-30.483c2.92.467 5.782 1.46 8.643 3.445"}),(0,r.jsx)("path",{fill:"#fff",d:"M55.745 76.436a2 2 0 1 0 3.123 2.499zm5.766-4.006 1.575-1.233a2 2 0 0 0-3.136-.017zm2.63 6.605a2 2 0 1 0 3.15-2.465zm107.94 53.502a2 2 0 0 0-2.499 3.123zm4.006 5.766 1.214 1.59a2 2 0 0 0 .036-3.151zm-6.644 2.557a1.999 1.999 0 1 0 2.427 3.179zM58.868 78.935l4.205-5.256-3.123-2.499-4.205 5.256zm1.068-5.273 4.205 5.373 3.15-2.465-4.205-5.373zm109.646 61.998 5.256 4.205 2.499-3.123-5.256-4.205zm5.292 1.054-5.431 4.146 2.427 3.179 5.431-4.146zM147.137 69.146a2 2 0 1 0-.149 3.998zm29.634 5.107a2 2 0 1 0 .149-3.997zm-29.657 5.404a2 2 0 0 0-.102 3.999zm29.681 4.758a2 2 0 0 0 .102-3.999zm-29.72 5.929a2 2 0 1 0-.023 4zm29.759 4.175a2 2 0 1 0 .024-4zm-29.846-21.375 29.783 1.11.149-3.998-29.783-1.11zm.024 10.512 29.783.76.102-4-29.783-.759zm.04 10.687 29.782.176.024-4-29.783-.175zM143.442 71.202a2.46 2.46 0 0 1-2.57 2.453c-1.401-.058-2.569-1.285-2.569-2.686s1.168-2.57 2.569-2.453c1.46.058 2.57 1.285 2.57 2.686m.001 10.396a2.46 2.46 0 0 1-2.57 2.453c-1.401-.059-2.569-1.285-2.569-2.686 0-1.46 1.168-2.57 2.569-2.453 1.46.058 2.57 1.284 2.57 2.686m-2.57 12.848a2.46 2.46 0 0 0 2.57-2.453c0-1.402-1.11-2.628-2.57-2.686-1.401-.117-2.569 1.05-2.569 2.452s1.168 2.628 2.569 2.687"}),(0,r.jsx)("path",{fill:"#00236B",d:"M190.452 91.875V57.771c0-3.68-2.628-6.833-5.899-7.008l-23.651-1.285a35.2 35.2 0 0 0-1.752 10.98c0 17.635 12.79 31.826 28.09 31.65 1.051.06 2.16-.058 3.212-.233",opacity:.2}),(0,r.jsx)("path",{fill:"#FF4645",d:"M220.645 58.883c0-16.585-11.621-30.775-26.454-31.651-15.3-.876-28.089 12.672-28.089 30.308s12.789 31.827 28.089 31.652c14.833-.117 26.454-13.724 26.454-30.309"}),(0,r.jsx)("path",{fill:"#FC0",d:"M215.329 40.372c-4.788-7.475-12.38-12.614-21.14-13.14v31.01z"}),(0,r.jsx)("path",{fill:"#00236B",d:"m215.329 40.372-21.14 17.87 26.455.642c0-6.89-1.986-13.315-5.315-18.512"}),(0,r.jsx)("path",{fill:"#FF4645",d:"M194.248 58.24V27.233c-15.301-.876-28.09 12.672-28.09 30.308z"}),(0,r.jsx)("path",{fill:"#2EE5C0",d:"M161.151 14.734a2 2 0 1 0-4 0zm-4 4.204a2 2 0 0 0 4 0zm4 8.876a2 2 0 1 0-4 0zm-4 4.555a2 2 0 0 0 4 0zm10.819-6.816a2 2 0 0 0 0-4zm-4.263-4a2 2 0 1 0 0 4zm-9.169 4a2 2 0 1 0 0-4zm-4.263-4a2 2 0 0 0 0 4zm6.876-6.82v4.205h4v-4.204zm0 13.08v4.556h4v-4.555zm10.819-6.26h-4.263v4h4.263zm-13.432 0h-4.263v4h4.263z"})]}),o9=(0,c.cn)("network");function ce({database:e,databaseFullPath:t}){let[a]=(0,j.Nt)(),{withProblems:s,handleWithProblemsChange:i}=o3(),[l,o]=n.useState(),[c,d]=n.useState(!1),[u,p]=n.useState(!1),{currentData:m,isFetching:h,error:g}=o2.useGetNetworkInfoQuery({database:e,databaseFullPath:t},{pollingInterval:a});if(h&&void 0===m)return(0,r.jsx)("div",{className:"loader",children:(0,r.jsx)(oX.a,{size:"l"})});let x=(m?.Tenants&&m.Tenants[0].Nodes)??[];if(!g&&0===x.length)return(0,r.jsx)("div",{className:"error",children:"no nodes data"});let y=ca(x,"NodeType"),f=l?ca(l.Peers??[],"NodeType"):{};return(0,r.jsxs)("div",{className:o9(),children:[g?(0,r.jsx)(q.o,{error:g}):null,x.length>0?(0,r.jsx)("div",{className:o9("inner"),children:(0,r.jsxs)("div",{className:o9("nodes-row"),children:[(0,r.jsxs)("div",{className:o9("left"),children:[(0,r.jsx)("div",{className:o9("controls-wrapper"),children:(0,r.jsxs)("div",{className:o9("controls"),children:[(0,r.jsx)(o1.k,{value:s,onChange:i,className:o9("problem-filter")}),(0,r.jsx)("div",{className:o9("checkbox-wrapper"),children:(0,r.jsx)(O.S,{onUpdate:()=>{d(!c)},checked:c,children:"ID"})}),(0,r.jsx)("div",{className:o9("checkbox-wrapper"),children:(0,r.jsx)(O.S,{onUpdate:()=>{p(!u)},checked:u,children:"Racks"})})]})}),(0,r.jsx)(ct,{nodes:y,showId:c,showRacks:u,clickedNode:l,onClickNode:o})]}),(0,r.jsx)("div",{className:o9("right"),children:l?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:o9("label"),children:["Connectivity of node"," ",(0,r.jsx)(sB.N_,{className:o9("link"),to:(0,B.vI)({id:l.NodeId}),children:l.NodeId})," ","to other nodes"]}),(0,r.jsx)("div",{className:o9("nodes-row"),children:(0,r.jsx)(ct,{nodes:f,isRight:!0,showId:c,showRacks:u,clickedNode:l,onClickNode:o})})]}):(0,r.jsxs)("div",{className:o9("placeholder"),children:[(0,r.jsx)("div",{className:o9("placeholder-img"),children:(0,r.jsx)(ek.I,{data:o8,width:221,height:204})}),(0,r.jsx)("div",{className:o9("placeholder-text"),children:"Select node to see its connectivity to other nodes"})]})})]})}):null]})}function ct({nodes:e,isRight:t,showId:a,showRacks:n,clickedNode:s,onClickNode:i}){let{withProblems:l}=o3(),o=(0,j.YQ)(),c=0,d=Object.keys(e).map((d,u)=>{let p=ca(e[d],"Rack");return(0,r.jsxs)("div",{className:o9("nodes-container",{right:t}),children:[(0,r.jsxs)("div",{className:o9("nodes-title"),children:[d," nodes"]}),(0,r.jsx)("div",{className:o9("nodes"),children:n?Object.keys(p).map((e,n)=>(0,r.jsxs)("div",{className:o9("rack-column"),children:[(0,r.jsx)("div",{className:o9("rack-index"),children:"undefined"===e?"?":e}),p[e].map((e,n)=>{let d,u;return(!t&&"Peers"in e&&e.Peers&&(d=Object.keys(e.Peers).length,u=o7(e.Peers)),l&&d!==u||!l||t)?(c++,(0,r.jsx)(o6,{nodeId:e.NodeId,showID:a,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:d,connected:u,onMouseEnter:(...e)=>{o((0,F.DK)(...e))},onMouseLeave:()=>{o((0,F.w7)())},onClick:t?void 0:()=>{i(s&&e.NodeId===s.NodeId?void 0:e)},isBlurred:!t&&s&&s.NodeId!==e.NodeId},n)):null})]},n)):e[d].map((e,n)=>{let d,u,p=e&&"Peers"in e?e.Peers:void 0;return(!t&&"Peers"in e&&e.Peers&&(d=e.Peers.length,u=o7(p)),l&&d!==u||!l||t)?(c++,(0,r.jsx)(o6,{nodeId:e.NodeId,showID:a,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:p?.length,connected:u,onMouseEnter:(...e)=>{o((0,F.DK)(...e))},onMouseLeave:()=>{o((0,F.w7)())},onClick:t?void 0:()=>{i(s&&e.NodeId===s.NodeId?void 0:e)},isBlurred:!t&&s&&s.NodeId!==e.NodeId},n)):null})})]},u)});return l&&0===c?(0,r.jsx)(o0.v,{name:"thumbsUp",width:200}):d}function ca(e,t){return e.reduce((e,a)=>(e[a[t]]?e[a[t]].push(a):e[a[t]]=[a],e),{})}function cr({database:e,path:t,databaseFullPath:a,scrollContainerRef:n}){let s=(0,I.Pm)(),i=(0,oZ.b)();return(0,r.jsx)(l.r,{loading:!s,children:i?(0,r.jsx)(oK.x,{path:t,databaseFullPath:a,database:e,scrollContainerRef:n}):(0,r.jsx)(ce,{database:e,databaseFullPath:a})})}var cn=a(18117),cs=a(31596),ci=a(56321),cl=a(71350),co=a(29472),cc=JSON.parse('{"lagsPopover.writeLags":"Write lags statistics (time format dd hh:mm:ss)","lagsPopover.readLags":"Read lags statistics (time format dd hh:mm:ss)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"Consumer:","controls.consumerSelector.emptyOption":"No consumer","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"No partitions match the current search","noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers"}'),cd=JSON.parse('{"lagsPopover.writeLags":"Статистика лагов записи (формат времени дд чч:мм:сс)","lagsPopover.readLags":"Статистика лагов чтения (формат времени дд чч:мм:сс)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"Читатель:","controls.consumerSelector.emptyOption":"Нет читателя","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"По заданному поиску нет партиций","noConsumersMessage.topic":"У этого топика нет читателей","noConsumersMessage.stream":"У этого стрима нет читателей"}');let cu=(0,ex.g4)("ydb-diagnostics-partitions",{ru:cd,en:cc}),cp=({consumers:e,selectedConsumer:t,onSelectedConsumerChange:a,selectDisabled:s,partitions:i,onSearchChange:l})=>{let[o,c]=n.useState(""),[d,u]=n.useState("");n.useEffect(()=>{if(!i)return;let e=RegExp(ay()(d),"i"),t=RegExp(ay()(o),"i");l(i.filter(a=>{let{partitionId:r,readerName:n,readSessionId:s,partitionNodeId:i,connectionNodeId:l,partitionHost:o,connectionHost:c}=a,d=e.test(String(r)),u=[n,s,i,l,o,c].filter(Boolean).map(String),p=0===u.length||u.some(e=>t.test(e));return d&&p}))},[d,o,i,l]);let p=n.useMemo(()=>{let t=e&&e.length?e.map(e=>({value:e,content:e})):[];return[{value:"",content:cu("controls.consumerSelector.emptyOption")},...t]},[e]),m=e=>(0,r.jsx)("div",{className:cR("select-option",{empty:""===e.value}),children:e.content});return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(M.l,{className:cR("consumer-select"),label:cu("controls.consumerSelector"),options:p,value:[t||""],onUpdate:e=>{a(e[0]||void 0)},filterable:e&&e.length>5,disabled:s||!e||!e.length,renderOption:m,renderSelectedOption:m}),(0,r.jsx)(co.v,{onChange:e=>{u(e)},placeholder:cu("controls.partitionSearch"),className:cR("search",{partition:!0}),value:d}),(0,r.jsx)(co.v,{onChange:e=>{c(e)},placeholder:cu("controls.generalSearch"),className:cR("search",{general:!0}),value:o})]})},cm=(0,c.cn)("ydb-multiline-table-header");function ch({title:e}){return e?(0,r.jsx)("div",{className:cm(),children:e}):null}let cg={PARTITION_ID:"partitionId",STORE_SIZE:"storeSize",WRITE_SPEED:"writeSpeed",READ_SPEED:"readSpeed",WRITE_LAGS:"writeLags",READ_LAGS:"readLags",UNCOMMITED_MESSAGES:"uncommitedMessages",UNREAD_MESSAGES:"unreadMessages",START_OFFSET:"startOffset",END_OFFSET:"endOffset",COMMITED_OFFSET:"commitedOffset",READ_SESSION_ID:"readSessionId",READER_NAME:"readerName",PARTITION_HOST:"partitionHost",CONNECTION_HOST:"connectionHost"},cx={[cg.PARTITION_ID]:"Partition ID",[cg.STORE_SIZE]:"Store size",[cg.WRITE_SPEED]:"Write speed",[cg.READ_SPEED]:"Read speed",[cg.WRITE_LAGS]:"Write lags, duration",[cg.READ_LAGS]:"Read lags, duration",[cg.UNCOMMITED_MESSAGES]:"Uncommited messages",[cg.UNREAD_MESSAGES]:"Unread messages",[cg.START_OFFSET]:"Start offset",[cg.END_OFFSET]:"End offset",[cg.COMMITED_OFFSET]:"Commited offset",[cg.READ_SESSION_ID]:"Read session ID",[cg.READER_NAME]:"Reader name",[cg.PARTITION_HOST]:"Partition host",[cg.CONNECTION_HOST]:"Connection host"},cy="partitionWriteLag",cf="partitionWriteIdleTime",cb={[cy]:"write lag",[cf]:"write idle time"},cv="consumerWriteLag",cj="consumerReadLag",cT="consumerReadIdleTime",cw={[cv]:"write lag",[cj]:"read lag",[cT]:"read idle time"},cS=[cg.PARTITION_ID,cg.STORE_SIZE,cg.WRITE_SPEED,cg.WRITE_LAGS,cg.START_OFFSET,cg.END_OFFSET,cg.PARTITION_HOST],cE=Object.values(cg),c_=(0,c.cn)("ydb-diagnostics-partitions-columns-header"),cN=(0,c.cn)("ydb-diagnostics-partitions-columns"),cC=[{name:cg.PARTITION_ID,header:(0,r.jsx)(ch,{title:cx[cg.PARTITION_ID]}),sortAccessor:e=>(0,np.kf)(e.partitionId)&&Number(e.partitionId),align:tg.Ay.LEFT,render:({row:e})=>(0,r.jsx)(cA,{id:String(e.partitionId)})},{name:cg.STORE_SIZE,header:(0,r.jsx)(ch,{title:cx[cg.STORE_SIZE]}),sortAccessor:e=>(0,np.kf)(e.storeSize)&&Number(e.storeSize),align:tg.Ay.RIGHT,render:({row:e})=>(0,Q.z3)(e.storeSize)},{name:cg.WRITE_SPEED,header:cx[cg.WRITE_SPEED],align:tg.Ay.LEFT,resizeMinWidth:140,sortAccessor:e=>e.writeSpeed.perMinute,render:({row:e})=>(0,r.jsx)(aA,{data:e.writeSpeed})},{name:cg.READ_SPEED,header:cx[cg.READ_SPEED],align:tg.Ay.LEFT,resizeMinWidth:140,sortAccessor:e=>e.readSpeed?.perMinute,render:({row:e})=>(0,r.jsx)(aA,{data:e.readSpeed})},{name:cg.WRITE_LAGS,header:(0,r.jsx)(()=>(0,r.jsx)(aF,{className:c_("lags"),text:cx[cg.WRITE_LAGS],popoverContent:(0,r.jsx)(aK,{text:cu("lagsPopover.writeLags"),type:"write"})}),{}),className:cN("lags-header"),sub:[{name:cy,header:cb[cy],align:tg.Ay.RIGHT,render:({row:e})=>(0,Q.uH)(e.partitionWriteLag)},{name:cf,header:cb[cf],align:tg.Ay.RIGHT,render:({row:e})=>(0,Q.uH)(e.partitionWriteIdleTime)}]},{name:cg.READ_LAGS,header:(0,r.jsx)(()=>(0,r.jsx)(aF,{className:c_("lags"),text:cx[cg.READ_LAGS],popoverContent:(0,r.jsx)(aK,{text:cu("lagsPopover.readLags"),type:"read"})}),{}),className:cN("lags-header"),sub:[{name:cv,header:cw[cv],align:tg.Ay.RIGHT,render:({row:e})=>(0,Q.uH)(e.consumerWriteLag)},{name:cj,header:cw[cj],align:tg.Ay.RIGHT,render:({row:e})=>(0,Q.uH)(e.consumerReadLag)},{name:cT,header:cw[cT],align:tg.Ay.RIGHT,render:({row:e})=>(0,Q.uH)(e.consumerReadIdleTime)}]},{name:cg.UNCOMMITED_MESSAGES,header:(0,r.jsx)(()=>(0,r.jsx)(aF,{className:c_("messages"),text:cx[cg.UNCOMMITED_MESSAGES],popoverContent:(0,r.jsx)("div",{className:c_("messages-popover-content"),children:cu("headers.uncommited")})}),{}),align:tg.Ay.RIGHT,render:({row:e})=>e.uncommitedMessages},{name:cg.UNREAD_MESSAGES,header:(0,r.jsx)(()=>(0,r.jsx)(aF,{className:c_("messages"),text:cx[cg.UNREAD_MESSAGES],popoverContent:(0,r.jsx)("div",{className:c_("messages-popover-content"),children:cu("headers.unread")})}),{}),align:tg.Ay.RIGHT,render:({row:e})=>e.unreadMessages},{name:cg.START_OFFSET,header:(0,r.jsx)(ch,{title:cx[cg.START_OFFSET]}),sortAccessor:e=>(0,np.kf)(e.startOffset)&&Number(e.startOffset),align:tg.Ay.RIGHT,render:({row:e})=>e.startOffset},{name:cg.END_OFFSET,header:(0,r.jsx)(ch,{title:cx[cg.END_OFFSET]}),sortAccessor:e=>(0,np.kf)(e.endOffset)&&Number(e.endOffset),align:tg.Ay.RIGHT,render:({row:e})=>e.endOffset},{name:cg.COMMITED_OFFSET,header:(0,r.jsx)(ch,{title:cx[cg.COMMITED_OFFSET]}),sortAccessor:e=>(0,np.kf)(e.commitedOffset)&&Number(e.commitedOffset),align:tg.Ay.RIGHT,render:({row:e})=>e.commitedOffset},{name:cg.READ_SESSION_ID,header:(0,r.jsx)(()=>(0,r.jsx)("div",{className:c_("read-session"),children:cx[cg.READ_SESSION_ID]}),{}),align:tg.Ay.LEFT,width:150,render:({row:e})=>e.readSessionId?(0,r.jsx)(nS.c,{name:e.readSessionId,showStatus:!1,hasClipboardButton:!0}):v.Pd},{name:cg.READER_NAME,header:(0,r.jsx)(ch,{title:cx[cg.READER_NAME]}),align:tg.Ay.LEFT,width:150,render:({row:e})=>e.readerName?(0,r.jsx)(nS.c,{name:e.readerName,showStatus:!1,hasClipboardButton:!0}):v.Pd},{name:cg.PARTITION_HOST,header:(0,r.jsx)(ch,{title:cx[cg.PARTITION_HOST]}),align:tg.Ay.LEFT,width:200,render:({row:e})=>e.partitionNodeId&&e.partitionHost?(0,r.jsx)(cP,{host:e.partitionHost,id:e.partitionNodeId}):v.Pd},{name:cg.CONNECTION_HOST,header:(0,r.jsx)(ch,{title:cx[cg.CONNECTION_HOST]}),align:tg.Ay.LEFT,width:200,render:({row:e})=>e.connectionNodeId&&e.connectionHost?(0,r.jsx)(cP,{host:e.connectionHost,id:e.connectionNodeId}):v.Pd}];function cP({host:e,id:t}){return(0,r.jsx)(nS.c,{name:e,path:(0,B.vI)({id:t}),showStatus:!1,hasClipboardButton:!0})}let cI=cC.filter(e=>cS.includes(e.name));function cA({id:e}){let t=iR(),a=(0,I._p)();return(0,r.jsx)(nS.c,{name:e,path:a?t(E.iJ.topicData,{selectedPartition:e}):void 0,showStatus:!1})}var cD=a(33702);let cR=(0,c.cn)("ydb-diagnostics-partitions"),ck=({path:e,database:t,databaseFullPath:a})=>{let s=(0,j.YQ)(),[i,l]=n.useState([]),o=(0,j.N4)(r=>aw(r,e,t,a)),[c]=(0,j.Nt)(),{selectedConsumer:d}=(0,j.N4)(e=>e.partitions),{currentData:u,isFetching:p,error:m}=ab.useGetTopicQuery({path:e,database:t,databaseFullPath:a}),h=p&&void 0===u,{currentData:g,isFetching:x,error:y}=ci.m.useGetNodesListQuery({database:t},void 0),f=(0,j.N4)(e=>(0,ci.K)(e,t)),{columnsToShow:b,columnsToSelect:T,setColumns:w}=(e=>{let{columnsToShow:t,columnsToSelect:a,setColumns:r}=(0,cD.K)(cC,"partitionsSelectedColumns",cx,cE,[cg.PARTITION_ID]),{columnsToShow:s,columnsToSelect:i,setColumns:l}=(0,cD.K)(cI,"generalPartitionsSelectedColumns",cx,cS,[cg.PARTITION_ID]);return n.useMemo(()=>e?{columnsToShow:t,columnsToSelect:a,setColumns:r}:{columnsToShow:s,columnsToSelect:i,setColumns:l},[a,t,i,s,e,r,l])})(d),S=h?cn.hT:{path:e,database:t,consumerName:d,databaseFullPath:a},{currentData:E,isFetching:_,error:N}=cl.aD.useGetPartitionsQuery(S,{pollingInterval:c}),C=_&&void 0===E,P=n.useMemo(()=>((e=[],t)=>e?.map(e=>{let a=e.partitionNodeId&&t?t.get(e.partitionNodeId)?.Host:void 0,r=e.connectionNodeId&&t?t.get(e.connectionNodeId)?.Host:void 0;return{...e,partitionHost:a,connectionHost:r}}))(E,f),[E,f]);n.useEffect(()=>{let e=!h&&!o,t=d&&o&&!o.includes(d);(e||t)&&s((0,cl.WD)(void 0))},[s,h,d,o]);let I=h||x&&void 0===g||C,A=y||m||N;return(0,r.jsxs)(eh.L,{className:cR(),children:[(0,r.jsx)(eh.L.Controls,{renderExtraControls:()=>(0,r.jsx)(cs.O,{items:T,showStatus:!0,onUpdate:w}),children:(0,r.jsx)(cp,{consumers:o,selectedConsumer:d,onSelectedConsumerChange:e=>{s((0,cl.WD)(e))},selectDisabled:!!A||I,partitions:P,onSearchChange:l})}),(0,r.jsxs)(eh.L.Table,{children:[A?(0,r.jsx)(q.o,{error:A}):null,E?(0,r.jsx)(ep.l,{columnsWidthLSKey:"partitionsColumnsWidth",wrapperClassName:cR("table"),data:i,columns:b,isLoading:I,settings:v.N3,emptyDataMessage:cu("table.emptyDataMessage")}):null]})]})};var cM=a(81392);let cO=eG.z.enum([lP,lN,lI]).catch(lP),cq={columnId:lP,order:tg.Ay.DESCENDING},cL=(0,c.cn)("kv-top-queries"),cz=({database:e,renderQueryModeControl:t,handleTextSearchUpdate:a})=>{let[s]=(0,j.Nt)(),i=(0,j.N4)(e=>e.executeTopQueries),l=n.useMemo(()=>[lV,lW,lY,lU,lZ].map(e=>({...e,sortable:!!lz(e.name)})),[]),{columnsToShow:o,columnsToSelect:c,setColumns:d}=(0,cD.K)(l,"runningQueriesSelectedColumns",lM,lR,lk),{tableSort:u,handleTableSort:p,backendSort:m}=function(){let{sortParam:e,updateSortParam:t}=l0({paramName:"runningSort",schema:cO,defaultSort:cq}),[a,r]=(0,j.GY)({initialSortColumn:e?.[0]?.columnId||cq.columnId,initialSortOrder:e?.[0]?.order||cq.order,multiple:!0,onSort:t});return{tableSort:a,handleTableSort:r,backendSort:n.useMemo(()=>(0,j.JN)(a,lz),[a])}}(),{currentData:h,isFetching:g,isLoading:x,error:y}=sl.Ke.useGetRunningQueriesQuery({database:e,filters:i,sortOrder:m},{pollingInterval:s}),f=h?.resultSets?.[0]?.result,b=n.useRef(null);return(0,r.jsxs)(eh.L,{children:[(0,r.jsxs)(eh.L.Controls,{renderExtraControls:()=>(0,r.jsx)(cs.O,{popupWidth:200,items:c,showStatus:!0,onUpdate:d}),children:[t(),(0,r.jsx)(eg.v,{value:i.text,onChange:a,placeholder:ld("filter.text.placeholder"),className:cL("search"),inputRef:b})]}),y?(0,r.jsx)(q.o,{error:(0,eK.Cb)(y)}):null,(0,r.jsx)(eh.L.Table,{children:(0,r.jsx)(lb,{columns:o,data:f||[],isFetching:g&&void 0===h,isLoading:x,columnsWidthLSKey:"runningQueriesColumnsWidth",emptyDataMessage:ld("no-data"),sortOrder:u,onSort:p,drawerId:"running-query-details",storageKey:"running-queries-drawer-width",tableSettings:lo})})]})};var cF=a(77893),cQ=a(82586),cU=JSON.parse('{"date-format":"MM/DD/YYYY","date-time-format":"MM/DD/YYYY HH:mm"}'),c$=JSON.parse('{"date-format":"DD.MM.YYYY","date-time-format":"DD.MM.YYYY HH:mm"}');let cG=(0,ex.g4)("ydb-date-range",{ru:c$,en:cU});var cH=a(54694);let cB=(0,c.cn)("date-range"),cW=({from:e,to:t,className:a,defaultValue:s,onChange:i})=>{let l=n.useCallback(e=>i?.({from:e?.start?.type==="relative"?e.start.value.toString():String((0,cH.dateTimeParse)(e?.start?.value)?.valueOf()),to:e?.end?.type==="relative"?e.end.value.toString():String((0,cH.dateTimeParse)(e?.end?.value)?.valueOf())}),[i]),o=n.useMemo(()=>{if(e||t){var a;let r,n;return a={from:e,to:t},r=(0,cH.isLikeRelative)(a.from??""),n=(0,cH.isLikeRelative)(a.to??""),{start:a.from?{type:r?"relative":"absolute",value:r?a.from:(0,cH.dateTimeParse)(Number(a.from))}:null,end:a.to?{type:n?"relative":"absolute",value:n?a.to:(0,cH.dateTimeParse)(Number(a.to))}:null}}},[e,t]),c=Intl.DateTimeFormat().resolvedOptions().timeZone,d=o||s;return(0,r.jsx)("div",{className:cB(null,a),children:(0,r.jsx)(cF.k,{withPresets:!0,className:cB("range-input",{[d?.start?.type==="relative"&&d?.end?.type==="relative"?"s":d?.start?.type==="relative"||d?.end?.type==="relative"?"m":"l"]:!0}),timeZone:c,value:d,allowNullableValues:!0,size:"m",format:cG("date-time-format"),onUpdate:l,placeholder:`${cG("date-time-format")} - ${cG("date-time-format")}`,withApplyButton:!0,docs:cQ.p2,withHeader:!0})})},cV={hour:"hour",minute:"minute"},cJ=[{value:cV.hour,content:ld("timeframe_hour")},{value:cV.minute,content:ld("timeframe_minute")}],cY={start:{value:"now-6h",type:"relative"},end:{value:"now",type:"relative"}};function cK(e){let t=ln(String(e.QueryText));return{rank:String(e.Rank),intervalEnd:String(e.IntervalEnd),endTime:String(e.EndTime),queryHash:t}}let cZ=(0,c.cn)("kv-top-queries"),cX=({database:e,timeFrame:t,renderQueryModeControl:a,handleTimeFrameChange:s,handleDateRangeChange:i,handleTextSearchUpdate:l})=>{let[o]=(0,j.Nt)(),c=(0,j.N4)(e=>e.executeTopQueries),[d,u]=n.useState(void 0),p=n.useRef(null),m=n.useMemo(()=>[lV,lQ,lJ,lB,lK,lU,lG,lH,lW].map(e=>({...e,sortable:!!lL(e.name),defaultOrder:tg.Ay.DESCENDING})),[]),{columnsToShow:h,columnsToSelect:g,setColumns:x}=(0,cD.K)(m,"topQueriesSelectedColumns",lM,lA,lD),{tableSort:y,handleTableSort:f,backendSort:b}=l3(),{currentData:v,isFetching:T,isLoading:w,error:S}=sl.Ke.useGetTopQueriesQuery({database:e,filters:c,sortOrder:b,timeFrame:t},{pollingInterval:o}),E=v?.resultSets?.[0]?.result;!function(e,t){let[a,r]=(0,e$.useQueryParams)({selectedRow:e$.StringParam});n.useEffect(()=>{if(t&&a.selectedRow){let n=JSON.parse(decodeURIComponent(a.selectedRow)),s=t.find(e=>{let t=cK(e);return t.rank===n.rank&&t.intervalEnd===n.intervalEnd&&t.endTime===n.endTime&&n.queryHash===t.queryHash});s?e(s):e(null),r({selectedRow:void 0})}},[a.selectedRow,r,t,e])}(u,E);let _=n.useMemo(()=>({...lo,dynamicInnerRef:p}),[]);!function({selectedRow:e,rows:t,reactListRef:a}){n.useEffect(()=>{if(e&&t&&a.current){let r=t.findIndex(t=>(0,eU.isEqual)(t,e));if(-1!==r){let e=a.current;try{let[t,a]=e.getVisibleRange();r>=t&&r<=a||e.scrollTo(r-1)}catch{e.scrollAround(r)}}}},[e,t,a])}({selectedRow:d,rows:E,reactListRef:p});let N=void 0!==d,C=n.useCallback(()=>{if(d){let e,t,a;return e=cK(d),(a=new URLSearchParams((t=new URL(window.location.href)).search)).set("selectedRow",encodeURIComponent(JSON.stringify({rank:e.rank||void 0,intervalEnd:e.intervalEnd||void 0,endTime:e.endTime||void 0,queryHash:e.queryHash||void 0}))),t.search=a.toString(),t.toString()}return""},[d]),P=n.useRef(null);n.useEffect(()=>{N&&P.current?.blur()},[N]);let I=n.useMemo(()=>[{type:"copyLink",link:C()},{type:"close"}],[C]);return(0,r.jsxs)(eh.L,{children:[(0,r.jsxs)(eh.L.Controls,{renderExtraControls:()=>(0,r.jsx)(cs.O,{popupWidth:200,items:g,showStatus:!0,onUpdate:x}),children:[a(),(0,r.jsx)(M.l,{options:cJ,value:[t],onUpdate:s}),(0,r.jsx)(cW,{from:c.from,to:c.to,onChange:i,defaultValue:cY}),(0,r.jsx)(eg.v,{value:c.text,inputRef:P,onChange:l,placeholder:ld("filter.text.placeholder"),className:cZ("search")})]}),S?(0,r.jsx)(q.o,{error:(0,eK.Cb)(S)}):null,(0,r.jsx)(eh.L.Table,{children:(0,r.jsx)(lb,{columns:h,data:E||[],isFetching:T&&void 0===v,isLoading:w,columnsWidthLSKey:lT,emptyDataMessage:ld("no-data"),sortOrder:y,onSort:f,selectedRow:d,onSelectedRowChange:u,drawerControls:I,drawerId:"query-details",storageKey:"kv-top-queries-drawer-width",tableSettings:_})})]})},c0={top:"top",running:"running"},c1=eG.z.nativeEnum(c0).catch(c0.top),c2=eG.z.nativeEnum(cV).catch(cV.hour),c3=({database:e})=>{let t=(0,j.YQ)(),[a=c0.top,s]=(0,e$.useQueryParam)("queryMode",e$.StringParam),[i=cV.hour,l]=(0,e$.useQueryParam)("timeFrame",e$.StringParam),o=c1.parse(a),c=c2.parse(i),d=o===c0.top,u=e=>{t((0,sl.TX)({text:e}))},p=n.useCallback(()=>(0,r.jsxs)(cM.x,{value:o,onUpdate:s,children:[(0,r.jsx)(cM.x.Option,{value:c0.top,children:ld("mode_top")}),(0,r.jsx)(cM.x.Option,{value:c0.running,children:ld("mode_running")})]}),[o,s]);return d?(0,r.jsx)(cX,{database:e,timeFrame:c,renderQueryModeControl:p,handleTimeFrameChange:e=>{l(e[0],"replaceIn")},handleDateRangeChange:e=>{t((0,sl.TX)(e))},handleTextSearchUpdate:u}):(0,r.jsx)(cz,{database:e,renderQueryModeControl:p,handleTextSearchUpdate:u})};var c4=a(43409),c5=a(46216),c6=JSON.parse('{"no-data":"No data","filters.mode.immediate":"Immediate","filters.mode.history":"Historical","description":"Historical data only tracks shards with CPU load over 70%"}'),c7=JSON.parse('{"no-data":"Нет данных","filters.mode.immediate":"Мгновенные","filters.mode.history":"Исторические","description":"Исторические данные хранятся только о шардах с загрузкой CPU выше 70%"}');let c8=(0,ex.g4)("ydb-diagnostics-top-shards",{ru:c7,en:c6}),c9={start:{value:"now-1h",type:"relative"},end:{value:"now",type:"relative"}},de=({value:e,onChange:t})=>{let a=e.mode===c5.h.Immediate?void 0:e.from,s=e.mode===c5.h.Immediate?void 0:e.to;return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)(cM.x,{value:e.mode,onUpdate:e=>{let a;if(a=c5.h,!Object.values(a).includes(e)){let t=Object.values(c5.h).join(", ");throw Error(`Unexpected TopShards mode "${e}". Should be one of: ${t}`)}t({mode:e})},children:[(0,r.jsx)(cM.x.Option,{value:c5.h.Immediate,children:c8("filters.mode.immediate")}),(0,r.jsx)(cM.x.Option,{value:c5.h.History,children:c8("filters.mode.history")})]}),(0,r.jsx)(cW,{from:a,to:s,onChange:e=>{t({mode:c5.h.History,...e})},defaultValue:c9})]})};var dt=a(83624);let da=(0,c.cn)("top-shards"),dr={...v.N3,dynamicRender:!1,externalSort:!0,disableSortReset:!0,defaultOrder:-1};function dn(e){return e.to="now",e.from="now-1h",e}let ds=({database:e,path:t,databaseFullPath:a})=>{let s=(0,l6.x)("ShardsTable"),i=(0,j.YQ)(),[l]=(0,j.Nt)(),o=(0,j.N4)(e=>e.shardsWorkload),[c,d]=n.useState(()=>{let e={...o};return e.mode||(e.mode=c5.h.Immediate),e.from||e.to||dn(e),e}),{tableSort:u,handleTableSort:p,backendSort:m}=function(){let[e,t]=(0,j.GY)({initialSortColumn:dt.Fk.CPUCores,fixedOrderType:-1,multiple:!0}),a=n.useMemo(()=>(0,j.JN)(e,dt.LK),[e]);return{tableSort:e,handleTableSort:t,backendSort:a}}(),{currentData:h,isFetching:g,error:x}=c4.Xx.useSendShardQueryQuery({database:e,path:t,sortOrder:m,filters:c,databaseFullPath:a},{pollingInterval:l}),y=g&&void 0===h,f=h?.resultSets?.[0]?.result||[],b=n.useMemo(()=>c.mode===c5.h.History?["Path","CPUCores","DataSize","TabletId","NodeId","PeakTime","InFlightTxCount","IntervalEnd"]:["Path","CPUCores","DataSize","TabletId","NodeId","InFlightTxCount"],[c.mode]);return(0,r.jsxs)(eh.L,{children:[(0,r.jsx)(eh.L.Controls,{children:(0,r.jsx)(de,{value:c,onChange:e=>{let t={...e};if(!o.from&&!o.to&&!e.from&&!e.to)switch(e.mode){case c5.h.Immediate:t.from=t.to=void 0;break;case c5.h.History:dn(t)}i((0,c4.rF)(e)),d(e=>({...e,...t}))}})}),c.mode===c5.h.History&&(0,r.jsx)("div",{className:da("hint"),children:c8("description")}),x?(0,r.jsx)(q.o,{error:(0,eK.Cb)(x)}):null,(0,r.jsx)(eh.L.Table,{loading:y,children:x&&!f?null:(0,r.jsx)(s,{databaseFullPath:a,columnsIds:b,data:f,settings:dr,onSort:p,sortOrder:u})})]})};var di=a(34426),dl=a(78799),dc=a(51011),dd=a(58419),du=JSON.parse('{"title_fullscreen":"Fullscreen"}');let dp=(0,ex.g4)("ydb-fullscreen-button",{en:du});function dm({disabled:e,view:t="flat-secondary"}){let a=(0,j.YQ)();return(0,r.jsx)(eR.m,{title:dp("title_fullscreen"),children:(0,r.jsx)(tM.$,{onClick:()=>{a((0,dd.Jf)())},view:t,disabled:e,children:(0,r.jsx)(ek.I,{data:dc.A})})})}var dh=a(77252),dg=a(73439);let dx=e=>(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"M13.383 6.5a.31.31 0 0 0 .305-.305V5.18a.33.33 0 0 0-.305-.305H11.25V2.742a.33.33 0 0 0-.305-.304H9.93a.31.31 0 0 0-.305.304v3.149c0 .355.254.609.61.609zm-7.008-.61V2.743a.33.33 0 0 0-.305-.304H5.055a.31.31 0 0 0-.305.304v2.133H2.617a.31.31 0 0 0-.304.305v1.015c0 .178.126.305.304.305h3.149c.33 0 .609-.254.609-.61m0 7.618v-3.149c0-.33-.28-.609-.61-.609H2.618a.31.31 0 0 0-.304.305v1.015c0 .178.126.305.304.305H4.75v2.133c0 .178.127.305.305.305H6.07a.31.31 0 0 0 .305-.305m4.875 0v-2.133h2.133a.31.31 0 0 0 .305-.305v-1.015a.33.33 0 0 0-.305-.305h-3.149c-.355 0-.609.28-.609.61v3.148c0 .178.127.305.305.305h1.015a.31.31 0 0 0 .305-.305"})}),dy=(0,c.cn)("ydb-fullscreen");function df({children:e,className:t}){let a=(0,j.N4)(e=>e.fullscreen),s=(0,j.YQ)(),i=(0,dg.g)(),l=n.useCallback(()=>{s((0,dd.sM)())},[s]);n.useEffect(()=>{let e=e=>{"Escape"===e.key&&l()};return document.addEventListener("keydown",e,!1),()=>{document.removeEventListener("keydown",e,!1)}},[l]);let[o,c]=n.useState(null);n.useEffect(()=>{let e=document.createElement("div");return i.current?.appendChild(e),e.style.display="contents",c(e),()=>{c(null),e.remove()}},[i]);let d=n.useRef(null);return(n.useLayoutEffect(()=>{o&&(a?i.current?.appendChild(o):d.current?.appendChild(o))},[o,i,a]),(0,dh.u)([a]),o)?(0,r.jsx)("div",{ref:d,style:{display:"contents"},children:(0,r.jsx)(i6,{container:o,children:(0,r.jsxs)("div",{className:dy({fullscreen:a},t),children:[(0,r.jsx)(tM.$,{onClick:l,view:"raised",className:dy("close-button"),children:(0,r.jsx)(ek.I,{data:dx})}),(0,r.jsx)("div",{className:dy("content"),children:e})]})})}):null}var db=a(74104),dv=a(41254),dj=a(282),dT=a(50726),dw=a(45835),dS=a(18159),dE=a(36354);let d_=({onUpdate:e,value:t=null,debounce:a=200,...n})=>{let[s,i]=(0,dE.o)({value:t,onUpdate:e,debounce:a});return(0,r.jsx)(dS.Q,{value:s,onUpdate:i,...n})};var dN=JSON.parse('{"label_offset":"Offset","label_partition":"Partition ID","label_timestamp-create":"Timestamp Create","label_timestamp-write":"Timestamp Write","label_ts_diff":"Write Lag","label_key":"Key","label_metadata":"Metadata","label_message":"Message","label_size":"Size","label_original-size":"Original Size","label_codec":"Codec","label_producerid":"ProducerID","label_seqno":"SeqNo","label_partition-id":"Partition ID: ","context_ts-diff":"Timestamp Write - Timestamp Create, ms","label_full-value":"Full value","label_from":"From: ","label_nothing-found":"Nothing found","description_nothing-found":"Make the filter less strict or start over","action_show-all":"Reset filter","label_by-offset":"By offset","label_by-timestamp":"By timestamp","action_scroll-down":"Scroll to the end","action_scroll-selected":"Scroll to selected offset","action_scroll-up":"Scroll to the start","description_failed-decode":"Failed to decode message","description_truncated":"[truncated]","context_message-not-found":"Message with offset {{offset}} not found","context_get-data-error":"Failed to get message","label_download":"Save message to file","label_truncated":"Truncated {{size}}","description_not-loaded-message":"Message was not fetched in table due to problems with big messages.\\nYou can view it in side panel by clicking on Offset","description_removed-message":"Message was deleted due to retention","description_last-messages":"Only last 50 000 messages from any partition are displayed"}');let dC=(0,ex.g4)("ydb-diagnostics-topic-data",{en:dN}),dP="partition",dI="offset",dA="timestampCreate",dD="timestampWrite",dR="tsDiff",dk="metadata",dM="message",dO="size",dq="originalSize",dL="codec",dz="producerID",dF="seqNo",dQ={get TIMESTAMP(){return dC("label_by-timestamp")},get OFFSET(){return dC("label_by-offset")}},dU=(0,e$.createEnumParam)(["TIMESTAMP","OFFSET"]),d$=(0,e$.withDefault)(dU,"TIMESTAMP");function dG(){let[{selectedPartition:e,selectedOffset:t,startTimestamp:a,topicDataFilter:r,activeOffset:s},i]=(0,e$.useQueryParams)({selectedPartition:e$.StringParam,selectedOffset:e$.NumberParam,startTimestamp:e$.NumberParam,topicDataFilter:d$,activeOffset:e$.StringParam}),l=n.useCallback(e=>{i({selectedPartition:e},"replaceIn")},[i]),o=n.useCallback(e=>{i({selectedOffset:e||void 0},"replaceIn")},[i]),c=n.useCallback(e=>{i({activeOffset:e},"replaceIn")},[i]);return{selectedPartition:e,selectedOffset:t,startTimestamp:a,topicDataFilter:r,activeOffset:s,handleSelectedPartitionChange:l,handleSelectedOffsetChange:o,handleStartTimestampChange:n.useCallback(e=>{i({startTimestamp:e},"replaceIn")},[i]),handleTopicDataFilterChange:n.useCallback(e=>{i({topicDataFilter:e},"replaceIn")},[i]),handleActiveOffsetChange:c}}let dH=(0,c.cn)("ydb-diagnostics-topic-data"),dB={get offset(){return dC("label_offset")},get partition(){return dC("label_partition")},get timestampCreate(){return dC("label_timestamp-create")},get timestampWrite(){return dC("label_timestamp-write")},get tsDiff(){return dC("label_ts_diff")},get key(){return dC("label_key")},get metadata(){return dC("label_metadata")},get message(){return dC("label_message")},get size(){return dC("label_size")},get originalSize(){return dC("label_original-size")},get codec(){return dC("label_codec")},get producerID(){return dC("label_producerid")},get seqNo(){return dC("label_seqno")}},dW={0:"RAW",1:"GZIP",2:"LZOP",3:"ZSTD"};function dV({handlePartitionChange:e,startOffset:t,endOffset:a,partitions:s,partitionsLoading:i,partitionsError:l,scrollToOffset:o,truncatedData:c}){let{selectedPartition:d}=dG(),u=s?.map(({partitionId:e})=>({content:String(e),value:String(e)}));return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(M.l,{className:dH("partition-select"),label:dC("label_partition-id"),options:u,value:d?[d]:void 0,onUpdate:e,filterable:s&&s.length>5,disabled:!s||!s.length,errorPlacement:"inside",errorMessage:(0,t7.$)(l),error:!!l,loading:i}),(0,r.jsx)(dJ,{scrollToOffset:o}),!(0,eU.isNil)(t)&&!(0,eU.isNil)(a)&&a>t&&(0,r.jsxs)(eD.s,{gap:1,children:[(0,r.jsxs)(eA.E,{color:"secondary",whiteSpace:"nowrap",children:[(0,Q.ZV)(t),"—",(0,Q.ZV)(a-1)]}),c&&(0,r.jsx)(az.H,{children:dC("description_last-messages")})]})]})}function dJ({scrollToOffset:e}){let{selectedOffset:t,startTimestamp:a,topicDataFilter:s,activeOffset:i,handleSelectedOffsetChange:l,handleStartTimestampChange:o,handleTopicDataFilterChange:c}=dG(),d=n.useRef(null),u=!(0,eU.isNil)(i);n.useEffect(()=>{u&&d.current?.blur()},[u]);let p=n.useCallback(e=>{"TIMESTAMP"===e?l(void 0):o(void 0),c(e)},[c,l,o]),m=n.useCallback(e=>{l(e)},[l]),h=n.useCallback(e=>{let t;if(e){let{value:a,type:r}=e;if("absolute"===r)t=a.valueOf();else if("relative"===r){let e=(0,cH.dateTimeParse)(a);t=e?e.valueOf():void 0}}o(t)},[o]),g=(0,cH.dateTimeParse)(Number(a));return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)(cM.x,{value:s,onUpdate:p,children:[(0,r.jsx)(cM.x.Option,{value:"TIMESTAMP",children:dQ.TIMESTAMP}),(0,r.jsx)(cM.x.Option,{value:"OFFSET",children:dQ.OFFSET})]}),"OFFSET"===s&&(0,r.jsx)(d_,{controlRef:d,className:dH("offset-input"),max:Number.MAX_SAFE_INTEGER,min:0,value:(0,eU.isNil)(t)?null:(0,np.y3)(t),onUpdate:m,label:dC("label_from"),placeholder:dC("label_offset"),debounce:600,endContent:(0,r.jsx)(eR.m,{title:dC("action_scroll-selected"),children:(0,r.jsx)(tM.$,{disabled:(0,eU.isNil)(t),className:dH("scroll-button"),view:"flat-action",size:"xs",onClick:()=>{t&&e((0,np.y3)(t))},children:(0,r.jsx)(ek.I,{size:14,data:dw.A})})}),autoFocus:!0}),"TIMESTAMP"===s&&(0,r.jsx)(dT.x,{format:"YYYY-MM-DD HH:mm:ss",placeholder:"YYYY-MM-DD HH:mm:ss",hasClear:!0,isDateUnavailable:e=>e.isAfter((0,cH.dateTimeParse)()),label:dC("label_from"),onUpdate:h,defaultValue:g?{type:"absolute",value:g}:null,className:dH("date-picker")})]})}var dY=a(97383),dK=a(66111),dZ=a(58634);function dX(e,t){let a=document.createElement("a");a.href=e,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}let d0=(e,t,a)=>{let r=new Blob([e],{type:a}),n=URL.createObjectURL(r);dX(n,t),URL.revokeObjectURL(n)},d1=(e,t)=>{d0(JSON.stringify(e,null,2),`${t}.json`,"application/json")},d2=(0,c.cn)("ydb-diagnostics-message-details");function d3({children:e,title:t,className:a,renderToolbar:n,scrollContainerRef:s}){return(0,r.jsxs)(eD.s,{direction:"column",className:d2("section",a),children:[(0,r.jsxs)(eD.s,{className:d2("section-title-wrapper"),justifyContent:"space-between",alignItems:"center",children:[t,n?.()]}),(0,r.jsx)("div",{className:d2("section-content"),children:(0,r.jsx)("div",{className:d2("section-scroll-container"),ref:s,children:e})})]})}function d4({offset:e,size:t,message:a,scrollContainerRef:s}){let i=(0,j.N4)(e=>e.fullscreen),{preparedMessage:l,decodedMessage:o,isJson:c}=n.useMemo(()=>{let e=a,r=a;try{r=atob(a)}catch(e){console.warn(e)}try{let t=JSON.parse(r);e=t&&"object"==typeof t?t:r}catch(t){e=r,console.warn(t)}let n=!1;return"object"==typeof e&&1e6>=(0,np.y3)(t)?n=!0:e&&"object"==typeof e&&(e=JSON.stringify(e,null,2)),{preparedMessage:e,decodedMessage:r,isJson:n}},[a,t]),d=c?(0,r.jsx)(rs.p,{collapsedInitially:!0,value:l,toolbarClassName:d2("json-viewer-toolbar"),scrollContainerRef:s},String(i)):(0,r.jsx)("div",{className:d2("string-message"),children:(0,r.jsx)(dZ.A,{value:l,limit:2e3},String(i))}),u=(0,np.y3)(t)>1e7;return(0,r.jsx)(d3,{title:(0,r.jsx)(d5,{truncated:u}),renderToolbar:()=>(0,r.jsxs)(eD.s,{gap:1,children:[(0,r.jsx)(eR.m,{title:dC("label_download"),children:(0,r.jsx)(tM.$,{view:"flat-secondary",onClick:t=>{t.stopPropagation(),d0(o,`topic-message-${e??"unknown-offset"}`)},children:(0,r.jsx)(ek.I,{data:dY.A})})}),(0,r.jsx)(dK.b,{view:"flat-secondary",text:o})]}),className:d2("message"),scrollContainerRef:s,children:d})}function d5({truncated:e}){return(0,r.jsxs)("span",{children:[dC("label_message"),e&&(0,r.jsxs)(n.Fragment,{children:[" ",(0,r.jsxs)(eA.E,{color:"secondary",children:["[",dC("label_truncated",{size:(0,np.IG)(1e7)}),"]"]})]})]})}var d6=a(14204);let d7=(0,c.cn)("ydb-diagnostics-topic-data-columns"),d8={name:dI,header:dB[dI],align:tg.Ay.LEFT,render:({row:e})=>{let{Offset:t,removed:a,notLoaded:n}=e;return(0,r.jsx)(up,{offset:t,removed:a,notLoaded:n})},width:100},d9={name:dA,header:(0,r.jsx)(ch,{title:dB[dA]}),align:tg.Ay.LEFT,render:({row:{CreateTimestamp:e}})=>e?(0,r.jsx)(nS.c,{showStatus:!1,renderName:()=>(0,r.jsx)(uu,{timestamp:e}),name:(0,Q.Ey)(e),hasClipboardButton:!0}):v.Pd,width:220},ue={name:dD,header:(0,r.jsx)(ch,{title:dB[dD]}),align:tg.Ay.LEFT,render:({row:{WriteTimestamp:e}})=>e?(0,r.jsx)(nS.c,{showStatus:!1,renderName:()=>(0,r.jsx)(uu,{timestamp:e}),name:(0,Q.Ey)(e),hasClipboardButton:!0}):v.Pd,width:220},ut={name:dR,header:dB[dR],align:tg.Ay.RIGHT,render:({row:{TimestampDiff:e}})=>(0,r.jsx)(um,{value:e}),width:110,note:dC("context_ts-diff")},ua={name:dk,header:dB[dk],align:tg.Ay.LEFT,render:({row:{MessageMetadata:e}})=>e?e.map(({Key:e="",Value:t=""})=>`${e}: ${t}`).join(", "):v.Pd,width:200},ur={name:dM,header:dB[dM],align:tg.Ay.LEFT,render:({row:{Message:e,OriginalSize:t}})=>(0,r.jsx)(uh,{message:e,size:t}),width:500},un={name:dO,header:dB[dO],align:tg.Ay.RIGHT,render:({row:{StorageSize:e}})=>(0,r.jsx)(ug,{size:e}),width:100},us={name:dq,header:(0,r.jsx)(ch,{title:dB[dq]}),align:tg.Ay.RIGHT,render:({row:e})=>(0,Q.z3)(e.OriginalSize),width:100},ui={name:dL,header:dB[dL],align:tg.Ay.RIGHT,render:({row:{Codec:e}})=>(0,eU.isNil)(e)?v.Pd:dW[e]??e,width:70},ul={name:dz,header:dB[dz],align:tg.Ay.LEFT,render:({row:e})=>e.ProducerId?(0,r.jsx)(nS.c,{showStatus:!1,name:e.ProducerId,hasClipboardButton:!0}):v.Pd,width:100},uo={name:dF,header:dB[dF],align:tg.Ay.RIGHT,render:({row:e})=>e.SeqNo?(0,r.jsx)(nS.c,{showStatus:!1,name:e.SeqNo,hasClipboardButton:!0}):v.Pd,width:100},uc=["offset","timestampCreate","tsDiff","message"],ud=["offset"];function uu({timestamp:e}){if(!e)return v.Pd;let t=(0,Q.Ey)(e).split("."),a=t.pop();return(0,r.jsxs)(eA.E,{variant:"body-2",children:[t.join("."),(0,r.jsxs)(eA.E,{color:"secondary",variant:"body-2",children:[".",a]})]})}function up({offset:e,removed:t,notLoaded:a}){let n=iR(),{handleActiveOffsetChange:s}=dG();if((0,eU.isNil)(e))return v.Pd;if(t)return(0,r.jsx)(eR.m,{title:dC("description_removed-message"),placement:"right",children:(0,r.jsx)(eA.E,{className:d7("offset",{removed:!0}),variant:"body-2",children:e})});let i=n(E.iJ.topicData,{activeOffset:String(e)});return(0,r.jsxs)(sB.N_,{to:i,onClick:t=>{t.stopPropagation(),t.preventDefault(),s(String(e))},className:d7("offset",{link:!0}),children:[(0,r.jsx)(eA.E,{variant:"body-2",color:"info",children:e}),a&&(0,r.jsx)(a_.A,{content:(0,r.jsx)(eA.E,{className:d7("help"),children:dC("description_not-loaded-message")}),className:d7("help-popover"),children:(0,r.jsx)(eA.E,{color:"secondary",className:d7("help-popover"),children:(0,r.jsx)(ek.I,{data:d6.A})})})]})}function um({value:e,baseColor:t="primary",variant:a="body-2"}){if((0,eU.isNil)(e))return v.Pd;let n=(0,np.y3)(e);return(0,r.jsx)(eA.E,{variant:a,color:n>=1e5?"danger":t,children:(0,ez.Xo)(n)})}function uh({message:e,size:t}){let a;if((0,eU.isNil)(e))return v.Pd;let n=!1;try{a=atob(e)}catch{a=dC("description_failed-decode"),n=!0}let s=(0,np.y3)(t)>100;return(0,r.jsxs)(eA.E,{variant:"body-2",color:n?"secondary":"primary",className:d7("message",{invalid:n}),children:[a,s&&(0,r.jsxs)(eA.E,{color:"secondary",className:d7("truncated"),children:[" ",dC("description_truncated")]})]})}function ug({size:e}){return(0,Q.z3)(e)}function ux(e,t=v.Pd){return(0,eU.isNil)(e)?t:e}function uy(){let{selectedPartition:e}=dG();return e}let uf=[{name:dP,header:dB[dP],render:()=>(0,r.jsx)(uy,{})},{name:dI,header:dB[dI],render:({row:e})=>ux(e.Offset)},{name:dA,header:dB[dA],render:({row:e})=>(0,r.jsx)(uu,{timestamp:e.CreateTimestamp})},{name:dD,header:dB[dD],render:({row:e})=>(0,r.jsx)(uu,{timestamp:e.WriteTimestamp})},ut,ua,ur,un,us,ui,{name:dz,header:dB[dz],render:({row:e})=>ux(e.ProducerId)},{name:dF,header:dB[dF],render:({row:e})=>ux(e.SeqNo)}],ub=[[{name:dP},{name:dI},{name:dO}],[{name:dA,copy:e=>(0,Q.Ey)(e.CreateTimestamp)},{name:dD,copy:e=>(0,Q.Ey)(e.WriteTimestamp)},{name:dR}],[{name:dq},{name:dL},{name:dz,copy:e=>e.ProducerId},{name:dF,copy:e=>e.SeqNo}]];function uv({messageData:e}){return(0,r.jsx)(eD.s,{direction:"column",gap:3,className:d2("details"),children:ub.map((t,a)=>(0,r.jsx)(og.u,{className:d2("list"),nameMaxWidth:200,children:t.map(t=>{let a=uf.find(e=>e.name===t.name),n=t.copy?.(e);return(0,r.jsx)(og.u.Item,{name:a?.header,copyText:n,children:a?.render?.({row:e})},t.name)})},a))})}function uj({data:e}){return(0,r.jsx)(d3,{title:dC("label_metadata"),children:(0,r.jsx)(og.u,{nameMaxWidth:200,className:d2("message-meta"),children:e.map(e=>(0,r.jsx)(og.u.Item,{name:e.Key,copyText:e.Value,children:e.Value},e.Key))})})}function uT({database:e,path:t,scrollContainerRef:a}){let{selectedPartition:s,activeOffset:i}=dG(),o=n.useMemo(()=>{if((0,eU.isNil)(s)||(0,eU.isNil)(i))return cn.hT;let a={database:e,path:t,partition:s,limit:1,message_size_limit:1e7},r=(0,np.y3)(i);return a.offset=r,a.last_offset=r+1,a},[s,i,e,t]),{currentData:c,error:d,isFetching:u}=ab.useGetTopicDataQuery(o),p=c?.Messages?.[0];return(0,r.jsx)(l.r,{loading:u,children:(0,r.jsx)("div",{className:d2(),children:(()=>{let e,t,n=(0,T.cH)(d),s=n&&404===d.status;if(c&&!c.Messages?.length||s)return(0,r.jsxs)(eD.s,{direction:"column",grow:"grow",alignItems:"center",justifyContent:"center",height:"100%",children:[(0,r.jsx)(eA.E,{variant:"subheader-2",children:dC("context_message-not-found",{offset:i})}),(0,r.jsx)(ek.I,{data:lu,size:100})]});if(d){let e=dC("context_get-data-error");return n&&"string"==typeof d.data?e=d.data:n&&d.statusText&&(e=d.statusText),(0,r.jsx)(eA.E,{color:"danger",variant:"body-2",children:e})}return(0,r.jsxs)(eD.s,{direction:"column",gap:4,height:"100%",children:[p?(0,r.jsx)(uv,{messageData:p}):null,(e=p?.MessageMetadata)?(0,r.jsx)(uj,{data:e}):null,(t=p?.Message)?(0,r.jsx)(d4,{message:t,offset:p.Offset,size:p.OriginalSize,scrollContainerRef:a}):null]})})()})})}let uw={data:[],total:0,found:0},uS=[d8,d9,ue,ut,ua,ur,un,us,ui,ul,uo];function uE({scrollContainerRef:e,path:t,database:a,databaseFullPath:s}){let[l]=(0,j.Nt)(),[o,c]=n.useState(),[d,u]=n.useState(),[p,m]=n.useState(0),[h,g]=n.useState(!1),[x,y]=n.useState(),[f,b]=n.useState(!1),[v,T]=n.useState(),{selectedPartition:w,selectedOffset:S,startTimestamp:E,topicDataFilter:_,activeOffset:N,handleSelectedOffsetChange:C,handleStartTimestampChange:P,handleSelectedPartitionChange:I,handleActiveOffsetChange:A}=dG();n.useEffect(()=>()=>{I(void 0),C(void 0),P(void 0)},[I,C,P]);let D=n.useMemo(()=>{if((0,eU.isNil)(w))return cn.hT;let e={database:a,path:t,partition:w,limit:1};return E?e.read_timestamp=E:e.offset=(0,np.y3)(S),e},[w,S,E,a,t]),{currentData:R,error:k,isFetching:M}=ab.useGetTopicDataQuery(D),{data:O,isLoading:q,error:L}=cl.aD.useGetPartitionsQuery({path:t,database:a,databaseFullPath:s},{pollingInterval:l}),z=n.useRef(w);n.useEffect(()=>{let e=w!==z.current,t=O?.find(({partitionId:e})=>e===w);if(t){let a=v;if((!v||e)&&T(a=(0,np.y3)(t.endOffset)),!x||e){let e=(0,np.y3)(t.startOffset),r=Math.max((a??0)-5e4,e);b(r!==e),y(r)}}e&&(z.current=w)},[w,O,v,x]),n.useEffect(()=>{if(O&&O.length&&(0,eU.isNil)(w)){let e=O[0].partitionId;I((0,eU.isNil)(e)?void 0:String(e))}},[O,w,I]);let{columnsToShow:F,columnsToSelect:Q,setColumns:U}=(0,cD.K)(uS,"topicDataSelectedColumns",dB,uc,ud),$=n.useCallback(({startOffset:e,endOffset:t})=>{c(e),u(t)},[]);n.useEffect(()=>{!M&&(R||k)&&(!R?.Messages?.length&&(R||k)?(!(R&&R.Messages?.length)||k)&&g(!0):g(!1),R&&$({startOffset:(0,np.y3)(R.StartOffset),endOffset:(0,np.y3)(R.EndOffset)}))},[M,R,k,$]);let G=n.useMemo(()=>({path:t,database:a,partition:w??"",isEmpty:h}),[t,a,w,h]),H=n.useCallback(()=>{C(void 0),P(void 0),"TIMESTAMP"===_&&m(e=>e+1)},[C,P,_]),B=n.useCallback(e=>{I(e[0]),H()},[I,H]),W=n.useCallback(t=>{let a=Math.max(0,(t-(x??0))*db.U3);requestAnimationFrame(()=>{e.current?.scrollTo({top:a,behavior:"instant"})})},[x,e]),V=n.useRef(S??N);n.useEffect(()=>{let e;if(!(M||(0,eU.isNil)(x))){if((0,eU.isNil)(V.current)){let t=R?.Messages;t?.length&&(e=(0,np.y3)(t[0].Offset))}else e=(0,np.y3)(V.current),V.current=void 0;(0,eU.isNil)(e)||W(e)}},[R,M,W,x]);let J=n.useCallback(()=>(0,r.jsx)(dV,{handlePartitionChange:B,partitions:O,partitionsLoading:q,partitionsError:L,startOffset:o,endOffset:d,truncatedData:f,scrollToOffset:W},p),[p,d,O,L,q,W,o,f,B]),Y=n.useCallback(()=>(0,r.jsx)(cs.O,{popupWidth:242,items:Q,showStatus:!0,onUpdate:U}),[Q,U]),K=n.useMemo(()=>(({setBoundOffsets:e,baseOffset:t=0})=>async({limit:a,offset:r,filters:n})=>{if(!n)return uw;let{partition:s,isEmpty:i,...l}=n;if((0,eU.isNil)(s)||""===s||i)return uw;let o=t+r,c={...l,partition:s,limit:a,last_offset:o+a,message_size_limit:100};c.offset=o;let{start:d,end:u,messages:p}=function(e,t){let{StartOffset:a,EndOffset:r,Messages:n=[]}=e,s=(0,np.y3)(a),i=(0,np.y3)(r),l=[],o=Math.min(20,Math.max(i-t,0)),c=0,d=0;for(;d<o;){let e=t+d,a=n[c];e<s?l.push({Offset:e,removed:!0}):(0,eU.isNil)(a?.Offset)||String(a.Offset)!==String(e)?l.push({Offset:e,notLoaded:!0}):(l.push(a),c++),d++}return{start:s,end:i,messages:l}}(await window.api.viewer.getTopicData(c),o);e({startOffset:d,endOffset:u});let m=u-t;return{data:p,total:m,found:m}})({setBoundOffsets:$,baseOffset:x}),[x,$]),Z=n.useCallback(()=>{A(void 0)},[A]),X=n.useCallback(()=>(0,r.jsx)(df,{children:(0,r.jsx)(uT,{database:a,path:t,scrollContainerRef:e})}),[a,t,e]);return k?(0,r.jsx)(i.A,{error:k,position:"left"}):!(0,eU.isNil)(x)&&!(0,eU.isNil)(v)&&(0,r.jsx)(le,{isDrawerVisible:!(0,eU.isNil)(N),onCloseDrawer:Z,renderDrawerContent:X,drawerId:"topic-data-details",storageKey:"topic-data-details-drawer-width",detectClickOutside:!0,isPercentageWidth:!0,drawerControls:[{type:"copyLink",link:window.location.href},{type:"custom",node:(0,r.jsx)(dm,{disabled:!!k,view:"flat"}),key:"fullscreen"},{type:"close"}],title:dC("label_message"),headerClassName:dH("drawer-header"),children:(0,r.jsx)(dv.o,{controls:J(),extraControls:Y(),table:(0,r.jsx)(db.k5,{columnsWidthLSKey:"topicDataColumnsWidth",scrollContainerRef:e,columns:F,fetchData:K,initialEntitiesCount:v-x,limit:20,renderErrorMessage:dj.$,renderEmptyDataMessage:()=>{let e=S||E;return(0,r.jsx)(dl.U,{title:dC("label_nothing-found"),message:dC("description_nothing-found"),onShowAll:e?H:void 0,showAll:dC("action_show-all"),image:(0,r.jsx)(di.oN,{width:230,height:230})})},filters:G,tableName:db.qr.TOPIC_DATA,rowHeight:db.U3,keepCache:!1,getRowClassName:e=>dH("row",{active:(0,np.y3)(e.Offset)===S||String(e.Offset)===N,removed:e.removed})}),tableWrapperProps:{scrollContainerRef:e,scrollDependencies:[x,v,G]},noBatching:!0})})}var u_=JSON.parse('{"no-data":"No data"}');let uN=(0,ex.g4)("ydb-diagnostics",{en:u_}),uC=(0,c.cn)("kv-tenant-diagnostics"),uP=function({additionalTenantProps:e}){let{path:t,database:a,type:i,subType:l,databaseFullPath:o}=tR(),c=n.useRef(null),d=(0,j.YQ)(),{diagnosticsTab:u=E.iJ.overview}=(0,j.N4)(e=>e.tenant),p=iR(),{controlPlane:m,databaseType:h}=(0,f.Ry)(ti(i)?a:""),{monitoring:g}=(0,A.Zd)(),x=(0,I.RK)(),y=(0,I._p)(),v=(0,D.b)(),T=((e,t,a)=>{let r,n,s=(r=t?iD[t]:void 0,n=e?iA[e]:void 0,r||n||iI);return function(e,t,a={}){let r=e;"EPathTypeCdcStream"!==t&&"EPathTypePersQueueGroup"!==t||a.hasTopicData||(r=r.filter(e=>e.id!==E.iJ.topicData));let n=[];return a.hasBackups||n.push(E.iJ.backups),a.hasConfigs||n.push(E.iJ.configs),a.hasAccess||n.push(E.iJ.access),a.hasMonitoring||n.push(E.iJ.monitoring),r.filter(e=>!n.includes(e.id))}(ti(e)||a?.isTopLevel?"Serverless"===a?.databaseType?iP:iC:s,e,a)})(i,l,{hasTopicData:y,isTopLevel:t===a,hasBackups:"function"==typeof b.J.renderBackups&&!!m,hasConfigs:v&&x,hasAccess:b.J.hasAccess,hasMonitoring:(0,R.P)(m,g),databaseType:h}),w=T.find(e=>e.id===u);return w||(w=T[0]),n.useEffect(()=>{w&&w.id!==u&&d((0,f.WO)(w.id))},[w,u,d]),(0,j.Mq)(c,`tenant-diagnostics-${a}-${w?.id}`,w?.id===E.iJ.overview),(0,r.jsxs)("div",{className:uC(),children:[w?(0,r.jsx)(s.mg,{children:(0,r.jsx)("title",{children:w.title})}):null,(0,r.jsx)("div",{className:uC("header-wrapper"),children:(0,r.jsxs)("div",{className:uC("tabs"),children:[(0,r.jsx)(_.f,{value:w?.id,children:(0,r.jsx)(N.w,{size:"l",children:T.map(({id:e,title:t,badge:a})=>(0,r.jsx)(oU,{id:e,title:t,linkPath:p(e),badge:a},e))})}),(0,r.jsx)(C.E,{})]})}),(0,r.jsx)(P.e,{children:(0,r.jsx)("div",{className:uC("page-wrapper"),ref:c,children:(()=>{switch(w?.id){case E.iJ.overview:return(0,r.jsx)(oz,{type:i,database:a,path:t,databaseFullPath:o,additionalTenantProps:e});case E.iJ.schema:return(0,r.jsx)(tI,{path:t,database:a,databaseFullPath:o,type:i,extended:!0});case E.iJ.topQueries:return(0,r.jsx)(c3,{database:a});case E.iJ.topShards:return(0,r.jsx)(ds,{database:a,path:t,databaseFullPath:o});case E.iJ.nodes:return(0,r.jsx)(eu.G,{path:t,databaseFullPath:o,database:a,scrollContainerRef:c});case E.iJ.access:return(0,r.jsx)(ag,{});case E.iJ.tablets:return(0,r.jsx)(eV.C,{scrollContainerRef:c,path:t,databaseFullPath:o,database:a});case E.iJ.storage:return(0,r.jsx)(eW.z,{database:a,scrollContainerRef:c});case E.iJ.network:return(0,r.jsx)(cr,{path:t,databaseFullPath:o,database:a,scrollContainerRef:c});case E.iJ.describe:return(0,r.jsx)(rl,{path:t,databaseFullPath:o,database:a,scrollContainerRef:c});case E.iJ.hotKeys:return(0,r.jsx)(oJ,{path:t,databaseFullPath:o,database:a});case E.iJ.graph:return(0,r.jsx)(ed,{path:t,databaseFullPath:o,database:a});case E.iJ.consumers:return(0,r.jsx)(rn,{path:t,databaseFullPath:o,database:a,type:i});case E.iJ.partitions:return(0,r.jsx)(ck,{path:t,databaseFullPath:o,database:a});case E.iJ.topicData:return(0,r.jsx)(uE,{path:t,databaseFullPath:o,database:a,scrollContainerRef:c},t);case E.iJ.configs:return(0,r.jsx)(k.U,{database:a,scrollContainerRef:c});case E.iJ.operations:return(0,r.jsx)(eB,{database:a,scrollContainerRef:c});case E.iJ.backups:return b.J.renderBackups?.({database:a,scrollContainerRef:c});case E.iJ.monitoring:return b.J.renderMonitoring?.({type:i,subType:l,database:a,path:t,databaseFullPath:o,additionalTenantProps:e,scrollContainerRef:c});default:return(0,r.jsx)("div",{children:uN("no-data")})}})()})})]})};var uI=a(47734);let uA=(0,c.cn)("kv-truncated-query"),uD=({value:e="",maxQueryHeight:t=6,hasClipboardButton:a,clipboardButtonAlwaysVisible:s})=>{let i=e.split("\n");if(i.length>t){let l=i.slice(0,t).join("\n");return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(rH.YDBSyntaxHighlighter,{language:"yql",className:uA(),text:l,withClipboardButton:a?{alwaysVisible:s,copyText:e,withLabel:!1}:void 0}),(0,r.jsx)("span",{className:uA("message",{color:"secondary"}),children:"\n...\nThe request was truncated. Click on the line to show the full query on the query tab"})]})}return(0,r.jsx)(rH.YDBSyntaxHighlighter,{language:"yql",className:uA(),text:e,withClipboardButton:a?{alwaysVisible:s,copyText:e,withLabel:!1}:void 0})};var uR=JSON.parse('{"action_cancel":"Cancel"}');let uk=(0,ex.g4)("ydb-confirmation-dialog",{en:uR}),uM=(0,c.cn)("confirmation-dialog"),uO="confirmation-dialog";function uq({caption:e="",children:t,onConfirm:a,onClose:n,progress:s,textButtonApply:i,textButtonCancel:l,buttonApplyView:o="normal",className:c,renderButtons:d,open:u}){return(0,r.jsxs)(t5.l,{className:uM(null,c),size:"s",onClose:n,disableOutsideClick:!0,open:u,children:[(0,r.jsx)(t5.l.Header,{caption:(0,r.jsx)("span",{className:uM("caption"),children:e})}),(0,r.jsx)(t5.l.Body,{children:t}),(0,r.jsx)(t5.l.Footer,{onClickButtonApply:a,propsButtonApply:{view:o},textButtonApply:i,textButtonCancel:l??uk("action_cancel"),onClickButtonCancel:n,loading:s,renderButtons:d})]})}let uL=t4.vt(e=>{let t=t4.hS(),a=()=>{t.hide(),t.remove()};return(0,r.jsx)(uq,{...e,onConfirm:async()=>{await e.onConfirm?.(),t.resolve(!0),a()},onClose:()=>{e.onClose?.(),t.resolve(!1),a()},open:t.visible})});t4.kz(uO,uL);var uz=a(33039);function uF(){let[e,t]=(0,j.iK)(sg.GS.SAVED_QUERIES),a=(0,j.N4)(uz.cu).trim().toLowerCase(),r=(0,j.N4)(e=>e.query.input),s=n.useMemo(()=>{let t=e??[];return a?t.filter(e=>e.body.toLowerCase().includes(a)):t},[e,a]),i=n.useCallback(a=>{t((e??[]).filter(e=>!uQ(e,a)))},[e,t]),l=n.useCallback(a=>{if(!a)return;let n=e??[],s=[...n],i=n.findIndex(e=>uQ(e,a));i>=0?s[i]={...n[i],body:r}:s.push({name:a,body:r}),t(s)},[e,t,r]);return{savedQueries:e,filteredSavedQueries:s,deleteSavedQuery:i,saveQuery:l}}function uQ(e,t){return e.name.toLowerCase()===t.toLowerCase()}var uU=JSON.parse('{"action.save":"Save query","action.edit":"Edit query","action.save-as-new":"Save as new","action.edit-existing":"Edit existing","description":"The query will be saved in your browser","input-label":"Query name","input-placeholder":"Enter query name","button-apply":"Save","button-cancel":"Cancel","error.name-exists":"This name already exists","error.name-not-empty":"Name should not be empty"}');let u$=(0,ex.g4)("ydb-save-query-dialog",{en:uU}),uG=(0,c.cn)("ydb-save-query");function uH(e){let t=(0,j.YQ)(),{savedQueries:a,saveQuery:r}=uF();return n.useCallback(()=>{t4.Ay.show(uJ,{...e,savedQueries:a,onSaveQuery:r}),t((0,uz.gJ)())},[t,e,a,r])}function uB({dialogProps:e,...t}){let a=uH(e);return(0,r.jsx)(tM.$,{onClick:a,...t,children:u$("action.save")})}function uW({buttonProps:e={}}){let t,a=(0,j.YQ)(),n=(0,j.N4)(uz.aW),s=uH(),{saveQuery:i}=uF();return n?(t=[{action:()=>{i(n),a((0,lt.Xb)(!1)),a((0,uz.gJ)())},text:u$("action.edit-existing")},{action:s,text:u$("action.save-as-new")}],(0,r.jsx)(n$.r,{items:t,renderSwitcher:t=>(0,r.jsx)(tM.$,{...t,...e,children:u$("action.edit")}),popupProps:{placement:"top"}})):(0,r.jsx)(uB,{})}function uV({onSuccess:e,onCancel:t,onClose:a,open:s,savedQueries:i,onSaveQuery:l}){let o=(0,j.YQ)(),[c,d]=n.useState(""),[u,p]=n.useState(),m=()=>{o((0,uz.NJ)("idle")),d(""),p(void 0),a?.()},h=()=>{t?.(),m()};return(0,r.jsxs)(t5.l,{open:s,hasCloseButton:!1,size:"s",onClose:h,children:[(0,r.jsx)(t5.l.Header,{caption:u$("action.save")}),(0,r.jsxs)("form",{onSubmit:t=>{t.preventDefault();let a=c?i?.some(e=>e.name.toLowerCase()===c.trim().toLowerCase())?u$("error.name-exists"):void 0:u$("error.name-not-empty");p(a),a||(l(c),o((0,lt.Xb)(!1)),m(),e?.())},children:[(0,r.jsxs)(t5.l.Body,{className:uG("dialog-body"),children:[(0,r.jsx)("div",{className:uG("dialog-row"),children:u$("description")}),(0,r.jsxs)("div",{className:uG("dialog-row"),children:[(0,r.jsx)("label",{htmlFor:"queryName",className:uG("field-title","required"),children:u$("input-label")}),(0,r.jsx)("div",{className:uG("control-wrapper"),children:(0,r.jsx)(t6.k,{id:"queryName",placeholder:u$("input-placeholder"),value:c,onUpdate:e=>{d(e),p(void 0)},hasClear:!0,autoFocus:!0,autoComplete:!1,validationState:u?"invalid":void 0,errorMessage:u})})]})]}),(0,r.jsx)(t5.l.Footer,{textButtonApply:u$("button-apply"),textButtonCancel:u$("button-cancel"),onClickButtonCancel:h,propsButtonApply:{type:"submit"}})]})]})}let uJ="save-query-dialog",uY=t4.Ay.create(e=>{let t=t4.Ay.useModal();return(0,r.jsx)(uV,{...e,onClose:()=>{e.onClose?.(),t.hide(),t.remove()},open:t.visible})});t4.Ay.register(uJ,uY);var uK=JSON.parse('{"action_apply":"Don\'t save","context_unsaved-changes-warning":"You have unsaved changes in query editor.\\nDo you want to proceed?"}');let uZ=(0,ex.g4)("ydb-change-input-confirmation",{en:uK});function uX(){let e=t4.Ay.useModal(uO),t=n.useCallback(()=>{e.hide(),e.remove()},[e]),a=n.useCallback(()=>{e.resolve(!0),t()},[e,t]),s=n.useCallback(()=>{e.resolve(!1),t()},[t,e]),i=n.useMemo(()=>({onSuccess:a,onCancel:s}),[a,s]);return(0,r.jsx)(uB,{view:"action",size:"l",dialogProps:i})}async function u0(){return await t4.Ay.show(uO,{id:uO,caption:uZ("context_unsaved-changes-warning"),textButtonApply:uZ("action_apply"),propsButtonApply:{view:"l"},renderButtons:(e,t)=>(0,r.jsxs)(n.Fragment,{children:[t,(0,r.jsx)(uX,{}),e]})})}function u1(e){let t=(0,j.N4)(lt.Wp),a=(0,j.N4)(lt.TY),r=n.useMemo(()=>async t=>{await u0()&&e(t)},[e]);return t&&a?r:e}var u2=JSON.parse('{"controls.query-mode-selector_type":"Query type:","tabs.newQuery":"Editor","tabs.history":"History","tabs.saved":"Saved","history.empty":"History is empty","history.empty-search":"Search result is empty","saved.empty":"There are no saved queries","delete-dialog.header":"Delete query","delete-dialog.question":"Are you sure you want to delete query","delete-dialog.delete":"Delete","delete-dialog.cancel":"Cancel","preview.title":"Preview","preview.not-available":"Preview is not available","preview.close":"Close preview","preview.truncated":"truncated","method-description.script":"For YQL-scripts combining DDL and DML.\\nAPI call: schema.scripting","method-description.scan":"Read-only queries, potentially reading a lot of data.\\nAPI call: table.ExecuteScan","method-description.data":"DML queries for changing and fetching data in serialization mode.\\nAPI call: table.executeDataQuery","method-description.query":"Any query. An experimental API call supposed to replace all existing methods.\\nAPI Call: query.ExecuteScript","method-description.pg":"Queries in postgresql syntax.\\nAPI call: query.ExecuteScript","transaction-mode-description.serializable":"Provides the strictest isolation level for custom transactions","transaction-mode-description.onlinero":"Each read operation in the transaction is reading the data that is most recent at execution time","transaction-mode-description.stalero":"Read operations within a transaction may return results that are slightly out-of-date (lagging by fractions of a second)","transaction-mode-description.snapshot":"All the read operations within a transaction access the database snapshot. All the data reads are consistent","transaction-mode-description.implicit":"No transaction","tracing-level-description.basic":"Spans of main component operations","tracing-level-description.detailed":"Highest detail applicable for diagnosing problems in production","tracing-level-description.diagnostic":"Detailed debugging information for developers","tracing-level-description.off":"No tracing","tracing-level-description.toplevel":"Lowest detail, no more than two spans per request to the component","tracing-level-description.trace":"Very detailed debugging information","statistics-mode-description.none":"Don\'t collect statistics","statistics-mode-description.basic":"Collect statistics","statistics-mode-description.full":"Collect statistics and query plan","statistics-mode-description.profile":"Collect statistics for individual tasks","action.send-query":"Send query","action.send-selected-query":"Send selected query","action.previous-query":"Previous query in history","action.next-query":"Next query in history","action.save-query":"Save query","action.stop":"Stop","action.run":"Run","action.explain":"Explain","action.open-shortcuts":"Open Keyboard Shortcuts Panel","filter.text.placeholder":"Search by query text...","gear.tooltip":"Query execution settings have been changed for ","banner.query-settings.message":"Query was executed with modified settings: ","banner.query-stopped.message":"Data is not up to date because the request was not completed.","banner.query-stopped.never-show":"Never show again","toaster.stop-error":"Something went wrong. Unable to stop request processing. Please wait.","history.queryText":"Query text","history.endTime":"End time","history.duration":"Duration"}');let u3=(0,ex.g4)("ydb-query-editor",{en:u2}),u4=(0,c.cn)("ydb-queries-history"),u5=function({changeUserInput:e,queriesHistory:t}){let a=(0,j.YQ)(),s=n.useMemo(()=>t.filteredHistoryQueries.toReversed(),[t.filteredHistoryQueries]),i=(0,j.N4)(lt.jY),l=u1(t=>{e({input:t.queryText}),a((0,lt.Xb)(!1)),a((0,f.sH)(E.tQ.newQuery))}),o=[{name:"queryText",header:u3("history.queryText"),render:({row:e})=>(0,r.jsx)("div",{className:u4("query"),children:(0,r.jsx)(uD,{value:e.queryText,maxQueryHeight:6})}),sortable:!1,width:600},{name:"EndTime",header:u3("history.endTime"),render:({row:e})=>e.endTime?(0,Q.r6)(e.endTime.toString()):"-",align:"right",width:200,sortable:!1},{name:"Duration",header:u3("history.duration"),render:({row:e})=>e.durationUs?(0,ez.Xo)((0,ez.Jc)(e.durationUs)):"-",align:"right",width:150,sortable:!1}];return(0,r.jsxs)(eh.L,{className:u4(),children:[(0,r.jsx)(eh.L.Controls,{children:(0,r.jsx)(eg.v,{value:i,onChange:e=>{a((0,lt.Ni)(e))},placeholder:u3("filter.text.placeholder"),className:u4("search")})}),(0,r.jsx)(eh.L.Table,{children:(0,r.jsx)(ep.l,{columnsWidthLSKey:"queriesHistoryTableColumnsWidth",columns:o,data:s,settings:ls,emptyDataMessage:u3(i?"history.empty-search":"history.empty"),onRowClick:e=>l(e),rowClassName:()=>u4("table-row")})})]})};var u6=a(78414);function u7(e,t){let a=new Map(Object.entries(e)),r=new Map(Object.entries(t));return Array.from(a.keys()).filter(e=>a.has(e)&&void 0!==a.get(e)&&a.get(e)!==r.get(e))}var u8=JSON.parse('{"action.settings":"Query settings","form.query-mode":"Query type","form.timeout":"Timeout","form.transaction-mode":"Transaction mode","form.statistics-mode":"Statistics collection mode","form.tracing-level":"Tracing level","form.limit-rows":"Limit rows","form.output.chunk.max.size":"Output chunk max size","form.output.chunk.max.size.bytes":"bytes","form.pragmas":"Pragmas","button-done":"Save","tooltip_plan-to-svg-statistics":"Statistics option is set to \\"Full\\" due to the enabled \\"Execution plan\\" experiment.\\n To disable it, go to the \\"Experiments\\" section in the user settings.","button-cancel":"Cancel","form.timeout.seconds":"sec","form.limit.rows":"rows","form.timeout.disabled":"Not available to turn off in this query type","form.validation.timeout":"Must be positive","form.validation.limitRows":"Must be between 1 and 100000","description.default":" (default)","docs":"Documentation"}'),u9=JSON.parse('{"action.settings":"Настройки запроса","form.query-mode":"Тип запроса","form.timeout":"Таймаут","form.transaction-mode":"Уровень изоляции","form.statistics-mode":"Режим сбора статистики","form.tracing-level":"Tracing level","form.limit-rows":"Лимит строк","form.output.chunk.max.size":"Максимальный размер чанка","form.output.chunk.max.size.bytes":"байт","form.pragmas":"Прагмы","tooltip_plan-to-svg-statistics":"Опция статистики установлена в значение \\"Full\\" из-за включенного эксперимента \\"Execution plan\\".\\n Чтобы отключить его, перейдите в раздел \\"Experiments\\" в настройках пользователя.","button-done":"Готово","button-cancel":"Отменить","form.timeout.seconds":"сек","form.limit.rows":"строк","form.timeout.disabled":"Невозможно выключить для текущего типа запроса","form.validation.timeout":"Таймаут должен быть положительным","form.validation.limitRows":"Лимит строк должен быть между 1 и 100000","description.default":" (default)","docs":"Документация"}');let pe=(0,ex.g4)("ydb-query-settings-dialog",{en:u8,ru:u9}),pt=[{value:eK.Wg.implicit,content:eK._d[eK.Wg.implicit],text:u3("transaction-mode-description.implicit"),isDefault:!0},{value:eK.Wg.serializable,content:eK._d[eK.Wg.serializable],text:u3("transaction-mode-description.serializable")},{value:eK.Wg.onlinero,content:eK._d[eK.Wg.onlinero],text:u3("transaction-mode-description.onlinero")},{value:eK.Wg.stalero,content:eK._d[eK.Wg.stalero],text:u3("transaction-mode-description.stalero")},{value:eK.Wg.snapshot,content:eK._d[eK.Wg.snapshot],text:u3("transaction-mode-description.snapshot")}],pa=[{value:eK.ei.query,content:eK.om[eK.ei.query],text:u3("method-description.query"),isDefault:!0},{value:eK.ei.script,content:eK.om[eK.ei.script],text:u3("method-description.script")},{value:eK.ei.scan,content:eK.om[eK.ei.scan],text:u3("method-description.scan")},{value:eK.ei.data,content:eK.om[eK.ei.data],text:u3("method-description.data")},{value:eK.ei.pg,content:eK.om[eK.ei.pg],text:u3("method-description.pg")}],pr=[{value:eK.pE.none,content:eK.Pn[eK.pE.none],text:u3("statistics-mode-description.none"),isDefault:!0},{value:eK.pE.basic,content:eK.Pn[eK.pE.basic],text:u3("statistics-mode-description.basic")},{value:eK.pE.full,content:eK.Pn[eK.pE.full],text:u3("statistics-mode-description.full")},{value:eK.pE.profile,content:eK.Pn[eK.pE.profile],text:u3("statistics-mode-description.profile")}],pn=[{value:eK.PB.off,content:eK.PX[eK.PB.off],text:u3("tracing-level-description.off"),isDefault:!0},{value:eK.PB.toplevel,content:eK.PX[eK.PB.toplevel],text:u3("tracing-level-description.toplevel")},{value:eK.PB.basic,content:eK.PX[eK.PB.basic],text:u3("tracing-level-description.basic")},{value:eK.PB.detailed,content:eK.PX[eK.PB.detailed],text:u3("tracing-level-description.detailed")},{value:eK.PB.diagnostic,content:eK.PX[eK.PB.diagnostic],text:u3("tracing-level-description.diagnostic")},{value:eK.PB.trace,content:eK.PX[eK.PB.trace],text:u3("tracing-level-description.trace")}],ps={transactionMode:{title:pe("form.transaction-mode"),options:pt},queryMode:{title:pe("form.query-mode"),options:pa},statisticsMode:{title:pe("form.statistics-mode"),options:pr},tracingLevel:{title:pe("form.tracing-level"),options:pn},timeout:{title:pe("form.timeout")},limitRows:{title:pe("form.limit-rows")},outputChunkMaxSize:{title:pe("form.output.chunk.max.size")},pragmas:{title:pe("form.pragmas")}};function pi({currentSettings:e,defaultSettings:t}){let a=u7(e,t),r={};return a.forEach(t=>{let a=ps[t],n=e[t];if("options"in a){let e=a.options.find(e=>e.value===n)?.content;e&&(r[a.title]=e)}else n&&(r[a.title]=String(n))}),r}var pl=a(75442);let po=()=>{let e,[t,a]=(0,pl.i)(sg.GS.LAST_QUERY_EXECUTION_SETTINGS);try{e=eK.id.parse(t)}catch{e=void 0}return[e,a]};var pc=a(2887);let pd=()=>{let[e,t]=(0,pl.i)(sg.GS.QUERY_SETTINGS_BANNER_LAST_CLOSED),[a]=po(),[r]=(0,pc.X)(),n=a?u7(a,eK.jU):[],s=r?u7(r,eK.jU):[],i=n.includes("transactionMode")||n.includes("queryMode"),l=a?pi({currentSettings:a,defaultSettings:eK.jU}):{},o=r?pi({currentSettings:r,defaultSettings:eK.jU}):{},c=e&&Date.now()-e<1e3*v.Du;return{isBannerShown:i&&!c,closeBanner:()=>t(Date.now()),resetBanner:()=>t(void 0),changedCurrentSettings:s,changedCurrentSettingsDescriptions:o,changedLastExecutionSettings:n,changedLastExecutionSettingsDescriptions:l}},pu=b.J.yaMetricaConfig?.yaMetricaMap;class pp{name;warnShown=!1;constructor(e){this.name=e}hit(){this.warnOnce()}params(){this.warnOnce()}userParams(){this.warnOnce()}reachGoal(){this.warnOnce()}warnOnce(){this.warnShown||(console.warn(`Yandex.Metrica counter "${this.name}" is not defined
`),this.warnShown=!0)}}function pm(e,t){let a=function(e){if(!e)return;let t=pu?.[e];return(t?window[`yaCounter${t}`]:void 0)??new pp(e)}(b.J.yaMetricaConfig?.getMetricaName(e));if(!a)return void console.warn("Metrica is not defined");let r=b.J.yaMetricaConfig?.goals[e];r?a.reachGoal(r,t):console.warn("Metrica goal is not defined")}var ph=a(14840);let pg=e=>{localStorage.removeItem(e)};function px(e){return function(t,a){switch(a){case"triggerCollapse":return localStorage.setItem(e,"true"),{...t,triggerCollapse:!0,triggerExpand:!1,collapsed:!0};case"triggerExpand":return pg(e),{...t,triggerCollapse:!1,triggerExpand:!0,collapsed:!1};case"clear":return pg(e),{triggerCollapse:!1,triggerExpand:!1,collapsed:!1};default:return t}}}let py=(0,c.cn)("kv-pane-visibility-button");function pf({onCollapse:e,onExpand:t,isCollapsed:a,initialDirection:s="top",className:i}){return(0,dh.u)([a]),(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(eR.m,{title:"Collapse",children:(0,r.jsx)(tM.$,{view:"flat-secondary",onClick:e,className:py({hidden:a,type:"collapse"},i),children:(0,r.jsx)(ek.I,{data:ph.A,className:py({[s]:!0})})})}),(0,r.jsx)(eR.m,{title:"Expand",children:(0,r.jsx)(tM.$,{view:"flat-secondary",onClick:t,className:py({hidden:!a,type:"expand"},i),children:(0,r.jsx)(ek.I,{data:ph.A,className:py({[s]:!0},"rotate")})})})]})}let pb=(0,c.cn)("ydb-preview");function pv({path:e,quantity:t=0,truncated:a,renderResult:n,loading:s,error:i}){let o=(0,j.YQ)();return(0,r.jsx)(l.r,{loading:s,children:(0,r.jsxs)("div",{className:pb(),children:[(0,r.jsxs)(eD.s,{justifyContent:"space-between",alignItems:"center",className:pb("header"),children:[(0,r.jsxs)(eD.s,{gap:1,children:[u3("preview.title"),(0,r.jsxs)(eA.E,{color:"secondary",variant:"body-2",children:[a?`${u3("preview.truncated")} `:"","(",t,")"]}),(0,r.jsx)("div",{className:pb("table-name"),children:e})]}),(0,r.jsxs)("div",{className:pb("controls-left"),children:[(0,r.jsx)(dm,{disabled:!!i}),(0,r.jsx)(tM.$,{view:"flat-secondary",onClick:()=>{o((0,y.o)(!1))},title:u3("preview.close"),children:(0,r.jsx)(ek.I,{data:iY.A,size:18})})]})]}),(0,r.jsx)(df,{children:(0,r.jsx)("div",{className:pb("result"),children:i?(0,r.jsx)("div",{className:pb("message-container","error"),children:(0,eK.Cb)(i)}):n?.()})})]})})}let pj=n.memo(function(e){let{className:t,value:a}=e,n=(0,j.YQ)();return(0,r.jsx)("span",{className:p_("cell",t),onClick:e=>n((0,F.DK)(e.target,a,"cell")),children:a})});var pT=JSON.parse('{"empty":"Table is empty"}'),pw=JSON.parse('{"empty":"Таблица пустая"}');let pS=(0,ex.g4)("ydb-query-result-table",{ru:pw,en:pT}),pE={...v.N3,stripedRows:!0,sortable:!1,displayIndices:!0},p_=(0,c.cn)("ydb-query-result-table"),pN=(e,t)=>t,pC=(e,t)=>t+1,pP=e=>{let{columns:t,data:a,settings:s}=e,i=n.useMemo(()=>t?((e,t)=>{if(!e.length)return[];let a=t?.slice(0,100);return e.map(({name:e,type:t})=>{let n=(0,eK.nh)(t);return{name:e,width:tx({data:a,name:e}),align:"number"===n?tg.Ay.RIGHT:tg.Ay.LEFT,render:({row:t})=>(0,r.jsx)(pj,{value:String(t[e])})}})})(t,a):(e=>{if(!e?.length)return[];let t=e?.slice(0,100);return Object.keys(e[0]).map(a=>({name:a,width:tx({data:t,name:a}),align:(0,np.kf)(e[0][a])?tg.Ay.RIGHT:tg.Ay.LEFT,render:({row:e})=>(0,r.jsx)(pj,{value:String(e[a])})}))})(a),[a,t]),l=n.useMemo(()=>({...pE,...s}),[s]);return Array.isArray(a)?i.length?(0,r.jsx)(ep.l,{data:a,columns:i,settings:l,rowKey:pN,visibleRowIndex:pC,wrapperClassName:p_("table-wrapper")}):(0,r.jsx)("div",{className:p_("message"),children:pS("empty")}):null},pI=g.F.injectEndpoints({endpoints:e=>({sendQuery:e.query({queryFn:async({query:e,database:t,action:a,limitRows:r},{signal:n})=>{try{let s=await window.api.viewer.sendQuery({query:e,database:t,action:a,limit_rows:r},{signal:n,withRetries:!0});if((0,eK.We)(s))return{error:s};return{data:(0,eK.fW)(s)}}catch(e){return{error:e||Error("Unauthorized")}}},providesTags:["PreviewData"]})}),overrideExisting:"throw"});function pA({database:e,path:t,type:a,databaseFullPath:n}){let[s]=(0,pc.X)(),i=eJ(t,n),l=`select * from \`${i}\` limit 101`,o=(0,uI.ZS)(l,s.pragmas),{currentData:c,isFetching:d,error:u}=pI.useSendQueryQuery({database:e,query:o,action:"EPathTypeExternalTable"===a?"execute-query":"execute-scan",limitRows:100},{refetchOnMountOrArgChange:!0}),p=d&&void 0===c,m=c?.resultSets?.[0]??{};return(0,r.jsx)(pv,{path:i,renderResult:()=>(0,r.jsx)(pP,{data:m.result,columns:m.columns}),loading:p,error:u,truncated:m.truncated,quantity:m.result?.length})}var pD=JSON.parse('{"label_partition-id":"Partition ID: {{id}}","label_offsets-range":"offsets: {{start}} - {{end}}"}');let pR=(0,ex.g4)("ydb-preview",{en:pD}),pk=[{name:dI,header:dB[dI],render:({row:{Offset:e}})=>(0,eU.isNil)(e)?v.Pd:e,sortable:!1},{name:dA,header:dB[dA],render:({row:{CreateTimestamp:e,TimestampDiff:t}})=>(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(uu,{timestamp:e}),(0,r.jsx)("br",{}),(0,r.jsx)(um,{value:t,baseColor:"secondary",variant:"body-1"})]}),width:200,sortable:!1},{name:dM,header:dB[dM],render:({row:{Message:e,OriginalSize:t}})=>(0,r.jsx)(uh,{message:e,size:t}),width:500,sortable:!1},{name:dO,header:dB[dO],render:({row:{StorageSize:e}})=>(0,r.jsx)(ug,{size:e}),align:"right",width:100,sortable:!1}];function pM({messages:e}){return(0,r.jsx)(ep.l,{data:e,columns:pk,settings:v.N3,rowKey:(e,t)=>e.Offset??t,wrapperClassName:pb("table-wrapper"),emptyDataMessage:"No data"})}function pO({database:e,path:t,databaseFullPath:a}){let{data:s,isLoading:i,error:l}=cl.aD.useGetPartitionsQuery({path:t,database:e,databaseFullPath:a}),o=n.useMemo(()=>s?.[0],[s]),c=n.useMemo(()=>{let a=o?.partitionId;return!o||(0,eU.isNil)(a)?cn.hT:{database:e,path:t,partition:String(a),limit:100,offset:(0,np.y3)(o.endOffset)-100,message_size_limit:100}},[e,t,o]),{currentData:d,error:u,isFetching:p}=ab.useGetTopicDataQuery(c),m=i||p&&void 0===d,h=n.useMemo(()=>{if(o)return{start:(0,np.y3)(o.startOffset),end:Math.max((0,np.y3)(o.endOffset)-1,0)}},[o]),g=n.useCallback(()=>(0,r.jsxs)(eD.s,{direction:"column",children:[(0,r.jsxs)(eD.s,{className:pb("partition-info"),alignItems:"center",gap:2,children:[!(0,eU.isNil)(o?.partitionId)&&(0,r.jsx)(eA.E,{variant:"body-2",children:pR("label_partition-id",{id:o.partitionId})}),h&&(0,r.jsxs)(eA.E,{variant:"body-2",color:"secondary",children:["(",pR("label_offsets-range",h),")"]})]}),d&&(0,r.jsx)(pM,{messages:d.Messages?.toReversed()??[]})]}),[h,o,d]),x=(0,np.y3)(d?.EndOffset)-(0,np.y3)(d?.StartOffset);return(0,r.jsx)(pv,{path:t,renderResult:g,loading:m,error:l||u,truncated:x>100,quantity:d?.Messages?.length??0})}function pq(e){let{type:t,subType:a}=e,n=ta(t),s="EPathTypePersQueueGroup"===t,i=(0,I._p)();return n?(0,r.jsx)(pA,{...e}):s&&"EPathSubTypeStreamImpl"!==a&&i?(0,r.jsx)(pO,{...e}):(0,r.jsx)(pv,{...e,renderResult:()=>(0,r.jsx)("div",{className:pb("message-container"),children:u3("preview.not-available")})})}let pL=g.F.injectEndpoints({endpoints:e=>({cancelQuery:e.mutation({queryFn:async({queryId:e,database:t},{signal:a})=>{try{let r=await window.api.viewer.sendQuery({database:t,action:"cancel-query",query_id:e,internal_call:!0},{signal:a});if((0,eK.We)(r))return{error:r};return{data:(0,eK.fW)(r)}}catch(e){return{error:e}}}})}),overrideExisting:"throw"});var pz=a(99951),pF=a(34687),pQ=a(39952),pU=a(98887),p$=a(54745),pG=a(10891);async function pH(e){let t=1,a=async()=>{if(!window.ydbEditor)if(!t)return!1;else await new Promise(e=>{window.setTimeout(e,100)}),t-=1,a();return!0};await a()?window.ydbEditor?.trigger(void 0,"insertSnippetToEditor",e):console.error("Monaco editor not found")}function pB(e){return e.replace(/\$/g,"\\$")}let pW=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}/my_row_table\``:"${1:my_row_table}";return`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table
CREATE TABLE ${t} (
    category_id Uint64 NOT NULL,
    id Uint64,
    expire_at Datetime,
    updated_on Datetime,
    name Text,
    \`binary-payload\` Bytes,
    attributes JsonDocument,
    -- uncomment to add a secondary index
    -- INDEX idx_row_table_id GLOBAL SYNC ON ( id ) COVER ( name, attributes ), -- Secondary indexes docs https://ydb.tech/en/docs/yql/reference/syntax/create_table#secondary_index
    PRIMARY KEY (category_id, id)
) 
WITH (
    AUTO_PARTITIONING_BY_SIZE = ENABLED,
    AUTO_PARTITIONING_PARTITION_SIZE_MB = 2048,
    AUTO_PARTITIONING_BY_LOAD = ENABLED,
    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = 4,
    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = 1024
    -- uncomment to create a table with predefined partitions
    -- , UNIFORM_PARTITIONS = 4 -- The number of partitions for uniform initial table partitioning.
                            -- The primary key's first column must have type Uint64 or Uint32.
                            -- A created table is immediately divided into the specified number of partitions
    -- uncomment to launch read only replicas in every AZ
    -- , READ_REPLICAS_SETTINGS = 'PER_AZ:1' -- Enable read replicas for stale read, launch one replica in every availability zone
    -- uncomment to enable ttl
    -- , TTL = Interval("PT1H") ON expire_at -- Enable background deletion of expired rows https://ydb.tech/en/docs/concepts/ttl
    -- uncomment to create a table with a bloom filter
    -- , KEY_BLOOM_FILTER = ENABLED -- With a Bloom filter, you can more efficiently determine
                               -- if some keys are missing in a table when making multiple single queries by the primary key.
)`},pV=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}/my_column_table\``:"${1:my_column_table}";return`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table#olap-tables
CREATE TABLE ${t} (
    id Int64 NOT NULL,
    author Text,
    title Text,
    body Text,
    PRIMARY KEY (id)
)
PARTITION BY HASH(id)
WITH (STORE = COLUMN)`},pJ=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-async-replication
CREATE OBJECT secret_name (TYPE SECRET) WITH value="secret_value";

CREATE ASYNC REPLICATION my_replication
FOR \${1:<original_table>} AS \${2:replica_table} --[, \`/remote_database/another_table_name\` AS \`another_local_table_name\` ...]
WITH (
    CONNECTION_STRING="\${3:grpcs://mydb.ydb.tech:2135/?database=/remote_database}",
    TOKEN_SECRET_NAME = "secret_name"
    -- ENDPOINT="mydb.ydb.tech:2135",
    -- DATABASE=\`/remote_database\`,
    -- USER="user",
    -- PASSWORD_SECRET_NAME="your_password"
);`,pY=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-transfer
CREATE OBJECT secret_name (TYPE SECRET) WITH value="secret_value";

\\$l = (\\$x) -> {
    return [
        <|
            offset:\\$x._offset,
            message:\\$x._data
        |>
    ];
};

CREATE TRANSFER my_transfer
FROM \${1:<original_topic>} TO \${2:<target_table>} USING \\$l
WITH (
    CONNECTION_STRING="\${3:grpcs://mydb.ydb.tech:2135/?database=/remote_database}",
    TOKEN_SECRET_NAME = "secret_name"
    -- ENDPOINT="mydb.ydb.tech:2135",
    -- DATABASE=\`/remote_database\`,
    -- USER="user",
    -- PASSWORD_SECRET_NAME="your_password"
);`,pK=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_table>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter_table/

ALTER TABLE ${t}
    -- RENAME TO new_table_name
    -- DROP COLUMN some_existing_column
\${2:ADD COLUMN numeric_column Int32};`},pZ=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_table>}";return`-- documentation about partitioning https://ydb.tech/docs/en/concepts/datamodel/table#partitioning

ALTER TABLE ${t} SET 
(
    AUTO_PARTITIONING_BY_LOAD = ENABLED, -- If a partition consumes more than 50% of the CPU for a few dozens of seconds, it is enqueued for splitting.
    AUTO_PARTITIONING_BY_SIZE = ENABLED, --  If a partition size exceeds the value specified by the AUTO_PARTITIONING_PARTITION_SIZE_MB  parameter, it is enqueued for splitting.
    AUTO_PARTITIONING_PARTITION_SIZE_MB = 2048,
    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = 10, -- Partitions are merged only if their actual number exceeds the value specified by this parameter.
    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = 100 -- Partitions are split only if their number doesn't exceed the value specified by this parameter.
)`},pX=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_table>}";return`ALTER TABLE ${t} SET 
(
   READ_REPLICAS_SETTINGS = 'PER_AZ:1' -- Enable read replicas for stale read, launch one replica in every availability zone. docs: https://clck.ru/3Qh8iQ
)`},p0=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${2:<my_table>}",a=e?.schemaData?.map(e=>"`"+pB(e.name??"")+"`").join(", ")||"${1:*}",r=e?.relativePath?"":"WHERE ${3:Key1 = 1}\nORDER BY ${4:Key1}\n";return`SELECT ${a}
FROM ${t}
${r}LIMIT \${5:10};`},p1=e=>{if(e?.showCreateTableData)return e.showCreateTableData;let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${2:<my_table>}";return`SHOW CREATE TABLE ${t};`},p2=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_table>}",a=e?.schemaData?.map(e=>`\`${pB(e.name??"")}\``).join(", ")||"${2:id, name}",r=e?.schemaData?"${3: }":'${3:1, "foo"}';return`UPSERT INTO ${t}
( ${a} )
VALUES ( ${r} );`},p3=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:my_table}";return`DROP EXTERNAL TABLE ${t};`},p4=e=>{let t=e?.relativePath.split("/").slice(0,-1).join("/"),a=t?`\`${pB(t)}/my_external_table\``:"${1:<my_external_table>}",r=e?.relativePath?`${pB(e.relativePath)}`:"${2:<path_to_data_source>}";return`CREATE EXTERNAL TABLE ${a} (
    column1 Int,
    column2 Int
) WITH (
    DATA_SOURCE="${r}",
    LOCATION="",
    FORMAT="json_as_string",
    \`file_pattern\`=""
);`},p5=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}/my_topic\``:"${1:my_topic}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-topic
CREATE TOPIC ${t} (
    CONSUMER consumer1,
    CONSUMER consumer2 WITH (read_from = Datetime('1970-01-01T00:00:00Z')) -- Sets up the message write time starting from which the consumer will receive data.
                                                                           -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format). 
                                                                           -- Default value: now
) WITH (
    min_active_partitions = 1, -- Minimum number of topic partitions.
    partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.
    retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.
    retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. 
                              -- When this value is exceeded, the older data is cleared, like under a retention policy. 
                              -- 0 is interpreted as unlimited.
    partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.
    partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. 
                                    -- When set to zero, the actual write_burst value is equalled to 
                                    -- the quota value (this allows write bursts of up to one second).
);`},p6=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_topic>}";return`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/alter_topic
ALTER TOPIC ${t}
    ADD CONSUMER new_consumer WITH (read_from = Datetime('1970-01-01T00:00:00Z')), -- Sets up the message write time starting from which the consumer will receive data.
                                                                                   -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format).
                                                                                   -- Default value: now
    ALTER CONSUMER consumer1 SET (read_from = Datetime('1970-01-01T00:00:00Z')),
    DROP CONSUMER consumer2,
    SET (
        min_active_partitions = 1, -- Minimum number of topic partitions.
        partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.
        retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.
        retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. 
                                  -- When this value is exceeded, the older data is cleared, like under a retention policy. 
                                  -- 0 is interpreted as unlimited.
        partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.
        partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. 
                                        -- When set to zero, the actual write_burst value is equalled to
                                        -- the quota value (this allows write bursts of up to one second).
    );`},p7=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_topic>}";return`DROP TOPIC ${t};`},p8=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}/my_view\``:"${1:my_view}";return`CREATE VIEW ${t} WITH (security_invoker = TRUE) AS SELECT 1;`},p9=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_view>}";return`DROP VIEW ${t};`},me=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_replication>}";return`DROP ASYNC REPLICATION ${t};`},mt=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_transfer>}";return`DROP TRANSFER ${t};`},ma=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_replication>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter-async-replication
ALTER ASYNC REPLICATION ${t} SET (STATE = "DONE", FAILOVER_MODE = "FORCE");`},mr=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_transfer>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter-transfer

\\$l = (\\$x) -> {
    return [
        <|
            offset:\\$x._offset,
            message:\\$x._data
        |>
    ];
};

ALTER TRANSFER ${t} 
SET USING \\$l;`},mn=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}/my_streaming_query\``:"${1:<my_streaming_query>}";return`CREATE STREAMING QUERY ${t} WITH (
    RUN = TRUE  -- Run the query after creation
) AS
DO BEGIN

INSERT INTO \${2:<external data source>}.\${3:<sink topic>} 
SELECT * FROM \${2:<external data source>}.\${4:<source topic>};

END DO;`},ms=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_streaming_query>}";return`ALTER STREAMING QUERY ${t} SET (
    RUN = FALSE, -- Stop query execution
    RESOURCE_POOL = "default" -- Workload manager pool for query
);`},mi=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_streaming_query>}",a=e?.streamingQueryData,r=(0,Q.vN)(a?.resultSets?.[0]?.result?.[0]?.Text).replace(/\r\n?/g,"\n");r=(0,Q.qe)(r);let n=(r=pB(r=(0,Q.YY)(r)))||"${2:<streaming_query_text>}";return`ALTER STREAMING QUERY ${t} SET (
    FORCE = TRUE, -- Allow to drop last query checkpoint if query state can't be loaded
) AS
DO BEGIN

${n}

END DO;`},ml=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_streaming_query>}";return`DROP STREAMING QUERY ${t};`},mo=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_table>}";return`ALTER TABLE ${t} ADD INDEX \${2:index_name} GLOBAL ON (\${3:<column_name>});`},mc=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_table>}";return`-- docs: https://ydb.tech/docs/en/dev/vector-indexes?version=main#types
ALTER TABLE ${t}
ADD INDEX \${2:my_vector_index}
GLOBAL USING vector_kmeans_tree
ON (\${3:embedding})
WITH (
    distance=cosine,
    vector_type="uint8",
    vector_dimension=\${4:512},
    levels=\${5:2},
    clusters=\${6:128}
);`},md=e=>{let t=e?.relativePath.split("/").pop(),a=e?.relativePath.split("/").slice(0,-1).join("/"),r=a?`\`${pB(a)}\``:"${1:<my_table>}";return`ALTER TABLE ${r} DROP INDEX ${pB(t??"")||"${2:<index_name>}"};`},mu=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_table>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter_table/changefeed
ALTER TABLE ${t} ADD CHANGEFEED \${2:changefeed_name} WITH (
    MODE = \${3:'UPDATES'}, -- KEYS_ONLY, UPDATES, NEW_IMAGE, OLD_IMAGE, or NEW_AND_OLD_IMAGES
    FORMAT = \${4:'JSON'}, -- JSON or DEBEZIUM_JSON
    VIRTUAL_TIMESTAMPS = \${5:TRUE}, -- true or false
    RETENTION_PERIOD = \${6:Interval('PT12H')}, -- Interval value, e.g., Interval('PT24H')
    -- TOPIC_MIN_ACTIVE_PARTITIONS: The number of topic partitions. By default, the number of topic partitions is equal to the number of table partitions
    INITIAL_SCAN = \${8:TRUE} -- true or false
)

-- MODE options:
--   KEYS_ONLY: Only the primary key components and change flag are written.
--   UPDATES: Updated column values that result from updates are written.
--   NEW_IMAGE: Any column values resulting from updates are written.
--   OLD_IMAGE: Any column values before updates are written.
--   NEW_AND_OLD_IMAGES: A combination of NEW_IMAGE and OLD_IMAGE modes.`},mp=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-group
CREATE GROUP \${1:group_name}
-- group_name: The name of the group. It may contain lowercase Latin letters and digits.`,mm=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-user
CREATE USER \${1:user_name} PASSWORD \${2:'password'}
-- user_name: The name of the user. It may contain lowercase Latin letters and digits.
-- option: The password of the user:
    -- PASSWORD 'password' creates a user with the password password. The ENCRYPTED option is always enabled.
    -- PASSWORD NULL creates a user with an empty password.`,mh=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_table>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/delete
DELETE FROM ${t}
WHERE \${2:Key1 = 1};`},mg=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/drop-group
DROP GROUP \${1:<group_name>}

-- IF EXISTS: Suppress an error if the group doesn't exist.
-- group_name: The name of the group to be deleted.`,mx=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/drop-user
DROP USER \${1:<user_name>}

-- IF EXISTS: Suppress an error if the user doesn't exist.
-- user_name: The name of the user to be deleted.`,my=e=>{let t=e?.relativePath?`\`${pB(e?.relativePath)}\``:"${2:<path_to_scheme_object>}";return`GRANT \${1:<permission_name>}
ON ${t}
TO \${3:<role_name>}

-- permission_name: The name of the access right to schema objects that needs to be assigned.
-- path_to_scheme_object: The path to the schema object for which rights are being granted.
-- role_name: The name of the user or group to whom rights on the schema object are being granted.
-- WITH GRANT OPTION: Using this construct gives the user or group of users the right to manage access rights - 
--                    to assign or revoke certain rights. This construct has functionality similar to granting 
--                    the "ydb.access.grant" or GRANT right. A subject with the ydb.access.grant right cannot 
--                    grant rights broader than they possess themselves.`},mf=e=>{let t=e?.relativePath?`\`${pB(e?.relativePath)}\``:"${2:<path_to_scheme_object>}";return`REVOKE \${1:<permission_name>}
ON ${t}
FROM \${3:<role_name>}

-- permission_name: The name of the access right to schema objects that needs to be revoked.
-- path_to_scheme_object: The path to the schema object from which rights are being revoked.
-- role_name: The name of the user or group from whom rights on the schema object are being revoked.
-- GRANT OPTION FOR: Using this construct revokes the user's or group's right to manage access rights.
--                   All previously granted rights by this user remain in effect.
--                   This construct has functionality similar to revoking the "ydb.access.grant" or GRANT right.`},mb=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_table>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/update
UPDATE ${t}
SET \${2:Column1 = 'foo', Column2 = 'bar'}
WHERE \${3:Key1 = 1};`},mv=e=>{let t=e?.relativePath?`\`${pB(e.relativePath)}\``:"${1:<my_table>}";return`DROP TABLE ${t};`};var mj=JSON.parse('{"button.new-sql":"New query","action.create-row-table":"Create row table","action.create-column-table":"Create column table","action.create-external-table":"Create external table","action.upsert-to-table":"Upsert into table","action.update-table":"Update table","action.alter-table":"Alter table","action.select-rows":"Select from a table","action.delete-rows":"Delete rows","action.drop-table":"Drop table","action.add-index":"Add index","action.add-vector-index":"Add vector index","action.drop-index":"Drop index","action.drop-external-table":"Drop external table","menu.tables":"Tables","menu.topics":"Topics","menu.streaming-query":"Streaming query","menu.capture":"Change data capture","menu.replication":"Async replication","menu.transfer":"Transfer","menu.users":"Users","action.create-topic":"Create Topic","action.drop-topic":"Drop Topic","action.alter-topic":"Alter Topic","action.create-cdc-stream":"Create changefeed","action.create-async-replication":"Create async replication","action.create-transfer":"Create transfer","action.create-user":"Create user","action.create-group":"Create group","action.drop-user":"Drop user","action.drop-group":"Drop group","action.grant-privilege":"Grant privilege","action.revoke-privilege":"Revoke privilege","action.alter-async-replication":"Alter async replication","action.drop-async-replication":"Drop async replication","action.alter-transfer":"Alter transfer","action.drop-transfer":"Drop transfer","action.create-streaming-query":"Create streaming query","action.show-create-table":"Show Create SQL","action.alter-streaming-query-settings":"Alter query settings","action.alter-streaming-query-text":"Alter query text","action.drop-streaming-query":"Drop query"}');let mT=(0,ex.g4)("ydb-new-sql",{en:mj});function mw(){var e;let t,a=(e=u1(n.useCallback(e=>{pH(e)},[])),{createRowTable:(t=t=>()=>{e(t())})(pW),createColumnTable:t(pV),createAsyncReplication:t(pJ),createStreamingQuery:t(mn),alterAsyncReplication:t(ma),dropAsyncReplication:t(me),createTransfer:t(pY),alterTransfer:t(mr),dropTransfer:t(mt),alterTable:t(pK),selectQuery:t(p0),upsertQuery:t(p2),createExternalTable:t(p4),dropExternalTable:t(p3),createTopic:t(p5),alterTopic:t(p6),dropTopic:t(p7),createView:t(p8),dropTable:t(mv),deleteRows:t(mh),updateTable:t(mb),alterStreamingQueryText:t(mi),alterStreamingQuerySettings:t(ms),dropStreamingQuery:t(ml),createUser:t(mm),createGroup:t(mp),createCdcStream:t(mu),grantPrivilege:t(my),revokePrivilege:t(mf),dropUser:t(mx),dropGroup:t(mg),addVectorIndex:t(mc),addTableIndex:t(mo),dropTableIndex:t(md),showCreateTable:t(p1)}),s=[{text:mT("menu.tables"),iconStart:(0,r.jsx)(pF.K,{}),items:[{text:mT("action.create-row-table"),action:a.createRowTable},{text:mT("action.create-column-table"),action:a.createColumnTable},{text:mT("action.create-external-table"),action:a.createExternalTable},{text:mT("action.upsert-to-table"),action:a.upsertQuery},{text:mT("action.update-table"),action:a.updateTable},{text:mT("action.alter-table"),action:a.alterTable},{text:mT("action.select-rows"),action:a.selectQuery},{text:mT("action.delete-rows"),action:a.deleteRows},{text:mT("action.drop-table"),action:a.dropTable},{text:mT("action.drop-external-table"),action:a.dropExternalTable},{text:mT("action.add-index"),action:a.addTableIndex},{text:mT("action.add-vector-index"),action:a.addVectorIndex},{text:mT("action.drop-index"),action:a.dropTableIndex},{text:mT("action.show-create-table"),action:a.showCreateTable}]},{text:mT("menu.topics"),iconStart:(0,r.jsx)(pQ.p,{}),items:[{text:mT("action.create-topic"),action:a.createTopic},{text:mT("action.alter-topic"),action:a.alterTopic},{text:mT("action.drop-topic"),action:a.dropTopic}]},{text:mT("menu.streaming-query"),iconStart:(0,r.jsx)(pU.G,{}),items:[{text:mT("action.create-streaming-query"),action:a.createStreamingQuery},{text:mT("action.alter-streaming-query-settings"),action:a.alterStreamingQuerySettings},{text:mT("action.alter-streaming-query-text"),action:a.alterStreamingQueryText},{text:mT("action.drop-streaming-query"),action:a.dropStreamingQuery}]},{text:mT("menu.replication"),iconStart:(0,r.jsx)(p$.A,{}),items:[{text:mT("action.create-async-replication"),action:a.createAsyncReplication},{text:mT("action.alter-async-replication"),action:a.alterAsyncReplication},{text:mT("action.drop-async-replication"),action:a.dropAsyncReplication}]},{text:mT("menu.transfer"),iconStart:(0,r.jsx)(pG.p,{}),items:[{text:mT("action.create-transfer"),action:a.createTransfer},{text:mT("action.alter-transfer"),action:a.alterTransfer},{text:mT("action.drop-transfer"),action:a.dropTransfer}]},{text:mT("menu.capture"),iconStart:(0,r.jsx)(pQ.p,{}),items:[{text:mT("action.create-cdc-stream"),action:a.createCdcStream}]},{text:mT("menu.users"),iconStart:(0,r.jsx)(pz.A,{}),items:[{text:mT("action.create-user"),action:a.createUser},{text:mT("action.create-group"),action:a.createGroup},{text:mT("action.drop-user"),action:a.dropUser},{text:mT("action.drop-group"),action:a.dropGroup},{text:mT("action.grant-privilege"),action:a.grantPrivilege},{text:mT("action.revoke-privilege"),action:a.revokePrivilege}]}];return(0,r.jsx)(n$.r,{items:s,renderSwitcher:e=>(0,r.jsxs)(tM.$,{...e,children:[mT("button.new-sql"),(0,r.jsx)(tM.$.Icon,{children:(0,r.jsx)(nU.A,{})})]}),popupProps:{placement:"top"}})}let mS=g.F.injectEndpoints({endpoints:e=>({getCodeAssistSuggestions:e.query({queryFn:async e=>{try{if(window.api.codeAssist)return{data:await window.api.codeAssist.getCodeAssistSuggestions(e)};throw Error("Method is not implemented.")}catch{return{data:{items:[]}}}}}),acceptSuggestion:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist)return{data:await window.api.codeAssist.sendCodeAssistTelemetry({Accepted:{AcceptedText:e.acceptedText,ConvertedText:e.acceptedText,Timestamp:Date.now(),RequestId:e.requestId}})};throw Error("Method is not implemented.")}catch(e){return{error:e}}}}),discardSuggestion:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist)return{data:await window.api.codeAssist.sendCodeAssistTelemetry({Discarded:{RequestId:e.requestId,Timestamp:Date.now(),DiscardReason:"OnCancel",DiscardedText:e.suggestionText,CacheHitCount:e.hitCount}})};throw Error("Method is not implemented.")}catch(e){return{error:e}}}}),ignoreSuggestion:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist)return{data:await window.api.codeAssist.sendCodeAssistTelemetry({Ignored:{RequestId:e.requestId,Timestamp:Date.now(),IgnoredText:e.suggestionText}})};throw Error("Method is not implemented.")}catch(e){return{error:e}}}}),sendUserQueriesData:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist)return{data:await window.api.codeAssist.sendCodeAssistOpenTabs(e)};throw Error("Method is not implemented.")}catch(e){return{error:e}}}})}),overrideExisting:"throw"}),mE={automaticLayout:!0,selectOnLineNumbers:!0,minimap:{enabled:!1},fixedOverflowWidgets:!0},m_=new class{query;constructor(){this.query=null}registerQuery(e){this.query=e}abortQuery(){this.query&&(this.query.abort(),this.query=null)}};var mN=a(98251),mC=a(64482),mP=a(78419);let mI=(0,c.cn)("ydb-query-settings-description"),mA=({querySettings:e,prefix:t})=>(0,r.jsxs)("div",{className:mI("message"),children:[t,Object.entries(e).map(([e,t],a,n)=>(0,r.jsxs)("span",{className:mI("description-item"),children:[`${e}: ${t}`,a<n.length-1?", ":null]},a))]}),mD=(0,c.cn)("ydb-query-editor-button"),mR=e=>(0,r.jsxs)(tM.$,{...e,className:mD("run-button"),children:[(0,r.jsx)(ek.I,{data:nE.A,size:16}),u3("action.run")]}),mk=e=>(0,r.jsxs)(tM.$,{...e,className:mD("stop-button",{error:e.error}),children:[(0,r.jsx)(ek.I,{data:eI.A,size:16}),u3("action.stop")]}),mM=e=>(0,r.jsxs)(tM.$,{...e,className:mD("explain-button"),children:[(0,r.jsx)(ek.I,{data:mN.A,size:16}),u3("action.explain")]}),mO=({onClick:e,isLoading:t})=>{let{changedCurrentSettings:a,changedCurrentSettingsDescriptions:n}=pd(),s=a.length>0?{view:"outlined-info",selected:!0}:null;return(0,r.jsx)(mP.m,{disabled:0===a.length,content:(0,r.jsx)(mA,{prefix:u3("gear.tooltip"),querySettings:n}),openDelay:0,placement:["top-start"],children:(0,r.jsxs)(tM.$,{onClick:e,loading:t,className:mD("gear-button"),...s,children:[(0,r.jsx)(ek.I,{data:mC.A,size:16}),s?(0,r.jsxs)("div",{className:mD("changed-settings"),children:["(",a.length,")"]}):null]})})},mq=(0,c.cn)("ydb-query-editor-controls"),mL=({type:e,isHighlighted:t,isLoading:a,isStoppable:n,controlsDisabled:s,onActionClick:i,renderStopButton:l})=>n&&a&&t?l():(0,r.jsx)("run"===e?mR:mM,{onClick:i,disabled:s,loading:a,view:t?"action":void 0}),mz=({disabled:e,isLoading:t,highlightedAction:a,queryId:s,database:i,isStreamingEnabled:l,handleSendExecuteClick:o,onSettingsButtonClick:c,handleGetExplainQueryClick:d})=>{let u=(0,j.N4)(lt.Wp),[p,m]=pL.useCancelQueryMutation(),[h,g]=n.useState(t),x=n.useRef(null),y=n.useRef(null),[f,b]=n.useState(!1),v=n.useCallback(async()=>{pm("stopQuery");try{l?m_.abortQuery():s&&await p({queryId:s,database:i}).unwrap()}catch{(0,eL.A)({name:"stop-error",title:"",content:u3("toaster.stop-error"),theme:"danger",autoHiding:5e3}),b(!0),y.current&&window.clearTimeout(y.current),y.current=window.setTimeout(()=>{b(!1)},500)}},[l,s,p,i]),T=n.useCallback(()=>{x.current&&window.clearTimeout(x.current),g(!1),x.current=window.setTimeout(()=>{g(!0)},400)},[]),w=n.useCallback(()=>{o(u),T()},[o,u,T]),S=n.useCallback(()=>{d(u),T()},[d,u,T]);n.useEffect(()=>()=>{x.current&&window.clearTimeout(x.current),y.current&&window.clearTimeout(y.current)},[]);let E=e||!u,_=()=>(0,r.jsx)(mk,{loading:m.isLoading,error:f,onClick:v,view:"action"});return(0,r.jsxs)("div",{className:mq(),children:[(0,r.jsxs)("div",{className:mq("left"),children:[(0,r.jsx)(mL,{type:"run",isHighlighted:"execute"===a,isLoading:t,isStoppable:h,controlsDisabled:E,onActionClick:w,renderStopButton:_}),(0,r.jsx)(mL,{type:"explain",isHighlighted:"explain"===a,isLoading:t,isStoppable:h,controlsDisabled:E,onActionClick:S,renderStopButton:_}),(0,r.jsx)(mO,{onClick:c,isLoading:t})]}),(0,r.jsxs)("div",{className:mq("right"),children:[(0,r.jsx)(mw,{}),(0,r.jsx)(uW,{buttonProps:{disabled:e}})]})]})};var mF=a(80791);function mQ(e){if("object"==typeof e&&null!==e&&"name"in e&&"AbortError"===e.name||(0,T.cH)(e)&&e.isCancelled)return!0;let t=(0,eK.KH)(e);return(0,eK.We)(t)&&t.error?.message==="Query was cancelled"}let mU=10*v.KF,m$=(0,c.cn)("kv-query-execution-status"),mG=({className:e,error:t,loading:a})=>{let s,i,l,o,{startTime:c,endTime:d}=(0,j.N4)(lt.$u),u=function({startTime:e,endTime:t,loading:a}){let[r,s]=n.useState(e?(t||Date.now())-e:0),i=n.useCallback(()=>{e&&s((t||Date.now())-e)},[t,e]),l=n.useRef(void 0),o=n.useRef(!1),c=n.useCallback(()=>{if(o.current||(i(),!a||!e))return;let r=(t||Date.now())-e,n=Math.floor((2*Math.random()-1)*20);l.current=setTimeout(c,r<mU?100+n:v.KF)},[i,a,e,t]);return n.useEffect(()=>(o.current=!1,c(),()=>{o.current=!0,l.current&&clearTimeout(l.current)}),[c]),r}({startTime:c,endTime:d,loading:a}),p=n.useMemo(()=>u<10*v.KF?(0,cH.duration)(u).format("mm:ss.SSS"):u>v.Jg*v.KF?(0,cH.duration)(u).format("hh:mm:ss"):(0,cH.duration)(u).format("mm:ss"),[u]),m=mQ(t);if(a)l="info",o="info-heavy",s=(0,r.jsx)(mF.t,{size:"xs"}),i="Running";else if((0,T.F0)(t)&&"ECONNABORTED"===t.code)l="danger",o="danger-heavy",s=(0,r.jsx)(ek.I,{data:sD.A}),i="Connection aborted";else if(m)l="warning",o="warning-heavy",s=(0,r.jsx)(ek.I,{data:eI.A,className:m$("result-status-icon",{error:!0})}),i="Stopped";else{let e=!!t;l=e?"danger":"success",o=e?"danger-heavy":"positive-heavy",s=(0,r.jsx)(ek.I,{data:e?an.A:sR.A,className:m$("result-status-icon",{error:e})}),i=e?"Failed":"Completed"}return(0,r.jsx)(tc.J,{theme:l,size:"m",className:m$(null,e),icon:s,value:p,children:(0,r.jsx)(eA.E,{color:o,children:i})})},mH=(0,c.cn)("ydb-query-settings-banner");function mB(){let{isBannerShown:e,changedLastExecutionSettingsDescriptions:t,closeBanner:a}=pd();return e?(0,r.jsx)(sv.F,{className:mH(),theme:"info",align:"baseline",style:{paddingTop:11,paddingBottom:11},message:(0,r.jsx)(mA,{prefix:u3("banner.query-settings.message"),querySettings:t}),onClose:a}):null}let mW=(0,c.cn)("ydb-query-stopped-banner");function mV(){let[e,t]=(0,j.iK)(sg.GS.QUERY_STOPPED_BANNER_CLOSED),a=n.useCallback(()=>{t(!0)},[t]);return e?null:(0,r.jsx)(sv.F,{className:mW(),theme:"normal",align:"center",style:{paddingTop:11,paddingBottom:11},message:(0,r.jsx)("div",{className:mW("message"),children:u3("banner.query-stopped.message")}),layout:"horizontal",actions:(0,r.jsx)(sv.F.Actions,{children:(0,r.jsx)(sv.F.Action,{view:"normal",onClick:a,children:u3("banner.query-stopped.never-show")})})})}function mJ(e){return e.replaceAll("\\","\\\\").replaceAll("\n","\\n").replaceAll("\r","\\r").replaceAll("	","\\t")}var mY=a(34495);let mK=(0,c.cn)("ydb-query-ast"),mZ={automaticLayout:!0,selectOnLineNumbers:!0,readOnly:!0,minimap:{enabled:!1},wrappingIndent:"indent"};function mX({ast:e,theme:t}){return(0,r.jsx)("div",{className:mK(),children:(0,r.jsx)(mY.default,{language:"s-expression",value:e,options:mZ,theme:`vs-${t}`})})}var m0=a(50448);function m1(e){let t=n.useRef(null),a=n.useId(),{data:s,opts:i,shapes:l}=e;return n.useEffect(()=>{let e=t.current;if(!e)return;e.innerHTML="",e.style.setProperty("width","100vw"),e.style.setProperty("height","100vh");let a=(0,m0.og)(e.id,s,i,l);return a.render(),e.style.setProperty("width","100%"),e.style.setProperty("height","100%"),()=>{a.destroy()}},[s,i,l]),(0,r.jsx)("div",{id:a,ref:t,style:{overflow:"auto"}})}let m2={renderNodeTitle:e=>{let t=e.name.split("|");return t.length>1?t[1]:e.name},textOverflow:"normal",initialZoomFitsCanvas:!0},m3={node:m0.SO};function m4(e){return(0,r.jsx)(m1,{...e,opts:m2,shapes:m3})}var m5=JSON.parse('{"description.graph-is-not-supported":"Graph can not be rendered","description.empty-result":"There is no {{activeSection}} for the request","action.result":"Result","action.stats":"Stats","action.schema":"Computation Graph","action.explain-plan":"Explain","action.json":"JSON","action.ast":"AST","action.copy":"Copy {{activeSection}}","trace":"Trace","title.truncated":"Truncated","title.result":"Result","tooltip_actions":"Actions","text_open-execution-plan":"Open Execution Plan","text_open-execution-plan_description":"New tab","text_download":"Download Execution Plan","text_download_description":"SVG","text_diagnostics":"Download Diagnostics","text_diagnostics_description":"JSON","text_error-plan-svg":"Error: {{error}}","error.title":"Query Failed","error.description":"An error occurred, please see the Result tab for details","stopped.title":"Query stopped","stopped.description":"Query was stopped"}');let m6=(0,ex.g4)("ydb-execute-result",{en:m5}),m7=(0,c.cn)("ydb-query-result-stub-message");function m8({message:e}){return(0,r.jsx)("div",{className:m7(null),children:e})}let m9=(0,c.cn)("ydb-query-explain-graph");function he({explain:e={},theme:t}){let{links:a,nodes:s}=e,i=n.useMemo(()=>({links:a,nodes:s}),[a,s]);return i.links&&i.nodes&&i.nodes.length?(0,r.jsx)("div",{className:m9("canvas-container"),children:(0,r.jsx)(m4,{data:i},t)}):(0,r.jsx)(m8,{message:m6("description.graph-is-not-supported")})}var ht=a(97634);let ha=(0,c.cn)("query-info-dropdown");var hr=a(14184);let hn=g.F.injectEndpoints({endpoints:e=>({planToSvgQuery:e.query({queryFn:async({plan:e,database:t},{signal:a})=>{try{return{data:await window.api.viewer.planToSvg({database:t,plan:e},{signal:a})}}catch(e){return{error:e}}}})}),overrideExisting:"throw"});var hs=a(99382);function hi({title:e,description:t}){return(0,r.jsxs)("div",{className:ha("menu-item-content"),children:[(0,r.jsx)(eA.E,{variant:"body-1",children:e}),(0,r.jsx)(eA.E,{variant:"body-1",color:"secondary",children:t})]})}function hl({queryResultsInfo:e,database:t,hasPlanToSvg:a,error:s}){let{isLoading:i,items:l}=function({queryResultsInfo:e,database:t,hasPlanToSvg:a,error:s}){let[i,l]=n.useState(null),[o,{isLoading:c}]=hn.useLazyPlanToSvgQueryQuery();return n.useEffect(()=>()=>{i&&URL.revokeObjectURL(i)},[i]),{isLoading:c,items:n.useMemo(()=>{let n=[],c=e.plan;if(c&&a){let e=()=>i?Promise.resolve(i):o({plan:c,database:t}).unwrap().then(e=>{let t=new Blob([e],{type:"image/svg+xml"}),a=URL.createObjectURL(t);return l(a),a}).catch(e=>{let t=(0,hs.a)(e);return(0,eL.A)({title:m6("text_error-plan-svg",{error:t}),name:"plan-svg-error",theme:"danger"}),null});n.push([{text:(0,r.jsx)(hi,{title:m6("text_open-execution-plan"),description:m6("text_open-execution-plan_description")}),iconStart:(0,r.jsx)(hr.A,{className:ha("icon")}),action:()=>{e().then(e=>{e&&window.open(e,"_blank")})},className:ha("menu-item")},{text:(0,r.jsx)(hi,{title:m6("text_download"),description:m6("text_download_description")}),iconStart:(0,r.jsx)(dY.A,{className:ha("icon")}),action:()=>{e().then(e=>{e&&dX(e,"query-plan.svg")})},className:ha("menu-item")}])}return e&&n.push([{text:(0,r.jsx)(hi,{title:m6("text_diagnostics"),description:m6("text_diagnostics_description")}),iconStart:(0,r.jsx)(dY.A,{className:ha("icon")}),action:()=>{let a=s?(0,eK.KH)(s):void 0;d1({...e,database:t,...a&&{error:a}},`query-diagnostics-${new Date().getTime()}`)},className:ha("menu-item")}]),n},[e,a,i,o,t,s])}}({queryResultsInfo:e,database:t,hasPlanToSvg:a,error:s});return l.length?(0,r.jsx)(n$.r,{popupProps:{placement:["bottom-end","left"]},switcherWrapperClassName:ha("query-info-switcher-wrapper"),renderSwitcher:e=>(0,r.jsx)(eR.m,{title:m6("tooltip_actions"),children:(0,r.jsx)(tM.$,{view:"flat-secondary",loading:i,disabled:i,...e,children:(0,r.jsx)(tM.$.Icon,{children:(0,r.jsx)(ht.A,{})})})}),items:l,size:"xl"}):null}let ho=(0,c.cn)("ydb-query-json-viewer");function hc({data:e}){let t=n.useRef(null),a=(0,j.N4)(e=>e.fullscreen);return(0,r.jsx)("div",{className:ho(),children:(0,r.jsx)("div",{className:ho("tree"),ref:t,children:(0,r.jsx)(rs.p,{value:e,scrollContainerRef:t},String(a))})})}let hd=(0,c.cn)("ydb-query-result-error");function hu({error:e}){let t=(0,eK.KH)(e);return!t||mQ(e)?null:(0,T.TX)(e)?(0,r.jsx)("div",{className:hd("message"),children:e.message}):"object"==typeof t?(0,r.jsx)("div",{className:hd("message"),children:(0,r.jsx)(ne.OI,{data:t})}):(0,r.jsx)("div",{className:hd("message"),children:t})}let hp=(0,c.cn)("ydb-query-result-sets-viewer");function hm(e){let{selectedResultSet:t,setSelectedResultSet:a,resultSets:s,error:i}=e,l=n.useRef(null),o=s?.[t];return(0,r.jsxs)("div",{className:hp("result-wrapper"),children:[e.error?(0,r.jsx)(hu,{error:i}):null,(()=>{if(s?.length)if(s?.length>1)return(0,r.jsx)(_.f,{value:String(t),children:(0,r.jsx)(N.w,{className:hp("tabs"),size:"l",children:s?.map((e,t)=>{let n=s?.[t];return(0,r.jsx)(oF.o,{value:String(t),onClick:()=>a(t),children:(0,r.jsxs)(eD.s,{gap:2,alignItems:"center",children:[(0,r.jsx)(eA.E,{children:`Result #${t+1}${s?.[t]?.truncated?"(T)":""}`}),(0,r.jsx)(eA.E,{color:"secondary",children:n.result?.length||0})]})},t)})})});else{let e;return e=s?.[0],(0,r.jsxs)(eD.s,{gap:2,alignItems:"center",className:hp("title"),children:[(0,r.jsx)(eA.E,{children:e?.truncated?"Truncated":"Result"}),(0,r.jsx)(eA.E,{color:"secondary",children:e?.result?.length||0})]})}return null})(),o?(0,r.jsx)("div",{className:hp("result"),ref:l,children:(0,r.jsx)(pP,{settings:e.tableSettings,data:o.result,columns:o.columns})}):null]})}var hh=a(51936),hg=a(43696),hx=a(79938);let hy=(0,c.cn)("ydb-query-simplified-plan");function hf({value:e,formatter:t}){if(!(0,np.kf)(e))return;let a=t(Number(e));return(0,r.jsx)("div",{className:hy("metrics-cell"),children:a})}let hb={Table:"var(--g-color-text-info)",Predicate:"var(--g-color-text-positive)",Condition:"var(--g-color-text-utility)"};function hv(e){return e in hb?hb[e]:"var(--g-color-text-secondary)"}function hj({params:e}){return e?(0,r.jsxs)("span",{className:hy("operation-params"),children:["(",function(e={}){let t=[],a=Object.entries(e);if(1===a.length){let e=a[0][1],n=hv(a[0][0]);t.push((0,r.jsx)("span",{style:{color:n},children:(0,Q.vN)(e)},"param"))}else{let a=function(e){let t=[],{Table:a,Predicate:r,Condition:n,...s}=e;return a&&t.push(["Table",a]),r&&t.push(["Predicate",r]),n&&t.push(["Condition",n]),t.concat(Object.entries(s))}(e);for(let e=0;e<a.length;e++){let[n,s]=a[e],i=hv(n);e>0&&t.push(", "),t.push((0,r.jsxs)("span",{style:{color:i},children:[n,": ",(0,Q.vN)(s)]},e))}}return t}(e),")"]}):null}function hT({modifiers:e,left:t}){return(0,r.jsx)("div",{className:hy("divider",e),style:{left:t}})}function hw({row:e,depth:t=0,params:a}){let{name:s,operationParams:i,lines:l=""}=a,o=e.getLeafRows().length>0&&e.getIsExpanded(),c=n.useMemo(()=>(function(e,t){let a=e.split(".").map(Number),n=[];for(let e=0;e<a.length;e++)e===a.length-1&&0!==e&&(a[e]?n.push((0,r.jsx)(hT,{modifiers:{horizontal:!0},left:10+25*(e-1)},"last")):n.push((0,r.jsx)(hT,{modifiers:{last:!0},left:9+25*(e-1)},"last"))),e===a.length-1&&t&&n.push((0,r.jsx)(hT,{modifiers:{first:!0},left:9+25*e},"first")),a[e]&&n.push((0,r.jsx)(hT,{left:9+25*(e-1)},e));return n})(l,o),[l,o]);return(0,r.jsxs)("div",{style:{paddingLeft:25*t},className:hy("operation-name"),children:[c,(0,r.jsxs)(eD.s,{gap:1,className:hy("operation-content"),children:[e.getCanExpand()&&(0,r.jsx)(tM.$,{view:"flat",size:"xs",onClick:e.getToggleExpandedHandler(),children:(0,r.jsx)(tM.$.Icon,{children:(0,r.jsx)(nM.I,{direction:e.getIsExpanded()?"bottom":"right",size:14})})}),(0,r.jsx)("div",{className:hy("operation-name-content"),children:(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:hy("operation-name"),children:s}),"\xa0",(0,r.jsx)(hj,{params:i})]})})]})]})}function hS(e){return(0,r.jsx)(hf,{value:e.getValue(),formatter:e=>e<1e8?(0,hx.p)(e).format():(0,np.z0)(e,1)})}let hE=[{accessorKey:"name",accessorFn:function(e){return{name:e.name,operationParams:e.operationParams,lines:e.lines}},header:()=>(0,r.jsx)(hg.A,{children:"Operation"}),size:600,cell:e=>(0,r.jsx)(hw,{row:e.row,depth:e.row.depth,params:e.getValue()})},{accessorKey:"aCpu",header:()=>(0,r.jsx)(hg.A,{children:"A-Cpu"}),size:90,minSize:90,cell:function(e){return(0,r.jsx)(hf,{value:e.getValue(),formatter:e=>(0,ez.Xo)(Math.round(e))})},meta:{align:"right",verticalAlign:"top"}},{accessorKey:"aRows",header:()=>(0,r.jsx)(hg.A,{children:"A-Rows"}),size:90,minSize:90,cell:hS,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eCost",header:()=>(0,r.jsx)(hg.A,{children:"E-Cost"}),size:90,minSize:90,cell:hS,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eRows",header:()=>(0,r.jsx)(hg.A,{children:"E-Rows"}),size:90,minSize:90,cell:hS,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eSize",header:()=>(0,r.jsx)(hg.A,{children:"E-Size"}),size:90,minSize:90,cell:hS,meta:{align:"right",verticalAlign:"top"}}];function h_({plan:e}){let t=n.useMemo(()=>(function(e,t=""){if(!e)return[];let a=[{items:e,prefix:t,parentIndex:-1,parentArray:[]}],r=[];for(;a.length>0;){let{items:e,prefix:t,parentIndex:n,parentArray:s}=a.pop(),i=[];for(let r=0;r<e.length;r++){let n={...e[r]},s=+(r<e.length-1),l=`${t}.${s}`;t||(l=String(s)),n.lines=l,i.push(n),n.children&&a.push({items:n.children,prefix:l,parentIndex:r,parentArray:i})}-1===n?r.push(...i):s[n].children=i}return r})(e),[e]),[a,s]=n.useState(!0),i=(0,hh.K2)({columns:hE,data:t,getSubRows:e=>e.children,enableExpanding:!0,onExpandedChange:s,state:{expanded:a},enableColumnResizing:!0,columnResizeMode:"onChange"});return(0,r.jsx)(hg.X,{wrapperClassName:hy(),table:i,stickyHeader:!0,width:"max"})}function hN({traceId:e}){var t,a;let{traceView:n}=(0,A.Zd)(),s=n?.url?(t=n.url,a={traceId:e},t.replace(/\${(\w+)}/g,(e,t)=>a[t]||e)):"";return s?(0,r.jsxs)(tM.$,{view:"flat-info",href:s,target:"_blank",children:[m6("trace"),(0,r.jsx)(tM.$.Icon,{children:(0,r.jsx)(hr.A,{})})]}):null}let hC=(0,c.cn)("ydb-query-result"),hP="result",hI="schema",hA="simplified",hD="json",hR="stats",hk={get result(){return m6("action.result")},get schema(){return m6("action.schema")},get simplified(){return m6("action.explain-plan")},get json(){return m6("action.json")},get stats(){return m6("action.stats")},get ast(){return m6("action.ast")}},hM=["result","schema","simplified","stats"],hO=["schema","simplified","json","ast"];function hq({result:e,resultType:t="execute",isResultsCollapsed:a,theme:s,database:i,queryText:o,tableSettings:c,onCollapseResults:d,onExpandResults:u}){let p,m=(0,j.YQ)(),h=(0,j.N4)(lt.LI),g="execute"===t,x="explain"===t,[y,f]=n.useState(0),[b]=(0,j.iK)(sg.GS.USE_SHOW_PLAN_SVG),v=n.useMemo(()=>{let e=h?.[t];return e&&(g?hM:hO).includes(e)?e:g?hP:hI},[h,t,g]),{error:T,isLoading:w,data:S={}}=e,{preparedPlan:E,simplifiedPlan:_,stats:N,resultSets:C,ast:P}=S;n.useEffect(()=>()=>{m((0,dd.sM)())},[m]);let I=n.useMemo(()=>{let e=[];return g?e=hM:x&&(e=hO),e.map(e=>({value:e,content:hk[e]}))},[g,x]),A=()=>(0,r.jsx)(m8,{message:m6("description.empty-result",{activeSection:hk[v]})}),D=e=>(0,r.jsxs)(eD.s,{justifyContent:"center",alignItems:"center",width:"100%",gap:8,children:[(0,r.jsx)(o0.v,{name:"error",className:hC("illustration")}),(0,r.jsxs)(eD.s,{direction:"column",gap:2,children:[(0,r.jsx)(eA.E,{variant:"subheader-2",children:e?m6("stopped.title"):m6("error.title")}),(0,r.jsx)(eA.E,{color:"complementary",children:e?m6("stopped.description"):m6("error.description")})]})]}),R=mQ(T);return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)("div",{className:hC("controls"),children:[(0,r.jsxs)("div",{className:hC("controls-left"),children:[I.length&&v?(0,r.jsx)(cM.x,{options:I,value:v,onUpdate:e=>{m((0,lt.Hp)({queryType:t,tabId:e}))}}):null,(0,r.jsx)(mG,{error:T,loading:w}),S?.traceId&&g?(0,r.jsx)(hN,{traceId:S.traceId}):null]}),(0,r.jsxs)("div",{className:hC("controls-right"),children:[w||mQ(T)?null:(0,r.jsx)(hl,{queryResultsInfo:{queryText:o,ast:S.ast,stats:S.stats,plan:S.plan},error:T,database:i,hasPlanToSvg:!!(S?.plan&&b&&g)}),(()=>{if(w)return null;let e=(()=>{switch(v){case hP:{let e=S?.resultSets?.[y];return function(e){if(!e?.length)return"";let t=Object.keys(e[0]),a=[t.map(mJ).join("	")];for(let r of e){let e=[];for(let a of t){let t=r[a];e.push(mJ("object"==typeof t?JSON.stringify(t):`${t}`))}a.push(e.join("	"))}return a.join("\n")}(e?.result)}case hD:return E?.pristine;case hA:return _?.pristine;case hR:return N;case"ast":return P;default:return}})(),t=(0,Q.vN)(e);return t?(0,r.jsx)(dK.b,{text:t,view:"flat-secondary",title:m6("action.copy",{activeSection:v})}):null})(),(0,r.jsx)(dm,{}),(0,r.jsx)(pf,{onCollapse:d,onExpand:u,isCollapsed:a,initialDirection:"bottom"})]})]}),w||R?null:(0,r.jsx)(mB,{}),R&&S.resultSets?.length?(0,r.jsx)(mV,{}):null,(0,r.jsx)(l.r,{loading:w&&(!S.resultSets||"result"!==v),children:(0,r.jsx)(df,{className:hC("result"),children:(p=mQ(T),v===hP?T&&p&&!C?.length?D(p):(0,r.jsx)(hm,{resultSets:C,error:T,selectedResultSet:y,tableSettings:c,setSelectedResultSet:f}):T?g||p?D(p):(0,r.jsx)(hu,{error:T}):v===hI?E?.nodes?.length?(0,r.jsx)(he,{theme:s,explain:E}):A():v===hD?E?.pristine?(0,r.jsx)(hc,{data:E?.pristine}):A():v===hA?_?.plan?.length?(0,r.jsx)(h_,{plan:_.plan}):A():v===hR?N?(0,r.jsx)(hc,{data:N}):A():"ast"===v?P?(0,r.jsx)(mX,{ast:P,theme:s}):A():null)})})]})}var hL=a(42368),hz=a(53285),hF=a(49785);let hQ=()=>-1,hU=(0,c.cn)("ydb-query-settings-select");function h$(e){return(0,r.jsx)("div",{className:hU("selector"),children:(0,r.jsx)(M.l,{id:e.id,disabled:e.disabled,options:e.settingOptions,value:[e.setting],onUpdate:t=>{e.onUpdateSetting(t[0])},getOptionHeight:hQ,popupClassName:hU("popup"),renderOption:e=>(0,r.jsxs)("div",{className:hU("item",{type:e.value}),children:[(0,r.jsxs)("div",{className:hU("item-title"),children:[e.content,e.isDefault?pe("description.default"):""]}),e.text&&(0,r.jsx)("span",{className:hU("item-description"),children:e.text})]}),width:"max"})})}var hG=a(50626);let hH=(0,c.cn)("ydb-timeout-label");function hB({isDisabled:e,isChecked:t,onToggle:a}){let[n]=(0,j.gz)();return n?(0,r.jsxs)("div",{className:hH("switch-title"),children:[(0,r.jsx)(hG.d,{disabled:e,checked:t,onUpdate:a,className:hH("switch"),content:ps.timeout.title}),e&&(0,r.jsx)(az.H,{className:hH("question-icon"),popoverProps:{placement:"bottom-start"},children:pe("form.timeout.disabled")})]}):(0,r.jsx)("label",{htmlFor:"timeout",className:hH("label-title"),children:ps.timeout.title})}let hW=(0,c.cn)("ydb-query-settings-timeout");function hV({id:e,value:t,onChange:a,onToggle:s,validationState:i,errorMessage:l,isDisabled:o}){let c=n.useCallback(e=>{a(e.target.value?Number(e.target.value):void 0)},[a]),d=null!==t;return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(hB,{isDisabled:o,isChecked:d,onToggle:s}),d&&(0,r.jsx)("div",{className:hW("control-wrapper"),children:(0,r.jsx)(t6.k,{id:e,type:"number",value:t?.toString()||"",onChange:c,className:hW("input"),placeholder:"60",validationState:i,errorMessage:l,errorPlacement:"inside",endContent:(0,r.jsx)("span",{className:hW("postfix"),children:pe("form.timeout.seconds")})})})]})}let hJ=(0,c.cn)("ydb-query-settings-dialog");function hY(){let e=(0,j.YQ)(),t=(0,j.N4)(uz.xM),[a,s]=(0,j.XS)(),i=n.useCallback(()=>{e((0,uz.NJ)("idle"))},[e]),l=n.useCallback(e=>{s(e),i()},[i,s]);return(0,r.jsxs)(t5.l,{open:"settings"===t,size:"s",onClose:i,className:hJ(),hasCloseButton:!1,children:[(0,r.jsx)(t5.l.Header,{caption:pe("action.settings")}),(0,r.jsx)(hK,{initialValues:a,onSubmit:l,onClose:i})]})}function hK({initialValues:e,onSubmit:t,onClose:a}){let{control:n,handleSubmit:s,setValue:i,watch:l,formState:{errors:o}}=(0,hF.mN)({defaultValues:e,resolver:(0,hz.u)(eK.id)}),[c]=(0,j.iK)(sg.GS.USE_SHOW_PLAN_SVG),d=(0,I.Oi)(),[u]=(0,j.gz)(),p=l("timeout"),m=l("queryMode");return(0,r.jsxs)("form",{onSubmit:s(t),children:[(0,r.jsxs)(t5.l.Body,{className:hJ("dialog-body"),children:[(0,r.jsxs)(eD.s,{direction:"row",alignItems:"flex-start",className:hJ("dialog-row"),children:[(0,r.jsx)("label",{htmlFor:"queryMode",className:hJ("field-title"),children:ps.queryMode.title}),(0,r.jsx)("div",{className:hJ("control-wrapper",{queryMode:!0}),children:(0,r.jsx)(hF.xI,{name:"queryMode",control:n,render:({field:e})=>(0,r.jsx)(h$,{id:"queryMode",setting:e.value,onUpdateSetting:t=>{e.onChange(t),"query"!==t&&null===p?i("timeout",""):"query"===t&&i("timeout",null)},settingOptions:ps.queryMode.options})})})]}),d&&(0,r.jsxs)(eD.s,{direction:"row",alignItems:"flex-start",className:hJ("dialog-row"),children:[(0,r.jsx)("label",{htmlFor:"tracingLevel",className:hJ("field-title"),children:ps.tracingLevel.title}),(0,r.jsx)("div",{className:hJ("control-wrapper"),children:(0,r.jsx)(hF.xI,{name:"tracingLevel",control:n,render:({field:e})=>(0,r.jsx)(h$,{id:"tracingLevel",setting:e.value,onUpdateSetting:e.onChange,settingOptions:ps.tracingLevel.options})})})]}),(0,r.jsxs)(eD.s,{direction:"row",alignItems:"flex-start",className:hJ("dialog-row"),children:[(0,r.jsx)("label",{htmlFor:"transactionMode",className:hJ("field-title"),children:ps.transactionMode.title}),(0,r.jsx)("div",{className:hJ("control-wrapper",{transactionMode:!0}),children:(0,r.jsx)(hF.xI,{name:"transactionMode",control:n,render:({field:e})=>(0,r.jsx)(h$,{id:"transactionMode",setting:e.value,onUpdateSetting:e.onChange,settingOptions:ps.transactionMode.options})})})]}),(0,r.jsxs)(eD.s,{direction:"row",alignItems:"flex-start",className:hJ("dialog-row"),children:[(0,r.jsx)("label",{htmlFor:"statisticsMode",className:hJ("field-title"),children:ps.statisticsMode.title}),(0,r.jsx)(mP.m,{className:hJ("statistics-mode-tooltip"),disabled:!c,openDelay:0,content:pe("tooltip_plan-to-svg-statistics"),children:(0,r.jsx)("div",{className:hJ("control-wrapper",{statisticsMode:!0}),children:(0,r.jsx)(hF.xI,{name:"statisticsMode",control:n,render:({field:e})=>(0,r.jsx)(h$,{id:"statisticsMode",disabled:c,setting:e.value,onUpdateSetting:e.onChange,settingOptions:ps.statisticsMode.options})})})})]}),(0,r.jsxs)(eD.s,{direction:"row",alignItems:"flex-start",className:hJ("dialog-row"),children:[(0,r.jsx)("label",{htmlFor:"limitRows",className:hJ("field-title"),children:ps.limitRows.title}),(0,r.jsx)("div",{className:hJ("control-wrapper"),children:(0,r.jsx)(hF.xI,{name:"limitRows",control:n,render:({field:e})=>(0,r.jsx)(t6.k,{id:"limitRows",type:"number",...e,value:e.value?.toString(),className:hJ("limit-rows"),placeholder:"10000",validationState:o.limitRows?"invalid":void 0,errorMessage:o.limitRows?.message,errorPlacement:"inside",endContent:(0,r.jsx)("span",{className:hJ("postfix"),children:pe("form.limit.rows")})})})})]}),u&&(0,r.jsxs)(eD.s,{direction:"row",alignItems:"flex-start",className:hJ("dialog-row"),children:[(0,r.jsx)("label",{htmlFor:"outputChunkMaxSize",className:hJ("field-title"),children:ps.outputChunkMaxSize.title}),(0,r.jsx)("div",{className:hJ("control-wrapper"),children:(0,r.jsx)(hF.xI,{name:"outputChunkMaxSize",control:n,render:({field:e})=>(0,r.jsx)(t6.k,{id:"outputChunkMaxSize",type:"number",...e,value:e.value?.toString(),className:hJ("output-chunk-max-size"),placeholder:"1000000",validationState:o.outputChunkMaxSize?"invalid":void 0,errorMessage:o.outputChunkMaxSize?.message,errorPlacement:"inside",endContent:(0,r.jsx)("span",{className:hJ("postfix"),children:pe("form.output.chunk.max.size.bytes")})})})})]}),(0,r.jsxs)(eD.s,{direction:"row",alignItems:"flex-start",className:hJ("dialog-row"),children:[(0,r.jsx)("label",{htmlFor:"pragmas",className:hJ("field-title"),children:ps.pragmas.title}),(0,r.jsx)("div",{className:hJ("control-wrapper"),children:(0,r.jsx)(hF.xI,{name:"pragmas",control:n,render:({field:e})=>(0,r.jsx)(hL.f,{id:"pragmas",...e,className:hJ("pragmas"),placeholder:"PRAGMA OrderedColumns;",rows:3,validationState:o.pragmas?"invalid":void 0,errorMessage:o.pragmas?.message,errorPlacement:"inside"})})})]}),(0,r.jsx)(eD.s,{direction:"row",alignItems:"flex-start",className:hJ("dialog-row"),children:(0,r.jsx)(hF.xI,{name:"timeout",control:n,render:({field:e})=>(0,r.jsx)(hV,{id:"timeout",value:"string"==typeof e.value?void 0:e.value,onChange:e.onChange,onToggle:t=>e.onChange(t?"":null),validationState:o.timeout?"invalid":void 0,errorMessage:o.timeout?.message,isDisabled:m!==eK.ei.query})})})]}),(0,r.jsx)(t5.l.Footer,{textButtonApply:pe("button-done"),textButtonCancel:pe("button-cancel"),onClickButtonCancel:a,propsButtonApply:{type:"submit"},renderButtons:(e,t)=>(0,r.jsxs)("div",{className:hJ("buttons-container"),children:[(0,r.jsx)(tM.$,{href:"https://ydb.tech/docs",target:"_blank",view:"outlined",size:"l",children:pe("docs")}),(0,r.jsxs)("div",{className:hJ("main-buttons"),children:[t,e]})]})})]})}var hZ=a(23398);let hX=(0,a(84187)._)(async()=>({Editor:(await Promise.resolve().then(a.bind(a,34495))).default}),"Editor");var h0=a(15452),h1=a(72680),h2=JSON.parse('{"context_syntax-error":"Syntax error"}');let h3=(0,ex.g4)("ydb-monaco",{en:h2}),h4=(0,eU.debounce)(function(){let e=window.ydbEditor?.getModel();if(!e)return void console.error("unable to retrieve model when highlighting errors");let t=(0,h0.kh)(e.getValue()).errors;if(!t.length)return void h5();let a=t.map(e=>({message:h3("context_syntax-error"),source:e.message,severity:h1.MarkerSeverity.Error,startLineNumber:e.startLine,startColumn:e.startColumn+1,endLineNumber:e.endLine,endColumn:e.endColumn+1}));h1.editor.setModelMarkers(e,"ydb",a)},500);function h5(){h1.editor.removeAllMarkers("ydb")}let h6="navigation";function h7({changeUserInput:e,theme:t,handleSendExecuteClick:a,handleGetExplainQueryClick:s,historyQueries:i,goToPreviousQuery:l,goToNextQuery:o}){let c,d=(0,j.N4)(lt.Wp),u=(0,j.YQ)(),[p,m]=n.useState(),[h]=(0,j.iK)(sg.GS.ENABLE_CODE_ASSISTANT),g=function(){let[e]=(0,j.iK)(sg.GS.ENABLE_AUTOCOMPLETE),[t]=(0,j.iK)(sg.GS.AUTOCOMPLETE_ON_ENTER);return n.useMemo(()=>{let a=!!e;return{quickSuggestions:a,suggestOnTriggerCharacters:a,acceptSuggestionOnEnter:t?"on":"off",...mE}},[e,t])}(),x=(n.useEffect(()=>()=>{h4.cancel()},[h4]),c=h4,n.useCallback(()=>{h5(),c()},[c])),[y]=(0,j.iK)(sg.GS.LAST_USED_QUERY_ACTION),f=(0,j.A5)(()=>i&&0!==i.length?i[i.length-1].queryText:""),b=(0,j.A5)(()=>{y===eK.x5.explain?s(d):a(d)}),{monacoGhostConfig:v,prepareUserQueriesCache:T}=function(e){let[t]=mS.useLazyGetCodeAssistSuggestionsQuery(),[a]=mS.useAcceptSuggestionMutation(),[r]=mS.useDiscardSuggestionMutation(),[s]=mS.useIgnoreSuggestionMutation(),[i]=mS.useSendUserQueriesDataMutation(),{savedQueries:l}=uF(),o=n.useCallback(async e=>t(e).unwrap(),[t]),c=n.useCallback(async e=>a(e).unwrap(),[a]),d=n.useCallback(async e=>r(e).unwrap(),[r]),u=n.useCallback(async e=>s(e).unwrap(),[s]),p=n.useMemo(()=>[...e.map((e,t)=>({name:`query${t}.yql`,text:e.queryText})),...(l??[]).map(e=>({name:e.name,text:e.body}))],[e,l]);return{prepareUserQueriesCache:n.useCallback(async()=>{let e=p.map((e,t)=>({FileName:e.name||`query${t}.yql`,Text:e.text}));try{return await i(e).unwrap()}catch{return{items:[]}}},[i,p]),monacoGhostConfig:n.useMemo(()=>({api:{getCodeAssistSuggestions:o},eventHandlers:{onCompletionAccept:c,onCompletionDecline:d,onCompletionIgnore:u},config:{language:"yql"}}),[o,c,d,u])}}(i);return n.useEffect(()=>(p&&h&&(p.register(v),T()),()=>{p?.unregister()}),[h,v,p,T]),(0,r.jsx)(hX,{language:"yql",value:d,options:g,onChange:t=>{x(),e({input:t}),u((0,lt.Xb)(!0))},editorDidMount:(e,t)=>{var r,n,s;let i;window.ydbEditor=e;let c=function(e){let{KeyMod:t,KeyCode:a}=e,r=t.CtrlCmd;return{sendQuery:r|a.Enter,sendSelectedQuery:r|t.Shift|e.KeyCode.Enter,saveQuery:r|a.KeyS,saveSelectedQuery:r|t.Shift|a.KeyS,shortcutsHotkey:r|a.KeyK}}(t);t.editor.registerCommand("insertSnippetToEditor",(t,a)=>{let r=e.getContribution("snippetController2");r&&(e.focus(),e.setValue(""),r.insert(a),u((0,lt.Xb)(!1)))}),window.api.codeAssist&&m((0,hZ._z)(e)),r=e,i=$()(()=>{r.layout()},100),r.layout(),window.addEventListener("resize",i),r.onDidDispose(()=>{window.removeEventListener("resize",i)}),n=e,s=f,h8(n.getValue(),s()),n.onDidChangeModelContent(()=>{h8(n.getValue(),s())}),n.onDidDispose(()=>{window.onbeforeunload=null}),e.focus(),e.addAction({id:"sendQuery",label:u3("action.send-query"),keybindings:[c.sendQuery],precondition:void 0,keybindingContext:void 0,contextMenuGroupId:h6,contextMenuOrder:1,run:()=>b()});let d=e.createContextKey("canSendSelectedText",!1);e.onDidChangeCursorSelection(({selection:e,secondarySelections:t})=>{let a=e.selectionStartLineNumber!==e.positionLineNumber||e.selectionStartColumn!==e.positionColumn,r=t.length>0;d.set(a&&!r)}),e.addAction({id:"sendSelectedQuery",label:u3("action.send-selected-query"),keybindings:[c.sendSelectedQuery],precondition:"canSendSelectedText",contextMenuGroupId:h6,contextMenuOrder:1,run:e=>{let t=e.getSelection(),r=e.getModel();t&&r&&a(r.getValueInRange({startLineNumber:t.getSelectionStart().lineNumber,startColumn:t.getSelectionStart().column,endLineNumber:t.getPosition().lineNumber,endColumn:t.getPosition().column}),!0)}}),e.addAction({id:"previous-query",label:u3("action.previous-query"),contextMenuGroupId:h6,contextMenuOrder:2,run:()=>{l()}}),e.addAction({id:"next-query",label:u3("action.next-query"),contextMenuGroupId:h6,contextMenuOrder:3,run:()=>{o()}}),e.addAction({id:"save-query",label:u3("action.save-query"),keybindings:[c.saveQuery],run:()=>{t4.Ay.show(uJ)}}),e.addAction({id:"openKeyboardShortcutsPanel",label:u3("action.open-shortcuts"),keybindings:[c.shortcutsHotkey],contextMenuGroupId:h6,contextMenuOrder:4,run:()=>{let e=new CustomEvent("openKeyboardShortcutsPanel");window.dispatchEvent(e)}})},theme:`vs-${t}`,editorWillUnmount:()=>{window.ydbEditor=void 0}})}function h8(e,t){e&&e!==t?window.onbeforeunload=e=>{e.preventDefault(),e.returnValue=""}:window.onbeforeunload=null}let h9=(0,c.cn)("query-editor"),ge={triggerExpand:!1,triggerCollapse:!1,collapsed:!0};function gt({theme:e,changeUserInput:t,queriesHistory:a}){let s=(0,j.YQ)(),{database:i,path:l,type:o,subType:c,databaseFullPath:d}=tR(),u=(0,j.N4)(lt.yJ),p=(0,j.N4)(lt.wf),h=(0,j.N4)(y.Ab),{historyQueries:g,historyCurrentQueryId:x,saveQueryToHistory:f,updateQueryInHistory:b,goToPreviousQuery:T,goToNextQuery:w}=a,S=!!p,[E]=(0,j.XS)(),_=(0,I.Oi)(),[N,C]=po(),{resetBanner:P}=pd(),[A,D]=(0,j.iK)(sg.GS.LAST_USED_QUERY_ACTION),[R,k]=n.useState(""),[M]=(0,j.gz)(),[O]=(0,j.iK)(sg.GS.BINARY_DATA_IN_PLAIN_TEXT_DISPLAY),q=!O,L=(0,I.j2)()&&M&&E.queryMode===eK.ei.query,[z]=lt.JO.useUseSendQueryMutation(),[F]=lt.JO.useUseStreamQueryMutation(),Q=n.useMemo(()=>L?{displayIndices:{maxIndex:(E.limitRows||eK.jU.limitRows)+1}}:void 0,[L,E.limitRows]);n.useEffect(()=>{u!==i&&s((0,lt.Id)(i))},[s,i,u]);let[U,$]=n.useReducer(px(v.GV),ge);n.useEffect(()=>{$("triggerCollapse")},[]),n.useEffect(()=>{h||S?$("triggerExpand"):$("triggerCollapse")},[h,S]);let G=(0,j.A5)((e,t)=>{D(eK.x5.execute),k(e),(0,eU.isEqual)(N,E)||(P(),C(E));let a=(0,u6.A)();if(m_.abortQuery(),L){pm("runQuery",{actionType:"execute",isStreaming:!0,...E});let t=F({actionType:"execute",query:e,database:i,querySettings:E,enableTracingLevel:_,base64:q});m_.registerQuery(t)}else{pm("runQuery",{actionType:"execute",...E});let t=z({actionType:"execute",query:e,database:i,querySettings:E,enableTracingLevel:_,queryId:a,base64:q});t.then(({data:e})=>{e?.queryId&&b(e.queryId,e?.queryStats)}).catch(e=>{console.error("Failed to update query history:",e)}),m_.registerQuery(t)}if(s((0,y.o)(!1)),!t){let t=x?g.find(e=>e.queryId===x):null;e!==t?.queryText&&f(e,a),s((0,lt.Xb)(!1))}$("triggerExpand")}),H=(0,j.A5)(e=>{D(eK.x5.explain),k(e),(0,eU.isEqual)(N,E)||(P(),C(E));let t=(0,u6.A)();pm("runQuery",{actionType:"explain",...E});let a=z({actionType:"explain",query:e,database:i,querySettings:E,enableTracingLevel:_,queryId:t,base64:q});m_.registerQuery(a),s((0,y.o)(!1)),$("triggerExpand")});return(0,r.jsxs)("div",{className:h9(),children:[(0,r.jsxs)(m,{direction:"vertical",defaultSizePaneKey:v.l_,triggerCollapse:U.triggerCollapse,triggerExpand:U.triggerExpand,minSize:[0,52],collapsedSizes:[100,0],onSplitStartDragAdditional:()=>{$("clear")},children:[(0,r.jsxs)("div",{className:h9("pane-wrapper",{top:!0}),children:[(0,r.jsx)("div",{className:h9("monaco-wrapper"),children:(0,r.jsx)("div",{className:h9("monaco"),children:(0,r.jsx)(h7,{changeUserInput:t,theme:e,handleSendExecuteClick:G,handleGetExplainQueryClick:H,historyQueries:g,goToPreviousQuery:T,goToNextQuery:w})})}),(0,r.jsx)(mz,{handleSendExecuteClick:G,onSettingsButtonClick:()=>{s((0,uz.NJ)("settings"))},isLoading:!!p?.isLoading,handleGetExplainQueryClick:H,highlightedAction:A,database:i,queryId:p?.queryId,isStreamingEnabled:L})]}),(0,r.jsx)("div",{className:h9("pane-wrapper"),children:(0,r.jsx)(ga,{resultVisibilityState:U,onExpandResultHandler:()=>{$("triggerExpand")},onCollapseResultHandler:()=>{$("triggerCollapse")},type:o,subType:c,theme:e,result:p,database:i,databaseFullPath:d,path:l,showPreview:h,queryText:R,tableSettings:Q},p?.queryId)})]}),(0,r.jsx)(hY,{})]})}function ga({resultVisibilityState:e,onExpandResultHandler:t,onCollapseResultHandler:a,type:n,subType:s,theme:i,result:l,database:o,databaseFullPath:c,path:d,showPreview:u,queryText:p,tableSettings:m}){return u?(0,r.jsx)(pq,{database:o,path:d,type:n,subType:s,databaseFullPath:c}):l?(0,r.jsx)(hq,{result:l,resultType:l?.type,theme:i,database:o,isResultsCollapsed:e.collapsed,tableSettings:m,onExpandResults:t,onCollapseResults:a,queryText:p}):null}var gr=a(19122);let gn=[{id:E.tQ.newQuery,title:u3("tabs.newQuery")},{id:E.tQ.history,title:u3("tabs.history")},{id:E.tQ.saved,title:u3("tabs.saved")}],gs=({className:e,activeTab:t})=>{let a=(0,rL.zy)(),n=(0,B.mA)(a);return(0,r.jsx)("div",{className:e,children:(0,r.jsx)(_.f,{value:t,children:(0,r.jsx)(N.w,{size:"l",children:gn.map(({id:e,title:t})=>{let a=(0,B.YL)({...n,[aL.vh.queryTab]:e});return(0,r.jsx)(oF.o,{value:e,children:(0,r.jsx)(gr.E,{to:a,as:"tab",children:t})},e)})})})})};var gi=a(68910);let gl=(0,c.cn)("ydb-saved-queries"),go=({visible:e,queryName:t,onCancelClick:a,onConfirmClick:n})=>(0,r.jsxs)(t5.l,{open:e,hasCloseButton:!1,size:"s",onClose:a,onEnterKeyDown:n,children:[(0,r.jsx)(t5.l.Header,{caption:u3("delete-dialog.header")}),(0,r.jsxs)(t5.l.Body,{className:gl("dialog-body"),children:[u3("delete-dialog.question"),(0,r.jsx)("span",{className:gl("dialog-query-name"),children:` ${t}?`})]}),(0,r.jsx)(t5.l.Footer,{textButtonApply:u3("delete-dialog.delete"),textButtonCancel:u3("delete-dialog.cancel"),onClickButtonCancel:a,onClickButtonApply:n})]}),gc=({changeUserInput:e})=>{let{filteredSavedQueries:t,deleteSavedQuery:a}=uF(),s=(0,j.YQ)(),i=(0,j.N4)(uz.cu),[l,o]=n.useState(!1),[c,d]=n.useState(""),u=()=>{o(!1),d("")},p=u1(n.useCallback(({queryText:t,queryName:a})=>{e({input:t}),s((0,lt.Xb)(!1)),s((0,uz.JP)(a)),s((0,f.sH)(E.tQ.newQuery))},[e,s])),m=[{name:"name",header:"Name",render:({row:e})=>(0,r.jsx)("div",{className:gl("query-name"),children:e.name}),width:200},{name:"body",header:"Query Text",render:({row:e})=>{let t;return(0,r.jsxs)("div",{className:gl("query"),children:[(0,r.jsx)("div",{className:gl("query-body"),children:(0,r.jsx)(uD,{value:e.body,maxQueryHeight:6})}),(0,r.jsxs)("span",{className:gl("controls"),children:[(0,r.jsx)(tM.$,{view:"flat-secondary",children:(0,r.jsx)(ek.I,{data:tJ.A})}),(0,r.jsx)(tM.$,{view:"flat-secondary",onClick:(t=e.name,e=>{e.stopPropagation(),o(!0),d(t)}),children:(0,r.jsx)(ek.I,{data:gi.A})})]})]})},sortable:!1,resizeMinWidth:650}];return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)(eh.L,{className:gl(),children:[(0,r.jsx)(eh.L.Controls,{children:(0,r.jsx)(eg.v,{onChange:e=>{s((0,uz.ys)(e))},placeholder:u3("filter.text.placeholder"),className:gl("search")})}),(0,r.jsx)(eh.L.Table,{children:(0,r.jsx)(ep.l,{columnsWidthLSKey:"savedQueriesTableColumnsWidth",columns:m,data:t,settings:ls,emptyDataMessage:u3(i?"history.empty-search":"saved.empty"),rowClassName:()=>gl("row"),onRowClick:e=>p({queryText:e.body,queryName:e.name}),initialSortOrder:{columnId:"name",order:tg.Ay.ASCENDING}})})]}),(0,r.jsx)(go,{visible:l,queryName:c,onCancelClick:()=>{u()},onConfirmClick:()=>{u(),a(c),d("")}})]})},gd=(0,c.cn)("ydb-query"),gu=e=>{let t=(0,j.YQ)(),{queryTab:a=E.tQ.newQuery}=(0,j.N4)(e=>e.tenant),i=function(){let e=(0,j.YQ)(),t=(0,j.N4)(lt.jY),a=(0,j.N4)(lt.L9),[r,s]=(0,j.iK)(sg.GS.QUERIES_HISTORY),i=n.useMemo(()=>(r??[]).map(uI.QG),[r]),l=n.useMemo(()=>{let e=t?.toLowerCase();return e?i.filter(t=>t.queryText.toLowerCase().includes(e)):i},[i,t]),o=(0,j.A5)(()=>{let t;if(0===i.length)return;let r=i.findIndex(e=>e.queryId===a);(t=-1===r||0===r?i.at(-1):i[r-1])&&(e((0,lt.iZ)({input:t.queryText})),e((0,lt.zO)(t.queryId)))}),c=(0,j.A5)(()=>{let t;if(0===i.length)return;let r=i.findIndex(e=>e.queryId===a);(t=-1===r?i.at(-1):r===i.length-1?i[0]:i[r+1])&&(e((0,lt.iZ)({input:t.queryText})),e((0,lt.zO)(t.queryId)))}),d=(0,j.A5)((t,a)=>{if(!t)return;let r=i.length+1-20;s([...i.slice(r<0?0:r),{queryText:t,queryId:a}]),e((0,lt.zO)(a))}),u=(0,j.A5)((e,t)=>{if(!t||!i.length)return;let a=i.findIndex(t=>t.queryId===e);if(-1!==a){let e=[...i],{durationUs:r,endTime:n}=t;e[a]={...i[a],durationUs:r,endTime:n},s(e)}});return{historyQueries:i,historyCurrentQueryId:a,filteredHistoryQueries:l,goToPreviousQuery:o,goToNextQuery:c,saveQueryToHistory:d,updateQueryInHistory:u}}(),l=e=>{t((0,lt.iZ)(e))},o=n.useMemo(()=>gn.find(({id:e})=>e===a),[a]);return(0,r.jsxs)("div",{className:gd(),children:[o?(0,r.jsx)(s.mg,{children:(0,r.jsx)("title",{children:o.title})}):null,(0,r.jsx)(gs,{className:gd("tabs"),activeTab:a}),(0,r.jsx)("div",{className:gd("content"),children:(()=>{switch(a){case E.tQ.newQuery:return(0,r.jsx)(gt,{changeUserInput:l,queriesHistory:i,...e});case E.tQ.history:return(0,r.jsx)(u5,{changeUserInput:l,queriesHistory:i});case E.tQ.saved:return(0,r.jsx)(gc,{changeUserInput:l});default:return null}})()})]})},gp=(0,c.cn)("ydb-tenant-navigation"),gm=({id:e,title:t,icon:a})=>({value:e,content:(0,r.jsxs)("span",{className:gp("item"),children:[(0,r.jsx)(ek.I,{data:a,size:16,className:gp("icon")}),(0,r.jsx)("span",{className:gp("text"),children:t})]})}),gh=()=>{let e=function(){let e=(0,rL.zy)(),t=(0,B.mA)(e),a=(0,rL.W5)(B.Ay.tenant),{tenantPage:r,handleTenantPageChange:s}=sb();return n.useMemo(()=>a?sy.map(e=>{let a=E.Dg[e],n=(0,B.YL)({...t,[E.Dt]:a});return{id:a,title:e0(`pages.${e}`),icon:sf[e],path:n,current:r===a,onForward:()=>{s(a)}}}):[],[r,s,a,t])}();return(0,r.jsx)("div",{className:gp(),children:(0,r.jsx)(cM.x,{width:"auto",onUpdate:t=>{let a=e.find(e=>e.id===t);a?.onForward()},size:"l",className:gp("body"),value:(e.find(e=>e.current)||e[0]).id,options:e.map(gm)})})},gg=(0,c.cn)("object-general"),gx=function({additionalTenantProps:e}){let t=(0,S.i)(),{tenantPage:a}=sb();return(0,r.jsxs)("div",{className:gg(),children:[(0,r.jsx)(gh,{}),a===E.Dg.query?(0,r.jsx)(gu,{theme:t}):(0,r.jsx)(uP,{additionalTenantProps:e})]})};var gy=a(89578);let gf=(e,t,a)=>{let{setActivePath:r,setTenantPage:n}=a;return{openPreview:()=>{t(g.F.util.invalidateTags(["PreviewData"])),t((0,y.o)(!0)),n(E.Dg.query),t((0,f.sH)(E.tQ.newQuery)),r(e)}}},gb=(e,t)=>(0,r.jsx)(tM.$,{view:"flat-secondary",onClick:e.openPreview,title:e0("actions.openPreview"),size:t||"s",children:(0,r.jsx)(ek.I,{data:gy.A})});var gv=a(11589),gj=a(10844);let gT=g.F.injectEndpoints({endpoints:e=>({getShowCreateTable:e.query({queryFn:async({database:e,path:t},{signal:a})=>{try{let r,n=await window.api.viewer.sendQuery({query:(r=t.replace(/`/g,"``"),`${v.Zi}
SHOW CREATE TABLE \`${r}\``),database:e,action:"execute-query"},{signal:a,withRetries:!0});if((0,eK.We)(n))return{error:n};let s=(0,eK.fW)(n),i=s?.resultSets?.[0]?.result||[];return{data:i[0]?.CreateQuery}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"}),gw=5*v.KF,gS=g.F.injectEndpoints({endpoints:e=>({getTableSchemaData:e.query({queryFn:async({path:e,database:t,type:a,databaseFullPath:r},{dispatch:n})=>{try{if("EPathTypeView"===a){let a=await n(eZ.endpoints.getViewSchema.initiate({database:t,path:e,databaseFullPath:r,timeout:gw}));if((0,eK.We)(a))return{error:a};return{data:tP(a.data)}}let s=await n(x.endpoints.getOverview.initiate({path:e,database:t,timeout:gw,databaseFullPath:r}));return{data:tC(a,s.data)}}catch(e){return{error:e}}}})})});var gE=a(16400),g_=a(33269),gN=a(16509),gC=a(17965),gP=a.n(gC);let gI=({text:e,action:t,isLoading:a,iconStart:n})=>({text:(0,r.jsxs)(eD.s,{justifyContent:"space-between",alignItems:"center",children:[e,a&&(0,r.jsx)(mF.t,{size:"xs"})]}),action:t,disabled:a,iconStart:n}),gA=(0,c.cn)("ydb-schema-create-directory-dialog"),gD="relativePath";function gR({open:e,onClose:t,database:a,databaseFullPath:s,parentPath:i,onSuccess:l}){let[o,c]=n.useState(""),[d,u]=n.useState(""),[p,m]=y.sM.useCreateDirectoryMutation(),h=n.useRef(null),g=()=>{c(""),m.reset()},x=()=>{t(),u(""),g()},f=eJ(i,s);return(0,r.jsxs)(t5.l,{open:e,onClose:x,size:"s",initialFocus:h,children:[(0,r.jsx)(t5.l.Header,{caption:e0("schema.tree.dialog.header")}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=d?/\s/.test(d)?e0("schema.tree.dialog.whitespace"):"":e0("schema.tree.dialog.empty");c(t),t||p({database:a,databaseFullPath:s,path:`${i}/${d}`}).unwrap().then(()=>{x(),l(d)})},children:[(0,r.jsxs)(t5.l.Body,{children:[(0,r.jsxs)("label",{htmlFor:gD,className:gA("label"),children:[(0,r.jsx)("span",{className:gA("description"),children:e0("schema.tree.dialog.description")}),`${f}/`]}),(0,r.jsx)("div",{className:gA("input-wrapper"),children:(0,r.jsx)(t6.k,{controlRef:h,placeholder:e0("schema.tree.dialog.placeholder"),value:d,onUpdate:e=>{u(e),g()},autoFocus:!0,hasClear:!0,autoComplete:!1,disabled:m.isLoading,validationState:o?"invalid":void 0,id:gD,errorMessage:o})}),m.isError&&(0,r.jsx)(q.o,{error:m.error,defaultMessage:e0("schema.tree.dialog.invalid")})]}),(0,r.jsx)(t5.l.Footer,{loading:m.isLoading,textButtonApply:e0("schema.tree.dialog.buttonApply"),textButtonCancel:e0("schema.tree.dialog.buttonCancel"),onClickButtonCancel:x,propsButtonApply:{type:"submit"}})]})]})}let gk=n.createContext(void 0),gM=n.createContext(void 0);function gO({children:e}){let[t,a]=n.useState("");return(0,r.jsx)(gk.Provider,{value:t,children:(0,r.jsx)(gM.Provider,{value:a,children:e})})}function gq(){let e=n.useContext(gM);if(void 0===e)throw Error("useDispatchTreeKey must be used within a TreeKeyProvider");return e}function gL(e){let t,a,s=(0,I.Ii)(),{rootName:i,rootType:l,currentPath:o,onActivePathUpdate:c,databaseFullPath:d,database:u}=e,p=(0,j.YQ)(),m=(0,j.N4)(lt.Wp),h=(0,j.N4)(lt.TY),[g,{currentData:x,isFetching:b}]=gS.useLazyGetTableSchemaDataQuery(),[v,{currentData:T,isFetching:w}]=r9.useLazyGetStreamingQueryInfoQuery(),[S,{currentData:_,isFetching:N}]=gT.useLazyGetShowCreateTableQuery(),C=(0,I._p)(),{handleTenantPageChange:P}=sb(),[D,k]=n.useState(!1),[M,O]=n.useState(""),q=gq(),L=function(){let e=n.useContext(gk);if(void 0===e)throw Error("useTreeKey must be used within a TreeKeyProvider");return e}(),z=eY(d,l)?"database":e6(l),F=n.useCallback(async e=>{let t;for(;;){let a=p(y.sM.endpoints.getSchema.initiate({path:e,database:u,databaseFullPath:d},{forceRefetch:!0})),{data:r,originalArgs:n}=await a;if(a.unsubscribe(),n?.path===e){t=r?.[e];break}}if(!t)throw Error(`No describe data about path ${e}`);let{PathDescription:{Children:a=[]}={}}=t;return a.map(e=>{let{Name:t="",PathType:a,PathSubType:r,ChildrenExist:n}=e,s=((r&&tl[r]||a&&to[a])??!1)||(0,nu.f8)(n)&&!n;return{name:t,type:e6(a,r),expandable:!s,meta:{subType:r}}})},[p,u,d]);n.useEffect(()=>{o?.startsWith(d)||c(d)},[o,c,d]);let U=e=>{O(e),k(!0)},{monitoring:$}=(0,A.Zd)(),{controlPlane:G}=(0,f.Ry)(u),H=n.useMemo(()=>{let e=(0,R.P)(G,$);return((e,t,a="",n)=>(s,i)=>{let l=eJ(s,a),o=((e,t,a)=>{let{setActivePath:r,setTenantPage:n,showCreateDirectoryDialog:s,getConfirmation:i,getConnectToDBDialog:l,schemaData:o,streamingQueryData:c,showCreateTableData:d}=a,u=a=>()=>{let s=()=>{n(E.Dg.query),t((0,f.sH)(E.tQ.newQuery)),r(e.path),pH(a({...e,schemaData:o,streamingQueryData:c,showCreateTableData:d}))};i?i().then(e=>{e&&s()}):s()};return{createDirectory:s?()=>{s(e.path)}:void 0,getConnectToDBDialog:()=>l?.({database:e.database}),openMonitoring:()=>{n(E.Dg.diagnostics),t((0,f.WO)(E.iJ.monitoring)),r(e.path)},createTable:u(pW),createColumnTable:u(pV),createAsyncReplication:u(pJ),alterAsyncReplication:u(ma),dropAsyncReplication:u(me),createTransfer:u(pY),alterTransfer:u(mr),dropTransfer:u(mt),alterTable:u(pK),dropTable:u(mv),manageAutoPartitioning:u(pZ),manageReadReplicas:u(pX),selectQuery:u(p0),showCreateTable:u(p1),upsertQuery:u(p2),createExternalTable:u(p4),dropExternalTable:u(p3),selectQueryFromExternalTable:u(p0),createTopic:u(p5),alterTopic:u(p6),dropTopic:u(p7),createView:u(p8),dropView:u(p9),createStreamingQuery:u(mn),alterStreamingQuerySettings:u(ms),alterStreamingQueryText:u(mi),dropStreamingQuery:u(ml),dropIndex:u(md),addVectorIndex:u(mc),addTableIndex:u(mo),createCdcStream:u(mu),copyPath:()=>{try{gP()(e.relativePath),(0,eL.A)({name:"Copied",title:e0("actions.copied"),theme:"success"})}catch{(0,eL.A)({name:"Not copied",title:e0("actions.notCopied"),theme:"danger"})}}}})({path:s,relativePath:l,database:n,type:i,databaseFullPath:a},e,t),c={text:e0("actions.copyPath"),action:o.copyPath,iconStart:(0,r.jsx)(gE.A,{})},d={text:e0("actions.connectToDB"),action:o.getConnectToDBDialog,iconStart:(0,r.jsx)(g_.A,{})},u={text:e0("actions.openMonitoring"),action:o.openMonitoring,iconStart:(0,r.jsx)(nw.A,{})},p=[{text:e0("actions.createTable"),action:o.createTable},{text:e0("actions.createColumnTable"),action:o.createColumnTable},{text:e0("actions.createAsyncReplication"),action:o.createAsyncReplication},{text:e0("actions.createTransfer"),action:o.createTransfer},{text:e0("actions.createTopic"),action:o.createTopic},{text:e0("actions.createView"),action:o.createView},{text:e0("actions.createStreamingQuery"),action:o.createStreamingQuery}],m={text:e0("actions.manageColumns"),action:o.alterTable},h={text:e0("actions.manageAutoPartitioning"),action:o.manageAutoPartitioning},g={text:e0("actions.manageReadReplicas"),action:o.manageReadReplicas},x={text:e0("actions.alterTable"),items:[m,h,g]},y={text:e0("actions.alterTable"),items:[m,h]},b=[[c,d],p],v=[[c],p];if(t.hasMonitoring&&(b=[[c,d,u],p]),o.createDirectory){let e={text:e0("actions.createDirectory"),action:o.createDirectory,iconStart:(0,r.jsx)(gN.A,{})};b.splice(1,0,[e]),v.splice(1,0,[e])}let j=gI({text:e0("actions.showCreateTable"),action:o.showCreateTable,isLoading:t.isShowCreateTableLoading,iconStart:(0,r.jsx)(lh.A,{})}),T=[[c],[x,{text:e0("actions.dropTable"),action:o.dropTable},gI({text:e0("actions.selectQuery"),action:o.selectQuery,isLoading:t.isSchemaDataLoading}),gI({text:e0("actions.upsertQuery"),action:o.upsertQuery,isLoading:t.isSchemaDataLoading}),{text:e0("actions.addTableIndex"),action:o.addTableIndex},{text:e0("actions.addVectorIndex"),action:o.addVectorIndex},{text:e0("actions.createCdcStream"),action:o.createCdcStream}],[j]],w=[[c],[y,{text:e0("actions.dropTable"),action:o.dropTable},{text:e0("actions.selectQuery"),action:o.selectQuery},{text:e0("actions.upsertQuery"),action:o.upsertQuery}],[j]],S=[[c],[{text:e0("actions.alterTopic"),action:o.alterTopic},{text:e0("actions.dropTopic"),action:o.dropTopic}]],_=[[c],[{text:e0("actions.selectQuery"),action:o.selectQueryFromExternalTable}],[{text:e0("actions.dropTable"),action:o.dropExternalTable}]],N=[[c],[{text:e0("actions.createExternalTable"),action:o.createExternalTable}]],C=[[c],[{text:e0("actions.selectQuery"),action:o.selectQuery}],[{text:e0("actions.dropView"),action:o.dropView}]],P=[[c],[{text:e0("actions.selectQuery"),action:o.selectQuery}]],I=[[c],[{text:e0("actions.alterReplication"),action:o.alterAsyncReplication},{text:e0("actions.dropReplication"),action:o.dropAsyncReplication}]],A=[[c],[{text:e0("actions.alterTransfer"),action:o.alterTransfer},{text:e0("actions.dropTransfer"),action:o.dropTransfer}]],D=[[c,{text:e0("actions.dropIndex"),action:o.dropIndex}]],R=[[c],[{text:e0("actions.alterStreamingQuerySettings"),action:o.alterStreamingQuerySettings},gI({text:e0("actions.alterStreamingQueryText"),action:o.alterStreamingQueryText,isLoading:t.isStreamingQueryTextLoading}),{text:e0("actions.dropStreamingQuery"),action:o.dropStreamingQuery}]],k=[c];return({async_replication:I,transfer:A,database:b,directory:v,resource_pool:k,table:T,column_table:w,system_table:P,index_table:k,topic:S,stream:k,index:D,external_table:_,external_data_source:N,view:C,streaming_query:R})[i]})(p,{setActivePath:c,setTenantPage:P,showCreateDirectoryDialog:s?U:void 0,getConfirmation:m&&h?u0:void 0,getConnectToDBDialog:gj.S,schemaData:x,isSchemaDataLoading:b,hasMonitoring:e,streamingQueryData:T,showCreateTableData:(0,Q.vN)(_),isShowCreateTableLoading:N,isStreamingQueryTextLoading:w},d,u)},[x,s,p,m,b,h,w,c,T,u,d,G,$,_,N,P]);return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(gR,{onClose:()=>{k(!1)},open:D,database:u,databaseFullPath:d,parentPath:M,onSuccess:e=>{let t=`${M}/${e}`;c(t),q(t)}}),(0,r.jsx)(gv.F,{rootState:{path:d,name:i,type:z,collapsed:!1},fetchPath:F,getActions:H,onActionsOpenToggle:({path:e,type:t,isOpen:a})=>{let r=e3[t];a&&r&&g({path:e,database:u,type:r,databaseFullPath:d});let n=e4[t];a&&n&&S({path:eJ(e,d),database:u});let s=e5[t];return a&&s&&v({database:u,path:e},!0),[]},renderAdditionalNodeElements:(t={setActivePath:c,setTenantPage:P},a=void 0,(e,r,n)=>{let s=gb(gf(e,p,t),a),i=n?.subType==="EPathSubTypeStreamImpl";return({async_replication:void 0,transfer:void 0,database:void 0,directory:void 0,resource_pool:void 0,table:s,column_table:s,system_table:s,index_table:s,topic:C&&!i?s:void 0,stream:void 0,index:void 0,external_table:s,external_data_source:void 0,view:s,streaming_query:void 0})[r]}),activePath:o,onActivePathUpdate:c,cache:!1,virtualize:!0},L)]})}var gz=JSON.parse('{"title_navigation":"Navigation","field_source-type":"Source Type","field_data-source":"Data Source","action_copySchemaPath":"Copy schema path","action_openInDiagnostics":"Open in Diagnostics","field_type":"Type","field_subtype":"SubType","field_id":"Id","field_version":"Version","field_created":"Created","field_data-size":"Data size","field_row-count":"Row count","field_partitions":"Partitions count","field_system-view-type":"System view type","field_paths":"Paths","field_shards":"Shards","field_state":"State","field_mode":"Mode","field_format":"Format","field_retention":"Retention"}');let gF=(0,ex.g4)("ydb-object-summary",{en:gz}),gQ=(0,c.cn)("ydb-object-summary");function gU({database:e,path:t,databaseFullPath:a}){var n;let{data:s={},isLoading:i}=(0,y.Tn)({path:a,databaseFullPath:a,database:e}),l=s?.PathDescription?.Self,{handleSchemaChange:o}=tW();return!l&&i?(0,r.jsx)("div",{children:(0,r.jsx)(L.a,{})}):(0,r.jsxs)("div",{className:gQ("tree-wrapper"),children:[(0,r.jsx)("div",{className:gQ("tree-header"),children:gF("title_navigation")}),(0,r.jsx)("div",{className:gQ("tree"),children:l?(0,r.jsx)(gL,{database:e,databaseFullPath:a,rootName:(n=l.Name,n?n.startsWith("/")?n:`/${n}`:a.startsWith("/")?a:`/${a}`),rootType:l.PathType,currentPath:t,onActivePathUpdate:o}):null})]})}var g$=a(94555);function gG(){let e=(0,j.YQ)(),{diagnosticsTab:t}=(0,j.N4)(e=>e.tenant),{tenantPage:a,handleTenantPageChange:n}=sb(),s=a===E.Dg.diagnostics&&t===E.iJ.schema;return(0,r.jsx)("div",{children:!s&&(0,r.jsx)(tM.$,{title:gF("action_openInDiagnostics"),onClick:()=>{n(E.Dg.diagnostics),e((0,f.WO)(E.iJ.schema))},size:"s",children:(0,r.jsx)(ek.I,{data:g$.A,size:14})})})}var gH=a(32065),gB=a(992);function gW(){let e=gq(),t=(0,j.YQ)();return(0,r.jsx)(eR.m,{title:"Refresh",children:(0,r.jsx)(tM.$,{className:gQ("refresh-button"),view:"flat-secondary",onClick:()=>{e((0,gB.Ak)()),t(g.F.util.invalidateTags(["SchemaTree"]))},children:(0,r.jsx)(ek.I,{data:gH.A})})})}let gV=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:!!localStorage.getItem(v.hh)});function gJ({onCollapseSummary:e,onExpandSummary:t,isCollapsed:a}){let s,i,l,{path:o,database:c,type:d,databaseFullPath:u}=tR(),p=(0,j.YQ)(),{handleSchemaChange:h}=tW(),[g,y]=n.useReducer(px(v.hh),void 0,gV),{summaryTab:b=E.ml.overview}=(0,j.N4)(e=>e.tenant),{handleTenantPageChange:T}=sb(),w=(0,rL.zy)(),S=aM().parse(w.search,{ignoreQueryPrefix:!0}),{currentData:C}=x.useGetOverviewQuery({path:o,database:c,databaseFullPath:u}),P=C?.PathDescription?.Self;n.useEffect(()=>{let e=ta(d);!d||e||aL.x$.find(e=>e.id===b)||p((0,f.Mj)(E.ml.overview))},[p,d,b]);let I=eJ(o,u);return(0,r.jsx)(gO,{children:(0,r.jsxs)("div",{className:gQ(),children:[(0,r.jsx)("div",{className:gQ({hidden:a}),children:(0,r.jsxs)(m,{direction:"vertical",defaultSizePaneKey:v.ED,onSplitStartDragAdditional:()=>{y("clear")},triggerCollapse:g.triggerCollapse,triggerExpand:g.triggerExpand,minSize:[200,52],collapsedSizes:[100,0],children:[(0,r.jsx)(gU,{database:c,path:o,databaseFullPath:u}),(0,r.jsxs)("div",{className:gQ("info"),children:[(0,r.jsxs)("div",{className:gQ("sticky-top"),children:[(0,r.jsxs)("div",{className:gQ("info-header"),children:[(0,r.jsxs)("div",{className:gQ("info-title"),children:[(()=>{let e,{Status:t,Reason:a}=C??{};if(d){let e=d.replace("EPathType","");return eY(o,d)&&(e="domain"),(0,r.jsx)("div",{className:gQ("entity-type"),children:e})}return t&&a&&(e=`${t}: ${a}`),(0,r.jsx)("div",{className:gQ("entity-type",{error:!0}),children:(0,r.jsx)(az.H,{content:e})})})(),(0,r.jsx)("div",{className:gQ("path-name"),children:I})]}),(0,r.jsx)("div",{className:gQ("info-controls"),children:(s=ta(d),(0,r.jsxs)(n.Fragment,{children:[s&&(i={setActivePath:h,setTenantPage:T},(e,t)=>({preview:gb(gf(e,p,i),"m")})[t])(o,"preview"),(0,r.jsx)(dK.b,{text:I,view:"flat-secondary",title:gF("action_copySchemaPath")}),(0,r.jsx)(pf,{onCollapse:()=>{y("triggerCollapse")},onExpand:()=>{y("triggerExpand")},isCollapsed:g.collapsed,initialDirection:"bottom"})]}))})]}),(l=ta(d)?[...aL.x$,...aL.nb]:aL.x$,(0,r.jsx)("div",{className:gQ("tabs"),children:(0,r.jsxs)(eD.s,{className:gQ("tabs-inner"),justifyContent:"space-between",alignItems:"center",children:[(0,r.jsx)(_.f,{value:b,children:(0,r.jsx)(N.w,{size:"l",children:l.map(({id:e,title:t})=>{let a=(0,B.YL)({...S,[aL.vh.summaryTab]:e});return(0,r.jsx)(oF.o,{value:e,children:(0,r.jsx)(aO.E,{to:a,as:"tab",children:t})},e)})})}),b===E.ml.schema&&(0,r.jsx)(gG,{})]})}))]}),(0,r.jsx)("div",{className:gQ("overview-wrapper"),children:b===E.ml.schema?(0,r.jsx)(tI,{type:d,path:o,database:c,databaseFullPath:u}):(()=>{if(!P)return;let{CreateStep:e,PathType:t,PathSubType:a,PathId:s,PathVersion:i}=P,l=[],c=eY(o,t)?"Domain":t?.replace(/^EPathType/,"");l.push({name:gF("field_type"),content:c}),"EPathSubTypeEmpty"!==a&&l.push({name:gF("field_subtype"),content:a?.replace(/^EPathSubType/,"")}),l.push({name:gF("field_id"),content:s}),l.push({name:gF("field_version"),content:i}),Number(e)&&l.push({name:gF("field_created"),content:(0,Q.r6)(e)});let{PathDescription:d}=C;if(d?.TableStats){let{DataSize:e,RowCount:t}=d.TableStats;l.push({name:gF("field_data-size"),content:rx(e)},{name:gF("field_row-count"),content:(0,Q.ZV)(t)})}let u=()=>{let{PathsInside:e,ShardsInside:t,PathsLimit:a,ShardsLimit:r}=d?.DomainDescription??{},n=(0,Q.ZV)(e),s=(0,Q.ZV)(t);return n&&a&&(n=`${n} / ${(0,Q.ZV)(a)}`),s&&r&&(s=`${s} / ${(0,Q.ZV)(r)}`),[{name:gF("field_paths"),content:n},{name:gF("field_shards"),content:s}]},p=t&&({EPathTypeInvalid:void 0,EPathTypeDir:void 0,EPathTypeResourcePool:void 0,EPathTypeTable:()=>[{name:gF("field_partitions"),content:d?.TablePartitions?.length}],EPathTypeSysView:()=>[{name:gF("field_system-view-type"),content:r$(d?.SysViewDescription?.Type)}],EPathTypeSubDomain:u,EPathTypeTableIndex:void 0,EPathTypeExtSubDomain:u,EPathTypeColumnStore:()=>[{name:gF("field_partitions"),content:d?.ColumnStoreDescription?.ColumnShards?.length}],EPathTypeColumnTable:()=>[{name:gF("field_partitions"),content:d?.ColumnTableDescription?.Sharding?.ColumnShards?.length}],EPathTypeCdcStream:()=>{let{Mode:e,Format:t}=d?.CdcStreamDescription||{};return[{name:gF("field_mode"),content:e?.replace(/^ECdcStreamMode/,"")},{name:gF("field_format"),content:t?.replace(/^ECdcStreamFormat/,"")}]},EPathTypePersQueueGroup:()=>{let e=d?.PersQueueGroup,t=e?.PQTabletConfig?.PartitionConfig?.LifetimeSeconds;return[{name:gF("field_partitions"),content:e?.Partitions?.length},{name:gF("field_retention"),content:t&&(0,Q.Pt)(t)}]},EPathTypeExternalTable:()=>{let e=(0,B.Ow)({...S,schema:d?.ExternalTableDescription?.DataSourcePath}),{SourceType:t,DataSourcePath:a}=d?.ExternalTableDescription||{},n=a?.match(/([^/]*)\/*$/)?.[1]||"";return[{name:gF("field_source-type"),content:t},{name:gF("field_data-source"),content:a&&(0,r.jsx)("span",{title:a,children:(0,r.jsx)(rz.K,{title:n||"",url:e})})}]},EPathTypeExternalDataSource:()=>[{name:gF("field_source-type"),content:d?.ExternalDataSourceDescription?.SourceType}],EPathTypeView:void 0,EPathTypeReplication:()=>{let e=d?.ReplicationDescription?.State;return e?[{name:gF("field_state"),content:(0,r.jsx)(rW,{state:e})}]:[]},EPathTypeTransfer:()=>{let e=d?.ReplicationDescription?.State;return e?[{name:gF("field_state"),content:(0,r.jsx)(rW,{state:e})}]:[]},EPathTypeStreamingQuery:void 0})[t]?.()||[];l.push(...p);let m=l.filter(e=>e.content).map(e=>({...e,content:(0,r.jsx)("div",{className:gQ("overview-item-content"),children:e.content})}));return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)("div",{className:gQ("overview-title"),children:(0,r.jsx)(ni,{data:d})}),(0,r.jsx)(og.u,{responsive:!0,children:m.map(e=>(0,r.jsx)(og.u.Item,{name:e.name,children:e.content},e.name))})]})})()})]})]})}),(0,r.jsxs)(eD.s,{className:gQ("actions"),gap:.5,children:[!a&&(0,r.jsx)(gW,{}),(0,r.jsx)(pf,{onCollapse:e,onExpand:t,isCollapsed:a,initialDirection:"left"})]})]})})}var gY=a(11169),gK=a(52198),gZ=a(21852),gX=JSON.parse('{"title_degraded":"Degraded","title_emergency":"Emergency","title_maintenance":"Maintenance required","title_good":"Good","title_unspecified":"Unspecified"}');let g0=(0,ex.g4)("ydb-healthcheck-status",{en:gX}),g1={GOOD:"success",DEGRADED:"info",MAINTENANCE_REQUIRED:"warning",EMERGENCY:"danger",UNSPECIFIED:"normal"},g2={GOOD:gY.A,DEGRADED:gK.A,MAINTENANCE_REQUIRED:d6.A,EMERGENCY:gZ.A,UNSPECIFIED:g_.A},g3={get GOOD(){return g0("title_good")},get DEGRADED(){return g0("title_degraded")},get MAINTENANCE_REQUIRED(){return g0("title_maintenance")},get EMERGENCY(){return g0("title_emergency")},get UNSPECIFIED(){return g0("title_unspecified")}};function g4({status:e,size:t="m"}){let a=g1[e];return(0,r.jsx)(tc.J,{theme:a,icon:(0,r.jsx)(ek.I,{size:14,data:g2[e]}),size:t,children:g3[e]})}var g5=a(63054);function g6(){let{issuesFilter:e,handleIssuesFilterChange:t}=tW();return(0,r.jsx)(eg.v,{value:e??"",onChange:t,placeholder:(0,g5.A)("description_search-issue"),width:"250px"})}var g7=a(78636),g8=a(51655),g9=a(60117),xe=a(30692);function xt({title:e,children:t,titleVariant:a="body-2",gap:n=3}){return(0,r.jsxs)(eD.s,{direction:"column",gap:n,children:[e&&(0,r.jsx)(eA.E,{variant:a,children:e}),t]})}function xa({title:e,fields:t,titleVariant:a}){let n=t.filter(e=>e.value);return 0===n.length?null:(0,r.jsx)(xt,{title:e,titleVariant:a,children:(0,r.jsx)(og.u,{nameMaxWidth:200,children:n.map(e=>(0,r.jsx)(og.u.Item,{name:e.title,copyText:e.copy,children:e.value},e.title))})})}function xr({ids:e,renderItem:t}){return(0,r.jsx)(eD.s,{direction:"column",gap:1,children:e.map(e=>(0,r.jsx)("div",{children:t?t(e):e},e))})}function xn({node:e,title:t}){let{database:a}=tW();if(!e)return null;let n=e.id?(0,r.jsx)(aO.E,{to:(0,B.vI)({id:e.id},{database:a}),children:e.id}):void 0;return(0,r.jsx)(xa,{title:t,fields:[{value:n,title:(0,g5.A)("label_node-id")},{value:e.host,title:(0,g5.A)("label_node-host"),copy:e.host},{value:e.port,title:(0,g5.A)("label_node-port")}]})}function xs({location:e}){let{pool:t}=e??{},{name:a}=t??{};return a?(0,r.jsx)(xa,{fields:[{value:a,title:(0,g5.A)("label_pool-name")}]}):null}let xi={node:e=>(0,r.jsx)(xn,{node:e?.node},"node"),pool:e=>(0,r.jsx)(xs,{location:e},"pool"),tablet:e=>(0,r.jsx)(xo,{location:e},"tablet"),schema:e=>(0,r.jsx)(xc,{location:e},"schema")};function xl({location:e,hiddenFields:t=[]}){let{node:a,tablet:s,schema:i,pool:l}=e??{},o=n.useMemo(()=>{let e=[];return a&&e.push("node"),l&&e.push("pool"),s&&e.push("tablet"),i&&e.push("schema"),e.filter(e=>!t.includes(e))},[a,l,s,i,t]);return!e||(0,eU.isEmpty)(e)||0===o.length?null:(0,r.jsx)(xt,{title:(0,g5.A)("label_compute_location"),titleVariant:"subheader-2",children:(0,r.jsx)(eD.s,{direction:"column",gap:3,children:o.map(t=>xi[t](e))})})}function xo({location:e}){let t=(0,B.Cs)(),{tablet:a}=e??{};return a?(0,r.jsx)(xa,{fields:[{value:a.id?.length?(0,r.jsx)(xr,{ids:a.id,renderItem:e=>(0,r.jsx)(aO.E,{to:t(e),children:e})}):void 0,title:(0,g5.A)("label_tablet-id")},{value:a.type,title:(0,g5.A)("label_tablet-type")},{value:a.count,title:(0,g5.A)("label_tablet-count")}]}):null}function xc({location:e}){let{schema:t}=e??{};return t?(0,r.jsx)(xa,{fields:[{value:t.type,title:(0,g5.A)("label_schema-type")},{value:t.path,title:(0,g5.A)("label_schema-path")}]}):null}let xd={node:e=>(0,r.jsx)(xn,{node:e?.node},"node"),pool:e=>(0,r.jsx)(xs,{location:e},"pool"),group:e=>(0,r.jsx)(xp,{location:e},"group"),vdisk:e=>(0,r.jsx)(xm,{location:e},"vdisk"),pdisk:e=>(0,r.jsx)(xh,{location:e},"pdisk")};function xu({location:e,hiddenFields:t=[]}){let{node:a,pool:s}=e??{},{group:i}=s??{},{vdisk:l}=i??{},{pdisk:o}=l??{},c=n.useMemo(()=>{let e=[];return a&&e.push("node"),s&&e.push("pool"),i&&e.push("group"),l&&e.push("vdisk"),o&&e.push("pdisk"),e.filter(e=>!t.includes(e))},[a,s,i,l,o,t]);return!e||(0,eU.isEmpty)(e)||0===c.length?null:(0,r.jsx)(xt,{title:(0,g5.A)("label_storage_location"),titleVariant:"subheader-2",children:(0,r.jsx)(eD.s,{direction:"column",gap:3,children:c.map(t=>xd[t](e))})})}function xp({location:e}){let{pool:t}=e??{},{group:a}=t??{},n=a?.id;return n?.length?(0,r.jsx)(xa,{fields:[{value:n?.length?(0,r.jsx)(xr,{ids:n}):void 0,title:(0,g5.A)("label_group-id")}]}):null}function xm({location:e}){let t=(0,B.Z$)(),{node:a,pool:n}=e??{},{group:s}=n??{},{vdisk:i}=s??{},l=i?.id;return l?.length?(0,r.jsx)(xa,{fields:[{value:l?.length?(0,r.jsx)(xr,{ids:l,renderItem:e=>(0,r.jsx)(aO.E,{to:t({vDiskId:e,nodeId:a?.id}),children:e})}):void 0,title:(0,g5.A)("label_vdisk-id")}]}):null}function xh({location:e}){let{pool:t}=e??{},{group:a}=t??{},{vdisk:n}=a??{},{pdisk:s}=n??{};return s?.length?s.map(e=>{let t,a;if(e.id){let r=e.id.split("-");t=r[0],a=r.slice(1).join("-")}return(0,r.jsx)(xa,{fields:[{value:t&&a?(0,r.jsx)(aO.E,{to:(0,B.Ck)(a,t),children:e.id}):e.id,title:(0,g5.A)("label_pdisk-id")},{value:e.path,title:(0,g5.A)("label_pdisk-path")}]},e.id||e.path)}):null}function xg({location:e,hiddenStorageFields:t,hiddenComputeFields:a}){return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(xu,{location:e?.storage,hiddenFields:t}),(0,r.jsx)(xl,{location:e?.compute,hiddenFields:a}),(0,r.jsx)(xx,{location:e?.node}),(0,r.jsx)(xy,{location:e?.peer})]})}function xx({location:e}){return!e||(0,eU.isEmpty)(e)?null:(0,r.jsx)(xt,{title:(0,g5.A)("label_node_location"),children:(0,r.jsx)(xn,{node:e})})}function xy({location:e}){return!e||(0,eU.isEmpty)(e)?null:(0,r.jsx)(xt,{title:(0,g5.A)("label_peer_location"),children:(0,r.jsx)(xn,{node:e})})}function xf({issue:e}){let t=(0,B.Cs)(),{detailsFields:a,hiddenStorageFields:s,hiddenComputeFields:i}=n.useMemo(()=>{let a=[],n=[],s=[{value:e.message,title:(0,g5.A)("label_description")}];if("STORAGE_POOL"===e.type&&(s.push({value:e.location?.storage?.pool?.name,title:(0,g5.A)("label_pool-name")}),a.push("pool")),"COMPUTE_POOL"===e.type&&(s.push({value:e.location?.compute?.pool?.name,title:(0,g5.A)("label_pool-name")}),n.push("pool")),"TABLET"===e.type){let a=e.location?.compute?.tablet;s.push({value:a?.id?.length?(0,r.jsx)(xr,{ids:a.id,renderItem:e=>(0,r.jsx)(aO.E,{to:t(e),children:e})}):void 0,title:(0,g5.A)("label_tablet-id")},{value:a?.type,title:(0,g5.A)("label_tablet-type")},{value:a?.count,title:(0,g5.A)("label_tablet-count")}),n.push("tablet")}return{detailsFields:s,hiddenComputeFields:n,hiddenStorageFields:a}},[e,t]),{location:l}=e;return(0,r.jsxs)(eD.s,{direction:"column",gap:4,children:[(0,r.jsx)(xa,{title:(0,g5.A)("label_details"),fields:a,titleVariant:"subheader-2"}),(0,r.jsx)(xg,{location:l,hiddenStorageFields:s,hiddenComputeFields:i})]})}function xb({parents:e,selectedTab:t,setSelectedTab:a}){return e.length<=1?null:(0,r.jsx)(eD.s,{gap:2,wrap:"nowrap",children:e.map((n,s)=>{let i;return(0,r.jsxs)(eD.s,{gap:2,wrap:"nowrap",children:[(0,r.jsx)(xv,{active:n.id===t,onClick:()=>a(n.id),children:(0,r.jsxs)(eD.s,{gap:2,wrap:"nowrap",alignItems:"center",children:[n.status&&(0,r.jsx)(xj,{status:n.status}),n.type&&((i=n.type.split("_").join(" ")).charAt(0).toUpperCase()+i.slice(1).toLowerCase()).replace(/\bvdisk\b/gi,"VDisk").replace(/\bpdisk\b/gi,"PDisk")]})}),s!==e.length-1&&(0,r.jsx)(eA.E,{color:"secondary",children:"/"})]},n.id)})})}function xv({children:e,active:t,onClick:a}){return(0,r.jsx)(eA.E,{variant:"body-2",color:t?"primary":"secondary",className:(0,xe.b)("issue-tab",{active:t}),onClick:a,children:e})}function xj({status:e}){return(0,r.jsx)("div",{className:(0,xe.b)("tab-status",{[e.toLowerCase()]:!0})})}function xT({issue:e,expanded:t}){let[a,s]=n.useState(e.id),i=n.useMemo(()=>{let t=[],a=e;for(;a;)t.push(a),a=a.parent;return t.reverse()},[e]),l=n.useMemo(()=>i.find(e=>e.id===a),[i,a]);return(0,r.jsx)(eD.s,{className:(0,xe.b)("issue-wrapper"),children:(0,r.jsxs)(g8.E,{className:(0,xe.b)("issue-content"),defaultExpanded:t,children:[(0,r.jsx)(g8.E.Summary,{children:t=>(0,r.jsx)("button",{...t,className:(0,xe.b)("disclosure-trigger"),children:(0,r.jsxs)(eD.s,{wrap:"nowrap",gap:2,justifyContent:"space-between",className:(0,xe.b)("issue-summary"),children:[(0,r.jsxs)(eD.s,{direction:"column",gap:1,alignSelf:"center",children:[(0,r.jsx)(eA.E,{variant:"subheader-2",children:e.message}),e.status&&(0,r.jsx)("div",{className:(0,xe.b)("issue-status"),children:(0,r.jsx)(g9.c.Label,{size:"s",status:sT[e.status]})})]}),(0,r.jsxs)(eD.s,{wrap:"nowrap",gap:2,alignItems:"center",height:"max-content",children:[(0,r.jsx)(tK.c,{className:(0,xe.b)("issue-divider"),orientation:"vertical"}),(0,r.jsx)(nM.I,{direction:t.expanded?"top":"bottom"})]})]})})}),(0,r.jsx)("div",{className:(0,xe.b)("animation-container"),children:(0,r.jsxs)(eD.s,{className:(0,xe.b)("issue-details"),direction:"column",gap:3,grow:1,children:[(0,r.jsx)(xb,{parents:i,selectedTab:a,setSelectedTab:s}),l&&(0,r.jsx)(xf,{issue:l})]})})]})})}function xw({issues:e}){let{view:t,issuesFilter:a}=tW(),s=n.useMemo(()=>{let t=a?.toLowerCase().trim();return t?e.filter(e=>{let a=Object.values(e);for(;a.length;){let e=a.pop();if("object"==typeof e)a.push(...Object.values(e));else if(String(e).toLowerCase().includes(t))return!0}return!1}):e},[e,a]),i=n.useMemo(()=>t?s.filter(e=>{let a=e.firstParentType||e.type;return a?.toLowerCase().startsWith(t)}):[],[s,t]);return 0===i.length?(0,r.jsx)(eD.s,{grow:1,justifyContent:"center",alignItems:"center",children:(0,r.jsx)(g7.pp,{image:(0,r.jsx)(di.oN,{width:100,height:100}),position:"center",size:"xs",title:(0,g5.A)("label_no-issues"),description:(0,g5.A)("description_no-issues")})}):i.map(e=>(0,r.jsx)(xT,{issue:e,expanded:!!a},e.id+!!a))}function xS(e=0){return Date.now()-e}function xE({lastFullfiled:e,refresh:t}){let[a,s]=n.useState(xS(e));return n.useEffect(()=>{s(xS(e));let t=setInterval(()=>{s(xS(e))},60*v.KF);return()=>clearInterval(t)},[e]),(0,r.jsxs)(eD.s,{gap:2,alignItems:"center",children:[(()=>{if((0,eU.isNil)(e))return null;let t=a>v.Jg*v.KF,n=a>v.tt*v.KF,s=(0,cH.duration)(a),i="";if(n){let e=s.asDays();i=(0,g5.A)("description_days",{count:Math.round(e)})}else if(t){let e=s.asHours();i=(0,g5.A)("description_hours",{count:Math.round(e)})}else{let e=s.asMinutes();i=(0,g5.A)("description_minutes",{count:Math.round(e)})}return(0,r.jsx)(eA.E,{color:"secondary",children:i})})(),(0,r.jsx)(eR.m,{title:(0,g5.A)("action_refresh"),children:(0,r.jsx)(tM.$,{view:"outlined",onClick:()=>{t()},children:(0,r.jsx)(tM.$.Icon,{children:(0,r.jsx)(gH.A,{})})})})]})}let x_="storage",xN="compute";function xC({issuesCount:e,viewTitles:t=b.J.healthcheck.getHealthckechViewTitles(),sortOrder:a=b.J.healthcheck.getHealthcheckViewsOrder()}){let{view:s,handleHealthcheckViewChange:i,handleIssuesFilterChange:l}=tW(),o=n.useMemo(()=>Object.keys(e),[e]);return n.useEffect(()=>{s||(e[x_]?i(x_):e[xN]?i(xN):i(a.find(t=>e[t]>0)))},[s,i,e,o,a]),(0,r.jsx)(cM.x,{value:s,onUpdate:e=>{i(e),l("")},className:(0,xe.b)("control-wrapper"),children:a.map(a=>(0,r.jsxs)(cM.x.Option,{value:a,children:[t[a]??a,"\xa0",(0,r.jsx)(eA.E,{color:"secondary",children:e[a]??0})]},a))})}function xP({database:e,countIssueTypes:t=b.J.healthcheck.countHealthcheckIssuesByType}){let a=(0,j.N4)(e=>e.fullscreen),{loading:s,error:i,selfCheckResult:l,fulfilledTimeStamp:o,leavesIssues:c,refetch:d}=((e,{autorefresh:t}={})=>{let{databaseType:a}=(0,f.Ry)(e),{currentData:r,isFetching:n,error:s,refetch:i,fulfilledTimeStamp:l}=sw.useGetHealthcheckInfoQuery({database:e},{pollingInterval:t,skip:"Serverless"===a}),o=r?.self_check_result||"UNSPECIFIED";return{loading:void 0===r&&n,error:s,refetch:i,selfCheckResult:o,fulfilledTimeStamp:l,leavesIssues:(0,j.N4)(t=>sI(t,e))}})(e),u=n.useMemo(()=>t(c),[c,t]);return(0,r.jsx)(df,{children:(0,r.jsx)(eD.s,{className:(0,xe.b)(),grow:1,children:i?(0,r.jsxs)(eD.s,{direction:"column",gap:1,className:(0,xe.b)("stub-wrapper"),children:[(0,r.jsx)(q.o,{error:i,defaultMessage:(0,g5.A)("description_no-data")}),(0,r.jsx)(ek.I,{data:lu,size:100})]}):s?(0,r.jsx)(L.a,{size:"m"}):"GOOD"!==l||c&&c.length?(0,r.jsxs)(eD.s,{direction:"column",grow:1,children:[(0,r.jsxs)(eD.s,{direction:"column",gap:3,className:(0,xe.b)("controls",{fullscreen:a}),children:[(0,r.jsxs)(eD.s,{justifyContent:"space-between",gap:2,children:[(0,r.jsx)(g4,{status:l}),(0,r.jsx)(xE,{lastFullfiled:o,refresh:d})]}),(0,r.jsx)(xC,{issuesCount:u}),(0,r.jsx)(g6,{})]}),(0,r.jsx)(eD.s,{direction:"column",gap:4,grow:1,className:(0,xe.b)("issues"),children:(0,r.jsx)(xw,{issues:c})})]}):(0,r.jsxs)(eD.s,{direction:"column",gap:1,className:(0,xe.b)("stub-wrapper"),children:[(0,r.jsx)(o0.v,{name:"thumbsUp",width:200}),sq[l]]})})})}function xI({children:e}){let{database:t}=tR(),{handleShowHealthcheckChange:a,showHealthcheck:s,handleIssuesFilterChange:i,handleHealthcheckViewChange:l}=tW(),o=(0,j.N4)(e=>sN(e,t||"")),c=(0,j.N4)(e=>sA(e,t||"")),d=n.useCallback(()=>{a(!1),i(void 0),l(void 0)},[a,i,l]),u=n.useCallback(()=>(0,r.jsx)(xP,{database:t}),[t]);return(0,r.jsx)(le,{isDrawerVisible:!!s,onCloseDrawer:d,renderDrawerContent:u,drawerId:"tenant-healthcheck-details",storageKey:"tenant-healthcheck-details-drawer-width",detectClickOutside:!0,hideVeil:!1,isPercentageWidth:!0,drawerControls:[{type:"custom",key:"download",node:(0,r.jsx)(eR.m,{title:e0("label_download"),children:(0,r.jsx)(tM.$,{view:"flat",onClick:e=>{e.stopPropagation(),d1(c,`${t}-healthcheck-${new Date().getTime()}`)},children:(0,r.jsx)(ek.I,{data:dY.A})})})},{type:"custom",node:(0,r.jsx)(dm,{view:"flat"}),key:"fullscreen"},{type:"close"}],title:(0,r.jsx)(xA,{status:o}),children:e})}function xA({status:e}){return(0,r.jsxs)(eD.s,{direction:"column",children:[(0,r.jsx)(eA.E,{variant:"subheader-2",children:e0("label_healthcheck-dashboard")}),(0,r.jsx)(eA.E,{color:"secondary",children:e&&sq[e]})]})}var xD=JSON.parse('{"description_select-row":"Retrieve data rows from tables using SELECT queries.","description_update-row":"Modify existing data rows with UPDATE operations.","description_erase-row":"Modify existing data rows with UPDATE operations.","description_write-attributes":"Modify object metadata and manage access permissions.","description_create-directory":"Create new subdirectories in the database namespace.","description_create-table":"Define new tables with specified schemas.","description_create-queue":"Set up new message queue instances.","description_remove-schema":"Delete database objects (tables, directories, queues).","description_alter-schema":"Modify object definitions (add/remove columns, change types).","description_create-database":"Initialize new database instances.","description_drop-database":"Permanently delete databases and all contained objects.","description_read-attributes":"View object metadata and access control lists.","description_describe-schema":"Inspect object structure and properties.","description_connect-database":"Establish connections and submit requests to the database.","description_grant-access-rights":"Delegate permissions to other users (within own privilege scope).","description_generic-read":"Read data and metadata. Basic viewing permissions for tables/objects.","description_generic-write":"Modify data and schemas. Write/delete data + alter structure.","description_generic-manage":"Create/drop databases. Infrastructure-level change.","description_generic-list":"View object metadata and schemas. For inspecting structure without data access.","description_generic-use":"Complete data operations. Modern full access excluding DB management.","description_generic-use-legacy":"[Legacy] Complete data operations. Modern full access excluding DB management.","description_generic-full":"Unrestricted system access. All permissions including DB management.","description_generic-full-legacy":"[Legacy] Unrestricted system access. All permissions including DB management.","label_groups":"Groups","label_granular":"Granular","label_inherited":"Inherited","description_no-granular-permissions":"No granular permissions available.","description_no-group-permissions":"No group permissions available.","action_discard":"Discard Changes","action_cancel":"Cancel","action_save":"Apply","label_rights-updated":"Access rights has been successfully changed","description_failed":"Failed","label_grant-access-to":"Grant access to"}');let xR=(0,ex.g4)("ydb-grant-access",{en:xD}),xk=(0,c.cn)("ydb-grant-access"),xM={1:xR("description_select-row"),2:xR("description_update-row"),4:xR("description_erase-row"),16:xR("description_write-attributes"),32:xR("description_create-directory"),64:xR("description_create-table"),128:xR("description_create-queue"),256:xR("description_remove-schema"),1024:xR("description_alter-schema"),2048:xR("description_create-database"),4096:xR("description_drop-database"),8:xR("description_read-attributes"),512:xR("description_describe-schema"),32768:xR("description_connect-database"),8192:xR("description_grant-access-rights"),521:xR("description_generic-read"),17910:xR("description_generic-write"),6144:xR("description_generic-manage"),520:xR("description_generic-list"),59391:xR("description_generic-use"),26623:xR("description_generic-use-legacy"),65535:xR("description_generic-full"),32767:xR("description_generic-full-legacy")};function xO({onCancel:e,onSave:t,onDiscard:a,loading:n,error:s,disabled:i}){return(0,r.jsxs)(eD.s,{justifyContent:"space-between",gap:2,className:xk("footer"),children:[(0,r.jsx)(tM.$,{view:"outlined",onClick:a,size:"l",className:xk("footer-button"),disabled:i,children:xR("action_discard")}),(0,r.jsxs)(eD.s,{gap:2,alignItems:"center",children:[s&&(0,r.jsx)(eR.m,{title:s,children:(0,r.jsx)(tc.J,{size:"m",theme:"danger",icon:(0,r.jsx)(ek.I,{data:sO.A}),children:xR("description_failed")})}),(0,r.jsx)(tM.$,{view:"flat",onClick:e,size:"l",className:xk("footer-button"),children:xR("action_cancel")}),(0,r.jsx)(tM.$,{onClick:t,view:"action",size:"l",className:xk("footer-button"),loading:n,disabled:i,children:xR("action_save")})]})]})}function xq({rights:e,availablePermissions:t,handleChangeRightGetter:a,inheritedRights:n,view:s}){return"Groups"===s?(0,r.jsx)(xL,{rights:e,availablePermissions:t?.AccessRules,handleChangeRightGetter:a,inheritedRights:n}):(0,r.jsx)(xz,{rights:e,availablePermissions:t?.AccessRights,handleChangeRightGetter:a,inheritedRights:n})}function xL({rights:e,availablePermissions:t,handleChangeRightGetter:a,inheritedRights:n}){return t?.length?(0,r.jsx)(eD.s,{gap:3,direction:"column",children:t.map(({Name:t,Mask:s,AccessRights:i=[],AccessRules:l=[]})=>{let o=i.concat(l),c=e.get(t),d=n.has(t);return 32767!==s&&26623!==s||c||d?(0,r.jsx)(xF,{active:c,right:t,onUpdate:a(t),includedRights:o,description:xM[s],inherited:d},t):null})}):xR("description_no-group-permissions")}function xz({rights:e,availablePermissions:t,handleChangeRightGetter:a,inheritedRights:n}){return t?.length?(0,r.jsx)(eD.s,{gap:3,direction:"column",children:t.map(({Name:t,Mask:s})=>(0,r.jsx)(xF,{active:e.get(t),right:t,onUpdate:a(t),description:xM[s],inherited:n.has(t)},t))}):xR("description_no-granular-permissions")}function xF({right:e,onUpdate:t,active:a,includedRights:n,description:s,inherited:i}){let l=i&&!a;return(0,r.jsx)(tY.Z,{className:xk("single-right"),theme:a||i?"info":"normal",children:(0,r.jsxs)(eD.s,{justifyContent:"space-between",alignItems:"flex-start",gap:4,children:[(0,r.jsxs)(eD.s,{direction:"column",gap:2,children:[(0,r.jsxs)(eD.s,{direction:"column",children:[(0,r.jsx)(eA.E,{variant:"subheader-2",children:e}),s&&(0,r.jsx)(eA.E,{color:"secondary",children:s})]}),n?.length?(0,r.jsx)(eD.s,{wrap:"wrap",gap:1,children:n.map(e=>(0,r.jsx)(tc.J,{theme:"unknown",children:e},e))}):null]}),(0,r.jsxs)(eD.s,{direction:"column",gap:2,children:[i&&(0,r.jsx)(tc.J,{theme:"info",children:xR("label_inherited")}),!l&&(0,r.jsx)(hG.d,{checked:!!a,onUpdate:t})]})]})})}let xQ={Groups:xR("label_groups"),Granular:xR("label_granular")};function xU({value:e,onUpdate:t,availablePermissions:a,rights:s}){let i=a?.AccessRules?.filter(e=>s.get(e.Name))?.length,l=a?.AccessRights?.filter(e=>s.get(e.Name))?.length;return(0,r.jsx)("div",{className:xk("view-selector"),children:(0,r.jsxs)(cM.x,{value:e,onUpdate:t,children:[(0,r.jsxs)(cM.x.Option,{value:"Groups",children:[xQ.Groups,i?(0,r.jsxs)(n.Fragment,{children:["\xa0",i]}):null]}),(0,r.jsxs)(cM.x.Option,{value:"Granular",children:[xQ.Granular,"\xa0",l?(0,r.jsxs)(n.Fragment,{children:["\xa0",l]}):null]})]})})}function x$({newSubjects:e,setNewSubjects:t}){let[a,s]=n.useState(!0),[i,l]=n.useState(""),o=n.useRef(null),c=n.useRef(null),d=(e=0)=>{c.current&&o.current&&((c.current.offsetWidth+e)*2>=o.current.offsetWidth?s(!1):s(!0))},u=()=>{i&&(t(e=>[...e,i]),l(""),d(10*i.length))},p=(a="nowrap")=>(0,r.jsx)(eD.s,{gap:1,className:xk("input-content"),wrap:a,ref:c,maxWidth:"100%",children:e.map(e=>(0,r.jsx)(tc.J,{type:"close",onCloseClick:()=>{t(t=>t.filter(t=>t!==e)),d(-1*e.length*10)},children:e},e))});return(0,r.jsx)(eD.s,{direction:"column",gap:2,children:(0,r.jsxs)(eD.s,{gap:2,alignItems:"start",children:[(0,r.jsx)("label",{htmlFor:"subjectInput",children:(0,r.jsx)(eA.E,{as:"div",whiteSpace:"nowrap",color:"secondary",className:xk("subject-input-label"),children:xR("label_grant-access-to")})}),(0,r.jsxs)(eD.s,{direction:"column",gap:1,className:xk("subject-input-wrapper"),children:[(0,r.jsx)(t6.k,{name:"subjectInput",className:xk("subject-input"),onBlur:u,onKeyDown:e=>{"Enter"===e.key&&u()},value:i,onUpdate:l,ref:o,startContent:a?p():void 0,autoFocus:!0}),!a&&p("wrap")]})]})})}function xG({handleCloseDrawer:e}){let{aclSubject:t}=tW(),[a,s]=n.useState([]),[i,o]=n.useState("Groups"),{path:c,database:d,databaseFullPath:u}=tR(),p=(0,j.XC)(),{currentRightsMap:m,setExplicitRightsChanges:h,rightsToGrant:g,rightsToRevoke:x,hasChanges:y}=function({aclSubject:e,path:t,database:a,databaseFullPath:r}){let s=(0,j.XC)(),i=(0,j.N4)(n=>t$(n,e??void 0,t,a,r,s)),[l,o]=n.useState(()=>new Map),c=n.useMemo(()=>Array.from(l.entries()).reduce((e,[t,a])=>(a&&!i.includes(t)&&e.push(t),e),[]),[l,i]),d=n.useMemo(()=>Array.from(l.entries()).reduce((e,[t,a])=>(!a&&i.includes(t)&&e.push(t),e),[]),[l,i]),u=n.useMemo(()=>new Map(i.map(e=>[e,!0])),[i]),p=n.useMemo(()=>{let e=new Map(u);return l.forEach((t,a)=>{e.set(a,t)}),e},[u,l]),m=n.useMemo(()=>!!(c.length||d.length),[c,d]);return{currentRightsMap:p,setExplicitRightsChanges:o,rightsToGrant:c,rightsToRevoke:d,hasChanges:m}}({aclSubject:t??void 0,path:c,database:d,databaseFullPath:u}),{isFetching:f}=tq.useGetSchemaAclQuery({path:c,database:d,databaseFullPath:u,dialect:p},{skip:!t}),{isFetching:b}=tq.useGetAvailablePermissionsQuery({database:d,databaseFullPath:u,dialect:p}),[v,T]=tq.useUpdateAccessMutation(),[w,S]=n.useState(""),E=(0,j.N4)(e=>tG(e,t??void 0,c,d,u,p)),_=n.useCallback(()=>{h(new Map)},[h]),N=n.useCallback(()=>{let r=t?[t]:a;r.length&&v({path:c,database:d,databaseFullPath:u,dialect:p,rights:{AddAccess:r.map(e=>({AccessRights:g,Subject:e,AccessType:"Allow"})),RemoveAccess:r.map(e=>({AccessRights:x,Subject:e,AccessType:"Allow"}))}}).unwrap().then(()=>{e(),(0,eL.A)({name:"updateAcl",content:xR("label_rights-updated"),autoHiding:1e3,isClosable:!1})}).catch(e=>{S((0,t7.$)(e))})},[v,c,d,p,g,t,x,a,e,u]),C=(0,j.N4)(e=>tB(e,d,u,p)),P=n.useCallback(e=>t=>{S(""),h(a=>new Map(a).set(e,t))},[h]),I=!!(t||a.length>0);return(0,r.jsxs)(eD.s,{direction:"column",className:xk(),height:"100%",children:[(0,r.jsxs)(eD.s,{direction:"column",grow:1,children:[(0,r.jsxs)(eD.s,{gap:4,direction:"column",className:xk("navigation"),children:[t?(0,r.jsx)(t0,{subject:t}):(0,r.jsx)(x$,{newSubjects:a,setNewSubjects:s}),I&&(0,r.jsx)(xU,{value:i,onUpdate:o,rights:m,availablePermissions:C})]}),I&&(0,r.jsx)(l.r,{loading:f||b,children:(0,r.jsx)(eD.s,{grow:1,position:"relative",qa:"access-rights-wrapper",children:(0,r.jsx)(xq,{inheritedRights:E,rights:m,availablePermissions:C,handleChangeRightGetter:P,view:i})})})]}),I&&(0,r.jsx)(xO,{onCancel:e,onDiscard:_,onSave:N,loading:T.isLoading,error:w,disabled:!y})]})}function xH({children:e}){let t=(0,I.nz)(),{showGrantAccess:a,handleShowGrantAccessChange:s,handleAclSubjectChange:i}=tW(),l=n.useCallback(()=>{s(!1),i(void 0)},[s,i]),o=n.useCallback(()=>(0,r.jsx)(xG,{handleCloseDrawer:l}),[l]);return t?(0,r.jsx)(le,{isDrawerVisible:!!a,onCloseDrawer:l,renderDrawerContent:o,drawerId:"tenant-grant-access",storageKey:"tenant-grant-access-drawer-width",detectClickOutside:!0,hideVeil:!1,isPercentageWidth:!0,drawerControls:[{type:"close"}],title:(0,r.jsx)(xB,{}),children:e}):e}function xB(){return(0,r.jsxs)(eD.s,{direction:"column",children:[(0,r.jsx)(eA.E,{variant:"subheader-2",children:e0("label_grant-access")}),(0,r.jsx)(eA.E,{color:"secondary",children:e0("context_grant-access")})]})}function xW({children:e}){return(0,r.jsx)(P.e,{children:(0,r.jsx)(xI,{children:(0,r.jsx)(xH,{children:e})})})}let xV=(0,c.cn)("tenant-page"),xJ=()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:!!localStorage.getItem(v.jX)});function xY({additionalTenantProps:e}){let[t,o]=n.useReducer(px(v.jX),void 0,xJ),{database:c,schema:d}=tW(),{name:u,isLoading:p}=(0,f.Ry)(c??"");if(!c)throw Error("Tenant name is not defined");let g=n.useRef();n.useEffect(()=>{g.current!==c&&((async()=>{let{registerYQLCompletionItemProvider:e}=await Promise.all([a.e("89738"),a.e("40248")]).then(a.bind(a,50379));e(c)})().catch(console.error),g.current=c)},[c]);let S=u??"",E=d??S,{currentData:_,error:N,isLoading:C}=x.useGetOverviewQuery({path:E,database:c,databaseFullPath:S}),P=(0,j.YQ)();n.useEffect(()=>{P((0,h.g)("tenant",{databaseName:S,database:c}))},[S,c,P]);let I=(0,j.N4)(e=>(0,y.Tp)(e,E,c,S)),A=_?.PathDescription?.Self?.PathType??I?.PathDescription?.Self?.PathType,D=_?.PathDescription?.Self?.PathSubType??I?.PathDescription?.Self?.PathSubType,R=(0,T.Pq)(N),k=R?b.J.clusterOrDatabaseAccessError:void 0,[M,O]=n.useState(!0);!M||C||p||O(!1);let q=E||e0("page.title"),{appTitle:L}=(0,w.J)();return(0,r.jsxs)("div",{className:xV(),children:[(0,r.jsx)(s.mg,{defaultTitle:`${q} — ${L}`,titleTemplate:`%s — ${q} — ${L}`}),(0,r.jsx)(l.r,{loading:M,children:(0,r.jsx)(i.A,{error:R?N:void 0,...k,children:(0,r.jsx)(tD,{database:c,path:E,type:A,subType:D,databaseFullPath:S,children:(0,r.jsx)(xW,{children:(0,r.jsxs)(m,{defaultSizePaneKey:v.jQ,defaultSizes:[25,75],triggerCollapse:t.triggerCollapse,triggerExpand:t.triggerExpand,minSize:[36,200],onSplitStartDragAdditional:()=>{o("clear")},children:[(0,r.jsx)(gJ,{onCollapseSummary:()=>{o("triggerCollapse")},onExpandSummary:()=>{o("triggerExpand")},isCollapsed:t.collapsed}),(0,r.jsx)("div",{className:xV("main"),children:(0,r.jsx)(gx,{additionalTenantProps:e})})]})})})})})]})}},75191:function(){},9155:function(){},42819:function(){}}]);