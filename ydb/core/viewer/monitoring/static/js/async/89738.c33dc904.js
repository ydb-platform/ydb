"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([["89738"],{78609:function(t,e,n){n.d(e,{U:()=>E});var s=n(45357),i=n(98191);let a={suggestTemplates:0,suggestPragmas:1,suggestEntity:2,suggestAllColumns:3,suggestColumns:4,suggestColumnAliases:5,suggestVariables:6,suggestTableIndexes:7,suggestTableHints:8,suggestEntitySettings:9,suggestKeywords:10,suggestAggregateFunctions:11,suggestTableFunctions:12,suggestWindowFunctions:13,suggestFunctions:14,suggestSimpleTypes:15,suggestUdfs:16};function l(t){return t.startsWith("$")}function u(t=[]){return Array.from(new Set(t))}let r=/[\s'"-/@]/;function g(t){if(t.startsWith("`")&&t.endsWith("`"))return t;let e=t;return t.match(r)&&(e=`\`${t}\``),e}function o(t){let e=0,n=t.length;return t.startsWith("`")&&(e=1),t.endsWith("`")&&(n=-1),t.slice(e,n)}let m="abcdefghijklmnopqrstuvwxyz";function c(t){let e=m[t];if(e)return e;let n=Math.floor(t/m.length),s=t%m.length;return m.slice(-1).repeat(n)+m[s]}async function d(t,e=[]){return e.map(e=>({label:e,insertText:e,kind:i.eo.CompletionItemKind.TypeParameter,detail:"Type",range:t,sortText:c(a.suggestSimpleTypes)}))}async function p(t,e,n=""){let s=null==n?void 0:n.startsWith("`");return e.reduce((e,{value:n,detail:l,isDir:u})=>{let r,g=u?`${n}/`:n;u&&!s&&(r=`\`${g}$0\``);let o=e.length;return e.push({label:g,insertText:null!=r?r:g,kind:u?i.eo.CompletionItemKind.Folder:i.eo.CompletionItemKind.Text,insertTextRules:r?i.eo.CompletionItemInsertTextRule.InsertAsSnippet:i.eo.CompletionItemInsertTextRule.None,detail:l,range:t,command:g.endsWith("/")?{id:"editor.action.triggerSuggest",title:""}:void 0,sortText:c(a.suggestEntity)+c(o)}),e},[])}async function h(t,e=[]){return e.map(e=>({label:e,insertText:e,kind:i.eo.CompletionItemKind.Function,detail:"Function",range:t,sortText:c(a.suggestFunctions)}))}async function f(t,e=[]){return e.map(e=>({label:e,insertText:e,kind:i.eo.CompletionItemKind.Function,detail:"Aggregate function",range:t,sortText:c(a.suggestAggregateFunctions)}))}async function y(t,e=[]){return e.map(e=>({label:e,insertText:e,kind:i.eo.CompletionItemKind.Function,detail:"Window function",range:t,sortText:c(a.suggestWindowFunctions)}))}async function b(t,e=[]){return e.map(e=>({label:e,insertText:e,kind:i.eo.CompletionItemKind.Function,detail:"Table function",range:t,sortText:c(a.suggestTableFunctions)}))}async function T(t,e=[]){return e.map(e=>({label:e,insertText:e,kind:i.eo.CompletionItemKind.Function,detail:"UDF",range:t,sortText:c(a.suggestUdfs)}))}async function w(t,e=[]){return e.map(e=>({label:e,insertText:e,kind:i.eo.CompletionItemKind.Module,detail:"Pragma",range:t,sortText:c(a.suggestPragmas)}))}async function C(t,e=[]){return e.map(e=>({label:e,insertText:e,kind:i.eo.CompletionItemKind.Property,detail:"Setting",range:t,sortText:c(a.suggestEntitySettings)}))}async function x(t,e,n,s){var r;if(!(null==e?void 0:e.tables))return[];let m=[],d=e.all?[]:void 0,p=e.tables.length>1,h=u(e.tables.map(t=>t.name)).filter(l),f=[];h.length&&h.forEach(t=>{var e,s,i,a;let l=null!=(a=null==(i=null==(s=null==(e=null==n?void 0:n.find(e=>t.slice(1)===e.name))?void 0:e.value)?void 0:s.columns)?void 0:i.map(e=>({name:e,parent:t})))?a:[];f.push(...l)});let y=e.tables.reduce((t,e)=>{let n=e.columns;return n&&t.push(...n.map(t=>({name:t,parent:e.name}))),t},[]),b=null==(r=e.tables)?void 0:r.reduce((t,e)=>{var n;let s=o(e.name),i=null!=(n=t[s])?n:[];return e.alias&&i.push(e.alias),t[s]=i,t},{});if([...s,...f,...y].forEach(e=>{let n=g(e.name),s=b[o(e.parent)],l=m.length;if(null==s?void 0:s.length)s.forEach(s=>{let u=`${s}.${n}`;m.push({label:{label:u,description:e.detail},insertText:u,kind:i.eo.CompletionItemKind.Variable,detail:"Column",range:t,sortText:c(a.suggestColumns)+c(l)}),null==d||d.push(u)});else{let s=n;p&&(s=`${g(e.parent)}.${n}`),m.push({label:{label:s,description:e.detail},insertText:s,kind:i.eo.CompletionItemKind.Variable,detail:"Column",range:t,sortText:c(a.suggestColumns)+c(l)}),null==d||d.push(s)}}),d&&d.length>1){let e=d.join(", ");m.push({label:e,insertText:e,kind:i.eo.CompletionItemKind.Variable,range:t,sortText:c(a.suggestAllColumns)})}return m}function F(t,e){let n=t.slice(0,e).split("\n");return{lineNumber:n.length,column:n[n.length-1].length+1}}let I=/([^\s]+)$/;function v(t,e,n=I){let s=t.slice(0,e).match(n);return s&&s[1]?s[1]:""}let S=/([^\\/\s`]+)$/;class K{constructor({getQueryParser:t,getUdfs:e,getSimpleTypes:n,getPragmas:s,getWindowFunctions:i,getTableFunctions:a,getAggregateFunctions:l,getSimpleFunctions:u,getEntitySettings:r,fetchEntities:g,fetchEntityColumns:o}){t&&(this.getQueryParser=t),e&&(this.getUdfs=e),n&&(this.getSimpleTypes=n),s&&(this.getPragmas=s),i&&(this.getWindowFunctions=i),a&&(this.getTableFunctions=a),l&&(this.getAggregateFunctions=l),u&&(this.getSimpleFunctions=u),r&&(this.getEntitySettings=r),g&&(this.fetchEntities=g),o&&(this.fetchEntityColumns=o)}async getSuggestions(t,e){var n,s;let r,g,o=await this.parseInput(t,e),m=[],I=[],K=[],k=[],E=[],A=[],P=[],W=[],V=[],$=[],U=[],N=(r=F(t,e),g=v(t,e,S),{startColumn:r.column-g.length,startLineNumber:r.lineNumber,endColumn:r.column,endLineNumber:r.lineNumber}),Q=v(t,e);if(o.suggestSimpleTypes){let t=await this.getSimpleTypes(Q);P=await d(N,t)}if(o.suggestEntity){let t=await this.fetchEntities(Q,o.suggestEntity);m=await p(N,t,Q)}if(o.suggestVariables&&(U=function(t,e=[]){return e.map(({name:e})=>{let n="$"+e;return{label:n,insertText:n,kind:i.eo.CompletionItemKind.Variable,detail:"Variable",range:t,sortText:c(a.suggestVariables)}})}(N,o.suggestVariables)),o.suggestFunctions){let t=await this.getSimpleFunctions(Q);I=await h(N,t)}if(o.suggestAggregateFunctions){let t=await this.getAggregateFunctions(Q);K=await f(N,t)}if(o.suggestWindowFunctions){let t=await this.getWindowFunctions(Q);k=await y(N,t)}if(o.suggestTableFunctions){let t=await this.getTableFunctions(Q);E=await b(N,t)}if(o.suggestUdfs){let t=await this.getUdfs(Q);A=await T(N,t)}if(o.suggestPragmas){let t=await this.getPragmas(Q);W=await w(N,t)}if(o.suggestEntitySettings){let t=await this.getEntitySettings(o.suggestEntitySettings);V=await C(N,t)}let _=function(t,e=[]){return e.map(e=>({label:e.value,insertText:e.value,kind:i.eo.CompletionItemKind.Keyword,detail:"Keyword",range:t,sortText:c(a.suggestKeywords)}))}(N,o.suggestKeywords),M=await function(t,e=[]){return e.map(e=>({label:e.name,insertText:e.name,kind:i.eo.CompletionItemKind.Variable,detail:"Column alias",range:t,sortText:c(a.suggestColumnAliases)}))}(N,o.suggestColumnAliases);if(o.suggestColumns){let t=u(null==(s=null==(n=o.suggestColumns)?void 0:n.tables)?void 0:s.map(t=>t.name)).filter(t=>!l(t)),e=await this.fetchEntityColumns(t);$=await x(N,o.suggestColumns,o.suggestVariables,e)}return[...m,...I,...k,...E,...A,...P,...W,...M,...$,..._,...K,...V,...U]}async parseInput(t,e){let n=F(t,e);return(await this.getQueryParser())(t,{line:n.lineNumber,column:n.column})}async getQueryParser(){let{parseYqlQuery:t}=await Promise.resolve().then(n.bind(n,15452));return t}async getSimpleTypes(t){return[]}async getUdfs(t){return[]}async getPragmas(t){return[]}async getWindowFunctions(t){return[]}async getTableFunctions(t){return[]}async getAggregateFunctions(t){return[]}async getSimpleFunctions(t){return[]}async getEntitySettings(t){return[]}async fetchEntities(t,e){return[]}async fetchEntityColumns(t){return[]}}let k=new Map;function E(t,e,n){let i;(i=k.get(t))&&i.dispose();let a=s.languages.registerCompletionItemProvider(t,{triggerCharacters:e,provideCompletionItems:function(t={}){let e=new K(t);return async(t,n,s,i)=>({suggestions:await e.getSuggestions(t.getValue(),t.getOffsetAt(n))})}(n)});k.set(t,a)}}}]);