# Выполнение запросов

{{ydb-short-name}} — это распределённая MPP-база данных (Massively Parallel Processing), предназначенная для выполнения сложных аналитических запросов на больших объёмах данных. Каждый запрос автоматически распараллеливается по всем доступным вычислительным узлам кластера, что позволяет эффективно использовать вычислительные ресурсы.

{{ydb-short-name}} поддерживает ряд ключевых технологий, обеспечивающих высокую производительность и стабильность:

- [{#T}](#mpp)
- [{#T}](#cbo)
- [{#T}](#spilling)
- [{#T}](#resource_management)

## Децентрализованная MPP-архитектура {#mpp}

В отличие от MPP-систем с выделенным управляющим узлом (master node), архитектура {{ydb-short-name}} полностью децентрализована. Это обеспечивает два основных преимущества:

- Высокая отказоустойчивость: любой узел кластера может принять и координировать выполнение запроса. Отсутствует единая точка отказа (SPOF). Выход из строя части узлов не приводит к остановке кластера — нагрузка автоматически перераспределяется на оставшиеся узлы.
- Масштабируемость вычислений: вы можете добавлять или удалять вычислительные узлы без простоев, и система автоматически адаптируется, распределяя нагрузку с учётом нового состава кластера.

## Стоимостной оптимизатор запросов {#cbo}

Перед выполнением запроса {{ydb-short-name}} использует [стоимостной оптимизатор (Cost-Based Optimizer)](../../query_execution/optimizer.md). Он анализирует текст запроса, метаданные и статистику по распределению данных в таблицах, чтобы построить физический план выполнения с наименьшей оценочной стоимостью.

Оптимизатор способен:

- Выбирать порядок соединения таблиц для запросов с десятками `JOIN`'ов;
- Подбирать алгоритмы распределенных `JOIN`'ов (например, Grace Join, Broadcast Join) в зависимости от размера таблиц;
- «Проталкивать» фильтры (`WHERE`) как можно ближе к источникам данных для уменьшения объема обрабатываемой информации на последующих стадиях.

## Обработка данных, превышающих объем RAM {#spilling}

Аналитические запросы могут требовать для своей работы большие объемы оперативной памяти, особенно на операциях `JOIN` и `GROUP BY`. {{ydb-short-name}} спроектирована для работы с данными, которые могут не помещаться в RAM.

- Спиллинг (Spilling): Если промежуточные результаты выполнения запроса превышают лимит оперативной памяти, {{ydb-short-name}} [автоматически выгружает](../../query_execution/spilling.md) их на локальный диск узла. Это предотвращает падение запроса с ошибкой «Out of Memory» и позволяет выполнять запросы над большими объемами данных.
- Распределенные алгоритмы JOIN: для соединения таблиц, превышающих память одного узла, используются распределенные алгоритмы, которые обрабатывают данные по частям на разных узлах.

## Изоляция нагрузок и управление ресурсами {#resource_management}

В корпоративном DWH часто работают разные команды с разными типами нагрузки. Чтобы эти нагрузки не мешали друг другу, в {{ydb-short-name}} встроен менеджер управления ресурсами.

- Workload Manager: Встроенный [менеджер нагрузки](../../../dev/resource-consumption-management) позволяет создавать ресурсные пулы и с помощью [классификаторов](../../../concepts/glossary#resource-pool-classifier) назначать запросы разных групп пользователей в разные пулы. Этот механизм решает проблему «шумных соседей», когда один ресурсоемкий запрос может замедлять работу системы для остальных пользователей.
