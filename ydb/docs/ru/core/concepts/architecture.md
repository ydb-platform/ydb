# Архитектурный обзор {{ ydb-short-name }}

*{{ ydb-short-name }}* — это горизонтально масштабируемая распределенная отказоустойчивая СУБД. {{ ydb-short-name }} спроектирована с учетом требований высокой производительности — например, обычный сервер может обрабатывать десятки тысяч запросов в секунду. В дизайн системы заложена работа с объемами данных в сотни петабайт. {{ ydb-short-name }} может эксплуатироваться в однодатацентровом и геораспределенном (кросс-датацентровый) режимах на кластере из тысяч серверов.

{{ ydb-short-name }} обеспечивает:

* [строгую консистентность](https://en.wikipedia.org/wiki/Consistency_model#Strict_Consistency) с возможностью ослабления для увеличения производительности;
* поддержку запросов [YQL](../yql/reference/index.md) (диалект SQL для работы с большими данными);
* автоматическую репликацию данных;
* высокую доступность с автоматической обработкой отказов вычислительных узлов, стоек, или зон доступности;
* автоматическое партицирование данных при увеличении их объема или увеличении нагрузки.

Для взаимодействия с {{ ydb-short-name }} доступен [{{ ydb-short-name }} CLI](../reference/ydb-cli/index.md), а также [SDK](../reference/ydb-sdk/index.md) для C++, C#, Go, Java, Node.js, PHP, Python и Rust.

{{ ydb-short-name }} поддерживает реляционную модель данных и оперирует [строковыми](datamodel/table.md#row-tables) и [колоночными](datamodel/table.md#column-tables) таблицами с предопределенной схемой. Для удобства организации таблиц поддерживается создание директорий по аналогии с файловой системой. Помимо таблиц {{ ydb-short-name }} поддерживает [топики](topic.md), которые представляют собой сущность для хранения неструктурированных сообщений и доставки их множеству подписчиков.

В качестве основного способа формирования команд к базе данных используется язык YQL, являющийся диалектом SQL. Таким образом, пользователю предлагается мощный и, в то же время, привычный способ взаимодействия с БД.

В {{ ydb-short-name }} поддерживаются высокопроизводительные распределенные [ACID](https://en.wikipedia.org/wiki/ACID_(computer_science))-транзакции, которые могут затрагивать несколько записей из разных таблиц одного типа. Обеспечивается самый строгий уровень изоляции транзакций — serializable. Также имеется возможность ослабления уровня изоляции для увеличения производительности.

В дизайн {{ ydb-short-name }} заложена поддержка разных сценариев нагрузки, таких как [OLTP](https://en.wikipedia.org/wiki/Online_transaction_processing) и [OLAP](https://en.wikipedia.org/wiki/Online_analytical_processing). В текущей реализации поддержка аналитических запросов ограничена. Поэтому можно говорить, что в данный момент {{ ydb-short-name }} — это OLTP-база данных.

{{ ydb-short-name }} — открытая система. Исходный код {{ ydb-short-name }} доступен под лицензией [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). Взаимодействие клиентских приложений с {{ ydb-short-name }} построено на базе протокола [gRPC](https://grpc.io/), спецификация которого открыта, что позволяет реализовать SDK для любого языка программирования.

## Сценарии применения {#use-cases}

{{ ydb-short-name }} является альтернативой имеющимся решениям в следующих случаях:

* При использовании NoSQL-систем, когда требуется строгая консистентность данных.
* При использовании NoSQL-систем, когда требуется транзакционное изменение данных, хранящихся в разных строках одной или нескольких таблиц.
* В системах, требующих обработки и хранения большого объема данных, с возможностью практически неограниченного горизонтального масштабирования (в эксплуатации находятся промышленные кластеры более чем из 5000 узлов, обрабатывающие нагрузку в миллионы RPS и хранящие петабайты данных).
* В системах с незначительной нагрузкой, когда поддержка отдельного инстанса базы данных будет расточительна с материальной точки зрения (предлагается использовать {{ ydb-short-name }} в режиме бессерверных вычислений).
* В системах с плохо предсказуемой или сезонно меняющейся нагрузкой (используя возможность добавления/уменьшения вычислительных ресурсов по запросу и/или в режиме бессерверных вычислений).
* В высоконагруженных системах, которые шардируют нагрузку между инстансами реляционной базы данных.
* При разработке нового продукта, для которого нет надежного прогноза будущей нагрузки, или ожидается большая нагрузка, превышающая возможности традиционных реляционных баз данных.
* В проектах, где требуются одновременная работа с транзакционными и аналитическими нагрузками.


## Как это работает?

Полное объяснение того, как работает {{ ydb-short-name }}, получилось бы слишком объемным. Ниже вы можете ознакомиться с несколькими основными моментами, а затем продолжить изучение документации, чтобы узнать больше.

### Архитектура {{ ydb-short-name }} {#ydb-architecture}

![Архитектура {{ ydb-short-name }}](https://storage.yandexcloud.net/ydb-www-prod-site-assets/howitworks/grps.png)

Кластеры {{ ydb-short-name }} обычно работают с shared nothing архитектурой на обычном оборудовании. Уровни вычислений и хранения являются разнёсенными. Они могут работать как на отдельных наборах узлов, так и быть совмещёнными.

Один из ключевых элементов вычислительного слоя {{ ydb-short-name }} называется *таблеткой*. Они являются логическими компонентами с состоянием, реализующими различные аспекты {{ ydb-short-name }}.

 {% if audience != "corp" %}

Более подробная общая архитектура {{ ydb-short-name }} объясняется в разделе [{#T}](../contributor/general-schema.md).

{% endif %}

### Иерархия {#ydb-hierarchy}

![Иерархия](https://storage.yandexcloud.net/ydb-www-prod-site-assets/howitworks/organization.png)

С точки зрения пользователя, всё внутри {{ ydb-short-name }} организовано в иерархической структуре с использованием каталогов. Она может иметь произвольную глубину в зависимости от того, как вы решили организовать свои данные и проекты. Хотя {{ ydb-short-name }} не имеет фиксированной глубины иерархии, как в других реализациях SQL, она все равно будет знакома, поскольку именно так выглядит любая виртуальная файловая система.

### Таблица

![Таблица](https://storage.yandexcloud.net/ydb-www-prod-site-assets/howitworks/table.png)

{{ ydb-short-name}} предоставляет пользователям хорошо известную абстракцию — таблицы. В {{ ydb-short-name }} существует два основных типа таблиц:

* [Строковые таблицы](datamodel/table.md#row-tables) предназначены для OLTP-нагрузок.
* [Колоночные таблицы](datamodel/table.md#column-tables) предназначены для OLAP-нагрузок.

Логически, с точки зрения пользователя, оба вида таблиц выглядят одинаково. Основное отличие между строковыми и колоночными таблицами заключается в способе хранения данных. В строковых таблицах значения всех колонок каждой строки располагаются рядом, а в колоночных таблицах — наоборот, каждая колонка хранится отдельно, и рядом оказываются ячейки, относящиеся к разным строкам.

Независимо от типа таблицы, она должна содержать первичный ключ. В первичном ключе колоночных таблиц можно использовать только колонки с `NOT NULL`. Данные в таблицах физически сортируются по первичному ключу. Строковые таблицы автоматически партицируются по диапазонам первичных ключей в зависимости от объёма данных, а данные в колоночных таблицах партицируются не по первичному ключу, а по хешу от колонок партицирования. Каждый диапазон первичных ключей таблицы обрабатывается определённой [таблеткой](glossary.md#tablet), называемой *data shard* для строчных таблиц и *column shard* — для колоночных.

#### Разделение по нагрузке

![Разделение по нагрузке](https://storage.yandexcloud.net/ydb-www-prod-site-assets/howitworks/nagruz%201.5.png)

Data shard автоматически разделяются на большее количество при увеличении нагрузки. Они автоматически объединяются в нужное количество, когда пиковая нагрузка уходит.

#### Разделение по размеру

![Разделение по размеру](https://storage.yandexcloud.net/ydb-www-prod-site-assets/howitworks/size%201.5%20(1).png)

Data shard также автоматически разделяются при увеличении размера данных. Они автоматически сливаются обратно, если достаточное количество данных будет удалено.

### Автоматическая балансировка

![Автоматическое балансирование](https://storage.yandexcloud.net/ydb-www-prod-site-assets/howitworks/pills%201.5.png)

{{ ydb-short-name }} равномерно распределяет таблетки среди доступных узлов. Она перемещает тяжело загруженные таблетки с перегруженных узлов. Метрики CPU, памяти и сети отслеживаются для облегчения этого процесса.

### Внутреннее устройство распределенного хранилища

![Внутреннее устройство распределенного хранилища](https://storage.yandexcloud.net/ydb-www-prod-site-assets/howitworks/distributed.png)

{{ ydb-short-name }} не полагается на сторонние файловые системы. Она хранит данные, работая непосредственно с дисковыми накопителями как блочными устройствами. Поддерживаются все основные типы дисков: NVMe, SSD или HDD. За работу с конкретным блочным устройством отвечает компонент PDisk. Уровень абстракции выше PDisk называется VDisk. Также есть специальный компонент, называемый DSProxy, между таблеткой и VDisk. DSProxy анализирует доступность и характеристики дисков и выбирает, какие диски будут обрабатывать запрос, а какие нет.

### Прокси распределенного хранилища (DSProxy)

![DSProxy](https://storage.yandexcloud.net/ydb-www-prod-site-assets/howitworks/proxy%202.png)

Геораспределенная и отказоустойчивая конфигурация {{ ydb-short-name }} обычно охватывает 3 датацентра или зоны доступности (Availability Zone - AZ). Когда {{ ydb-short-name }} записывает данные на 3 зоны доступности, он не отправляет запросы на явно некорректные диски и продолжает работать без прерываний даже если одна зона доступности и диск в другой зоне доступности потеряны.

{% if feature_resource_pool == true and feature_resource_pool_classifier == true %}

### Управление ресурсами баз данных {#db-resources}

По умолчанию выделяемые каждой базе данных вычислительные ресурсы используются всеми запросами к ней на равных условиях, без каких-либо ограничений. Если требуется разделить ресурсы внутри одной базы данных, то в {{ ydb-short-name }} существуют [пулы ресурсов](glossary.md#resource-pool) и [классификаторы пулов ресурсов](glossary.md#resource-pool-classifier). Один из типовых сценариев применения такой функциональности — это разделение контуров онлайн-вычислений и фоновой аналитики. Подробнее о ней можно узнать в статье [{#T}](../dev/resource-consumption-management.md).

{% endif %}


## Что дальше?

Если вас интересует более подробная информация о различных аспектах {{ ydb-short-name }}, ознакомьтесь с соседними статьями в данном разделе документации. Если вы готовы к более практическому контенту, вы можете перейти к [быстрому старту](../quickstart.md) или курсу по [YQL](../dev/yql-tutorial/index.md).