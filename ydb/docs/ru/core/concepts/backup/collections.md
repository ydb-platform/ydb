# Коллекции резервных копий и инкрементальные резервные копии

Коллекции резервных копий обеспечивают продвинутое решение для резервного копирования в {{ ydb-short-name }}, которое организует полные и инкрементальные резервные копии в управляемые коллекции. Этот подход предназначен для производственных нагрузок, требующих эффективного аварийного восстановления и возможностей восстановления на момент времени.

## Обзор

Коллекции резервных копий решают несколько проблем традиционных подходов экспорта/импорта:

- **Эффективность**: Инкрементальные резервные копии захватывают только изменения с момента предыдущей резервной копии
- **Организация**: Связанные резервные копии группируются в логические коллекции
- **Гибкость восстановления**: Позволяет восстановление на момент времени для любой резервной копии в цепочке

## Основные концепции

### Коллекция резервных копий

Именованный набор резервных копий для выбранных таблиц базы данных. Коллекции организуют связанные резервные копии и обеспечивают их согласованное восстановление.

### Полная резервная копия

Полный снимок всех выбранных таблиц в определенный момент времени. Служит базовой линией для последующих инкрементальных резервных копий.

### Инкрементальная резервная копия

Захватывает только изменения (вставки, обновления, удаления) с момента предыдущей резервной копии в цепочке. Значительно меньше полных резервных копий для наборов данных с ограниченными изменениями.

### Цепочка резервных копий

Упорядоченная последовательность резервных копий, начинающаяся с полной резервной копии, за которой следует ноль или более инкрементальных резервных копий. Каждая инкрементальная резервная копия зависит от всех предыдущих резервных копий в цепочке.

## Архитектура

### Поток резервного копирования

1. **Создание коллекции**: Определение таблиц для включения
2. **Начальная полная резервная копия**: Создание базового снимка
3. **Регулярные инкрементальные резервные копии**: Захват текущих изменений
4. **Управление хранением**: Удаление старых резервных копий с сохранением целостности цепочки

### Варианты хранения

- **Кластерное хранилище**: Резервные копии хранятся в кластере {{ ydb-short-name }} (текущий по умолчанию)
- **Внешнее хранилище**: Ручной экспорт в файловую систему или S3 с использованием CLI инструментов для долгосрочного архивирования (поддержка автоматического внешнего хранилища может быть добавлена в будущих версиях)

### Фоновые операции

Все операции резервного копирования и восстановления выполняются асинхронно в фоновом режиме, позволяя отслеживать прогресс через API длительных операций без блокировки других действий с базой данных.

## Когда использовать коллекции резервных копий

**Идеальные сценарии:**

- Производственные среды, требующие регулярного резервного копирования
- Большие наборы данных, где инкрементальные изменения намного меньше общего размера данных
- Требования восстановления на момент времени
- Планирование аварийного восстановления с ограничениями RTO/RPO

**Рассмотрите традиционный экспорт/импорт и backup/restore для:**

- Небольших баз данных или отдельных таблиц
- Баз данных с высокой скоростью изменений относительно объема хранимых данных
- Одноразовых задач миграции данных
- Сред разработки/тестирования
- Простых сценариев резервного копирования без инкрементальных потребностей

## Быстрый старт

Для начала работы с коллекциями резервных копий:

```sql
-- 1. Создайте коллекцию для ваших таблиц
CREATE BACKUP COLLECTION `my_backup_collection`
    ( TABLE `/Root/database/orders`
    , TABLE `/Root/database/products`
    )
WITH ( STORAGE = 'cluster', INCREMENTAL_BACKUP_ENABLED = 'true' );

-- 2. Создайте начальную полную резервную копию
BACKUP `my_backup_collection`;

-- 3. Создавайте инкрементальные резервные копии по мере необходимости
BACKUP `my_backup_collection` INCREMENTAL;
```

Для подробного справочника команд и расширенного использования см. [Руководство по CLI для коллекций резервных копий](../../reference/ydb-cli/export-import/backup-collections/index.md).

## См. также

- [Обзор концепций резервного копирования](../backup.md) - Общие подходы к резервному копированию в {{ ydb-short-name }}
- [Справочник по CLI для коллекций резервных копий](../../reference/ydb-cli/export-import/backup-collections/index.md) - Подробный справочник команд и примеры
- [Справочник по экспорту и импорту](../../reference/ydb-cli/export-import/index.md) - Традиционные методы резервного копирования
- [Руководство по резервному копированию и восстановлению](../../devops/backup-and-recovery.md) - Комплексные стратегии резервного копирования
