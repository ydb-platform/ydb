# Колоночная таблица

{% note warning %}

Колоночные таблицы {{ ydb-short-name }} доступны в режиме Preview.

{% endnote %}

Колоночная таблица {{ ydb-short-name }} — это реляционная таблица, содержащая набор связанных данных, состоящий из строк и столбцов. В отличие от обычных, строковых, [таблиц {{ ydb-short-name }}](#table), предназначенных для [OLTP-нагрузки](https://ru.wikipedia.org/wiki/OLTP), колоночные таблицы оптимизированы для задач анализа данных, [OLAP-нагрузки](https://ru.wikipedia.org/wiki/OLAP).

На данный момент основной сценарий использования колоночных таблиц — запись данных с возрастающим первичным ключом (например, время события), анализ этих данных и удаление устаревших данных по TTL. Оптимальным способом добавления данных в колоночные таблицы является пакетная запись, выполняемая блоками в единицы МБ.

Вставка пакетов данных производится атомарно: данные будут записаны или во все партиции, или ни в одну. При чтении анализируются только полностью записанные в колоночные таблицы данные.

В большинстве случаев работа со колоночными таблицами {{ ydb-short-name }} аналогична работе со строковыми. Имеются следующие отличия:

* В качестве ключевых колонок можно использовать только NOT NULL колонки.
* Данные партицируются не по первичному ключу, а по Hash от колонок [партицирования](#olap-tables-partitioning).
* Поддерживается [ограниченный набор](#olap-data-types) типов данных.

В настоящий момент не поддерживается:

* Чтение с реплик.
* Вторичные индексы.
* Фильтры Блума.
* Change Data Capture.
* Переименование таблиц.
* Пользовательские аттрибуты таблиц.
* Изменение списка колонок данных в колоночных таблицах.
* Добавление данных в колоночные таблицы с помощью SQL-оператора `INSERT`.
* Удаление данных из колоночных таблиц с помощью SQL-оператора `DELETE`. Фактически, удаление возможно только по истечению TTL времени хранения данных.

## Поддерживаемые типы данных {#olap-data-types}

Тип данных | Можно использовать<br>в колоночных таблицах | Можно использовать<br>в качестве первичного ключа
---|---|---
`Bool` | ☓ | ☓
`Date` | ✓ | ✓
`Datetime` | ✓ | ✓
`Decimal` | ☓ | ☓
`Double` | ✓ | ☓
`Float` | ✓ | ☓
`Int16` | ✓ | ☓
`Int32` | ✓ | ✓
`Int64` | ✓ | ✓
`Int8` | ✓ | ☓
`Interval` | ☓ | ☓
`JsonDocument` | ✓ | ☓
`Json` | ✓ | ☓
`String` | ✓ | ✓
`Timestamp` | ✓ | ✓
`Uint16` | ✓ | ✓
`Uint32` | ✓ | ✓
`Uint64` | ✓ | ✓
`Uint8` | ✓ | ✓
`Utf8` | ✓ | ✓
`Uuid` | ☓ | ☓
`Yson` | ✓ | ☓

Подробнее смотрите [{#T}](../yql/reference/types/index.md).

## Партицирование {#olap-tables-partitioning}

В отличие от строковых таблиц {{ ydb-short-name }}, колоночные таблицы партицируют данные не по первичным ключам, а по специально выделенным ключам — ключам партицирования. Ключи партицирования являются подмножеством первичных ключей таблицы.

В отличие от партицирования данных в строковых таблиц {{ ydb-short-name }}, партицирование данных для колоночных таблиц выполняется не по значениям ключей, а по hash-значениям от ключей, что позволяет равномерно распределить данные во все существующие партиции. Такое партицирование позволяет избежать хотспотов при вставке и ускоряет аналитические запросы, обрабатывающие (считывающие) большие объемы данных.

Выбор ключей партицирования существенно влияет на производительность колоночных таблиц. Подробнее смотрите [{#T}](../best_practices/pk-olap-scalability.md).

Для управления партицированием данных используется дополнительный параметр `AUTO_PARTITIONING_MIN_PARTITIONS_COUNT`. Остальные параметры партицирования для колоночных таблиц игнорируются.

`AUTO_PARTITIONING_MIN_PARTITIONS_COUNT` определяет минимальное физическое количество партиций для хранения данных.

* Тип: `Uint64`.
* Значение по умолчанию: `1`.

С учетом, что остальные параметры партицирования игнорируются, это же значение определяет и верхнее число партиций для партицирования.

## См. также {#see-also}

* [{#T}](../yql/reference/syntax/create_table.md#olap-tables)
