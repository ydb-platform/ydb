# Чекпойнты

Чекпойнт представляет собой состояние рабочего потокового запроса, которое необходимо для восстановления работы запроса в случае сбоев в распределенной системе: выход из строя узлов, падения процессов при нехватке памяти и др. Инфраструктура собирает чекпойнты всех запущенных потоковых запросов периодически и сохраняет в системные таблицы базы.

Чекпойнт состоит из:

- состояний агрегаций, таких как [MATCH_RECOGNIZE](../../../yql/reference/syntax/select/match_recognize) и [GROUP BY HOP](../../../yql/reference/syntax/select/group-by#group-by-hop);
- текущих [смещений](../topic#consumer-offset) во входных топиках;
- текущих [порядковых номеров сообщений](../topic#seqno) в выходных топиках.

При первом запуске запроса производится его компиляция, результат которой сохраняется в системную таблицу.
В случае завершения запроса с ошибкой, он будет перезапущен автоматически, при этом:

- повторной компиляции не будет, т.к. в самом начале её сделали, и в таблице есть её результат;
- внутреннее состояние запроса будет восстановлено из последнего сохранённого чекпойнта.

У пользователя нет возможности для конкретного запроса как-то повлиять на сохранение чекпойнтов и выбор чекпойнта для восстановления, это делается автоматически.

## Очистка

Размер чекпойнта зависит от сложности запроса, используемых агрегаций и от характера данных. Для оптимального потребления хранилища после очередного успешного сохранения чекпойнта старые удаляются автоматически. То есть большую часть времени для одного запроса в хранилище хранится только один чекпойнт.

## Отключение чекпойнтов

Для снижения накладных расходов (от сохранения чекпойтов) возможно отключение чекпойнтов. Для этого используется прагма `ydb.DisableCheckpoints`. При этом нужно учитывать отсутствие гарантий на консистентность данных (при пользовательских или внутренних перезапусках запроса). Используйте исключительно с целью отладки.

```yql
CREATE STREAMING QUERY query_without_checkpoints AS
DO BEGIN

PRAGMA ydb.DisableCheckpoints = "TRUE";

INSERT INTO
    ydb_source.output_topic
SELECT
    *
FROM
    ydb_source.input_topic

END DO
```
