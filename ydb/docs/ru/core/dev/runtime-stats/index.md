# Статистика выполнения запросов и её анализ

При выполнении запроса {{ ydb-short-name }} собирает статистику выполнения, которая помогает исследовать план выполнения запроса, находить узкие места и, а также ускорять их, устраняя проблемы и выбирая более оптимальные решения, что особенно важно для аналитическим (OLAP) запросов. Эти данные вместе с планом выполнения запроса доступны в формате JSON, который, однако, с трудом поддаётся анализу. Для упрощения понимания поведения запроса возможна его визуализация в графическом формате SVG. В данном разделе содержится информация о данном представлении.

В качестве примера в данном разделе будет использоваться набор данных от промышленного бенчмарка TPC-H scale 100. Описание структуры таблиц и связей между ними вы можете найти в спецификации данного стандарта. Для иллюстрации мы использовали некоторые стандартные запросы бенчмарка (адаптированные к синтаксису {{ ydb-short-name }}) и некоторые оригинальные запросы, которые подобраны специальным образом для улучшения иллюстрации материала. Текст каждого запроса приведён рядом с его планом выполнения.

Целевой аудиторией данного раздела являются аналитические запросы, поэтому основной материал будет подразумевать колоночный формат таблиц хранения данных. Особенности анализа поведения федеративных запросов к внешним источникам данных, а также особенности выполнения запросов к строковым таблицам описаны в отдальных разделах.

Формат графического представления спроектирован таким образом, чтобы акцентировать внимание на наиболее нужных и полезных элементах. При этом опытный разработчик сможет получить из него больше информации, обращая внимание на дополнительные элементы и из свойства. Сложные концепции поясняются в данном разделе с символом ???.

Для лучшего понимания материала в разделе иногда встречаются контрольные вопросы. Они по умолчанию показываются в свёрнутом виде, чтобы не занимать полезное место и не отвлекать внимание при повторном просмотре. Однако, при первом знакомстве с документацией мы рекомедуем вам развернуть их, подумать над изложенной проблемой и только после того, как вы сформулировали собственную версию ознакомиться с ответом. Такие несложные упражнения помогут вам гораздо быстрее и точнее понять объясняемый материал и быстрее повысить собственное мастерство чтения планов выполнения.

- [Как получить графическое представление плана](how-to-get.md)
    - [UI](how-to-get.md#ui)
    - [ydb cli](how-to-get.md#cli)
    - [ydb_int](how-to-get.md#ydb_int)
    - [kqprun](how-to-get.md#kqprun)
- [Структура плана запроса](structure.md)
    - [Стадии](structure.md#stages)
    - [Каналы связи](structure.md#connections)
    - [Объединение](structure.md#join)
    - [Множественные выходы](structure.md#multiout)
    - [Составные графы](structure.md#complex)
- [Визуализация метрик](metrics.md)
    - [Параллельность](metrics.md#parallelism)
    - [Агрегаты](metrics.md#aggregates)
    - [Масштаб метрик](metrics.md#scale)
    - [Перекос данных](metrics.md#dataskew)
    - [Перекос времени](metrics.md#timeskew)
    - [Потребление CPU](metrics.md#cpu)
    - [Потребление памяти](metrics.md#memory)
- [Анализ плана](analysis.md)
    - Зависимости между стадиями
    - Алгоритм анализа
    - Локализация проблемы
- [Примеры анализа](examples.md)
    - Недостаточная производительность колоночных таблиц
    - Низкий уровень параллельности вычислительных задач
    - Неравномерность загрузки задач внутри стадии
    - Неоптимальный план вычислений
- [Федеративные аналитические запросы](federative.md)
    - Получение данных из внешнего источника
    - Выгрузка данных во внешний источник
    - Обработка данных из нескольких источников
- [Особенности анализа строчных таблиц](datashards.md)
    - Lookup Join и Stream Lookup Join