# Чекпоинты

Чекпоинт — это сохранённое состояние работающего [потокового запроса](../../concepts/streaming-query.md), необходимое для восстановления после сбоев. {{ ydb-short-name }} периодически сохраняет чекпоинты всех запущенных потоковых запросов.

## Содержимое чекпоинта {#contents}

Чекпоинт содержит:

- текущие [смещения](../../concepts/datamodel/topic.md#consumer-offset) во входных топиках;
- [порядковые номера сообщений](../../concepts/datamodel/topic.md#seqno) в выходных топиках;
- состояния агрегаций, таких как `GROUP BY HOP`, `MATCH_RECOGNIZE` и другие.

## Восстановление после сбоя {#recovery}

При сбое запрос автоматически перезапускается и восстанавливает состояние из последнего чекпоинта. Это обеспечивает гарантию **at-least-once** — каждое событие будет обработано минимум один раз.

Сохранение и выбор чекпоинта для восстановления происходит автоматически. Для оптимизации хранилища старые чекпоинты удаляются после успешного сохранения нового.

## Отключение чекпоинтов {#disable}

Для снижения накладных расходов можно отключить сохранение чекпоинтов с помощью прагмы `ydb.DisableCheckpoints`.

{% note warning %}

При отключении чекпоинтов отсутствуют гарантии консистентности данных при пользовательских или внутренних перезапусках запроса. Используйте исключительно для отладки.

{% endnote %}

```sql
CREATE STREAMING QUERY query_without_checkpoints AS
DO BEGIN

PRAGMA ydb.DisableCheckpoints = "TRUE";

INSERT INTO
    ydb_source.output_topic
SELECT
    *
FROM
    ydb_source.input_topic

END DO
```

## См. также

- [{#T}](../../concepts/streaming-query.md).
