# Диагностика и устранение неполадок

В этом разделе описаны способы диагностики проблем с потоковыми запросами и пути их решения.

## Проверка состояния запроса {#check-status}

Для диагностики проблем с потоковым запросом используйте [системную таблицу](../system-views.md#streaming_queries):

```sql
SELECT
    Path,
    Status,
    Issues,
    Run
FROM
    `.sys/streaming_queries`
WHERE
    Path LIKE '%my_streaming_query%';
```

## Возможные статусы запроса {#statuses}

| Статус | Описание | Действие |
|--------|----------|----------|
| `CREATING` | Запрос создаётся | Подождите завершения создания. Если статус не меняется — проверьте синтаксис запроса |
| `CREATED` | Запрос создан, но не запущен | Запустите командой `ALTER STREAMING QUERY ... SET (RUN = TRUE)` |
| `STARTING` | Запрос запускается | Подождите перехода в `RUNNING` |
| `RUNNING` | Запрос выполняется | Нормальное состояние работающего запроса |
| `SUSPENDED` | Запрос приостановлен из-за ошибки | Проверьте поле `Issues`. Система автоматически попробует перезапустить |
| `STOPPING` | Запрос останавливается | Подождите перехода в `STOPPED` |
| `STOPPED` | Запрос остановлен | Для запуска используйте `ALTER STREAMING QUERY ... SET (RUN = TRUE)` |

## Частые проблемы и их решения {#common-issues}

### Запрос долго находится в статусе `CREATING` {#stuck-creating}

- Проверьте синтаксис YQL-запроса;
- убедитесь, что все указанные топики и внешние источники данных существуют;
- проверьте права доступа к объектам.

### Ошибка "Topic not found" или "External data source not found" {#not-found}

- Проверьте существование топика: ``SELECT * FROM `.sys/topics` ``;
- проверьте существование внешнего источника данных;
- убедитесь в правильности написания имён (с учётом регистра).

### Ошибка "Permission denied" {#permission-denied}

- Проверьте права доступа к топикам и внешним источникам данных;
- если используется аутентификация через секрет, убедитесь, что токен актуален.

### Запрос в статусе `RUNNING`, но данные не появляются в выходном топике {#no-output}

- Убедитесь, что во входной топик поступают данные;
- проверьте, что формат данных соответствует указанной схеме (`FORMAT` и `SCHEMA`);
- если используется фильтрация (`WHERE`), убедитесь, что есть данные, удовлетворяющие условию;
- при использовании агрегации с окнами (`HOP`) результат появится только после закрытия окна.

### Ошибка парсинга данных {#parsing-error}

- Проверьте соответствие формата данных в топике указанному `FORMAT`;
- убедитесь, что типы в `SCHEMA` соответствуют реальным данным;
- для отладки используйте ```FORMAT = raw``` и парсите данные вручную.

## См. также

- [{#T}](../../concepts/streaming-query.md);
- [{#T}](../../recipes/streaming_queries/index.md);
- [{#T}](streaming-query-formats.md).
