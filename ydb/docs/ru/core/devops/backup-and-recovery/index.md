# Резервное копирование и восстановление

{{ ydb-short-name }} изначально спроектирована для обеспечения максимальной сохранности данных при отказах оборудования. {{ ydb-short-name }} предлагает варианты избыточности для различного количества зон доступности, стоек, хостов, дисков и других компонентов. Это значительно снижает вероятность потери данных из-за аппаратных сбоев. Тем не менее, по-прежнему рекомендуется хранить дополнительную копию данных на отдельном носителе или в облачном хранилище S3.

Потеря данных может произойти не только физически, но и логически. Например, при взломе системы злоумышленники могут получить доступ к базе данных и намеренно повредить данные, используя легитимные с точки зрения БД операции (такие как команды удаления или обновления). Данные также могут быть повреждены в результате ошибок в прикладном программном обеспечении, когда часть данных обновляется некорректным алгоритмом, что потенциально может привести к значительным финансовым потерям и операционным проблемам. Во всех этих случаях наличие надежных резервных копий необходимо для восстановления данных и обеспечения непрерывности бизнеса.

{{ ydb-short-name }} предлагает несколько подходов к созданию резервных копий, которые описаны ниже.

## Методы резервного копирования {#by-storage}

#|
|| **Метод резервного копирования** | **Тип хранилища** | **Тип копии** | **Переживает отказ кластера** | **Варианты использования** ||
|| [Dump/Restore через {{ ydb-short-name }} CLI](#files) | Файловая система | Полные копии | Да | Локальная разработка, тестирование, небольшие производственные среды ||
|| [Import/Export S3 через {{ ydb-short-name }} CLI](#s3) | S3-совместимое хранилище | Полные копии | Да | Миграция больших объемов данных, архивирование, передача рабочих данных ||
|| [Коллекции резервных копий](#backup-collections) | Хранилище кластера | Полные и инкрементальные копии | Нет | Рабочие среды с регулярным расписанием резервного копирования, большие наборы данных. Доступно только в [Yandex Enterprise Database](../../downloads/yandex-enterprise-database.md) ||
|| [Резервное копирование системных таблеток](#system-tablet-backup) | Файловая система кластера | Полные и инкрементальные копии | Нет | Защита повреждения метаданных кластера ||
|#

{% note info %}

Резервные копии, хранящиеся в кластере, используют встроенную репликацию и отказоустойчивость {{ ydb-short-name }}, но не защищают от сбоев на уровне всего кластера. Для аварийного восстановления комбинируйте коллекции резервных копий в кластере с регулярным экспортом во внешнее хранилище.

{% endnote %}

## Dump/Restore через {{ ydb-short-name }} CLI {#files}

Следующие команды используются для создания резервных копий в файлы:

- `{{ ydb-cli }} admin cluster dump` — для резервного копирования метаданных кластера
- `{{ ydb-cli }} admin database dump` — для резервного копирования базы данных
- `{{ ydb-cli }} tools dump` — для резервного копирования отдельных объектов схемы или директорий

Подробнее об этих командах можно узнать в разделе [{#T}](../../reference/ydb-cli/export-import/tools-dump.md).

Следующие команды используются для восстановления из резервной копии в файлах:

- `{{ ydb-cli }} admin cluster restore` — для восстановления метаданных кластера из резервной копии
- `{{ ydb-cli }} admin database restore` — для восстановления базы данных из резервной копии
- `{{ ydb-cli }} tools restore` — для восстановления отдельных объектов схемы или директорий из резервной копии

Подробнее об этих командах можно узнать в разделе [{#T}](../../reference/ydb-cli/export-import/tools-restore.md).

## Import/Export S3 через {{ ydb-short-name }} CLI {#s3}

Команда `{{ ydb-cli }} export s3` используется для резервного копирования данных в S3-совместимое хранилище (например, [AWS S3](https://docs.aws.amazon.com/AmazonS3/latest/dev/Introduction.html)). По [этой ссылке](../../reference/ydb-cli/export-import/export-s3.md) доступна справка по {{ ydb-short-name }} CLI для этой команды.

Команда `{{ ydb-cli }} import s3` используется для восстановления данных из резервной копии, созданной в S3-совместимом хранилище. По [этой ссылке](../../reference/ydb-cli/export-import/import-s3.md) доступна справка по {{ ydb-short-name }} CLI для этой команды.

{% note info %}

Скорость операций резервного копирования и восстановления в S3-совместимое хранилище и из него настроена так, чтобы минимизировать влияние на пользовательскую нагрузку. Для управления скоростью операций настройте лимиты для соответствующей очереди в [брокере ресурсов](../../reference/configuration/resource_broker_config.md#resource-broker-config).

{% endnote %}

{% note info %}

При выполнении операции экспорта в корневой директории создается директория с именем `export_*`, где `*` — это числовая часть идентификатора экспорта. В этой директории хранятся таблицы с согласованным снимком экспортируемых данных на момент начала экспорта. После успешного завершения резервного копирования директория `export_*` и ее содержимое удаляются.

{% endnote %}

## Коллекции резервных копий {#backup-collections}

Коллекции резервных копий позволяют использовать команды [YQL](../../concepts/glossary.md#yql) `BACKUP` и `RESTORE` для выполнения полного и инкрементального резервного копирования рабочих нагрузок. Дополнительную информацию о концепциях и архитектуре см. в разделе [Коллекции резервных копий](../../concepts/datamodel/backup-collection.md), а подробные сведения о методах полного и инкрементального резервного копирования — в разделе [Полное и инкрементальное резервное копирование](./full-and-incremental-backups.md).

Коллекции резервных копий лучше всего подходят для рабочих сред, требующих регулярного резервного копирования по расписанию, больших наборов данных, где инкрементальное копирование минимизирует передачу данных, а также при необходимости восстановления на определенный момент времени (point-in-time recovery).

Для более простых сценариев, таких как разовые миграции, среды разработки или небольшие базы данных, рассмотрите возможность использования команд [export/import](#s3) или [dump/restore](#files).

## Резервное копирование системных таблеток {#system-tablet-backup}

Механизм резервного копирования системных таблеток обеспечивает инкрементальное копирование метаданных кластера на файловую систему кластера, что позволяет повысить отказоустойчивость, защищая кластер от повреждений метаданных, хранящихся в основном хранилище.

Подробная информация, включая руководство по восстановлению, доступна в разделе [{#T}](./system-tablet-backup.md).
