# Перемещение State Storage

{% cut "Статья находится в разработке" %}

{% include [new](_includes/new.md) %}

Если нужно вывести из эксплуатации узел кластера {{ ydb-short-name }}, на котором располагается часть [State Storage](../../../reference/configuration/index.md#domains-state), необходимо переместить её на другой узел.

{% include [warning-configuration-error](../configuration-v1/_includes/warning-configuration-error.md) %}

При использовании Конфигурации V2 конфигурирование State Storage осуществляется автоматически. Для внесения изменений в конфигурацию необходимо выполнить следующие действия: остановить автоматическое управление конфигурацией State Storage, получить акутальную конфигурацию State Storage, изменить актуальную конфигурацию желаемым способом и указать ее в явном виде как целевую, после чего применить ее, убедиться в примененеии, выполнить вывод узла из эксплуатации, убрать явное указание конфигурации State Storage и включить автоматическое конфигурирование State Storage.

В качестве примера рассмотрим кластер {{ ydb-short-name }} в котором узел 1 входит в состав State Storage, а узел 10 - не входит, и будем считать что цель изменения конфигурации State Storage заключается в выводе узла 1 из эксплуатации.


1. Остановить автоматическое управление конфигурацией State Storage
1. Получить акутальную конфигурацию State Storage
1. Изменить актуальную конфигурацию желаемым способом и указать ее в явном виде как целевую

    Допутсим, получена следующая конфигурациея State Storage:

    ```yaml
    ...
      state_storage:
      - ring:
          node: [1, 2, 3, 4, 5, 6, 7, 8, 9]
          nto_select: 9
        ssid: 1
    ...
    ```

    На ухле с `node_id:1` сконфигурирован и запущен [статический узел](../../../devops/configuration-management/configuration-v2/config-settings.md#hosts) кластера, который обслуживает часть State Storage. Предположим, нам нужно вывести из эксплуатации этот узел.

    Для замены `node_id:1` мы используем другой хост с развернутым на нем статическим узлом с `node_id:10`.

    Чтобы переместить State Storage с узла `node_id:1` на `node_id:10`, в конфигурационном файле `config.yaml` измените список узлов `node`, заменив идентификатор удаляемого узла на идентификатор добавляемого:

    ```yaml
    ...
      state_storage:
      - ring:
          node: [10, 2, 3, 4, 5, 6, 7, 8, 9]
          nto_select: 9
        ssid: 1
    ...
    ```

1. Применить конфигурацию
1. Убедиться в примененеии
   Учтите, что наполненприменение новых узлов State Storage после реконфигурации происходит с задержкой не менее 15 секунд.
1. Выполнить вывод узла из эксплуатации
1. Убрать явное указание конфигурации State Storage
1. Включить автоматическое конфигурирование State Storage

{% endcut %}