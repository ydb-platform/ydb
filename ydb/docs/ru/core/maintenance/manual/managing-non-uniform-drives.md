# Управление кластером с неоднородными дисками

Когда речь заходит о достаточно крупных кластерах, становится важным учитывать неоднородность используемого оборудования — в первую очередь дисков. Помимо различных типов (HDD / SSD / NVME), диски могут различаться по размеру и по производительности. Для эффективной работы кластера с неоднородными дисками в YDB предусмотрен ряд настроек, позволяющих учесть этот фактор:

* Параметр [PDisk](../../concepts/glossary.md#pdisk) `expected_slot_count` определяет количество [слотов VDisk](../../concepts/glossary.md#slot), между которыми распределяются ресурсы диска — пропускная способность и свободное место.
* Еще один параметр PDisk `slot_size_in_units` обозначает размер этих слотов в условных единицах.
* У [групп хранения](../../concepts/glossary.md#storage-group) имеется похожий параметр `GroupSizeInUnits` (числовое значение) — он определяет сколько одинарных слотов занимает каждый из VDisk'ов данной группы. Исходя из количества занимаемых слотов рассчитывается квота VDisk.
* Параметр [пула хранения](../../concepts/glossary.md#storage-pool) `DefaultGroupSizeInUnits` определяет размер группы при добавлении новых.

Соответствие размеров проверяется в момент создания VDisk, когда добавляются новые группы или в процессе [Self-heal](selfheal.md). Предпочтительным является вариант `VDisk.GroupSizeInUnits == PDisk.SlotSizeInUnits`, однако при отсутствии слотов подходящего размера они могут не совпасть.

## Изменение параметров PDisk

Настройки PDisk определяются в [конфигурации кластера](../../reference/configuration/index.md). Для их редактирования выполните следующие шаги:

1. Получите текущую конфигурацию кластера:

    ```bash
    ydb -e <endpoint> admin cluster config fetch > config.yaml
    ```

    `<endpoint>` - grpc/grpcs эндпоинт произвольного узла кластера.

2. Отредактируйте поля `expected_slot_count` и `slot_size_in_units` для нужного устройства `drive` в секции `host_configs`.

    Примерный вид секции конфигурации:

    ```yaml
    config:
    host_configs:
    - host_config_id: 1
        drive:
        - path: <path_to_device>
          type: <type>
          expected_slot_count: <number>
          slot_size_in_units: <number>
        - path: ...
    - host_config_id: 2
        ...
    ```

3. Загрузите обновленный конфигурационный файл на кластер:

    ```bash
    ydb -e endpoint admin cluster config replace -f config.yaml
    ```

4. Выполните последовательный перезапуск всех затронутых PDisk чтобы изменения вступили в силу.

## Настройка параметров групп хранения

TODO
