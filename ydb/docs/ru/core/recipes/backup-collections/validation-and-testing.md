# Проверка и тестирование резервных копий

Проверка целостности резервных копий и тестирование процедур восстановления.

## Проверка завершения резервного копирования

Убедитесь, что операции резервного копирования завершились успешно:

```bash
# Проверка успешного завершения операции резервного копирования
ydb operation list incbackup | grep -E "(COMPLETED|FAILED)"

# Проверка существования каталога резервной копии
ydb scheme ls .backups/collections/production_backups/ | tail -1
```

## Проверка экспорта во внешнее хранилище

Регулярно проверяйте, что резервные копии можно экспортировать во внешнее хранилище:

```bash
# Экспорт в S3 и проверка
ydb export s3 \
  --s3-endpoint storage.yandexcloud.net \
  --bucket my-backup-bucket \
  --item .backups/collections/production_backups/20250821141425Z_full,backups/test_export

# Проверка успешного завершения экспорта
ydb operation list export/s3

# Проверка наличия экспортированных данных в S3 (с помощью вашего S3-клиента)
# aws s3 ls s3://my-backup-bucket/backups/test_export/
```

## Тестирование восстановления резервных копий

Регулярно проверяйте, что резервные копии можно восстановить:

```bash
# Экспорт недавней резервной копии для тестирования
ydb tools dump -p .backups/collections/production_backups/backup_20240315_120000 -o /tmp/test_restore

# Тестовое восстановление во временное место (в тестовой среде)
ydb tools restore -i /tmp/test_restore -d /Root/test_restore_verification
```

## Чек-лист проверки

- [ ] Операции резервного копирования завершаются без ошибок
- [ ] Каталоги резервных копий создаются с ожидаемыми временными метками
- [ ] Экспортированные резервные копии можно успешно импортировать
- [ ] Восстановленные данные соответствуют ожидаемому содержимому
- [ ] Целостность инкрементальной цепочки сохраняется

## Рекомендуемое расписание тестирования

| Тип теста | Частота | Описание |
|-----------|---------|----------|
| Статус операций | Ежедневно | Проверка завершения запланированных резервных копий |
| Проверка экспорта | Еженедельно | Проверка экспорта во внешнее хранилище |
| Полный тест восстановления | Ежемесячно | Полное восстановление в тестовую среду |
| Учения по аварийному восстановлению | Ежеквартально | Полная симуляция аварийного восстановления |

## Следующие шаги

- [Создание первой коллекции резервных копий](getting-started.md)
- [Обслуживание и очистка резервных копий](maintenance-and-cleanup.md)
