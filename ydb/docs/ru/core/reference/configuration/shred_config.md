# Секция конфигурации shred_config

Чтобы удалённые данные были физически очищены с диска, {{ ydb-short-name }} предоставляет возможность запустить специализированную процедуру, которая удалит все следы таких данных с диска. Подробную информацию можно найти в статье по [очистке данных](../../security/shred.md). Для настройки процесса очистки данных требуется заполнить секцию `shred_config` и включить флаг `enable_shred` в файле конфигурации.

## Конфигурация очистки данных {#shred-config}

Процесс очистки запускается для всех баз кластера и его можно условно разделить на 2 этапа: очистка на уровне внутренних структур баз данных и очистка в [слое хранения](../../concepts/glossary.md#distributed-storage-implementation).

Включение флага `enable_shred`:

```yaml
feature_flags:
  enable_shred: true
```

Пример секции `shred_config`:

```yaml
shred_config:
  inflight_limit: 10
  shred_interval_seconds: 604800
  blob_storage_controller_request_interval_seconds: 600
  tenant_shred_config:
    max_rate: 1
    inflight_limit: 10
    restart_delay_seconds: 15
```

Конфигурационные параметры позволяют настроить периодичность запуска итераций очистки данных, а также регулировать интенсивность операций в рамках процессов очистки данных. Чем выше значения параметров `inflight_limit`, `tenant_shred_config.max_rate` и `tenant_shred_config.inflight_limit`, тем выше в целом нагрузка на кластер при выполнении очистки данных. Рекомендуемые значения параметров указаны в примере.
В конфигурации существует два уровня регулирования интенсивности очистки.
Параметры `shred_config.max_rate` и `shred_config.inflight_limit` регулируют интенсивность запуска очистки для баз данных и максимальное число одновременно очищаемых баз.
На втором уровне параметры `tenant_shred_config.max_rate` и `tenant_shred_config.inflight_limit` управляют интенсивностью процесса очистки в рамках каждой базы данных.

#|
|| Параметр | Описание | Единицы измерения ||
|| `inflight_limit`
| Максимальное число баз данных, для которых одновременно выполняется очистка
| Количество баз данных
    ||
|| `shred_interval_seconds`
| Интервал времени, через который должна запуститься следующая итерация очистки данных. Следующая итерация очистки будет запущена спустя `shred_interval_seconds` секунд после начала предыдущей. Если текущая итерация очистки будет длиться дольше `shred_interval_seconds`, то следующая итерация очистки данных запустится сразу после завершения текущей.
При первом старте кластера очистка запустится спустя `shred_interval_seconds` секунд.

Если значение параметра будет выставлено в `0`, то новый цикл очистки не запустится.
| Секунды
    ||
|| `blob_storage_controller_request_interval_seconds`
| Периодичность запросов к слою хранения для получения прогресса очистки. Очистка в слое хранения запускается сразу после завершения очистки внутренних структур всех баз данных кластера.
| Секунды
    ||
|| `tenant_shred_config.max_rate`
| Скорость, с которой будут запускаться очистки в таблетках одной базы данных. Очистка не запускается сразу во всех таблетках, а происходит с периодичностью `1/tenant_shred_config.max_rate` секунд. Если количество запусков достигнет `tenant_shred_config.inflight_limit`, то очистка в следующей таблетке запустится после завершения очистки в одной из уже запущенных.<br/>Например, если значение `tenant_shred_config.max_rate` равно 50, то это означает, что запуск очистки для таблеток происходит спустя 1/50 долю секунды после запуска предыдущей таблетки.<br/>Чтобы убрать ограничение по скорости запуска очистки таблеток, в параметре `tenant_shred_config.max_rate` нужно выставить значение `0`.
| Количество таблеток в секунду
    ||
|| `tenant_shred_config.inflight_limit`
| Максимальное число таблеток, для которых одновременно выполняется очистка.
| Количество таблеток
    ||
|| `tenant_shred_config.restart_delay_seconds`
| Время в секундах, после истечения которого очистка в таблетке будет перезапущена, если текущая операция завершилась ошибкой.
| Секунды
    ||
|#

### Остановка процесса очистки

Для остановки запущенного процесса очистки нужно перевести флаг `enable_shred` в значение `false`. Флаг применяется сразу же, без перезагрузки узлов кластера.
