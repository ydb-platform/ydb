# {{ ydb-short-name }} Monitoring

{{ ydb-short-name }} Monitoring представлен набором web-страниц, отображающих состояние системы в разрезе по нескольким аспектам. На страницах приведены перечни компонент и их мгновенные параметры. Для многих компонент приведен [цветовой индикатор](#colored_indicator) состояния перед названием.

## Главная страница {#main_page}

Страница доступна по адресу:

```text
http://<ендпоинт>:8765/monitoring/cluster/tenants
```

Внешний вид страницы показан на скриншоте ниже.

![Monitoring_main_page](_assets/web-ui-home.png)

В левом верхнем углу отображается название кластера и его [индикатор состояния](#colored_indicator).

Ниже представлена вкладка overview с [индикаторами](#colored_indicator) информации о состоянии кластера:

* **CPU** - загруженность процессора;
* **Storage** - загруженность хранилища;
* **Memory** - загруженность оперативной памяти;
* **Network** - загруженность сетевого подключения.

Далее следует список вкладок: 

* **[Databases](#database_list)** - список развернутых в кластере [баз данных](../../concepts/glossary.md#database);
* **[Nodes](#nodes_list)** - список рабочих [узлов кластера](../../concepts/glossary.md#node);
* **Storage** - список [групп хранения](../../concepts/glossary.md#storage-group) и их потребление места на диске;
* **[Tablets]** - список запущенных [таблеток](../../concepts/glossary.md#tablet);
* **[Versions](#versions_list)** - перечень версий, которые выполняются на узлах кластера.

### Databases {#database_list}

На вкладке отображается список развернутых баз данных с ключевыми метриками и параметрами.

![Databases_list](_assets/databases_list.png)

Сверху расположена панель: поиск по названию базы данных, переключатель режимов (**All** / **With problems**) и счётчик баз данных.

Ниже представлена таблица с параметрами базы данных, в которой приведены:

* **Database** - название базы данных. При нажатии можно перейти на вкладку страницы [Database](#databases_page);
* **Name** - название текущей базы данных;
* **Type** - тип базы данных;
* **State** - состояние базы данных;
* **CPU** - загрузка CPU узлами;
* **Memory** - потребление ОЗУ узлами тенанта(?);
* **Storage** - оценка объема данных, хранимых тенантом;
* **Network** - потребление сетевого трафика;
* **Nodes** - состояние узлов текущей базы данных в кластере;
* **Groups** - состояние групп хранения текущей базы данных в кластере;
* **Pools** - состояние пулов хранения текущей базы данных в кластере.

{% note info %}

База данных типа `Domain` обслуживает системные компоненты, необходимые для обеспечения работы всех тенантов. В нее входят все `storage` узлы и системные таблетки. База данных типа `Dedicated` выполняет обслуживание базы данных.

{% endnote %}

### Nodes {#nodes_list}

На вкладке отображается количество и состояние узлов, запущенных в кластере.

![Nodes_list](_assets/nodes_list_1.png)

Сверху находится панель с поиском по названию хоста, панель с выбором правил группировки, ниже представлен список с вкладками:

* **#** - номер узла;
* **Host** - хост, на котором располагается узел. При нажатии можно перейти на [страницу узла](#node_page);
* **Uptime** - время работы узла;
* **CPU** - загрузка CPU конкретным узлом;
* **RAM** - использование оперативной памяти конкретным узлом;
* **Version** - версия (перечень версий) на текущем узле кластера;
* **Tablets** - таблетки, работающие в данном узле

### Tablets {#tablets_list}

На вкладке отображается список всех запущенных таблеток в кластере.

![Tablets_list](_assets/tablets_list.png)

Вверху находится вкладка с поиском по **TabletID** и отображение количества таблеток на данном кластере.

Ниже представлен список:

* **Type** - тип таблетки;
* **TabletID** - ID таблетки, нажав на который, можно перейти на [страницу таблетки](#tablets_page);
* **State** - состояние таблетки;
* **NodeID** - ID узла, на котором работает таблетка;
* **NodeFQDN** -  полное доменное имя (представляет собой сетевой адрес, включающий имя хоста и домен) узла, на котором работает таблетка;
* **Generation** - [поколение](../../concepts/glossary.md#tablet-generation) таблетки;
* **Uptime** - Время работы таблетки.

### Versions {#versions_list}

Вкладка **Versions** на странице мониторинга кластера YDB показывает перечень версий YDB, которые выполняются на узлах кластера. Она позволяет отследить, какие версии задействованы в кластере и как они распределены по узлам.

![Versions_list](_assets/versions_list.png)

**Overall** - перечень всех доступных версий в кластере;
**Storage nodes** - версии, на которых располагаются узлы [распределенного хранилища](../../concepts/glossary.md#distributed-storage). На вкладке отображается общее количество узлов распределённого хранилища; при её открытии предоставляется полный список всех узлов.

Параметры узлов на текущей версии отображены в таблице с колонками:

* **#** - номер узла;
* **Host** - хост, на котором располагается узел распределенного хранилища;
* **Uptime** - время работы узла распределенного хранилища;
* **RAM** - использование оперативной памяти конкретным узлом распределенного хранилища;
* **CPU** - загрузка CPU конкретным узлом распределенного хранилища;
* **Load Average** - средняя загрузка узла распределенного хранилища за разные интервалы времени.

## Страница Databases {#databases_page}

Страница доступна по адресу:

```text
http://<ендпоинт>:
```

Внешний вид страницы:

![Database_page](_assets/database-page-query.png)

Основные блоки страницы:

### **Navigation**

В верхнем левом углу экрана указана текущая рабочая директория и размещена функция её смены.

Ниже находится вкладка **Subdomain**, под которой отображается текущая директория с опцией превью.

**Overview** - на вкладке отображаются сведения о текущем файле или директории:

* **Type** - тип базы данных;
* **ID** - номер ID файла базы данных;
* **Version** - количество версий, на которых работает база данных (??);
* **Created** - дата и время создания базы данных;

### **Query**

Вкладка **Query** содержит три подвкладки, представленные в виде отдельных секций:

* **Editor** - отображение поля, в котором создаются запросы;

![Editor](_assets/database-page-editor.png)

* **History** - история запросов;

![History](_assets/database-page-history.png)

* **Saved** - сохраненные запросы.

![Saved](_assets/database-page-saved.png)

### **Diagnostics**

На вкладке отображается комплексная информация о состоянии и производительности кластера — как на уровне всей системы, так и по отдельным базам данных.

![Database_diagnostic](_assets/database-page-diagnostics.png)

Вкладка оформлена в виде обширной таблицы, структурированной на отдельные блоки:

* **Info** - базовая информация о таблице;
* **Queries** - список запросов с информацией;
* **Top shards** - список самых загруженных шардов таблицы;
* **Nodes** - список узлов, работающих с таблицей;
* **Tablets** - список таблеток, обслуживающих таблицу;
* **Storage** - список групп хранения, работающих с таблицей; 
* **Network** - загруженность сетевого подключения;
* **Describe** - описание метаданные о сетевой папке подключения;
* **Configs**
* **Acces**
* **Operations**

## Страница Nodes {#node_page}

Страница доступна по адресу:

```text
http://<ендпоинт>:
```

Внешний вид страницы:

![Nodes_page](_assets/nodes_Page.png)

Вверху значок, что мы на кластере переключились на конкретный узел. Полное доменное имя текущего узла (FQDN). DC - зона доступности, в которой расположен узел. Ниже написано название узла.

Информация об узле предоставлена следующими блоками:

**Common info** — базовая информация об узле:

* **Version** — версия YDB;
* **Uptime** — время работы узла;
* **DC** — зона доступности в которой расположен узел;
* **Rack** — идентификатор стойки в которой располагается узел.
* **Links** - переход на....

**Pools** — потребление CPU в разбивке по внутренним пулам потоков, примерное предназначение пулов:

* **System** — задачи критически важных системных компонентов;
* **User** — пользовательские задачи, выполнение запросов таблетками;
* **Batch** — длительные фоновые задачи;
* **IO** — выполнение блокирующих операций ввода-вывода;
* **IC** — обработка сетевого взаимодействия.

Высокая загрузка пулов может быть причиной деградации производительности и увеличения времени отклика системы.

**Load average** — средняя загрузка CPU хоста за разные интервалы времени:

* 1 минута;
* 5 минут;
* 15 минут.

**endpoints** - информация о каждом отдельном эндпоинте сетевого соединения:

* **grpcs** - порт, по которому осуществляется протокол с шифрованием;
* **http-mon** - порт, по которому осуществляется протокол мониторинга доступности соединения;
* **IC** - порт, по которому осуществляется протокол мониторинга стабильной работы (хэлсчек) соединения.

Справа от блоков находится список **Roles**.

Внизу вкладки с компонентами и сведениями, относящимися к конкретно выбранному узлу.

## Страница Tablets {#tablets_page}

Многие компоненты {{ ydb-short-name }} выполнены в виде таблеток. Система может перемещать таблетки между узлами. На любом из узлов может выполняться некоторое количество таблеток.

Страница доступна по адресу:

```text
http://<ендпоинт>:
```

Внешний вид страницы:

![Tablet_page](_assets/tablet_page.png)

Вверху написан ID таблетки.

Кнопочка Restart - перезапустить таблетку.

Таблица **Info** - информация о таблетке:

* **State** - состояние таблетки;
* **Uptime** - время работы таблетки с момента текущего запуска;
* **Generation** - поколение (номер текущей попытки запуска) таблетки;
* **Node** - номер/количество узлов, на которых работает таблетка.

Справа ссылки **Links**:

* App (на [Hive-web-viewer] (ссылка на раздел))
* Counters
* Executor DB internals
* State storage

И внизу табличка для конкретной таблетки с такими столбцами:

* **Generation** - поколение (номер текущей попытки запуска) таблетки,
* **change time** - время, когда была изменена таблетка;
* **state** - состояние таблетки;
* **tablet** - ID таблетки,
* **node ID** - ID узла, на котором работает таблетка,
* **Node FQDN** - Время работы таблетки.

## Индикаторы состояний {#colored_indicator}

Слева от названия конкретного компонента может находится цветовой индикатор его состояния.

Цвета индикаторов имеют следующее значение:

* **Зеленый** — проблем нет, компонент работает в штатном режиме;
* **Синий** — происходит репликация данных, других проблем нет;
* **Желтый** — возможны проблемы, компонент продолжает работать;
* **Красный** — имеются критические проблемы, компонент не работает или работает с ограничениями.

Если компонент включает в себя другие компоненты, то в случае отсутствия собственных проблем, его состояние определяется путем агрегирования состояний его частей.
