# Соединение CLI с базой данных и аутентификация

Большинство команд {{ ydb-short-name }} CLI относится к операциям над базой данных {{ ydb-short-name }} и требует соединения с ней для исполнения.

{{ ydb-short-name }} CLI определяет, с какой БД необходимо соединиться и какой [режим аутентификации](../../../concepts/auth.md) использовать из следующих источников (в порядке убывания приоритета):

1. Командной строки
2. Профиля, выбранного опцией командной строки `--profile`
3. Переменных окружения
4. Активированного профиля

Для того чтобы {{ ydb-short-name }} CLI попробовал соединиться с БД, в результате исполнения данных шагов должен быть определен [эндпоинт](../../../concepts/connect.md#endpoint) и [путь базы данных](../../../concepts/connect.md#database).

Если все шаги пройдены, но {{ ydb-short-name }} CLI не определил режим аутентификации, то запросы будут отправляться на сервер {{ ydb-short-name }} без добавления аутентификационных данных. Это может позволить успешно работать с локально развернутыми кластерами {{ ydb-short-name }}, не требующими аутентификации. Для всех доступных по сети баз данных такие запросы будут отклонены сервером с выдачей ошибки аутентификации.

О возможных ситуациях, когда {{ ydb-short-name }} CLI не будет пытаться соединиться с БД, читайте ниже в секции [Сообщения об ошибках](#errors).

## Параметры командной строки {#command-line-pars}

Опции соединения c БД в командной строке указываются перед определением команды и её параметров:

``` bash
{{ ydb-cli }} <опции_соединения> <команда> <опции_команды>
```

- `-e, --endpoint <endpoint>` — [эндпоинт](../../../concepts/connect.md#endpoint) - основной параметр соединения, позволяющий найти сервер {{ ydb-short-name }} в сети. Если порт не указан, применяется 2135. Если протокол не указан, то в публичных сборках {{ ydb-short-name }} CLI применяется gRPCs (с шифрованием).
- `-d, --database <database>` — [путь базы данных](../../../concepts/connect.md#database).

{% include [auth/options.md](auth/options.md) %}

## Параметры из профиля, выбранного опцией командной строки {#profile}

Если в командной строке при вызове {{ ydb-short-name }} CLI не указан какой-либо параметр соединения, то CLI производит попытку его определения по [профилю](../profile/index.md), выбранному опцией командной строки `--profile`.

В профиле может быть определено большинство переменных, аналогичных опциям из раздела [параметры командной строки](#command-line-pars). Обработка их значений производится также как и параметров командной строки. 

## Параметры из переменных окружения {#env}

Если в командной строке не был явно указан профиль или в нём не заданы отвечающие за аутентификацию параметры, то {{ ydb-short-name }} CLI пытается определить режим и параметры аутентификации по окружению {{ ydb-short-name }} CLI по следующему алгоритму:

{% include [env.md](auth/env.md) %}

## Параметры из активированного профиля {#activated-profile}

Если на предыдущих шагах не удалось определить какой-либо параметр соединения и в командной строке не был явно указан профиль опцией `--profile`, то {{ ydb-short-name }} CLI пробует использовать параметры соединения из [активированного профиля](../profile/activate.md).

## Сообщения об ошибках {#errors}

### Ошибки до попытки установки соединения с БД

Если все шаги из приведенных в начале данной статьи пройдены, но не удалось определить [эндпоинт](../../../concepts/connect.md#endpoint), то выполнение команды будет прервано с выдачей сообщения `Missing required option 'endpoint'`.

Если все шаги из приведенных в начале данной статьи пройдены, но не удалось определить [путь базы данных](../../../concepts/connect.md#database), то выполнение команды будет прервано с выдачей сообщения `Missing required option 'database'`.

Если режим аутентификации определить удалось, но не удалось определить необходимые дополнительные параметры, то выполнение команды будет прервано с выдачей сообщения, описывающего проблему:

- `(No such file or directory) util/system/file.cpp:857: can't open "<filepath>" with mode RdOnly|Seq (0x00000028)` -- не удалось открыть на чтение файл `<filepath>`, указанный в одном из параметров, где передается имя файла с путем

## Дополнительные параметры {#additional}

При использовании протокола gRPCs (с шифрованием) может потребоваться [выбор корневого сертификата](../../../concepts/connect.md#tls-cert):

- `--ca-file <filepath>` : Файл корневого PEM-сертификата для TLS-соединения

В настоящее время корневой сертификат не сохраняется в профиле, и может быть определен только опцией командной строки.

## Проверка аутентификации {#whoami}

Сервисная команда {{ ydb-short-name }} CLI [`discovery whoami`](../commands/discovery-whoami.md) позволяет проверить, под какой учетной записью вы фактически аутентифицировались на сервере.
