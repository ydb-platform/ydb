# Выгрузка в файловую систему

## Кластер

Команда `admin сluster dump` выгружает в клиентскую файловую систему информацию о кластере, в описанном в статье [Файловая структура](../file-structure.md) формате:

```bash
{{ ydb-cli }} [connection options] admin cluster dump [options]
```

{% include [conn_options_ref.md](../../commands/_includes/conn_options_ref.md) %}

`[options]` - параметры команды:

`-o PATH` или `--output PATH`: Путь к директории в клиентской файловой системе, куда должна быть сделана выгрузка. Если указанная директория не существует, то она будет создана, однако весь путь до неё должен существовать. Если указанная директория существует, то она должна быть пуста. Если параметр не указан, то в текущей директории будет создана директория с именем в формате `backup_YYYYDDMMTHHMMSS`, где YYYYDDMM - дата, а HHMMSS - время начала выгрузки.

[Конфигурация кластера](../../../../maintenance/manual/config-overview.md) выгружается отдельно с помощью команды `{{ ydb-cli }} admin cluster config fetch`.

## База данных

Команда `admin database dump` выгружает в клиентскую файловую систему данные и информацию о базе данных, в описанном в статье [Файловая структура](../file-structure.md) формате:

```bash
{{ ydb-cli }} [connection options] admin database dump [options]
```

{% include [conn_options_ref.md](../../commands/_includes/conn_options_ref.md) %}

`[options]` - параметры команды:

`-o PATH` или `--output PATH`: Путь к директории в клиентской файловой системе, куда должна быть сделана выгрузка. Если указанная директория не существует, то она будет создана, однако весь путь до неё должен существовать. Если указанная директория существует, то она должна быть пуста. Если параметр не указан, то в текущей директории будет создана директория с именем в формате `backup_YYYYDDMMTHHMMSS`, где YYYYDDMM - дата, а HHMMSS - время начала выгрузки.

[Конфигурация базы данных](../../../../maintenance/manual/config-overview.md) выгружается отдельно с помощью команды `{{ ydb-cli }} admin database config fetch`.

## Объекты схемы данных

Команда `tools dump` выгружает в клиентскую файловую систему данные и информацию об объектах схемы данных, в описанном в статье [Файловая структура](../file-structure.md) формате:

```bash
{{ ydb-cli }} [connection options] tools dump [options]
```

{% include [conn_options_ref.md](../../commands/_includes/conn_options_ref.md) %}

`[options]` - параметры команды:

`-p PATH` или `--path PATH`: Путь к директории в базе данных, объекты внутри которой должны быть выгружены, либо путь к таблице. По умолчанию -- корневая директория базы данных. В выгрузку будут включены все поддиректории, имена которых не начинаются с точки, и таблицы внутри них, имена которых не начинаются с точки. Для выгрузки таких таблиц или содержимого таких директорий можно явно указать их имена в данном параметре.

`-o PATH` или `--output PATH`: Путь к директории в клиентской файловой системе, куда должна быть сделана выгрузка. Если указанная директория не существует, то она будет создана, однако весь путь до неё должен существовать. Если указанная директория существует, то она должна быть пуста. Если параметр не указан, то в текущей директории будет создана директория с именем в формате `backup_YYYYDDMMTHHMMSS`, где YYYYDDMM - дата, а HHMMSS - время начала выгрузки.

`--exclude STRING`: Шаблон ([PCRE](https://www.pcre.org/original/doc/html/pcrepattern.html)) для исключения путей из выгрузки. Данный параметр может быть указан несколько раз, для разных шаблонов.

`--scheme-only`: Выгружать только информацию об объектах схемы данных, без выгрузки данных

`--consistency-level VAL`: Уровень консистентности. Возможные варианты:

- `database` - Полностью консистентная выгрузка, со снятием одного снапшота перед началом выгрузки. Применяется по умолчанию.
- `table` - Консистентность в пределах каждой выгружаемой таблицы, со снятием отдельных независимых снапшотов для каждой выгружаемой таблицы. Может работать быстрее и оказывать меньшее влияние на обработку текущей нагрузки на базу данных.

`--avoid-copy`: Не применять создание снапшота для выгрузки. Применяемый по умолчанию для обеспечения консистентности снапшот может быть неприменим для некоторых случаев (например, для таблиц со внешними блобами).{% if feature_serial %} Для корректной выгрузки таблиц с [серийными](../../../../yql/reference/types/serial.md) типами требуется не выставлять этот параметр. Иначе актуальное значение генератора последовательности не будет скопировано, и новые значения будут выдаваться со стартового значения, что может привести к конфликтам по первичному ключу.{% endif %}

`--save-partial-result`: Не удалять результат частично выполненной выгрузки. Без включения данной опции результат выгрузки будет удален, если в процессе её выполнения произойдет ошибка.

`--preserve-pool-kinds`: Если эта опция активна, в дамп будут сохранены имена типов устройств хранения, заданные для групп колонок таблиц (см. параметр `DATA` в статье [Группы колонок](https://ydb.tech/docs/ru/yql/reference/syntax/create_table/family)). Если при восстановлении данных в базе не окажется [пулов хранения](https://ydb.tech/docs/ru/concepts/glossary#storage-poolhttps://ydb.tech/docs/ru/concepts/glossary#storage-pool) с указанными именами, восстановление завершится ошибкой. По умолчанию данная опция деактивирована и при восстановлении используется пул хранения, заданный для базы данных при ее создании (см. [Создание базы данных](https://ydb.tech/docs/ru/devops/manual/initial-deployment#create-db)).

`--ordered`: Строки в выгруженных таблицах будут отсортированы по первичному ключу.

## Примеры

{% include [ydb-cli-profile.md](../../../../_includes/ydb-cli-profile.md) %}

### Выгрузка кластера

С автоматическим созданием директории `backup_...` в текущей директории:

```bash
{{ ydb-cli }} -e <endpoint> admin cluster dump
```

В заданную директорию:

```bash
{{ ydb-cli }} -e <endpoint> admin cluster dump -o ~/backup_cluster
```

### Выгрузка базы данных

С автоматическим созданием директории `backup_...` в текущей директории:

```bash
{{ ydb-cli }} -e <endpoint> -d <database> admin database dump
```

В заданную директорию:

```bash
{{ ydb-cli }} -e <endpoint> -d <database> admin database dump -o ~/backup_db
```

### Выгрузка объектов схемы данных базы данных

С автоматическим созданием директории `backup_...` в текущей директории:

```bash
{{ ydb-cli }} --profile quickstart tools dump
```

В заданную директорию:

```bash
{{ ydb-cli }} --profile quickstart tools dump -o ~/backup_quickstart
```

### Выгрузка структуры таблиц в заданной директории базы данных и её поддиректориях

```bash
{{ ydb-cli }} --profile quickstart tools dump -p dir1 --scheme-only
```


