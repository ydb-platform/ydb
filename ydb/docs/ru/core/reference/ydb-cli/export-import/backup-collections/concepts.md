# Концепции коллекций резервных копий

В этом разделе объясняется, как работают коллекции резервных копий, какие типы резервных копий доступны и какие варианты хранения можно использовать.

## Как работают коллекции резервных копий {#how-backup-collections-work}

Коллекция резервных копий — это именованный набор резервных копий для выбранных таблиц, который поддерживает хронологическую цепочку снимков данных. Каждая коллекция содержит:

- **Цепочку резервных копий**: Одну полную резервную копию, за которой следуют ноль или более инкрементальных резервных копий.
- **Настройки хранения**: Параметры конфигурации, определяющие вариант хранения резервных копий.
- **Сопоставление таблиц**: Определения, указывающие, какие таблицы входят в коллекцию.

Цепочка резервных копий позволяет восстанавливать данные на любой момент времени, применяя полную резервную копию и последующие инкрементальные резервные копии до желаемой точки восстановления.

## Типы резервных копий

### Полные резервные копии

Полная резервная копия содержит полный снимок всех данных в коллекции на определенный момент времени. Ключевые характеристики:

- **Полный захват данных**: Содержит все строки из всех таблиц в коллекции.
- **Самодостаточность**: Может быть восстановлена независимо без других резервных копий.
- **Основа для цепочек**: Служит базой для последующих инкрементальных резервных копий.
- **Требует больше места**: Требует больше места для хранения, но быстрее восстанавливается.

**Когда использовать полные резервные копии:**

- Создание начальной резервной копии.
- После значительных изменений данных.
- Для сброса цепочек резервных копий и уменьшения времени восстановления.
- Для создания критических контрольных точек.

### Инкрементальные резервные копии

Инкрементальные резервные копии захватывают только изменения, сделанные с момента предыдущей резервной копии в цепочке. Ключевые характеристики:

- **На основе изменений**: Записывают вставки, обновления и удаления с момента последней резервной копии.
- **Эффективность хранения**: Требуют минимальное место для хранения при типичных нагрузках.
- **Зависимость от цепочки**: Требуют полную резервную копию и все предыдущие инкрементальные резервные копии для восстановления.
- **Быстрое выполнение**: Завершаются быстро при типичных объемах изменений.

**Когда использовать инкрементальные резервные копии:**

- Для регулярных запланированных резервных копий (ежедневно, ежечасно).
- Когда важна эффективность хранения.
- Для захвата частых изменений с минимальными накладными расходами.

См. [Руководство по операциям](operations.md#taking-backups) для подробных рекомендаций.

## Варианты хранения

### Кластерное хранение

Хранит резервные копии внутри самого кластера YDB (текущая реализация).

```sql
WITH ( STORAGE = 'cluster' )
```

Для внешнего хранения (файловая система, S3) используйте [операции экспорта/импорта](operations.md#restore-operations).

## Цепочки резервных копий и целостность

### Структура цепочки

Цепочка резервных копий состоит из:

1. **Одной полной резервной копии** (основа цепочки)
2. **Нуля или более инкрементальных резервных копий** (применяются в хронологическом порядке)

### Правила целостности цепочки

{% note alert %}

Никогда не удаляйте полные резервные копии, от которых зависят инкрементальные резервные копии. Удаление полной резервной копии нарушает всю цепочку, делая все последующие инкрементальные копии невосстанавливаемыми.

{% endnote %}

**Лучшие практики:**

- Применяйте политики хранения осторожно, чтобы сохранить целостность цепочки.
- Проверяйте цепочки резервных копий периодически перед критическими операциями.
- Соблюдайте хронологический порядок при применении резервных копий во время восстановления.

### Рекомендации по максимальной длине цепочки (TBD)

- **Ежедневные инкрементальные копии**: Ограничьте цепочки 7-14 инкрементальными резервными копиями
- **Ежечасные инкрементальные копии**: Ограничьте цепочки 24-48 инкрементальными резервными копиями
- **Высокочастотные резервные копии**: Рассмотрите синтетические полные резервные копии для сброса цепочек

## Ограничения и требования

### Текущие ограничения

- Кластерное хранилище является основным бэкендом; файловая система и S3 требуют операций экспорта/импорта.
- Порядок цепочки должен соблюдаться - нельзя пропускать или изменять порядок резервных копий при восстановлении.

## Следующие шаги

- [Узнайте, как создавать коллекции и управлять ими](operations.md).
- [Изучите полный SQL API](sql-api.md).
