# Концепции коллекций резервных копий

В этом разделе объясняются операционные детали о коллекциях резервных копий, вариантах хранения и управлении цепочками. Для архитектурного обзора и основных концепций см. [Коллекции резервных копий](../../../../concepts/backup/collections.md).

## Проверка и целостность цепочки резервных копий {#backup-chains-integrity}

При работе с коллекциями резервных копий понимание зависимостей цепочки критично для успешных операций:

### Правила валидности цепочки {#chain-validity-rules}

- **Последовательная зависимость**: Каждая инкрементальная резервная копия зависит от всех предыдущих резервных копий в цепочке.
- **Ограничения на удаление**: Удаление любой резервной копии в середине цепочки нарушает цепочку для последующих резервных копий.
- **Требования восстановления**: Для восстановления из инкрементальной резервной копии нужна полная резервная копия плюс все предшествующие инкрементальные резервные копии.

### Лучшие практики управления цепочкой

- **Контролируйте длину цепочки**: Держите цепочки резервных копий разумно короткими (рекомендуется 7-14 инкрементальных резервных копий).
- **Планируйте retention аккуратно**: Всегда учитывайте зависимости цепочки при очистке старых резервных копий.
- **Проверяйте перед удалением**: Используйте просмотр схемы для понимания структуры резервных копий перед удалением.
- Для создания критических контрольных точек.

### Инкрементальные резервные копии

Инкрементальные резервные копии захватывают только изменения, сделанные с момента предыдущей резервной копии в цепочке. Ключевые характеристики:

- **На основе изменений**: Записывают вставки, обновления и удаления с момента последней резервной копии.
- **Эффективность хранения**: Требуют минимальное место для хранения при типичных нагрузках.
- **Зависимость от цепочки**: Требуют полную резервную копию и все предыдущие инкрементальные резервные копии для восстановления.
- **Быстрое выполнение**: Завершаются быстро при типичных объемах изменений.

**Когда использовать инкрементальные резервные копии:**

- Для регулярных запланированных резервных копий (ежедневно, ежечасно).
- Когда важна эффективность хранения.
- Для захвата частых изменений с минимальными накладными расходами.

См. [Руководство по операциям](operations.md#taking-backups) для подробных рекомендаций.

## Варианты хранения

### Кластерное хранение

Хранит резервные копии внутри самого кластера YDB (текущая реализация).

```sql
WITH ( STORAGE = 'cluster' )
```

Для внешнего хранения (файловая система, S3) используйте [операции экспорта/импорта](operations.md#restore-operations).

## Цепочки резервных копий и целостность

### Структура цепочки

Цепочка резервных копий состоит из:

1. **Одной полной резервной копии** (основа цепочки)
2. **Нуля или более инкрементальных резервных копий** (применяются в хронологическом порядке)

### Правила целостности цепочки

{% note alert %}

Никогда не удаляйте полные резервные копии, от которых зависят инкрементальные резервные копии. Удаление полной резервной копии нарушает всю цепочку, делая все последующие инкрементальные копии невосстанавливаемыми.

{% endnote %}

**Лучшие практики:**

- Применяйте политики хранения осторожно, чтобы сохранить целостность цепочки.
- Проверяйте цепочки резервных копий периодически перед критическими операциями.
- Соблюдайте хронологический порядок при применении резервных копий во время восстановления.

### Рекомендации по максимальной длине цепочки (TBD)

- **Ежедневные инкрементальные копии**: Ограничьте цепочки 7-14 инкрементальными резервными копиями
- **Ежечасные инкрементальные копии**: Ограничьте цепочки 24-48 инкрементальными резервными копиями
- **Высокочастотные резервные копии**: Рассмотрите синтетические полные резервные копии для сброса цепочек

## Ограничения и требования

### Текущие ограничения

- Кластерное хранилище является основным бэкендом; файловая система и S3 требуют операций экспорта/импорта.
- Порядок цепочки должен соблюдаться - нельзя пропускать или изменять порядок резервных копий при восстановлении.

## Следующие шаги

- [Узнайте, как создавать коллекции и управлять ими](operations.md).
- [Изучите полный SQL API](sql-api.md).
