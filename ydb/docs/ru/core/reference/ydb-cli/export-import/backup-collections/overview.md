# Коллекции резервных копий - обзор

Коллекции резервных копий позволяют организовать полные и инкрементальные резервные копии для набора таблиц. Эта функциональность особенно полезна для больших баз данных, где полное резервное копирование занимает много времени и ресурсов.

## Быстрый старт

### Шаг 1: Создание коллекции

```sql
CREATE BACKUP COLLECTION `shop_backups`
    ( TABLE `/Root/database/orders`
    , TABLE `/Root/database/products`
    )
WITH
    ( STORAGE = 'cluster'
    );
```

### Шаг 2: Создание полного бэкапа

```sql
BACKUP `shop_backups`;
```

### Шаг 3: Создание инкрементального бэкапа

После изменений в данных:

```sql
BACKUP `shop_backups` INCREMENTAL;
```

### Шаг 4: Мониторинг операций

```bash
# Проверить статус операций резервного копирования
{{ ydb-cli }} operation list incbackup

# Получить детали конкретной операции
{{ ydb-cli }} operation get "ydb://incbackup/N?id=<operation-id>"
```

### Шаг 5: Экспорт для долгосрочного хранения

```bash
# Экспортировать коллекцию в файловую систему
ydb tools dump -p .backups/collections/shop_backups -o backup_export
```

## Основные концепции

### Коллекция резервных копий

Именованный набор таблиц, для которых создаются связанные резервные копии. Все бэкапы в коллекции логически связаны и образуют цепочку.

### Полная резервная копия

Базовый снимок всех данных в таблицах коллекции на момент создания. Служит отправной точкой для последующих инкрементальных бэкапов.

### Инкрементальная резервная копия

Содержит только изменения данных с момента создания предыдущего бэкапа в цепочке. Значительно быстрее и занимает меньше места.

### Цепочка бэкапов

Упорядоченная последовательность: полная резервная копия → инкрементальные резервные копии. Для восстановления данных необходимы все бэкапы в цепочке от полного до нужного момента времени.

## Рабочий процесс

1. **Планирование**: Определите таблицы для включения в коллекцию
2. **Создание коллекции**: Используйте `CREATE BACKUP COLLECTION`
3. **Первичный полный бэкап**: Создайте базовую точку с `BACKUP collection_name`
4. **Регулярные инкрементальные бэкапы**: Используйте `BACKUP collection_name INCREMENTAL`
5. **Мониторинг**: Отслеживайте операции через `operation list`
6. **Экспорт**: Периодически экспортируйте для долгосрочного хранения
7. **Очистка**: Удаляйте завершенные операции с `operation forget`

## Преимущества

- **Экономия времени**: Инкрементальные бэкапы создаются гораздо быстрее полных
- **Экономия места**: Хранятся только изменения, а не полные копии данных
- **Восстановление на момент времени**: Возможность восстановления на любой момент между бэкапами
- **Организация**: Логическое группирование связанных таблиц
- **Мониторинг**: Полная видимость статуса операций через API

## Ограничения

- Для восстановления нужна полная цепочка от базового до целевого бэкапа
- Максимальная длина цепочки: 100 инкрементальных бэкапов
- Нельзя удалять промежуточные бэкапы в цепочке без нарушения целостности

## Следующие шаги

- [SQL API](sql-api.md) - Полный справочник SQL команд
- [Создание коллекций](create-collection.md) - Детальное руководство
- [Инкрементальные бэкапы](incremental-backups.md) - Работа с инкрементальными копиями
- [Восстановление](restore-from-collection.md) - Процедуры восстановления
- [Управление операциями](manage-collections.md) - Мониторинг и управление
