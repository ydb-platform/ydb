# Устранение неполадок

Руководство по решению типичных проблем при работе с коллекциями резервных копий.

## Типичные ошибки

### Ошибка: "Backup collection already exists"

**Проблема**: Попытка создать коллекцию с уже существующим именем.

```text
Error: Backup collection 'my_collection' already exists
```

**Решение**:

1. Используйте другое имя коллекции
2. Или удалите существующую коллекцию (если это безопасно)

### Ошибка: "Table not found"

**Проблема**: Указанная в коллекции таблица не существует.

```text
Error: Table '/Root/database/nonexistent_table' not found
```

**Решение**:

1. Проверьте правильность пути к таблице
2. Убедитесь, что таблица существует: `SELECT * FROM .sys/tables WHERE path LIKE '%table_name%'`

### Ошибка: "No base backup found"

**Проблема**: Попытка создать инкрементальный бэкап без базового полного.

**Решение**:

1. Сначала создайте полный бэкап: `BACKUP 'collection_name';`
2. Затем создавайте инкрементальные: `BACKUP 'collection_name' INCREMENTAL;`

## Проблемы с операциями

### Операция "зависла"

**Симптомы**: Операция долго не завершается

**Диагностика**:

```bash
# Проверить статус операции
{{ ydb-cli }} operation get "ydb://incbackup/N?id=<operation-id>"
```

**Решение**:

1. Подождать дополнительное время (операции могут занимать часы)
2. Проверить логи YDB сервера
3. При необходимости обратиться к администратору

### Ошибка доступа

**Проблема**: Недостаточно прав для операций с бэкапами

```text
Error: Access denied for backup operation
```

**Решение**:

1. Убедитесь, что у пользователя есть права на создание бэкапов
2. Проверьте настройки профиля YDB CLI

## Проблемы с восстановлением

### Ошибка при импорте

**Проблема**: Не удается восстановить данные из экспортированных файлов

**Диагностика**:

```bash
# Проверить структуру экспорта
ls -la exported_backup/
find exported_backup/ -name "*.json" -exec cat {} \;
```

**Решение**:

1. Проверить целостность экспортированных файлов
2. Убедиться в правильности путей при восстановлении
3. Проверить права доступа к файлам

## Проблемы с производительностью

### Медленное создание бэкапов

**Возможные причины**:

1. Большой объем данных
2. Высокая нагрузка на систему
3. Проблемы с дисковой подсистемой

**Решения**:

1. Планировать бэкапы на периоды низкой нагрузки
2. Использовать инкрементальные бэкапы чаще
3. Мониторить использование ресурсов

### Превышение лимитов

**Ошибка**: Операция превышает максимальные лимиты

**Решение**:

1. Разбить большие коллекции на меньшие
2. Увеличить лимиты в конфигурации (обратиться к администратору)

## Диагностические команды

### Проверка состояния системы

```bash
# Общая информация о кластере
{{ ydb-cli }} discovery whoami

# Список активных операций
{{ ydb-cli }} operation list incbackup
{{ ydb-cli }} operation list restore

# Проверка профилей
{{ ydb-cli }} config profile list
```

### Сбор информации для поддержки

```bash
#!/bin/bash
# collect_diagnostic_info.sh

echo "=== Диагностическая информация YDB Backup ==="
echo "Дата: $(date)"
echo ""

echo "--- Профили ---"
{{ ydb-cli }} config profile list
echo ""

echo "--- Активные операции резервного копирования ---"
{{ ydb-cli }} operation list incbackup --format pretty
echo ""

echo "--- Активные операции восстановления ---"
{{ ydb-cli }} operation list restore --format pretty
echo ""

echo "--- Информация о соединении ---"
{{ ydb-cli }} discovery whoami
```

## Получение помощи

1. **Документация**: Проверьте другие разделы документации
2. **Логи**: Изучите логи YDB сервера и CLI
3. **Сообщество**: Обратитесь к сообществу YDB
4. **Техническая поддержка**: При критических проблемах

## См. также

- [Создание коллекций](create-collection.md) - Правильная настройка коллекций
- [Управление операциями](manage-collections.md) - Мониторинг и управление
- [Совместимость](compatibility.md) - Проблемы совместимости версий
- [Продвинутые сценарии](advanced.md) - Автоматизация и мониторинг
