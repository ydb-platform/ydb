# TPC-DS нагрузка

Нагрузка базируется на документе TPC-DS [документация](https://www.tpc.org/TPC_Documents_Current_Versions/pdf/TPC-DS_v3.2.0.pdf), а запросы и схемы таблиц адаптированы под {{ ydb-short-name }}.

Тест генерирует типичную рабочую нагрузку в области помощи в принятии решений.

## Общие параметры команд

Все команды поддерживают общий параметр `--path`, который задает путь к каталогу с таблицами в базе данных:

```bash
{{ ydb-cli }}  workload tpcds --path tpcds/s1 ...
```

### Доступные параметры { #common_options }

| Имя               | Описание                     | Значение по умолчанию |
|-------------------|------------------------------|-----------------------|
| `--path` или `-p` | Путь к каталогу с таблицами. | `/`                   |

## Инициализация нагрузочного теста {#init}

Перед запуском теста создайте таблицу:

```bash
{{ ydb-cli }} workload tpcds --path tpcds/s1 init
```

Посмотрите описание команды для запуска нагрузки:

```bash
{{ ydb-cli }} workload tpcds init --help
```

{% include [init_options](./_includes/workload/init_options_tpc.md) %}

## Загрузка данных в таблицу { #load }

Загрузите данные в таблицу. Данные будут сгенерированы непосредственно {{ ydb-cli }}:

```bash
{{ ydb-cli }} workload tpcds --path tpcds/s1 import generator --scale 1
```

Посмотрите описание команды для загрузки данных:

```bash
{{ ydb-cli }} workload tpcds import --help
```

### Доступные параметры {#load_files_options}

| Имя                                               | Описание                                                                                                                                       | Значение по умолчанию |
|---------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
| `--scale <значение>`                              | Масштаб данных. Обычно используются степени десяти. Поддерживается и дробный масштаб, хотя он и не описан в спецификации TPC-DS.                                                                                            |                       |
| `--tables <значение>`                             | Список таблиц для генерации, разделенный запятыми. Доступные таблицы: `customer`, `nation`, `order_line`, `part_psupp`, `region`, `supplier`.  | Все таблицы           |
| `--proccess-count <значение>` или `-C <значение>` | Генерация данных может быть на разбита на несколько процессов, этот параметр задает количество процессов.                                      | 1                     |
| `--proccess-index <значение>` или `-i <значение>` | Генерация данных может быть на разбита на несколько процессов, этот параметр задает номер процесса.                                            | 0.                    |
| `--state <путь>`                                  | Путь к файлу состояния загрузки. Если загрузка была прервана по какой-то причине, при новом запуске загрузка будет продолжена с того же места. |                       |
| `--clear-state`                                   | Актуально, если задан параметр `--state`. Очистить файл состояния и начать загрузку сначала.                                                   |                       |
| `--dry-run`                                       | Не выполнять загрузку данных в базу данных, только подготовить данные и вывести об этом сообщение.                                             |                       |

{% include [load_options](./_includes/workload/load_options.md) %}

## Запуск нагрузочного теста { #run }

Запустите нагрузку:

```bash
{{ ydb-cli }} workload tpcds --path tpcds/s1 run
```

В течение теста на экран выводится статистика по нагрузке для каждого запроса.

Посмотрите описание команды для запуска нагрузки:

```bash
{{ ydb-cli }} workload tpcds run --help
```

{% include [run_options](./_includes/workload/run_options.md) %}

### Опции, специфичные для TPC-DS { #run_tpcds_options }

| Имя                       | Описание                                                                                                                                                                                                                                                                                                                                                             | Значение по умолчанию |
|---------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
| `--syntax <значение>`     | Какой вариант синтаксиса запросов использовать: `yql` или `pg` (сокращение от `PostgreSQL`). Про работу с синтаксисом YQL можно прочитать в [здесь](../../yql/reference/index.md), а про PostgreSQL [здесь](../../postgresql/intro.md).                                                                                                                                                     | `yql`                  |
| `--float_mode <значение>` | Режим работы с числами с плавающей точкой. Может быть `float`, `decimal` или `decimal_ydb`. Если установлено значение `float`, будет использоваться тип float; `decimal` означает использование Decimal с каноническим размером, указанным в спецификации TPC-DS (различается для разных полей и таблиц, см. спецификацию); `decimal_ydb` означает преобразование всех float в Decimal(22, 9). Подробнее про тип Decimal см. в [документации](../../yql/reference/types/primitive.md#numeric). | `float`                |
| `--scale <значение>`      | Scale factor. См. спецификацию TPC-DS, глава 3. Поддерживаются и дробные значения, хотя это и не описано в спецификации TPC-DS. Для масштабов `1`, `10`, `100`, `1000` заданы каноичные ответы (см. описание опции `--check-canonical`).                                                                                                                                                                        | 1                      |

## Очистка данных теста { #cleanup }

Запустите очистку:

```bash
{{ ydb-cli }} workload tpcds --path tpcds/s1 clean
```

Команда не имеет параметров.
