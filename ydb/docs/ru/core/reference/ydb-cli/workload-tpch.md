# TPC-H нагрузка

Нагрузка базируется на документе TPC-H [документация](https://www.tpc.org/tpc_documents_current_versions/pdf/tpc-h_v2.17.1.pdf), а запросы и схемы таблиц адаптированы под {{ ydb-short-name }}.

Тест генерирует типичную рабочую нагрузку в области помощи в принятии решений.

## Общие параметры команд

Все команды поддерживают общий параметр `--path`, который задает путь к каталогу с таблицами в базе данных:

```bash
{{ ydb-cli }}  workload tpch --path tpch/s1 ...
```

### Доступные параметры {#common_options}

| Имя                | Описание                     | Значение по умолчанию  |
|--------------------|------------------------------|------------------------|
|  `--path` или `-p` | Путь к каталогу с таблицами. | `/`                    |

## Инициализация нагрузочного теста { #init }

Перед запуском теста создайте таблицу:

```bash
{{ ydb-cli }} workload tpch --path tpch/s1 init
```

Посмотрите описание команды для инициализации табилц:

```bash
{{ ydb-cli }} workload tpch init --help
```

{% include [init_options](./_includes/workload/init_options_tpc.md) %}

## Загрузка данных в таблицу { #load }

Загрузите данные в таблицу. Данные будут сгенерированы непосредственно {{ ydb-cli }}:

```bash
{{ ydb-cli }} workload tpch --path tpch/s1 import generator --scale 1
```

Посмотрите описание команды для загрузки данных:

```bash
{{ ydb-cli }} workload tpch import --help
```

### Доступные параметры { #load_files_options }

| Имя                                               | Описание                                                                                                                                       | Значение по умолчанию |
|---------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
| `--scale <значение>`                              | Масштаб данных. Обычно используются степени десяти. Поддерживается и дробный масштаб, хотя он и не описан в спецификации TPC-H.                |                       |
| `--tables <значение>`                             | Список таблиц для генерации, разделенный запятыми. Доступные таблицы: `customer`, `nation`, `order_line`, `part_psupp`, `region`, `supplier`.  | Все таблицы.          |
| `--proccess-count <значение>` или `-C <значение>` | Генерация данных может быть на разбита на несколько процессов, этот параметр задает количество процессов.                                      | 1                     |
| `--proccess-index <значение>` или `-i <значение>` | Генерация данных может быть на разбита на несколько процессов, этот параметр задает номер процесса.                                            | 0                     |
| `--state <путь>`                                  | Путь к файлу состояния загрузки. Если загрузка была прервана по какой-то причине, при новом запуске загрузка будет продолжена с того же места. |                       |
| `--clear-state`                                   | Актуально, если задан параметр `--state`. Очистить файл состояния и начать загрузку сначала.                                                   |                       |
| `--dry-run`                                       | Не выполнять загрузку данных в базу данных, только подготовить данные и вывести об этом сообщение.   |                            |

{% include [load_options](./_includes/workload/load_options.md) %}

## Запуск нагрузочного теста { #run }

Запустите нагрузку:

```bash
{{ ydb-cli }} workload tpch --path tpch/s1 run
```

В течение теста на экран выводится статистика по нагрузке для каждого запроса.

Посмотрите описание команды для запуска нагрузки:

```bash
{{ ydb-cli }} workload tpch run --help
```

{% include [run_options](./_includes/workload/run_options.md) %}

### Опции, специфичные для TPC-H { #run_tpch_options }

| Имя                       | Описание                                                                                                         | Значение по умолчанию |
|---------------------------|------------------------------------------------------------------------------------------------------------------|-----------------------|
| `--syntax <значение>`     | Какой вариант синтаксиса запросов использовать, `yql` или `pg` (сокращение от `PostgreSQL`). Про работу с синтаксисом YQL можно прочитать в [здесь](../../yql/reference/index.md), а про PostgreSQL [здесь](../../postgresql/intro.md).                                                   | `yql`                 |
| `--float_mode <значение>` | Режим работы с числами с плавающей точкой. Может быть `float`, `decimal` или `decimal_ydb`. Если установлено значение `float` - будет использоваться float, `decimal` означает, что будет использоваться decimal с каноническим размером, указанным в спецификации TPC-H(`Decimal(12, 2)`), а `decimal_ydb` означает, что все float будут преобразованы в `Decimal(22, 9)`. Подробнее про тип Decimal можно посмотреть в [документации](../../yql/reference/types/primitive.md#numeric). | `float`                 |
| `--scale <значение>`      | Scale factor. См. спецификацию TPC-H п.4.1.3. Поддерживаются и дробные значения, хотя они и не описаны в спецификации TPC-H. Для масштабов `0.1`, `0.2`, `0.5`, `1`, `10`, `100`, `1000`, `10000` заданы каноничные ответы (см. описание опции `--check-canonical`). | 1                     |

## Очистка данных теста { #cleanup }

Запустите очистку:

```bash
{{ ydb-cli }} workload tpch --path tpch/s1 clean
```

Команда не имеет параметров.
