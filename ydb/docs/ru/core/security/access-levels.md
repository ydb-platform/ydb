# Уровни доступа

Уровни доступа — это один из двух механизмов управления доступом в {{ ydb-short-name }}, который управляет настройками административных и других привилегий.

{{ ydb-short-name }} использует три основных уровня доступа:

- **Наблюдатель** даёт возможность просмотра состояния системы, закрытого от публичного доступа, без возможности делать изменения. Этот уровень доступа требуется для большей часть страниц [Embedded UI](../reference/embedded-ui/index.md).

- **Оператор** даёт дополнительные возможности просмотра и выполнения действий, изменяющих состояние системы:

    - доступ к страницам **Developer UI**;
    - рестарт или старт/стоп таблеток на странице таблетки в [Embedded UI](../reference/embedded-ui/index.md) или Developer UI;
    - [перемещение VDisk'ов](../maintenance/manual/moving_vdisks.md) на другие PDisk'и (evict) на странице VDisk'а в [Embedded UI](../reference/embedded-ui/index.md) или Developer UI;
    - рестарт или [декомиссия](../devops/deployment-options/manual/decommissioning.md) диска на странице PDisk'а в [Embedded UI](../reference/embedded-ui/index.md) или Developer UI;
    - действия на вкладке с информацией по фоновым операциям — построение индекса, импорт и экспорт ([Embedded UI](../reference/embedded-ui/index.md) > **Diagnostics** > **Operations**);
    - действия на вкладке с информацией по запросам ([Embedded UI](../reference/embedded-ui/index.md) > **Diagnostics** > **Queries**).

- **Администратор** даёт право на выполнение административных действий с базами данных или кластером:

    - управление кластером:
        - [изменение динамической конфигурации кластера](../devops/configuration-management/configuration-v2/update-config.md);
        - [управление пулами ресурсов](../dev/resource-consumption-management.md);

        [//]: # (управление конфигурацией тарификации — metering config;)

        - изменение настроек таблетки [Console](../concepts/glossary.md#console);
        - запросы к сервису [maintenance](../devops/deployment-options/manual/maintenance.md) (получение списка узлов кластера, управление maintenance-задачами);
        - выполнение drain/fill узла {{ ydb-short-name }} в CLI (ydbd) и в Developer UI;
        - изменение статуса таблеток с помощью [minikql](../concepts/glossary.md#minikql)-запросов через CLI (для продвинутой диагностики и решения проблем);

    - управление дисковой подсистемой кластера без проверки на деградацию групп (с нарушением модели отказа):

        - перезапуск PDisk'а в Developer UI;
        - изменение статуса PDisk'а через [YDB DSTool](../reference/ydb-dstool/index.md);
        - [перемещение VDisk'ов](../maintenance/manual/moving_vdisks.md) на другие PDisk'и (evict) через [YDB DSTool](../reference/ydb-dstool/index.md);

    - управление базами данных и таблицами:
        - управление базами данных в [CMS](../concepts/glossary.md#cms);
        - изменение динамической конфигурации базы данных;
        - выполнение `ALTER TABLE`-запросов на индексные таблицы без ограничений консистентности с основной таблицей;
        - прямой split/merge партиций таблицы (для продвинутой диагностики и решения проблем);
        - прямое выполнение схемной операции по protobuf spec через CLI (для продвинутой диагностики и решения проблем).

{% note info %}

Существует еще четвёртый уровень, который даёт разрешение на регистрацию узлов баз данных в кластере {{ ydb-short-name }}. Подробнее о регистрации узлов баз данных в кластере см. в статье [{#T}](../devops/deployment-options/manual/node-authorization.md)

{% endnote %}

## Списки разрешений

Уровень доступа субъекта определяется списками разрешений (списками уровней доступа), заданными в конфигурации кластера, и влияет на дополнительные возможности субъекта при работе со [схемными объектами](../concepts/glossary.md#scheme-object), а также на возможности субъекта в контекстах, не связанных со схемными объектами.

[//]: # (TODO: добавить ссылку на справку по viewer api и требуемым правам, когда она появится)

Списки разрешений настраиваются в секции [`security_config` конфигурации YDB](../reference/configuration/security_config.md#security-access-levels).

{% note warning %}

По-умолчанию, все списки пустые.

Пустой список разрешает доступ любому пользователю (включая анонимного пользователя).

Все три пустых списка дают возможности администратора любому пользователю системы.

Для защищённого развёртывания {{ ydb-short-name }} важно заранее определить модель прав и прописать в списках соответствующие группы.

{% endnote %}

В списках доступа могут перечисляться индивидуальные SID'ы [пользователей](../concepts/glossary.md#access-user) или SID'ы [групп пользователей](../concepts/glossary.md#access-group). Принадлежность пользователя к тому или иному списку доступа определяется по прямому вхождению в соответствующий список доступа или по вхождению в список доступа группы, в которой состоит пользователь (с учетом рекурсивности, которая возникает из-за того, что одна группа может включать несколько других групп).
Рекомендуется включать в списки `*_allowed_sids` группы, тогда наделение индивидуальных пользователей соответствующими возможностями не будет требовать изменения общей конфигурации кластера.

{% note info %}

Списки разрешений — это слои дополнительных разрешений:

- Субъект, не состоящий ни в одном списке разрешений, имеет возможность просмотра публично доступной информации в системе (например, может видеть [список баз на кластере](../reference/embedded-ui/ydb-monitoring.md#tenant_list_page) или [список узлов кластера](../reference/embedded-ui/ydb-monitoring.md#node_list_page)).
- Списки `viewer_allowed_sids`, `monitoring_allowed_sids`, `administration_allowed_sids` последовательно наращивают возможности субъекта. Максимальные возможности требуют включения во все три списка.
- Присутствие в списке `monitoring_allowed_sids` или `administration_allowed_sids` без присутствия во `viewer_allowed_sids` не имеет смысла.

Например:

- оператор должен состоять (прямо или через группы) во `viewer_allowed_sids` и в `monitoring_allowed_sids`;
- полноценный администратор должен состоять во `viewer_allowed_sids`, `monitoring_allowed_sids` и в `administration_allowed_sids`.

{% endnote %}