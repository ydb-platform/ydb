# Авторизация

## Основные понятия

Авторизация в {{ ydb-short-name }} основана на понятиях:

* [Объект доступа](#object)
* [Субъект доступа](#subject)
* [Право](#right)
* [Владелец](#owner)

Независимо от метода аутентификации, авторизация всегда выполняется на стороне {{ ydb-short-name }} на основе хранящейся в ней информации об объектах и правах доступа. Права доступа определяют набор доступных для выполнения операций.
Авторизация выполняется на каждое действие пользователя: его права не кешируются, так как могут быть отозваны или предоставлены в любой момент времени.

## Объект доступа {#object}

Объект доступа — узел дерева [директорий](../concepts/glossary.md#folder) (схемный объект, объект схемы), например: базы данных, директории, таблицы, представления, топики.

Директории организованы в иерархическую структуру объектов схемы и вложенных в них объектов: баз данных, таблиц, представлений, топиков. Директории могут содержать поддиректории, и такая вложенность может быть произвольной глубины.

## Субъект доступа {#subject}

Субъект доступа — сущность, которая может запрашивать доступ к объектам доступа или выполнять определенные действия в системе.
Субъектом доступа может быть [пользователь](#user) или [группа](#group).

{{ ydb-short-name }} позволяет работать с пользователями из разных каталогов и систем, и они отличаются с использованием суффикса.

### SID

Субъект доступа идентифицируется строкой вида `<login>[@<subsystem>]`. Такая строка называется SID (Security Identifier). SID'ы записываются в правилах ACL на объектах схемы.

Суффикс `@<subsystem>` идентифицирует «источник пользователя» или «auth-домен», внутри которых гарантируется уникальность всех `login`. Например, в случае интеграции с LDAP имена пользователей будут `user1@ldap` и `user2@ldap`.  
Если указан `login` без суффикса, то имеются в виду пользователи, непосредственно созданные в кластере {{ ydb-short-name }}.

### Пользователь {#user}

Для создания, изменения и удаления пользователей {{ ydb-short-name }} есть команды:

* [{#T}](../yql/reference/syntax/create-user.md)
* [{#T}](../yql/reference/syntax/alter-user.md)
* [{#T}](../yql/reference/syntax/drop-user.md)

{% include [!](../_includes/do-not-create-users-in-ldap.md) %}

Отдельно выделяется пользователь `root`. Он создаётся при [первоначальном развёртывании кластера](../devops/manual/initial-deployment.md#initialize-cluster), в ходе которой ему нужно сразу [установить пароль](../devops/manual/initial-deployment.md#security-setup).

### Группа {#group}

Группа пользователей — именованное множество пользователей, предназначенное для упрощения конфигурации контроля доступа.
За группой можно закрепить любые необходимые [права](#right) на произвольный набор [объектов доступа](#object).

Группа пользователей может быть пустой, когда в неё не входит ни один пользователь.

Любого пользователя можно включить в ту или иную группу доступа или исключить из неё. Как только пользователь включается в группу доступа, он получает все права на объекты базы данных, которые предоставлялись группе доступа.
Так, с помощью групп доступа {{ ydb-short-name }} можно реализовать бизнес-роли пользовательских приложений, заранее настроив требуемые права доступа на нужные объекты.

Для создания, изменения и удаления групп есть следующие виды YQL запросов:

* [{#T}](../yql/reference/syntax/create-group.md)
* [{#T}](../yql/reference/syntax/alter-group.md)
* [{#T}](../yql/reference/syntax/drop-group.md)

## Право {#right}

### Понятие права

Право в {{ ydb-short-name }} — сущность, отражающая разрешение [субъекту](#subject) выполнять конкретный набор операций в кластере или базе данных над конкретным [объектом](#object).

{% note info %}

Права привязаны не пользователю, а к объекту доступа.

{% endnote %}

### Управление правами с помощью YQL

Для управления правами служат следующие YQL-команды:

* [{#T}](../yql/reference/syntax/grant.md).
* [{#T}](../yql/reference/syntax/revoke.md).

В качестве имен прав доступа в этих командах можно использовать специфичные для {{ ydb-short-name }} права или соответствующие им ключевые слова.

Пример использования c ключевым словом YQL:

```yql
GRANT CREATE DIRECTORY ON `/Root/db1` TO testuser
```

Пример использования c именем {{ ydb-short-name }} права:

```yql
GRANT "ydb.granular.create_directory" ON `/Root/db1` TO testuser
```

### Управление правами с помощью CLI

Для управления правами служат следующие CLI-команды:

* [chown](../reference/ydb-cli/commands/scheme-permissions.md#chown)
* [grant](../reference/ydb-cli/commands/scheme-permissions.md#grant-revoke)
* [revoke](../reference/ydb-cli/commands/scheme-permissions.md#grant-revoke)
* [set](../reference/ydb-cli/commands/scheme-permissions.md#set)
* [clear](../reference/ydb-cli/commands/scheme-permissions.md#clear)
* [list](../reference/ydb-cli/commands/scheme-permissions.md#list)

В CLI используется только стиль из столбца "{{ ydb-short-name }} право".
Например:

```bash
{{ ydb-short-name }} scheme permissions grant -p "ydb.granular.create_directory" `/Root/db1` testuser
```

### Просмотр прав с помощью CLI

Просматривать ACL объекта доступа можно с помощью CLI команды [`describe`](../reference/ydb-cli/commands/scheme-describe.md).

## Владелец объекта {#owner}

У каждого объекта доступа есть владелец, в том числе у кластера в целом и каждой базы данных. Владельцем объекта по умолчанию становится субъект доступа, создавший объект.

Для владельца не проверяются ACL права на данный объект. Он имеет полный набор прав на объект.

Сменить владельца можно с помощью CLI команды [`chown`](../reference/ydb-cli/commands/scheme-permissions.md#chown).

Пример команды `chown`:

```bash
{{ ydb-cli }} scheme permissions chown '/Root/db1' testuser
```

## Список разрешений {#acl}

У каждого такого [объекта доступа](#object) есть список разрешений — ACL (Access Control List) — он хранит все предоставленные [субъектам доступа](#subject) (пользователям и группам) [права](#right) на объект.

Изменять ACL (управления правами) служат следующие виды YQL запросов:

* [{#T}](../yql/reference/syntax/grant.md).
* [{#T}](../yql/reference/syntax/revoke.md).

Просматривать ACL объекта доступа можно с помощью CLI команды [`describe`](../reference/ydb-cli/commands/scheme-describe.md).
