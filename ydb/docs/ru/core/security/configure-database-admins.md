# Администратор базы данных

Администратор базы данных (БД) -- это пользователь, обладающий административными возможностями в рамках некоторой базы данных:

Администратор базы может:

- управлять пользователями и группами базы (создание, удаление, изменение, блокировка)
- управлять правами доступа пользователей к объектам базы данных
- управлять конфигурацией базы
- выполнять бекап и восстановление базы
- выполнять прочие административными действия в пределах базы

Администратор базы не может:

- управлять учетными записями администраторов кластера или пользователей других баз
- создавать других администраторов базы (TODO: как это?)
- управлять конфигурацией кластера или других баз
- управлять правами на объектах выше уровня базы или в других базах

## Понятие администратора базы данных в {{ ydb-short-name }}

Администратором базы данных является пользователь, который является [владельцем](../concepts/glossary.md#access-owner) базы данных.

База данных определяется своим путём в схеме кластера, владелец этого пути (пользователь или группа) является владельцем базы.

## Требуемая конфигурация {#database-admin-setup}

1. На уровне базы существует группа администраторов базы данных.
2. Группа администраторов базы данных является владельцем корня базы данных.

{% note info %}

Рассматривается управление базой группой администраторов. Оставить управление базой единственному [пользователю](../concepts/glossary.md#access-user)-администратору (или администраторам кластера) может быть ненадёжно или неудобно.

{% endnote %}

## Инструкция

Пусть для примера:

- путь базы данных -- `/Root/example-db`;
- группа администраторов базы данных -- `DB-ADMINS`;
- администраторы базы данных -- пользователи `db-admin-1`, `db-admin-2`, `db-admin-3`.

На настоящем кластере имена могут быть другими.

Создаёт и запускает базу данных [администратор кластера](./configure-cluster-admins.md), он же настраивает администраторов базы данных.

Создание и настройка администраторов базы данных по шагам:

1. Создать базу данных

    TODO: См. devops/manual/initial-deployment.md или ansible-install-steps.md.

    После создания владельцем базы данных `/Root/db` будет создавший её администратор кластера.

2. Запустить базу данных

    TODO: Сослаться на запуск нод базы разными описанными в документации способами.

3. Создать в базе группу администраторов базы

    ```bash
    {{ ydb-cli }} --user cluster-admin-1 --password `<пароль>` -d '/Root/example-db' yql -s '
        CREATE USER `db-admin-1` PASSWORD `<пароль-1>`;
        CREATE USER `db-admin-2` PASSWORD `<пароль-2>`;
        CREATE USER `db-admin-3` PASSWORD `<пароль-3>`;
    '
    ```

    (`<пароль-1>`, `<пароль-2>`, `<пароль-3>` -- места для подстановки строк настоящих паролей)

4. Добавить пользователей в группу администраторов базы

    ```bash
    {{ ydb-cli }} --user cluster-admin-1 --password `<пароль>` -d '/Root/example-db' yql -s '
        ALTER GROUP `DB-ADMINS` ADD
            `db-admin-1`,
            `db-admin-2`,
            `db-admin-3`
    '
    ```

5. Передать владение базой группе администраторов базы:

    ```bash
    {{ ydb-cli }} --user cluster-admin-1 --password `<пароль>` -d '/Root/example-db' scheme permissions chown `/Root/example-db` DB-ADMINS
    ```

После выполнения данной инструкции новые администраторы базы данных способны выполнять административные операции со своей базой.
