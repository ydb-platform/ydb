## Топы запросов {#top-queries}

Следующие системные таблицы хранят данные для анализа потока пользовательских запросов:

* `top_queries_by_duration_one_minute` — данные разбиты на минутные интервалы, содержит топ-5 запросов с наибольшим полным временем исполнения за последние 6 часов;
* `top_queries_by_duration_one_hour` — данные разбиты на часовые интервалы, содержит топ-5 запросов с наибольшим полным временем исполнения за последние 2 недели;
* `top_queries_by_read_bytes_one_minute` — данные разбиты на минутные интервалы, содержит топ-5 запросов с наибольшим количеством прочитанных из таблицы байт за последние 6 часов;
* `top_queries_by_read_bytes_one_hour` — данные разбиты на часовые интервалы, содержит топ-5 запросов с наибольшим количеством прочитанных из таблицы байт за последние 2 недели;
* `top_queries_by_cpu_time_one_minute` — данные разбиты на минутные интервалы, содержит топ-5 запросов с наибольшим затраченным процессорным временем за последние 6 часов;
* ` top_queries_by_cpu_time_one_hour` — данные разбиты на часовые интервалы, содержит топ-5 запросов с наибольшим затраченным процессорным временем за последние 2 недели.

Различные запуски запроса с одним и тем же текстом дедуплицируются. Топ содержит информацию о конкретном запуске с максимальным значением соответствующей характеристики запроса в пределах одного временного интервала.

Поля, предоставляющие информацию о затраченном процессорном времени (...`CPUTime`), выражены в микросекундах.

Текст запроса ограничен 4 килобайтами.

Все таблицы содержат одинаковый набор полей:

Поле | Описание
--- | ---
`IntervalEnd` | Момент закрытия минутного или часового интервала.<br>Тип: `Timestamp`.<br>Ключ: `0`.
`Rank` | Ранг запроса в топе.<br>Тип: `Uint32`.<br>Ключ: `1`.
`QueryText` | Текст запроса.<br>Тип: `Utf8`.
`Duration` | Полное время исполнения запроса.<br>Тип: `Interval`.
`EndTime` | Момент окончания исполнения запроса. <br>Тип: `Timestamp`. 
`Type` | Тип запроса ("data", "scan", "script").<br>Тип: `String`.
`ReadRows` | Количество прочитанных строк.<br>Тип: `Uint64`.
`ReadBytes` | Количество прочитанных байт.<br>Тип: `Uint64`.
`UpdateRows` | Количество записанных строк.<br>Тип: `Uint64`.
`UpdateBytes` | Количество записанных байт.<br>Тип: `Uint64`.
`DeleteRows` | Количество удалённых строк.<br>Тип: `Uint64`.
`DeleteBytes` | Количество удалённых байт.<br>Тип: `Uint64`.
`Partitions` | Количество партиций таблиц, участвовавших в исполнении запроса.<br>Тип: `Uint64`.
`UserSID` | Security ID пользователя.<br>Тип: `String`.
`ParametersSize` | Размер параметров запроса в байтах.<br>Тип: `Uint64`.
`CompileDuration` | Длительность компиляции запроса.<br>Тип: `Interval`.
`FromQueryCache` | Использовался ли кэш подготовленных запросов.<br>Тип: `Bool`.
`CPUTime` | Общее процессорное время, использованное для исполнения запроса (микросекунды).<br>Тип: `Uint64`.
`ShardCount` | Количество шардов, участвующих в исполнении запроса.<br>Тип: `Uint64`.
`SumShardCPUTime` | Общее процессорное время, затраченное в шардах.<br>Тип: `Uint64`.
`MinShardCPUTime` | Минимальное процесорное время, затраченное в шардах.<br>Тип: `Uint64`.
`MaxShardCPUTime` | Максимальное процессорное время, затраченное в шардах.<br>Тип: `Uint64`.
`ComputeNodesCount` | Количество вычислительных нод, задействованных в исполнении запроса.<br>Тип: `Uint64`.
`SumComputeCPUTime` | Общее процессорное время, затраченное в вычислительных нодах.<br>Тип: `Uint64`.
`MinComputeCPUTime` | Минимальное процессорное время, затраченное в вычислительных нодах.<br>Тип: `Uint64`.
`MaxComputeCPUTime` | Максимальное процессорное время, затраченное в вычислительных нодах.<br>Тип: `Uint64`.
`CompileCPUTime` | Процессорное время, затраченное на компиляцию запроса.<br>Тип: `Uint64`.
`ProcessCPUTime` | Процессорное время, затраченное на общую обработку запроса.<br>Тип: `Uint64`.
