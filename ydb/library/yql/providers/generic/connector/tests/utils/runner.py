from abc import ABC, abstractmethod
from dataclasses import dataclass
from pathlib import Path
from typing import List, Optional

from ydb.library.yql.providers.generic.connector.tests.utils.settings import Settings, GenericSettings
from ydb.library.yql.providers.generic.connector.tests.utils.schema import Schema, YsonList


@dataclass
class Result:
    data_out: Optional[YsonList]
    data_out_with_types: Optional[List]
    schema: Optional[Schema]
    stdout: str
    stderr: str
    returncode: int


class Runner(ABC):
    @abstractmethod
    def __init__(self, runner_path: Path, settings: Settings):
        pass

    @abstractmethod
    def run(
        self,
        test_name: str,
        script: str,
        generic_settings: GenericSettings,
    ) -> Result:
        """
        Runs YQL script via CLI application and stores artifacts.
        :param test_name: test name generated by request fixture (see https://stackoverflow.com/a/34732269/2361497)
        :param script: YQL script itself

        :return: Result packed with data suitable for assertion
        """
        pass
