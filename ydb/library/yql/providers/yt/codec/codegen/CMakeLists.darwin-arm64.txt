
# This file was generated by the build system used internally in the Yandex monorepo.
# Only simple modifications are allowed (adding source-files to targets, adding simple properties
# like target_include_directories). These modifications will be ported to original
# ya.make files by maintainers. Any complex modifications which can't be ported back to the
# original buildsystem will not be accepted.


add_subdirectory(ut)
get_built_tool_path(
  TOOL_rescompiler_bin
  TOOL_rescompiler_dependency
  tools/rescompiler/bin
  rescompiler
)

add_library(yt-codec-codegen)
target_compile_options(yt-codec-codegen PRIVATE
  -DUSE_CURRENT_UDF_ABI_VERSION
)
target_link_libraries(yt-codec-codegen PUBLIC
  contrib-libs-cxxsupp
  yutil
  library-cpp-resource
  ydb-library-binary_json
  minikql-computation-llvm
  parser-pg_wrapper-interface
  library-yql-utils
  llvm12-lib-IR
  lib-ExecutionEngine-MCJIT
  llvm12-lib-Linker
  llvm12-lib-Support
  lib-Target-X86
  Target-X86-AsmParser
  lib-Transforms-IPO
  yql-minikql-codegen
)
target_sources(yt-codec-codegen PRIVATE
  ${CMAKE_SOURCE_DIR}/ydb/library/yql/providers/yt/codec/codegen/yt_codec_cg.cpp
)

add_global_library_for(yt-codec-codegen.global yt-codec-codegen)
target_compile_options(yt-codec-codegen.global PRIVATE
  -DUSE_CURRENT_UDF_ABI_VERSION
)
target_link_libraries(yt-codec-codegen.global PUBLIC
  contrib-libs-cxxsupp
  yutil
  library-cpp-resource
  ydb-library-binary_json
  minikql-computation-llvm
  parser-pg_wrapper-interface
  library-yql-utils
  llvm12-lib-IR
  lib-ExecutionEngine-MCJIT
  llvm12-lib-Linker
  llvm12-lib-Support
  lib-Target-X86
  Target-X86-AsmParser
  lib-Transforms-IPO
  yql-minikql-codegen
)
target_sources(yt-codec-codegen.global PRIVATE
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/12ec3101983db48f6ee4095b4f5fb784.cpp
)
add_custom_command(
  OUTPUT
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/YtCodecFuncs_optimized.bc
  DEPENDS
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/YtCodecFuncs_merged.bc
  COMMAND
  ${LLVMOPT}
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/YtCodecFuncs_merged.bc
  -o
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/YtCodecFuncs_optimized.bc
  -O2
  -globalopt
  -globaldce
  -internalize
  -internalize-public-api-list=WriteJust#WriteNothing#WriteBool#Write8#Write16#Write32#Write64#Write120#WriteDecimal32#WriteDecimal64#WriteDecimal128#WriteFloat#WriteDouble#WriteString#ReadBool#ReadInt8#ReadUint8#ReadInt16#ReadUint16#ReadInt32#ReadUint32#ReadInt64#ReadUint64#ReadInt120#ReadDecimal32#ReadDecimal64#ReadDecimal128#ReadFloat#ReadDouble#ReadOptional#ReadVariantData#SkipFixedData#SkipVarData#ReadTzDate#ReadTzDatetime#ReadTzTimestamp#WriteTzDate#WriteTzDatetime#WriteTzTimestamp#GetWrittenBytes#FillZero
)
add_custom_command(
  OUTPUT
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/YtCodecFuncs_merged.bc
  DEPENDS
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/yt_codec_bc.cpp.bc
  COMMAND
  ${LLVMLINK}
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/yt_codec_bc.cpp.bc
  -o
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/YtCodecFuncs_merged.bc
)
llvm_compile_cxx(yt-codec-codegen.global
  ${CMAKE_SOURCE_DIR}/ydb/library/yql/providers/yt/codec/codegen/yt_codec_bc.cpp
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/yt_codec_bc.cpp.bc
  ${CLANGPLUSPLUS}
  -Wno-unknown-warning-option
  -emit-llvm
)
resources(yt-codec-codegen.global
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/12ec3101983db48f6ee4095b4f5fb784.cpp
  INPUTS
  ${CMAKE_BINARY_DIR}/ydb/library/yql/providers/yt/codec/codegen/YtCodecFuncs_optimized.bc
  KEYS
  /llvm_bc/YtCodecFuncs
)
