syntax = "proto3";
option cc_enable_arenas = true;

package Ydb.Formats;
option java_package = "com.yandex.ydb.formats";

message ArrowBatchSettings {
    bytes schema = 1;
}

message CsvSettings {
    message Quoting {
        bool disabled = 1;
        bytes quote_char = 2;
        bool double_quote_disabled = 3;
    }

    // Number of rows to skip before CSV data. It should be present only in the first upsert of CSV file.
    uint32 skip_rows = 1;
    // Fields delimiter in CSV file. It's "," if not set.
    bytes delimiter = 2;
    // String value that would be interpreted as NULL.
    bytes null_value = 3;
    // First not skipped line is a CSV header (list of column names).
    bool header = 4;
    Quoting quoting = 5;
}

enum OutputFormat {
    // Unspecified, corresponds to OUTPUT_FORMAT_VALUE.
    OUTPUT_FORMAT_UNSPECIFIED = 0;

    // Default, used to get Ydb.Value as a result of the query in Ydb.ResultSet.rows field.
    OUTPUT_FORMAT_VALUE = 1;

    // Arrow output format, used to get binary representation of the result in Ydb.ResultSet.data field.
    OUTPUT_FORMAT_ARROW = 2;
}

enum SchemaInclusionMode {
    // Unspecified mode, corresponds to SCHEMA_INCLUSION_MODE_ALWAYS mode.
    SCHEMA_INCLUSION_MODE_UNSPECIFIED = 0;

    // Always include schema in every Ydb.ResultSet in the response stream.
    SCHEMA_INCLUSION_MODE_ALWAYS = 1;

    // Include schema only in the first Ydb.ResultSet per result_set_index of the response stream.
    SCHEMA_INCLUSION_MODE_FIRST_ONLY = 2;
}

/**
 * ValueOutputFormatSettings is settings for OUTPUT_FORMAT_VALUE in Ydb.Query.ExecuteQueryRequest.
 * It is used to configure schema inclusion mode.
 */
message ValueOutputFormatSettings {
    SchemaInclusionMode schema_inclusion_mode = 1;
}

/**
 * ArrowOutputFormatSettings is settings for OUTPUT_FORMAT_ARROW in Ydb.Query.ExecuteQueryRequest.
 * It is used to configure compression and schema inclusion mode.
 */
message ArrowOutputFormatSettings {
    message Compression {
        enum Type {
            // Unspecified mode, corresponds to COMPRESSION_NONE mode.
            COMPRESSION_UNSPECIFIED = 0;

            // Binary data without compression.
            COMPRESSION_NONE = 1;

            // Zstandard compression.
            COMPRESSION_ZSTD = 2;

            // LZ4 frame compression.
            COMPRESSION_LZ4_FRAME = 3;
        }

        Type type = 1;
        int32 level = 2;
    }

    SchemaInclusionMode schema_inclusion_mode = 1;

    Compression compression = 2;
}

/**
 * ArrowOutputFormatMeta is a metadata for OUTPUT_FORMAT_ARROW in Ydb.ResultSet.
 * It is used to get the schema of the Arrow record batch.
 */
message ArrowOutputFormatMeta {
    // Schema of the arrow batch of the result. It is filled:
    // - SCHEMA_INCLUSION_MODE_ALWAYS: in every Ydb.ResultSet.
    // - SCHEMA_INCLUSION_MODE_FIRST_ONLY: in the first Ydb.ResultSet per result_set_index.
    bytes schema = 1;
}
