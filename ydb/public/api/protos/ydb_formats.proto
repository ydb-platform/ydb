syntax = "proto3";
option cc_enable_arenas = true;

package Ydb.Formats;
option java_package = "com.yandex.ydb.formats";

message ArrowBatchSettings {
    bytes schema = 1;
}

message CsvSettings {
    message Quoting {
        bool disabled = 1;
        bytes quote_char = 2;
        bool double_quote_disabled = 3;
    }

    // Number of rows to skip before CSV data. It should be present only in the first upsert of CSV file.
    uint32 skip_rows = 1;
    // Fields delimiter in CSV file. It's "," if not set.
    bytes delimiter = 2;
    // String value that would be interpreted as NULL.
    bytes null_value = 3;
    // First not skipped line is a CSV header (list of column names).
    bool header = 4;
    Quoting quoting = 5;
}

enum SchemaInclusionMode {
    // Unspecified mode, corresponds to SCHEMA_INCLUSION_MODE_ALWAYS mode.
    SCHEMA_INCLUSION_MODE_UNSPECIFIED = 0;

    // Always include schema in every Ydb.ResultSet in the response stream.
    SCHEMA_INCLUSION_MODE_ALWAYS = 1;

    // Include schema only in the first Ydb.ResultSet per result_set_index of the response stream.
    SCHEMA_INCLUSION_MODE_FIRST_ONLY = 2;
}

/**
 * ValueOutputFormat is a standard output format for Ydb.Query.ExecuteQueryRequest.
 * It is used to get Ydb.Value rows as a result of the query.
 * The output format is specified in the Ydb.Query.ExecuteQueryRequest.output_format field.
 *
 * ValueOutputFormatMeta is a metadata for ValueOutputFormat.
 * It is used to know the output format.
 * It is only filled in Ydb.ResultSet.output_format_meta field.
 */
message ValueOutputFormat {
    SchemaInclusionMode schema_inclusion_mode = 1;
}

message ValueOutputFormatMeta {}

/**
 * ArrowOutputFormat is a custom output format for Ydb.Query.ExecuteQueryRequest.
 * It is used to get a serialized Arrow record batch in the Ydb.ResultSet.data field with/without compression.
 * The output format is specified in the Ydb.Query.ExecuteQueryRequest.output_format field.
 *
 * ArrowOutputFormatMeta is a metadata for ArrowOutputFormat.
 * It is used to know the output format and get the schema of the Arrow record batch.
 * It is only filled in Ydb.ResultSet.output_format_meta field.
 */
message ArrowOutputFormat {
    message Compression {
        enum Type {
            // Unspecified mode, corresponds to COMPRESSION_NONE mode.
            COMPRESSION_UNSPECIFIED = 0;

            // Binary data without compression.
            COMPRESSION_NONE = 1;

            // Zstandard compression.
            COMPRESSION_ZSTD = 2;

            // LZ4 frame compression.
            COMPRESSION_LZ4_FRAME = 3;
        }

        Type type = 1;
        int32 level = 2;
    }

    SchemaInclusionMode schema_inclusion_mode = 1;

    Compression compression = 2;
}

message ArrowOutputFormatMeta {
    // Schema of the arrow batch of the result.
    // It is filled only for SCHEMA_INCLUSION_MODE_ALWAYS, SCHEMA_INCLUSION_MODE_FIRST_ONLY in ExecuteQueryRequest.output_format.
    bytes schema = 1;
}
