# Traceability Matrix

### TTL
#### [ISSUE-13526](https://github.com/ydb-platform/ydb/issues/13526): Test Suite: cs/tiering+ttl
[![PROGRESS](https://img.shields.io/badge/PROGRESS-5%2F12:41%25-rgb(254%2C%20248%2C%20202%2C1)?style=for-the-badge&logo=database&labelColor=grey)](./summary.md#issue-13526-test-suite-cstieringttl)

| Case ID | Name | Description | Issues |  Status |
|---------|------|-------------|--------|:--------|
| #13468 | Test tiering. Functional. Data deleted by DELETE statement are deleted from S3 | При явном удалении данные с помощью DELETE связанные с ним данные удаляются из S3 (тест дожидается пропажи данных в S3)<br><br>Сценарий:<br>1 создаются нужные ресурсы:<br>1.1 таблица<br><br>ts Timestamp,<br>s String,<br>val Int64<br><br>1.2 два бакета в s3 (или очищаются ранее созданные)<br><br>aws \-\-profile=default \-\-endpoint\-url=http://127.0.0.1:12012 \-\-region=us\-east\-1 s3 mb s3://s3\_cold<br>aws \-\-profile=default \-\-endpoint\-url=http://127.0.0.1:12012 \-\-region=us\-east\-1 s3 mb s3://s3\_frozen<br><br>1.3 два EXTERNAL DATA SOURCE:<br>s3\_cold<br>s3\_frozen<br><br>CREATE OBJECT access\_key (TYPE SECRET) WITH (value="")<br>CREATE OBJECT secret\_key (TYPE SECRET) WITH (value="")<br><br>create external data source s3\_cold WITH(source\_type="ObjectStorage", LOCATION="http://127.0.0.1:12012", AUTH\_METHOD="AWS", AWS\_ACCESS\_KEY\_ID\_SECRET\_NAME="access\_key", AWS\_REGION="ru\-central1", AWS\_SECRET\_ACCESS\_KEY\_SECRET\_NAME="secret\_key")<br>повторить для s3\_frozen вместо s3\_cold<br><br>    Таблица заполняется данными равномерно распределёнными по ts в интервале 2010\-2030 год<br>    смотрим объём данный в .sys<br>    Настраивается тиринг в два тира:<br><br>ALTER TABLE mytable SET (<br>     TTL =<br>     Interval("P100D") TO EXTERNAL DATA SOURCE \`/Root/test/s3\_cold\`,<br>     Interval("P3000D") TO EXTERNAL DATA SOURCE \`/Root/test/s3\_frozen\`<br>     ON ts<br>     );<br><br><br>Контролируем по .sys что данные разъехались по тирам пропорционально длительности интервалов<br>Контролируем объём данных в бакетах s3<br><br>Выполняем команду DELETE FROM \`mytable\`<br>Проверяем по .sys, что данные удалились из всех тиров<br>Проверяем, что все данные удалились из обоих бакетов<br> | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13468)](https://github.com/ydb-platform/ydb/issues/13468) | Pending |
| #13467 | Test tiering. Functional. When configuring DELETE tier, data evaporates from S3 | Изменение настроек тиринга в части удаления данных из S3 приводит к полной очистке бакета <br><br>Сценарий:<br>1 создаются нужные ресурсы:<br>1.1 таблица<br>\`\`\`<br>ts Timestamp,<br>s String,<br>val Int64<br>\`\`\`<br><br>1.2 два бакета в s3 (или очищаются ранее созданные)<br>1.3 два EXTERNAL DATA SOURCE:<br>s3\_cold<br>s3\_frozen<br><br>2. Таблица заполняется данными равномерно распределёнными по ts в интервале 2010\-2030 год<br>смотрим объём данный в .sys<br>3. Настраивается тиринг в два тира:<br>\`\`\`<br>ALTER TABLE \`mytable\` SET (<br>    TTL =<br>        DateTime::IntervalFromDays(1000) TO EXTERNAL DATA SOURCE \`/Root/s3\_cold\`,<br>        DateTime::IntervalFromDays(3000) TO EXTERNAL DATA SOURCE \`/Root/s3\_frozen\`<br>    ON ts<br>);<br>\`\`\`<br>Контролируем по .sys что данные разъехались по тирам пропорционально длительности интервалов<br>Контролируем объём данных в бакетах s3<br><br>4. Меняем правила тиринга<br>\`\`\`<br>ALTER TABLE \`mytable\` SET (<br>    TTL =<br>        DateTime::IntervalFromDays(1000)<br>    ON ts<br>);<br><br>Проверяем по .sys, что данные удалились из всех тиров, кроме \_\_DEFAULT<br>Проверяем, что все данные удалились из обоих бакетов<br> <br> | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13467)](https://github.com/ydb-platform/ydb/issues/13467) | Pending |
| #13466 | Test tiering. Functional. Check data migration when altering tiering settings | Изменение настроек тиринга приводит к ожидаемому перемещению данных из одного тира в другой <br>Подробное описание:<br>1. Создать S3 и создать два \`EXTERNAL DATA SOURCE\` для двух разных бакета (\`bucket1\` и \`bucket2\`)<br>2. Создать табличку.<br>\`\`\`<br>CREATE TABLE \`table\_name\` (<br>    timestamp Timestamp,<br>    value Uint64,<br>    data String,<br>    PRIMARY KEY(timestamp)<br>)<br>WITH (<br>    STORE = COLUMN,<br>);<br>\`\`\`<br>3. Заполнить данные в табличку.<br>4. Изменить \`TTL\`, так чтобы данные вытиснялись во второй бакет<br>\`\`\`<br>ALTER TABLE \`table\_name\` SET (<br>    TTL = INTERVAL("PT2M") TO EXTERNAL DATA SOURCE \`/Root/bucket1\`,<br>    ON timestamp<br>);<br>\`\`\`<br>5. Дождаться вытиснения и проверить размер первого бакета (размер 1\-го бакета должен совпадать с количеством вставленных данных, а 2\-й бакет должен быть пустым)<br>6. Изменить \`TTL\`, так чтобы данные вытиснялись во второй бакет.<br>\`\`\`<br>ALTER TABLE \`table\_name\` SET (<br>    TTL = INTERVAL("PT5M") TO EXTERNAL DATA SOURCE \`/Root/bucket2\`,<br>    ON timestamp<br>);<br>\`\`\`<br>7. Дождаться вытиснения и проверить размеры бакетов (размер 2\-го бакета должен совпадать с количеством вставленных данных, а 1\-й бакет должен быть пустым)<br>8. Изменить \`TTL\`, так чтобы данные вернулись в \`BlobStorage\`<br>\`\`\`<br>ALTER TABLE \`table\_name\` SET (<br>    TTL = INTERVAL("P10000D") TO EXTERNAL DATA SOURCE \`/Root/bucket1\`,<br>    ON timestamp<br>);<br>\`\`\`<br>9. Дождаться возвращения данных в \`BlobStorage\` и проверить размеры бакетов (размер 1\-го и 2\-го бакета должны быть пустым) | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13466)](https://github.com/ydb-platform/ydb/issues/13466) | Pending |
| #13465 | Test tiering. Functional. Check data correctness | Выполняется большое число записи, удаления, модификации большого числа данных с тем, чтобы все данные были вытеснены. Сравниваются прочитанные данные и ожидаемые<br>TBD Подробное описание теста | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13465)](https://github.com/ydb-platform/ydb/issues/13465) | Pending |
| #13542 | Test tiering. Functional. Check data availability and correctness while changing ttl settings | Таблица наполняется данными, настройки тиринга меняются постоянно, проверяется, что все время считываются корректные данные приоритет 1<br>3 тира и данные записаны в соответсвии с паттерном логов, т.е. каждая запись содержит строки локализованные по времени | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13542)](https://github.com/ydb-platform/ydb/issues/13542) | Pending |
| #13543 | Test. sys reflects data distribution across tiers while modifying data | Выполняется большое число точечных модификаций данных. В sysview отражается статус отставания вытеснения данных | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13543)](https://github.com/ydb-platform/ydb/issues/13543) | Pending |
| #13544 | Test tiering. Stress. Ustable network connection | Протетсировать работу тиринга с нестабильным доступом до s3 | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13544)](https://github.com/ydb-platform/ydb/issues/13544) | Pending |
| #13545 | Test tiering. Stability. Temporary unavailable s3 | Временно потеряно соединение с s3. Ожидаемое поведение \- после возобновления связи (через какое время?) перенос данных возобновляется. На время ошибок в sysview отражается статус ошибки | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13545)](https://github.com/ydb-platform/ydb/issues/13545) | Pending |
| #13546 | Test tiering. Stability. Writing when blobstorage is full | Постоянно потеряно соединение с S3, места на диске не хватает. Ожидаемое поведение \- сообщение об ошибке записи пользователю. . На время ошибок в sysview отражается статус ошибки | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13546)](https://github.com/ydb-platform/ydb/issues/13546) | Pending |
| #13619 | Test tiering. Add column works for offloaded data | Во время вытеснения данных в S3 производится смена схемы таблицы, добавляются новые поля. Ожидаемое поведение \- система на всей глубине хранения отображает новые поля | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13619)](https://github.com/ydb-platform/ydb/issues/13619) | Pending |
| #13620 | Test teiring. Drop Column works well for offloaded data | Во время вытеснения данных в S3 производится смена схемы таблицы, удаляются существующие not null поля. Ожидаемое поведение \- система на всей глубине хранения выполняет запросы  | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13620)](https://github.com/ydb-platform/ydb/issues/13620) | Pending |
| #13621 | Test tiering. Alter column works well for offloaded data |  | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/13621)](https://github.com/ydb-platform/ydb/issues/13621) | Pending |

#### [ISSUE-14685](https://github.com/ydb-platform/ydb/issues/14685): Test Suite: CS/TTL deletion
[![TO%20DO](https://img.shields.io/badge/TO%20DO-0%2F7:0%25-rgb(224%2C%20250%2C%20227%2C1)?style=for-the-badge&logo=database&labelColor=grey)](./summary.md#issue-14685-test-suite-csttl-deletion)

| Case ID | Name | Description | Issues |  Status |
|---------|------|-------------|--------|:--------|
| #14686 | Data is deleted according to the specified TTL |  | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/14686)](https://github.com/ydb-platform/ydb/issues/14686) | Pending |
| #14687 | Data is deleted starting with the oldest records |  | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/14687)](https://github.com/ydb-platform/ydb/issues/14687) | Pending |
| #14688 | If a valid TTL is specified, the data is deleted |  | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/14688)](https://github.com/ydb-platform/ydb/issues/14688) | Pending |
| #14689 | The invalid TTL is handled correctly |  | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/14689)](https://github.com/ydb-platform/ydb/issues/14689) | Pending |
| #14690 | You can change the previously specified TTL, deletion will occur according to the new TTL |  | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/14690)](https://github.com/ydb-platform/ydb/issues/14690) | Pending |
| #14691 | Columns with types Timestamp, Datetime, Date can be specified as TTL (only the first column of PK) |  | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/14691)](https://github.com/ydb-platform/ydb/issues/14691) | Pending |
| #14692 | TTL deletes data at a sufficient rate (must exceed the insertion rate) |  | [![GitHub issue/pull request detail](https://img.shields.io/github/issues/detail/state/ydb-platform/ydb/14692)](https://github.com/ydb-platform/ydb/issues/14692) | Pending |

