syntax = "proto3";
option cc_enable_arenas = true;

package NKikimrKeyValue;
option java_package = "ru.yandex.kikimr.proto";
option java_outer_classname = "KeyValueVolumeStressLoadConfig";
option java_multiple_files = true;


message PartitionMode {
    enum Code {
        UNSPECIFIED = 0;
        OnePartition = 1;
        MultiPartition = 2;
    }
}

message ActionDataMode {
    message Worker {}
    message FromPrevActions {
        repeated string action_name = 1;
    }
    
    oneof Mode {
        Worker worker = 1;
        FromPrevActions from_prev_actions = 2;
    }
}

message ActionCommand {
    message Print {
        string msg = 1;
    }
    
    message Read {
        uint32 size = 1;
        uint32 count = 2;
        bool verify_data = 3;
    }
    
    message Write {
        uint32 size = 1;
        uint32 count = 2;
        uint32 channel = 3;
    }
    
    message Delete {
        uint32 count = 1;
    }
    
    oneof Command {
        Print print = 1;
        Read read = 2;
        Write write = 3;
        Delete delete = 4;
    }
}

message Action {
    string name = 1;
    optional string parent_action = 2;

    optional uint32 period_us = 3;
    optional uint32 worker_max_in_flight = 4;

    optional ActionDataMode action_data_mode = 6;

    repeated ActionCommand action_command = 7;
}

message InitialData {
    repeated ActionCommand.Write write_commands = 1;
}

message KeyValueVolumeConfig {
    string path = 1;
    uint32 partition_count = 2;

    repeated string channel_media = 3;
}

message KeyValueVolumeStressLoad {
    KeyValueVolumeConfig volume_config = 1;

    PartitionMode.Code partition_mode = 2;
    repeated Action actions = 3;
    InitialData initial_data = 4;
}