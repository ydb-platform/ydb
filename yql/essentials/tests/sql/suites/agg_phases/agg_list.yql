/* syntax version 1 */
/* postgres can not */

$t = SELECT * FROM AS_TABLE([<|key: 1, value: 2|>,<|key: 1, value: 3|>, <|key: 1, value: 4|>]);

$p =
SELECT
    key,AggList(value) as a
FROM $t
GROUP BY
    key
    with combine
    ;

$p = PROCESS $p;
select * from $p;

$p = SELECT
    key,AggList(a) as a
FROM $p
GROUP BY
    key
    with combinestate
    ;

$p = PROCESS $p;
select * from $p;

$p = SELECT
    key,AggList(a) as a
FROM $p
GROUP BY
    key
    with mergestate
    ;

$p = PROCESS $p;
select * from $p;


$p1 = SELECT
    key,AggList(a) as a
FROM $p
GROUP BY
    key
    with mergefinalize
    ;

$p1 = PROCESS $p1;
select * from $p1;

$p2 = SELECT
    key,AggList(a) as a
FROM (select key, just(a) as a from $p)
GROUP BY
    key
    with mergemanyfinalize
    ;

$p2 = PROCESS $p2;
select * from $p2;

$p3 =
SELECT
    key,AggList(value) as a
FROM $t
GROUP BY
    key
    with finalize
    ;

$p3 = PROCESS $p3;
select * from $p3;
