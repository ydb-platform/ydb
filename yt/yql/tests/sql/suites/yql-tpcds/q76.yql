/* dqfile can not */
/* hybridfile can not - missing langver support */
/* custom error: YqlSelect unsupported: (union_op select_stmt_intersect)* */
PRAGMA YqlSelect = 'force';
PRAGMA AnsiImplicitCrossJoin;

SELECT
    channel,
    col_name,
    d_year,
    d_qoy,
    i_category,
    COUNT(*) AS sales_cnt,
    SUM(ext_sales_price) AS sales_amt
FROM (
    SELECT
        'store' AS channel,
        'ss_addr_sk' AS col_name,
        d_year,
        d_qoy,
        i_category,
        ss_ext_sales_price AS ext_sales_price
    FROM
        plato.store_sales
    ,
        plato.item
    ,
        plato.date_dim
    WHERE
        ss_addr_sk IS NULL
        AND ss_sold_date_sk == d_date_sk
        AND ss_item_sk == i_item_sk
    UNION ALL
    SELECT
        'web' AS channel,
        'ws_web_page_sk' AS col_name,
        d_year,
        d_qoy,
        i_category,
        ws_ext_sales_price AS ext_sales_price
    FROM
        plato.web_sales
    ,
        plato.item
    ,
        plato.date_dim
    WHERE
        ws_web_page_sk IS NULL
        AND ws_sold_date_sk == d_date_sk
        AND ws_item_sk == i_item_sk
    UNION ALL
    SELECT
        'catalog' AS channel,
        'cs_warehouse_sk' AS col_name,
        d_year,
        d_qoy,
        i_category,
        cs_ext_sales_price AS ext_sales_price
    FROM
        plato.catalog_sales
    ,
        plato.item
    ,
        plato.date_dim
    WHERE
        cs_warehouse_sk IS NULL
        AND cs_sold_date_sk == d_date_sk
        AND cs_item_sk == i_item_sk
) AS foo
GROUP BY
    channel,
    col_name,
    d_year,
    d_qoy,
    i_category
ORDER BY
    channel,
    col_name,
    d_year,
    d_qoy,
    i_category
LIMIT 100;
