/* dqfile can not */
/* hybridfile can not - missing langver support */
/* custom error: YqlSelect unsupported: FULL */
PRAGMA YqlSelect = 'force';
PRAGMA AnsiImplicitCrossJoin;

$ssci = (
    SELECT
        ss_customer_sk AS customer_sk,
        ss_item_sk AS item_sk
    FROM
        plato.store_sales
    ,
        plato.date_dim
    WHERE
        ss_sold_date_sk == d_date_sk
        AND d_month_seq BETWEEN 1212 AND 1212 + 11
    GROUP BY
        ss_customer_sk,
        ss_item_sk
);

$csci = (
    SELECT
        cs_bill_customer_sk AS customer_sk,
        cs_item_sk AS item_sk
    FROM
        plato.catalog_sales
    ,
        plato.date_dim
    WHERE
        cs_sold_date_sk == d_date_sk
        AND d_month_seq BETWEEN 1212 AND 1212 + 11
    GROUP BY
        cs_bill_customer_sk,
        cs_item_sk
);

SELECT
    Sum(
        CASE
            WHEN (
                ssci.customer_sk IS NOT NULL
                AND csci.customer_sk IS NULL
            ) THEN 1
            ELSE 0
        END
    ) AS store_only,
    Sum(
        CASE
            WHEN (
                ssci.customer_sk IS NULL
                AND csci.customer_sk IS NOT NULL
            ) THEN 1
            ELSE 0
        END
    ) AS catalog_only,
    Sum(
        CASE
            WHEN (
                ssci.customer_sk IS NOT NULL
                AND csci.customer_sk IS NOT NULL
            ) THEN 1
            ELSE 0
        END
    ) AS store_and_catalog
FROM
    $ssci AS ssci
FULL OUTER JOIN
    $csci AS csci
ON
    (
        ssci.customer_sk == csci.customer_sk
        AND ssci.item_sk == csci.item_sk
    )
LIMIT 100;
