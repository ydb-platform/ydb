/* dqfile can not */
/* hybridfile can not - missing langver support */
/* custom error: Window and aggregation functions are not allowed in this context */
PRAGMA YqlSelect = 'force';
PRAGMA AnsiImplicitCrossJoin;

SELECT
    i_item_id,
    i_item_desc,
    i_category,
    i_class,
    i_current_price,
    Sum(ss_ext_sales_price) AS itemrevenue,
    Sum(ss_ext_sales_price) * 100 / Sum(Sum(ss_ext_sales_price)) OVER (
        PARTITION BY
            i_class
    ) AS revenueratio
FROM
    plato.store_sales
,
    plato.item
,
    plato.date_dim
WHERE
    ss_item_sk == i_item_sk
    AND i_category IN ('Jewelry', 'Sports', 'Books')
    AND ss_sold_date_sk == d_date_sk
    AND d_date BETWEEN CAST('2001-01-12' AS Date) AND (CAST('2001-01-12' AS Date) + DateTime::IntervalFromDays(30))
GROUP BY
    i_item_id,
    i_item_desc,
    i_category,
    i_class,
    i_current_price
ORDER BY
    i_category,
    i_class,
    i_item_id,
    i_item_desc,
    revenueratio
;
